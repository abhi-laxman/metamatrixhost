"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[3069,7340],{23506:(V,T,r)=>{r.d(T,{v:()=>i});var p=r(99305);function i(O){O?.writtenProperties&&O.writtenProperties.forEach(({target:m,propName:E,newOrigin:f})=>{(0,p.H)(m)&&f&&m.originOf(E)!==f&&m.updateOrigin(E,f)})}},99305:(V,T,r)=>{function p(i){return i&&"getAtOrigin"in i&&"originOf"in i}r.d(T,{H:()=>p})},94376:(V,T,r)=>{r.d(T,{p:()=>l});var p=r(8189),i=r(85211),f=(r(3248),r(35150),r(40707),r(76576));const l=I=>{let _=class extends I{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function g(I){return"portalItem"in I}(this)?this.portalItem?.apiKey:null}set apiKey(x){null!=x?this._override("apiKey",x):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,p._)([(0,i.MZ)({type:String})],_.prototype,"apiKey",null),_=(0,p._)([(0,f.$)("esri.layers.mixins.APIKeyMixin")],_),_}},46406:(V,T,r)=>{r.d(T,{Xh:()=>z,w6:()=>b});var p=r(10467),i=r(8189),O=r(89563),m=r(5922),E=r(35150),f=r(56492),g=r(45272),l=r(85211),x=(r(3248),r(40707),r(17221)),j=r(76576),D=r(50305),d=r(23506),h=r(28067),S=r(33119),v=r(32034),U=r(68438),K=r(22329),n=r(27834);var w=r(73874),u=r(46577),R=r(15764),W=r(3458),L=r(95945);const b=A=>{let y=class extends A{constructor(){var o;super(...arguments),o=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,f.sg)(function(){var e=(0,p.A)(function*(t,s,a){switch(t){case z.SAVE:return o._save(s);case z.SAVE_AS:return o._saveAs(a,s)}});return function(t,s,a){return e.apply(this,arguments)}}())}readSpatialReference(o,e){return C(e)}readFullExtent(o,e,t){if(null!=o&&"object"==typeof o){const B=null==o.spatialReference?{...o,spatialReference:C(e)}:o;return h.A.fromJSON(B,t)}const s=e.store,a=C(e);return null==a||null==s?.extent||!Array.isArray(s.extent)||s.extent.some(B=>B<F)?null:new h.A({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:a})}parseVersionString(o){const e={major:Number.NaN,minor:Number.NaN,versionString:o},t=o.split(".");return t.length>=2&&(e.major=parseInt(t[0],10),e.minor=parseInt(t[1],10)),e}readVersion(o,e){const t=e.store,s=null!=t.version?t.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(o){return"item-title"!==this.sublayerTitleMode?void 0:o}readTitleService(o,e){const t=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,U.yG)(this.url,e.name):e.name;let s=e.name;if(!s&&this.url){const a=(0,U.qg)(this.url);null!=a&&(s=a.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&t&&(s=t+" - "+s),(0,U.cr)(s)}set url(o){if(null==o)return void this._set("url",o);const e=(0,U.HZ)({layer:this,url:o,nonStandardUrlAllowed:!1,logger:E.A.getLogger(this)});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(o,e,t,s){(0,U.LS)(this,o,"layers",e,s)}get parsedUrl(){const o=this._get("url"),e=(0,g.An)(o);return e&&null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(o,e){var t=this;return(0,p.A)(function*(){t.indexInfo=(0,n.F)(t.parsedUrl?.path??"",t.rootNode,o,t.customParameters,t.apiKey,E.A.getLogger(t),e),null==t.fullExtent||t.fullExtent.hasZ||t._updateExtent(yield t.indexInfo)})()}_updateExtent(o){if("page"===o?.type){const e=o.rootIndex%o.pageSize,t=o.rootPage?.nodes?.[e];if(null==t?.obb?.center||null==t.obb.halfSize)throw new m.A("sceneservice:invalid-node-page","Invalid node page.");if(t.obb.center[0]<F||null==this.fullExtent||this.fullExtent.hasZ)return;const s=t.obb.halfSize,a=t.obb.center[2],B=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);this.fullExtent.zmin=a-B,this.fullExtent.zmax=a+B}else if("node"===o?.type){const e=o.rootNode?.mbs;if(!Array.isArray(e)||4!==e.length||e[0]<F)return;const t=e[2],s=e[3],{fullExtent:a}=this;a&&(a.zmin=t-s,a.zmax=t+s)}}_fetchService(o){var e=this;return(0,p.A)(function*(){if(null==e.url)throw new m.A("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const t=yield e._fetchFirstLayerId(o);null!=t&&(e.layerId=t)}return e._fetchServiceLayer(o)})()}_fetchFirstLayerId(o){var e=this;return(0,p.A)(function*(){const t=yield(0,O.A)(e.url??"",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:o});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id})()}_fetchServiceLayer(o){var e=this;return(0,p.A)(function*(){const t=yield(0,O.A)(e.parsedUrl?.path??"",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:o});t.ssl&&e.url&&(e.url=e.url.replace(/^http:/i,"https:"));let s=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(s=!0),s)return e._fetchVoxelServiceLayer();const a=t.data;e.read(a,e._getServiceContext()),e.validateLayer(a)})()}_fetchVoxelServiceLayer(o){var e=this;return(0,p.A)(function*(){const t=(yield(0,O.A)(e.parsedUrl?.path+"/layer",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:o})).data;e.read(t,e._getServiceContext()),e.validateLayer(t)})()}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}_ensureLoadBeforeSave(){var o=this;return(0,p.A)(function*(){yield o.load(),"beforeSave"in o&&"function"==typeof o.beforeSave&&(yield o.beforeSave())})()}validateLayer(o){}_saveAs(o,e){var t=this;return(0,p.A)(function*(){const s={...H,...e};let a=u.default.from(o);if(!a)throw new m.A("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");a.id&&(a=a.clone(),a.id=null);const B=a.portal||w.A.getDefault();yield t._ensureLoadBeforeSave(),a.type=J,a.portal=B;const $=(0,R.m)(a,"portal-item",!0),G={layers:[t.write({},$)]};return yield Promise.all($.resources.pendingOperations??[]),yield t._validateAgainstJSONSchema(G,$,s),t.url&&(a.url=t.url),a.title||(a.title=t.title),Z(a,s,N.newItem),yield B.signIn(),yield B.user.addItem({item:a,folder:s?.folder,data:G}),yield(0,W.r)(t.resourceReferences,$),t.portalItem=a,(0,d.v)($),$.portalItem=a,a})()}_save(o){var e=this;return(0,p.A)(function*(){const t={...H,...o};if(!e.portalItem)throw new m.A("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(e.portalItem.type!==J)throw new m.A("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${J}"`);yield e._ensureLoadBeforeSave();const s=(0,R.m)(e.portalItem,"portal-item",!0),a={layers:[e.write({},s)]};return yield Promise.all(s.resources.pendingOperations??[]),yield e._validateAgainstJSONSchema(a,s,t),e.url&&(e.portalItem.url=e.url),e.portalItem.title||(e.portalItem.title=e.title),Z(e.portalItem,t,N.existingItem),yield(0,W.S)(e.portalItem,a,e.resourceReferences,s),(0,d.v)(s),e.portalItem})()}_validateAgainstJSONSchema(o,e,t){var s=this;return(0,p.A)(function*(){const a=t?.validationOptions;(0,L.c)(e,{errorName:"sceneservice:save"},{ignoreUnsupported:a?.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const B=a?.enabled,$=null;if(B&&$){const G=(yield $()).validate(o,t.portalItemLayerType);if(!G.length)return;const X=`Layer item did not validate:\n${G.join("\n")}`;if(E.A.getLogger(s).error(`_validateAgainstJSONSchema(): ${X}`),"throw"===a.failPolicy){const Q=G.map(Y=>new m.A("sceneservice:schema-validation",Y));throw new m.A("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:Q})}}})()}};return(0,i._)([(0,l.MZ)(K.id)],y.prototype,"id",void 0),(0,i._)([(0,l.MZ)({type:v.A})],y.prototype,"spatialReference",void 0),(0,i._)([(0,x.w)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],y.prototype,"readSpatialReference",null),(0,i._)([(0,l.MZ)({type:h.A})],y.prototype,"fullExtent",void 0),(0,i._)([(0,x.w)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],y.prototype,"readFullExtent",null),(0,i._)([(0,l.MZ)({readOnly:!0,type:S.A})],y.prototype,"heightModelInfo",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],y.prototype,"minScale",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],y.prototype,"maxScale",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],y.prototype,"version",void 0),(0,i._)([(0,x.w)("version",["store.version"])],y.prototype,"readVersion",null),(0,i._)([(0,l.MZ)({type:String,json:{read:{source:"copyrightText"}}})],y.prototype,"copyright",void 0),(0,i._)([(0,l.MZ)({type:String,json:{read:!1}})],y.prototype,"sublayerTitleMode",void 0),(0,i._)([(0,l.MZ)({type:String})],y.prototype,"title",void 0),(0,i._)([(0,x.w)("portal-item","title")],y.prototype,"readTitlePortalItem",null),(0,i._)([(0,x.w)("service","title",["name"])],y.prototype,"readTitleService",null),(0,i._)([(0,l.MZ)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],y.prototype,"layerId",void 0),(0,i._)([(0,l.MZ)(K.OZ)],y.prototype,"url",null),(0,i._)([(0,D.K)("url")],y.prototype,"writeUrl",null),(0,i._)([(0,l.MZ)()],y.prototype,"parsedUrl",null),(0,i._)([(0,l.MZ)({readOnly:!0})],y.prototype,"store",void 0),(0,i._)([(0,l.MZ)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],y.prototype,"rootNode",void 0),y=(0,i._)([(0,j.$)("esri.layers.mixins.SceneService")],y),y},F=-1e38;function C(A){if(null!=A.spatialReference)return v.A.fromJSON(A.spatialReference);const y=A.store,o=y.indexCRS||y.geographicCRS,e=o&&parseInt(o.slice(o.lastIndexOf("/")+1),10);return null!=e?new v.A(e):null}function Z(A,y,o){A.typeKeywords||(A.typeKeywords=[]);const e=y.getTypeKeywords();for(const t of e)A.typeKeywords.push(t);A.typeKeywords&&(A.typeKeywords=A.typeKeywords.filter((t,s,a)=>a.indexOf(t)===s),o===N.newItem&&(A.typeKeywords=A.typeKeywords.filter(t=>"Hosted Service"!==t)))}var N,A;(A=N||(N={}))[A.existingItem=0]="existingItem",A[A.newItem=1]="newItem";const J="Scene Service",H={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var z;!function(A){A[A.SAVE=0]="SAVE",A[A.SAVE_AS=1]="SAVE_AS"}(z||(z={}))},27834:(V,T,r)=>{r.d(T,{F:()=>m});var p=r(10467),i=r(89563),O=r(5922);function m(f,g,l,I,_,x,j){return E.apply(this,arguments)}function E(){return(E=(0,p.A)(function*(f,g,l,I,_,x,j){let D=null;if(null!=l){const v=`${f}/nodepages/`,U=v+Math.floor(l.rootIndex/l.nodesPerPage);try{return{type:"page",rootPage:(yield(0,i.A)(U,{query:{f:"json",...I,token:_},responseType:"json",signal:j})).data,rootIndex:l.rootIndex,pageSize:l.nodesPerPage,lodMetric:l.lodSelectionMetricType,urlPrefix:v}}catch(K){x?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",U,K),D=K}}if(!g)return null;const d=g?.split("/").pop(),h=`${f}/nodes/`,S=h+d;try{return{type:"node",rootNode:(yield(0,i.A)(S,{query:{f:"json",...I,token:_},responseType:"json",signal:j})).data,urlPrefix:h}}catch(v){throw new O.A("sceneservice:root-node-missing","Root node missing.",{pageError:D,nodeError:v,url:S})}})).apply(this,arguments)}},15764:(V,T,r)=>{r.d(T,{m:()=>m,v:()=>O});var p=r(45272),i=r(73874);function O(f,g){return{...E(f,g),readResourcePaths:[]}}function m(f,g,l){const I=(0,p.An)(f.itemUrl);return{...E(f,g),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:I?{rootPath:I.path,writtenUrls:[]}:null,resources:l?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function E(f,g){return{origin:g,url:(0,p.An)(f.itemUrl),portal:f.portal||i.A.getDefault(),portalItem:f}}},57340:(V,T,r)=>{r.r(T),r.d(T,{addOrUpdateResources:()=>g,contentToBlob:()=>S,fetchResources:()=>E,getSiblingOfSameType:()=>U,getSiblingOfSameTypeI:()=>K,removeAllResources:()=>x,removeResource:()=>I,splitPrefixFileNameAndExtension:()=>d});var p=r(10467),i=r(89563),O=r(5922),m=r(45272);function E(n){return f.apply(this,arguments)}function f(){return(f=(0,p.A)(function*(n,c={},P){yield n.load(P);const M=(0,m.fj)(n.itemUrl,"resources"),{start:w=1,num:u=10,sortOrder:R="asc",sortField:W="resource"}=c,L={query:{start:w,num:u,sortOrder:R,sortField:W,token:n.apiKey},signal:P?.signal},b=yield n.portal.request(M,L);return{total:b.total,nextStart:b.nextStart,resources:b.resources.map(({created:F,size:C,resource:Z})=>({created:new Date(F),size:C,resource:n.resourceFromPath(Z)}))}})).apply(this,arguments)}function g(n,c,P,M){return l.apply(this,arguments)}function l(){return(l=(0,p.A)(function*(n,c,P,M){const w=new Map;for(const{resource:R,content:W,compress:L,access:b}of c){if(!R.hasPath())throw new O.A(`portal-item-resource-${P}:invalid-path`,"Resource does not have a valid path");const[F,C]=D(R.path),Z=`${F}/${L??""}/${b??""}`;w.has(Z)||w.set(Z,{prefix:F,compress:L,access:b,files:[]}),w.get(Z).files.push({fileName:C,content:W})}yield n.load(M);const u=(0,m.fj)(n.userItemUrl,"add"===P?"addResources":"updateResources");for(const{prefix:R,compress:W,access:L,files:b}of w.values())for(let C=0;C<b.length;C+=25){const Z=b.slice(C,C+25),N=new FormData;R&&"."!==R&&N.append("resourcesPrefix",R),W&&N.append("compress","true"),L&&N.append("access",L);let J=0;for(const{fileName:H,content:z}of Z)N.append("file"+ ++J,z,H);N.append("f","json"),yield n.portal.request(u,{method:"post",body:N,signal:M?.signal})}})).apply(this,arguments)}function I(n,c,P){return _.apply(this,arguments)}function _(){return(_=(0,p.A)(function*(n,c,P){if(!c.hasPath())throw new O.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield n.load(P);const M=(0,m.fj)(n.userItemUrl,"removeResources");yield n.portal.request(M,{method:"post",query:{resource:c.path},signal:P?.signal}),c.portalItem=null})).apply(this,arguments)}function x(n,c){return j.apply(this,arguments)}function j(){return(j=(0,p.A)(function*(n,c){yield n.load(c);const P=(0,m.fj)(n.userItemUrl,"removeResources");return n.portal.request(P,{method:"post",query:{deleteAll:!0},signal:c?.signal})})).apply(this,arguments)}function D(n){const c=n.lastIndexOf("/");return-1===c?[".",n]:[n.slice(0,c),n.slice(c+1)]}function d(n){const[c,P]=function h(n){const c=(0,m.Zo)(n);return null==c?[n,""]:[n.slice(0,n.length-c.length-1),`.${c}`]}(n),[M,w]=D(c);return[M,w,P]}function S(n){return v.apply(this,arguments)}function v(){return(v=(0,p.A)(function*(n){return"blob"===n.type?n.blob:"json"===n.type?new Blob([n.jsonString],{type:"application/json"}):(yield(0,i.A)(n.url,{responseType:"blob"})).data})).apply(this,arguments)}function U(n,c){if(!n.hasPath())return null;const[P,,M]=d(n.path);return n.portalItem.resourceFromPath((0,m.fj)(P,c+M))}function K(n,c){if(!n.hasPath())return null;const[P,,M]=d(n.path);return n.portalItem.resourceFromPath((0,m.fj)(P,c+M))}},3458:(V,T,r)=>{r.d(T,{S:()=>l,r:()=>f});var p=r(10467),i=r(5922),O=r(56492),m=r(43085),E=r(57340);function f(d,h,S){return g.apply(this,arguments)}function g(){return(g=(0,p.A)(function*(d,h,S){const v=yield _(d,h,S);yield j(v,h,S)})).apply(this,arguments)}function l(d,h,S,v,U){return I.apply(this,arguments)}function I(){return(I=(0,p.A)(function*(d,h,S,v,U){const K=yield _(S,v,U);yield d.update({data:h}),yield j(K,v,U)})).apply(this,arguments)}function _(d,h,S){return x.apply(this,arguments)}function x(){return(x=(0,p.A)(function*(d,h,S){if(!h?.resources)return;const v=h.portalItem===d.portalItem?new Set(d.paths):new Set;d.paths.length=0,d.portalItem=h.portalItem;const U=new Set(h.resources.toKeep.map(u=>u.resource.path)),K=new Set,n=[];U.forEach(u=>{v.delete(u),d.paths.push(u)});const c=[],P=[],M=[];for(const u of h.resources.toUpdate)if(v.delete(u.resource.path),U.has(u.resource.path)||K.has(u.resource.path)){const{resource:R,content:W,finish:L}=u,b=(0,E.getSiblingOfSameTypeI)(R,(0,m.lk)());d.paths.push(b.path),c.push({resource:b,content:yield(0,E.contentToBlob)(W),compress:u.compress}),L&&M.push(()=>L(b))}else{d.paths.push(u.resource.path),P.push({resource:u.resource,content:yield(0,E.contentToBlob)(u.content),compress:u.compress});const R=u.finish;R&&M.push(()=>R(u.resource)),K.add(u.resource.path)}for(const u of h.resources.toAdd)if(d.paths.push(u.resource.path),v.has(u.resource.path))v.delete(u.resource.path);else{c.push({resource:u.resource,content:yield(0,E.contentToBlob)(u.content),compress:u.compress});const R=u.finish;R&&M.push(()=>R(u.resource))}if(c.length||P.length){const{addOrUpdateResources:u}=yield Promise.resolve().then(r.bind(r,57340));yield u(h.portalItem,c,"add",S),yield u(h.portalItem,P,"update",S)}if(M.forEach(u=>u()),0===n.length)return v;const w=yield(0,O.Ol)(n);if((0,O.Te)(S),w.length>0)throw new i.A("save:resources","Failed to save one or more resources",{errors:w});return v})).apply(this,arguments)}function j(d,h,S){return D.apply(this,arguments)}function D(){return(D=(0,p.A)(function*(d,h,S){if(!d||!h.portalItem)return;const v=[];for(const U of d){const K=h.portalItem.resourceFromPath(U);v.push(K.portalItem.removeResource(K,S))}yield(0,O.Lx)(v)})).apply(this,arguments)}},95945:(V,T,r)=>{r.d(T,{c:()=>f,d:()=>O});var p=r(10467),i=r(5922);function O(g){return m.apply(this,arguments)}function m(){return(m=(0,p.A)(function*(g){const l=[];for(const I of g.allLayers)if("beforeSave"in I&&"function"==typeof I.beforeSave){const _=I.beforeSave();_&&l.push(_)}yield Promise.allSettled(l)})).apply(this,arguments)}const E=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function f(g,l,I){let _=(g.messages??[]).filter(({type:x})=>"error"===x).map(({name:x,message:j,details:D})=>new i.A(x,j,D));if(g.blockedRelativeUrls&&(_=_.concat(g.blockedRelativeUrls.map(x=>new i.A("url:unsupported",`Relative url '${x}' is not supported`)))),I){const{ignoreUnsupported:x,supplementalUnsupportedErrors:j=[],requiredPropertyChecksDisabled:D}=I;x&&(_=_.filter(({name:d})=>!(E.has(d)||j.includes(d)))),D&&(_=_.filter(d=>"web-document-write:property-required"!==d.name))}if(_.length>0)throw new i.A(l.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:_})}}}]);