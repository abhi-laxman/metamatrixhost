"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[7960],{33087:(le,X,a)=>{a.d(X,{q:()=>j});var v=a(60611);class j{constructor(U,b){this._storage=new v.F,this.id="",this.name="",this.size=0,this._storage.maxSize=U,this._storage.register(this),b&&this._storage.registerRemoveFunc("",b)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(U,b,k=1){this._storage.put(this,U,b,k,1)}pop(U){return this._storage.pop(this,U)}get(U){return this._storage.get(this,U)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(U){this._storage.maxSize=U}resetHitRate(){}}},60611:(le,X,a)=>{a.d(X,{F:()=>k,Ti:()=>j});var v=a(12438);const j=-3,C=j-1;var U,B;(B=U||(U={}))[B.ALL=0]="ALL",B[B.SOME=1]="SOME";class k{get size(){return this._size}constructor(x=10485760){this._maxSize=x,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new v.A,this._users=new v.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(x){this._users.push(x)}deregister(x){this._users.removeUnordered(x)}registerRemoveFunc(x,A){this._removeFuncs.push([x,A])}deregisterRemoveFunc(x){this._removeFuncs.filterInPlace(A=>A[0]!==x)}get maxSize(){return this._maxSize}set maxSize(x){this._maxSize=Math.max(x,-1),this._checkSize()}getSize(x,A){return this._db.get(x.id+A)?.size??0}put(x,A,h,D,T){const R=this._db.get(A=x.id+A);if(R&&(this._size-=R.size,x.size-=R.size,this._db.delete(A),R.entry!==h&&this._notifyRemove(A,R.entry,R.size,U.ALL)),D>this._maxSize)return void this._notifyRemove(A,h,D,U.ALL);if(void 0===h)return void console.warn("Refusing to cache undefined entry ");if(!D||D<0)return console.warn(`Refusing to cache entry with size ${D} for key ${A}`),void this._notifyRemove(A,h,0,U.ALL);const z=1+Math.max(T,C)-j;this._db.set(A,new H(h,D,z)),this._size+=D,x.size+=D,this._checkSize()}updateSize(x,A,h,D){const T=this._db.get(A=x.id+A);if(T&&T.entry===h){for(this._size-=T.size,x.size-=T.size;D>this._maxSize;){const R=this._notifyRemove(A,h,D,U.SOME);if(!(null!=R&&R>0))return void this._db.delete(A);D=R}T.size=D,this._size+=D,x.size+=D,this._checkSize()}}pop(x,A){const h=this._db.get(A=x.id+A);if(h)return this._size-=h.size,x.size-=h.size,this._db.delete(A),++this._hit,h.entry;++this._miss}get(x,A){const h=this._db.get(A=x.id+A);if(void 0!==h)return this._db.delete(A),h.lives=h.lifetime,this._db.set(A,h),++this._hit,h.entry;++this._miss}peek(x,A){const h=this._db.get(x.id+A);return h?++this._hit:++this._miss,h?.entry}get performanceInfo(){const x={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},A={},h=new Array;this._db.forEach((R,z)=>{const G=R.lifetime;h[G]=(h[G]||0)+R.size,this._users.forAll(q=>{const{id:P,name:E}=q;z.startsWith(P)&&(A[E]=(A[E]||0)+R.size)})});const D={};this._users.forAll(R=>{const z=R.name;"hitRate"in R&&"number"==typeof R.hitRate&&!isNaN(R.hitRate)&&R.hitRate>0?(A[z]=A[z]||0,D[z]=Math.round(100*R.hitRate)+"%"):D[z]="0%"});const T=Object.keys(A);T.sort((R,z)=>A[z]-A[R]),T.forEach(R=>x[R]=Math.round(A[R]/2**20)+"MB / "+D[R]);for(let R=h.length-1;R>=0;--R){const z=h[R];z&&(x["Priority "+(R+j-1)]=Math.round(z/this._size*100)+"%")}return x}resetStats(){this._hit=this._miss=0,this._users.forAll(x=>x.resetHitRate())}clear(x){const A=x.id;this._db.forEach((h,D)=>{D.startsWith(A)&&(this._size-=h.size,this._db.delete(D),this._notifyRemove(D,h.entry,h.size,U.ALL))}),x.size=0}clearAll(){this._db.forEach((x,A)=>this._notifyRemove(A,x.entry,x.size,U.ALL)),this._users.forAll(x=>x.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(x,A,h,D){let T;return this._removeFuncs.some(R=>{if(x.startsWith(R[0])){const z=R[1](A,D,h);return"number"==typeof z&&(T=z),!0}return!1}),T}_checkSize(){this._users.forAll(x=>this._checkSizeLimits(x)),this._checkSizeLimits()}_checkSizeLimits(x){const A=x??this;if(A.maxSize<0||A.size<=A.maxSize)return;const h=x?.id;let D=!0;for(;D;){D=!1;for(const[T,R]of this._db)if(0===R.lifetime&&(!h||T.startsWith(h))){if(this._purgeItem(T,R,x),A.size<=.9*A.maxSize)return;D||=this._db.has(T)}}for(const[T,R]of this._db)if((!h||T.startsWith(h))&&(this._purgeItem(T,R,x),A.size<=.9*A.maxSize))return}_purgeItem(x,A,h=this._users.find(D=>x.startsWith(D.id))){if(this._db.delete(x),A.lives<=1){this._size-=A.size,h&&(h.size-=A.size);const D=this._notifyRemove(x,A.entry,A.size,U.SOME);null!=D&&D>0&&(this._size+=D,h&&(h.size+=D),A.lives=A.lifetime,A.size=D,this._db.set(x,A))}else--A.lives,this._db.set(x,A)}}class H{constructor(x,A,h){this.entry=x,this.size=A,this.lifetime=h,this.lives=h}}},70171:(le,X,a)=>{a.r(X),a.d(X,{WhereClauseCache:()=>C});var v=a(33087),j=a(1329);class C{constructor(b,k){this._cache=new v.q(b),this._invalidCache=new v.q(k)}get(b,k){const N=`${k?.uid}:${b}`,H=this._cache.get(N);if(H)return H;if(null!=this._invalidCache.get(N))return null;try{const B=j.default.create(b,{fieldsIndex:k});return this._cache.put(N,B),B}catch(B){return this._invalidCache.put(N,B),null}}getError(b,k){return this._invalidCache.get(`${k?.uid}:${b}`)??null}}},47960:(le,X,a)=>{a.d(X,{do:()=>y,ux:()=>m});var v=a(10467),j=a(89952),C=a(69690),U=a(5922),k=(a(3248),a(71065)),N=a(77806),H=a(11432),B=a(56492),x=a(82663),A=a(13970),h=a(2296),D=a(51995),T=a(83065),R=a(61320),z=a(58701),G=a(31732),q=a(71905),P=a(95985),E=a(88840);class S{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const t=1e3*this._purgeInterval,l=performance.now()-t;for(const[r,n]of this._storage){if(!(n.time<l))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,t)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}put(t,l){this._storage?.set(t,new Q(l)),this._scheduleSweep()}get(t){const l=this._storage?.get(t);if(l)return this._storage?.delete(t),l.time=performance.now(),this._storage?.set(t,l),l.items}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}get test(){}}let W=0;class Q{constructor(t){this.items=t,this.time=performance.now(),this.id=W++}}var ie=a(78200),te=a(93587),ae=a(871),ne=a(98606),c=a(18633),s=a(76980),d=a(73258),i=a(34150);class y{constructor(t){this._changeHandle=null,this.capabilities={query:ie.F},this.geometryType=t.geometryType,this.hasM=!!t.hasM,this.hasZ=!!t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._cache=t.cache??new S,this.timeInfo=t.timeInfo,this._changeHandle=this.featureStore.events.on("changed",()=>this._clearCache()),this.fieldsIndex=k.A.isSerializable(t.fieldsIndex)?t.fieldsIndex:d.A.fromJSON(t.fieldsIndex),this.availableFields=!t.availableFields||1===t.availableFields.length&&"*"===t.availableFields[0]?new Set(this.fieldsIndex.fields.map(l=>l.name)):new Set(t.availableFields.map(l=>this.fieldsIndex.get(l)?.name).filter(l=>null!=l)),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}destroy(){this._changeHandle=(0,H.xt)(this._changeHandle),this._frameTask=(0,H.xt)(this._frameTask),this._clearCache(),(0,H.pR)(this._cache)}get featureAdapter(){return this.featureStore.featureAdapter}_clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}executeQuery(t,l){var r=this;return(0,v.A)(function*(){const n=(0,B.Mq)(l);try{return yield(yield r._executeQuery(t,{},n)).createQueryResponse()}catch(g){if(g!==ae.v8)throw g;return new te.G([],t,r).createQueryResponse()}})()}executeQueryForCount(t={},l){var r=this;return(0,v.A)(function*(){const n=(0,B.Mq)(l);try{return(yield r._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},n)).createQueryResponseForCount()}catch(g){if(g!==ae.v8)throw g;return 0}})()}executeQueryForExtent(t,l){var r=this;return(0,v.A)(function*(){const n=(0,B.Mq)(l),g=t.outSR;try{const M=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},n),F=M.size;return F?{count:F,extent:yield r._getBounds(M.items,M.spatialReference,g||r.spatialReference)}:{count:0,extent:null}}catch(M){if(M===ae.v8)return{count:0,extent:null};throw M}})()}executeQueryForIds(t,l){var r=this;return(0,v.A)(function*(){return r.executeQueryForIdSet(t,l).then(n=>Array.from(n))})()}executeQueryForIdSet(t,l){var r=this;return(0,v.A)(function*(){const n=(0,B.Mq)(l);try{const g=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},n),M=g.items,F=new Set;return yield r.reschedule(()=>{for(const I of M)F.add(g.featureAdapter.getObjectId(I))},n),F}catch(g){if(g===ae.v8)return new Set;throw g}})()}executeQueryForLatestObservations(t,l){var r=this;return(0,v.A)(function*(){const n=(0,B.Mq)(l);if(!r.timeInfo?.trackIdField)throw new U.A("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:r.timeInfo});try{const g=yield r._executeQuery(t,{},n);return yield r.reschedule(()=>r._filterLatest(g),n),yield g.createQueryResponse()}catch(g){if(g!==ae.v8)throw g;return new te.G([],t,r).createQueryResponse()}})()}executeAttributeBinsQuery(t,l){var r=this;return(0,v.A)(function*(){const n=(0,B.Mq)(l);let g;t=(0,N.o8)(t);try{t=yield r.schedule(()=>(0,ae.iJ)(t,r.definitionExpression,r.spatialReference),n),t=yield r.reschedule(()=>(0,ne.FQ)(t,{availableFields:r.availableFields,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,spatialReference:r.spatialReference}),n);const M=yield r.reschedule(()=>r._executeSceneFilterQuery(t,n),n);g=yield r.reschedule(()=>r._executeGeometryQuery(t,M,n),n),yield r.reschedule(()=>r._executeAggregateIdsQuery(g),n),yield r.reschedule(()=>r.executeObjectIdsQuery(g),n),yield r.reschedule(()=>r.executeTimeQuery(g),n),yield r.reschedule(()=>r.executeAttributesQuery(g),n)}catch(M){if(M!==ae.v8)throw M;g=new te.G([],t,r)}return g.createQueryBinsResponse(t)})()}executeQueryForSummaryStatistics(t={},l,r){var n=this;return(0,v.A)(function*(){const g=(0,B.Mq)(r),{field:M,normalizationField:F,valueExpression:I}=l;return(yield n._executeQueryForStatistics(t,{field:M,normalizationField:F,valueExpression:I},g)).createSummaryStatisticsResponse(l)})()}executeQueryForUniqueValues(t={},l,r){var n=this;return(0,v.A)(function*(){const g=(0,B.Mq)(r),{field:M,field2:F,field3:I,valueExpression:L}=l;return(yield n._executeQueryForStatistics(t,{field:M,field2:F,field3:I,valueExpression:L},g)).createUniqueValuesResponse(l)})()}executeQueryForClassBreaks(t={},l,r){var n=this;return(0,v.A)(function*(){const g=(0,B.Mq)(r),{field:M,normalizationField:F,valueExpression:I}=l;return(yield n._executeQueryForStatistics(t,{field:M,normalizationField:F,valueExpression:I},g)).createClassBreaksResponse(l)})()}executeQueryForHistogram(t={},l,r){var n=this;return(0,v.A)(function*(){const g=(0,B.Mq)(r),{field:M,normalizationField:F,valueExpression:I}=l;return(yield n._executeQueryForStatistics(t,{field:M,normalizationField:F,valueExpression:I},g)).createHistogramResponse(l)})()}fetchRecomputedExtents(t){var l=this;return(0,v.A)(function*(){const r=(0,B.Mq)(t);l._timeExtentPromise||=(0,s.W)(l.timeInfo,l.featureStore);const[n,g]=yield Promise.all([l._getFullExtent(),l._timeExtentPromise]);return(0,B.Te)(r),{fullExtent:n,timeExtent:g}})()}_getBounds(t,l,r){var n=this;return(0,v.A)(function*(){const g=(0,h.hZ)((0,h.vt)(),h.qv);yield n.featureStore.forEachBounds(t,I=>(0,h.RF)(g,I));const M={xmin:g[0],ymin:g[1],xmax:g[3],ymax:g[4],spatialReference:(0,P.ag)(n.spatialReference)};n.hasZ&&isFinite(g[2])&&isFinite(g[5])&&(M.zmin=g[2],M.zmax=g[5],M.hasZ=!0);const F=(0,E.Cv)(M,l,r);if(F.spatialReference=(0,P.ag)(r),F.xmax-F.xmin==0){const I=(0,x.GA)(F.spatialReference);F.xmin-=I,F.xmax+=I}if(F.ymax-F.ymin==0){const I=(0,x.GA)(F.spatialReference);F.ymin-=I,F.ymax+=I}if(n.hasZ&&null!=F.zmin&&null!=F.zmax&&F.zmax-F.zmin==0){const I=(0,x.GA)(F.spatialReference);F.zmin-=I,F.zmax+=I}return F})()}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(t=>this._getBounds(t,this.spatialReference,this.spatialReference)),this._fullExtentPromise}schedule(t,l){var r=this;return(0,v.A)(function*(){return r._frameTask?.schedule(t,l)??t(i.Bb)})()}reschedule(t,l){var r=this;return(0,v.A)(function*(){return r._frameTask?.reschedule(t,l)??t(i.Bb)})()}_getAllFeaturesQueryEngineResult(t){var l=this;return(0,v.A)(function*(){return new te.G(yield l._getAllFeatures(),t,l)})()}_getAllFeatures(){var t=this;return(0,v.A)(function*(){if(null==t._allFeaturesPromise){const n=[];t._allFeaturesPromise=(0,v.A)(function*(){return yield t.featureStore.forEach(g=>n.push(g))})().then(()=>(0,C.zI)(n))}const l=t._allFeaturesPromise,r=yield l;return l===t._allFeaturesPromise?r.slice():t._getAllFeatures()})()}_executeQuery(t,l,r){var n=this;return(0,v.A)(function*(){t=(0,N.o8)(t),t=yield n.schedule(()=>(0,ae.GC)(t,n.definitionExpression,n.spatialReference),r),t=yield n.reschedule(()=>(0,ne.B4)(t,{availableFields:n.availableFields,fieldsIndex:n.fieldsIndex,geometryType:n.geometryType,spatialReference:n.spatialReference}),r),t={...t,...l};const g=yield n.reschedule(()=>n._executeSceneFilterQuery(t,r),r),M=yield n.reschedule(()=>n._executeGeometryQuery(t,g,r),r);return yield n.reschedule(()=>n._executeAggregateIdsQuery(M),r),yield n.reschedule(()=>n.executeObjectIdsQuery(M),r),yield n.reschedule(()=>n.executeTimeQuery(M),r),yield n.reschedule(()=>n.executeAttributesQuery(M),r),M})()}_executeSceneFilterQuery(t,l){var r=this;return(0,v.A)(function*(){if(null==t.sceneFilter)return null;const{outSR:n,returnGeometry:g,returnCentroid:M}=t,F=r.featureStore.featureSpatialReference,I=t.sceneFilter.geometry,L=null==F||(0,z.aI)(F,I.spatialReference)?I:(0,E.Cv)(I,F);if(!L)return null;const J=g||M,K=(0,z.fn)(n)&&!(0,z.aI)(r.spatialReference,n)&&J?function(){var $=(0,v.A)(function*(Y){return r._project(Y,n)});return function(Y){return $.apply(this,arguments)}}():$=>$,Z=r.featureAdapter,w=yield r.reschedule(()=>r.searchFeatures(m(L)),l);if("disjoint"===t.sceneFilter.spatialRelationship){if(!w.length)return null;const $=new Set;for(const se of w)$.add(Z.getObjectId(se));const Y=yield r.reschedule(()=>r._getAllFeatures(),l);return K(yield r.reschedule((0,v.A)(function*(){const se=yield(0,c.xt)("esriSpatialRelDisjoint",L,r.geometryType,r.hasZ,r.hasM),re=yield r.runSpatialFilter(Y,ce=>!$.has(Z.getObjectId(ce))||se(Z.getGeometry(ce)),l);return new te.G(re,t,r)}),l))}if(!w.length)return new te.G([],t,r);if(r._canExecuteSinglePass(L,t))return K(new te.G(w,t,r));const V=yield(0,c.xt)("esriSpatialRelContains",L,r.geometryType,r.hasZ,r.hasM),ee=yield r.runSpatialFilter(w,$=>V(Z.getGeometry($)),l);return K(new te.G(ee,t,r))})()}_executeGeometryQuery(t,l,r){var n=this;return(0,v.A)(function*(){if(null!=l&&0===l.items.length)return l;const{geometry:g,outSR:M,returnGeometry:F,returnCentroid:I}=t,L=l?null:n._getCacheKey(t),J=L?n._cache.get(L):null;if(J)return new te.G(J,t,n);const K=(0,z.fn)(M)&&!(0,z.aI)(n.spatialReference,M),Z=F||I,w=function(){var re=(0,v.A)(function*(ce){return K&&Z&&(yield n._project(ce,M)),L&&n._cache.put(L,ce.items),ce});return function(he){return re.apply(this,arguments)}}(),V=n.featureStore.featureSpatialReference,ee=!g||null==V||(0,z.aI)(V,g.spatialReference)?g:(0,E.Cv)(g,V);if(!ee)return w(l??(yield n._getAllFeaturesQueryEngineResult(t)));const $=n.featureAdapter;let Y=yield n.reschedule(()=>n.searchFeatures(m(g)),r);const oe=t.spatialRel??"esriSpatialRelIntersects";if("esriSpatialRelDisjoint"===oe){if(!Y.length)return w(l??(yield n._getAllFeaturesQueryEngineResult(t)));const re=new Set;for(const pe of Y)re.add($.getObjectId(pe));const ce=null!=l?l.items:yield n.reschedule(()=>n._getAllFeatures(),r);return w(yield n.reschedule((0,v.A)(function*(){const pe=yield(0,c.xt)(oe,ee,n.geometryType,n.hasZ,n.hasM),_e=yield n.runSpatialFilter(ce,ge=>!re.has($.getObjectId(ge))||pe($.getGeometry(ge)),r);return new te.G(_e,t,n)}),r))}if(null!=l){const re=new j.vW;Y=Y.filter(ce=>(0,j.qh)(l.items,ce,l.items.length,re)>=0)}if(!Y.length){const re=new te.G([],t,n);return L&&n._cache.put(L,re.items),re}if(n._canExecuteSinglePass(ee,t))return w(new te.G(Y,t,n));const se=yield(0,c.xt)(oe,ee,n.geometryType,n.hasZ,n.hasM),ue=yield n.runSpatialFilter(Y,re=>se($.getGeometry(re)),r);return w(new te.G(ue,t,n))})()}_executeAggregateIdsQuery(t){if(0===t.items.length||!t.query.aggregateIds?.length||null==this.aggregateAdapter)return;const l=new Set;for(const n of t.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(n).forEach(g=>l.add(g));const r=this.featureAdapter.getObjectId;t.items=t.items.filter(n=>l.has(r(n)))}executeObjectIdsQuery(t){if(0===t.items.length||!t.query.objectIds?.length)return;const l=new Set(t.query.objectIds),r=this.featureAdapter.getObjectId;t.items=t.items.filter(n=>l.has(r(n)))}executeTimeQuery(t){if(0===t.items.length)return;const l=(0,s.I)(this.timeInfo,t.query.timeExtent,this.featureAdapter);null!=l&&(t.items=t.items.filter(l))}executeAttributesQuery(t){if(0===t.items.length)return;const l=(0,q.j4)(t.query.where,this.fieldsIndex);if(l){if(!l.isStandardized)throw new TypeError("Where clause is not standardized");t.items=t.items.filter(r=>l.testFeature(r,this.featureAdapter))}}runSpatialFilter(t,l,r){var n=this;return(0,v.A)(function*(){if(!l)return t;if(null==n._frameTask)return t.filter(I=>l(I));let g=0;const M=new Array,F=function(){var I=(0,v.A)(function*(L){for(;g<t.length;){const J=t[g++];l(J)&&(M.push(J),L.madeProgress()),L.done&&(yield n.reschedule(K=>F(K),r))}});return function(J){return I.apply(this,arguments)}}();return n.reschedule(I=>F(I),r).then(()=>M)})()}_filterLatest(t){const{trackIdField:l,startTimeField:r,endTimeField:n}=this.timeInfo,g=n||r,M=new Map,F=this.featureAdapter.getAttribute;for(const I of t.items){const L=F(I,l),J=F(I,g),K=M.get(L);(!K||J>F(K,g))&&M.set(L,I)}t.items=Array.from(M.values())}_getCacheKey(t){const{geometry:l,spatialRel:r,returnGeometry:n,returnCentroid:g,outSR:M,resultType:F,cacheHint:I}=t;if("tile"!==F&&!I)return null;const L=n||g;return(0,z.fn)(M)&&!(0,z.aI)(this.spatialReference,M)&&L?JSON.stringify([l,r,M]):JSON.stringify([l,r])}_canExecuteSinglePass(t,l){const{spatialRel:r}=l;return(0,c.tC)(t)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}_project(t,l){var r=this;return(0,v.A)(function*(){if(!l||(0,z.aI)(r.spatialReference,l))return t;const n=r.featureAdapter;let g;try{const F=yield r._getFullExtent();g=(0,A.getTransformation)(r.spatialReference,l,F)}catch{}const M=yield(0,E.lK)(t.items.map(F=>(0,P.pL)(r.geometryType,r.hasZ,r.hasM,n.getGeometry(F))),r.spatialReference,l,g);return t.items=(0,C.zI)(M.map((F,I)=>n.cloneWithGeometry(t.items[I],(0,G.Ux)(F,r.hasZ,r.hasM)))),t})()}searchFeatures(t){var l=this;return(0,v.A)(function*(){const r=new Set;yield Promise.all(t.map(g=>l.featureStore.forEachInBounds(g,M=>r.add(M))));const n=Array.from(r.values());return r.clear(),n})()}_executeQueryForStatistics(t,l,r){var n=this;return(0,v.A)(function*(){t=(0,N.o8)(t);try{t=yield n.schedule(()=>(0,ae.GC)(t,n.definitionExpression,n.spatialReference),r),t=yield n.reschedule(()=>(0,ne.mO)(t,l,{availableFields:n.availableFields,fieldsIndex:n.fieldsIndex,geometryType:n.geometryType,spatialReference:n.spatialReference}),r);const g=yield n.reschedule(()=>n._executeSceneFilterQuery(t,r),r),M=yield n.reschedule(()=>n._executeGeometryQuery(t,g,r),r);return yield n.reschedule(()=>n._executeAggregateIdsQuery(M),r),yield n.reschedule(()=>n.executeObjectIdsQuery(M),r),yield n.reschedule(()=>n.executeTimeQuery(M),r),yield n.reschedule(()=>n.executeAttributesQuery(M),r),M}catch(g){if(g!==ae.v8)throw g;return new te.G([],t,n)}})()}get test(){}}function m(_){if((0,c.tC)(_)){if((0,R.ZC)(_))return[(0,D.fA)(Math.min(_.xmin,_.xmax),Math.min(_.ymin,_.ymax),Math.max(_.xmin,_.xmax),Math.max(_.ymin,_.ymax))];if((0,R.Bi)(_))return _.rings.map(t=>(0,D.fA)(Math.min(t[0][0],t[2][0]),Math.min(t[0][1],t[2][1]),Math.max(t[0][0],t[2][0]),Math.max(t[0][1],t[2][1])))}return[(0,T.Rg)((0,D.vt)(),_)]}},78200:(le,X,a)=>{a.d(X,{F:()=>v,P:()=>j});const v={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsCurrentUser:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsReturnMesh:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0,supportsTrueCurve:!1},j={supportsDate:!0,supportsFixedInterval:!0,supportsAutoInterval:!0,supportsFixedBoundaries:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!0,supportedStatistics:{count:!0,sum:!0,avg:!0,var:!0,stddev:!0,min:!0,max:!0,percentileContinuous:!0,percentileDiscrete:!0,envelope:!0,centroid:!0,convexHull:!0},supportedNormalizationTypes:{field:!0,log:!0,naturalLog:!0,percentOfTotal:!0,squareRoot:!0}}},93587:(le,X,a)=>{a.d(X,{G:()=>W});var v=a(10467),j=a(77806),C=a(97442),U=a(39239),b=a(22442),k=a(721),N=a(58701),H=a(71905),B=a(95985),x=a(86300),A=a(19093),h=a(59377),D=a(48218);class T{constructor(c,s,d){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=c.returnDistinctValues??!1,this.fieldsIndex=d,this.featureAdapter=s;const i=c.outFields;if(i&&!i.includes("*")){this.outFields=i;let o=0;for(const p of i){const y=(0,H.Wq)(p),m=this.fieldsIndex.get(y),_=m?null:(0,H.j4)(y,d),t=m?m.name:(0,H.SY)(p)||"FIELD_EXP_"+o++;this._fieldDataCache.set(p,{alias:t,clause:_})}}}countDistinctValues(c){return this.returnDistinctValues?(c.forEach(s=>this.getAttributes(s)),this._returnDistinctMap.size):c.length}getAttributes(c){const s=this._processAttributesForOutFields(c);return this._processAttributesForDistinctValues(s)}getFieldValue(c,s,d){const i=d?d.name:s;let o=null;return this._fieldDataCache.has(i)?o=this._fieldDataCache.get(i)?.clause:d||(o=(0,H.j4)(s,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:o})),d?this.featureAdapter.getAttribute(c,i):o?.calculateValue(c,this.featureAdapter)}getDataValues(c,s,d=!0){const i=s.normalizationType,o=s.normalizationTotal,p=this.fieldsIndex.get(s.field),y=(0,x.zD)(p)||(0,x.Ah)(p),m=(0,x.OH)(p);return c.map(_=>{let t=s.field&&this.getFieldValue(_,s.field,this.fieldsIndex.get(s.field));if(s.field2?(t=`${(0,h.gJ)(t)}${s.fieldDelimiter}${(0,h.gJ)(this.getFieldValue(_,s.field2,this.fieldsIndex.get(s.field2)))}`,s.field3&&(t=`${t}${s.fieldDelimiter}${(0,h.gJ)(this.getFieldValue(_,s.field3,this.fieldsIndex.get(s.field3)))}`)):"string"==typeof t&&d&&(y?t=t?new Date(t).getTime():null:m&&(t=t?(0,A.rb)(t):null)),i&&Number.isFinite(t)){const l="field"===i&&s.normalizationField?this.getFieldValue(_,s.normalizationField,this.fieldsIndex.get(s.normalizationField)):null;t=(0,h.zS)(t,i,l,o)}return t})}getExpressionValues(c,s,d,i,o){var p=this;return(0,v.A)(function*(){const{arcadeUtils:y}=yield(0,D.lw)(),m=y.hasGeometryOperations(s);m&&(yield y.enableGeometryOperations());const _=y.createFunction(s),t=y.getViewInfo(d),l={fields:p.fieldsIndex.fields};return c.map(r=>{const n={attributes:p.featureAdapter.getAttributes(r),layer:l,geometry:m?{...(0,B.pL)(i.geometryType,i.hasZ,i.hasM,p.featureAdapter.getGeometry(r)),spatialReference:d?.spatialReference}:null},g=y.createExecContext(n,t,o);return y.executeFunction(_,g)})})()}validateItem(c,s){return this._fieldDataCache.has(s)||this._fieldDataCache.set(s,{alias:s,clause:(0,H.j4)(s,this.fieldsIndex)}),this._fieldDataCache.get(s)?.clause?.testFeature(c,this.featureAdapter)??!1}validateItems(c,s){return this._fieldDataCache.has(s)||this._fieldDataCache.set(s,{alias:s,clause:(0,H.j4)(s,this.fieldsIndex)}),this._fieldDataCache.get(s)?.clause?.testSet(c,this.featureAdapter)??!1}_processAttributesForOutFields(c){const s=this.outFields;if(!s?.length)return this.featureAdapter.getAttributes(c);const d={};for(const i of s){const{alias:o,clause:p}=this._fieldDataCache.get(i);d[o]=p?p.calculateValue(c,this.featureAdapter):this.featureAdapter.getAttribute(c,o)}return d}_processAttributesForDistinctValues(c){if(null==c||!this.returnDistinctValues)return c;const s=this.outFields,d=[];if(s)for(const p of s){const{alias:y}=this._fieldDataCache.get(p);d.push(c[y])}else for(const p in c)d.push(c[p]);const i=`${(s||["*"]).join(",")}=${d.join(",")}`;let o=this._returnDistinctMap.get(i)||0;return this._returnDistinctMap.set(i,++o),o>1?null:c}}var R=a(88840),z=a(871),G=a(28693),q=a(81930),P=a(58326),E=a(95568),O=a(45005);const S="bin";class W{constructor(c,s,d){this.items=c,this.query=s,this.geometryType=d.geometryType,this.hasM=d.hasM,this.hasZ=d.hasZ,this.fieldsIndex=d.fieldsIndex,this.objectIdField=d.objectIdField,this.spatialReference=d.spatialReference,this.featureAdapter=d.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const c=new T(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return c.countDistinctValues(this.items);const{groupByFieldsForStatistics:s,having:d,outStatistics:i}=this.query;if(!s?.length)return 1;const p=new Map,y=new Map,m=new Set;for(const _ of i){const{statisticType:t}=_,l="exceedslimit"!==t?_.onStatisticField:void 0;if(!y.has(l)){const n=[];for(const g of s){const M=this._getAttributeValues(c,g,this.items,p);n.push(M)}y.set(l,this._calculateUniqueValues(n,this.items,c.returnDistinctValues))}const r=y.get(l);for(const n in r){const{data:g,items:M}=r[n],F=g.join(",");d&&!c.validateItems(M,d)||m.add(F)}}return m.size}createQueryResponse(){var c=this;return(0,v.A)(function*(){let s;if(s=c.query.outStatistics?c.query.outStatistics.some(d=>"exceedslimit"===d.statisticType)?c._createExceedsLimitQueryResponse():yield c._createStatisticsQueryResponse(c.query,c.items):c._createFeatureQueryResponse(c.query),c.query.returnQueryGeometry){const d=c.query.geometry;s.queryGeometry=(0,N.fn)(c.query.outSR)&&!(0,N.aI)(d.spatialReference,c.query.outSR)?(0,B.ag)({spatialReference:c.query.outSR,...(0,R.Cv)(d,d.spatialReference,c.query.outSR)}):(0,B.ag)({spatialReference:c.query.outSR,...d})}return s})()}createSnappingResponse(c,s){const d=this.featureAdapter,i=ie(this.hasZ,this.hasM),{point:o,mode:p}=c,y="number"==typeof c.distance?c.distance:c.distance.x,m="number"==typeof c.distance?c.distance:c.distance.y,_={candidates:[]},t="esriGeometryPolygon"===this.geometryType,l="esriGeometryPolyline"===this.geometryType||"esriGeometryPoint"===this.geometryType,r=this._getPointCreator(p,this.spatialReference,s),n=new te(null,0),g=new te(null,0),M={x:0,y:0,z:0};for(const F of this.items){const I=d.getGeometry(F);if(null==I)continue;const{coords:L}=I,J=I.isPoint?ae:I.lengths;if(n.coords=L,g.coords=L,c.returnEdge){let K=0;for(let Z=0;Z<J.length;Z++){const w=J[Z],V=K;for(let ee=0;ee<w;ee++,K+=i){if(!t&&ee===w-1)continue;const $=n;$.coordsIndex=K;const Y=g;Y.coordsIndex=ee===w-1?V:K+i;const oe=M;if(!Q(M,o,$,Y))continue;const se=(o.x-oe.x)/y,ue=(o.y-oe.y)/m,re=se*se+ue*ue;re<=1&&_.candidates.push((0,G.P)(d.getObjectId(F),r(oe),Math.sqrt(re),r($),r(Y)))}}}if("all"===c.vertexMode){let K=0;for(let Z=0;Z<J.length;Z++){const w=J[Z],ee=g;ee.coordsIndex=K;for(let $=0;$<w;$++,K+=i){const Y=n;if(Y.coordsIndex=K,t&&$===w-1&&Y.x===ee.x&&Y.y===ee.y)continue;const oe=(o.x-Y.x)/y,se=(o.y-Y.y)/m,ue=oe*oe+se*se;ue<=1&&_.candidates.push((0,G.k)(d.getObjectId(F),r(Y),Math.sqrt(ue)))}}}else if(l&&"ends"===c.vertexMode){let K=0;const Z=[];for(let w=0;w<J.length;w++){Z.push(K);const V=J[w];K+=V*i,!t&&V>1&&Z.push(K-i)}for(const w of Z){const V=n;V.coordsIndex=w;const ee=(o.x-V.x)/y,$=(o.y-V.y)/m,Y=ee*ee+$*$;Y<=1&&_.candidates.push((0,G.k)(d.getObjectId(F),r(V),Math.sqrt(Y)))}}}return _.candidates.sort((F,I)=>F.distance-I.distance),_}_getPointCreator(c,s,d){const i=null==d||(0,N.aI)(s,d)?y=>y:y=>(0,R.Cv)(y,s,d),{hasZ:o}=this;return"3d"===c?o?({x:y,y:m,z:_})=>i({x:y,y:m,z:_}):({x:y,y:m})=>i({x:y,y:m,z:0}):({x:y,y:m})=>i({x:y,y:m})}createSummaryStatisticsResponse(c){var s=this;return(0,v.A)(function*(){const{field:d,valueExpression:i,normalizationField:o,normalizationType:p,normalizationTotal:y,minValue:m,maxValue:_,scale:t,timeZone:l,outStatisticTypes:r}=c,n=s.fieldsIndex.get(d),g=(0,x.vE)(n)||(0,x.zD)(n)||(0,x.Ah)(n),M=yield s._getDataValues({field:d,valueExpression:i,normalizationField:o,normalizationType:p,normalizationTotal:y,scale:t,timeZone:l},s.items),F=(0,h.Vb)({normalizationType:p,normalizationField:o,minValue:m,maxValue:_}),I={value:.5,fieldType:n?.type},L=(0,x.yM)(n)?(0,h.z9)({values:M,supportsNullCount:F,percentileParams:I,outStatisticTypes:r}):(0,h.G_)({values:M,minValue:m,maxValue:_,useSampleStdDev:!p,supportsNullCount:F,percentileParams:I,outStatisticTypes:r});return(0,h.oZ)(L,r,g)})()}createUniqueValuesResponse(c){var s=this;return(0,v.A)(function*(){const{field:d,valueExpression:i,domains:o,returnAllCodedValues:p,scale:y,timeZone:m}=c,_=yield s._getDataValues({field:d,field2:c.field2,field3:c.field3,fieldDelimiter:c.fieldDelimiter,valueExpression:i,scale:y,timeZone:m},s.items,!1),t=(0,h.b3)(_);return(0,h.lv)(t,o,p,c.fieldDelimiter)})()}createClassBreaksResponse(c){var s=this;return(0,v.A)(function*(){const{field:d,valueExpression:i,normalizationField:o,normalizationType:p,normalizationTotal:y,classificationMethod:m,standardDeviationInterval:_,minValue:t,maxValue:l,numClasses:r,scale:n,timeZone:g}=c,M=yield s._getDataValues({field:d,valueExpression:i,normalizationField:o,normalizationType:p,normalizationTotal:y,scale:n,timeZone:g},s.items),F=(0,h.Rw)(M,{field:d,normalizationField:o,normalizationType:p,normalizationTotal:y,classificationMethod:m,standardDeviationInterval:_,minValue:t,maxValue:l,numClasses:r});return(0,h.jM)(F,m)})()}createHistogramResponse(c){var s=this;return(0,v.A)(function*(){const{field:d,valueExpression:i,normalizationField:o,normalizationType:p,normalizationTotal:y,classificationMethod:m,standardDeviationInterval:_,minValue:t,maxValue:l,numBins:r,scale:n,timeZone:g}=c,M=yield s._getDataValues({field:d,valueExpression:i,normalizationField:o,normalizationType:p,normalizationTotal:y,scale:n,timeZone:g},s.items);return(0,h.$y)(M,{field:d,normalizationField:o,normalizationType:p,normalizationTotal:y,classificationMethod:m,standardDeviationInterval:_,minValue:t,maxValue:l,numBins:r})})()}_sortFeatures(c,s,d){if(c.length>1&&s?.length)for(const i of s.slice().reverse()){const o=i.split(" "),p=o[0],y=this.fieldsIndex.get(p),m=!!o[1]&&"desc"===o[1].toLowerCase(),_=(0,h.FM)(y?.type,m);c.sort((t,l)=>{const r=d(t,p,y),n=d(l,p,y);return _(r,n)})}}_createFeatureQueryResponse(c){const{items:s,geometryType:d,hasM:i,hasZ:o,objectIdField:p,spatialReference:y}=this,{outFields:m,outSR:_,quantizationParameters:t,resultRecordCount:l,resultOffset:r,returnZ:n,returnM:g}=c,M=null!=l&&s.length>(r||0)+l,F=m&&(m.includes("*")?[...this.fieldsIndex.fields]:m.map(I=>this.fieldsIndex.get(I)));return{exceededTransferLimit:M,features:this._createFeatures(c,s),fields:F,geometryType:d,hasM:i&&g,hasZ:o&&n,objectIdFieldName:p,spatialReference:(0,B.ag)(_||y),transform:t&&(0,k.VV)(t)||null}}_createFeatures(c,s){const d=new T(c,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:o}=this,{orderByFields:p,quantizationParameters:y,returnGeometry:m,returnCentroid:_,maxAllowableOffset:t,resultOffset:l,resultRecordCount:r,returnZ:n=!1,returnM:g=!1}=c,M=o&&n,F=i&&g;let I=[],L=0;const J=[...s];if(this._sortFeatures(J,p,(Z,w,V)=>d.getFieldValue(Z,w,V)),this.geometryType&&(m||_)){const Z=(0,k.VV)(y)??void 0,w="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(m&&!_)for(const V of J){const ee=this.featureAdapter.getGeometry(V),$={attributes:d.getAttributes(V),geometry:(0,B.pL)(this.geometryType,this.hasZ,this.hasM,ee,t,Z,M,F)};w&&ee&&!$.geometry&&($.centroid=(0,B.LQ)(this,this.featureAdapter.getCentroid(V,this),Z)),I[L++]=$}else if(!m&&_)for(const V of J)I[L++]={attributes:d.getAttributes(V),centroid:(0,B.LQ)(this,this.featureAdapter.getCentroid(V,this),Z)};else for(const V of J)I[L++]={attributes:d.getAttributes(V),centroid:(0,B.LQ)(this,this.featureAdapter.getCentroid(V,this),Z),geometry:(0,B.pL)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(V),t,Z,M,F)}}else for(const Z of J){const w=d.getAttributes(Z);w&&(I[L++]={attributes:w})}const K=l||0;return null!=r&&(I=I.slice(K,Math.min(I.length,K+r))),I}_createExceedsLimitQueryResponse(){let c=!1,s=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(const o of this.query.outStatistics??[])if("exceedslimit"===o.statisticType){s=null!=o.maxPointCount?o.maxPointCount:Number.POSITIVE_INFINITY,d=null!=o.maxRecordCount?o.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=o.maxVertexCount?o.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)c=this.items.length>s;else if(this.items.length>d)c=!0;else{const o=ie(this.hasZ,this.hasM),p=this.featureAdapter;c=this.items.reduce((y,m)=>{const _=p.getGeometry(m);return y+(null!=_&&_.coords.length||0)},0)/o>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(c)}}]}}_createStatisticsQueryResponse(c,s,d={attributes:{}}){var i=this;return(0,v.A)(function*(){const o=[],p=new Map,y=new Map,m=new Map,_=new Map,t=new T(c,i.featureAdapter,i.fieldsIndex),l=c.outStatistics,{groupByFieldsForStatistics:r,having:n,orderByFields:g,resultRecordCount:M}=c,F=r?.length,I=!!F,L=I?r[0]:null,J=I&&!i.fieldsIndex.get(L);for(const Z of l??[]){const{outStatisticFieldName:w,statisticType:V}=Z,ee=Z,$="exceedslimit"!==V?Z.onStatisticField:void 0,Y="percentile_disc"===V||"percentile_cont"===V,oe="EnvelopeAggregate"===V||"CentroidAggregate"===V||"ConvexHullAggregate"===V,se=I&&1===F&&($===L||J)&&"count"===V;if(I){if(!m.has($)){const he=[];for(const pe of r){const me=i._getAttributeValues(t,pe,s,p);he.push(me)}m.set($,i._calculateUniqueValues(he,s,!oe&&t.returnDistinctValues))}const re=m.get($);if(!re)continue;const ce=Object.keys(re);for(const he of ce){const{count:pe,data:me,items:_e,itemPositions:ge}=re[he],ve=me.join(",");if(!n||t.validateItems(_e,n)){const fe=_.get(ve)||{attributes:{}};if(oe){fe.aggregateGeometries||(fe.aggregateGeometries={});const{aggregateGeometries:de,outStatisticFieldName:ye}=yield i._getAggregateGeometry(ee,_e);fe.aggregateGeometries[ye]=de}else{let de=null;if(se)de=pe;else{const ye=i._getAttributeValues(t,$,s,p),xe=ge.map(Ae=>ye[Ae]);de=Y&&"statisticParameters"in ee?i._getPercentileValue(ee,xe):i._getStatisticValue(ee,xe,null,t.returnDistinctValues)}fe.attributes[w]=de}let Ee=0;r.forEach((de,ye)=>fe.attributes[i.fieldsIndex.get(de)?de:"EXPR_"+ ++Ee]=me[ye]),_.set(ve,fe)}}}else if(oe){d.aggregateGeometries||(d.aggregateGeometries={});const{aggregateGeometries:re,outStatisticFieldName:ce}=yield i._getAggregateGeometry(ee,s);d.aggregateGeometries[ce]=re}else{const re=i._getAttributeValues(t,$,s,p);d.attributes[w]=Y&&"statisticParameters"in ee?i._getPercentileValue(ee,re):i._getStatisticValue(ee,re,y,t.returnDistinctValues)}const ue="min"!==V&&"max"!==V||!(0,x.yM)(i.fieldsIndex.get($))&&!i._isAnyDateField($)?null:i.fieldsIndex.get($)?.type;o.push({name:w,alias:w,type:ue||"esriFieldTypeDouble"})}const K=I?Array.from(_.values()):[d];return i._sortFeatures(K,g,(Z,w)=>Z.attributes[w]),M&&(K.length=Math.min(M,K.length)),{fields:o,features:K}})()}_isAnyDateField(c){const s=this.fieldsIndex.get(c);return(0,x.vE)(s)||(0,x.zD)(s)||(0,x.Ah)(s)||(0,x.OH)(s)}_getAggregateGeometry(c,s){var d=this;return(0,v.A)(function*(){const{convexHull:i,union:o}=yield Promise.all([a.e(3930),a.e(2076),a.e(5674)]).then(a.bind(a,27815)),{statisticType:p,outStatisticFieldName:y}=c,{featureAdapter:m,spatialReference:_,geometryType:t,hasZ:l,hasM:r}=d,n=s.map(F=>(0,B.pL)(t,l,r,m.getGeometry(F))),g=i(_,n,!0)[0],M={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===p){const F=g?(0,b.v)(g):(0,b.HA)(o(_,n));M.aggregateGeometries={...F,spatialReference:_},M.outStatisticFieldName=y||"extent"}else if("CentroidAggregate"===p){const F=g?(0,U.l8)(g):(0,U.Z4)((0,b.HA)(o(_,n)));M.aggregateGeometries={x:F[0],y:F[1],spatialReference:_},M.outStatisticFieldName=y||"centroid"}else"ConvexHullAggregate"===p&&(M.aggregateGeometries=g,M.outStatisticFieldName=y||"convexHull");return M})()}_getStatisticValue(c,s,d,i){const{onStatisticField:o,statisticType:p}=c;let y=null;return y=d?.has(o)?d.get(o):(0,x.yM)(this.fieldsIndex.get(o))||this._isAnyDateField(o)?(0,h.z9)({values:s,returnDistinct:i}):(0,h.G_)({values:i?[...new Set(s)]:s,minValue:null,maxValue:null,useSampleStdDev:!0}),d&&d.set(o,y),y["var"===p?"variance":p]}_getPercentileValue(c,s){const{onStatisticField:d,statisticParameters:i,statisticType:o}=c,{value:p,orderBy:y}=i,m=this.fieldsIndex.get(d);return(0,h.qg)(s,{value:p,orderBy:y,fieldType:m?.type,isDiscrete:"percentile_disc"===o})}_getAttributeValues(c,s,d,i){if(i.has(s))return i.get(s);const o=this.fieldsIndex.get(s),p=d.map(y=>c.getFieldValue(y,s,o));return i.set(s,p),p}_calculateUniqueValues(c,s,d){const i={},o=s.length;for(let p=0;p<o;p++){const y=s[p],m=[];for(const t of c)m.push(t[p]);const _=m.join(",");null==i[_]?i[_]={count:1,data:m,items:[y],itemPositions:[p]}:(d||i[_].count++,i[_].items.push(y),i[_].itemPositions.push(p))}return i}_getDataValues(c,s,d=!0){var i=this;return(0,v.A)(function*(){const o=new T(i.query,i.featureAdapter,i.fieldsIndex),{valueExpression:p,scale:y,timeZone:m}=c;return p?o.getExpressionValues(s,p,{viewingMode:"map",scale:y,spatialReference:i.query.outSR||i.spatialReference},{geometryType:i.geometryType,hasZ:i.hasZ,hasM:i.hasM},m):o.getDataValues(s,(0,j.o8)(c),d)})()}_calculateHistogramBins(c,s,d){return(0,v.A)(function*(){if(null==s.min&&null==s.max)return[];const i=s.intervals,o=s.min??0,p=s.max??0,y=i.map(([m,_])=>({minValue:m,maxValue:_,count:0,items:[]}));for(let m=0;m<c.length;m++){const _=c[m],t=d[m];if(null!=_&&_>=o&&_<=p){const l=(0,h.Ak)(i,_);l>-1&&(y[l].count++,y[l].items.push(t))}}return y})()}createQueryBinsResponse(c){var s=this;return(0,v.A)(function*(){const d=c.bin?.splitBy;if(!d)return s._createBinsResponse(c);const{value:i,outAlias:o,valueType:p}=d,y=[],m=[{name:o??i,alias:o??i,type:p??"esriFieldTypeString"},{name:S,alias:S,type:"esriFieldTypeInteger"}],_=new T(c,s.featureAdapter,s.fieldsIndex),t=new Map,l=[...s.items];s._sortFeatures(l,[i],(g,M,F)=>_.getFieldValue(g,M,F));const r=s._getAttributeValues(_,i,l,t),n=s._calculateUniqueValues([r],l,_.returnDistinctValues);for(const g in n){const{items:M}=n[g],F=yield s._createBinsResponse(c,M);if(y.push(...F.features.map(I=>({...I,attributes:{...I.attributes,[o??i]:g}}))),F.fields)for(const I of F.fields)m.some(L=>L.name===I.name)||m.push(I)}return{fields:m,features:y}})()}_createBinsResponse(c,s){var d=this;return(0,v.A)(function*(){const i=c.bin;switch(s=s??d.items,i.type){case"autoIntervalBin":return d._createAutoIntervalBinsResponse(q.A.fromJSON(i),c,s);case"dateBin":return d._createDateBinsResponse(P.A.fromJSON(i),c,s);case"fixedBoundariesBin":return d._createFixedBoundariesBinsResponse(E.A.fromJSON(i),c,s);case"fixedIntervalBin":return d._createFixedIntervalBinsResponse(O.A.fromJSON(i),c,s)}})()}_createAutoIntervalBinsResponse(c,s,d){var i=this;return(0,v.A)(function*(){const{field:o,normalizationField:p,numBins:y,normalizationType:m,normalizationTotal:_,start:t,end:l}=c,r=yield i._getDataValues({field:c.field,normalizationField:c.normalizationField,normalizationType:c.normalizationType,normalizationTotal:c.normalizationTotal,timeZone:s.outTimeReference?.ianaTimeZone},d),n=(0,h.sU)(r,{field:o,normalizationField:p,normalizationType:m,normalizationTotal:_,numBins:y,minValue:(0,z.dO)(t,!1),maxValue:(0,z.dO)(l,!1)}),g=yield i._calculateHistogramBins(r,n,d);return i._createFeaturesFromHistogramBins(g,s)})()}_createDateBinsResponse(c,s,d){var i=this;return(0,v.A)(function*(){const{field:o,interval:p,start:y,end:m}=c,_=p.unit,l=p.value*("quarters"===_?3*C.vf.months:C.vf[_])/C.vf.milliseconds,r=yield i._getDataValues({field:c.field,timeZone:s.outTimeReference?.ianaTimeZone},d),n=(0,x.OH)(i.fieldsIndex.get(o)),g=(0,h.sU)(r,{field:o,classificationMethod:"defined-interval",definedInterval:l,minValue:(0,z.dO)(y,n),maxValue:(0,z.dO)(m,n)},!0),M=yield i._calculateHistogramBins(r,g,d);return i._createFeaturesFromHistogramBins(M,s)})()}_createFixedBoundariesBinsResponse(c,s,d){var i=this;return(0,v.A)(function*(){const{field:o}=c,p=yield i._getDataValues({field:o,timeZone:s.outTimeReference?.ianaTimeZone},d),y=(0,x.OH)(i.fieldsIndex.get(o)),m=c.boundaries.map(r=>(0,z.dO)(r,y)).sort((r,n)=>r-n),_=[];for(let r=0;r<m.length-1;r++)_.push([m[r],m[r+1]]);const t={intervals:_,min:m.at(0),max:m.at(-1)},l=yield i._calculateHistogramBins(p,t,d);return i._createFeaturesFromHistogramBins(l,s)})()}_createFixedIntervalBinsResponse(c,s,d){var i=this;return(0,v.A)(function*(){const{field:o,interval:p,start:y,end:m}=c,_=yield i._getDataValues({field:c.field,normalizationField:c.normalizationField,normalizationType:c.normalizationType,normalizationTotal:c.normalizationTotal,timeZone:s.outTimeReference?.ianaTimeZone},d),t=(0,x.OH)(i.fieldsIndex.get(o)),l=(0,h.sU)(_,{field:o,classificationMethod:"defined-interval",definedInterval:p,minValue:(0,z.dO)(y,t),maxValue:(0,z.dO)(m,t)},!0),r=yield i._calculateHistogramBins(_,l,d);return i._createFeaturesFromHistogramBins(r,s)})()}_createFeaturesFromHistogramBins(c,s){var d=this;return(0,v.A)(function*(){const{upperBoundaryAlias:i,lowerBoundaryAlias:o}=s,p=o||"lowerBoundary",y=i||"upperBoundary",m=[],_=[{name:p,alias:p,type:"esriFieldTypeDouble"},{name:y,alias:y,type:"esriFieldTypeDouble"}],t=s.bin?.stackBy?.value,l=s.bin?.stackBy?.outAlias;t&&_.push({name:S,alias:S,type:"esriFieldTypeInteger"},{name:l??t,alias:l??t,type:"esriFieldTypeString"});let r=0;for(const n of c){const{minValue:g,maxValue:M,items:F}=n,I={attributes:{}};let L;if(I.attributes[p]=g,I.attributes[y]=M,t?(L=yield d._createStatisticsQueryResponse({...s,groupByFieldsForStatistics:[t],orderByFields:[t]},F),I.attributes[S]=++r,"flat"===s.bin.jsonStyle?m.push(...L.features.map(({attributes:{EXPR_1:J,...K},...Z})=>({...Z,attributes:l??J?{...K,[l??J]:J,...I.attributes}:{...K,...I.attributes}}))):(I.stackedAttributes=L.features.map(({attributes:{EXPR_1:J,...K}})=>l??J?{...K,[l??J]:J}:K),m.push(I))):(s.bin?.splitBy&&(I.attributes[S]=++r),L=yield d._createStatisticsQueryResponse(s,F,I),m.push(I)),L.fields)for(const J of L.fields)_.some(K=>K.name===J.name)||_.push(J)}return"desc"===s.binOrder&&m.reverse(),{fields:_,features:m}})()}}function Q(ne,c,s,d){const i=d.x-s.x,o=d.y-s.y,m=i*i+o*o;if(0===m)return!1;const t=Math.min(1,Math.max(0,((c.x-s.x)*i+(c.y-s.y)*o)/m));return ne.x=s.x+i*t,ne.y=s.y+o*t,!0}function ie(ne,c){return ne?c?4:3:c?3:2}class te{constructor(c,s){this.coords=c,this.coordsIndex=s}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}const ae=[1]},28693:(le,X,a)=>{function v(C,U,b){return{objectId:C,target:U,distance:b,type:"vertex"}}function j(C,U,b,k,N,H=!1){return{objectId:C,target:U,distance:b,type:"edge",start:k,end:N,draped:H}}a.d(X,{P:()=>j,k:()=>v})},71905:(le,X,a)=>{a.d(X,{MG:()=>z,SN:()=>A,SY:()=>R,VW:()=>H,Wq:()=>T,eD:()=>h,j4:()=>D,vl:()=>N});var v=a(5922),j=a(70171),C=a(38965);const U=new j.WhereClauseCache(50,500),b="unsupported-query",k=" as ",N=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),H=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),B=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...N,...H]);function x(P,E,O={}){const S=D(E,P);if(!S){const Q=U.getError(E,P);throw new v.A(b,"invalid SQL expression",{expression:E,error:Q})}const W=O.expressionName||"expression";if(O.validateStandardized&&!S.isStandardized)throw new v.A(b,`${W} is not standard`,{expression:E});if(O.validateAggregate&&!S.isAggregate)throw new v.A(b,`${W} does not contain a valid aggregate function`,{expression:E});return S.fieldNames}function A(P,E,O,S){if(!O)return!0;const W="where clause";return z(P,E,x(P,O,{validateStandardized:!0,expressionName:W}),{expressionName:W,query:S}),!0}function h(P,E,O,S,W){if(!O)return!0;const Q="having clause",ie=x(P,O,{validateAggregate:!0,expressionName:Q});if(z(P,E,ie,{expressionName:Q,query:W}),!D(O,P)?.getExpressions().every(ne=>{const{aggregateType:c,field:s}=ne,d=P.get(s)?.name;return S.some(i=>{const{onStatisticField:o,statisticType:p}=i;return P.get(o)?.name===d&&p.toLowerCase().trim()===c})}))throw new v.A(b,"expressions in having clause should also exist in outStatistics",{having:O});return!0}function D(P,E){return P?U.get(P,E):null}function T(P){return/\((.*?)\)/.test(P)?P:P.split(k)[0]}function R(P){return P.split(k)[1]}function z(P,E,O,S={}){const W=new Map;if(function G(P,E,O,S,W){const Q=W.includes("*")?[...O,...W.filter(ie=>"*"!==ie)]:W;for(const ie of Q)if(E.get(ie))q(P,E,O,S,ie);else try{const te=x(E,T(ie),{validateStandardized:!0});for(const ae of te)q(P,E,O,S,ae)}catch(te){P.set(ie,{type:"expression-error",expression:ie,error:te})}}(W,P,E,S.allowedFieldTypes??B,O),W.size)throw new v.A(b,`${S.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(W.values()),query:S.query})}function q(P,E,O,S,W){const Q=E.get(W);Q?O.has(Q.name)?"all"!==S&&!1===S?.has(Q.type)&&P.set(W,{type:"invalid-type",fieldName:Q.name,fieldType:C.m.fromJSON(Q.type),allowedFieldTypes:Array.from(S,ie=>C.m.fromJSON(ie))}):P.set(W,{type:"missing-field",fieldName:Q.name}):P.set(W,{type:"invalid-field",fieldName:W})}},98606:(le,X,a)=>{a.d(X,{B4:()=>x,FQ:()=>H,mO:()=>R});var v=a(10467),j=a(5922),C=a(71905),U=a(88840),b=a(18633),k=a(48218);const N="unsupported-query";function H(E,O){return B.apply(this,arguments)}function B(){return(B=(0,v.A)(function*(E,O){const S=E.bin;if(!S.onField&&!S.onExpression?.value||"autoIntervalBin"===S.type&&null==S.parameters.numberOfBins||"dateBin"===S.type&&(null==S.parameters.number||null==S.parameters.unit)||"fixedBoundariesBin"===S.type&&null==S.parameters.boundaries||"fixedIntervalBin"===S.type&&null==S.parameters.interval)throw new j.A(N,"Unsupported query options",{query:E});return x(E,O)})).apply(this,arguments)}function x(E,O){return A.apply(this,arguments)}function A(){return(A=(0,v.A)(function*(E,{fieldsIndex:O,geometryType:S,spatialReference:W,availableFields:Q}){if(null!=E.geometryPrecision||E.multipatchOption&&"xyFootprint"!==E.multipatchOption||E.pixelSize||E.relationParam||E.text)throw new j.A(N,"Unsupported query options",{query:E});return h(O,Q,E),function T(E,O,S){const{outStatistics:W,groupByFieldsForStatistics:Q,having:ie}=S,te=Q?.length,ae=W?.length;if(ie){if(!te||!ae)throw new j.A(N,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:S});(0,C.eD)(E,O,ie,W,S)}if(ae){if(!function P(E){return null!=E&&E.every(O=>"exceedslimit"!==O.statisticType)}(W))return;const ne=W.map(c=>c.onStatisticField).filter(Boolean);(0,C.MG)(E,O,ne,{expressionName:"onStatisticFields",query:S}),te&&(0,C.MG)(E,O,Q,{expressionName:"groupByFieldsForStatistics",query:S});for(const c of W){const{onStatisticField:s,statisticType:d}=c;if("percentile_disc"!==d&&"percentile_cont"!==d||!("statisticParameters"in c))E.get(s)&&"count"!==d&&"min"!==d&&"max"!==d&&(0,C.MG)(E,O,[s],{expressionName:`outStatistics with '${d}' statistic type`,allowedFieldTypes:D,query:S});else{const{statisticParameters:i}=c;if(!i)throw new j.A(N,"statisticParameters should be set for percentile type",{definition:c,query:S})}}}}(O,Q,E),Promise.all([(0,b.c0)(E,S,W),(0,U.Nk)(W,E.outSR)]).then(()=>E)})).apply(this,arguments)}function h(E,O,S){const{outFields:W,orderByFields:Q,returnDistinctValues:ie,outStatistics:te}=S,ae=te?te.map(ne=>ne.outStatisticFieldName&&ne.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(Q&&Q.length>0){const ne=" asc",c=" desc",s=Q.map(d=>{const i=d.toLowerCase();return i.includes(ne)?i.split(ne)[0]:i.includes(c)?i.split(c)[0]:d}).filter(d=>!ae.includes(d));(0,C.MG)(E,O,s,{expressionName:"orderByFields",query:S})}if(W&&W.length>0)(0,C.MG)(E,O,W,{expressionName:"outFields",query:S,allowedFieldTypes:"all"});else if(ie)throw new j.A(N,"outFields should be specified for returnDistinctValues",{query:S});(0,C.SN)(E,O,S.where,S)}const D=new Set([...C.vl,...C.VW]);function R(E,O,S){return z.apply(this,arguments)}function z(){return(z=(0,v.A)(function*(E,O,{fieldsIndex:S,geometryType:W,spatialReference:Q,availableFields:ie}){if(null!=E.geometryPrecision||E.multipatchOption||E.pixelSize||E.relationParam||E.text||E.outStatistics||E.groupByFieldsForStatistics||E.having||E.orderByFields)throw new j.A(N,"Unsupported query options",{query:E});return h(S,ie,E),Promise.all([G(S,ie,O,E),(0,b.c0)(E,W,Q),(0,U.Nk)(Q,E.outSR)]).then(()=>E)})).apply(this,arguments)}function G(E,O,S,W){return q.apply(this,arguments)}function q(){return(q=(0,v.A)(function*(E,O,S,W){let Q=[];if(S.valueExpression){const{arcadeUtils:ie}=yield(0,k.lw)();Q=ie.extractFieldNames(S.valueExpression)}if(S.field&&Q.push(S.field),S.field2&&Q.push(S.field2),S.field3&&Q.push(S.field3),S.normalizationField&&Q.push(S.normalizationField),!Q.length&&!S.valueExpression)throw new j.A(N,"field or valueExpression is required",{params:S});(0,C.MG)(E,O,Q,{expressionName:"statistics",query:W})})).apply(this,arguments)}},78592:(le,X,a)=>{a.d(X,{O3:()=>B,PU:()=>N,YW:()=>A,ex:()=>b,hv:()=>x,zp:()=>k});var v=a(69287),j=a(67685),C=a(53781),U=a(89141);const b=2.4;function k(h){return(0,j.PN)(h*b)}function N(h){return(0,j.Lz)(h)/b}function H(h,D,T,R){let{color:z,ratio:G}=D,{color:q,ratio:P}=T;P===G&&(1===P?G-=1e-6:P+=1e-6);const E=(0,v.qE)((R-G)/(P-G),0,1);(0,C.l)(h,z.toArray(),q.toArray(),E)}function B(h){const T=new Uint8ClampedArray(2048);if((h=h.filter(({ratio:P})=>P>=0&&P<=1).sort((P,E)=>P.ratio-E.ratio).map(({color:P,ratio:E})=>({color:P,ratio:Math.max(E,.001)}))).length<1)return T;let R=h[0],z=h[0],G=1;const q=(0,U.vt)();for(let P=0;P<512;P++){const E=(P+.5)/512;for(;E>z.ratio&&G<h.length;)R=z,z=h[G++];H(q,R,z,E),T.set(q,4*P)}return T}function x(h,D,T){const R=Math.sqrt(h**2+D**2)/T;return R>1?0:3/(Math.PI*T**2)*(1-R**2)**2}function A(h){return"function"==typeof h?h:h?D=>+D[h]:()=>1}},81930:(le,X,a)=>{a.d(X,{A:()=>D});var v=a(8189),j=a(89221),C=a(85211),U=a(55739),N=(a(3248),a(40707),a(15463)),H=a(76576),B=a(25711),x=a(68470);function A(T,R,z){(0,j.sM)(z,T instanceof Date?T.getTime():T,R)}let h=class extends((0,x.K)(B.A)){constructor(T){super(T),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}};(0,v._)([(0,C.MZ)({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],h.prototype,"numBins",void 0),(0,v._)([(0,C.MZ)({json:{name:"parameters.end",write:{writer:A}}})],h.prototype,"end",void 0),(0,v._)([(0,C.MZ)({json:{name:"parameters.start",write:{writer:A}}})],h.prototype,"start",void 0),(0,v._)([(0,N.e)({autoIntervalBin:"auto-interval"},{readOnly:!0})],h.prototype,"type",void 0),h=(0,v._)([(0,H.$)("esri.rest.support.AutoIntervalBinParameters")],h);const D=h;h.from=(0,U.dp)(h)},25711:(le,X,a)=>{a.d(X,{A:()=>q});var v=a(8189),j=a(90660),C=a(49976),U=a(71065),b=a(85211),B=(a(3248),a(35150),a(40707),a(15463)),x=a(76576),A=a(55739);const h=new C.J({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let D=class extends(j.A.ClonableMixin(U.A)){constructor(P){super(P),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};(0,v._)([(0,b.MZ)({type:String,json:{name:"outAlias",write:!0}})],D.prototype,"alias",void 0),(0,v._)([(0,b.MZ)({type:String})],D.prototype,"responseType",void 0),(0,v._)([(0,b.MZ)({type:String,json:{write:!0}})],D.prototype,"type",void 0),(0,v._)([(0,b.MZ)({type:String,json:{write:!0}})],D.prototype,"value",void 0),(0,v._)([(0,B.e)(h)],D.prototype,"valueType",void 0),D=(0,v._)([(0,x.$)("esri.rest.support.AttributeBinsGrouping")],D);const T=D;D.from=(0,A.dp)(D);const R=new C.J({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),z=new C.J({naturalLog:"natural-log",squareRoot:"square-root"});let G=class extends(j.A.ClonableMixin(U.A)){constructor(P){super(P),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}};(0,v._)([(0,b.MZ)({type:String,json:{name:"onExpression.value",write:!0}})],G.prototype,"expression",void 0),(0,v._)([(0,B.e)(R,{name:"onExpression.valueType"})],G.prototype,"expressionValueType",void 0),(0,v._)([(0,b.MZ)({type:String,json:{name:"onField",write:!0}})],G.prototype,"field",void 0),(0,v._)([(0,b.MZ)({type:String,json:{write:!0}})],G.prototype,"firstDayOfWeek",void 0),(0,v._)([(0,b.MZ)({type:String,json:{write:!0}})],G.prototype,"hideUpperBound",void 0),(0,v._)([(0,b.MZ)({type:T,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],G.prototype,"splitBy",void 0),(0,v._)([(0,b.MZ)({type:T,json:{write:{target:{stackBy:{type:T},jsonStyle:{type:String}},writer:(P,E)=>{P&&(E.stackBy=P.toJSON(),null!=P.responseType&&(E.jsonStyle=P.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(P,E)=>T.fromJSON({...E.stackBy,responseType:E.jsonStyle})}}})],G.prototype,"stackBy",void 0),(0,v._)([(0,B.e)(z)],G.prototype,"transformation",void 0),G=(0,v._)([(0,x.$)("esri.rest.support.BinParametersBase")],G);const q=G},58326:(le,X,a)=>{a.d(X,{A:()=>P});var v=a(8189),j=a(89221),C=a(85211),U=a(55739),N=(a(3248),a(40707),a(15463)),H=a(76576),B=a(25711),x=a(90660),A=a(49976),h=a(71065);const D=(0,A.O)()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});let T=class extends(x.A.ClonableMixin(h.A)){constructor(E){super(E),this.value=null,this.unit=null}};(0,v._)([(0,C.MZ)({type:Number,json:{name:"number",write:!0}})],T.prototype,"value",void 0),(0,v._)([(0,N.e)(D)],T.prototype,"unit",void 0),T=(0,v._)([(0,H.$)("esri.rest.support.DateBinTimeInterval")],T);const R=T;function z(E,O,S){(0,j.sM)(S,"string"==typeof E?E:E?.getTime(),O)}function G(E,O){const S=E.parameters[O];return S?"string"==typeof S?S:new Date(S):null}T.from=(0,U.dp)(T);let q=class extends B.A{constructor(E){super(E),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=null,this.start=null,this.snapToData=null,this.type="date"}};(0,v._)([(0,C.MZ)({cast:E=>null!=E?"string"==typeof E?E:new Date(E):null,json:{name:"parameters.end",read:{reader:(E,O)=>G(O,"end")},write:{writer:z}}})],q.prototype,"end",void 0),(0,v._)([(0,C.MZ)({type:R,json:{name:"parameters",write:!0}})],q.prototype,"interval",void 0),(0,v._)([(0,C.MZ)({type:R,json:{name:"parameters.offset",write:!0}})],q.prototype,"offset",void 0),(0,v._)([(0,C.MZ)({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],q.prototype,"returnFullIntervalBin",void 0),(0,v._)([(0,C.MZ)({cast:E=>null!=E?"string"==typeof E?E:new Date(E):null,json:{name:"parameters.start",read:{reader:(E,O)=>G(O,"start")},write:{writer:z}}})],q.prototype,"start",void 0),(0,v._)([(0,C.MZ)({type:String,json:{name:"parameters.snapToData",write:!0}})],q.prototype,"snapToData",void 0),(0,v._)([(0,N.e)({dateBin:"date"},{readOnly:!0})],q.prototype,"type",void 0),q=(0,v._)([(0,H.$)("esri.rest.support.DateBinParameters")],q);const P=q;q.from=(0,U.dp)(q)},95568:(le,X,a)=>{a.d(X,{A:()=>D});var v=a(8189),j=a(89221),C=a(85211),U=a(55739),N=(a(3248),a(40707),a(15463)),H=a(76576),B=a(25711);let h=class extends B.A{constructor(T){super(T),this.boundaries=[],this.type="fixed-boundaries"}};(0,v._)([(0,C.MZ)({json:{name:"parameters.boundaries",write:{writer:function A(T,R,z){(0,j.sM)(z,T&&function x(T){return T[0]instanceof Date}(T)?T.map(G=>G.getTime()):T,R)}}}})],h.prototype,"boundaries",void 0),(0,v._)([(0,N.e)({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],h.prototype,"type",void 0),h=(0,v._)([(0,H.$)("esri.rest.support.FixedBoundariesBinParameters")],h);const D=h;h.from=(0,U.dp)(h)},45005:(le,X,a)=>{a.d(X,{A:()=>D});var v=a(8189),j=a(89221),C=a(85211),U=a(55739),N=(a(3248),a(40707),a(15463)),H=a(76576),B=a(25711),x=a(68470);function A(T,R,z){(0,j.sM)(z,T instanceof Date?T.getTime():T,R)}let h=class extends((0,x.K)(B.A)){constructor(T){super(T),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}};(0,v._)([(0,C.MZ)({json:{name:"parameters.end",write:{writer:A}}})],h.prototype,"end",void 0),(0,v._)([(0,C.MZ)({type:Number,json:{name:"parameters.interval",write:!0}})],h.prototype,"interval",void 0),(0,v._)([(0,C.MZ)({json:{name:"parameters.start",write:{writer:A}}})],h.prototype,"start",void 0),(0,v._)([(0,N.e)({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],h.prototype,"type",void 0),h=(0,v._)([(0,H.$)("esri.rest.support.FixedIntervalBinParameters")],h);const D=h;h.from=(0,U.dp)(h)},68470:(le,X,a)=>{a.d(X,{K:()=>h,Q:()=>B});var v=a(8189),j=a(49976),C=a(35150),U=a(85211),N=(a(3248),a(40707),a(15463)),H=a(76576);const B=(0,j.O)()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),x="percent-of-total",A="field",h=D=>{let T=class extends D{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let R=this._get("normalizationType");const z=!!this.normalizationField,G=null!=this.normalizationTotal;return z||G?(R=z&&A||G&&x||null,z&&G&&C.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):R!==A&&R!==x||(R=null),R}set normalizationType(R){this._set("normalizationType",R)}};return(0,v._)([(0,U.MZ)({type:String,json:{name:"parameters.normalizationField",write:!0}})],T.prototype,"normalizationField",void 0),(0,v._)([(0,U.MZ)({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],T.prototype,"normalizationMaxValue",void 0),(0,v._)([(0,U.MZ)({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],T.prototype,"normalizationMinValue",void 0),(0,v._)([(0,U.MZ)({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],T.prototype,"normalizationTotal",void 0),(0,v._)([(0,N.e)(B,{name:"parameters.normalizationType"})],T.prototype,"normalizationType",null),T=(0,v._)([(0,H.$)("esri.rest.support.NormalizationBinParametersMixin")],T),T}},19093:(le,X,a)=>{a.d(X,{$r:()=>G,Jc:()=>E,Lc:()=>S,MH:()=>ne,Wk:()=>ae,gV:()=>q,lX:()=>W,rb:()=>P,sf:()=>te});var v=a(10467),j=a(5922),C=a(67685),U=a(97442),b=a(1749),k=a(32034),N=a(721),H=a(58701),B=a(86300),x=a(78592),A=a(43039),h=a(59377),D=a(48218);let T=null;const R=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function G(i,o,p,y){const m=(0,H.d9)(p)?(0,H.Vp)(p):null,_=m?Math.round((m.valid[1]-m.valid[0])/o.scale[0]):null;return i.map(t=>{const l=new b.A(t.geometry);return(0,N.Gy)(o,l,l),t.geometry=m?function z(i,o,p){return i.x<0?i.x+=o:i.x>p&&(i.x-=o),i}(l,_??0,y[0]):l,t})}function q(i,o=18,p,y,m){const _=new Float64Array(y*m);o=Math.round((0,C.Lz)(o));let t=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const r=(0,x.YW)(p);for(const{geometry:n,attributes:g}of i){const{x:M,y:F}=n,I=Math.max(0,M-o),L=Math.max(0,F-o),J=Math.min(m,F+o),K=Math.min(y,M+o),Z=+r(g);for(let w=L;w<J;w++)for(let V=I;V<K;V++){const ee=w*y+V,$=(0,x.hv)(V-M,w-F,o)*Z,Y=_[ee]+=$;t=Math.min(t,Y),l=Math.max(l,Y)}}return{min:t,max:l}}function P(i){const o=R.exec(i);if(!o)return null;const{hh:p,mm:y,ss:m,ms:_}=o.groups;return Number(p)*U.vf.hours+Number(y)*U.vf.minutes+Number(m)*U.vf.seconds+Number(_||0)}function E(i,o){return O.apply(this,arguments)}function O(){return(O=(0,v.A)(function*(i,o,p=!0){if(!o)return[];const{field:y,field2:m,field3:_,fieldDelimiter:t,fieldInfos:l,timeZone:r}=i,n=y&&l?.find(Y=>Y.name.toLowerCase()===y.toLowerCase()),g=!!n&&(0,B.OH)(n),M=!!n&&(0,A.fs)(n),F=i.valueExpression,I=i.normalizationType,L=i.normalizationField,J=i.normalizationTotal,K=[],Z=i.viewInfoParams;let w=null,V=null;if(F){if(!T){const{arcadeUtils:Y}=yield(0,D.lw)();T=Y}T.hasGeometryOperations(F)&&(yield T.enableGeometryOperations()),w=T.createFunction(F),V=Z?T.getViewInfo({viewingMode:Z.viewingMode,scale:Z.scale,spatialReference:new k.A(Z.spatialReference)}):null}const ee=i.fieldInfos,$=o[0]&&"declaredClass"in o[0]&&"esri.Graphic"===o[0].declaredClass||!ee?null:{fields:ee};return o.forEach(Y=>{const oe=Y.attributes;let se;if(F){const ue=$?{...Y,layer:$}:Y,re=T.createExecContext(ue,V,r);se=T.executeFunction(w,re)}else oe&&(se=oe[y],m?(se=`${(0,h.gJ)(se)}${t}${(0,h.gJ)(oe[m])}`,_&&(se=`${se}${t}${(0,h.gJ)(oe[_])}`)):"string"==typeof se&&p&&(M?se=se?new Date(se).getTime():null:g&&(se=se?P(se):null)));if(I&&"number"==typeof se&&isFinite(se)){const ue=oe&&parseFloat(oe[L]);se=(0,h.zS)(se,I,ue,J)}K.push(se)}),K})).apply(this,arguments)}function S(i){const p=i.normalizationType;let m;return"field"===p?m="(NOT "+i.normalizationField+" = 0)":"log"!==p&&"natural-log"!==p&&"square-root"!==p||(m=`(${i.field} > 0)`),m}function W(i,o,p){const y=null!=o?i+" >= "+o:"",m=null!=p?i+" <= "+p:"";let _="";return _=y&&m?te(y,m):y||m,_?"("+_+")":""}function te(i,o){let p=i??"";return null!=o&&o&&(p=p?"("+p+") AND ("+o+")":o),p}function ae(i,o){if(i&&"intersects"!==i.spatialRelationship)return new j.A(o,"Only 'intersects' spatialRelationship is supported for featureFilter")}function ne(i,o,p){const y=function c(i){const o=i.layer;return i.fields.filter(p=>!o.getField(p))}({layer:i,fields:o});if(y.length)return new j.A(p,"Unknown fields: "+y.join(", ")+". You can only use fields defined in the layer schema");const m=function s(i){const o=i.layer;return i.fields.filter(p=>{const y=o.getFieldUsageInfo(p);return!y||!y.supportsStatistics})}({layer:i,fields:o});return m.length?new j.A(p,"Unsupported fields: "+m.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0}},43039:(le,X,a)=>{a.d(X,{EG:()=>q,Ll:()=>ne,R3:()=>ae,UH:()=>H,aM:()=>W,fs:()=>G,i0:()=>c});var v=a(10467),j=a(48266),C=a(86300),U=a(48218),k=(a(71470),a(20543)),N=a(22639);const H=",",D={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},T=new Set(["integer","small-integer"]);let R=null;function G(s){return(0,C.vE)(s)||(0,C.zD)(s)||(0,C.Ah)(s)}function q(s){return P.apply(this,arguments)}function P(){return(P=(0,v.A)(function*(s){const{field:d,field2:i,field3:o,normalizationField:p,valueExpression:y}=s;let m=[];if(y){if(!R){const{arcadeUtils:_}=yield(0,U.lw)();R=_}m=R.extractFieldNames(y)}return d&&m.push(d),i&&m.push(i),o&&m.push(o),p&&m.push(p),m})).apply(this,arguments)}function O(s){return String(s).padStart(2,"0")}function S(s,d,i){let o;return"date"===d||"number"===d?("number"===d&&(s=new Date(s)),o=`TIMESTAMP'${i?s.getFullYear():s.getUTCFullYear()}-${O((i?s.getMonth():s.getUTCMonth())+1)}-${O(i?s.getDate():s.getUTCDate())} ${O(i?s.getHours():s.getUTCHours())}:${O(i?s.getMinutes():s.getUTCMinutes())}:${O(i?s.getSeconds():s.getUTCSeconds())}'`):o=s,o}function W(s,d,i,o){const{hasQueryEngine:p}=s,y=`(${S(i,Q(s,i),p)} - ${S(d,Q(s,d),p)})`;let m=D[o],_="/";return m<1&&(m=1/m,_="*"),{sqlExpression:1===m?y:`(${y} ${_} ${m})`,sqlWhere:null}}function Q(s,d){if(d instanceof Date)return"date";if("number"==typeof d)return"number";if("string"==typeof d){const i=s.getField(d);if("<now>"===d.toLowerCase())return;if((0,C.vE)(i))return"field"}}function ae(s,d){const i=d&&s.getField(d);return!!i&&T.has(i.type)}function ne(s){return`cast(${s} as float)`}function c(s,d){const{format:i,timeZoneOptions:o,fieldType:p}=d??{};let y,m;if(o&&({timeZone:y,timeZoneName:m}=(0,N.hv)(o.layerTimeZone,o.datesInUnknownTimezone,o.viewTimeZone,(0,j.J2)(i||"short-date-short-time"),p)),"string"==typeof s&&isNaN(Date.parse("time-only"===p?`1970-01-01T${s}Z`:s)))return s;switch(p){case"date-only":{const _=(0,j.J2)(i||"short-date");return"string"==typeof s?(0,j.iS)(s,{..._}):(0,j.Yq)(s,{..._,timeZone:k.n$})}case"time-only":{const _=(0,j.J2)(i||"short-time");return"string"==typeof s?(0,j.F8)(s,_):(0,j.Yq)(s,{..._,timeZone:k.n$})}case"timestamp-offset":{if(!y&&"string"==typeof s&&new Date(s).toISOString()!==s)return s;const _=i||o?(0,j.J2)(i||"short-date-short-time"):void 0,t=_?{..._,timeZone:y,timeZoneName:m}:void 0;return"string"==typeof s?(0,j.Ey)(s,t):(0,j.Yq)(s,t)}default:{const _=i||o?(0,j.J2)(i||"short-date-short-time"):void 0;return(0,j.Yq)("string"==typeof s?new Date(s):s,_?{..._,timeZone:y,timeZoneName:m}:void 0)}}}}}]);