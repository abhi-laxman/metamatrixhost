"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[6598],{85791:(x,I,o)=>{o.d(I,{A:()=>c});var u=o(10467),l=o(8189),T=o(98877),y=o(89447),v=o(31178),d=o(85211),E=(o(3248),o(35150),o(40707),o(76576)),f=o(86300),h=o(48218);let r=class extends T.A{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,y.UT)(()=>(0,h.lw)()):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??o.e(3958).then(o.bind(o,93958)).then(e=>this._featureUtils=e)}get calculatedExpressions(){const e=new v.A;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const t of this.expressionsUsedInTitle??[])e.push({name:t.name,invalid:!0});return e}for(const t of this.expressionsUsedInTitle)try{const i=this._arcadeTask.value.arcade.parseScript(t.expression,["$layer","$map","$datastore"]);if(i.isAsync){e.push({name:t.name,invalid:!0});break}e.push({name:t.name,syntax:i,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(i,{vars:{$feature:"any"}})})}catch{e.push({name:t.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??"";return"string"!=typeof e?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter(t=>e.includes(`{expression/${t.name.toLowerCase()}}`))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some(e=>!0===e.invalid)}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const i of this.calculatedExpressions?.toArray()??[])try{const a=this._arcadeTask.value.arcade.extractFieldLiterals(i.syntax);for(const _ of a){const p=_.split("."),m=this.fieldsIndex.get(p.at(-1)??"");m&&e.add(m.name)}}catch{}const t=this._extractFieldNames(this.workingTitle);for(const i of t){const a=this.fieldsIndex.get(i);a&&e.add(a.name)}return e}get titleFromDisplayField(){let e="";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??""),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??""),e?`{${e}}`:""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===e||null==e||this.hasBadExpressions||"string"!=typeof e?this.titleFromDisplayField:e}getTitle(e,t,i){var a=this;return(0,u.A)(function*(){try{const{attributes:_}=t,p=i?.timeZone??"system",[{substituteFieldsInLinksAndAttributes:m}]=yield Promise.all([a.featureUtilsPromise,a._arcadeTask?.promise]);if(i.fetchMissingFields&&(t=yield a._checkAndReQueryGraphic(e,t)),a.workingTitle&&a.fieldInfoMap){const M=a._createFormattedAttributes(e,t,p).global;return m({attributes:_,expressionAttributes:null,fieldInfoMap:a.fieldInfoMap,globalAttributes:M,layer:e,text:a.workingTitle})}return""}catch{}return""})()}_checkAndReQueryGraphic(e,t){var i=this;return(0,u.A)(function*(){const a=t.getObjectId();if(null==a)return t;if(!(0,f.Kl)(i.requiredFields,t)){const _=e.createQuery();_.where="1=1",_.outFields=[...i.requiredFields],_.objectIds=[a];const p=yield e.queryFeatures(_);if(1===p?.features.length)return p.features[0]}return t})()}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const i of e){if(!i.fieldName)continue;const a=this.fieldsIndex.get(i.fieldName),_=a?.name??i.fieldName;i.fieldName=_,t.set(_.toLowerCase(),i)}return t}_createFormattedAttributes(e,t,i="system"){const a=this.effectivePopupTemplate?.fieldInfos??[],_={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const m=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const M of this.calculatedExpressions)try{_[`expression/${M.name}`]=M.func({vars:{$feature:m}})}catch{}}const p={...t.attributes,..._};return{global:this._featureUtils.formatAttributes({fieldInfos:a,attributes:p,graphic:t,timeZone:i,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return(0,f.nw)(e).filter(t=>!(0===t.indexOf("relationships/")||0===t.indexOf("expression/")))}};(0,l._)([(0,d.MZ)({readOnly:!0})],r.prototype,"_arcadeTask",null),(0,l._)([(0,d.MZ)()],r.prototype,"_featureUtils",void 0),(0,l._)([(0,d.MZ)({readOnly:!0})],r.prototype,"featureUtilsPromise",null),(0,l._)([(0,d.MZ)({readOnly:!0})],r.prototype,"calculatedExpressions",null),(0,l._)([(0,d.MZ)()],r.prototype,"displayField",void 0),(0,l._)([(0,d.MZ)()],r.prototype,"effectivePopupTemplate",void 0),(0,l._)([(0,d.MZ)()],r.prototype,"expressionsUsedInTitle",null),(0,l._)([(0,d.MZ)()],r.prototype,"fieldsIndex",void 0),(0,l._)([(0,d.MZ)()],r.prototype,"fieldInfoMap",null),(0,l._)([(0,d.MZ)()],r.prototype,"fields",void 0),(0,l._)([(0,d.MZ)()],r.prototype,"objectIdField",void 0),(0,l._)([(0,d.MZ)()],r.prototype,"requiredFields",null),r=(0,l._)([(0,E.$)("esri.layers.support.TitleCreator")],r);const c=r},27960:(x,I,o)=>{o.d(I,{Ch:()=>v,mW:()=>T,u2:()=>y});var u=o(69287),l=o(63484);function T(s,n){return{...n,filterMode:s.mode}}function y(s,n){return P(s,n).next().value??null}function v(s,n,r){const c=function d(s){if("manual"===E(s))return null;const n=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:r,maxScale:c}of s.filters)n[0]=Math.max(n[0],f(r)),n[1]=Math.min(n[1],h(c));return n}(s);if(c&&((0,u.gg)(n,c[0])||(0,u.ZH)(r,c[1])))return"";const e=Array.from(P(s,n,r)),t=function g(s,n,r){if(0===s.length)return!0;const c=f(s.at(0)?.minScale),e=h(s.at(-1)?.maxScale);if((0,u.ZH)(c,n)||(0,u.gg)(e,r))return!0;for(let t=0;t<s.length-1;t++){const i=s[t];if((0,u.ZH)(f(s[t+1].minScale),h(i.maxScale)))return!0}return!1}(e,n,r)?"1=1":e.map(i=>i.where||"1=1").reduce((i,a)=>(0,l.IW)(i,a),"");return t&&"1=1"!==t?t:""}function*P(s,n,r){if("manual"===E(s)){const c=s.filters.find(e=>e.id===s.activeFilterId);c&&(yield c)}else{"object"==typeof n&&(n=n.scale);for(const c of s.filters)A(c.minScale,c.maxScale,n,r)&&(yield c)}}function A(s,n,r,c){return s=f(s),r=f(r),n=h(n),!(!(0,u.Sp)(r,s)&&(c??r)>s||(0,u.Hx)(n,r)||void 0!==c&&(0,u.Sp)(c,s))}function E(s){return"mode"in s?s.mode:s.filterMode}function f(s){return s||Number.POSITIVE_INFINITY}function h(s){return s||0}},71655:(x,I,o)=>{var u,l;o.d(I,{X:()=>u}),(l=u||(u={}))[l.SAVE=0]="SAVE",l[l.SAVE_AS=1]="SAVE_AS"}}]);