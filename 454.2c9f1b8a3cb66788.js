"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[454],{76582:(j,w,i)=>{i.d(w,{LG:()=>I,mb:()=>D,yr:()=>b});var R=i(10467),m=i(56492),_=i(31610),x=i(12273),a=i(88532),t=i(63888),C=i(28399),W=i(50915),U=i(76169),O=i(4931);function I(v){return v&&"render"in v}function b(v){const l=document.createElement("canvas");return l.width=v.width,l.height=v.height,v.render(l.getContext("2d")),l}class D extends t.q{constructor(l=null,p=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._texture=null,this._width=void 0,this.x=0,this.y=0,this.immutable=p,this.source=l,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(l){this._height=l}get source(){return this._source}set source(l){null==l&&null==this._source||(this._source=l,this.invalidateTexture(),this.requestRender())}get texture(){return this._texture}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(l){this._width=l}beforeRender(l){super.beforeRender(l),this.updateTexture(l)}setSourceAsync(l,p){var e=this;return(0,R.A)(function*(){null!=e._uploadStatus&&e._uploadStatus.controller.abort();const o=new AbortController,n=(0,m.Tw)();return(0,m.NY)(p,()=>o.abort()),(0,m.NY)(o,h=>n.reject(h)),e._uploadStatus={controller:o,resolver:n},e.source=l,n.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}transitionStep(l,p){l>=64&&(this.fadeTransitionEnabled=!1),super.transitionStep(l,p)}setTransform(l){const p=(0,_.D_)(this.transforms.displayViewScreenMat3),[e,o]=l.toScreenNoRotation([0,0],[this.x,this.y]),n=this.resolution/this.pixelRatio/l.resolution,h=n*this.width,g=n*this.height,y=Math.PI*this.rotation/180;(0,_.Tl)(p,p,(0,a.fA)(e,o)),(0,_.Tl)(p,p,(0,a.fA)(h/2,g/2)),(0,_.e$)(p,p,-y),(0,_.Tl)(p,p,(0,a.fA)(-h/2,-g/2)),(0,_.Oe)(p,p,(0,a.fA)(h,g)),(0,_.lw)(this.transforms.displayViewScreenMat3,l.displayViewMat3,p)}setSamplingProfile(l){this._texture&&(l.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(l.samplingMode))}bind(l,p){this._texture&&l.bindTexture(this._texture,p)}updateTexture({context:l,painter:p}){var e=this;return(0,R.A)(function*(){if(!e._textureInvalidated)return;if(e._textureInvalidated=!1,e._texture||(e._texture=e._createTexture(l)),!e.source)return void e._texture.setData(null);e._texture.resize(e._sourceWidth,e._sourceHeight);const o=function B(v){return I(v)?v instanceof C.A?v.getRenderedRasterPixels()?.renderedRasterPixels:b(v):v}(e.source);try{if(null!=e._uploadStatus){const{controller:n,resolver:h}=e._uploadStatus,g={signal:n.signal},{width:y,height:u}=e,S=e._texture;yield p.textureUploadManager.enqueueTextureUpdate({data:o,texture:S,width:y,height:u},g),h.resolve(),e._uploadStatus=null}else e._texture.setData(o);e.ready()}catch(n){(0,m.jH)(n)}})()}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,x.vt)()}}_createTexture(l){const p=this.immutable,e=new O.R;return e.internalFormat=p?W.H0.RGBA8:W.Ab.RGBA,e.wrapMode=W.pF.CLAMP_TO_EDGE,e.isImmutable=p,e.width=this._sourceWidth,e.height=this._sourceHeight,new U.g(l,e)}}},72663:(j,w,i)=>{i.d(w,{l:()=>x});var R=i(69473),m=i(54382),_=i(34531);class x extends m.A{constructor(){super(...arguments),this._hasCrossfade=!1,this._bitmapTechnique=null}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(t){super.beforeRender(t),this._manageFade()}onAttach(){super.onAttach(),this._bitmapTechnique=new _.C}onDetach(){super.onDetach(),this._bitmapTechnique?.shutdown(),this._bitmapTechnique=null}renderChildren(t){super.renderChildren(t),this.visible&&t.drawPhase===R.S5.MAP&&null!=this._bitmapTechnique&&this._bitmapTechnique.render(t,{bitmaps:this.children})}_manageFade(){this.children.reduce((t,C)=>t+(C.inFadeTransition?1:0),0)>=2?(this.children.forEach(t=>t.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(t=>t.blendFunction="standard"),this._hasCrossfade=!1)}}},28399:(j,w,i)=>{i.d(w,{A:()=>R});class R{constructor(_,x,a){this.pixelBlock=_,this.extent=x,this.originalPixelBlock=a}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(_){const x=this.pixelBlock;if(null==x)return;const a=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??x});if(null==a.pixelBlock)return;a.pixelBlock.maskIsAlpha&&(a.pixelBlock.premultiplyAlpha=!0);const t=a.pixelBlock.getAsRGBA(),C=_.createImageData(a.pixelBlock.width,a.pixelBlock.height);C.data.set(t),_.putImageData(C,0,0)}getRenderedRasterPixels(){const _=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==_.pixelBlock?null:(_.pixelBlock.maskIsAlpha&&(_.pixelBlock.premultiplyAlpha=!0),{width:_.pixelBlock.width,height:_.pixelBlock.height,renderedRasterPixels:new Uint8Array(_.pixelBlock.getAsRGBA().buffer)})}}},34531:(j,w,i)=>{i.d(w,{C:()=>p});var R=i(47669),m=i(14089),_=i(8137),x=i(8189),a=i(84035),t=i(3902);function W(e){const o=function C(e){const o=new t.nt(.16666666666666666),n=e.multiply(e),h=n.multiply(e),g=o.multiply(h.multiply(-1).add(new t.nt(3).multiply(n)).subtract(new t.nt(3).multiply(e)).add(1)),y=o.multiply(h.multiply(3).subtract(n.multiply(6)).add(4)),u=o.multiply(h.multiply(-3).add(n.multiply(3)).add(e.multiply(3)).add(1)),S=o.multiply(h);return new t.Zb(g,y,u,S)}(e),n=o.x.add(o.y),h=o.z.add(o.w),g=new t.nt(1).subtract(o.y.divide(n)).add(e),y=new t.nt(1).add(o.w.divide(h)).subtract(e);return new t.Zb(g,y,n,h)}class O extends a.ZA{}(0,x._)([(0,a.C5)(0,t.ZY)],O.prototype,"position",void 0);class b extends a.k2{}(0,x._)([(0,a.Pi)(t.z7)],b.prototype,"texture",void 0),(0,x._)([(0,a.Pi)(t.U)],b.prototype,"dvsMat3",void 0),(0,x._)([(0,a.Pi)(t.ZY)],b.prototype,"coordScale",void 0),(0,x._)([(0,a.Pi)(t.nt)],b.prototype,"opacity",void 0);class B extends a.A{constructor(){super(...arguments),this.type="BitmapShader"}vertex(o){const n=this.config.dvsMat3.multiply(new t.eB(o.position.multiply(this.config.coordScale),1));return{glPosition:new t.Zb(n,1),texcoord:o.position}}fragment(o){const n=new a.mm;let h;return h=this.bicubic?function U(e,o,n){const h=new t.ZY(new t.nt(1).divide(n.x),0),g=new t.ZY(0,new t.nt(1).divide(n.y)),y=o.multiply(n).subtract(.5),u=W((0,t.jc)(y).x).xyz,S=W((0,t.jc)(y).y).xyz;let d=o.add(u.x.multiply(h)),r=o.subtract(u.y.multiply(h));const P=d.add(S.x.multiply(g)),f=r.add(S.x.multiply(g));d=d.subtract(S.y.multiply(g)),r=r.subtract(S.y.multiply(g));let c=(0,t.US)(e,r),s=(0,t.US)(e,d);const E=(0,t.US)(e,f),A=(0,t.US)(e,P);return c=(0,t.jh)(c,E,S.z),s=(0,t.jh)(s,A,S.z),c=(0,t.jh)(c,s,u.z),c}(this.config.texture,o.texcoord,this.config.coordScale):(0,t.US)(this.config.texture,o.texcoord),n.fragColor=new t.Zb(h.rgb.multiply(this.config.opacity),h.a.multiply(this.config.opacity)),n}}(0,x._)([(0,a.Pi)(b)],B.prototype,"config",void 0),(0,x._)([a.E8],B.prototype,"bicubic",void 0),(0,x._)([(0,x.a)(0,(0,a.hF)(O))],B.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,a.hF)(class I extends a.HS{}))],B.prototype,"fragment",null);var D=i(50915);const v={nearest:{samplingMode:D.Cj.NEAREST,mips:!1},bilinear:{samplingMode:D.Cj.LINEAR,mips:!1},bicubic:{samplingMode:D.Cj.LINEAR,mips:!1},trilinear:{samplingMode:D.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},l=(e,o,n)=>{if("dynamic"===n.samplingMode){const{state:h}=e,g=o.resolution/o.pixelRatio/h.resolution,y=Math.round(e.pixelRatio)!==e.pixelRatio;return h.rotation||g>1.05||g<.95||y||o.isSourceScaled||o.rotation?v.bilinear:v.nearest}return v[n.samplingMode]};class p extends m.j{constructor(){super(...arguments),this.name="BrushBitmap",this.type=_.N.Bitmap,this.shaders={bitmap:new B}}render(o,n){const{context:h,renderingOptions:g,painter:y}=o;for(const u of n.bitmaps){const S=u.texture;if(!u.source||!u.isReady||null==S)continue;const d=l(o,u,g);o.timeline.begin(this.name),y.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:u.stencilRef,compare:D.MT.EQUAL,op:{fail:D.eA.KEEP,zFail:D.eA.KEEP,zPass:D.eA.KEEP}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"additive"===u.blendFunction?"additive":"composite"}}),u.setSamplingProfile(d);const{coordScale:r,computedOpacity:P,transforms:f}=u;y.submitDrawMesh(h,{shader:this.shaders.bitmap,uniforms:{config:{texture:{texture:S,unit:R.YS},dvsMat3:f.displayViewScreenMat3,coordScale:r,opacity:P}},defines:{bicubic:d===v.bicubic},optionalAttributes:null,useComputeBuffer:!1},y.quadMesh),o.timeline.end(this.name)}}}},68418:(j,w,i)=>{i.d(w,{A:()=>S});var R=i(10467),m=i(8189),_=i(98877),a=(i(3248),i(56492)),t=i(85211),U=(i(35150),i(40707),i(76576)),O=i(51995),I=i(58701),b=i(11333);const B=Math.PI/180;var p=i(76582),e=i(54290),o=i(74847);const n=(0,O.vt)(),h=[0,0],g=new o.A(0,0,0,0);let u=class extends _.A{constructor(d){var r;super(d),r=this,this._imagePromise=null,this.bitmaps=[],this.hidpi=false,this.imageMaxWidth=2048,this.imageMaxHeight=2048,this.imageRotationSupported=false,this.imageNormalizationSupported=false,this.update=(0,a.sg)(function(){var P=(0,R.A)(function*(f,c){if((0,a.Te)(c),!f.stationary||r.destroyed)return;const s=f.state,E=(0,I.Vp)(s.spatialReference),A=r.hidpi?f.pixelRatio:1,M=s.worldScreenWidth>0,z=M&&r.imageNormalizationSupported&&s.worldScreenWidth<s.size[0],K=Math.round((r.imageMaxWidth??0)/A),Z=Math.round((r.imageMaxHeight??0)/A);z?(h[0]=s.worldScreenWidth,h[1]=s.size[1]):r.imageRotationSupported?(h[0]=s.size[0],h[1]=s.size[1]):function v(d,r){const P=function D(d){return d*B}(r.rotation),f=Math.abs(Math.cos(P)),c=Math.abs(Math.sin(P)),[s,E]=r.size;return d[0]=Math.round(E*c+s*f),d[1]=Math.round(E*f+s*c),d}(h,s);const V=!(Math.floor(h[0])>K||Math.floor(h[1])>Z||!r.imageNormalizationSupported&&E&&(s.extent.xmin<E.valid[0]||s.extent.xmax>E.valid[1])),Y=r.imageRotationSupported?s.rotation:0,$=r.container.children.slice();if(V)r._imagePromise=r._singleExport(s,h,z?s.paddedViewState.center:s.center,s.resolution,Y,A,c);else{let T=Math.min(K,Z);M&&(T=Math.min(s.worldScreenWidth,T),T=Math.round(s.worldScreenWidth/Math.ceil(s.worldScreenWidth/T))),r._imagePromise=r._tiledExport(s,T,A,c)}try{const T=(yield r._imagePromise)??[];(0,a.Te)(c);const F=[];if(r._imagePromise=null,r.destroyed)return;r.bitmaps=T;for(const L of $)T.includes(L)||F.push(L.fadeOut().then(()=>{L.remove(),L.destroy()}));for(const L of T)F.push(L.fadeIn());yield Promise.all(F)}catch(T){r._imagePromise=null,(0,a.QP)(T)}});return function(f,c){return P.apply(this,arguments)}}(),5e3),this.updateExports=(0,a.sg)(function(){var P=(0,R.A)(function*(f){const c=[];for(const s of r.container.children){if(!s.visible||!s.stage)return;c.push(f(s).then(()=>{s.invalidateTexture(),s.requestRender()}))}r._imagePromise=(0,a.Lx)(c).then(()=>r._imagePromise=null),yield r._imagePromise});return function(f){return P.apply(this,arguments)}}())}destroy(){this.bitmaps.forEach(d=>d.destroy()),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}_export(d,r,P,f,c,s){var E=this;return(0,R.A)(function*(){const A=yield E.fetchSource(d,Math.floor(r*c),Math.floor(P*c),{rotation:f,pixelRatio:c,signal:s});(0,a.Te)(s);const M=new p.mb(null,!0);return M.x=d.xmin,M.y=d.ymax,M.resolution=d.width/r,M.rotation=f,M.pixelRatio=c,M.opacity=0,E.container.addChild(M),yield M.setSourceAsync(A,s),(0,a.Te)(s),M})()}_singleExport(d,r,P,f,c,s,E){var A=this;return(0,R.A)(function*(){!function l(d,r,P,f){const[c,s]=r,[E,A]=f,M=.5*P;d[0]=c-M*E,d[1]=s-M*A,d[2]=c+M*E,d[3]=s+M*A}(n,P,f,r);const M=(0,O.w1)(n,d.spatialReference);return[yield A._export(M,r[0],r[1],c,s,E)]})()}_tiledExport(d,r,P,f){const c=b.A.create({size:r,spatialReference:d.spatialReference,scales:[d.scale]}),s=new e.A(c),E=s.getTileCoverage(d);if(!E)return null;const A=[];return E.forEach((M,z,K,Z)=>{g.set(M,z,K,0),s.getTileBounds(n,g);const N=(0,O.w1)(n,d.spatialReference);A.push(this._export(N,r,r,0,P,f).then(H=>(0!==Z&&(g.set(M,z,K,Z),s.getTileBounds(n,g),H.x=n[0],H.y=n[3]),H)))}),Promise.all(A)}};(0,m._)([(0,t.MZ)()],u.prototype,"_imagePromise",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"bitmaps",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"container",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"fetchSource",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"hidpi",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"imageMaxWidth",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"imageMaxHeight",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"imageRotationSupported",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"imageNormalizationSupported",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"requestUpdate",void 0),(0,m._)([(0,t.MZ)()],u.prototype,"updating",null),u=(0,m._)([(0,U.$)("esri.views.2d.layers.support.ExportStrategy")],u);const S=u},96081:(j,w,i)=>{i.d(w,{A:()=>U});var R=i(8189),m=i(35150),_=i(56492),x=i(48900),W=(i(3248),i(40707),i(5922),i(76576));const U=O=>{let I=class extends O{initialize(){this.addHandles((0,x.on)(()=>this.layer,"refresh",b=>{this.doRefresh(b.dataChanged).catch(B=>{(0,_.zf)(B)||m.A.getLogger(this).error(B)})}),"RefreshableLayerView")}};return I=(0,R._)([(0,W.$)("esri.views.layers.RefreshableLayerView")],I),I}}}]);