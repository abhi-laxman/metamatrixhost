"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[3828,1447],{13828:(re,x,o)=>{o.r(x),o.d(x,{applyEdits:()=>A,checkEditingCapabilities:()=>H,isFeatureIdentifierArrayWithGlobalId:()=>u,isFeatureIdentifierArrayWithObjectId:()=>D,isFeatureIdentifierWithGlobalId:()=>S,isFeatureIdentifierWithObjectId:()=>h,normalizeCollections:()=>q,normalizeEdits:()=>J,normalizeGeometries:()=>ee,shallowCloneFeature:()=>N,uploadAssets:()=>ne});var P=o(10467),V=o(81098),L=o(31178),d=o(5922),G=o(77806),C=o(35150),Z=o(56492),z=o(45272),$=o(43085),M=o(77098),b=o(58701),K=o(58277),g=o(86300),w=o(6829),I=o(58443);function O(e){return null!=e?.applyEdits}function h(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function D(e){return e.every(h)}function S(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function u(e){return e.every(S)}function A(e,t,n){return f.apply(this,arguments)}function f(){return f=(0,P.A)(function*(e,t,n,a={}){let i;const B=a.gdbVersion??("gdbVersion"in e?e.gdbVersion:null);(0,K.Mk)(e)&&e.url?i=(0,K.Zk)(e.url,e.layerId,B,"original-and-current-features"===a.returnServiceEditsOption):(i=(0,Z.Tw)(),i.promise.then(p=>{(p.addedFeatures.length||p.updatedFeatures.length||p.deletedFeatures.length||p.addedAttachments.length||p.updatedAttachments.length||p.deletedAttachments.length)&&e.emit("edits",p)}),e.emit("apply-edits",{result:i.promise}));try{const{results:l,edits:p}=yield function y(e,t,n,a){return v.apply(this,arguments)}(e,t,n,a),j=E=>E.filter(ae=>!ae.error).map(G.o8),X={edits:p,addedFeatures:j(l.addFeatureResults),updatedFeatures:j(l.updateFeatureResults),deletedFeatures:j(l.deleteFeatureResults),addedAttachments:j(l.addAttachmentResults),updatedAttachments:j(l.updateAttachmentResults),deletedAttachments:j(l.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:l.editMoment?new Date(l.editMoment):null,globalIdToObjectId:a.globalIdToObjectId};return l.editedFeatureResults?.length&&(X.editedFeatures=l.editedFeatureResults),i.resolve(X),l}catch(l){throw i.reject(l),l}}),f.apply(this,arguments)}function v(){return v=(0,P.A)(function*(e,t,n,a){if(yield e.load(),!O(t))throw new d.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,I.tk)(e))throw new d.A(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:i,options:m}=yield function F(e,t,n){return r.apply(this,arguments)}(e,n,a);return i.addFeatures?.length||i.updateFeatures?.length||i.deleteFeatures?.length||i.addAttachments?.length||i.updateAttachments?.length||i.deleteAttachments?.length?{edits:i,results:yield t.applyEdits(i,m)}:{edits:i,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),v.apply(this,arguments)}function r(){return r=(0,P.A)(function*(e,t,n){const a=(0,I.BR)(e),B=null!=e.infoFor3D;if(H(t,a,n,!(!t||!(t.addFeatures||t.updateFeatures||t.deleteFeatures)),!(!t||!(t.addAttachments||t.updateAttachments||t.deleteAttachments)),`${e.type}-layer`),!a.data.isVersioned&&n?.gdbVersion)throw new d.A(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!a.editing.supportsRollbackOnFailure&&n?.rollbackOnFailureEnabled)throw new d.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const l={...n};if(null!=l.rollbackOnFailureEnabled||a.editing.supportsRollbackOnFailure||(l.rollbackOnFailureEnabled=!0),l.rollbackOnFailureEnabled||"original-and-current-features"!==l.returnServiceEditsOption||(!1===l.rollbackOnFailureEnabled&&C.A.getLogger("esri.layers.graphics.editingSupport").warn(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),l.rollbackOnFailureEnabled=!0),!a.editing.supportsReturnServiceEditsInSourceSpatialReference&&l.returnServiceEditsInSourceSR)throw new d.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(l.returnServiceEditsInSourceSR&&"original-and-current-features"!==l.returnServiceEditsOption)throw new d.A(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const p=J(t,a,`${e.type}-layer`),j=n?.globalIdUsed||B,X=e.fields.filter(E=>"big-integer"===E.type||"oid"===E.type&&(E.length||0)>=8);if(j){const{globalIdField:E}=e;if(null==E)throw new d.A(`${e.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");p.addFeatures.forEach(ae=>function Y(e,t){const{attributes:n}=e;null==n[t]&&(n[t]=(0,$.yS)())}(ae,E))}return p.addFeatures.forEach(E=>function R(e,t,n,a){s(e,t,n,a),c(e,t)}(E,e,j,X)),p.updateFeatures.forEach(E=>function W(e,t,n,a){s(e,t,n,a),c(e,t);const i=(0,I.BR)(t);if("geometry"in e&&null!=e.geometry&&!i?.editing.supportsGeometryUpdate)throw new d.A(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(E,e,j,X)),p.deleteFeatures.forEach(E=>function U(e,t,n,a){s(e,t,n,a)}(E,e,j,X)),p.addAttachments.forEach(E=>k(E,e)),p.updateAttachments.forEach(E=>k(E,e)),B&&(yield function te(e,t){return Q.apply(this,arguments)}(p,e)),{edits:yield ee(p),options:l}}),r.apply(this,arguments)}function s(e,t,n,a){if(n){if("attributes"in e&&!e.attributes[t.globalIdField])throw new d.A(`${t.type}-layer:invalid-parameter`,`Feature should have '${t.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in e)&&!e.globalId)throw new d.A(`${t.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(a.length&&"attributes"in e)for(const i of a){const m=e.attributes[i.name];if(void 0!==m&&!(0,g.OG)(i,m))throw new d.A(`${t.type}-layer:invalid-parameter`,`Big-integer field '${i.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:e})}if("geometry"in e&&null!=e.geometry){if(e.geometry.hasZ&&!1===t.capabilities?.data.supportsZ)throw new d.A(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities?.data.supportsM)throw new d.A(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function c(e,t){if("geometry"in e&&"mesh"===e.geometry?.type&&null!=t.infoFor3D&&null!=t.spatialReference){const{geometry:n}=e,{spatialReference:a,vertexSpace:i}=n,m=t.spatialReference,B="local"===i.type,l=(0,b.EA)(m),p=(0,b.aI)(m,a),j=p||(0,b.oT)(m)&&((0,b.oT)(a)||(0,b.K8)(a));if(!(B&&l&&j||!B&&!l&&p))throw new d.A(`${t.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${i.type} vertex space and a spatial reference wkid:${a.wkid} to a layer with a spatial reference wkid:${m.wkid} is not supported.`)}}function k(e,t){const{feature:n,attachment:a}=e;if(!n||"attributes"in n&&!n.attributes[t.globalIdField])throw new d.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in n)&&!n.globalId)throw new d.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!a.globalId)throw new d.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!a.data&&!a.uploadId)throw new d.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(a.data instanceof File&&a.data.name||a.name))throw new d.A(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities?.editing.supportsUploadWithItemId&&a.uploadId)throw new d.A(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof a.data){const i=(0,z.r$)(a.data);if(i&&!i.isBase64)throw new d.A(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function ee(e){return _.apply(this,arguments)}function _(){return(_=(0,P.A)(function*(e){const t=e.addFeatures??[],n=e.updateFeatures??[],a=t.concat(n).map(l=>l.geometry),i=yield(0,M.el)(a),m=t.length,B=n.length;return i.slice(0,m).forEach((l,p)=>t[p].geometry=l),i.slice(m,m+B).forEach((l,p)=>n[p].geometry=l),e})).apply(this,arguments)}function q(e){return{addFeatures:Array.from(e?.addFeatures??[]),updateFeatures:Array.from(e?.updateFeatures??[]),deleteFeatures:e&&L.A.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}function J(e,t,n){const a=q(e);if(a.addFeatures?.length&&!t.operations.supportsAdd)throw new d.A(`${n}:unsupported-operation`,"Layer does not support adding features.");if(a.updateFeatures?.length&&!t.operations.supportsUpdate)throw new d.A(`${n}:unsupported-operation`,"Layer does not support updating features.");if(a.deleteFeatures?.length&&!t.operations.supportsDelete)throw new d.A(`${n}:unsupported-operation`,"Layer does not support deleting features.");return a.addFeatures=a.addFeatures.map(N),a.updateFeatures=a.updateFeatures.map(N),a.addAssetFeatures=[],a}function H(e,t,n,a,i,m){if(!e||!a&&!i)throw new d.A(`${m}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!t.editing.supportsGlobalId&&n?.globalIdUsed&&!n.usingFeatureServiceEndpoint)throw new d.A(`${m}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!t.editing.supportsGlobalId&&i)throw new d.A(`${m}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!n?.globalIdUsed&&i)throw new d.A(`${m}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function N(e){const t=new V.A;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function Q(){return(Q=(0,P.A)(function*(e,t){const{infoFor3D:n}=t;if(null==n)return;if(!(0,w.JQ)(n))throw new d.A(`${t.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");e.addAssetFeatures??=[];const{addAssetFeatures:a}=e;for(const i of e.addFeatures??[])T(i)&&a.push(i);for(const i of e.updateFeatures??[])T(i)&&a.push(i)})).apply(this,arguments)}function T(e){return"mesh"===e?.geometry?.type}function ne(e,t,n,a){if(!O(t))throw new d.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!t.uploadAssets)throw new d.A(`${e.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:e});return t.uploadAssets(n,a)}},58277:(re,x,o)=>{o.d(x,{Mk:()=>O,Zk:()=>g,w6:()=>S});var P=o(8189),V=o(42425),L=o(77806),d=o(56492),G=o(85211),z=(o(3248),o(35150),o(76576)),$=o(30448);const M=new V.A.EventEmitter;function g(u,A,f=null,y=!1){const v=(0,d.Tw)();return M.emit("apply-edits",{serviceUrl:u,layerId:A,gdbVersion:f,mayReceiveServiceEdits:y=null==A||y,result:v.promise}),v}const I=Symbol();function O(u){return null!=u&&"object"==typeof u&&I in u}function h(u){return null!=u&&"object"==typeof u&&"gdbVersion"in u}function D(u,A,f){const y=new URL(u).host,v=$.Z3.get(y),F=r=>!r||r===v;return F(A)&&F(f)||A===f}const S=u=>{var A;let f=class extends u{constructor(...y){super(...y),this[A]=!0,this._applyEditsHandler=v=>{const{serviceUrl:F,layerId:r,gdbVersion:s,mayReceiveServiceEdits:c,result:R}=v,U=F===this.url,W=null!=r&&null!=this.layerId&&r===this.layerId,k=h(this),Y=h(this)&&D(F,s,this.gdbVersion);if(!U||k&&!Y||!W&&!c)return;const ee=R.then(_=>{if(this.lastEditsEventDate=new Date,W&&(_.addedFeatures.length||_.updatedFeatures.length||_.deletedFeatures.length||_.addedAttachments.length||_.updatedAttachments.length||_.deletedAttachments.length))return this.emit("edits",(0,L.o8)(_)),_;const q=_.editedFeatures?.find(({layerId:H})=>H===this.layerId);if(q){const{adds:H,updates:N,deletes:te}=q.editedFeatures,Q={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:H?H.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],deletedFeatures:te?te.map(({attributes:T})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],updatedFeatures:N?N.map(({current:{attributes:T}})=>({objectId:this.objectIdField&&T[this.objectIdField],globalId:this.globalIdField&&T[this.globalIdField]})):[],editedFeatures:(0,L.o8)(_.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,L.o8)(_.historicMoment)};return this.emit("edits",Q),Q}const J={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,L.o8)(_.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,L.o8)(_.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(F,s,J.historicMoment)&&this.emit("edits",J),J}).then(_=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(F,s,_.historicMoment)&&(this.historicMoment=_.historicMoment),_));this.emit("apply-edits",{result:ee})},this._updateMomentHandler=v=>{const{serviceUrl:F,gdbVersion:r,moment:s}=v,c=F===this.url,R=h(this),U=h(this)&&D(F,r,this.gdbVersion),W=h(this)&&!D(F,this.gdbVersion,null);c&&R&&U&&W&&"historicMoment"in this&&this.historicMoment!==s&&(this.historicMoment=s)},this.when().then(()=>{this.addHandles(function b(u){return M.on("apply-edits",new WeakRef(u))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function K(u){return M.on("update-moment",new WeakRef(u))}(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(y,v,F){return"historicMoment"in this&&this.historicMoment!==F&&(0,$.w5)(y,v)}};return A=I,(0,P._)([(0,G.MZ)()],f.prototype,"lastEditsEventDate",void 0),f=(0,P._)([(0,z.$)("esri.layers.mixins.EditBusLayer")],f),f}},6829:(re,x,o)=>{o.d(x,{CW:()=>g,Fm:()=>z,Hz:()=>w,JQ:()=>K,JZ:()=>F,ND:()=>O,R_:()=>C,U9:()=>b,fu:()=>V,nr:()=>I,oF:()=>L,rq:()=>$,z$:()=>M});const P=[["binary","application/octet-stream","bin",""]];function V(r,s){return null!=u(s.name,r?.supportedFormats??[])}function L(r,s){if(!r)return!1;const c=$(s,r.supportedFormats??[]);return null!=c&&r.editFormats.includes(c)}function C(r,s){return A(function S(r,s){const c=r.toLowerCase();return h(s).find(R=>f(R)===c)}(r,s))}function Z(r,s){return A(u(r,s))}function z(r,s){return f(function D(r,s){return h(s).find(c=>A(c)===r)}(r,s))}function $(r,s){return Z(r.name,s)??C(r.type,s)}function M(r,s,c){return C(r,c)??Z(s,c)}function b({supportedFormats:r}){return M("model/gltf-binary","glb",r)}function K(r){const s=b(r);return null!=s&&r.editFormats.includes(s)}function g({supportedFormats:r}){return M("model/gltf+json","gltf",r)}function w(r){if(!r)return null;const s=b(r),c=g(r);let R=null;for(const U of r.queryFormats){if(U===s)return U;U===c&&(R=U)}return R}function I({supportedFormats:r}){return M("application/esri3do-SR_world","wld",r)}function O({supportedFormats:r}){return M("application/esri3do-SR_prj","prj",r)}function h(r){return[...P,...r]}function u(r,s){const c=r.toLowerCase();return h(s).find(R=>function y(r){return r?.[2].split(",").map(s=>s.toLowerCase())??[]}(R).some(U=>c.endsWith(U)))}function A(r){return r?.[0]}function f(r){return r?.[1].toLowerCase()}function F(r){return r.tables?.find(s=>"assetMaps"===s.role)}},30448:(re,x,o)=>{o.d(x,{TA:()=>d,We:()=>z,Z3:()=>G,ZJ:()=>M,w5:()=>K});var P=o(10467),V=o(89563);const d=(0,o(43085).vD)(),G=new Map,C=new Map;function z(g,w,I){return $.apply(this,arguments)}function $(){return($=(0,P.A)(function*(g,w,I){if(!g||!I)return!1;if(!w)return!0;const O=new URL(g).host;let h=G.get(O);if(!h){const D=g.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");h=(yield(0,V.A)(D,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return h===w})).apply(this,arguments)}function M(g,w){return b.apply(this,arguments)}function b(){return(b=(0,P.A)(function*(g,w,I=!1){if(!g||!w)return!0;const O=g.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),h=C.get(O)?.entries();if(h)for(const[D,S]of h)if(S.name===w){const u=!S.stack?.hasForwardEdits();if(!u&&I){const[{deleteForwardEdits:A},{default:f}]=yield Promise.all([o.e(4570).then(o.bind(o,44570)),o.e(5566).then(o.bind(o,55566))]),y=yield A(O,D,new f({sessionId:d,moment:S.moment}));return y.success&&S.stack?.clearForwardEdits(),y.success}return u}return!0})).apply(this,arguments)}function K(g,w){if(!g)return!1;const I=g.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),O=C.get(I)?.entries();if(O)for(const[h,D]of O)if(D.name===w)return"edit"===D.lockType;return!1}}}]);