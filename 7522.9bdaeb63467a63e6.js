"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[7522],{64765:(L,y,_)=>{var x,g,o;function R(o){return o&&"esri.renderers.visualVariables.SizeVariable"===o.declaredClass}function U(o){return null!=o&&!isNaN(o)&&isFinite(o)}function C(o){return o.valueExpression?x.Expression:o.field&&"string"==typeof o.field?x.Field:x.Unknown}function v(o,S){return(S||C(o))===x.Unknown?g.Constant:o.stops?g.Stops:null!=o.minSize&&null!=o.maxSize&&null!=o.minDataValue&&null!=o.maxDataValue?g.ClampedLinear:"unknown"===(o.valueUnit||"unknown")?null!=o.minSize&&null!=o.minDataValue?o.minSize&&o.minDataValue?g.Proportional:g.Additive:g.Identity:g.RealWorldSize}_.d(y,{KZ:()=>v,Yf:()=>x,_w:()=>g,eh:()=>C,gf:()=>U,of:()=>R}),(o=x||(x={})).Unknown="unknown",o.Expression="expression",o.Field="field",function(o){o.Unknown="unknown",o.Stops="stops",o.ClampedLinear="clamped-linear",o.Proportional="proportional",o.Additive="additive",o.Constant="constant",o.Identity="identity",o.RealWorldSize="real-world-size"}(g||(g={}))},77522:(L,y,_)=>{_.r(y),_.d(y,{getAllSizes:()=>J,getColor:()=>N,getOpacity:()=>O,getRotationAngle:()=>P,getSize:()=>M,getSizeForValue:()=>I,getSizeFromNumberOrVariable:()=>V,getSizeRangeAtScale:()=>q,getVisualVariableValues:()=>H,viewScaleRE:()=>W});var x=_(68677),g=_(81098),R=_(69690),U=_(35150),C=_(48716),v=_(64765);const o=()=>U.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),S=t=>o().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),E=()=>o().error("Use of arcade expressions requires an arcade context"),D=new g.A,F=Math.PI,W=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function N(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(u=>"color"===u.type):t;if(!e)return;if("esri.renderers.visualVariables.ColorVariable"!==e.declaredClass)return void S("ColorVariable");const r="number"==typeof a,i=r?null:a,s=i?.attributes;let c=r?a:null;const l=e.field,{ipData:f,hasExpression:b}=e.cache;let d=e.cache.compiledFunc;if(!l&&!b){const u=e.stops;return u&&u[0]&&u[0].color}if("number"!=typeof c)if(b){if(null==n?.arcade)return void E();const p=n.arcade.arcadeUtils,w=p.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),z=p.createExecContext(i,w,n.timeZone);if(!d){const A=p.createSyntaxTree(e.valueExpression);d=p.createFunction(A),e.cache.compiledFunc=d}c=p.executeFunction(d,z)}else s&&(c=s[l]);const m=e.normalizationField,h=null!=s&&null!=m?parseFloat(s[m]):void 0;if(null!=c&&(!m||r||!isNaN(h)&&0!==h)){isNaN(h)||r||(c/=h);const u=k(c,f);if(u){const p=u[0],w=u[1],z=p===w?e.stops[p].color:x.A.blendColors(e.stops[p].color,e.stops[w].color,u[2],n?.color);return new x.A(z)}}}function O(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(u=>"opacity"===u.type):t;if(!e)return;if("esri.renderers.visualVariables.OpacityVariable"!==e.declaredClass)return void S("OpacityVariable");const r="number"==typeof a,i=r?null:a,s=i?.attributes;let c=r?a:null;const l=e.field,{ipData:f,hasExpression:b}=e.cache;let d=e.cache.compiledFunc;if(!l&&!b){const u=e.stops;return u&&u[0]&&u[0].opacity}if("number"!=typeof c)if(b){if(null==n?.arcade)return void E();const p=n.arcade.arcadeUtils,w=p.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),z=p.createExecContext(i,w,n.timeZone);if(!d){const A=p.createSyntaxTree(e.valueExpression);d=p.createFunction(A),e.cache.compiledFunc=d}c=p.executeFunction(d,z)}else s&&(c=s[l]);const m=e.normalizationField,h=null!=s&&null!=m?parseFloat(s[m]):void 0;if(null!=c&&(!m||r||!isNaN(h)&&0!==h)){isNaN(h)||r||(c/=h);const u=k(c,f);if(u){const p=u[0],w=u[1];if(p===w)return e.stops[p].opacity;{const z=e.stops[p].opacity;return z+(e.stops[w].opacity-z)*u[2]}}}}function P(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(h=>"rotation"===h.type):t;if(!e)return;if("esri.renderers.visualVariables.RotationVariable"!==e.declaredClass)return void S("RotationVariable");const r=e.axis||"heading",i="heading"===r&&"arithmetic"===e.rotationType?90:0,s="heading"===r&&"arithmetic"===e.rotationType?-1:1,c="number"==typeof a?null:a,l=c?.attributes,f=e.field,{hasExpression:b}=e.cache;let d=e.cache.compiledFunc,m=0;if(!f&&!b)return m;if(b){if(null==n?.arcade)return void E();const u=n.arcade.arcadeUtils,p=u.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),w=u.createExecContext(c,p,n.timeZone);if(!d){const z=u.createSyntaxTree(e.valueExpression);d=u.createFunction(z),e.cache.compiledFunc=d}m=u.executeFunction(d,w)}else l&&(m=l[f]||0);return m="number"!=typeof m||isNaN(m)?null:i+s*m,m}function M(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(i=>"size"===i.type):t;if(!e)return;if("esri.renderers.visualVariables.SizeVariable"!==e.declaredClass)return void S("SizeVariable");const r=I(function j(t,a,n){const e="number"==typeof a,r=e?null:a,i=r?.attributes;let s=e?a:null;const{isScaleDriven:c}=t.cache;let l=t.cache.compiledFunc;if(c){const b=n?.scale,d=n?.view;s=null==b||"3d"===d?function B(t){let a=null,n=null;const e=t.stops;return e?(a=e[0].value,n=e[e.length-1].value):(a=t.minDataValue||0,n=t.maxDataValue||0),(a+n)/2}(t):b}else if(!e)switch(t.inputValueType){case v.Yf.Expression:{if(null==n?.arcade)return void E();const d=n.arcade.arcadeUtils,m=d.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),h=d.createExecContext(r,m,n.timeZone);if(!l){const u=d.createSyntaxTree(t.valueExpression);l=d.createFunction(u),t.cache.compiledFunc=l}s=d.executeFunction(l,h);break}case v.Yf.Field:i&&(s=i[t.field]);break;case v.Yf.Unknown:s=null}if(!(0,v.gf)(s))return null;if(e||!t.normalizationField)return s;const f=i?parseFloat(i[t.normalizationField]):null;return(0,v.gf)(f)&&0!==f?s/f:null}(e,a,n),e,a,n,e.cache.ipData);return null==r||isNaN(r)?0:r}function V(t,a,n){return null==t?null:(0,v.of)(t)?M(t,a,n):(0,v.gf)(t)?t:null}function T(t,a,n){return(0,v.gf)(n)&&t>n?n:(0,v.gf)(a)&&t<a?a:t}function I(t,a,n,e,r){switch(a.transformationType){case v._w.Additive:return function K(t,a,n,e){return t+((V(a.minSize,n,e)||a.minDataValue)??0)}(t,a,n,e);case v._w.Constant:return function Z(t,a,n){const e=t.stops;let r=e?.length&&e[0].size;return null==r&&(r=t.minSize),V(r,a,n)}(a,n,e);case v._w.ClampedLinear:return function Y(t,a,n,e){const r=(t-a.minDataValue)/(a.maxDataValue-a.minDataValue),i=V(a.minSize,n,e),s=V(a.maxSize,n,e),c=e?.shape;if(t<=a.minDataValue)return i;if(t>=a.maxDataValue)return s;if(null==i||null==s)return null;if("area"===a.scaleBy&&c){const l="circle"===c,f=l?F*(i/2)**2:i*i,b=f+r*((l?F*(s/2)**2:s*s)-f);return l?2*Math.sqrt(b/F):Math.sqrt(b)}return i+r*(s-i)}(t,a,n,e);case v._w.Proportional:return function $(t,a,n,e){const r=e?.shape,i=t/a.minDataValue,s=V(a.minSize,n,e),c=V(a.maxSize,n,e);let l=null;return l="circle"===r?2*Math.sqrt(i*(s/2)**2):"square"===r||"diamond"===r||"image"===r?Math.sqrt(i*s**2):i*s,T(l,s,c)}(t,a,n,e);case v._w.Stops:return function G(t,a,n,e,r){const[i,s,c]=k(t,r);if(i===s)return V(a.stops?.[i].size,n,e);{const l=V(a.stops?.[i].size,n,e);return l+(V(a.stops?.[s].size,n,e)-l)*c}}(t,a,n,e,r);case v._w.RealWorldSize:return function X(t,a,n,e){const r=(e?.resolution??1)*C.j[a.valueUnit],i=V(a.minSize,n,e),s=V(a.maxSize,n,e),{valueRepresentation:c}=a;let l=null;return l="area"===c?2*Math.sqrt(t/F)/r:"radius"===c||"distance"===c?2*t/r:t/r,T(l,i,s)}(t,a,n,e);case v._w.Identity:return t;case v._w.Unknown:return null}}function q(t,a,n){const{isScaleDriven:e}=t.cache;if(!(e&&"3d"===n||a))return null;const r={scale:a,view:n};let i=V(t.minSize,D,r),s=V(t.maxSize,D,r);if(null!=i||null!=s){if(i>s){const c=s;s=i,i=c}return{minSize:i,maxSize:s}}}function H(t,a,n){if(!t.visualVariables)return;const e=[],r=[],i=[],s=[],c=[];for(const l of t.visualVariables)switch(l.type){case"color":r.push(l);break;case"opacity":i.push(l);break;case"rotation":c.push(l);break;case"size":s.push(l)}return r.forEach(l=>{const f=N(l,a,n);e.push({variable:l,value:f})}),i.forEach(l=>{const f=O(l,a,n);e.push({variable:l,value:f})}),c.forEach(l=>{const f=P(l,a,n);e.push({variable:l,value:f})}),s.forEach(l=>{const f=M(l,a,n);e.push({variable:l,value:f})}),e.filter(l=>null!=l.value)}function k(t,a){if(!a)return;let n=0,e=a.length-1;return a.some((r,i)=>t<r?(e=i,!0):(n=i,!1)),[n,e,(t-a[n])/(a[e]-a[n])]}function J(t,a,n){const e=["proportional","proportional","proportional"];for(const r of t){const i=r.useSymbolValue?"symbol-value":M(r,a,n);switch(r.axis){case"width":e[0]=i;break;case"depth":e[1]=i;break;case"height":e[2]=i;break;case"width-and-depth":e[0]=i,e[1]=i;break;case"all":case void 0:case null:e[0]=i,e[1]=i,e[2]=i;break;default:(0,R.Xb)(r.axis)}}return e}}}]);