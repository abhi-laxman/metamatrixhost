"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[4977],{65374:(W,A,i)=>{var M,E,p,f,u,a,v,P,h,T,y,C,S,R,m,l,_,n,s,c,d,g,e,r,o,x,B,I,D,O,L,w,U,b,Y,J,X,N,j,$,q,F,tt,et,it,nt,K,k,H,V,rt,st,ot,lt,at,G,ut,Q,Z,ct,z,dt,ht,t;i.d(A,{$2:()=>u,C1:()=>p,Hz:()=>C,JO:()=>E,M1:()=>e,O$:()=>Z,OW:()=>G,Q1:()=>k,TZ:()=>_,WE:()=>D,Y:()=>v,YI:()=>V,bj:()=>P,e_:()=>K,f0:()=>Q,fu:()=>y,g7:()=>h,ip:()=>H,mU:()=>O,oF:()=>d,uQ:()=>g,uT:()=>N,vG:()=>z,wd:()=>F,xR:()=>M,xn:()=>n,xw:()=>x,yS:()=>j}),(t=M||(M={}))[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN",function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(E||(E={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(p||(p={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(f||(f={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(u||(u={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(a||(a={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(v||(v={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(P||(P={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(h||(h={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(T||(T={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(y||(y={})),function(t){t.Linear="Linear",t.EaseIn="EaseIn",t.EaseOut="EaseOut",t.EaseInOut="EaseInOut"}(C||(C={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(S||(S={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(R||(R={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(m||(m={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(l||(l={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(_||(_={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(n||(n={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(s||(s={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(c||(c={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(d||(d={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",t.ConcentricCircles="ConcentricCircles",t.DoubleJogArrow="DoubleJogArrow",t.LinkedChevrons="LinkedChevrons",t.SegmentThenHalfCircle="SegmentThenHalfCircle",t.LineWithStraightTicks="LineWithStraightTicks",t.DoubleCurve="DoubleCurve",t.ParallelWithTicksByWidth="ParallelWithTicksByWidth",t.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(g||(g={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(e||(e={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(r||(r={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(o||(o={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(x||(x={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(B||(B={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(I||(I={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(D||(D={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(O||(O={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(L||(L={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(w||(w={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(U||(U={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AlongLine=1]="AlongLine"}(b||(b={})),function(t){t[t.Auto=0]="Auto",t[t.Clockwise=1]="Clockwise",t[t.Counterclockwise=2]="Counterclockwise"}(Y||(Y={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(J||(J={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(X||(X={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(N||(N={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(j||(j={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}($||($={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(q||(q={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(F||(F={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(tt||(tt={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(et||(et={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(it||(it={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(nt||(nt={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(K||(K={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(k||(k={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(H||(H={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(V||(V={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(rt||(rt={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(st||(st={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(ot||(ot={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(lt||(lt={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(at||(at={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(G||(G={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(ut||(ut={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Q||(Q={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(Z||(Z={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(ct||(ct={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(z||(z={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(dt||(dt={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(ht||(ht={}))},76582:(W,A,i)=>{i.d(A,{LG:()=>y,mb:()=>R,yr:()=>C});var M=i(10467),E=i(56492),p=i(31610),f=i(12273),u=i(88532),a=i(63888),v=i(28399),P=i(50915),h=i(76169),T=i(4931);function y(m){return m&&"render"in m}function C(m){const l=document.createElement("canvas");return l.width=m.width,l.height=m.height,m.render(l.getContext("2d")),l}class R extends a.q{constructor(l=null,_=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._texture=null,this._width=void 0,this.x=0,this.y=0,this.immutable=_,this.source=l,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(l){this._height=l}get source(){return this._source}set source(l){null==l&&null==this._source||(this._source=l,this.invalidateTexture(),this.requestRender())}get texture(){return this._texture}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(l){this._width=l}beforeRender(l){super.beforeRender(l),this.updateTexture(l)}setSourceAsync(l,_){var n=this;return(0,M.A)(function*(){null!=n._uploadStatus&&n._uploadStatus.controller.abort();const s=new AbortController,c=(0,E.Tw)();return(0,E.NY)(_,()=>s.abort()),(0,E.NY)(s,d=>c.reject(d)),n._uploadStatus={controller:s,resolver:c},n.source=l,c.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}transitionStep(l,_){l>=64&&(this.fadeTransitionEnabled=!1),super.transitionStep(l,_)}setTransform(l){const _=(0,p.D_)(this.transforms.displayViewScreenMat3),[n,s]=l.toScreenNoRotation([0,0],[this.x,this.y]),c=this.resolution/this.pixelRatio/l.resolution,d=c*this.width,g=c*this.height,e=Math.PI*this.rotation/180;(0,p.Tl)(_,_,(0,u.fA)(n,s)),(0,p.Tl)(_,_,(0,u.fA)(d/2,g/2)),(0,p.e$)(_,_,-e),(0,p.Tl)(_,_,(0,u.fA)(-d/2,-g/2)),(0,p.Oe)(_,_,(0,u.fA)(d,g)),(0,p.lw)(this.transforms.displayViewScreenMat3,l.displayViewMat3,_)}setSamplingProfile(l){this._texture&&(l.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(l.samplingMode))}bind(l,_){this._texture&&l.bindTexture(this._texture,_)}updateTexture({context:l,painter:_}){var n=this;return(0,M.A)(function*(){if(!n._textureInvalidated)return;if(n._textureInvalidated=!1,n._texture||(n._texture=n._createTexture(l)),!n.source)return void n._texture.setData(null);n._texture.resize(n._sourceWidth,n._sourceHeight);const s=function S(m){return y(m)?m instanceof v.A?m.getRenderedRasterPixels()?.renderedRasterPixels:C(m):m}(n.source);try{if(null!=n._uploadStatus){const{controller:c,resolver:d}=n._uploadStatus,g={signal:c.signal},{width:e,height:r}=n,o=n._texture;yield _.textureUploadManager.enqueueTextureUpdate({data:s,texture:o,width:e,height:r},g),d.resolve(),n._uploadStatus=null}else n._texture.setData(s);n.ready()}catch(c){(0,E.jH)(c)}})()}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,f.vt)()}}_createTexture(l){const _=this.immutable,n=new T.R;return n.internalFormat=_?P.H0.RGBA8:P.Ab.RGBA,n.wrapMode=P.pF.CLAMP_TO_EDGE,n.isImmutable=_,n.width=this._sourceWidth,n.height=this._sourceHeight,new h.g(l,n)}}},28399:(W,A,i)=>{i.d(A,{A:()=>M});class M{constructor(p,f,u){this.pixelBlock=p,this.extent=f,this.originalPixelBlock=u}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(p){const f=this.pixelBlock;if(null==f)return;const u=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??f});if(null==u.pixelBlock)return;u.pixelBlock.maskIsAlpha&&(u.pixelBlock.premultiplyAlpha=!0);const a=u.pixelBlock.getAsRGBA(),v=p.createImageData(u.pixelBlock.width,u.pixelBlock.height);v.data.set(a),p.putImageData(v,0,0)}getRenderedRasterPixels(){const p=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==p.pixelBlock?null:(p.pixelBlock.maskIsAlpha&&(p.pixelBlock.premultiplyAlpha=!0),{width:p.pixelBlock.width,height:p.pixelBlock.height,renderedRasterPixels:new Uint8Array(p.pixelBlock.getAsRGBA().buffer)})}}},37188:(W,A,i)=>{i.d(A,{A:()=>v});var M=i(3248),E=i(69473),p=i(54382),f=i(89298),u=i(99065);const a=(P,h)=>P.key.level-h.key.level!=0?P.key.level-h.key.level:P.key.row-h.key.row!=0?P.key.row-h.key.row:P.key.col-h.key.col;class v extends p.A{constructor(h){super(),this.tileInfoView=h,this.sortFunction=a}renderChildren(h){this.setStencilReference(h),super.renderChildren(h)}createRenderParams(h){const{state:T}=h,y=super.createRenderParams(h);return y.requiredLevel=this.tileInfoView.getClosestInfoForScale(T.scale).level,y.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(T.scale),y}prepareRenderPasses(h){const T=super.prepareRenderPasses(h);return T.push(h.registerRenderPass({name:"stencil",brushes:[f.A],drawPhase:E.S5.DEBUG|E.S5.MAP|E.S5.HIGHLIGHT|E.S5.LABEL,target:()=>this.getStencilTarget()})),(0,M.A)("esri-tiles-debug")&&T.push(h.registerRenderPass({name:"tileInfo",brushes:[u.A],drawPhase:E.S5.DEBUG,target:()=>this.children})),T}getStencilTarget(){return this.children}setStencilReference(h){let T=1;for(const y of this.children)y.stencilRef=T++}}},34531:(W,A,i)=>{i.d(A,{C:()=>_});var M=i(47669),E=i(14089),p=i(8137),f=i(8189),u=i(84035),a=i(3902);function P(n){const s=function v(n){const s=new a.nt(.16666666666666666),c=n.multiply(n),d=c.multiply(n),g=s.multiply(d.multiply(-1).add(new a.nt(3).multiply(c)).subtract(new a.nt(3).multiply(n)).add(1)),e=s.multiply(d.multiply(3).subtract(c.multiply(6)).add(4)),r=s.multiply(d.multiply(-3).add(c.multiply(3)).add(n.multiply(3)).add(1)),o=s.multiply(d);return new a.Zb(g,e,r,o)}(n),c=s.x.add(s.y),d=s.z.add(s.w),g=new a.nt(1).subtract(s.y.divide(c)).add(n),e=new a.nt(1).add(s.w.divide(d)).subtract(n);return new a.Zb(g,e,c,d)}class T extends u.ZA{}(0,f._)([(0,u.C5)(0,a.ZY)],T.prototype,"position",void 0);class C extends u.k2{}(0,f._)([(0,u.Pi)(a.z7)],C.prototype,"texture",void 0),(0,f._)([(0,u.Pi)(a.U)],C.prototype,"dvsMat3",void 0),(0,f._)([(0,u.Pi)(a.ZY)],C.prototype,"coordScale",void 0),(0,f._)([(0,u.Pi)(a.nt)],C.prototype,"opacity",void 0);class S extends u.A{constructor(){super(...arguments),this.type="BitmapShader"}vertex(s){const c=this.config.dvsMat3.multiply(new a.eB(s.position.multiply(this.config.coordScale),1));return{glPosition:new a.Zb(c,1),texcoord:s.position}}fragment(s){const c=new u.mm;let d;return d=this.bicubic?function h(n,s,c){const d=new a.ZY(new a.nt(1).divide(c.x),0),g=new a.ZY(0,new a.nt(1).divide(c.y)),e=s.multiply(c).subtract(.5),r=P((0,a.jc)(e).x).xyz,o=P((0,a.jc)(e).y).xyz;let x=s.add(r.x.multiply(d)),B=s.subtract(r.y.multiply(d));const I=x.add(o.x.multiply(g)),D=B.add(o.x.multiply(g));x=x.subtract(o.y.multiply(g)),B=B.subtract(o.y.multiply(g));let O=(0,a.US)(n,B),L=(0,a.US)(n,x);const w=(0,a.US)(n,D),U=(0,a.US)(n,I);return O=(0,a.jh)(O,w,o.z),L=(0,a.jh)(L,U,o.z),O=(0,a.jh)(O,L,r.z),O}(this.config.texture,s.texcoord,this.config.coordScale):(0,a.US)(this.config.texture,s.texcoord),c.fragColor=new a.Zb(d.rgb.multiply(this.config.opacity),d.a.multiply(this.config.opacity)),c}}(0,f._)([(0,u.Pi)(C)],S.prototype,"config",void 0),(0,f._)([u.E8],S.prototype,"bicubic",void 0),(0,f._)([(0,f.a)(0,(0,u.hF)(T))],S.prototype,"vertex",null),(0,f._)([(0,f.a)(0,(0,u.hF)(class y extends u.HS{}))],S.prototype,"fragment",null);var R=i(50915);const m={nearest:{samplingMode:R.Cj.NEAREST,mips:!1},bilinear:{samplingMode:R.Cj.LINEAR,mips:!1},bicubic:{samplingMode:R.Cj.LINEAR,mips:!1},trilinear:{samplingMode:R.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},l=(n,s,c)=>{if("dynamic"===c.samplingMode){const{state:d}=n,g=s.resolution/s.pixelRatio/d.resolution,e=Math.round(n.pixelRatio)!==n.pixelRatio;return d.rotation||g>1.05||g<.95||e||s.isSourceScaled||s.rotation?m.bilinear:m.nearest}return m[c.samplingMode]};class _ extends E.j{constructor(){super(...arguments),this.name="BrushBitmap",this.type=p.N.Bitmap,this.shaders={bitmap:new S}}render(s,c){const{context:d,renderingOptions:g,painter:e}=s;for(const r of c.bitmaps){const o=r.texture;if(!r.source||!r.isReady||null==o)continue;const x=l(s,r,g);s.timeline.begin(this.name),e.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:r.stencilRef,compare:R.MT.EQUAL,op:{fail:R.eA.KEEP,zFail:R.eA.KEEP,zPass:R.eA.KEEP}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"additive"===r.blendFunction?"additive":"composite"}}),r.setSamplingProfile(x);const{coordScale:B,computedOpacity:I,transforms:D}=r;e.submitDrawMesh(d,{shader:this.shaders.bitmap,uniforms:{config:{texture:{texture:o,unit:M.YS},dvsMat3:D.displayViewScreenMat3,coordScale:B,opacity:I}},defines:{bicubic:x===m.bicubic},optionalAttributes:null,useComputeBuffer:!1},e.quadMesh),s.timeline.end(this.name)}}}},57216:(W,A,i)=>{i.r(A),i.d(A,{default:()=>g});var M=i(10467),E=i(8189),p=i(35150),f=i(56492),u=i(85211),P=(i(3248),i(40707),i(76576)),h=i(58701),T=i(96604),y=i(88219),C=i(86131),S=i(54290),R=i(74847),m=i(15215),l=i(77031),_=i(41474),n=i(96081),s=i(34150);const c=[0,0];let d=class extends((0,n.A)((0,T.Y)((0,y.e)(_.A)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const{activeLayer:e}=this.layer,{tileMatrixSet:r}=e;if(r&&(0,h.aI)(r.tileInfo?.spatialReference,this.view.spatialReference))return r;const o=this._getTileMatrixSetBySpatialReference(e);return o&&o.id!==e.tileMatrixSetId?(e.tileMatrixSetId=o.id,o):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new S.A(e),this._fetchQueue=new m.A({tileInfoView:this._tileInfoView,concurrency:16,process:(r,o)=>this.fetchTile(r,o),scheduler:this.scheduler,priority:s.W6.MAPVIEW_FETCH_QUEUE}),this._tileStrategy=new l.A({cachePolicy:"keep",resampling:!0,acquireTile:r=>this.acquireTile(r),releaseTile:r=>this.releaseTile(r),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add(()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet],()=>this.doRefresh())),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some(r=>(0,h.aI)(r.tileInfo?.spatialReference,e))??!1}doRefresh(){var e=this;return(0,M.A)(function*(){if(e.attached){if(e.suspended)return e._tileStrategy.clear(),void e.requestUpdate();e._fetchQueue.reset(),e._tileStrategy.refresh(r=>e._updatingHandles.addPromise(e._enqueueTileFetch(r)))}})()}acquireTile(e){const r=this._bitmapView.createTile(e),o=r.bitmap;return[o.x,o.y]=this._tileInfoView.getTileCoords(c,r.key),o.resolution=this._tileInfoView.getTileResolution(r.key),[o.width,o.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(r)),this._bitmapView.addChild(r),this.requestUpdate(),r}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e,r={}){var o=this;return(0,M.A)(function*(){const x="tilemapCache"in o.layer?o.layer.tilemapCache:null,{signal:B,resamplingLevel:I=0}=r;if(!x)return o._fetchImage(e,B);const D=new R.A(0,0,0,0);let O;try{yield x.fetchAvailabilityUpsample(e.level,e.row,e.col,D,{signal:B}),O=yield o._fetchImage(D,B)}catch(L){if((0,f.zf)(L))throw L;if(I<3){const w=o._tileInfoView.getTileParentId(e.id);if(w){const U=new R.A(w),b=yield o.fetchTile(U,{...r,resamplingLevel:I+1});return(0,C.t)(o._tileInfoView,b,U,e)}}throw L}return(0,C.t)(o._tileInfoView,O,D,e)})()}canResume(){return super.canResume()&&null!==this.tileMatrixSet}_enqueueTileFetch(e){var r=this;return(0,M.A)(function*(){if(!r._fetchQueue.has(e.key.id)){try{const o=yield r._fetchQueue.push(e.key);e.bitmap.source=o,e.bitmap.width=r._tileInfoView.tileInfo.size[0],e.bitmap.height=r._tileInfoView.tileInfo.size[1],e.once("attach",()=>r.requestUpdate())}catch(o){(0,f.zf)(o)||p.A.getLogger(r).error(o)}r.requestUpdate()}})()}_fetchImage(e,r){var o=this;return(0,M.A)(function*(){return o.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:r})})()}_getTileMatrixSetBySpatialReference(e){return e.tileMatrixSets?.find(r=>(0,h.aI)(r.tileInfo?.spatialReference,this.view.spatialReference))}};(0,E._)([(0,u.MZ)({readOnly:!0})],d.prototype,"tileMatrixSet",null),d=(0,E._)([(0,P.$)("esri.views.2d.layers.WMTSLayerView2D")],d);const g=d},96081:(W,A,i)=>{i.d(A,{A:()=>h});var M=i(8189),E=i(35150),p=i(56492),f=i(48900),P=(i(3248),i(40707),i(5922),i(76576));const h=T=>{let y=class extends T{initialize(){this.addHandles((0,f.on)(()=>this.layer,"refresh",C=>{this.doRefresh(C.dataChanged).catch(S=>{(0,p.zf)(S)||E.A.getLogger(this).error(S)})}),"RefreshableLayerView")}};return y=(0,M._)([(0,P.$)("esri.views.layers.RefreshableLayerView")],y),y}}}]);