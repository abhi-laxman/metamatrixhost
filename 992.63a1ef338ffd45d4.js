"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[992],{48716:(we,de,m)=>{m.d(de,{j:()=>o});var F=m(82663),z=m(47258);const o={unknown:1,inches:(0,F.oU)(1,"meters","inches"),feet:(0,F.oU)(1,"meters","feet"),"us-feet":(0,F.oU)(1,"meters","us-feet"),yards:(0,F.oU)(1,"meters","yards"),miles:(0,F.oU)(1,"meters","miles"),"nautical-miles":(0,F.oU)(1,"meters","nautical-miles"),millimeters:(0,F.oU)(1,"meters","millimeters"),centimeters:(0,F.oU)(1,"meters","centimeters"),decimeters:(0,F.oU)(1,"meters","decimeters"),meters:(0,F.oU)(1,"meters","meters"),kilometers:(0,F.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,F.vl)(1,"meters",z.$O.radius)}},8548:(we,de,m)=>{m.d(de,{H:()=>o});var F=m(3248);const o=new class z{get forceStaticPath(){return"disabled"===(0,F.A)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,F.A)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,F.A)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,F.A)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,F.A)("esri-cim-animations-freeze-time")}}},42334:(we,de,m)=>{m.d(de,{e:()=>oe});var F=m(32788),r=(m(79061),m(3248),m(77440),m(50915)),K=(m(68165),m(76169),m(45513)),C=m(63609);class oe{constructor(N,re){this._boundPart=null,this.vertexBuffers=new Map,this.indexBuffers=new Map,this.groups=[];for(const ee in re.vertex){const{data:J,attributes:$}=re.vertex[ee],U=F.g.createVertex(N,r._U.STATIC_DRAW,J);this.vertexBuffers.set(ee,{buffer:U,attributes:$})}for(const ee in re.index){const{data:J}=re.index[ee],$=F.g.createIndex(N,r._U.STATIC_DRAW,J);this.indexBuffers.set(ee,{buffer:$})}for(const ee of re.groups)this.groups.push({...ee,vertexArrays:new Map});this.parts=re.parts}bind(N,re,ee){this._boundPart=ee;const{group:J}=this.parts[this._boundPart],$=this.groups[J];if(!$)throw new Error(`Missing group ${J}.`);let U=$.vertexArrays.get(re.stringHash);if(!U){const k=new Set(re.locations.keys()),g=$.index?this.indexBuffers.get($.index)?.buffer:null,D=new Map,se=new Map;for(const[R,{buffer:S,attributes:B}]of this.vertexBuffers){const Z=B.filter(I=>k.has(I.name));Z.length>0&&(D.set(R,Z),se.set(R,S))}U=new K.Z(N,re.locations,D,se,g),$.vertexArrays.set(re.stringHash,U)}N.bindVAO(U)}draw(N){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:re,count:ee}=this.parts[this._boundPart],{group:J}=this.parts[this._boundPart],{primitive:$,index:U}=this.groups[J];if(U){const k=this.indexBuffers.get(U);if(!k)throw new Error(`Missing index buffer "${U}".`);const{indexType:g}=k.buffer;if(!g)throw new Error("Buffer type error.");N.drawElements($,ee,g,re*C.I[g])}else N.drawArrays($,re,ee)}unbind(N){this._boundPart=null,N.bindVAO(null)}destroy(){for(const{vertexArrays:N}of this.groups)for(const[re,ee]of N)ee.disposeVAOOnly();for(const{buffer:N}of this.vertexBuffers.values())N.dispose();for(const{buffer:N}of this.indexBuffers.values())N.dispose()}}},39784:(we,de,m)=>{m.d(de,{g:()=>e});var F=m(63609),z=m(42334),o=m(50915),me=m(30454);const r={position:{type:o.pe.SHORT,count:2}};class e extends z.e{static create(K,C){const oe=[];let{stride:P}=C;if(null==P){P=0;for(const[U,{count:k,type:g,offset:D}]of Object.entries(C.layout)){if(null!=D)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");P+=k*F.I[g]}}let N=0;for(const[U,{count:k,offset:g,type:D,normalized:se}]of Object.entries(C.layout)){null!=g&&(N=g);const R=new me._(U,k,D,N,P,null!=se&&se,0);oe.push(R),N+=k*F.I[D]}const re={primitive:C.primitive};null!=C.index&&(re.index="indexData");let{count:ee}=C;if(null==ee&&(ee=C.index?C.index.length:C.vertex.byteLength/P,Math.floor(ee)!==ee))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${P}.`);const $={vertex:{vertexData:{data:C.vertex,attributes:oe}},parts:[{start:0,count:ee,group:0,primitive:C.primitive}],groups:[re]};return null!=C.index&&($.index={indexData:{data:C.index}}),new e(K,$,C.layout)}static fromVertexStream(K,C){return e.create(K,{primitive:o.WR.TRIANGLE_STRIP,vertex:new Uint16Array(C),layout:r})}constructor(K,C,oe){super(K,C),this._spec=oe}bind(K,C,oe=0){super.bind(K,C,oe)}}},63609:(we,de,m)=>{m.d(de,{I:()=>z});var F=m(50915);const z={[F.pe.BYTE]:1,[F.pe.UNSIGNED_BYTE]:1,[F.pe.SHORT]:2,[F.pe.UNSIGNED_SHORT]:2,[F.pe.HALF_FLOAT]:2,[F.pe.INT]:4,[F.pe.UNSIGNED_INT]:4,[F.pe.FLOAT]:4}},12598:(we,de,m)=>{m.d(de,{YS:()=>at,n_:()=>fs,Wn:()=>ms});var F=m(69473),z=m(8137),o=m(8189),me=m(8548),r=m(84035),e=m(3902),pe=m(80862);class K extends r.k2{}(0,o._)([(0,r.Pi)(e.nt)],K.prototype,"globalTime",void 0),(0,o._)([(0,r.Pi)(e.ZY)],K.prototype,"animationTextureSize",void 0),(0,o._)([(0,r.Pi)(e.z7)],K.prototype,"animationTexture",void 0),(0,o._)([(0,r.Pi)(e.U)],K.prototype,"toScreen",void 0),(0,o._)([(0,r.Pi)(e.U)],K.prototype,"toNdc",void 0),(0,o._)([(0,r.Pi)(e.nt)],K.prototype,"mapRotation",void 0),(0,o._)([(0,r.Pi)(e.nt)],K.prototype,"pixelRatio",void 0);var C=m(47669),oe=m(3248),P=m(875);class N extends r.k2{getVisualVariableData(t){if(!this._vvData){const i=this.getAttributeDataCoords(t);this._vvData=(0,e.US)(this.visualVariableData,i).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const i=(0,P.Kt)(t),s=this.size,a=(0,e.Wh)(i.x),u=(0,e.Wh)(i.y).multiply((0,e.Wh)(256)),d=(0,e.Wh)(i.z).multiply((0,e.Wh)(256)).multiply((0,e.Wh)(256)),p=(0,e.fV)(a.add(u).add(d)),h=(0,e.zi)(p,s),x=p.subtract(h).divide(s);this._uv=new e.ZY(h,x).add(.5).divide(s)}return this._uv}getFilterData(t){const i=this.getAttributeDataCoords(t);return(0,e.US)(this.filterFlags,i).setDebugName("storage0")}getAnimationData(t){const i=this.getAttributeDataCoords(t);return(0,e.US)(this.animation,i).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const i=this.getAttributeDataCoords(t);return(0,e.US)(this.dataDriven0,i).setDebugName("storage30")}getDataDrivenData1(t){const i=this.getAttributeDataCoords(t);return(0,e.US)(this.dataDriven1,i).setDebugName("storage31")}getDataDrivenData2(t){const i=this.getAttributeDataCoords(t);return(0,e.US)(this.dataDriven2,i).setDebugName("storage32")}getGPGPUData(t){const i=this.getAttributeDataCoords(t);return(0,e.US)(this.gpgpu,i).setDebugName("storage4")}getLocalTimeOrigin(t){const i=this.getAttributeDataCoords(t);return(0,e.US)(this.localTimeOrigin,i).x.setDebugName("storage5")}getFilterFlags(t){return(0,oe.A)("webgl-ignores-sampler-precision")?(0,e.mk)(this.getFilterData(t).x.multiply((0,e.fV)(255))):this.getFilterData(t).x.multiply((0,e.fV)(255))}getLabelVisibility(t){const i=this.getFilterData(t).y.multiply(255);return new e.nt(1).subtract(i)}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}}(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"filterFlags",void 0),(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"animation",void 0),(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"gpgpu",void 0),(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"localTimeOrigin",void 0),(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"visualVariableData",void 0),(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"dataDriven0",void 0),(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"dataDriven1",void 0),(0,o._)([(0,r.Pi)(e.z7)],N.prototype,"dataDriven2",void 0),(0,o._)([(0,r.Pi)(e.nt)],N.prototype,"size",void 0);class re extends r.k2{}(0,o._)([(0,r.Pi)(e.nt)],re.prototype,"activeReasons",void 0),(0,o._)([(0,r.Pi)(e.nt)],re.prototype,"highlightAll",void 0);class ee extends r.k2{}(0,o._)([(0,r.Pi)(e.ZY)],ee.prototype,"position",void 0),(0,o._)([(0,r.Pi)(e.nt)],ee.prototype,"distance",void 0),(0,o._)([(0,r.Pi)(e.nt)],ee.prototype,"smallSymbolDistance",void 0),(0,o._)([(0,r.Pi)(e.nt)],ee.prototype,"smallSymbolSizeThreshold",void 0);class J extends r.k2{}(0,o._)([(0,r.Pi)(e.U)],J.prototype,"displayViewScreenMat3",void 0),(0,o._)([(0,r.Pi)(e.U)],J.prototype,"displayViewMat3",void 0),(0,o._)([(0,r.Pi)(e.U)],J.prototype,"displayMat3",void 0),(0,o._)([(0,r.Pi)(e.U)],J.prototype,"viewMat3",void 0),(0,o._)([(0,r.Pi)(e.U)],J.prototype,"tileMat3",void 0),(0,o._)([(0,r.Pi)(e.nt)],J.prototype,"displayZoomFactor",void 0),(0,o._)([(0,r.Pi)(e.nt)],J.prototype,"requiredZoomFactor",void 0),(0,o._)([(0,r.Pi)(e.ZY)],J.prototype,"tileOffset",void 0),(0,o._)([(0,r.Pi)(e.nt)],J.prototype,"currentScale",void 0),(0,o._)([(0,r.Pi)(e.nt)],J.prototype,"currentZoom",void 0),(0,o._)([(0,r.Pi)(e.nt)],J.prototype,"metersPerSRUnit",void 0),(0,o._)([(0,r.Pi)(e.nt)],J.prototype,"rotation",void 0),(0,o._)([(0,r.Pi)(e.nt)],J.prototype,"pixelRatio",void 0);class $ extends r.ZA{}(0,o._)([(0,r.C5)(0,e.eB)],$.prototype,"id",void 0),(0,o._)([(0,r.C5)(1,e.nt)],$.prototype,"bitset",void 0),(0,o._)([(0,r.C5)(2,e.ZY)],$.prototype,"pos",void 0);class U extends r.Y7{}(0,o._)([(0,r.C5)(14,e.ZY)],U.prototype,"nextPos1",void 0),(0,o._)([(0,r.C5)(15,e.ZY)],U.prototype,"nextPos2",void 0);class k extends r.HS{}class g extends r.A{clip(t,i){let s=new e.nt(0);const a=this.storage.getFilterFlags(t);if(s=s.add((0,e.fV)(2).multiply((0,e.fV)(1).subtract((0,P.i6)(a,0)))),this.inside?s=s.add((0,e.fV)(2).multiply((0,e.fV)(1).subtract((0,P.i6)(a,1)))):this.outside?s=s.add((0,e.fV)(2).multiply((0,P.i6)(a,1))):this.highlight&&(s=s.add((0,e.fV)(2).multiply((0,e.fV)(1).subtract(this._checkHighlight(a))))),null!=i){const u=new e.nt(1).subtract((0,e.PM)(i.x,this.view.currentZoom)),d=(0,e.PM)(i.y,this.view.currentZoom);s=s.add(new e.nt(2).multiply(u.add(d)))}return s}getFragmentOutput(t,i,s=new e.nt(1/255)){const a=new r.mm;return a.fragColor=this._maybeWriteHittest(i)??this._maybeHighlight(t,s)??t,a}_maybeHighlight(t,i){return this.highlight?new e.Zb(t.rgb,(0,e.PM)(i,t.a)):null}_checkHighlight(t){let i=this._checkHighlightBit(t,0);for(let s=1;s<C.U5;s++)i=i.add(this._checkHighlightBit(t,s));return(0,e.PM)(new e.nt(.1),i.add(this.highlight.highlightAll))}_checkHighlightBit(t,i){return(0,P.yS)(t,i).multiply((0,P.mh)(this.highlight.activeReasons,i))}maybeRunHittest(t,i,s){if(null==this.hittestRequest)return null;const a=this.hittest(t,i,s);let u=(0,e.Tk)((0,e.MM)(a,this.hittestRequest.distance),new e.nt(2),new e.nt(0));const d=this.storage.getAttributeDataCoords(t.id),p=(0,P.nb)(d);u=u.add(this.clip(t.id,t.zoomRange));const h=new e.Zb(new e.nt(1/255),0,0,0);return{glPointSize:new e.nt(1),glPosition:new e.Zb(p,u,1),color:h}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}(0,o._)([r.E8],g.prototype,"inside",void 0),(0,o._)([r.E8],g.prototype,"outside",void 0),(0,o._)([(0,r.uK)(re)],g.prototype,"highlight",void 0),(0,o._)([(0,r.Pi)(N)],g.prototype,"storage",void 0),(0,o._)([(0,r.Pi)(J)],g.prototype,"view",void 0),(0,o._)([(0,r.uK)(ee)],g.prototype,"hittestRequest",void 0);var Ie,l,D=m(90731);class se extends r.k2{}(0,o._)([(0,r.Pi)(e.ZY)],se.prototype,"size",void 0),(0,o._)([(0,r.Pi)(e.z7)],se.prototype,"texture",void 0);class R extends r.k2{getColor(t,i,s){return(0,e.j1)([(0,e.or)((0,P.M8)(t),s),i],[(0,e.$5)(t,this.values.first()),this.colors.first()],[(0,e.aX)(t,this.values.last()),this.colors.last()],[!0,()=>{const a=this.values.findIndex(x=>(0,e.MM)(x,t)),u=this.values.get(a),d=a.subtract(1),p=this.values.get(d),h=t.subtract(p).divide(u.subtract(p));return(0,e.jh)(this.colors.get(d),this.colors.get(a),h)}])}}(0,o._)([(0,r.Pi)(e.My.ofType(e.Zb,8))],R.prototype,"colors",void 0),(0,o._)([(0,r.Pi)(e.My.ofType(e.nt,8))],R.prototype,"values",void 0);class S extends r.k2{getOpacity(t){return(0,e.j1)([(0,P.M8)(t),new e.nt(1)],[(0,e.$5)(t,this.opacityValues.first()),this.opacities.first()],[(0,e.aX)(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const i=this.opacityValues.findIndex(p=>(0,e.MM)(p,t)),s=this.opacityValues.get(i),a=i.subtract(1),u=this.opacityValues.get(a),d=t.subtract(u).divide(s.subtract(u));return(0,e.jh)(this.opacities.get(a),this.opacities.get(i),d)}])}}(0,o._)([(0,r.Pi)(e.My.ofType(e.nt,8))],S.prototype,"opacities",void 0),(0,o._)([(0,r.Pi)(e.My.ofType(e.nt,8))],S.prototype,"opacityValues",void 0);class B extends r.k2{getVVRotationMat4(t){return(0,e.Tk)((0,P.M8)(t),e.$I.identity(),()=>{const i=this.getNormalizedAngle(t).multiply(D.os),s=(0,e.F8)(i),a=(0,e.gn)(i);return new e.$I(a,s,0,0,s.multiply(new e.nt(-1)),a,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(t){return(0,e.Tk)((0,P.M8)(t),e.U.identity(),()=>{const i=this.getNormalizedAngle(t).multiply(D.os),s=(0,e.F8)(i),a=(0,e.gn)(i);return new e.U(a,s,0,s.multiply(new e.nt(-1)),a,0,0,0,1)})}getNormalizedAngle(t){const i=(0,e.LC)(this.rotationType,new e.nt(D.H_.Arithmatic));return(0,e.Tk)(i,new e.nt(90).subtract(t),t)}}(0,o._)([(0,r.Pi)(e.nt)],B.prototype,"rotationType",void 0);class Z extends r.k2{getSize(t,i){const s=this.minMaxValueAndSize.xy,a=this.minMaxValueAndSize.zw;return(0,e.Tk)((0,P.M8)(t),i,()=>{const u=t.subtract(s.x).divide(s.y.subtract(s.x)),d=(0,e.qE)(u,new e.nt(0),new e.nt(1));return a.x.add(d.multiply(a.y.subtract(a.x)))})}}(0,o._)([(0,r.Pi)(e.Zb)],Z.prototype,"minMaxValueAndSize",void 0);class I extends r.k2{getSizeForViewScale(t){return(0,e.j1)([(0,e.$5)(t,this.values.first()),this.sizes.first()],[(0,e.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const i=this.values.findIndex(p=>(0,e.MM)(p,t)),s=this.values.get(i),a=i.subtract(1),u=this.values.get(a),d=t.subtract(u).divide(s.subtract(u));return(0,e.jh)(this.sizes.get(a),this.sizes.get(i),d)}])}}(0,o._)([(0,r.Pi)(e.My.ofType(e.nt,8))],I.prototype,"sizes",void 0),(0,o._)([(0,r.Pi)(e.My.ofType(e.nt,8))],I.prototype,"values",void 0);class te extends r.k2{getSize(t,i){const s=(0,e.j1)([(0,P.M8)(t),i],[(0,e.$5)(t,this.values.first()),this.sizes.first()],[(0,e.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const a=this.values.findIndex(x=>(0,e.MM)(x,t)),u=this.values.get(a),d=a.subtract(1),p=this.values.get(d),h=t.subtract(p).divide(u.subtract(p));return(0,e.jh)(this.sizes.get(d),this.sizes.get(a),h)}]);return(0,e.Tk)((0,P.M8)(s),i,s)}}(0,o._)([(0,r.Pi)(e.My.ofType(e.nt,8))],te.prototype,"sizes",void 0),(0,o._)([(0,r.Pi)(e.My.ofType(e.nt,8))],te.prototype,"values",void 0);class fe extends r.k2{getSize(t,i){return(0,e.Tk)((0,P.M8)(t),i,t.multiply(this.unitValueToPixelsRatio))}}function V(l){return null!=l.visualVariableSizeMinMaxValue||null!=l.visualVariableSizeScaleStops||null!=l.visualVariableSizeStops||null!=l.visualVariableSizeUnitValue}function c(l,t,i){if(V(l)){const s=l.storage.getSizeValue(t);return l.visualVariableSizeMinMaxValue?.getSize(s,i)??l.visualVariableSizeScaleStops?.getSizeForViewScale(l.view.currentScale)??l.visualVariableSizeStops?.getSize(s,i)??l.visualVariableSizeUnitValue?.getSize(s,i)}return i}function O(l,t,i,s=new e.x(!1)){if(null==l.visualVariableColor)return i;const a=l.storage.getColorValue(t);return l.visualVariableColor.getColor(a,i,s)}function M(l,t){if(null==l.visualVariableOpacity)return new e.nt(1);const i=l.storage.getOpacityValue(t);return l.visualVariableOpacity.getOpacity(i)}function q(l,t){if(null==l.visualVariableRotation)return e.U.identity();const i=l.storage.getRotationValue(t);return l.visualVariableRotation.getVVRotationMat3(i)}(0,o._)([(0,r.Pi)(e.nt)],fe.prototype,"unitValueToPixelsRatio",void 0);class he extends ${}(0,o._)([(0,r.C5)(3,e.Zb)],he.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,o._)([(0,r.C5)(4,e.ZY)],he.prototype,"zoomRange",void 0);class Pe extends k{}class ve extends g{_getScreenPosition(t){const{pos:i,translation:s,rotation:a,scale:u,offset:d,id:p,vvScale:h}=t,x=function ie(l,t){if(null==l.visualVariableRotation)return new e.nt(0);const i=l.storage.getRotationValue(t);return l.visualVariableRotation.getNormalizedAngle(i)}(this,p).multiply(Math.PI/180),v=s.x.multiply(4/3),_=s.y.multiply(-1).multiply(4/3),E=(0,e.F8)(x),L=(0,e.gn)(x),j=L.multiply(v).add((0,e.ze)(E).multiply(_)),G=E.multiply(v).add(L.multiply(_)),W=(0,e.F8)(a.subtract(x)),Q=(0,e.gn)(a.subtract(x)),X=new e.nt(0),ce=new e.nt(1),{pixelRatio:ye}=this.animationInfo,ne=new e.U(ce,X,X,X,ce,X,j.multiply(ye),G.multiply(ye),ce),ae=new e.U(Q,W.multiply(-1),X,W,Q,X,0,0,ce),ue=u.multiply(h).multiply(ye).multiply(4/3),le=ae.multiply(ue),H=this.animationInfo.toScreen.multiply(new e.eB(i,1)),lt=ne.multiply(H).xy,qe=le.multiply(new e.eB(d,0)).xy;return lt.add(qe)}_clip(t,i){let s=super.clip(t,i);const a=(0,e.$5)(this._getLocalTimeOrigin(t),new e.nt(0));return me.H.forceGlobalTimeOrigin||(s=s.add((0,e.j1)([a,()=>new e.nt(2)],[!0,()=>new e.nt(0)]))),s}_getLocalTimeOrigin(t){return this.storage.getLocalTimeOrigin(t)}_toNdc(t){return this.animationInfo.toNdc.multiply(new e.eB(t,1)).xy}_getEvalParams(t,i){const{globalTime:s,animationTextureSize:a,animationTexture:u}=this.animationInfo;return{globalTime:s,localTimeOrigin:this._getLocalTimeOrigin(t.id),animationTextureSize:a,animationTexture:u,pixelDimensions:i}}_getColor(t,i){return(0,e.Tk)((0,e.LC)(i.isSDF,new e.nt(1)),this._getSDFColor(t,i),this._getSpriteColor(t,i))}_getSpriteColor(t,i){return(0,e.US)(this.mosaicInfo.texture,t).multiply(i.color)}_getSDFColor(t,i){const s=(0,e.US)(this.mosaicInfo.texture,t),a=new e.nt(.5).subtract((0,P.Rj)(s)).multiply(i.distanceToPx).multiply(D.V5),u=(0,e.qE)(new e.nt(.5).subtract(a),new e.nt(0),new e.nt(1)),d=i.color.multiply(u),p=i.outlineSize.multiply(.5),h=(0,e.tn)(a).subtract(p),x=(0,e.qE)(new e.nt(.5).subtract(h),new e.nt(0),new e.nt(1)),v=i.outlineColor.multiply(x);return new e.nt(1).subtract(v.a).multiply(d).add(v)}}function Be(l,t,i){const s=l.add(new e.ZY(t,0)),a=(0,e.US)(i.animationTexture,s.add(.5).divide(i.animationTextureSize)).xy;return l=l.add(a),(0,e.om)({animationPointer:l,...i},e.Zb,null,u=>{const{out:d}=u;if(!d)throw new Error("out is null");return(0,pe.DW)({...u,out:d})})}(0,o._)([(0,r.Pi)(se)],ve.prototype,"mosaicInfo",void 0),(0,o._)([(0,r.Pi)(K)],ve.prototype,"animationInfo",void 0),(0,o._)([(0,r.uK)(R)],ve.prototype,"visualVariableColor",void 0),(0,o._)([(0,r.uK)(S)],ve.prototype,"visualVariableOpacity",void 0),(0,o._)([(0,r.uK)(Z)],ve.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o._)([(0,r.uK)(I)],ve.prototype,"visualVariableSizeScaleStops",void 0),(0,o._)([(0,r.uK)(te)],ve.prototype,"visualVariableSizeStops",void 0),(0,o._)([(0,r.uK)(fe)],ve.prototype,"visualVariableSizeUnitValue",void 0),(0,o._)([(0,r.uK)(B)],ve.prototype,"visualVariableRotation",void 0),(l=Ie||(Ie={}))[l.transform=0]="transform",l[l.fromColor=1]="fromColor",l[l.toColor=2]="toColor",l[l.colorMix=3]="colorMix",l[l.toOpacity=4]="toOpacity",l[l.opacityMix=5]="opacityMix";var Ce=m(93300);function $e(l,t,i){const s=i.subtract(t),a=function pi(l,t){return(0,e.Om)(l,(0,e.S8)(t))}(l.subtract(t),s),u=(0,e.qE)(a.divide((0,e.Bw)(s)),new e.nt(0),new e.nt(1));return(0,e.Io)(l,t.add(u.multiply(i.subtract(t))))}function _e(l){const t=(0,e.tn)(l);return(0,e.PM)(t.x.add(t.y).add(t.z),new e.nt(1.05))}function ge(l,t,i,s){const a=new e.U(i.x.multiply(s.y).subtract(s.x.multiply(i.y)),s.x.multiply(t.y).subtract(t.x.multiply(s.y)),t.x.multiply(i.y).subtract(i.x.multiply(t.y)),i.y.subtract(s.y),s.y.subtract(t.y),t.y.subtract(i.y),s.x.subtract(i.x),t.x.subtract(s.x),i.x.subtract(t.x)),u=t.x.multiply(i.y.subtract(s.y)),d=i.x.multiply(s.y.subtract(t.y)),p=s.x.multiply(t.y.subtract(i.y)),h=u.add(d).add(p);return new e.nt(1).divide(h).multiply(a.multiply(new e.eB(1,l)))}function ci(l,t,i,s){return(0,e.LC)(_e(ge(l,t,i,s)),new e.nt(1))}function ut(l,t,i,s){const a=i.subtract(t),u=s.subtract(t),d=(0,P.tL)(a,u),p=(0,e.Uo)((0,e.Xe)(d,new e.nt(D.M)),(0,e.MM)(d,new e.nt(-.05)));return(0,e.j1)([(0,e.Uo)((0,e.AU)(p),ci(l.xy,t,i,s)),new e.nt(-1)],[!0,()=>{const h=$e(l,t,i),x=$e(l,i,s),v=$e(l,s,t);return(0,e.jk)((0,e.jk)(h,x),v)}])}function Ze(l){return l.distance.add(1)}function St(l,t,i){const{viewMat3:s,tileMat3:a}=l.view,u=s.multiply(a),d=u.multiply(new e.eB(t.pos,1)),p=u.multiply(new e.eB(i.nextPos1,1)),h=u.multiply(new e.eB(i.nextPos2,1));return ut(l.hittestRequest.position,d.xy,p.xy,h.xy)}class Xe extends he{}(0,o._)([(0,r.C5)(5,e.ZY)],Xe.prototype,"offset",void 0),(0,o._)([(0,r.C5)(6,e.ZY)],Xe.prototype,"uv",void 0),(0,o._)([(0,r.C5)(7,e.Zb)],Xe.prototype,"sizing",void 0),(0,o._)([(0,r.C5)(8,e.nt)],Xe.prototype,"angle",void 0);class Je extends r.Y7{}function Te(l,t,i,s){return t.multiply(l.x).add(i.multiply(l.y)).add(s.multiply(l.z))}(0,o._)([(0,r.C5)(12,e.ZY)],Je.prototype,"offsetNextVertex1",void 0),(0,o._)([(0,r.C5)(13,e.ZY)],Je.prototype,"offsetNextVertex2",void 0),(0,o._)([(0,r.C5)(14,e.ZY)],Je.prototype,"textureUVNextVertex1",void 0),(0,o._)([(0,r.C5)(15,e.ZY)],Je.prototype,"textureUVNextVertex2",void 0);class wt extends ve{constructor(){super(...arguments),this.type="AnimatedMarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(t){const{id:i,pos:s,offset:a,animationPointerAndBaseSizeAndReferenceSize:u,uv:d,sizing:p,angle:h}=t,x=u.xy,v=u.z,_=u.w,E=p.xy,L=p.z,j=(0,P.mh)(t.bitset,Ce.c.bitset.isStroke),G=p.w,W=(0,P.mh)(t.bitset,Ce.c.bitset.scaleSymbolsProportionally),Q=this._getEvalParams(t,E),X=Be(x,Ie.transform,Q),ce=(0,e.j1)([(0,e.LC)((0,P.mh)(t.bitset,Ce.c.bitset.isMapAligned),new e.nt(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new e.nt(0)]),ye=new e.Ny((0,e.gn)(ce),(0,e.F8)(ce.multiply(-1)),(0,e.F8)(ce),(0,e.gn)(ce)).multiply(X.xy),ne=X.z.subtract(ce).subtract(h.multiply(D.rp)),ae=X.w,ue=(0,P.mh)(t.bitset,Ce.c.bitset.isSDF),le=c(this,i,new e.nt(_)).divide(new e.nt(_));return{baseSize:v,animationPointer:x,strokeWidth:L,isOutline:j,unscaledDistanceToPx:G,scaleSymbolsProportionally:W,isSDF:ue,position:this._getScreenPosition({id:i,pos:s,offset:a,referenceSize:_,translation:ye,rotation:ne,scale:ae,vvScale:le}),uv:d,evalParams:Q,vvScale:le,scale:ae}}vertex(t,i){const{position:s,animationPointer:a,evalParams:u,isOutline:d,unscaledDistanceToPx:p,vvScale:h,uv:x,strokeWidth:v,scaleSymbolsProportionally:_,scale:E,isSDF:L,baseSize:j}=this._vertexPreamble(t),G=this._toNdc(s);let W=Be(a,Ie.fromColor,u);W=new e.Zb(W.rgb.multiply(W.a),W.a);let Q=Be(a,Ie.toColor,u);Q=new e.Zb(Q.rgb.multiply(Q.a),Q.a);let X=Be(a,Ie.colorMix,u);X=new e.Zb(X.rgb.multiply(X.a),X.a);const ce=Be(a,Ie.toOpacity,u).a,ye=Be(a,Ie.opacityMix,u).a,ne=O(this,t.id,W,(0,e.or)((0,P.K5)(t.bitset,Ce.c.bitset.colorLocked),new e.x(d))),ae=(0,e.jh)(ne,Q,X),ue=M(this,t.id),le=(0,e.jh)(ue,ce,ye),H=ae.multiply(le),lt=this.clip(t.id,t.zoomRange),qe=p.multiply(h);return{glPosition:new e.Zb(G,lt,1),uv:x.divide(this.mosaicInfo.size),color:H.multiply(new e.nt(1).subtract(d)),outlineColor:H.multiply(d),distanceToPx:qe,strokeWidth:v.multiply((0,e.jh)(new e.nt(1),E,_)),isOutline:d,isSDF:L,...this.maybeRunHittest(t,i,{pos:t.pos,size:j,sizeCorrection:new e.nt(1),isMapAligned:new e.nt(1),vvRotationMat3:new e.U(1,0,0,0,1,0,0,0,1),placementMat3:new e.U(1,0,0,0,1,0,0,0,1),outlineSize:new e.nt(1),distanceToPx:qe,isSDF:L})}}fragment(t){let i=this._getColor(t.uv,{color:t.color,distanceToPx:t.distanceToPx,isSDF:t.isSDF,outlineColor:t.outlineColor,outlineSize:t.strokeWidth});return me.H.spotlightAnimatedSymbols&&(i=i.add(new e.Zb(0,.3,0,.3))),this.getFragmentOutput(i,t)}hittest(t,i,s){return(0,e.Tk)((0,e.Xe)(s.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,i,s),this._hittestMarker(t,i,s))}_hittestSmallMarker(t,i,s){const{position:a,distance:u,smallSymbolDistance:d}=this.hittestRequest,p=u.subtract(d),{viewMat3:h,tileMat3:x}=this.view,v=h.multiply(x).multiply(new e.eB(s.pos,1)).xy,_=s.size.multiply(.5);return(0,e.Io)(v,a).subtract(_).add(p)}_hittestMarker(t,i,s){const a=this._vertexPreamble({...t}).position,u=this._vertexPreamble({...t,offset:i.offsetNextVertex1,uv:i.textureUVNextVertex1}).position,d=this._vertexPreamble({...t,offset:i.offsetNextVertex2,uv:i.textureUVNextVertex2}).position,h=this.hittestRequest.distance,x=ut(this.hittestRequest.position,a,u,d);return(0,e.Tk)((0,e.MM)(x,h),x,this._hittestSamples(a,u,d,t,i,s))}_hittestSamples(t,i,s,a,u,d){const{outlineSize:p,isSDF:h,distanceToPx:x}=d,v=this.hittestRequest.position,_=this.hittestRequest.distance,E=ge(v.add(new e.ZY((0,e.ze)(_),(0,e.ze)(_))),t,i,s),L=ge(v.add(new e.ZY(0,(0,e.ze)(_))),t,i,s),j=ge(v.add(new e.ZY(_,(0,e.ze)(_))),t,i,s),G=ge(v.add(new e.ZY((0,e.ze)(_),0)),t,i,s),W=ge(v,t,i,s),Q=ge(v.add(new e.ZY(_,0)),t,i,s),X=ge(v.add(new e.ZY((0,e.ze)(_),_)),t,i,s),ce=ge(v.add(new e.ZY(0,_)),t,i,s),ye=ge(v.add(new e.ZY(_,_)),t,i,s),ne=a.uv.divide(this.mosaicInfo.size),ae=u.textureUVNextVertex1.divide(this.mosaicInfo.size),ue=u.textureUVNextVertex2.divide(this.mosaicInfo.size),le={color:new e.Zb(1,1,1,1),outlineSize:p,outlineColor:new e.Zb(1,1,1,1),isSDF:h,distanceToPx:x};let H=new e.nt(0);return H=H.add(_e(E).multiply(this._getColor(Te(E,ne,ae,ue),le).a)),H=H.add(_e(L).multiply(this._getColor(Te(L,ne,ae,ue),le).a)),H=H.add(_e(j).multiply(this._getColor(Te(j,ne,ae,ue),le).a)),H=H.add(_e(G).multiply(this._getColor(Te(G,ne,ae,ue),le).a)),H=H.add(_e(W).multiply(this._getColor(Te(W,ne,ae,ue),le).a)),H=H.add(_e(Q).multiply(this._getColor(Te(Q,ne,ae,ue),le).a)),H=H.add(_e(X).multiply(this._getColor(Te(X,ne,ae,ue),le).a)),H=H.add(_e(ce).multiply(this._getColor(Te(ce,ne,ae,ue),le).a)),H=H.add(_e(ye).multiply(this._getColor(Te(ye,ne,ae,ue),le).a)),(0,e.PM)(H,new e.nt(.05)).multiply(Ze(this.hittestRequest))}}(0,o._)([(0,o.a)(0,(0,r.hF)(Xe)),(0,o.a)(1,(0,r.hF)(Je))],wt.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class mi extends Pe{}))],wt.prototype,"fragment",null);var Et=m(31610),Ft=m(12273),fi=m(14089);class be extends fi.j{constructor(){super(...arguments),this.symbologyPlane=F.uC.FILL,this._input=null}}var w=m(23070);class yi extends be{render(t,i){const{context:s,painter:a}=t,{target:u}=i,{freezeGlobalTime:d}=me.H,h=a.textureManager.animationStore.getTexture(s,0),x=[2/t.state.size[0],0,0,0,-2/t.state.size[1],0,-1,1,1],v=Array.from((0,Et.B8)((0,Ft.vt)(),x)),_=Array.from((0,Et.lw)((0,Ft.vt)(),v,u.transforms.displayViewScreenMat3)),E=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,E.uniforms),...(0,w.QA)(t,i.target),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey,!0),animationInfo:{globalTime:!1===d?t.time/1e3:d,animationTextureSize:[h.descriptor.width,h.descriptor.height],animationTexture:{unit:6,texture:h},toScreen:_,toNdc:x,mapRotation:t.state.rotation,pixelRatio:t.state.pixelRatio}},defines:{...(0,w.vT)(t)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0}),a.setPipelineState({...(0,w.Qu)(t)}),a.submitDraw(t,i),!1===d&&u.requestRender()}}class It extends r.ZA{}(0,o._)([(0,r.C5)(0,e.ZY)],It.prototype,"pos",void 0);class Lt extends r.k2{}(0,o._)([(0,r.Pi)(e.nt)],Lt.prototype,"dotSize",void 0);class dt extends r.k2{}(0,o._)([(0,r.Pi)(e.z7)],dt.prototype,"locations",void 0),(0,o._)([(0,r.Pi)(e.nt)],dt.prototype,"pixelRatio",void 0),(0,o._)([(0,r.Pi)(e.nt)],dt.prototype,"tileZoomFactor",void 0);class ke extends r.A{constructor(){super(...arguments),this.type="DotDensityPointShader"}vertex(t){const i=new e.U(1,0,0,0,-1,0,0,1,1).multiply(new e.eB(t.pos.xy.divide(C.CQ),1)),s=(0,e.US)(this.draw.locations,i.xy),a=(0,e.T9)(this.instance.dotSize.divide(2),new e.nt(1));let u=new e.nt(0);u=u.add((0,e.PM)(s.a,new e.nt(1e-6)).multiply(2));let d=a.add(this.instance.dotSize);const p=this.view.displayViewScreenMat3.multiply(new e.eB(t.pos.add(.5),1)),h=new e.Zb(p.xy,u,1),x=this.instance.dotSize.divide(d),v=new e.nt(-1).divide(a.divide(d));return d=d.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:h,glPointSize:d,color:s,ratio:x,invEdgeRatio:v}}fragment(t){const i=(0,e.Bw)(t.glPointCoord.subtract(.5)).multiply(2),s=(0,e.TF)(new e.nt(0),new e.nt(1),t.invEdgeRatio.multiply(i.subtract(t.ratio)).add(1)),a=new r.mm;return a.fragColor=t.color.multiply(s),a}}(0,o._)([(0,r.Pi)(Lt)],ke.prototype,"instance",void 0),(0,o._)([(0,r.Pi)(dt)],ke.prototype,"draw",void 0),(0,o._)([(0,r.Pi)(J)],ke.prototype,"view",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(It))],ke.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class _i extends k{}))],ke.prototype,"fragment",null);class Ut extends ${}(0,o._)([(0,r.C5)(3,e.nt)],Ut.prototype,"inverseArea",void 0);class pt extends r.k2{}(0,o._)([(0,r.Pi)(e.My.ofType(e.Zb,2))],pt.prototype,"isActive",void 0),(0,o._)([(0,r.Pi)(e.My.ofType(e.Zb,8))],pt.prototype,"colors",void 0),(0,o._)([(0,r.Pi)(e.nt)],pt.prototype,"dotValue",void 0);class je extends r.k2{}(0,o._)([(0,r.Pi)(e.z7)],je.prototype,"dotTexture0",void 0),(0,o._)([(0,r.Pi)(e.z7)],je.prototype,"dotTexture1",void 0),(0,o._)([(0,r.Pi)(e.nt)],je.prototype,"tileZoomFactor",void 0),(0,o._)([(0,r.Pi)(e.nt)],je.prototype,"pixelRatio",void 0),(0,o._)([(0,r.Pi)(e.nt)],je.prototype,"tileDotsOverArea",void 0);class He extends g{constructor(){super(...arguments),this.type="DotDensityPolygonShader"}_dotThreshold(t,i,s){return t.divide(i).divide(s)}vertex(t){const i=new e.U(2/C.CQ,0,0,0,-2/C.CQ,0,-1,1,1).multiply(new e.eB(t.pos,1)),s=this.clip(t.id),a=new e.Zb(i.xy,s,1),u=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),d=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),p=this.draw.tileZoomFactor.multiply(C.CQ).divide(this.draw.pixelRatio),h=this._dotThreshold(u,this.instance.dotValue,this.draw.tileDotsOverArea),x=this._dotThreshold(d,this.instance.dotValue,this.draw.tileDotsOverArea),v=t.pos.add(.5).divide(p);return{glPosition:a,color:new e.Zb(0,0,0,0),textureCoords:v,thresholds0:h,thresholds1:x}}fragment(t){const i=new r.mm,s=(0,e.US)(this.draw.dotTexture0,t.textureCoords),a=(0,e.US)(this.draw.dotTexture1,t.textureCoords),u=t.thresholds0.subtract(s),d=t.thresholds1.subtract(a);let p;const h=e.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),x=e.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const v=(0,e.PM)(new e.nt(0),u),_=(0,e.PM)(new e.nt(0),d),E=(0,e.Om)(v,u).add((0,e.Om)(_,d)),L=(0,e.PM)(E,new e.nt(0)),j=new e.nt(1).subtract(L),G=E.add(L),W=u.multiply(v).divide(G),Q=d.multiply(_).divide(G),X=h.multiply(W).add(x.multiply(Q));p=j.multiply(X)}else{const v=(0,e.T9)((0,P.xf)(u),(0,P.xf)(d)),_=(0,e.PM)(v,new e.nt(0)),E=new e.nt(1).subtract(_),L=(0,e.PM)(v,u),j=(0,e.PM)(v,d),G=h.multiply(L).add(x.multiply(j));p=E.multiply(G)}return i.fragColor=p,i}hittest(t){return Ze(this.hittestRequest)}}(0,o._)([r.E8],He.prototype,"blending",void 0),(0,o._)([(0,r.Pi)(pt)],He.prototype,"instance",void 0),(0,o._)([(0,r.Pi)(je)],He.prototype,"draw",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Ut))],He.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(k))],He.prototype,"fragment",null);var bi=m(40707),xi=m(39784),Y=m(50915),Bt=m(79061),Si=m(17107),Zt=m(49950),kt=m(76169),ct=m(4931);const wi={pos:{count:2,type:Y.pe.UNSIGNED_SHORT}};class Pi{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(t){if(null==this._dotFBO){const i=C.CQ,s=C.CQ,a=new ct.R(i,s);a.samplingMode=Y.Cj.NEAREST,a.wrapMode=Y.pF.CLAMP_TO_EDGE;const u=new Si.l(t,new Zt.q(Y.yQ.DEPTH_STENCIL,i,s));this._dotFBO=new Bt.H(t,a,u)}return this._dotFBO}getDotDensityMesh(t){if(null==this._dotMesh){const i=C.CQ,s=i*i,a=2,u=new Int16Array(s*a);for(let d=0;d<i;d++)for(let p=0;p<i;p++)u[a*(p+d*i)]=p,u[a*(p+d*i)+1]=d;this._dotMesh=xi.g.create(t,{primitive:Y.WR.POINTS,vertex:u,count:s,layout:wi})}return this._dotMesh}getDotDensityTextures(t,i,s){if(this._dotTextureSize===i&&this._seed===s||(this._disposeTextures(),this._dotTextureSize=i,this._seed=s),null===this._dotTextures){const a=new bi.A(s);this._dotTextures=[this._allocDotDensityTexture(t,i,a),this._allocDotDensityTexture(t,i,a)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}}_allocDotDensityTexture(t,i,s){const a=new Float32Array(i*i*4);for(let d=0;d<a.length;d++)a[d]=s.getFloat();const u=new ct.R;return u.dataType=Y.ld.FLOAT,u.samplingMode=Y.Cj.NEAREST,u.width=i,u.height=i,new kt.g(t,u,a)}}class Ke extends ${}(0,o._)([(0,r.C5)(3,e.Zb)],Ke.prototype,"color",void 0),(0,o._)([(0,r.C5)(4,e.ZY)],Ke.prototype,"zoomRange",void 0);class Ae extends g{constructor(){super(...arguments),this.type="FillShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,i){const s=M(this,t.id),a=O(this,t.id,t.color).multiply(s),u=this.view.displayViewScreenMat3.multiply(new e.eB(t.pos.xy,1)),d=this.clip(t.id,t.zoomRange);return{glPosition:new e.Zb(u.xy,d,1),color:a,...this.maybeRunHittest(t,i,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new e.nt(0))}hittest(t,i){return St(this,t,i)}}(0,o._)([(0,r.uK)(R)],Ae.prototype,"visualVariableColor",void 0),(0,o._)([(0,r.uK)(S)],Ae.prototype,"visualVariableOpacity",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Ke)),(0,o.a)(1,(0,r.hF)(U))],Ae.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(k))],Ae.prototype,"fragment",null);class Ye extends r.k2{getPatternOffsetAtTileOrigin(t,i=new e.nt(0),s=new e.nt(1)){const a=new e.ZY(D.YV).divide(t);let u=t.multiply((0,e.jc)(this.maxIntsToLocalOrigin.multiply(a))).add(this.tileOffsetFromLocalOrigin).subtract(new e.nt(.5).multiply(t));return u=new e.ZY(u.x.multiply(s).subtract(u.y.multiply(i)),u.x.multiply(i).add(u.y.multiply(s))),(0,e.zi)(u,t)}}(0,o._)([(0,r.Pi)(e.ZY)],Ye.prototype,"tileOffsetFromLocalOrigin",void 0),(0,o._)([(0,r.Pi)(e.ZY)],Ye.prototype,"maxIntsToLocalOrigin",void 0);class Ue extends Ke{}function jt(l,t){const i=l.view.requiredZoomFactor,s=new e.ZY(t.width,t.height),a=s.multiply(t.scale).multiply(i),u=t.angle.multiply(D.rp),d=(0,e.F8)(u),p=(0,e.gn)(u),h=function zi(l,t,i,s,a){const u=(0,e.LC)((0,P.mh)(a,D.Fz),(0,e.fV)(1)),d=(0,P.Rj)(new e.Zb(l,0));return(0,e.Tk)(u,(0,e.w0)(s.divide(t.x),i.divide(t.y),0,(0,e.ze)(i.divide(t.x)),s.divide(t.y),0,(0,P._9)((0,e.Zc)(d,0)),(0,P._9)((0,e.Zc)(0,d)),1),(0,e.w0)(s.divide(t.x),i.divide(t.y),0,(0,e.ze)(i.divide(t.x)),s.divide(t.y),0,0,0,1))}(t.id,a,d,p,t.bitset),x=l.localTileOffset.getPatternOffsetAtTileOrigin(s,d,p),v=i.multiply(t.scale).multiply(t.offset.subtract(x)).divide(a),_=new e.eB(t.pos,1),E=h.multiply(_).xy.subtract(v),L=t.tlbr.divide(l.mosaicInfo.size.xyxy);let j=(0,P.mh)(t.bitset,D.cn);return null!=l.visualVariableColor&&(j=(0,e.Tk)((0,P.M8)(l.storage.getColorValue(t.id)),new e.nt(0),j)),{tileTextureCoord:E,tlbr:L,sampleAlphaOnly:j}}function Ht(l,t){const i=(0,e.zi)(t.tileTextureCoord,new e.nt(1)),s=(0,e.jh)(t.tlbr.xy,t.tlbr.zw,i);let a=(0,e.US)(l.mosaicInfo.texture,s);return a=(0,e.Tk)((0,e.MM)(t.sampleAlphaOnly,new e.nt(.5)),a.aaaa,a),t.color.multiply(a)}(0,o._)([(0,r.C5)(5,e.Zb)],Ue.prototype,"tlbr",void 0),(0,o._)([(0,r.C5)(6,e.nt)],Ue.prototype,"width",void 0),(0,o._)([(0,r.C5)(7,e.nt)],Ue.prototype,"height",void 0),(0,o._)([(0,r.C5)(8,e.ZY)],Ue.prototype,"offset",void 0),(0,o._)([(0,r.C5)(9,e.ZY)],Ue.prototype,"scale",void 0),(0,o._)([(0,r.C5)(10,e.nt)],Ue.prototype,"angle",void 0);class et extends Ae{constructor(){super(...arguments),this.type="ComplexFillShader"}vertex(t,i){return{...super.vertex(t,i),...jt(this,t)}}fragment(t){const i=Ht(this,t);return this.getFragmentOutput(i,t,new e.nt(0))}}function Ne(l){const t=1/l;return{antialiasing:t,blur:0+t}}(0,o._)([(0,r.Pi)(se)],et.prototype,"mosaicInfo",void 0),(0,o._)([(0,r.Pi)(Ye)],et.prototype,"localTileOffset",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Ue)),(0,o.a)(1,(0,r.hF)(U))],et.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class Mi extends k{}))],et.prototype,"fragment",null);class Oe extends ${}(0,o._)([(0,r.C5)(3,e.Zb)],Oe.prototype,"color",void 0),(0,o._)([(0,r.C5)(4,e.ZY)],Oe.prototype,"offset",void 0),(0,o._)([(0,r.C5)(5,e.ZY)],Oe.prototype,"normal",void 0),(0,o._)([(0,r.C5)(6,e.nt)],Oe.prototype,"halfWidth",void 0),(0,o._)([(0,r.C5)(7,e.nt)],Oe.prototype,"referenceHalfWidth",void 0),(0,o._)([(0,r.C5)(8,e.ZY)],Oe.prototype,"zoomRange",void 0);class Kt extends k{}class ht extends r.k2{}function Yt(l){return(0,e.T9)(new e.nt(D.Fb).multiply((0,e.PM)(l,new e.nt(D.J5))),new e.nt(1))}function Pt(l,t){const{halfWidth:i,normal:s}=l,a=Yt(i),u=(0,e.Bw)(s).multiply(i);return(0,e.qE)(a.multiply(i.subtract(u)).divide(t.add(a).subtract(new e.nt(1))),new e.nt(0),new e.nt(1))}function mt(l,t){const{id:i,offset:s,pos:a,normal:u,zoomRange:d}=t,{displayViewScreenMat3:p,displayViewMat3:h}=l.view,x=O(l,i,t.color),v=M(l,i),_=function Ti(l,t){const{id:i,halfWidth:s,referenceHalfWidth:a}=t;if(V(l)){const d=c(l,i,new e.nt(2).multiply(a));return new e.nt(.5).multiply(s.divide((0,e.T9)(a,new e.nt(D.Ni)))).multiply(d)}return s}(l,t),E=new e.nt(.5).multiply(l.antialiasingControls.antialiasing),L=(0,e.T9)(_.add(E),new e.nt(.45)).add(new e.nt(.1).multiply(E)),j=Yt(L).multiply(L).multiply(s),G=h.multiply(new e.eB(j,new e.nt(0))),W=p.multiply(new e.eB(a,new e.nt(1))).add(G),Q=new e.nt(2).multiply((0,e.PM)(_,new e.nt(0))).add(l.clip(i,d)),X=new e.Zb(W.xy,Q,1);return{color:x,opacity:v,halfWidth:L,normal:u,scaledOffset:j,scaledHalfWidth:_,glPosition:new e.Zb(X.xy,Q,1)}}function ft(l,t){const{opacity:i,color:s}=l,a=Pt(l,t);return i.multiply(s).multiply(a)}(0,o._)([(0,r.Pi)(e.nt)],ht.prototype,"antialiasing",void 0),(0,o._)([(0,r.Pi)(e.nt)],ht.prototype,"blur",void 0);class Ve extends g{constructor(){super(...arguments),this.type="LineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,i){const s=mt(this,t);return{...s,...this.maybeRunHittest(t,i,s.halfWidth)}}fragment(t){const i=ft(t,this.antialiasingControls.blur);return this.getFragmentOutput(i,t)}hittest(t,i,s){const{viewMat3:a,tileMat3:u}=this.view,d=a.multiply(u),p=d.multiply(new e.eB(t.pos,1)),h=d.multiply(new e.eB(i.nextPos1,1)),x=d.multiply(new e.eB(i.nextPos2,1)),{distance:v,smallSymbolDistance:_,smallSymbolSizeThreshold:E}=this.hittestRequest,L=(0,e.PM)(s,E.multiply(.5)).multiply(v.subtract(_)),j=this.hittestRequest.position;return(0,e.jk)($e(j,p.xy,h.xy),$e(j,p.xy,x.xy)).subtract(s).add(L)}}(0,o._)([(0,r.Pi)(ht)],Ve.prototype,"antialiasingControls",void 0),(0,o._)([(0,r.uK)(R)],Ve.prototype,"visualVariableColor",void 0),(0,o._)([(0,r.uK)(S)],Ve.prototype,"visualVariableOpacity",void 0),(0,o._)([(0,r.uK)(Z)],Ve.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o._)([(0,r.uK)(I)],Ve.prototype,"visualVariableSizeScaleStops",void 0),(0,o._)([(0,r.uK)(te)],Ve.prototype,"visualVariableSizeStops",void 0),(0,o._)([(0,r.uK)(fe)],Ve.prototype,"visualVariableSizeUnitValue",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Oe)),(0,o.a)(1,(0,r.hF)(U))],Ve.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(Kt))],Ve.prototype,"fragment",null);class Le extends ${}(0,o._)([(0,r.C5)(3,e.ZY)],Le.prototype,"offset",void 0),(0,o._)([(0,r.C5)(4,e.Zb)],Le.prototype,"color",void 0),(0,o._)([(0,r.C5)(5,e.ZY)],Le.prototype,"normal",void 0),(0,o._)([(0,r.C5)(6,e.nt)],Le.prototype,"halfWidth",void 0),(0,o._)([(0,r.C5)(7,e.nt)],Le.prototype,"referenceHalfWidth",void 0),(0,o._)([(0,r.C5)(8,e.ZY)],Le.prototype,"zoomRange",void 0);class Nt extends Kt{}function Vt(l,t,i){const{id:s,bitset:a}=t,u=(0,P.mh)(a,D.Xx),d=(0,e.MM)(u,new e.nt(.5)),p=mt(l,t),h=(0,e.Tk)(d,p.halfWidth,new e.nt(0)),x=M(l,s),v=O(l,s,t.color),_=(0,e.Tk)(d,t.color,v.multiply(x)),E=l.view.displayViewScreenMat3.multiply(new e.eB(t.pos.xy,1)),L=l.clip(t.id),j=new e.Zb(E.xy,L,1),G=(0,e.Tk)(d,p.glPosition,j),W=i&&l.maybeRunHittest(t,i,d);return{isOutline:u,color:_,opacity:new e.nt(1),halfWidth:h,normal:p.normal,glPosition:G,...W}}class De extends g{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,o._)([(0,r.Pi)(ht)],De.prototype,"antialiasingControls",void 0),(0,o._)([(0,r.uK)(R)],De.prototype,"visualVariableColor",void 0),(0,o._)([(0,r.uK)(S)],De.prototype,"visualVariableOpacity",void 0),(0,o._)([(0,r.uK)(Z)],De.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o._)([(0,r.uK)(I)],De.prototype,"visualVariableSizeScaleStops",void 0),(0,o._)([(0,r.uK)(te)],De.prototype,"visualVariableSizeStops",void 0),(0,o._)([(0,r.uK)(fe)],De.prototype,"visualVariableSizeUnitValue",void 0);class yt extends De{constructor(){super(...arguments),this.type="OutlineFillShader"}vertex(t,i){return Vt(this,t,i)}fragment(t){const{color:i,isOutline:s}=t,a=(0,e.MM)(s,new e.nt(.5)),u=ft(t,this.antialiasingControls.blur),d=(0,e.Tk)(a,u,i),p=(0,e.Tk)(a,new e.nt(1/255),new e.nt(0));return this.getFragmentOutput(d,t,p)}hittest(t,i,s){return(0,e.Tk)(s,Ze(this.hittestRequest),St(this,t,i))}}(0,o._)([(0,o.a)(0,(0,r.hF)(Le)),(0,o.a)(1,(0,r.hF)(U))],yt.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(Nt))],yt.prototype,"fragment",null);class Mt extends Ke{}function Wt(l,t){const i=t.tlbr.xy,s=t.tlbr.zw,a=s.x.subtract(i.x),u=i.y.subtract(s.y),d=new e.ZY(a,u).multiply(t.inverseRasterizationScale),p=d.multiply(l.view.requiredZoomFactor),h=function Oi(l){const t=new e.nt(1),i=new e.nt(0);return new e.U(t.divide(l.x),i.divide(l.y),0,(0,e.ze)(i.divide(l.x)),t.divide(l.y),0,0,0,1)}(p),x=l.localTileOffset.getPatternOffsetAtTileOrigin(d).divide(p),v=new e.eB(t.pos,1);return{tileTextureCoord:h.multiply(v).xy.subtract(x),tlbr:t.tlbr.divide(l.mosaicInfo.size.xyxy)}}function Gt(l,t){const i=(0,e.zi)(l.tileTextureCoord,new e.nt(1)),s=(0,e.jh)(l.tlbr.xy,l.tlbr.zw,i),a=(0,e.US)(t.texture,s);return l.color.multiply(a)}(0,o._)([(0,r.C5)(5,e.Zb)],Mt.prototype,"tlbr",void 0),(0,o._)([(0,r.C5)(6,e.nt)],Mt.prototype,"inverseRasterizationScale",void 0);class tt extends Ae{constructor(){super(...arguments),this.type="PatternFillShader"}vertex(t,i){return{...super.vertex(t,i),...Wt(this,t)}}fragment(t){const i=Gt(t,this.mosaicInfo);return this.getFragmentOutput(i,t,new e.nt(0))}}(0,o._)([(0,r.Pi)(se)],tt.prototype,"mosaicInfo",void 0),(0,o._)([(0,r.Pi)(Ye)],tt.prototype,"localTileOffset",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Mt)),(0,o.a)(1,(0,r.hF)(U))],tt.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class Ai extends k{}))],tt.prototype,"fragment",null);class zt extends Le{}(0,o._)([(0,r.C5)(9,e.Zb)],zt.prototype,"tlbr",void 0),(0,o._)([(0,r.C5)(10,e.nt)],zt.prototype,"inverseRasterizationScale",void 0);class Qt extends Nt{}class it extends yt{constructor(){super(...arguments),this.type="PatternOutlineFillShader"}vertex(t,i){return{...Vt(this,t,i),...Wt(this,t)}}fragment(t){const{isOutline:i}=t,s=(0,e.MM)(i,new e.nt(.5)),a=ft(t,this.antialiasingControls.blur),u=Gt(t,this.mosaicInfo),d=(0,e.Tk)(s,a,u),p=(0,e.Tk)(s,new e.nt(1/255),new e.nt(0));return this.getFragmentOutput(d,t,p)}}(0,o._)([(0,r.Pi)(se)],it.prototype,"mosaicInfo",void 0),(0,o._)([(0,r.Pi)(Ye)],it.prototype,"localTileOffset",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(zt)),(0,o.a)(1,(0,r.hF)(U))],it.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(Qt))],it.prototype,"fragment",null);const qt=1/D.cZ;class Re extends ${}(0,o._)([(0,r.C5)(3,e.Zb)],Re.prototype,"color",void 0),(0,o._)([(0,r.C5)(4,e.Zb)],Re.prototype,"tlbr",void 0),(0,o._)([(0,r.C5)(5,e.nt)],Re.prototype,"angle",void 0),(0,o._)([(0,r.C5)(6,e.nt)],Re.prototype,"aux1",void 0),(0,o._)([(0,r.C5)(7,e.nt)],Re.prototype,"aux2",void 0),(0,o._)([(0,r.C5)(8,e.ZY)],Re.prototype,"aux3",void 0),(0,o._)([(0,r.C5)(9,e.ZY)],Re.prototype,"aux4",void 0),(0,o._)([(0,r.C5)(10,e.ZY)],Re.prototype,"zoomRange",void 0);class st extends De{constructor(){super(...arguments),this.type="ComplexOutlineFillShader"}vertex(t,i){const{aux1:s,aux2:a,aux3:u,aux4:d}=t,p={...t,width:s,height:a,offset:u,scale:d.multiply(qt)},x=Vt(this,{...t,halfWidth:s,referenceHalfWidth:a,offset:u,normal:d.subtract(D.v9).multiply(qt)}),v=jt(this,p),_=(0,e.MM)(x.isOutline,new e.nt(.5));return{...x,...v,...this.maybeRunHittest(t,i,_)}}fragment(t){const{isOutline:i}=t,s=(0,e.MM)(i,new e.nt(.5)),a=ft(t,this.antialiasingControls.blur),u=Ht(this,t),d=(0,e.Tk)(s,a,u),p=(0,e.Tk)(s,new e.nt(1/255),new e.nt(0));return this.getFragmentOutput(d,t,p)}hittest(t,i,s){return(0,e.Tk)(s,Ze(this.hittestRequest),St(this,t,i))}}(0,o._)([(0,r.Pi)(se)],st.prototype,"mosaicInfo",void 0),(0,o._)([(0,r.Pi)(Ye)],st.prototype,"localTileOffset",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Re)),(0,o.a)(1,(0,r.hF)(U))],st.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class Di extends Qt{}))],st.prototype,"fragment",null);var vt=m(87187);class rt extends Ke{}(0,o._)([(0,r.C5)(5,e.Zb)],rt.prototype,"tlbr",void 0),(0,o._)([(0,r.C5)(6,e.ZY)],rt.prototype,"relativePosition",void 0),(0,o._)([(0,r.C5)(7,e.nt)],rt.prototype,"gradientMethod",void 0),(0,o._)([(0,r.C5)(8,e.ZY)],rt.prototype,"relativeGradientSize",void 0);class _t extends Ae{constructor(){super(...arguments),this.type="GradientFillShader"}vertex(t,i){const{tlbr:s,relativePosition:a,gradientMethod:u,relativeGradientSize:d}=t,p=(0,e.Tk)((0,P.K5)(t.bitset,vt.Q.isAbsolute),this.view.displayZoomFactor,new e.nt(1));return{...super.vertex(t,i),tlbr:s,relativePosition:a,gradientMethod:u,gradientSize:d.multiply(p),isDiscrete:(0,P.mh)(t.bitset,vt.Q.isDiscrete)}}fragment(t){const{tlbr:i,relativePosition:s,gradientMethod:a,gradientSize:u,isDiscrete:d}=t,p=(0,e.Tk)((0,e.MM)(d,new e.nt(.5)),u.subtract(1),new e.ZY(0)),h=(0,e.j1)([(0,e.LC)(a,new e.nt(vt.m.rectangular)),()=>{const L=(0,e.tn)(s).add(p).divide(u);return(0,P.zb)((0,e.T9)(L.x,L.y))}],[(0,e.LC)(a,new e.nt(vt.m.circular)),(0,P.zb)((0,e.RZ)((0,e.Om)(s,s)).add(p.x).divide(u.x))],[!0,(0,P.zb)(s.x.add(p.x).divide(u.x))]),x=new e.ZY((0,e.qE)(h,new e.nt(0),new e.nt(1)),.5),v=(0,e.jh)(i.xy,i.zw,x).divide(this.mosaicInfo.size),_=(0,e.US)(this.mosaicInfo.texture,v);return this.getFragmentOutput(_.multiply(t.color.a),t,new e.nt(0))}}(0,o._)([(0,r.Pi)(se)],_t.prototype,"mosaicInfo",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(rt)),(0,o.a)(1,(0,r.hF)(U))],_t.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class Fi extends k{}))],_t.prototype,"fragment",null);var Zi=m(35150),$t=m(11432),Ct=m(5922);class Tt{constructor(t,i,s,a){this.dataType=t,this.samplingMode=i,this.pixelFormat=s,this.internalFormat=a}}new Tt(Y.ld.HALF_FLOAT,Y.Cj.NEAREST,Y.Ab.RGBA,Y.Ab.RGBA);class Hi{destroy(){this._accumulateFramebuffer=(0,$t.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,$t.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(t){if(null==this._qualityProfile){const i=function ki(l,t){const{textureFloatLinear:i,colorBufferFloat:s}=l.capabilities,a=s?.textureFloat,u=s?.textureHalfFloat,d=s?.floatBlend,p=l.driverTest.floatBufferBlend.result;if(!a&&!u)throw new Ct.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(d&&p||u))throw new Ct.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(p?"":" This device claims support for EXT_float_blend, but does not actually support it."));const h=a&&d&&p,x=u,v=i,_=!!s?.R32F,E=!!s?.R16F;if(h&&v)return v||t.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new Tt(Y.ld.FLOAT,v?Y.Cj.LINEAR:Y.Cj.NEAREST,_?Y.Ab.RED:Y.Ab.RGBA,_?Y.H0.R32F:Y.Ab.RGBA);if(x)return new Tt(Y.ld.HALF_FLOAT,Y.Cj.LINEAR,E?Y.Ab.RED:Y.Ab.RGBA,E?Y.H0.R16F:Y.Ab.RGBA);throw new Ct.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(t,Zi.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...i,defines:{usesHalfFloatPrecision:i.dataType!==Y.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(t,i,s){if(null==this._accumulateFramebuffer){const{dataType:a,samplingMode:u,pixelFormat:d,internalFormat:p}=this.loadQualityProfile(t),h=new ct.R(i,s);h.pixelFormat=d,h.internalFormat=p,h.dataType=a,h.samplingMode=u,h.wrapMode=Y.pF.CLAMP_TO_EDGE;const x=new Zt.q(Y.yQ.DEPTH_STENCIL,i,s);this._accumulateFramebuffer=new Bt.H(t,h,x)}else{const{width:a,height:u}=this._accumulateFramebuffer;a===i&&u===s||this._accumulateFramebuffer.resize(i,s)}return this._accumulateFramebuffer}ensureResolveGradientTexture(t,i,s){if(null==this._resolveGradientTexture){const a=new ct.R;a.wrapMode=Y.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new kt.g(t,a),this._prevGradientHash=null}return this._prevGradientHash!==i&&(this._resolveGradientTexture.resize(s.length/4,1),this._resolveGradientTexture.setData(s),this._prevGradientHash=i),this._resolveGradientTexture}}function Xt(l){return l?.25:1}class Jt extends ${}(0,o._)([(0,r.C5)(5,e.ZY)],Jt.prototype,"offset",void 0);class At extends r.k2{}(0,o._)([(0,r.Pi)(e.nt)],At.prototype,"radius",void 0),(0,o._)([(0,r.Pi)(e.nt)],At.prototype,"isFieldActive",void 0);class ot extends g{constructor(){super(...arguments),this.type="HeatmapAccumulateShader",this.usesHalfFloatPrecision=!1}vertex(t){const{radius:i,isFieldActive:s}=this.kernelControls,a=t.offset,u=s.multiply(this.storage.getVVData(t.id).x).add(new e.nt(1).subtract(s)),d=this.view.displayViewScreenMat3.multiply(new e.eB(t.pos,1)).add(this.view.displayViewMat3.multiply(new e.eB(a,0)).multiply(i)),p=this.clip(t.id);return{glPosition:new e.Zb(d.xy,p,1),offset:a,fieldValue:u,color:new e.Zb(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:i,fieldValue:s}=t,a=(0,e.Bw)(i),u=(0,e.PM)(a,new e.nt(1)),d=new e.nt(1).subtract(a.multiply(a)),p=d.multiply(d),h=u.multiply(p).multiply(s).multiply(new e.nt(Xt(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new e.Zb(h),t)}hittest(t){const{viewMat3:i,tileMat3:s}=this.view;return function hi(l,t,i){return(0,e.Io)(l,i).subtract(t)}(i.multiply(s).multiply(new e.eB(t.pos,1)).xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,o._)([r.E8],ot.prototype,"usesHalfFloatPrecision",void 0),(0,o._)([(0,r.Pi)(At)],ot.prototype,"kernelControls",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Jt))],ot.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class Ki extends k{}))],ot.prototype,"fragment",null);class ei extends r.ZA{}(0,o._)([(0,r.C5)(0,e.ZY)],ei.prototype,"position",void 0);class gt extends r.k2{}(0,o._)([(0,r.Pi)(e.z7)],gt.prototype,"texture",void 0),(0,o._)([(0,r.Pi)(e.ZY)],gt.prototype,"minAndInvRange",void 0),(0,o._)([(0,r.Pi)(e.nt)],gt.prototype,"normalization",void 0);class ti extends r.k2{}(0,o._)([(0,r.Pi)(e.z7)],ti.prototype,"texture",void 0);class We extends r.A{constructor(){super(...arguments),this.type="HeatmapResolveShader",this.usesHalfFloatPrecision=!1}vertex(t){return{glPosition:new e.Zb(t.position.multiply(2).subtract(1),1,1),uv:t.position}}fragment(t){const{accumulatedDensity:i,gradient:s}=this;let a=(0,e.US)(i.texture,t.uv).r.divide(new e.nt(Xt(this.usesHalfFloatPrecision)));a=a.multiply(i.normalization),a=a.subtract(i.minAndInvRange.x).multiply(i.minAndInvRange.y);const u=(0,e.US)(s.texture,new e.ZY(a,.5)),d=new r.mm;return d.fragColor=new e.Zb(u.rgb.multiply(u.a),u.a),d}}function ii(l){return l.key.level+1}(0,o._)([r.E8],We.prototype,"usesHalfFloatPrecision",void 0),(0,o._)([(0,r.Pi)(gt)],We.prototype,"accumulatedDensity",void 0),(0,o._)([(0,r.Pi)(ti)],We.prototype,"gradient",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(ei))],We.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class Yi extends r.HS{}))],We.prototype,"fragment",null);const si={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:ii,compare:Y.MT.GEQUAL,mask:255,op:{fail:Y.eA.KEEP,zFail:Y.eA.KEEP,zPass:Y.eA.REPLACE}}}},Gi={...si,stencil:!1},Qi={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function ri(l,t){const{referenceScale:i,radius:s}=l.uniforms;return s*(0!==i?i/t.scale:1)}var Se;!function(l){l[l.Color=0]="Color",l[l.Outline=1]="Outline",l[l.Halo=2]="Halo"}(Se||(Se={}));class Me extends ${}(0,o._)([(0,r.C5)(3,e.Zb)],Me.prototype,"color",void 0),(0,o._)([(0,r.C5)(4,e.ZY)],Me.prototype,"offset",void 0),(0,o._)([(0,r.C5)(5,e.ZY)],Me.prototype,"textureUV",void 0),(0,o._)([(0,r.C5)(6,e.nt)],Me.prototype,"fontSize",void 0),(0,o._)([(0,r.C5)(7,e.nt)],Me.prototype,"referenceSize",void 0),(0,o._)([(0,r.C5)(8,e.Zb)],Me.prototype,"outlineColor",void 0),(0,o._)([(0,r.C5)(9,e.Zb)],Me.prototype,"haloColor",void 0),(0,o._)([(0,r.C5)(10,e.ZY)],Me.prototype,"outlineAndHaloSize",void 0),(0,o._)([(0,r.C5)(11,e.ZY)],Me.prototype,"zoomRange",void 0),(0,o._)([(0,r.C5)(12,e.nt)],Me.prototype,"clipAngle",void 0),(0,o._)([(0,r.C5)(13,e.Zb)],Me.prototype,"referenceSymbol",void 0);class Ot extends r.Y7{}(0,o._)([(0,r.C5)(14,e.ZY)],Ot.prototype,"offsetNextVertex1",void 0),(0,o._)([(0,r.C5)(15,e.ZY)],Ot.prototype,"offsetNextVertex2",void 0);class xe extends g{constructor(){super(...arguments),this.type="TextShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=Se.Color,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(t,i,s){const a=i.multiply(1.4173228346456692),u=(0,e.tn)(this.view.rotation.subtract(a)),d=(0,e.jk)(new e.nt(360).subtract(u),u);let p=new e.nt(0);const h=(0,e.RI)(this.view.currentZoom.multiply(C.fq)).divide(C.fq),x=t.x,v=t.y,_=new e.nt(1).subtract((0,e.PM)(x,h)).multiply(2),E=(0,e.PM)(new e.nt(90),d).multiply(2),L=new e.nt(2).multiply(new e.nt(1).subtract((0,e.PM)(h,v)));return p=p.add(s.multiply(_)),p=p.add(s.multiply(E)),p=p.add(L),p}vertex(t,i){const s=(0,P.mh)(t.bitset,D.bg),a=new e.nt(1).subtract(s);let u=t.fontSize,d=u.divide(D.au);const p=this.textRenderPassType===Se.Outline?t.outlineColor:this.textRenderPassType===Se.Halo?t.haloColor:this._getVertexColor(t),h=this.isLabel?this.storage.getLabelVisibility(t.id):new e.nt(1),x=this.isLabel?p.multiply(h):p,v=this.view.displayViewScreenMat3.multiply(new e.eB(t.pos,1));let _=t.offset,E=new e.nt(1),L=e.U.identity(),j=new e.ZY(0);if(this.isLabel){if(!t.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const ye=t.referenceSymbol,ne=ye.xy,ae=ye.z,ue=this._unpackDirection(ye.w),le=c(this,t.id,ae).divide(2),H=ue.multiply(le.add(C.C2));j=ne.add(H),_=_.add(j)}else E=c(this,t.id,t.referenceSize).divide(t.referenceSize),u=u.multiply(E),d=d.multiply(E),_=_.multiply(E),L=q(this,t.id),_=L.multiply(new e.eB(_,0)).xy;const G=(0,P.mh)(t.bitset,D.ti),W=this._getViewRotationMatrix(G).multiply(new e.eB(_,0));let Q=this.isLabel?this.clipLabel(t.zoomRange,t.clipAngle,G):this.clip(t.id,t.zoomRange);Q=Q.add(this.isBackgroundPass?a.multiply(2):s.multiply(2));let X=new e.nt(0);if(this.textRenderPassType===Se.Outline&&(Q=Q.add((0,e.Tk)((0,e.LC)(t.outlineAndHaloSize.x,new e.nt(0)),new e.nt(2),new e.nt(0))),X=new e.nt(t.outlineAndHaloSize.x).divide(d).divide(D.$w)),this.textRenderPassType===Se.Halo){const ye=t.outlineAndHaloSize.x,ne=new e.nt(t.outlineAndHaloSize.y);Q=Q.add((0,e.Tk)((0,e.LC)(ne,new e.nt(0)),new e.nt(2),new e.nt(0))),X=ne.add(ye).divide(d).divide(D.$w)}const ce=this.isLabel?(0,e.or)((0,e.MM)(Q,new e.nt(1)),(0,e.$5)(h,new e.nt(0))):new e.x(!1);return{glPosition:new e.Zb(v.xy.add(W.xy),Q,1),color:x,size:d,textureUV:t.textureUV.divide(this.mosaicInfo.size),antialiasingWidth:new e.nt(.105*D.au).divide(u).divide(this.view.pixelRatio),outlineDistanceOffset:X,...this.maybeRunHittest(t,i,{vvSizeAdjustment:E,vvRotation:L,labelOffset:j,labelClipped:ce})}}_getViewRotationMatrix(t){const i=this.view.displayViewMat3,s=this.view.displayMat3,a=new e.nt(1).subtract(t);return i.multiply(t).add(s.multiply(a))}fragment(t){const i=new e.nt(.25),s=new e.nt(1).subtract(i),a=(0,e.US)(this.mosaicInfo.texture,t.textureUV).a;let u=s.subtract(t.outlineDistanceOffset);this.highlight&&(u=u.divide(2));const d=t.antialiasingWidth,p=(0,e.TF)(u.subtract(d),u.add(d),a);return this.getFragmentOutput(t.color.multiply(p),t)}hittest(t,i,{vvSizeAdjustment:s,vvRotation:a,labelOffset:u,labelClipped:d}){let p,h,x;this.isLabel?(p=new e.eB(t.offset.add(u),0),h=new e.eB(i.offsetNextVertex1.add(u),0),x=new e.eB(i.offsetNextVertex2.add(u),0)):(p=a.multiply(new e.eB(t.offset.multiply(s),0)),h=a.multiply(new e.eB(i.offsetNextVertex1.multiply(s),0)),x=a.multiply(new e.eB(i.offsetNextVertex2.multiply(s),0)));const{viewMat3:v,tileMat3:_}=this.view,E=v.multiply(_).multiply(new e.eB(t.pos,1)),L=E.add(_.multiply(p)).xy,j=E.add(_.multiply(h)).xy,G=E.add(_.multiply(x)).xy,W=ut(this.hittestRequest.position,L.xy,j.xy,G.xy);return this.isLabel?(0,e.Tk)(d,Ze(this.hittestRequest),W):W}_unpackDirection(t){const i=new e.Ai(t),s=(0,e.Sj)(i,new e.Ai(2)),a=(0,e.nf)(i,new e.Ai(3));return new e.ZY(new e.nt(s).subtract(1),new e.nt(a).subtract(1))}_getVertexColor(t){let i=t.color;if(this.visualVariableColor){const s=this.storage.getColorValue(t.id);i=this.visualVariableColor.getColor(s,t.color,new e.x(!1))}if(this.visualVariableOpacity){const s=this.storage.getOpacityValue(t.id),a=this.visualVariableOpacity.getOpacity(s);i=i.multiply(a)}return i}}(0,o._)([(0,r.uK)(R)],xe.prototype,"visualVariableColor",void 0),(0,o._)([(0,r.uK)(S)],xe.prototype,"visualVariableOpacity",void 0),(0,o._)([(0,r.uK)(B)],xe.prototype,"visualVariableRotation",void 0),(0,o._)([(0,r.uK)(Z)],xe.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o._)([(0,r.uK)(I)],xe.prototype,"visualVariableSizeScaleStops",void 0),(0,o._)([(0,r.uK)(te)],xe.prototype,"visualVariableSizeStops",void 0),(0,o._)([(0,r.uK)(fe)],xe.prototype,"visualVariableSizeUnitValue",void 0),(0,o._)([(0,r.Pi)(se)],xe.prototype,"mosaicInfo",void 0),(0,o._)([r.E8],xe.prototype,"textRenderPassType",void 0),(0,o._)([r.E8],xe.prototype,"isBackgroundPass",void 0),(0,o._)([r.E8],xe.prototype,"isLabel",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Me)),(0,o.a)(1,(0,r.hF)(Ot))],xe.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class $i extends k{}))],xe.prototype,"fragment",null);var bt=m(63643);class Ge extends Oe{}(0,o._)([(0,r.C5)(9,e.nt)],Ge.prototype,"accumulatedDistance",void 0),(0,o._)([(0,r.C5)(10,e.nt)],Ge.prototype,"totalLength",void 0),(0,o._)([(0,r.C5)(11,e.nt)],Ge.prototype,"gradientSize",void 0),(0,o._)([(0,r.C5)(12,e.ZY)],Ge.prototype,"segmentDirection",void 0),(0,o._)([(0,r.C5)(13,e.Zb)],Ge.prototype,"tlbr",void 0);class oi extends r.k2{}(0,o._)([(0,r.Pi)(e.nt)],oi.prototype,"isColorPass",void 0);class xt extends Ve{constructor(){super(...arguments),this.type="GradientStrokeShader"}vertex(t,i){const{totalLength:s,gradientSize:a,segmentDirection:u,tlbr:d}=t,p=mt(this,t),h=(0,P.mh)(t.bitset,bt.Q.isAlongLine),x=s.divide(this.view.displayZoomFactor),v=(0,e.Tk)((0,P.K5)(t.bitset,bt.Q.isAbsoluteSize),()=>{const L=(0,e.Tk)((0,e.MM)(h,new e.nt(.5)),x,p.halfWidth);return a.divide(L)},a),_=t.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,e.Om)(u,p.scaledOffset)).divide(x),E=d.divide(this.mosaicInfo.size.xyxy);return{...p,tlbr:E,relativePositionAlongLine:_,relativeGradientSize:v,isAlongLine:(0,P.mh)(t.bitset,bt.Q.isAlongLine),isDiscrete:(0,P.mh)(t.bitset,bt.Q.isDiscrete),...this.maybeRunHittest(t,i,p.halfWidth)}}fragment(t){const{isAlongLine:i,isDiscrete:s,relativePositionAlongLine:a,relativeGradientSize:u,normal:d,tlbr:p}=t,h=Pt(t,this.antialiasingControls.blur),x=new e.nt(.5).multiply(d.y).add(new e.nt(.5)),v=(0,e.Tk)((0,e.MM)(i,new e.nt(.5)),a,x),_=(0,e.Tk)((0,e.MM)(s,new e.nt(.5)),u.subtract(1),new e.nt(0)),E=(0,P.zb)(v.add(_).divide(u)),L=(0,e.jh)(p.xy,p.zw,new e.ZY((0,e.qE)(E,new e.nt(0),new e.nt(1)),.5)),j=(0,e.US)(this.mosaicInfo.texture,L),G=t.opacity.multiply(h),W=this.getFragmentOutput(j.multiply(G),t),Q=(0,e.PM)(new e.nt(.5),this.technique.isColorPass).multiply((0,oe.A)("gradient-depth-epsilon")),X=(0,e.PM)(new e.nt(0),d.y).multiply(new e.nt((0,oe.A)("gradient-depth-bias")).subtract(Q));return W.glFragDepth=(0,e.qE)((0,e.Bw)(d).add(X),new e.nt(0),new e.nt(1)),W}}(0,o._)([(0,r.Pi)(se)],xt.prototype,"mosaicInfo",void 0),(0,o._)([(0,r.Pi)(oi)],xt.prototype,"technique",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Ge)),(0,o.a)(1,(0,r.hF)(U))],xt.prototype,"vertex",null);var ts=m(67685),ni=m(84289);class Qe extends Oe{}(0,o._)([(0,r.C5)(9,e.nt)],Qe.prototype,"accumulatedDistance",void 0),(0,o._)([(0,r.C5)(10,e.ZY)],Qe.prototype,"segmentDirection",void 0),(0,o._)([(0,r.C5)(11,e.nt)],Qe.prototype,"offsetAlongLine",void 0),(0,o._)([(0,r.C5)(12,e.nt)],Qe.prototype,"capType",void 0),(0,o._)([(0,r.C5)(13,e.Zb)],Qe.prototype,"tlbr",void 0);class Dt extends Ve{constructor(){super(...arguments),this.type="TexturedLineShader"}_getDistanceRatio(t,i){const s=(0,P.mh)(t.bitset,D.kx);return s.multiply((0,e.T9)(i,new e.nt(.25)).multiply(new e.nt(2))).add(new e.nt(1).subtract(s).multiply((0,ts.Lz)(1)))}_getSDFAlpha(t){const{halfWidth:i,normal:s,tlbr:a,patternSize:u,accumulatedDistance:d,offsetAlongLine:p,dashToPx:h,capType:x}=t,v=u.x.divide(ni.zA).multiply(h),_=(0,e.jc)(d.add(p).divide(v)),E=(0,e.jh)(a.xy,a.zw,new e.ZY(_,.5)),L=(0,P.Rj)((0,e.US)(this.mosaicInfo.texture,E)).multiply(2).subtract(1).multiply(ni.gR).multiply(h),j=s.y.multiply(i),G=(0,e.j1)([(0,e.LC)(x,new e.nt(1)),L.subtract(i)],[(0,e.LC)(x,new e.nt(2)),(0,e.RZ)((0,e.n7)((0,e.T9)(L,new e.nt(0)),new e.nt(2)).add(j.multiply(j))).subtract(i)],[!0,L]),W=(0,e.qE)(new e.nt(.25).subtract(G),new e.nt(0),new e.nt(1));return new e.Zb(W)}_getPatternColor(t){const{halfWidth:i,normal:s,color:a,accumulatedDistance:u,patternSize:d,sampleAlphaOnly:p,tlbr:h}=t,x=d.y.multiply(new e.nt(2).multiply(i).divide(d.x)),v=(0,e.jc)(u.divide(x)),_=new e.nt(.5).multiply(s.y).add(new e.nt(.5)),E=(0,e.jh)(h.xy,h.zw,new e.ZY(_,v));let L=(0,e.US)(this.mosaicInfo.texture,E);return null!=this.visualVariableColor&&(L=(0,e.Tk)((0,e.MM)(p,new e.nt(.5)),new e.Zb(a.a),a)),L}vertex(t,i){const{segmentDirection:s,tlbr:a,bitset:u}=t,d=mt(this,t),p=t.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,e.Om)(s,d.scaledOffset)),h=new e.ZY(a.z.subtract(a.x),a.w.subtract(a.y)),x=a.divide(this.mosaicInfo.size.xyxy),v=(0,P.mh)(u,D.b5),_=(0,P.mh)(u,D.cn),E=(0,e.Tk)((0,e.MM)(v,new e.nt(.5)),this._getDistanceRatio(t,d.scaledHalfWidth),new e.nt(1));return{...d,tlbr:x,patternSize:h,accumulatedDistance:p,isSDF:v,sampleAlphaOnly:_,dashToPx:E,offsetAlongLine:t.offsetAlongLine,capType:t.capType,...this.maybeRunHittest(t,i,d.halfWidth)}}fragment(t){const{color:i,opacity:s,isSDF:a}=t,u=Pt(t,this.antialiasingControls.blur),d=(0,e.Tk)((0,e.MM)(a,new e.nt(.5)),this._getSDFAlpha(t),this._getPatternColor(t)),p=i.multiply(s).multiply(u).multiply(d);return this.getFragmentOutput(p,t)}}(0,o._)([(0,r.Pi)(se)],Dt.prototype,"mosaicInfo",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Qe)),(0,o.a)(1,(0,r.hF)(U))],Dt.prototype,"vertex",null);class Ee extends ${}(0,o._)([(0,r.C5)(3,e.Zb)],Ee.prototype,"color",void 0),(0,o._)([(0,r.C5)(4,e.Zb)],Ee.prototype,"outlineColor",void 0),(0,o._)([(0,r.C5)(5,e.ZY)],Ee.prototype,"offset",void 0),(0,o._)([(0,r.C5)(6,e.ZY)],Ee.prototype,"textureUV",void 0),(0,o._)([(0,r.C5)(7,e.Zb)],Ee.prototype,"sizing",void 0),(0,o._)([(0,r.C5)(8,e.nt)],Ee.prototype,"placementAngle",void 0),(0,o._)([(0,r.C5)(9,e.nt)],Ee.prototype,"sdfDecodeCoeff",void 0),(0,o._)([(0,r.C5)(10,e.ZY)],Ee.prototype,"zoomRange",void 0);class nt extends r.Y7{}function Fe(l,t,i,s){return t.multiply(l.x).add(i.multiply(l.y)).add(s.multiply(l.z))}function Rt(l){return l.multiply(l).divide(128)}(0,o._)([(0,r.C5)(12,e.ZY)],nt.prototype,"offsetNextVertex1",void 0),(0,o._)([(0,r.C5)(13,e.ZY)],nt.prototype,"offsetNextVertex2",void 0),(0,o._)([(0,r.C5)(14,e.ZY)],nt.prototype,"textureUVNextVertex1",void 0),(0,o._)([(0,r.C5)(15,e.ZY)],nt.prototype,"textureUVNextVertex2",void 0);class ze extends g{constructor(){super(...arguments),this.type="MarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(t,i){const s=Rt(t.sizing.x),a=Rt(t.sizing.y),u=Rt(t.sizing.z),d=t.placementAngle,p=(0,P.mh)(t.bitset,Ce.c.bitset.isSDF),h=(0,P.mh)(t.bitset,Ce.c.bitset.isMapAligned),x=(0,P.mh)(t.bitset,Ce.c.bitset.scaleSymbolsProportionally),v=(0,P.K5)(t.bitset,Ce.c.bitset.colorLocked),_=M(this,t.id),E=O(this,t.id,t.color,v).multiply(_),L=this.view.displayViewScreenMat3.multiply(new e.eB(t.pos.xy,1)),j=c(this,t.id,u).divide(u),G=s.multiply(j),W=t.offset.xy.multiply(j);let Q=a.multiply(x.multiply(j.subtract(1)).add(1));Q=(0,e.jk)(Q,(0,e.T9)(G.subtract(.99),new e.nt(0)));const X=(0,e.T9)(Q,new e.nt(1)),ce=(0,e.jk)(Q,new e.nt(1)),ye=e.U.fromRotation(d.multiply(D.rp)),ne=q(this,t.id),ae=this._getViewRotationMatrix(h).multiply(ne).multiply(ye).multiply(new e.eB(W.xy,0)),ue=this.clip(t.id,t.zoomRange),le=new e.Zb(L.xy.add(ae.xy),ue,1),H=t.textureUV.divide(this.mosaicInfo.size),lt=t.outlineColor.multiply(ce),qe=(0,P.mh)(t.bitset,Ce.c.bitset.overrideOutlineColor),di=t.sdfDecodeCoeff.multiply(G);return{glPosition:le,color:E,textureUV:H,outlineColor:lt,outlineSize:X,distanceToPx:di,isSDF:p,overrideOutlineColor:qe,...this.maybeRunHittest(t,i,{pos:t.pos,size:G,sizeCorrection:j,isMapAligned:h,vvRotationMat3:ne,placementMat3:ye,outlineSize:X,distanceToPx:di,isSDF:p})}}fragment(t){const i=this._getColor(t.textureUV,t);return this.getFragmentOutput(i,t)}hittest(t,i,s){return(0,e.Tk)((0,e.Xe)(s.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,i,s),this._hittestMarker(t,i,s))}_getViewRotationMatrix(t){const i=this.view.displayViewMat3,s=this.view.displayMat3,a=new e.nt(1).subtract(t);return i.multiply(t).add(s.multiply(a))}_getViewScreenMatrix(t){const i=this.view.viewMat3.multiply(this.view.tileMat3),s=this.view.tileMat3,a=new e.nt(1).subtract(t);return i.multiply(t).add(s.multiply(a))}_getColor(t,i){return(0,e.Tk)((0,e.LC)(i.isSDF,new e.nt(1)),this._getSDFColor(t,i),this._getSpriteColor(t,i))}_getSpriteColor(t,i){return(0,e.US)(this.mosaicInfo.texture,t).multiply(i.color)}_getSDFColor(t,i){const s=(0,e.US)(this.mosaicInfo.texture,t),a=new e.nt(.5).subtract((0,P.Rj)(s)).multiply(i.distanceToPx).multiply(D.V5),u=(0,e.qE)(new e.nt(.5).subtract(a),new e.nt(0),new e.nt(1)),d=i.color.multiply(u);let p=i.outlineSize;this.highlight&&(p=(0,e.T9)(p,i.overrideOutlineColor.multiply(4)));const h=p.multiply(.5),x=(0,e.tn)(a).subtract(h),v=(0,e.qE)(new e.nt(.5).subtract(x),new e.nt(0),new e.nt(1)),_=(0,e.jh)(i.outlineColor,i.color,i.overrideOutlineColor).multiply(v);return new e.nt(1).subtract(_.a).multiply(d).add(_)}_hittestSmallMarker(t,i,s){const{position:a,distance:u,smallSymbolDistance:d}=this.hittestRequest,p=u.subtract(d),{viewMat3:h,tileMat3:x}=this.view,v=h.multiply(x).multiply(new e.eB(s.pos,1)).xy,_=s.size.multiply(.5);return(0,e.Io)(v,a).subtract(_).add(p)}_hittestMarker(t,i,s){const{pos:a,sizeCorrection:u,isMapAligned:d}=s,p=new e.eB(t.offset.multiply(u),0),h=new e.eB(i.offsetNextVertex1.multiply(u),0),x=new e.eB(i.offsetNextVertex2.multiply(u),0),{viewMat3:v,tileMat3:_}=this.view,E=v.multiply(_).multiply(new e.eB(a,1)),L=this._getViewScreenMatrix(d).multiply(s.vvRotationMat3).multiply(s.placementMat3),j=E.add(L.multiply(p)).xy,G=E.add(L.multiply(h)).xy,W=E.add(L.multiply(x)).xy,X=this.hittestRequest.distance,ce=ut(this.hittestRequest.position,j,G,W);return(0,e.Tk)((0,e.MM)(ce,X),ce,this._hittestSamples(j,G,W,t,i,s))}_hittestSamples(t,i,s,a,u,d){const{outlineSize:p,isSDF:h,distanceToPx:x}=d,v=this.hittestRequest.position,_=this.hittestRequest.distance,E=ge(v.add(new e.ZY((0,e.ze)(_),(0,e.ze)(_))),t,i,s),L=ge(v.add(new e.ZY(0,(0,e.ze)(_))),t,i,s),j=ge(v.add(new e.ZY(_,(0,e.ze)(_))),t,i,s),G=ge(v.add(new e.ZY((0,e.ze)(_),0)),t,i,s),W=ge(v,t,i,s),Q=ge(v.add(new e.ZY(_,0)),t,i,s),X=ge(v.add(new e.ZY((0,e.ze)(_),_)),t,i,s),ce=ge(v.add(new e.ZY(0,_)),t,i,s),ye=ge(v.add(new e.ZY(_,_)),t,i,s),ne=a.textureUV.divide(this.mosaicInfo.size),ae=u.textureUVNextVertex1.divide(this.mosaicInfo.size),ue=u.textureUVNextVertex2.divide(this.mosaicInfo.size),le={color:new e.Zb(1),outlineColor:new e.Zb(1),overrideOutlineColor:new e.nt(1),outlineSize:p,distanceToPx:x,isSDF:h};let H=new e.nt(0);return H=H.add(_e(E).multiply(this._getColor(Fe(E,ne,ae,ue),le).a)),H=H.add(_e(L).multiply(this._getColor(Fe(L,ne,ae,ue),le).a)),H=H.add(_e(j).multiply(this._getColor(Fe(j,ne,ae,ue),le).a)),H=H.add(_e(G).multiply(this._getColor(Fe(G,ne,ae,ue),le).a)),H=H.add(_e(W).multiply(this._getColor(Fe(W,ne,ae,ue),le).a)),H=H.add(_e(Q).multiply(this._getColor(Fe(Q,ne,ae,ue),le).a)),H=H.add(_e(X).multiply(this._getColor(Fe(X,ne,ae,ue),le).a)),H=H.add(_e(ce).multiply(this._getColor(Fe(ce,ne,ae,ue),le).a)),H=H.add(_e(ye).multiply(this._getColor(Fe(ye,ne,ae,ue),le).a)),(0,e.PM)(H,new e.nt(.05)).multiply(Ze(this.hittestRequest))}}(0,o._)([(0,r.uK)(R)],ze.prototype,"visualVariableColor",void 0),(0,o._)([(0,r.uK)(S)],ze.prototype,"visualVariableOpacity",void 0),(0,o._)([(0,r.uK)(B)],ze.prototype,"visualVariableRotation",void 0),(0,o._)([(0,r.uK)(Z)],ze.prototype,"visualVariableSizeMinMaxValue",void 0),(0,o._)([(0,r.uK)(I)],ze.prototype,"visualVariableSizeScaleStops",void 0),(0,o._)([(0,r.uK)(te)],ze.prototype,"visualVariableSizeStops",void 0),(0,o._)([(0,r.uK)(fe)],ze.prototype,"visualVariableSizeUnitValue",void 0),(0,o._)([(0,r.Pi)(se)],ze.prototype,"mosaicInfo",void 0),(0,o._)([(0,o.a)(0,(0,r.hF)(Ee)),(0,o.a)(1,(0,r.hF)(nt))],ze.prototype,"vertex",null),(0,o._)([(0,o.a)(0,(0,r.hF)(class ss extends k{}))],ze.prototype,"fragment",null);var os=m(1119),ns=m(20872);class as{constructor(){this.computeAttributes={}}get locationsMap(){const t=new Map;for(const i in this.locations)t.set(i,this.locations[i].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,i=Array.from(t.entries()).map(([a,u])=>`${a}.${u}`).join("."),s=(0,os.Wm)(i);this._locationInfo={hash:s,stringHash:i,locations:t,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[i,s]of this.locationsMap.entries())t.set("a_"+i,s);return t}getShaderKey(t,i,s){return`${Object.keys(t).map(a=>`${a}.${t[a]}`).join(".")}.${Object.keys(s).filter(a=>s[a]).map(a=>`${a}_${s[a].toString()}`).join(".")}.${Object.keys(i).filter(a=>this.optionPropertyKeys.has(a)).join(".")}`}getProgram(t,i,s,a){let u="",d="";for(const p in s)if(s[p]){const h="boolean"==typeof s[p]?`#define ${p}\n`:`#define ${p} ${s[p]}\n`;u+=h,d+=h}return u+=this.vertexShader,d+=this.fragmentShader,new ns.K(u,d,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(i),this._transformFeedbackBindings)}_getUniformBindings(t){const i=[];for(const s in this.required){const a=this.required[s];i.push({uniformHydrated:null,shaderModulePath:s,uniformName:s,uniformType:a.type,uniformArrayElementType:ai(a),uniformArrayLength:li(a)})}for(const s in t){const a=this.options[s];if(t[s])for(const u in a){const d=a[u];i.push({uniformHydrated:null,shaderModulePath:`${s}.${u}`,uniformName:u,uniformType:d.type,uniformArrayElementType:ai(d),uniformArrayLength:li(d)})}}return i}}const ai=l=>"array"===l.type?l.elementType?.type:void 0,li=l=>"array"===l.type?l.size:void 0;var ui=m(73539);const ls={hittestDist:e.nt,hittestPos:e.ZY},us={filterFlags:e.z7,animation:e.z7,visualVariableData:e.z7,dataDriven0:e.z7,dataDriven1:e.z7,dataDriven2:e.z7,gpgpu:e.z7,size:e.nt},ds={displayViewScreenMat3:e.U,displayViewMat3:e.U,displayMat3:e.U,viewMat3:e.U,tileMat3:e.U,displayZoomFactor:e.nt,requiredZoomFactor:e.nt,tileOffset:e.ZY,currentScale:e.nt,currentZoom:e.nt,metersPerSRUnit:e.nt};class ps extends as{constructor(){super(...arguments),this.vertexShader=(0,ui.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,ui.Q)("materials/pie/pie.frag"),this.required={...us,...ds,outlineWidth:e.nt,colors:e.My,defaultColor:e.Zb,othersColor:e.Zb,outlineColor:e.Zb,donutRatio:e.nt,sectorThreshold:e.nt},this.options={hittestUniforms:ls,visualVariableSizeMinMaxValue:{minMaxValueAndSize:e.Zb},visualVariableSizeScaleStops:{sizes:{...e.My.ofType(e.nt,8),type:"array",elementType:e.nt,size:8},values:{...e.My.ofType(e.nt,8),type:"array",elementType:e.nt,size:8}},visualVariableSizeStops:{sizes:{...e.My.ofType(e.nt,8),type:"array",elementType:e.nt,size:8},values:{...e.My.ofType(e.nt,8),type:"array",elementType:e.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:e.nt},visualVariableOpacity:{opacities:{...e.My.ofType(e.nt,8),type:"array",elementType:e.nt,size:8},opacityValues:{...e.My.ofType(e.nt,8),type:"array",elementType:e.nt,size:8}}},this.locations={pos:{index:0,type:e.ZY},id:{index:1,type:e.eB},bitset:{index:2,type:e.nt},offset:{index:3,type:e.ZY},texCoords:{index:4,type:e.ZY},size:{index:5,type:e.ZY},referenceSize:{index:6,type:e.nt},zoomRange:{index:7,type:e.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(t){this.required.colors={...e.My.ofType(e.Zb,t),type:"array",elementType:e.Zb,size:t}}}const at={fill:new class Ei extends be{constructor(){super(...arguments),this.type=z.N.Fill,this.shaders={geometry:new Ae}}render(t,i){const{painter:s}=t,a=i.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,a.uniforms),...(0,w.QA)(t,i.target)},defines:(0,w.vT)(t),optionalAttributes:a.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),s.setPipelineState((0,w.Qu)(t)),s.submitDraw(t,i)}},patternFill:new class Ui extends be{constructor(){super(...arguments),this.type=z.N.PatternFill,this.shaders={geometry:new tt}}render(t,i){const{context:s,painter:a}=t,u=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,u.uniforms),...(0,w.QA)(t,i.target),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey),localTileOffset:(0,w.Pr)(i.target)},defines:{...(0,w.vT)(t)},optionalAttributes:u.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i)}},complexFill:new class Ci extends be{constructor(){super(...arguments),this.type=z.N.ComplexFill,this.shaders={geometry:new et}}render(t,i){const{context:s,painter:a}=t,u=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,u.uniforms),...(0,w.QA)(t,i.target),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey),localTileOffset:(0,w.Pr)(i.target)},defines:{...(0,w.vT)(t)},optionalAttributes:u.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i)}},gradientFill:new class Ii extends be{constructor(){super(...arguments),this.type=z.N.GradientFill,this.shaders={geometry:new _t},this.symbologyPlane=F.uC.FILL}render(t,i){const{context:s,painter:a}=t,u=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,u.uniforms),...(0,w.QA)(t,i.target),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey)},defines:{...(0,w.vT)(t)},optionalAttributes:u.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i)}},outlineFill:new class Li extends be{constructor(){super(...arguments),this.type=z.N.OutlineFill,this.shaders={geometry:new yt}}render(t,i){const{painter:s,pixelRatio:a}=t,u=i.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,u.uniforms),...(0,w.QA)(t,i.target),antialiasingControls:Ne(a)},defines:{...(0,w.vT)(t)},optionalAttributes:u.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),s.setPipelineState((0,w.Qu)(t)),s.submitDraw(t,i)}},patternOutlineFill:new class Bi extends be{constructor(){super(...arguments),this.type=z.N.PatternOutlineFill,this.shaders={geometry:new it}}render(t,i){const{context:s,painter:a,pixelRatio:u}=t,d=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,d.uniforms),...(0,w.QA)(t,i.target),antialiasingControls:Ne(u),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey),localTileOffset:(0,w.Pr)(i.target)},defines:{...(0,w.vT)(t)},optionalAttributes:d.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i)}},complexOutlineFill:new class Ri extends be{constructor(){super(...arguments),this.type=z.N.ComplexOutlineFill,this.shaders={geometry:new st}}render(t,i){const{context:s,painter:a,pixelRatio:u}=t,d=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,d.uniforms),...(0,w.QA)(t,i.target),antialiasingControls:Ne(u),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey),localTileOffset:(0,w.Pr)(i.target)},defines:{...(0,w.vT)(t)},optionalAttributes:d.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i)}},marker:new class rs extends be{constructor(){super(...arguments),this.type=z.N.Marker,this.shaders={geometry:new ze},this.symbologyPlane=F.uC.MARKER}render(t,i){const{context:s,painter:a}=t,u=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,u.uniforms),...(0,w.QA)(t,i.target),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey,!0)},defines:{...(0,w.vT)(t)},optionalAttributes:u.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i)}},pieChart:new class cs extends be{constructor(){super(...arguments),this.type=z.N.PieChart,this.shaders={geometry:new ps},this.symbologyPlane=F.uC.MARKER}render(t,i){const{painter:s}=t,{instance:a,target:u}=i,d=this.shaders.geometry,p=a.getInput(),h=p.uniforms.numberOfFields,x=(0,w.Eq)(t),v=(0,w.QA)(t,u),_=(0,w.vT)(t);d.setNumberOfFields(h),s.setShader({shader:d,uniforms:{...(0,w.r3)(t,i.target,p.uniforms.shader),...v.storage,...v.view,hittestUniforms:v.hittestRequest?{hittestDist:v.hittestRequest?.distance,hittestPos:v.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!p.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!p.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!p.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!p.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!p.uniforms.shader.visualVariableOpacity,HITTEST:x,highlight:v.highlight?1:0,..._,numberOfFields:h},optionalAttributes:{},useComputeBuffer:x}),s.setPipelineState((0,w.Qu)(t)),s.submitDraw(t,i)}},line:new class es extends be{constructor(){super(...arguments),this.type=z.N.Line,this.shaders={geometry:new Ve},this.symbologyPlane=F.uC.LINE}render(t,i){const{painter:s,pixelRatio:a}=t,u=i.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,u.uniforms),...(0,w.QA)(t,i.target),antialiasingControls:Ne(a)},defines:{...(0,w.vT)(t)},optionalAttributes:u.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),s.setPipelineState((0,w.Qu)(t)),s.submitDraw(t,i)}},texturedLine:new class is extends be{constructor(){super(...arguments),this.type=z.N.TexturedLine,this.shaders={geometry:new Dt},this.symbologyPlane=F.uC.LINE}render(t,i){const{context:s,painter:a,pixelRatio:u}=t,d=i.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,d.uniforms),...(0,w.QA)(t,i.target),antialiasingControls:Ne(u),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey)},defines:{...(0,w.vT)(t)},optionalAttributes:d.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i)}},gradientStroke:new class Ji extends be{constructor(){super(...arguments),this.type=z.N.GradientStroke,this.shaders={geometry:new xt},this.symbologyPlane=F.uC.LINE}_getShaderOptions(t,i,s){const{context:a,painter:u,pixelRatio:d}=t,p=i.instance.getInput();return{shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,p.uniforms),...(0,w.QA)(t,i.target),antialiasingControls:Ne(d),mosaicInfo:u.textureManager.getMosaicInfo(a,i.textureKey),technique:{isColorPass:s}},defines:{...(0,w.vT)(t)},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)}}render(t,i){const{painter:s}=t;if((0,w.Eq)(t)||(0,w.dJ)(t)){const d=(0,w.Qu)(t);return s.setPipelineState(d),s.setShader(this._getShaderOptions(t,i,1)),void s.submitDraw(t,i)}t.context.setClearDepth(1),t.context.clear(Y.NV.DEPTH);const a={color:!1,depth:{write:{zNear:0,zFar:1},test:Y.MT.LESS},stencil:{write:!1,test:{ref:d=>d.stencilRef,compare:Y.MT.EQUAL,mask:255,op:{fail:Y.eA.KEEP,zFail:Y.eA.KEEP,zPass:Y.eA.KEEP}}}};s.setShader(this._getShaderOptions(t,i,0)),s.setPipelineState(a),s.submitDraw(t,i);const u={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:{write:!1,test:Y.MT.LEQUAL},stencil:{write:!1,test:{ref:d=>d.stencilRef,compare:Y.MT.EQUAL,mask:255,op:{fail:Y.eA.KEEP,zFail:Y.eA.KEEP,zPass:Y.eA.KEEP}}}};s.setShader(this._getShaderOptions(t,i,1)),s.setPipelineState(u),s.submitDraw(t,i)}},text:new class hs extends be{constructor(){super(...arguments),this.type=z.N.Text,this.shaders={geometry:new xe},this.symbologyPlane=F.uC.TEXT}render(t,i){const{context:s,painter:a}=t,u=(0,w.vT)(t),d=i.instance.getInput(),p={shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,d.uniforms),...(0,w.QA)(t,i.target),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey)},defines:{...u,isBackgroundPass:!0,isLabel:!1,textRenderPassType:Se.Color},optionalAttributes:d.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)};a.setShader(p),a.setPipelineState((0,w.Qu)(t)),a.submitDraw(t,i),a.setShader({...p,defines:{...u,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Se.Halo}}),a.submitDraw(t,i),a.setShader({...p,defines:{...u,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Se.Outline}}),a.submitDraw(t,i),a.setShader({...p,defines:{...u,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Se.Color}}),a.submitDraw(t,i)}},label:new class Xi extends be{constructor(){super(...arguments),this.type=z.N.Label,this.shaders={geometry:new xe},this.drawPhase=F.S5.LABEL|F.S5.LABEL_ALPHA|F.S5.HITTEST,this.symbologyPlane=F.uC.TEXT}render(t,i){const{context:s,painter:a}=t,u=(0,w.vT)(t),d={...(0,w.Qu)(t)},p=i.instance.getInput(),h={shader:this.shaders.geometry,uniforms:{...(0,w.r3)(t,i.target,p.uniforms),...(0,w.QA)(t,i.target),mosaicInfo:a.textureManager.getMosaicInfo(s,i.textureKey)},defines:{...u,textRenderPassType:Se.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,w.Eq)(t)};a.setPipelineState(d),a.setShader(h),a.submitDraw(t,i),a.setShader({...h,defines:{...u,textRenderPassType:Se.Halo,isBackgroundPass:!1,isLabel:!0}}),a.submitDraw(t,i),a.setShader({...h,defines:{...u,textRenderPassType:Se.Color,isBackgroundPass:!1,isLabel:!0}}),a.submitDraw(t,i)}},heatmap:new class Ni extends be{constructor(){super(...arguments),this.type=z.N.Heatmap,this.drawPhase=F.S5.MAP|F.S5.HITTEST|F.S5.DEBUG,this.shaders={accumulate:new ot,resolve:new We},this._isBound=!1,this._resources=new Map}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t),this._prevFBO=null,this._unbind()}render(t,i){const{context:s,painter:a,state:u}=t,d=i.instance.getInput(),{isFieldActive:p}=d.uniforms,h=this._getOrCreateResourcesRecord(s),x=h.loadQualityProfile(s);(0,w.Eq)(t)||this._bind(t,h,d),a.setShader({shader:this.shaders.accumulate,uniforms:{...(0,w.QA)(t,i.target),kernelControls:{radius:ri(d,u),isFieldActive:p?1:0}},defines:{...(0,w.vT)(t),...x.defines},optionalAttributes:{},useComputeBuffer:(0,w.Eq)(t)});const v=(0,w.Eq)(t)?Gi:si;a.setPipelineState(v),a.submitDraw(t,i)}getStencilReference(t){return ii(t)}renderResolvePass(t,i){if((0,w.Eq)(t))return;const{context:s,painter:a}=t,u=this._resources.get(s);if(null==this._prevFBO||null==this._prevViewport||!u?.initialized)return;const{defines:d}=u.loadQualityProfile(s),{minDensity:p,maxDensity:h,radius:x}=i.getInput().uniforms,E=u.accumulateFramebuffer,L=u.resolveGradientTexture,j={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:E.colorTexture},minAndInvRange:[p,1/(h-p)],normalization:3/(x*x*Math.PI)},gradient:{texture:{unit:9,texture:L}}},defines:d,optionalAttributes:{},useComputeBuffer:!1};s.bindFramebuffer(this._prevFBO),s.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),s.bindTexture(E.colorTexture,8),s.bindTexture(L,9),a.setPipelineState(Qi),a.submitDrawMesh(s,j,a.quadMesh),this._unbind()}_getOrCreateResourcesRecord(t){let i=this._resources.get(t);return null==i&&(i=new Hi,this._resources.set(t,i)),i}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(t,i,s){if(this._isBound)return;const{context:a,state:u,pixelRatio:d}=t,p=a.getBoundFramebufferObject(),h=a.getViewport();this._prevFBO=p,this._prevViewport=h;const{gradient:x,gradientHash:v}=s.uniforms;i.ensureResolveGradientTexture(a,v,x);const{width:_,height:E}=h,L=function Wi(l,t){const i=t>1.5?.25:.5;return l<1/(2*i)?1:i}(ri(s,u),d),W=i.ensureAccumulateFBO(a,_*L,E*L);a.blitFramebuffer(p,W,0,0,p.width,p.height,0,0,W.width,W.height,Y.NV.STENCIL,Y.Cj.NEAREST),a.bindFramebuffer(W),a.setViewport(0,0,W.width,W.height),a.setColorMask(!0,!0,!0,!0),a.setClearColor(0,0,0,0),a.clear(Y.NV.COLOR),this._isBound=!0}},dotDensity:new class Vi extends be{constructor(){super(...arguments),this.type=z.N.DotDensity,this.shaders={polygon:new He,point:new ke,fill:new Ae},this._resources=new Map}render(t,i){(0,w.dJ)(t)||(0,w.Eq)(t)?this._renderPolygons(t,i):this._renderDotDensity(t,i)}_renderPolygons(t,i){const{painter:s}=t;s.setShader({shader:this.shaders.fill,uniforms:{...(0,w.QA)(t,i.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,w.vT)(t)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,w.Eq)(t)}),s.setPipelineState((0,w.Qu)(t)),s.submitDraw(t,i)}_renderDotDensity(t,i){const{context:s,painter:a,requiredLevel:u}=t,d=i.instance.getInput().uniforms,p=this._getOrCreateResourcesRecord(s),h=p.getDotDensityTextures(s,C.CQ,d.seed),x=1/2**(u-i.target.key.level),v=C.CQ,_=v*window.devicePixelRatio*v*window.devicePixelRatio,j=d.dotValue*(d.dotScale?t.state.scale/d.dotScale:1)*(1/x*(1/x));a.setShader({shader:this.shaders.polygon,uniforms:{...(0,w.QA)(t,i.target),instance:{isActive:d.isActive,colors:d.colors,dotValue:Math.max(1,j)},draw:{dotTexture0:{unit:C.Cp,texture:h[0]},dotTexture1:{unit:C.vN,texture:h[1]},tileZoomFactor:x,pixelRatio:window.devicePixelRatio,tileDotsOverArea:_/(C.CQ*window.devicePixelRatio*C.CQ*window.devicePixelRatio)}},defines:{...(0,w.vT)(t),blending:d.blending},optionalAttributes:{},useComputeBuffer:!1});const G=s.getViewport();s.setViewport(0,0,C.CQ,C.CQ);const W=s.getBoundFramebufferObject(),Q=p.getFBO(s);s.bindFramebuffer(Q),s.setClearColor(0,0,0,0),s.clear(Y.NV.COLOR),a.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),a.updatePipelineState(s),a.submitDraw(t,i),s.bindFramebuffer(W),s.setViewport(G.x,G.y,G.width,G.height);const X=p.getFBO(s).colorTexture,ce={shader:this.shaders.point,uniforms:{view:(0,w.L4)(t,i.target),instance:{dotSize:d.dotSize},draw:{locations:{unit:C.Cp,texture:X},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,w.vT)(t)},optionalAttributes:{},useComputeBuffer:!1};a.setPipelineState((0,w.Qu)(t)),a.submitDrawMesh(s,ce,p.getDotDensityMesh(s))}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t)}_getOrCreateResourcesRecord(t){let i=this._resources.get(t);return null==i&&(i=new Pi,this._resources.set(t,i)),i}},animatedMarker:new class vi extends yi{constructor(){super(...arguments),this.type=z.N.AnimatedMarker,this.symbologyPlane=F.uC.MARKER,this.shaders={geometry:new wt}}}};function ms(){for(const l in at)at[l].startup()}function fs(l){for(const t in at)at[t].shutdown(l)}},875:(we,de,m)=>{m.d(de,{K5:()=>P,Kt:()=>ee,M8:()=>r,Rj:()=>J,_9:()=>me,i6:()=>N,mh:()=>oe,nb:()=>K,p8:()=>k,tL:()=>pe,xf:()=>$,yS:()=>re,zb:()=>U,zy:()=>se});var F=m(47669),z=m(3902),o=m(90731);function me(R){const S=(0,z.fV)(12.9898),B=(0,z.fV)(78.233),Z=(0,z.fV)(43758.5453),I=(0,z.Om)(R,(0,z.Zc)(S,B)),te=(0,z.zi)(I,(0,z.fV)(3.14));return(0,z.jc)((0,z.F8)(te).multiply(Z))}function r(R){return(0,z.LC)(R,(0,z.fV)(o.qM))}function pe(R,S){return R.x.multiply(S.y).subtract(S.x.multiply(R.y))}function K(R){return R.multiply(2).subtract(1)}function oe(R,S){const B=(0,z.fV)(2**S);return(0,z.zi)((0,z.RI)(R.divide(B)),(0,z.fV)(2))}function P(R,S){return(0,z.MM)(oe(R,S),(0,z.fV)(.5))}function N(R,S){return oe(R,S+F.U5)}function re(R,S){return oe(R,S)}function ee(R){const S=oe(R.z,7),B=(0,z.fV)(1).subtract(S),Z=R.xyz.subtract((0,z.eR)(0,0,(0,z.fV)(128)));return B.multiply(R).add(S.multiply(Z))}function J(R){const S=(0,z.ln)(.99609375,.0038909912109375,1519918441772461e-20,5.9371814131736755e-8);return(0,z.Om)(R,S)}function $(R){return(0,z.T9)((0,z.T9)((0,z.T9)(R.x,R.y),R.z),R.w)}function U(R){return new z.nt(1).subtract(R)}function k(R){return R.subtract(new z.nt(1))}function se(R,S){return R.subtract(new z.nt(S))}},84836:(we,de,m)=>{m.d(de,{Jz:()=>re,T9:()=>e,uH:()=>pe});var F=m(89952),z=m(93171),o=m(69473),me=m(79213),r=m(54551);function e(g,D){return{type:"simple",filters:D,capabilities:{maxTextureSize:(0,r.C)().maxTextureSize},bindings:C(g)}}function pe(g,D){const se=(0,r.C)();return{type:"multi",target:"feature",keyField:z.EA,filters:D,capabilities:{maxTextureSize:se.maxTextureSize},bindings:{[z.t0.TrackLine]:C(g.trackLines.renderer),[z.t0.LatestObservation]:C(g.latestObservations.renderer),[z.t0.PreviousObservation]:C(g.previousObservations.renderer)}}}function K(g){switch(g){case"opacity":return o.Gn.OPACITY;case"color":return o.Gn.COLOR;case"rotation":return o.Gn.ROTATION;case"size":return o.Gn.SIZE;default:return null}}function C(g){if(!g)return[];switch(g.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return re(g);case"dot-density":return function oe(g){const D=[];for(const se of g.attributes)D.push({binding:D.length,expression:se.valueExpression,field:se.field});return D}(g);case"pie-chart":return function P(g){const D=re(g);let se=4;for(const R of g.attributes)D.push({binding:se++,expression:R.valueExpression,field:R.field});return D}(g);case"heatmap":return function N({valueExpression:g,field:D}){return g||D?[{binding:0,expression:g,field:D}]:[]}(g)}}function re(g){return"visualVariables"in g&&g.visualVariables?.length?(0,me.R)(g.visualVariables).map(D=>function k(g){switch(g.type){case"size":return function ee(g){return"$view.scale"===g.valueExpression?null:{binding:K(g.type),field:g.field,normalizationField:g.normalizationField,expression:g.valueExpression,valueRepresentation:g.valueRepresentation}}(g);case"color":return function J(g){return{binding:K(g.type),field:g.field,normalizationField:g.normalizationField,expression:g.valueExpression}}(g);case"opacity":return function $(g){return{binding:K(g.type),field:g.field,normalizationField:g.normalizationField,expression:g.valueExpression}}(g);case"rotation":return function U(g){return{binding:K(g.type),expression:g.valueExpression,field:g.field}}(g)}}(D)).filter(F.Ru):[]}},13220:(we,de,m)=>{m.d(de,{Dk:()=>g,K4:()=>se,j0:()=>D}),m(3248);var z=m(67685),o=m(82663),me=m(48716),r=m(47669),e=m(90731),pe=m(29822),K=m(79213);const C=1.25,oe=128,P=128;function N(S){if(!S.stops?.length)return null;const B=S.stops.sort((fe,V)=>fe.value-V.value),Z=(0,pe.r)(B,8);return{values:Z.map(({value:fe})=>fe),colors:Z.map(({color:fe})=>(0,pe.p)(fe))}}function re(S){if(!S.stops?.length)return null;const B=S.stops.sort((I,te)=>I.value-te.value),Z=(0,pe.r)(B,8);return{opacityValues:Z.map(({value:I})=>I),opacities:Z.map(({opacity:I})=>I)}}function ee(S){return{rotationType:"geographic"===S.rotationType?e.H_.Geographic:e.H_.Arithmatic}}function J(S){if(!S.stops?.length)return null;if(S.stops.some(I=>I.useMaxValue||I.useMinValue))return(I,te)=>{const fe=I.statisticsByLevel.get(te.key.level),V=S.stops.map(O=>({value:O.useMaxValue?fe?.get(S.field)?.maxValue??0:O.useMinValue?fe?.get(S.field)?.minValue??0:O.value,size:O.size?(0,z.Lz)(O.size):r.qM})).sort((O,M)=>O.value-M.value),c=(0,pe.r)(V,8);return{values:c.map(({value:O})=>O),sizes:c.map(({size:O})=>O)}};const B=S.stops.sort((I,te)=>I.value-te.value),Z=(0,pe.r)(B,8);return{values:Z.map(({value:I})=>I),sizes:Z.map(({size:I})=>(0,z.Lz)(I))}}function $(S){return B=>{const{state:Z}=B;return{unitValueToPixelsRatio:(0,o.GA)(Z.spatialReference)/me.j[S.valueUnit??"meters"]/Z.resolution}}}function U(S,B){const Z=B.length;if(S<B[0].value||1===Z)return B[0].size;for(let I=1;I<Z;I++)if(S<B[I].value)return B[I-1].size+(S-B[I-1].value)/(B[I].value-B[I-1].value)*(B[I].size-B[I-1].size);return B[Z-1].size}function k(S){const{minDataValue:B,maxDataValue:Z,minSize:I,maxSize:te}=S;if("object"==typeof I&&"object"==typeof te)return(fe,V)=>{const c=fe.state.scale,O=(0,z.Lz)(U(c,I.stops)),M=(0,z.Lz)(U(c,te.stops));return{minMaxValueAndSize:[B,Z,O,M]}};if("object"==typeof I||"object"==typeof te)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[B,Z,(0,z.Lz)(I),(0,z.Lz)(te)]}}const g={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function D(S,B=P,Z=C){if(S.visualVariableSizeMinMaxValue)return S.visualVariableSizeMinMaxValue instanceof Function?oe:Math.max(S.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*Z,B);if(S.visualVariableSizeScaleStops){if(S.visualVariableSizeScaleStops instanceof Function)return oe;const I=S.visualVariableSizeScaleStops.sizes;return Math.max(I[I.length-1]*Z,B)}if(S.visualVariableSizeStops){if(S.visualVariableSizeStops instanceof Function)return oe;const I=S.visualVariableSizeStops.sizes;return Math.max(I[I.length-1]*Z,B)}return S.visualVariableSizeUnitValue?2*oe:0}function se(S){const B={...g};if(!S||!("visualVariables"in S)||!S.visualVariables)return B;for(const Z of(0,K.R)(S.visualVariables))switch(Z.type){case"color":B.visualVariableColor=N(Z);break;case"opacity":B.visualVariableOpacity=re(Z);break;case"rotation":B.visualVariableRotation=ee(Z);break;case"size":switch(R(Z)){case"field-stops":B.visualVariableSizeStops=J(Z);break;case"scale-stops":"outline"===Z.target?B.visualVariableSizeOutlineScaleStops=J(Z):B.visualVariableSizeScaleStops=J(Z);break;case"min-max":B.visualVariableSizeMinMaxValue=k(Z);break;case"unit-value":B.visualVariableSizeUnitValue=$(Z)}}return B}function R(S){return"number"==typeof S.minDataValue&&"number"==typeof S.maxDataValue&&null!=S.minSize&&null!=S.maxSize?"min-max":"$view.scale"===S?.valueExpression&&Array.isArray(S.stops)?"scale-stops":null==S.field&&"$view.scale"===S?.valueExpression||!(Array.isArray(S.stops)||"levels"in S&&S.levels)?null!=S.field||"$view.scale"!==S?.valueExpression?"unit-value":null:"field-stops"}},29822:(we,de,m)=>{function F(o,me){const r=o.slice(0,me),e=me-r.length;for(let pe=0;pe<e;pe++)r.push(r[r.length-1]);return r}function z(o){if(!o)return[0,0,0,0];const{r:me,g:r,b:e,a:pe}=o;return[me*(pe/255),r*(pe/255),e*(pe/255),pe]}m.d(de,{p:()=>z,r:()=>F})},34155:(we,de,m)=>{m.d(de,{Dr:()=>I,EM:()=>B,Gn:()=>$,IQ:()=>fe,Jk:()=>oe,NZ:()=>S,TY:()=>K,Zi:()=>ee,gF:()=>re,mp:()=>D,oF:()=>k});var F=m(10467),z=m(26747),o=m(46988),me=m(65374),r=m(12598),e=m(13220),pe=m(99845);function K(V){return V.minScale||V.maxScale?{minScale:V.minScale??0,maxScale:V.maxScale??0}:null}function C(V){if(null==V)return null;if(Array.isArray(V)){const[c,O,M,q]=V;return[c,O,M,255*q]}return"string"==typeof V?V:{...V,defaultValue:C(V?.defaultValue)}}function oe(V,c){return P.apply(this,arguments)}function P(){return(P=(0,F.A)(function*(V,c){const{cimResourceManager:O,cimAnalyzer:M,scaleExpression:q}=c.schemaOptions;yield Promise.all(z.wp.fetchResources(V.symbol,O,[]));const ie=M.analyzeSymbolReference(V,!1),he={scaleInfo:K(V),scaleExpression:q},Pe=[];for(const ve of ie)switch(ve.type){case"marker":Pe.push(...N(ve,c,he));break;case"fill":Pe.push(...U(ve,c,he));break;case"gradientFill":Pe.push(...g(ve,c,he));break;case"line":Pe.push(...se(ve,c,he));break;case"gradientStroke":Pe.push(...Z(ve,c,he));break;case"text":Pe.push(...te(ve,c,he))}return Pe})).apply(this,arguments)}function N(V,c,O){const{uniforms:M,schemaOptions:q}=c,{store:ie}=q,he=V.isOutline?{...e.Dk,visualVariableSizeScaleStops:M.visualVariableSizeOutlineScaleStops}:{visualVariableColor:M.visualVariableColor,visualVariableOpacity:M.visualVariableOpacity,visualVariableSizeMinMaxValue:M.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:M.visualVariableSizeScaleStops,visualVariableSizeStops:M.visualVariableSizeStops,visualVariableSizeUnitValue:M.visualVariableSizeUnitValue,visualVariableRotation:M.visualVariableRotation};return V.animationParams?re(ie.ensureInstance(r.YS.animatedMarker,{uniforms:he,optionalAttributes:{zoomRange:!0}}),V,0,O):ee(ie.ensureInstance(r.YS.marker,{uniforms:he,optionalAttributes:{zoomRange:!!O.scaleInfo}}),V,M,O)}function re(V,c,O,M){return c.animationParams?[V.createMeshInfo({pixelDimensions:c.pixelDimensions,texelDimensions:c.texelDimensions,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null,sprite:c.spriteRasterizationParam,animations:c.animationParams,scaleInfo:M.scaleInfo,scaleSymbolsProportionally:c.scaleSymbolsProportionally,strokeWidth:c.outlineWidth,isMapAligned:c.alignment===me.C1.MAP,colorLocked:c.colorLocked,isStroke:c.isStroke,baseSize:c.baseSize,referenceSize:c.referenceSize,angleToLine:!!c.markerPlacement&&c.markerPlacement.placement&&"angleToLine"in c.markerPlacement.placement&&c.markerPlacement.placement.angleToLine,sizeRatio:c.sizeRatio})]:[]}function ee(V,c,O,{scaleInfo:M,scaleExpression:q}){const ie=(0,pe.I)(O);return[V.createMeshInfo({size:c.size,scaleX:c.scaleX,anchorX:c.anchorPoint.x,anchorY:c.anchorPoint.y,angle:c.rotation,color:C(c.color)??[0,0,0,0],colorLocked:c.colorLocked,frameHeight:c.frameHeight,widthRatio:c.widthRatio,scaleInfo:M,offsetX:c.offsetX,offsetY:c.offsetY,outlineColor:C(c.outlineColor)??[0,0,0,0],outlineSize:c.outlineWidth,referenceSize:c.referenceSize||o.D.CIMVectorMarker.size,rotateClockwise:c.rotateClockwise,scaleFactor:q??1,sizeRatio:c.sizeRatio,alignment:c.alignment,isAbsoluteAnchorPoint:c.isAbsoluteAnchorPoint,scaleSymbolsProportionally:c.scaleSymbolsProportionally,sprite:c.spriteRasterizationParam,hasSizeVV:ie,placement:c.markerPlacement,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null,transforms:c.transform,minPixelBuffer:(0,e.j0)(O)})]}function $(V,c,{scaleInfo:O}){return[V.createMeshInfo({color:C(c.color)??[0,0,0,0],scaleInfo:O,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null})]}function U(V,c,O){if(!V.spriteRasterizationParam)return function J(V,c,O){const{uniforms:M,schemaOptions:q}=c,{store:ie}=q;return $(ie.ensureInstance(r.YS.fill,{uniforms:{visualVariableColor:V.colorLocked?null:M.visualVariableColor,visualVariableOpacity:M.visualVariableOpacity},optionalAttributes:{zoomRange:!!O.scaleInfo}}),V,O)}(V,c,O);const{uniforms:M,schemaOptions:q}=c,{store:ie}=q;return k(ie.ensureInstance(r.YS.complexFill,{uniforms:{visualVariableColor:V.colorLocked?null:M.visualVariableColor,visualVariableOpacity:M.visualVariableOpacity},optionalAttributes:{zoomRange:!!O.scaleInfo}}),V,null!=M.visualVariableColor,O)}function k(V,c,O,{scaleInfo:M}){if(!c.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const ie=c.sampleAlphaOnly&&!(c.hasUnresolvedReplacementColor&&(!O||c.colorLocked)),he=c.spriteRasterizationParam;return[V.createMeshInfo({color:C(c.color)??[0,0,0,0],height:c.height,aspectRatio:c.scaleX,offsetX:c.offsetX,offsetY:c.offsetY,scaleX:1,scaleY:1,angle:c.angle,applyRandomOffset:c.applyRandomOffset,sampleAlphaOnly:ie,scaleProportionally:"CIMHatchFill"===he.resource.type,sprite:he,scaleInfo:M,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null})]}function g(V,c,O){const{uniforms:M,schemaOptions:q}=c,{store:ie}=q;return D(ie.ensureInstance(r.YS.gradientFill,{uniforms:{visualVariableColor:null,visualVariableOpacity:M.visualVariableOpacity},optionalAttributes:{zoomRange:!!O.scaleInfo}}),V,O)}function D(V,c,{scaleInfo:O}){if(!c.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const M=c.spriteRasterizationParam;return[V.createMeshInfo({color:C(c.color)??[0,0,0,0],angle:c.angle,gradientMethod:c.gradientMethod,gradientSize:c.gradientSize,gradientSizeUnits:c.gradientSizeUnits,gradientType:c.gradientType,sprite:M,scaleInfo:O,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null})]}function se(V,c,O){const{uniforms:M,schemaOptions:q}=c,{store:ie}=q,he=V.isOutline?{...e.Dk,visualVariableSizeScaleStops:M.visualVariableSizeOutlineScaleStops}:{visualVariableColor:V.colorLocked?null:M.visualVariableColor,visualVariableOpacity:M.visualVariableOpacity,visualVariableSizeMinMaxValue:M.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:M.visualVariableSizeScaleStops,visualVariableSizeStops:M.visualVariableSizeStops,visualVariableSizeUnitValue:M.visualVariableSizeUnitValue},Pe={uniforms:he,optionalAttributes:{zoomRange:!!O.scaleInfo}},ve=!!(he.visualVariableSizeMinMaxValue||he.visualVariableSizeScaleStops||he.visualVariableSizeStops||he.visualVariableSizeUnitValue);return V.spriteRasterizationParam?B(ie.ensureInstance(r.YS.texturedLine,Pe),V,ve,O):S(ie.ensureInstance(r.YS.line,Pe),V,ve,O)}function R(V,c,{scaleInfo:O}){return{color:C(V.color)??[0,0,0,0],width:V.width,referenceWidth:V.referenceWidth,capType:V.cap,joinType:V.join,miterLimit:V.miterLimit,scaleInfo:O,hasSizeVV:c,effects:V.effects?{type:"cim-effect-infos",effectInfos:V.effects}:null}}function S(V,c,O,M){if(c.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const q=R(c,O,M);return[V.createMeshInfo(q)]}function B(V,c,O,M){const{spriteRasterizationParam:q,scaleDash:ie,sampleAlphaOnly:he}=c;if(!q)throw new Error("InternalError: Sprite should be defined");return[V.createMeshInfo({...R(c,O,M),offsetAlongLine:c.offsetAlongLine??0,shouldScaleDash:ie??!1,shouldSampleAlphaOnly:he,isSDF:"CIMPictureStroke"!==q.resource.type&&"CIMGradientStroke"!==q.resource.type,sprite:q})]}function Z(V,c,O){const{uniforms:M,schemaOptions:q}=c,{store:ie}=q;return I(ie.ensureInstance(r.YS.gradientStroke,{uniforms:V.isOutline?{...e.Dk,visualVariableSizeScaleStops:M.visualVariableSizeOutlineScaleStops}:{visualVariableColor:null,visualVariableOpacity:M.visualVariableOpacity,visualVariableSizeMinMaxValue:M.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:M.visualVariableSizeScaleStops,visualVariableSizeStops:M.visualVariableSizeStops,visualVariableSizeUnitValue:M.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!O.scaleInfo}}),V,O)}function I(V,c,O){if(!c.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const M=c.spriteRasterizationParam;return[V.createMeshInfo({...R(c,!1,O),gradientMethod:c.gradientMethod,gradientSize:c.gradientSize,gradientSizeUnits:c.gradientSizeUnits,gradientType:c.gradientType,sprite:M,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null})]}function te(V,c,O){const{uniforms:M,schemaOptions:q}=c,{store:ie}=q;return fe(ie.ensureInstance(r.YS.text,{uniforms:{visualVariableColor:V.colorLocked?null:M.visualVariableColor,visualVariableOpacity:M.visualVariableOpacity,visualVariableRotation:M.visualVariableRotation,visualVariableSizeMinMaxValue:M.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:M.visualVariableSizeScaleStops,visualVariableSizeStops:M.visualVariableSizeStops,visualVariableSizeUnitValue:M.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!O.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),V,M,O)}function fe(V,c,O,{scaleInfo:M,scaleExpression:q}){return[V.createMeshInfo({boxBackgroundColor:C(c.backgroundColor),boxBorderLineColor:C(c.borderLineColor),boxBorderLineSize:c.borderLineWidth??0,color:C(c.color)??[0,0,0,0],offsetX:c.offsetX,offsetY:c.offsetY,postAngle:c.angle,fontSize:c.size,referenceSize:c.referenceSize,decoration:c.decoration,haloColor:C(c.haloColor)??[0,0,0,0],haloSize:c.haloSize??0,outlineColor:C(c.outlineColor)??[0,0,0,0],outlineSize:c.outlineSize,lineWidth:c.lineWidth||512,lineHeightRatio:1,horizontalAlignment:c.horizontalAlignment??"center",verticalAlignment:c.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:c.textRasterizationParam,scaleInfo:M,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null,placement:c.markerPlacement,transforms:c.transform,scaleFactor:q??1,minPixelBuffer:(0,e.j0)(O),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}},99845:(we,de,m)=>{function F(o){return!!(o.visualVariableSizeMinMaxValue||o.visualVariableSizeScaleStops||o.visualVariableSizeStops||o.visualVariableSizeUnitValue||o.visualVariableSizeOutlineScaleStops)}function z(o){return!!o.visualVariableRotation}m.d(de,{I:()=>F,N:()=>z})},79213:(we,de,m)=>{m.d(de,{R:()=>K,e:()=>$});var F=m(5922),z=m(35150),o=m(67685),me=m(54551);const r=8,e=r-2,pe=()=>z.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function K(U){return U.map(k=>function C(U){return("size"===U.type||"color"===U.type||"opacity"===U.type)&&null!=U.stops}(k)?function oe(U){return U.stops=function ee(U,k){return k.length<=r?k:(pe().warn(`Found ${k.length} Visual Variable stops, but MapView only supports ${r}. Displayed stops will be simplified.`),k.length>2*r?function N(U,k){const[g,...D]=k,se=D.pop(),R=D[0].value,S=D[D.length-1].value,B=(S-R)/e,Z=[];for(let I=R;I<S;I+=B){let te=0;for(;I>=D[te].value;)te++;const fe=D[te],V=k[te-1],O=fe.value===V.value?1:(I-V.value)/(fe.value-V.value);if("color"===U){const M=D[te],q=k[te-1],ie=M.color.clone();ie.r=P(q.color.r,ie.r,O),ie.g=P(q.color.g,ie.g,O),ie.b=P(q.color.b,ie.b,O),ie.a=P(q.color.a,ie.a,O),Z.push({value:I,color:ie,label:M.label})}else if("size"===U){const M=D[te],q=k[te-1],ie=(0,o.cr)(M.size),he=P((0,o.cr)(q.size),ie,O);Z.push({value:I,size:he,label:M.label})}else{const M=D[te],q=P(k[te-1].opacity,M.opacity,O);Z.push({value:I,opacity:q,label:M.label})}}return[g,...Z,se]}(U,k):function re(U){const[k,...g]=U,D=g.pop();for(;g.length>e;){let se=0,R=0;for(let S=1;S<g.length;S++){const I=Math.abs(g[S].value-g[S-1].value);I>R&&(R=I,se=S)}g.splice(se,1)}return[k,...g,D]}(k))}(U.type,U.stops??[]),U}(k.clone()):k)}function P(U,k,g){return(1-g)*U+g*k}function $(U){if(!U)return!0;switch(U.type){case"dot-density":break;case"heatmap":if(!function J(){const{supportsColorBufferFloat:U,supportsColorBufferFloatBlend:k,supportsColorBufferHalfFloat:g}=(0,me.C)();return U&&k||g}()){const k=(0,me.C)(),g=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(D=>!k[D]).join(", ");return pe().errorOnce(new F.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${g}`)),!1}}return!0}},31411:(we,de,m)=>{m.d(de,{j:()=>e});var F=m(10467),z=m(56492),o=m(71635),me=m(35547);class r{constructor(){this.type="override-batch",this.messages=[],this._resovler=(0,z.Tw)()}get promise(){return this._resovler.promise}resolve(){this._resovler.resolve()}add(K){this.messages.push(K)}}class e{constructor(K){var oe,C=this;this.updateTracking=new me.F({debugName:"FeatureCommandQueue"}),this.process=K.process,this._queueProcessor=new o.QueueProcessor({concurrency:1,process:(oe=(0,F.A)(function*(P){if("override-batch"===P.type){const N=C._nextOverrideBatch;if(null==N)throw new Error("InternalError: Override should be defined");return C._nextOverrideBatch=null,yield C.process(N),void N.resolve()}return C.process(P)}),function(N){return oe.apply(this,arguments)})})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}push(K){var C=this;return(0,F.A)(function*(){return(0,z.QZ)(C.updateTracking.addPromise(C._doPush(K)))})()}_doPush(K){var C=this;return(0,F.A)(function*(){const oe=C._queueProcessor,P=oe.last();switch(K.type){case"update":case"highlight":return P?.type===K.type?void 0:oe.push(K);case"override":case"edit":return C._pushOverride(K)}})()}_pushOverride(K){return null==this._nextOverrideBatch&&(this._nextOverrideBatch=new r,this._queueProcessor.push(this._nextOverrideBatch)),this._nextOverrideBatch.add(K),this._nextOverrideBatch.promise}}}}]);