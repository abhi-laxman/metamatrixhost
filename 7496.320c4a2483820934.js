"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[7496,6598],{13305:(z,W,e)=>{e.r(W),e.d(W,{default:()=>yt});var d=e(10467),t=e(8189),U=e(31178),u=e(2993),F=e(5922),O=e(77806),j=e(4879),w=e(35150),Z=e(39693),C=e(56492),R=e(45272),i=e(85211),I=(e(3248),e(17221)),v=e(76576),S=e(32034),c=e(95478),f=e(81098),b=e(92165),y=e(89563),A=e(49976),P=e(55098),h=e(64261),n=(e(40707),e(15463)),s=e(28067),_=e(35940),x=e(3046),M=e(55739),a=e(22329);let l=class extends(x.A.IdentifiableMixin(Z.L)){constructor(r){super(r),this.title="",this.id=-1,this.modelName=null,this.isEmpty=null,this.legendEnabled=!0,this.visible=!0,this.opacity=1}readTitle(r,p){return"string"==typeof p.alias?p.alias:"string"==typeof p.name?p.name:""}readIdOnlyOnce(r){return-1!==this.id?this.id:"number"==typeof r?r:-1}};(0,t._)([(0,i.MZ)({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],l.prototype,"title",void 0),(0,t._)([(0,I.w)("service","title",["alias","name"])],l.prototype,"readTitle",null),(0,t._)([(0,i.MZ)()],l.prototype,"layer",void 0),(0,t._)([(0,i.MZ)({type:M.jz,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],l.prototype,"id",void 0),(0,t._)([(0,I.w)("service","id")],l.prototype,"readIdOnlyOnce",null),(0,t._)([(0,i.MZ)((0,a.Qo)(String))],l.prototype,"modelName",void 0),(0,t._)([(0,i.MZ)((0,a.Qo)(Boolean))],l.prototype,"isEmpty",void 0),(0,t._)([(0,i.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"legendEnabled",void 0),(0,t._)([(0,i.MZ)({type:Boolean,json:{name:"visibility",write:!0}})],l.prototype,"visible",void 0),(0,t._)([(0,i.MZ)({type:Number,json:{write:!0}})],l.prototype,"opacity",void 0),l=(0,t._)([(0,v.$)("esri.layers.buildingSublayers.BuildingSublayer")],l);const g=l;var D=e(75783),T=e(47516),N=e(3404),$=e(73258),G=e(86300),Y=e(27834),ne=e(10581),Ue=e(31595),we=e(87086),We=e(68778),Ke=e(41843),Ne=e(88485),Qe=e(51454),Se=e(64935);const Te=(0,N.p)();let L=class extends(P.A.LoadableMixin(h.A.EsriPromiseMixin(g))){constructor(r){super(r),this.type="building-component",this.nodePages=null,this.materialDefinitions=[],this.textureSetDefinitions=[],this.geometryDefinitions=[],this.indexInfo=null,this.serviceUpdateTimeStamp=null,this.store=null,this.attributeStorageInfo=[],this.fields=[],this.associatedLayer=null,this.outFields=null,this.listMode="show",this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType="3d-object"}get parsedUrl(){return this.layer?{path:`${this.layer.parsedUrl?.path}/sublayers/${this.id}`,query:this.layer.parsedUrl?.query}:{path:""}}get fieldsIndex(){return new $.A(this.fields)}readAssociatedLayer(r,p){const E=this.layer.associatedFeatureServiceItem,B=p.associatedLayerID;return null!=E&&"number"==typeof B?new _.default({portalItem:E,customParameters:this.customParameters,layerId:B}):null}get objectIdField(){if(null!=this.fields)for(const r of this.fields)if("oid"===r.type)return r.name;return null}get displayField(){return null!=this.associatedLayer?this.associatedLayer.displayField:void 0}get apiKey(){return this.layer.apiKey}get customParameters(){return this.layer.customParameters}get fullExtent(){return this.layer.fullExtent}get spatialReference(){return this.layer.spatialReference}get version(){return this.layer.version}get elevationInfo(){return this.layer.elevationInfo}get minScale(){return this.layer.minScale}get maxScale(){return this.layer.maxScale}get effectiveScaleRange(){return this.layer.effectiveScaleRange}get defaultPopupTemplate(){return this.createPopupTemplate()}load(r){const p=null!=r?r.signal:null,E=this._fetchService(p).then(()=>{this.indexInfo=(0,Y.F)(this.parsedUrl.path,this.rootNode,this.nodePages,this.customParameters,this.apiKey,w.A.getLogger(this),p)});return this.addResolvingPromise(E),Promise.resolve(this)}createPopupTemplate(r){return(0,Ke.tn)(this,r)}_fetchService(r){var p=this;return(0,d.A)(function*(){const E=(yield(0,y.A)(p.parsedUrl.path,{query:{f:"json",...p.customParameters,token:p.apiKey},responseType:"json",signal:r})).data;p.read(E,{origin:"service",url:p.parsedUrl})})()}getField(r){return this.fieldsIndex.get(r)}getFieldDomain(r,p){const E=this.getField(r)?.domain??null;return this.associatedLayer?(0,T.Vq)(this.associatedLayer,r,p,E):E}getFeatureType(r){return r&&null!=this.associatedLayer?this.associatedLayer.getFeatureType(r):null}get types(){return null!=this.associatedLayer?this.associatedLayer.types??[]:[]}get typeIdField(){return null!=this.associatedLayer?this.associatedLayer.typeIdField:null}get geometryType(){return"3d-object"===this.layerType?"mesh":"point"}get profile(){return"3d-object"===this.layerType?"mesh-pyramids":"points"}get capabilities(){const r=null!=this.associatedLayer&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:D.P,{query:p,data:{supportsZ:E,supportsM:B,isVersioned:Q}}=r;return{query:p,data:{supportsZ:E,supportsM:B,isVersioned:Q}}}createQuery(){const r=new we.A;return"mesh"!==this.geometryType&&(r.returnGeometry=!0,r.returnZ=!0),r.where=this.definitionExpression||"1=1",r.sqlFormat="standard",r}queryExtent(r,p){return this._getAssociatedLayerForQuery().then(E=>E.queryExtent(r||this.createQuery(),p))}queryFeatureCount(r,p){return this._getAssociatedLayerForQuery().then(E=>E.queryFeatureCount(r||this.createQuery(),p))}queryFeatures(r,p){return this._getAssociatedLayerForQuery().then(E=>E.queryFeatures(r||this.createQuery(),p)).then(E=>{if(E?.features)for(const B of E.features)B.layer=this.layer,B.sourceLayer=this;return E})}queryObjectIds(r,p){var E=this;return(0,d.A)(function*(){return(yield(yield E._getAssociatedLayerForQuery()).queryObjectIds(r||E.createQuery(),p)).filter(We.Et)})()}queryCachedAttributes(r,p){var E=this;return(0,d.A)(function*(){const B=(0,G.hL)(E.fieldsIndex,yield(0,Se.TO)(E,(0,Se.D8)(E)));return(0,Qe.s1)(E.parsedUrl.path,E.attributeStorageInfo,r,p,B,E.apiKey,E.customParameters)})()}queryCachedFeature(r,p){var E=this;return(0,d.A)(function*(){const B=yield E.queryCachedAttributes(r,[p]);if(!B||0===B.length)throw new F.A("scenelayer:feature-not-in-cached-data","Feature not found in cached data");return new f.A({attributes:B[0],layer:E,sourceLayer:E})})()}getFieldUsageInfo(r){return this.fieldsIndex.has(r)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:null!=this.associatedLayer}}_getAssociatedLayerForQuery(){const r=this.associatedLayer;return null!=r&&r.loaded?Promise.resolve(r):this._loadAssociatedLayerForQuery()}_loadAssociatedLayerForQuery(){var r=this;return(0,d.A)(function*(){if(yield r.load(),null==r.associatedLayer)throw new F.A("buildingscenelayer:query-not-available","BuildingSceneLayer component layer queries are not available without an associated feature layer",{layer:r});try{yield r.associatedLayer.load()}catch(p){throw new F.A("buildingscenelayer:query-not-available","BuildingSceneLayer associated feature layer could not be loaded",{layer:r,error:p})}return r.associatedLayer})()}};(0,t._)([(0,i.MZ)({readOnly:!0})],L.prototype,"parsedUrl",null),(0,t._)([(0,i.MZ)({type:ne.W4,readOnly:!0})],L.prototype,"nodePages",void 0),(0,t._)([(0,i.MZ)({type:[ne.uV],readOnly:!0})],L.prototype,"materialDefinitions",void 0),(0,t._)([(0,i.MZ)({type:[ne.Ot],readOnly:!0})],L.prototype,"textureSetDefinitions",void 0),(0,t._)([(0,i.MZ)({type:[ne.L0],readOnly:!0})],L.prototype,"geometryDefinitions",void 0),(0,t._)([(0,i.MZ)({readOnly:!0})],L.prototype,"serviceUpdateTimeStamp",void 0),(0,t._)([(0,i.MZ)({readOnly:!0})],L.prototype,"store",void 0),(0,t._)([(0,i.MZ)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],L.prototype,"rootNode",void 0),(0,t._)([(0,i.MZ)({readOnly:!0})],L.prototype,"attributeStorageInfo",void 0),(0,t._)([(0,i.MZ)(Te.fields)],L.prototype,"fields",void 0),(0,t._)([(0,i.MZ)({readOnly:!0})],L.prototype,"fieldsIndex",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:_.default})],L.prototype,"associatedLayer",void 0),(0,t._)([(0,I.w)("service","associatedLayer",["associatedLayerID"])],L.prototype,"readAssociatedLayer",null),(0,t._)([(0,i.MZ)(Te.outFields)],L.prototype,"outFields",void 0),(0,t._)([(0,i.MZ)({type:String,readOnly:!0})],L.prototype,"objectIdField",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:String,json:{read:!1}})],L.prototype,"displayField",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:String})],L.prototype,"apiKey",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:String})],L.prototype,"customParameters",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:s.A})],L.prototype,"fullExtent",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:S.A})],L.prototype,"spatialReference",null),(0,t._)([(0,i.MZ)({readOnly:!0})],L.prototype,"version",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:Ne.A})],L.prototype,"elevationInfo",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:Number})],L.prototype,"minScale",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:Number})],L.prototype,"maxScale",null),(0,t._)([(0,i.MZ)({readOnly:!0,type:Number})],L.prototype,"effectiveScaleRange",null),(0,t._)([(0,i.MZ)({type:["hide","show"],json:{write:!0}})],L.prototype,"listMode",void 0),(0,t._)([(0,i.MZ)({types:Ue.XJ,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],L.prototype,"renderer",void 0),(0,t._)([(0,i.MZ)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],L.prototype,"definitionExpression",void 0),(0,t._)([(0,i.MZ)(a.M6)],L.prototype,"popupEnabled",void 0),(0,t._)([(0,i.MZ)({type:b.A,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],L.prototype,"popupTemplate",void 0),(0,t._)([(0,i.MZ)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],L.prototype,"normalReferenceFrame",void 0),(0,t._)([(0,i.MZ)({readOnly:!0,json:{read:!1}})],L.prototype,"defaultPopupTemplate",null),(0,t._)([(0,i.MZ)()],L.prototype,"types",null),(0,t._)([(0,i.MZ)()],L.prototype,"typeIdField",null),(0,t._)([(0,i.MZ)({json:{write:!1}}),(0,n.e)(new A.J({"3DObject":"3d-object",Point:"point"}))],L.prototype,"layerType",void 0),(0,t._)([(0,i.MZ)()],L.prototype,"geometryType",null),(0,t._)([(0,i.MZ)()],L.prototype,"profile",null),(0,t._)([(0,i.MZ)({readOnly:!0,json:{read:!1}})],L.prototype,"capabilities",null),(0,t._)([(0,i.MZ)({readOnly:!0})],L.prototype,"statisticsInfo",void 0),L=(0,t._)([(0,v.$)("esri.layers.buildingSublayers.BuildingComponentSublayer")],L);const ye=L;var fe,Ge=e(96996);const De={type:U.A,readOnly:!0,json:{origins:{service:{read:{source:"sublayers",reader:xe}}},read:!1}};function xe(r,p,E){if(r&&Array.isArray(r))return new U.A(r.map(B=>{const Q=function ze(r){return"group"===r.layerType?V:ye}(B);if(Q){const oe=new Q;return oe.read(B,E),oe}return E?.messages&&B&&E.messages.push(new Ge.A("building-scene-layer:unsupported-sublayer-type","Building scene sublayer of type '"+(B.type||"unknown")+"' are not supported",{definition:B,context:E})),null}))}let V=fe=class extends g{constructor(r){super(r),this.type="building-group",this.listMode="show",this.sublayers=null}loadAll(){return(0,j.L)(this,r=>fe.forEachSublayer(this.sublayers,p=>{"building-group"!==p.type&&r(p)}))}};var r;(0,t._)([(0,i.MZ)({type:["hide","show","hide-children"],json:{write:!0}})],V.prototype,"listMode",void 0),(0,t._)([(0,i.MZ)(De)],V.prototype,"sublayers",void 0),V=fe=(0,t._)([(0,v.$)("esri.layers.buildingSublayers.BuildingGroupSublayer")],V),(r=V||(V={})).sublayersProperty=De,r.readSublayers=xe,r.forEachSublayer=function p(E,B){E.forEach(Q=>{B(Q),"building-group"===Q.type&&p(Q.sublayers,B)})};const k=V;var $e=e(94376),Je=e(25936),Ve=e(23e3),He=e(17049),Xe=e(85551),Ye=e(33036),he=e(46406),ke=e(86537),H=e(71065),qe=e(43085);let ie=class extends H.A{constructor(){super(...arguments),this.type=null}};(0,t._)([(0,i.MZ)({type:String,readOnly:!0,json:{write:{isRequired:!0}}})],ie.prototype,"type",void 0),ie=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterAuthoringInfo")],ie);const Fe=ie;var _e;let ee=_e=class extends H.A{constructor(){super(...arguments),this.filterType=null,this.filterValues=null}clone(){return new _e({filterType:this.filterType,filterValues:(0,O.o8)(this.filterValues)})}};var me;(0,t._)([(0,i.MZ)({type:String,json:{write:{isRequired:!0}}})],ee.prototype,"filterType",void 0),(0,t._)([(0,i.MZ)({type:[String],json:{write:{isRequired:!0}}})],ee.prototype,"filterValues",void 0),ee=_e=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterAuthoringInfoType")],ee);const tt=U.A.ofType(ee);let ae=me=class extends H.A{clone(){return new me({filterTypes:(0,O.o8)(this.filterTypes)})}};var ge;(0,t._)([(0,i.MZ)({type:tt,json:{write:{isRequired:!0}}})],ae.prototype,"filterTypes",void 0),ae=me=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterAuthoringInfoBlock")],ae);const st=U.A.ofType(ae);let te=ge=class extends Fe{constructor(){super(...arguments),this.type="checkbox"}clone(){return new ge({filterBlocks:(0,O.o8)(this.filterBlocks)})}};(0,t._)([(0,i.MZ)({type:["checkbox"]})],te.prototype,"type",void 0),(0,t._)([(0,i.MZ)({type:st,json:{write:{isRequired:!0}}})],te.prototype,"filterBlocks",void 0),te=ge=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterAuthoringInfoCheckbox")],te);const Re=te;let le=class extends H.A{};(0,t._)([(0,i.MZ)({readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],le.prototype,"type",void 0),le=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterMode")],le);const ue=le;var ve;let pe=ve=class extends ue{constructor(){super(...arguments),this.type="solid"}clone(){return new ve}};(0,t._)([(0,i.MZ)({type:["solid"],readOnly:!0,json:{write:{isRequired:!0}}})],pe.prototype,"type",void 0),pe=ve=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterModeSolid")],pe);const Me=pe;var Ee,ot=e(91033);let re=Ee=class extends ue{constructor(){super(...arguments),this.type="wire-frame",this.edges=null}clone(){return new Ee({edges:(0,O.o8)(this.edges)})}};(0,t._)([(0,n.e)({wireFrame:"wire-frame"})],re.prototype,"type",void 0),(0,t._)([(0,i.MZ)(ot.J)],re.prototype,"edges",void 0),re=Ee=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterModeWireFrame")],re);const Be=re;var Ae;let de=Ae=class extends ue{constructor(){super(...arguments),this.type="x-ray"}clone(){return new Ae}};(0,t._)([(0,i.MZ)({type:["x-ray"],readOnly:!0,json:{write:{isRequired:!0}}})],de.prototype,"type",void 0),de=Ae=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterModeXRay")],de);const Le=de;var Oe;const nt={nonNullable:!0,types:{key:"type",base:ue,typeMap:{solid:Me,"wire-frame":Be,"x-ray":Le}},json:{read:r=>{switch(r?.type){case"solid":return Me.fromJSON(r);case"wireFrame":return Be.fromJSON(r);case"x-ray":return Le.fromJSON(r);default:return}},write:{enabled:!0,isRequired:!0}}};let q=Oe=class extends H.A{constructor(){super(...arguments),this.filterExpression=null,this.filterMode=new Me,this.title=""}clone(){return new Oe({filterExpression:this.filterExpression,filterMode:(0,O.o8)(this.filterMode),title:this.title})}};var Ie;(0,t._)([(0,i.MZ)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],q.prototype,"filterExpression",void 0),(0,t._)([(0,i.MZ)(nt)],q.prototype,"filterMode",void 0),(0,t._)([(0,i.MZ)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],q.prototype,"title",void 0),q=Oe=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilterBlock")],q);const at=U.A.ofType(q);let X=Ie=class extends H.A{constructor(){super(...arguments),this.description=null,this.filterBlocks=null,this.id=(0,qe.lk)(),this.name=null}clone(){return new Ie({description:this.description,filterBlocks:(0,O.o8)(this.filterBlocks),id:this.id,name:this.name,filterAuthoringInfo:(0,O.o8)(this.filterAuthoringInfo)})}};(0,t._)([(0,i.MZ)({type:String,json:{write:!0}})],X.prototype,"description",void 0),(0,t._)([(0,i.MZ)({type:at,json:{write:{enabled:!0,isRequired:!0}}})],X.prototype,"filterBlocks",void 0),(0,t._)([(0,i.MZ)({types:{key:"type",base:Fe,typeMap:{checkbox:Re}},json:{read:r=>"checkbox"===r?.type?Re.fromJSON(r):null,write:!0}})],X.prototype,"filterAuthoringInfo",void 0),(0,t._)([(0,i.MZ)({type:String,constructOnly:!0,json:{write:{enabled:!0,isRequired:!0}}})],X.prototype,"id",void 0),(0,t._)([(0,i.MZ)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],X.prototype,"name",void 0),X=Ie=(0,t._)([(0,v.$)("esri.layers.support.BuildingFilter")],X);const lt=X;let J=class extends H.A{constructor(){super(...arguments),this.fieldName=null,this.modelName=null,this.label=null,this.min=null,this.max=null,this.mostFrequentValues=null,this.subLayerIds=null}};(0,t._)([(0,i.MZ)({type:String})],J.prototype,"fieldName",void 0),(0,t._)([(0,i.MZ)({type:String})],J.prototype,"modelName",void 0),(0,t._)([(0,i.MZ)({type:String})],J.prototype,"label",void 0),(0,t._)([(0,i.MZ)({type:Number})],J.prototype,"min",void 0),(0,t._)([(0,i.MZ)({type:Number})],J.prototype,"max",void 0),(0,t._)([(0,i.MZ)({json:{read:r=>Array.isArray(r)&&(r.every(p=>"string"==typeof p)||r.every(p=>"number"==typeof p))?r.slice():null}})],J.prototype,"mostFrequentValues",void 0),(0,t._)([(0,i.MZ)({type:[Number]})],J.prototype,"subLayerIds",void 0),J=(0,t._)([(0,v.$)("esri.layers.support.BuildingSummaryStatistics.BuildingFieldStatistics")],J);let se=class extends(P.A.LoadableMixin(h.A.EsriPromiseMixin(H.A))){constructor(){super(...arguments),this.url=null}get fields(){return this.loaded||"loading"===this.loadStatus?this._get("fields"):(w.A.getLogger(this).error("building summary statistics are not loaded"),null)}load(r){return this.addResolvingPromise(this._fetchService(null!=r?r.signal:null)),Promise.resolve(this)}_fetchService(r){var p=this;return(0,d.A)(function*(){const E=(yield(0,y.A)(p.url,{query:{f:"json"},responseType:"json",signal:r})).data;p.read(E,{origin:"service"})})()}};(0,t._)([(0,i.MZ)({constructOnly:!0,type:String})],se.prototype,"url",void 0),(0,t._)([(0,i.MZ)({readOnly:!0,type:[J],json:{read:{source:"summary"}}})],se.prototype,"fields",null),se=(0,t._)([(0,v.$)("esri.layers.support.BuildingSummaryStatistics")],se);const je=se;var ce=e(73812);const Ce=U.A.ofType(lt),be=(0,O.o8)(k.sublayersProperty),Pe=be.json?.origins;Pe&&(Pe["web-scene"]={type:[ye],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},Pe["portal-item"]={type:[ye],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}});let K=class extends((0,he.w6)((0,Je.b)((0,He.q)((0,Xe.A)((0,Ye.j)((0,Z.P)((0,Ve.d)((0,$e.p)(c.A))))))))){constructor(r){super(r),this.operationalLayerType="BuildingSceneLayer",this.allSublayers=new u.A({getCollections:()=>[this.sublayers],getChildrenFunction:p=>"building-group"===p.type?p.sublayers:null}),this.sublayers=null,this._allSublayerOverrides=null,this.filters=new Ce,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.legendEnabled=!0,this.type="building-scene"}normalizeCtorArgs(r){return"string"==typeof r?{url:r}:r??{}}destroy(){this.allSublayers.destroy()}readSublayers(r,p,E){const B=k.readSublayers(r,p,E);return k.forEachSublayer(B,Q=>Q.layer=this),this._allSublayerOverrides&&(function ut(r,p){p.forEach(E=>Ze(r,E))}(B,this._allSublayerOverrides),this._allSublayerOverrides=null),B}write(r,p){return r=super.write(r,p),!p||"web-scene"!==p.origin&&"portal-item"!==p.origin||(this.sublayers?function dt(r,p,E){const B=[];k.forEachSublayer(r,Q=>{const oe=Q.write({},E);Object.keys(oe).length>1&&B.push(oe)}),B.length>0&&(p.sublayers=B)}(this.sublayers,r,p):this._allSublayerOverrides&&function ct(r,p,E){const B=E?.origin&&r.get(E.origin);B&&(p.sublayers=[],B.overrides.forEach(Q=>{p.sublayers.push((0,O.o8)(Q))}))}(this._allSublayerOverrides,r,p)),r}read(r,p){if(super.read(r,p),("web-scene"===p?.origin||"portal-item"===p?.origin)&&Array.isArray(r?.sublayers)){const E=function pt(r,p){const E=new Map;for(const B of r)null!=B&&"object"==typeof B&&"number"==typeof B.id?E.set(B.id,B):p.messages?.push(new F.A("building-scene-layer:invalid-sublayer-override","Invalid value for sublayer override. Not an object or no id specified.",{value:B}));return{overrides:E,context:p}}(r.sublayers,p);this.sublayers?Ze(this.sublayers,E):(this._allSublayerOverrides??=new Map,this._allSublayerOverrides.set(p.origin,E))}}readSummaryStatistics(r,p){if("string"==typeof p.statisticsHRef){const E=(0,R.fj)(this.parsedUrl?.path,p.statisticsHRef);return new je({url:E})}return null}set elevationInfo(r){null!=r&&"absolute-height"!==r.mode||this._set("elevationInfo",r),this._validateElevationInfo(r)}load(r){const p=null!=r?r.signal:null,E=this.loadFromPortal({supportedTypes:["Scene Service"]},r).catch(C.QP).then(()=>this._fetchService(p)).then(()=>this._fetchAssociatedFeatureService(p));return this.addResolvingPromise(E),Promise.resolve(this)}loadAll(){return(0,j.g)(this,r=>{k.forEachSublayer(this.sublayers,p=>{"building-group"!==p.type&&r(p)}),this.summaryStatistics&&r(this.summaryStatistics)})}saveAs(r,p){var E=this;return(0,d.A)(function*(){return E._debouncedSaveOperations(he.Xh.SAVE_AS,{...p,getTypeKeywords:()=>E._getTypeKeywords(),portalItemLayerType:"building-scene"},r)})()}save(){var r=this;return(0,d.A)(function*(){const p={getTypeKeywords:()=>r._getTypeKeywords(),portalItemLayerType:"building-scene"};return r._debouncedSaveOperations(he.Xh.SAVE,p)})()}validateLayer(r){if(!r.layerType||"Building"!==r.layerType)throw new F.A("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",{layerType:r.layerType})}_getTypeKeywords(){return["Building"]}_fetchAssociatedFeatureService(r){var p=this;return(0,d.A)(function*(){try{const{portalItem:E}=yield(0,ke.L)(`${p.url}/layers/${p.layerId}`,{sceneLayerItem:p.portalItem,customParameters:p.customParameters,apiKey:p.apiKey,signal:r});p.associatedFeatureServiceItem=E}catch(E){w.A.getLogger(p).warn("Associated feature service item could not be loaded",E)}})()}_validateElevationInfo(r){const p="Building scene layers";(0,ce.XF)(w.A.getLogger(this),(0,ce.B)(p,"absolute-height",r)),(0,ce.XF)(w.A.getLogger(this),(0,ce.tW)(p,r))}};function Ze(r,p){const{overrides:E,context:B}=p;k.forEachSublayer(r,Q=>Q.read(E.get(Q.id),B))}(0,t._)([(0,i.MZ)({type:["BuildingSceneLayer"]})],K.prototype,"operationalLayerType",void 0),(0,t._)([(0,i.MZ)({readOnly:!0})],K.prototype,"allSublayers",void 0),(0,t._)([(0,i.MZ)(be)],K.prototype,"sublayers",void 0),(0,t._)([(0,I.w)("service","sublayers")],K.prototype,"readSublayers",null),(0,t._)([(0,i.MZ)({type:Ce,nonNullable:!0,json:{write:!0}})],K.prototype,"filters",void 0),(0,t._)([(0,i.MZ)({type:String,json:{write:!0}})],K.prototype,"activeFilterId",void 0),(0,t._)([(0,i.MZ)({readOnly:!0,type:je})],K.prototype,"summaryStatistics",void 0),(0,t._)([(0,I.w)("summaryStatistics",["statisticsHRef"])],K.prototype,"readSummaryStatistics",null),(0,t._)([(0,i.MZ)({type:[String],json:{read:!1}})],K.prototype,"outFields",void 0),(0,t._)([(0,i.MZ)(a.Fm)],K.prototype,"fullExtent",void 0),(0,t._)([(0,i.MZ)(a.fV)],K.prototype,"legendEnabled",void 0),(0,t._)([(0,i.MZ)({type:["show","hide","hide-children"]})],K.prototype,"listMode",void 0),(0,t._)([(0,i.MZ)((0,a.Qo)(S.A))],K.prototype,"spatialReference",void 0),(0,t._)([(0,i.MZ)(a.Yj)],K.prototype,"elevationInfo",null),(0,t._)([(0,i.MZ)({json:{read:!1},readOnly:!0})],K.prototype,"type",void 0),(0,t._)([(0,i.MZ)()],K.prototype,"associatedFeatureServiceItem",void 0),K=(0,t._)([(0,v.$)("esri.layers.BuildingSceneLayer")],K);const yt=K},43124:(z,W,e)=>{e.d(W,{Rr:()=>Z,fY:()=>i,ne:()=>R});var d=e(8189),t=e(89221),U=e(85211),j=(e(3248),e(35150),e(40707),e(76576)),w=e(15848);function Z(m,I,v){if(!m)return null;const S=m.find(f=>!!f.field);if(!S)return null;const c=new w.A;return c.read(S,v),[c]}const R={type:[w.A],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:Z},write:{writer:function C(m,I,v,S){const c=m.find(f=>!!f.field);c&&(0,t.sM)(v,[c.toJSON()],I)}}}},i=m=>{let I=class extends m{constructor(){super(...arguments),this.orderBy=null}};return(0,d._)([(0,U.MZ)(R)],I.prototype,"orderBy",void 0),I=(0,d._)([(0,j.$)("esri.layers.mixins.OrderedLayer")],I),I}},47063:(z,W,e)=>{e.d(W,{A:()=>I});var d=e(8189),t=e(90660),U=e(71065),u=e(85211),w=(e(3248),e(35150),e(40707),e(17221)),Z=e(76576),C=e(50305),R=e(39664),i=e(69741);let m=class extends(t.A.ClonableMixin(U.A)){constructor(v){super(v),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(v){const S={};for(const c of Object.keys(v))S[c]=(0,R.rS)(v[c]);return S}writeDomains(v,S){const c={};for(const f of Object.keys(v))v[f]&&(c[f]=v[f]?.toJSON());S.domains=c}};(0,d._)([(0,u.MZ)({json:{write:!0}})],m.prototype,"id",void 0),(0,d._)([(0,u.MZ)({json:{write:!0}})],m.prototype,"name",void 0),(0,d._)([(0,u.MZ)({json:{write:!0}})],m.prototype,"domains",void 0),(0,d._)([(0,w.w)("domains")],m.prototype,"readDomains",null),(0,d._)([(0,C.K)("domains")],m.prototype,"writeDomains",null),(0,d._)([(0,u.MZ)({type:[i.A],json:{write:!0}})],m.prototype,"templates",void 0),m=(0,d._)([(0,Z.$)("esri.layers.support.FeatureType")],m);const I=m},64584:(z,W,e)=>{e.d(W,{A:()=>R});var Z,d=e(8189),t=e(31178),U=e(71065),u=e(85211),w=(e(3248),e(35150),e(40707),e(76576));let C=Z=class extends U.A{constructor(i){super(i),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new t.A}clone(){return new Z({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,d._)([(0,u.MZ)({type:String,json:{write:{isRequired:!0}}})],C.prototype,"floorField",void 0),(0,d._)([(0,u.MZ)({json:{read:!1,write:!1}})],C.prototype,"viewAllMode",void 0),(0,d._)([(0,u.MZ)({json:{read:!1,write:!1}})],C.prototype,"viewAllLevelIds",void 0),C=Z=(0,d._)([(0,w.$)("esri.layers.support.LayerFloorInfo")],C);const R=C},15848:(z,W,e)=>{e.d(W,{A:()=>i});var Z,d=e(8189),t=e(49976),U=e(71065),u=e(85211),w=(e(3248),e(35150),e(40707),e(76576));const C=new t.J({asc:"ascending",desc:"descending"});let R=Z=class extends U.A{constructor(m){super(m),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Z({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,d._)([(0,u.MZ)({type:String,json:{write:!0}})],R.prototype,"field",void 0),(0,d._)([(0,u.MZ)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],R.prototype,"valueExpression",void 0),(0,d._)([(0,u.MZ)({type:C.apiValues,json:{type:C.jsonValues,read:C.read,write:C.write}})],R.prototype,"order",void 0),R=Z=(0,d._)([(0,w.$)("esri.layers.support.OrderByInfo")],R);const i=R},36267:(z,W,e)=>{e.d(W,{A:()=>m});var d=e(8189),t=e(90660),U=e(49976),u=e(71065),F=e(85211),Z=(e(3248),e(35150),e(40707),e(76576));const C=new U.J({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),R=new U.J({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let i=class extends(t.A.ClonableMixin(u.A)){constructor(I){super(I),this.cardinality=null,this.catalogId=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,d._)([(0,F.MZ)({json:{read:C.read,write:C.write}})],i.prototype,"cardinality",void 0),(0,d._)([(0,F.MZ)({json:{name:"catalogID"}})],i.prototype,"catalogId",void 0),(0,d._)([(0,F.MZ)({json:{read:!0,write:!0}})],i.prototype,"composite",void 0),(0,d._)([(0,F.MZ)({json:{read:!0,write:!0}})],i.prototype,"id",void 0),(0,d._)([(0,F.MZ)({json:{read:!0,write:!0}})],i.prototype,"keyField",void 0),(0,d._)([(0,F.MZ)({json:{read:!0,write:!0}})],i.prototype,"keyFieldInRelationshipTable",void 0),(0,d._)([(0,F.MZ)({json:{read:!0,write:!0}})],i.prototype,"name",void 0),(0,d._)([(0,F.MZ)({json:{read:!0,write:!0}})],i.prototype,"relatedTableId",void 0),(0,d._)([(0,F.MZ)({json:{read:!0,write:!0}})],i.prototype,"relationshipTableId",void 0),(0,d._)([(0,F.MZ)({json:{read:R.read,write:R.write}})],i.prototype,"role",void 0),i=(0,d._)([(0,Z.$)("esri.layers.support.Relationship")],i);const m=i},85791:(z,W,e)=>{e.d(W,{A:()=>S});var d=e(10467),t=e(8189),U=e(98877),u=e(89447),F=e(31178),O=e(85211),C=(e(3248),e(35150),e(40707),e(76576)),R=e(86300),i=e(48218);let v=class extends U.A{constructor(c){super(c),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,u.UT)(()=>(0,i.lw)()):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??e.e(3958).then(e.bind(e,93958)).then(c=>this._featureUtils=c)}get calculatedExpressions(){const c=new F.A;if(!this.expressionsUsedInTitle.length)return c;if(!this._arcadeTask?.value){for(const f of this.expressionsUsedInTitle??[])c.push({name:f.name,invalid:!0});return c}for(const f of this.expressionsUsedInTitle)try{const b=this._arcadeTask.value.arcade.parseScript(f.expression,["$layer","$map","$datastore"]);if(b.isAsync){c.push({name:f.name,invalid:!0});break}c.push({name:f.name,syntax:b,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(b,{vars:{$feature:"any"}})})}catch{c.push({name:f.name,invalid:!0});break}return c}get expressionsUsedInTitle(){let c=this.effectivePopupTemplate?.title??"";return"string"!=typeof c?[]:(c=c.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter(f=>c.includes(`{expression/${f.name.toLowerCase()}}`))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some(c=>!0===c.invalid)}get requiredFields(){const c=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const b of this.calculatedExpressions?.toArray()??[])try{const y=this._arcadeTask.value.arcade.extractFieldLiterals(b.syntax);for(const A of y){const P=A.split("."),h=this.fieldsIndex.get(P.at(-1)??"");h&&c.add(h.name)}}catch{}const f=this._extractFieldNames(this.workingTitle);for(const b of f){const y=this.fieldsIndex.get(b);y&&c.add(y.name)}return c}get titleFromDisplayField(){let c="";return this.displayField&&(c=this.fieldsIndex.get(this.displayField)?.name??""),c||(c=this.fieldsIndex.get(this.objectIdField)?.name??""),c?`{${c}}`:""}get workingTitle(){const c=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===c||null==c||this.hasBadExpressions||"string"!=typeof c?this.titleFromDisplayField:c}getTitle(c,f,b){var y=this;return(0,d.A)(function*(){try{const{attributes:A}=f,P=b?.timeZone??"system",[{substituteFieldsInLinksAndAttributes:h}]=yield Promise.all([y.featureUtilsPromise,y._arcadeTask?.promise]);if(b.fetchMissingFields&&(f=yield y._checkAndReQueryGraphic(c,f)),y.workingTitle&&y.fieldInfoMap){const o=y._createFormattedAttributes(c,f,P).global;return h({attributes:A,expressionAttributes:null,fieldInfoMap:y.fieldInfoMap,globalAttributes:o,layer:c,text:y.workingTitle})}return""}catch{}return""})()}_checkAndReQueryGraphic(c,f){var b=this;return(0,d.A)(function*(){const y=f.getObjectId();if(null==y)return f;if(!(0,R.Kl)(b.requiredFields,f)){const A=c.createQuery();A.where="1=1",A.outFields=[...b.requiredFields],A.objectIds=[y];const P=yield c.queryFeatures(A);if(1===P?.features.length)return P.features[0]}return f})()}_createFieldInfoMap(c){const f=new Map;if(!c)return f;for(const b of c){if(!b.fieldName)continue;const y=this.fieldsIndex.get(b.fieldName),A=y?.name??b.fieldName;b.fieldName=A,f.set(A.toLowerCase(),b)}return f}_createFormattedAttributes(c,f,b="system"){const y=this.effectivePopupTemplate?.fieldInfos??[],A={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const h=this._arcadeTask.value.Feature.createFromGraphicLikeObject(f.geometry,f.attributes,c,null);for(const o of this.calculatedExpressions)try{A[`expression/${o.name}`]=o.func({vars:{$feature:h}})}catch{}}const P={...f.attributes,...A};return{global:this._featureUtils.formatAttributes({fieldInfos:y,attributes:P,graphic:f,timeZone:b,layer:c,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(c){return(0,R.nw)(c).filter(f=>!(0===f.indexOf("relationships/")||0===f.indexOf("expression/")))}};(0,t._)([(0,O.MZ)({readOnly:!0})],v.prototype,"_arcadeTask",null),(0,t._)([(0,O.MZ)()],v.prototype,"_featureUtils",void 0),(0,t._)([(0,O.MZ)({readOnly:!0})],v.prototype,"featureUtilsPromise",null),(0,t._)([(0,O.MZ)({readOnly:!0})],v.prototype,"calculatedExpressions",null),(0,t._)([(0,O.MZ)()],v.prototype,"displayField",void 0),(0,t._)([(0,O.MZ)()],v.prototype,"effectivePopupTemplate",void 0),(0,t._)([(0,O.MZ)()],v.prototype,"expressionsUsedInTitle",null),(0,t._)([(0,O.MZ)()],v.prototype,"fieldsIndex",void 0),(0,t._)([(0,O.MZ)()],v.prototype,"fieldInfoMap",null),(0,t._)([(0,O.MZ)()],v.prototype,"fields",void 0),(0,t._)([(0,O.MZ)()],v.prototype,"objectIdField",void 0),(0,t._)([(0,O.MZ)()],v.prototype,"requiredFields",null),v=(0,t._)([(0,C.$)("esri.layers.support.TitleCreator")],v);const S=v},27960:(z,W,e)=>{e.d(W,{Ch:()=>F,mW:()=>U,u2:()=>u});var d=e(69287),t=e(63484);function U(m,I){return{...I,filterMode:m.mode}}function u(m,I){return j(m,I).next().value??null}function F(m,I,v){const S=function O(m){if("manual"===C(m))return null;const I=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:v,maxScale:S}of m.filters)I[0]=Math.max(I[0],R(v)),I[1]=Math.min(I[1],i(S));return I}(m);if(S&&((0,d.gg)(I,S[0])||(0,d.ZH)(v,S[1])))return"";const c=Array.from(j(m,I,v)),f=function w(m,I,v){if(0===m.length)return!0;const S=R(m.at(0)?.minScale),c=i(m.at(-1)?.maxScale);if((0,d.ZH)(S,I)||(0,d.gg)(c,v))return!0;for(let f=0;f<m.length-1;f++){const b=m[f];if((0,d.ZH)(R(m[f+1].minScale),i(b.maxScale)))return!0}return!1}(c,I,v)?"1=1":c.map(b=>b.where||"1=1").reduce((b,y)=>(0,t.IW)(b,y),"");return f&&"1=1"!==f?f:""}function*j(m,I,v){if("manual"===C(m)){const S=m.filters.find(c=>c.id===m.activeFilterId);S&&(yield S)}else{"object"==typeof I&&(I=I.scale);for(const S of m.filters)Z(S.minScale,S.maxScale,I,v)&&(yield S)}}function Z(m,I,v,S){return m=R(m),v=R(v),I=i(I),!(!(0,d.Sp)(v,m)&&(S??v)>m||(0,d.Hx)(I,v)||void 0!==S&&(0,d.Sp)(S,m))}function C(m){return"mode"in m?m.mode:m.filterMode}function R(m){return m||Number.POSITIVE_INFINITY}function i(m){return m||0}},6829:(z,W,e)=>{e.d(W,{CW:()=>m,Fm:()=>w,Hz:()=>I,JQ:()=>i,JZ:()=>n,ND:()=>S,R_:()=>O,U9:()=>R,fu:()=>t,nr:()=>v,oF:()=>U,rq:()=>Z,z$:()=>C});const d=[["binary","application/octet-stream","bin",""]];function t(s,_){return null!=y(_.name,s?.supportedFormats??[])}function U(s,_){if(!s)return!1;const x=Z(_,s.supportedFormats??[]);return null!=x&&s.editFormats.includes(x)}function O(s,_){return A(function b(s,_){const x=s.toLowerCase();return c(_).find(M=>P(M)===x)}(s,_))}function j(s,_){return A(y(s,_))}function w(s,_){return P(function f(s,_){return c(_).find(x=>A(x)===s)}(s,_))}function Z(s,_){return j(s.name,_)??O(s.type,_)}function C(s,_,x){return O(s,x)??j(_,x)}function R({supportedFormats:s}){return C("model/gltf-binary","glb",s)}function i(s){const _=R(s);return null!=_&&s.editFormats.includes(_)}function m({supportedFormats:s}){return C("model/gltf+json","gltf",s)}function I(s){if(!s)return null;const _=R(s),x=m(s);let M=null;for(const a of s.queryFormats){if(a===_)return a;a===x&&(M=a)}return M}function v({supportedFormats:s}){return C("application/esri3do-SR_world","wld",s)}function S({supportedFormats:s}){return C("application/esri3do-SR_prj","prj",s)}function c(s){return[...d,...s]}function y(s,_){const x=s.toLowerCase();return c(_).find(M=>function h(s){return s?.[2].split(",").map(_=>_.toLowerCase())??[]}(M).some(a=>x.endsWith(a)))}function A(s){return s?.[0]}function P(s){return s?.[1].toLowerCase()}function n(s){return s.tables?.find(_=>"assetMaps"===_.role)}},90543:(z,W,e)=>{e.d(W,{S:()=>i,d:()=>h});var d=e(3248),t=e(68438),U=e(6829);function u(o,n,s){return!!O(o,n,s)}function F(o,n,s){return O(o,n,s)}function O(o,n,s){return o&&o.hasOwnProperty(n)?o[n]:s}const j={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function w(o){const n=o?.supportedSpatialAggregationStatistics?.map(s=>s.toLowerCase());return{envelope:!!n?.includes("envelopeaggregate"),centroid:!!n?.includes("centroidaggregate"),convexHull:!!n?.includes("convexhullaggregate")}}function Z(o,n){return!!o?.supportedOperationsWithCacheHint?.map(_=>_.toLowerCase())?.includes(n.toLowerCase())}function C(o){const n=o?.supportedStatisticTypes?.map(s=>s.toLowerCase());return{count:!!n?.includes("count"),sum:!!n?.includes("sum"),min:!!n?.includes("min"),max:!!n?.includes("max"),avg:!!n?.includes("avg"),var:!!n?.includes("var"),stddev:!!n?.includes("stddev"),percentileContinuous:!!n?.includes("percentile_continuous"),percentileDiscrete:!!n?.includes("percentile_discrete"),envelope:!!n?.includes("envelopeaggregate"),centroid:!!n?.includes("centroidaggregate"),convexHull:!!n?.includes("convexhullaggregate")}}function R(o){const n=o?.supportedNormalizationTypes?.map(s=>s.toLowerCase());return{field:!!n?.includes("field"),log:!!n?.includes("log"),naturalLog:!!n?.includes("naturallog"),percentOfTotal:!!n?.includes("percentoftotal"),squareRoot:!!n?.includes("squareroot")}}function i(o,n){return{analytics:m(o),attachment:I(o),data:v(o),metadata:S(o),operations:c(o.capabilities,o,n),query:f(o,n),queryAttributeBins:A(o),queryRelated:b(o),queryTopFeatures:y(o),editing:P(o)}}function m(o){return{supportsCacheHint:Z(o.advancedQueryCapabilities,"queryAnalytics")}}function I(o){const n=o.attachmentProperties,s={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:Z(o.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:u(o.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:u(o,"supportsAttachmentsResizing",!1)};return n&&Array.isArray(n)&&n.forEach(_=>{const x=j[_.name];x&&(s[x]=!!_.isEnabled)}),s}function v(o){return{isVersioned:u(o,"isDataVersioned",!1),isBranchVersioned:u(o,"isDataBranchVersioned",!1),supportsAttachment:u(o,"hasAttachments",!1),supportsM:u(o,"hasM",!1),supportsZ:u(o,"hasZ",!1)}}function S(o){return{supportsAdvancedFieldProperties:u(o,"supportsFieldDescriptionProperty",!1)}}function c(o,n,s){const _=o?o.toLowerCase().split(",").map($=>$.trim()):[],x=s?(0,t.qg)(s):null,M=_.includes(null!=x&&"MapServer"===x.serverType?"data":"query"),a=_.includes("editing")&&!n.datesInUnknownTimezone;let l=a&&_.includes("create"),g=a&&_.includes("delete"),D=a&&_.includes("update");const T=_.includes("changetracking"),N=n.advancedQueryCapabilities;return a&&!(l||g||D)&&(l=g=D=!0),{supportsCalculate:u(n,"supportsCalculate",!1),supportsTruncate:u(n,"supportsTruncate",!1),supportsValidateSql:u(n,"supportsValidateSql",!1),supportsAdd:l,supportsDelete:g,supportsEditing:a,supportsChangeTracking:T,supportsQuery:M,supportsQueryAnalytics:u(N,"supportsQueryAnalytic",!1),supportsQueryAttachments:u(N,"supportsQueryAttachments",!1),supportsQueryBins:u(N,"supportsQueryBins",!1),supportsQueryTopFeatures:u(N,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:u(n,"supportsAttachmentsResizing",!1),supportsSync:_.includes("sync"),supportsUpdate:D,supportsExceedsLimitStatistics:u(n,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:u(n,"supportsAsyncConvert3D",!1)}}function f(o,n){const s=o.advancedQueryCapabilities,_=o.ownershipBasedAccessControlForFeatures,x=o.archivingInfo,M=o.currentVersion,a=n?.includes("MapServer"),l=!a||M>=(0,d.A)("mapserver-pbf-version-support"),g=(0,t.Wo)(n),D=new Set((o.supportedQueryFormats??"").split(",").map(T=>T.toLowerCase().trim()));return{maxRecordCount:F(o,"maxRecordCount",void 0),maxRecordCountFactor:F(o,"maxRecordCountFactor",void 0),standardMaxRecordCount:F(o,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:w(s),supportsCacheHint:u(s,"supportsQueryWithCacheHint",!1)||Z(s,"query"),supportsCentroid:u(s,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:g,supportsCurrentUser:u(s,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:u(s,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:u(s,"supportsDisjointSpatialRel",!1),supportsDistance:u(s,"supportsQueryWithDistance",!1),supportsDistinct:u(s,"supportsDistinct",o.supportsAdvancedQueries),supportsExtent:u(s,"supportsReturningQueryExtent",!1),supportsFormatPBF:l&&D.has("pbf"),supportsFullTextSearch:u(s,"supportsFullTextSearch",!1),supportsGeometryProperties:u(s,"supportsReturningGeometryProperties",!1),supportsHavingClause:u(s,"supportsHavingClause",!1),supportsHistoricMoment:u(x,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:u(s,"supportsMaxRecordCountFactor",!1),supportsOrderBy:u(s,"supportsOrderBy",o.supportsAdvancedQueries),supportsPagination:u(s,"supportsPagination",!1),supportsPercentileStatistics:u(s,"supportsPercentileStatistics",!1),supportsQuantization:u(o,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:u(o,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:u(_,"allowAnonymousToQuery",!0),supportsQueryByOthers:u(_,"allowOthersToQuery",!0),supportsQueryGeometry:u(o,"supportsReturningQueryGeometry",!1),supportsResultType:u(s,"supportsQueryWithResultType",!1),supportsReturnMesh:!!(0,U.Hz)(o.infoFor3D),supportsSpatialAggregationStatistics:u(s,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:u(s,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:u(o,"useStandardizedQueries",!1),supportsStatistics:u(s,"supportsStatistics",o.supportsStatistics),supportsTopFeaturesQuery:u(s,"supportsTopFeaturesQuery",!1),supportsTrueCurve:u(s,"supportsTrueCurve",!1),tileMaxRecordCount:F(o,"tileMaxRecordCount",void 0)}}function b(o){const n=o.advancedQueryCapabilities,s=u(n,"supportsAdvancedQueryRelated",!1);return{supportsPagination:u(n,"supportsQueryRelatedPagination",!1),supportsCount:s,supportsOrderBy:s,supportsCacheHint:Z(n,"queryRelated")}}function y(o){return{supportsCacheHint:Z(o.advancedQueryCapabilities,"queryTopFilter")}}function A(o){const n=o?o.queryBinsCapabilities:void 0;return{supportsDate:u(n,"supportsDateBin",!1),supportsFixedInterval:u(n,"supportsFixedIntervalBin",!1),supportsAutoInterval:u(n,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:u(n,"supportsFixedBoundariesBin",!1),supportsStackBy:u(n,"supportsStackBy",!1),supportsSplitBy:u(n,"supportsSplitBy",!1),supportsSnapToData:u(n,"supportsSnapToData",!1),supportsReturnFullIntervalBin:u(n,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:u(n,"supportsFirstDayOfWeek",!1),supportsNormalization:u(n,"supportsNormalization",!1),supportedStatistics:C(n),supportedNormalizationTypes:R(n)}}function P(o){const n=o.ownershipBasedAccessControlForFeatures,s=o?o.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:u(o,"allowGeometryUpdates",!0),supportsGlobalId:u(o,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:u(o,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:u(o,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:u(o,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:u(o,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:u(n,"allowAnonymousToDelete",!0),supportsDeleteByOthers:u(n,"allowOthersToDelete",!0),supportsUpdateByAnonymous:u(n,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:u(n,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:u(s,"supportsAsyncApplyEdits",!1),zDefault:F(o,"zDefault",void 0)}}function h(o){return{operations:{supportsAppend:u(o,"supportsAppend",!1),supportsCoverageQuery:o?.playbackInfo?.klv["0601"]??!1,supportsExportClip:u(o,"supportsExportClip",!1),supportsExportFrameset:u(o,"supportsExportFrameset",!1),supportsMensuration:u(o,"supportsMensuration",!1),supportsUpdate:u(o,"supportsUpdate",!1)}}}},98789:(z,W,e)=>{e.d(W,{q:()=>t});var d=e(23743);function t(U,u,F){if(!F?.features||!F.hasZ)return;const O=(0,d.N)(F.geometryType,u,U.outSpatialReference);if(null!=O)for(const j of F.features)O(j.geometry)}},93327:(z,W,e)=>{e.d(W,{A:()=>b});var S,d=e(8189),t=e(81098),U=e(49976),u=e(71065),F=e(77806),O=e(85211),Z=(e(3248),e(35150),e(17221)),C=e(76576),R=e(50305),i=e(32034),m=e(61320),I=e(6434),v=e(29141);const c=new U.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let f=S=class extends u.A{constructor(y){super(y),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(y,A){return this.readFeaturesWithClass(y,A,t.A)}writeGeometryType(y,A,P,h){if(y)return void c.write(y,A,P,h);const{features:o}=this;if(o)for(const n of o)if(null!=n?.geometry)return void c.write(n.geometry.type,A,P,h)}readQueryGeometry(y,A){if(!y)return null;const P=!!y.spatialReference,h=(0,m.rS)(y);return h&&!P&&A.spatialReference&&(h.spatialReference=i.A.fromJSON(A.spatialReference)),h}writeSpatialReference(y,A){if(y)return void(A.spatialReference=y.toJSON());const{features:P}=this;if(P)for(const h of P)if(h&&null!=h.geometry&&h.geometry.spatialReference)return void(A.spatialReference=h.geometry.spatialReference.toJSON())}clone(){return new S(this.cloneProperties())}cloneProperties(){return(0,F.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(y){const A=this.write();if(A.features&&Array.isArray(y)&&y.length>0)for(let P=0;P<A.features.length;P++){const h=A.features[P];if(h.geometry){const o=y?.[P];h.geometry=o?.toJSON()||h.geometry}}return A}quantize(y){const{scale:[A,P],translate:[h,o]}=y,_=this.features,x=this._getQuantizationFunction(this.geometryType,M=>Math.round((M-h)/A),M=>Math.round((o-M)/P));for(let M=0,a=_.length;M<a;M++)x?.(_[M].geometry)||(_.splice(M,1),M--,a--);return this.transform=y,this}unquantize(){const{geometryType:y,features:A,transform:P}=this;if(!P)return this;const{translate:[h,o],scale:[n,s]}=P;let M=null,a=null;if(this.hasZ&&null!=P?.scale?.[2]){const{translate:[,,g],scale:[,,D]}=P;M=T=>T*D+g}if(this.hasM&&null!=P?.scale?.[3]){const{translate:[,,,g],scale:[,,,D]}=P;a=T=>null==T?T:T*D+g}const l=this._getHydrationFunction(y,g=>g*n+h,g=>o-g*s,M,a);for(const{geometry:g}of A)null!=g&&l&&l(g);return this.transform=null,this}readFeaturesWithClass(y,A,P){const h=i.A.fromJSON(A.spatialReference),o=[];for(let n=0;n<y.length;n++){const s=y[n],_=P.fromJSON(s),x=s.geometry?.spatialReference;null==_.geometry||x||(_.geometry.spatialReference=h);const M=s.aggregateGeometries,a=_.aggregateGeometries;if(M&&null!=a)for(const l in a){const g=a[l],D=M[l],T=D?.spatialReference;null==g||T||(g.spatialReference=h)}o.push(_)}return o}_quantizePoints(y,A,P){let h,o;const n=[];for(let s=0,_=y.length;s<_;s++){const x=y[s];if(s>0){const M=A(x[0]),a=P(x[1]);M===h&&a===o||(n.push([M-h,a-o]),h=M,o=a)}else h=A(x[0]),o=P(x[1]),n.push([h,o])}return n.length>0?n:null}_getQuantizationFunction(y,A,P){return"point"===y?h=>(h.x=A(h.x),h.y=P(h.y),h):"polyline"===y||"polygon"===y?h=>{const o=(0,m.Bi)(h)?h.rings:h.paths,n=[];for(let s=0,_=o.length;s<_;s++){const M=this._quantizePoints(o[s],A,P);M&&n.push(M)}return n.length>0?((0,m.Bi)(h)?h.rings=n:h.paths=n,h):null}:"multipoint"===y?h=>{const o=this._quantizePoints(h.points,A,P);return o&&o.length>0?(h.points=o,h):null}:"extent"===y?h=>h:null}_getHydrationFunction(y,A,P,h,o){return"point"===y?n=>{n.x=A(n.x),n.y=P(n.y),h&&(n.z=h(n.z))}:"polyline"===y||"polygon"===y?n=>{const s=(0,m.Bi)(n)?n.rings:n.paths;let _,x;for(let M=0,a=s.length;M<a;M++){const l=s[M];for(let g=0,D=l.length;g<D;g++){const T=l[g];g>0?(_+=T[0],x+=T[1]):(_=T[0],x=T[1]),T[0]=A(_),T[1]=P(x)}}if(h&&o)for(let M=0,a=s.length;M<a;M++){const l=s[M];for(let g=0,D=l.length;g<D;g++){const T=l[g];T[2]=h(T[2]),T[3]=o(T[3])}}else if(h)for(let M=0,a=s.length;M<a;M++){const l=s[M];for(let g=0,D=l.length;g<D;g++){const T=l[g];T[2]=h(T[2])}}else if(o)for(let M=0,a=s.length;M<a;M++){const l=s[M];for(let g=0,D=l.length;g<D;g++){const T=l[g];T[2]=o(T[2])}}}:"extent"===y?n=>{n.xmin=A(n.xmin),n.ymin=P(n.ymin),n.xmax=A(n.xmax),n.ymax=P(n.ymax),h&&null!=n.zmax&&null!=n.zmin&&(n.zmax=h(n.zmax),n.zmin=h(n.zmin)),o&&null!=n.mmax&&null!=n.mmin&&(n.mmax=o(n.mmax),n.mmin=o(n.mmin))}:"multipoint"===y?n=>{const s=n.points;let _,x;for(let M=0,a=s.length;M<a;M++){const l=s[M];M>0?(_+=l[0],x+=l[1]):(_=l[0],x=l[1]),l[0]=A(_),l[1]=P(x)}if(h&&o)for(let M=0,a=s.length;M<a;M++){const l=s[M];l[2]=h(l[2]),l[3]=o(l[3])}else if(h)for(let M=0,a=s.length;M<a;M++){const l=s[M];l[2]=h(l[2])}else if(o)for(let M=0,a=s.length;M<a;M++){const l=s[M];l[2]=o(l[2])}}:null}};(0,d._)([(0,O.MZ)({type:String,json:{write:!0}})],f.prototype,"displayFieldName",void 0),(0,d._)([(0,O.MZ)({type:Boolean,json:{write:{overridePolicy:y=>({enabled:y})}}})],f.prototype,"exceededTransferLimit",void 0),(0,d._)([(0,O.MZ)({type:[t.A],json:{write:!0}})],f.prototype,"features",void 0),(0,d._)([(0,Z.w)("features")],f.prototype,"readFeatures",null),(0,d._)([(0,O.MZ)({type:[v.A],json:{write:!0}})],f.prototype,"fields",void 0),(0,d._)([(0,O.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:c.read}}})],f.prototype,"geometryType",void 0),(0,d._)([(0,R.K)("geometryType")],f.prototype,"writeGeometryType",null),(0,d._)([(0,O.MZ)({type:Boolean,json:{write:{overridePolicy:y=>({enabled:y})}}})],f.prototype,"hasM",void 0),(0,d._)([(0,O.MZ)({type:Boolean,json:{write:{overridePolicy:y=>({enabled:y})}}})],f.prototype,"hasZ",void 0),(0,d._)([(0,O.MZ)({types:I.yR,json:{write:!0}})],f.prototype,"queryGeometry",void 0),(0,d._)([(0,Z.w)("queryGeometry")],f.prototype,"readQueryGeometry",null),(0,d._)([(0,O.MZ)({type:i.A,json:{write:!0}})],f.prototype,"spatialReference",void 0),(0,d._)([(0,R.K)("spatialReference")],f.prototype,"writeSpatialReference",null),(0,d._)([(0,O.MZ)({json:{write:!0}})],f.prototype,"transform",void 0),f=S=(0,d._)([(0,C.$)("esri.rest.support.FeatureSet")],f),f.prototype.toJSON.isDefaultToJSON=!0;const b=f},73812:(z,W,e)=>{e.d(W,{$7:()=>o,B:()=>h,Fo:()=>b,M7:()=>_,NN:()=>C,Q5:()=>y,Tq:()=>M,Up:()=>P,XF:()=>s,Ze:()=>v,bK:()=>F,bh:()=>Z,id:()=>S,ky:()=>w,qt:()=>x,tW:()=>n,v9:()=>R,w7:()=>O,wF:()=>u,wS:()=>c,wz:()=>m,x:()=>i,xS:()=>f,ze:()=>j});var d=e(82663),t=e(82575);function U(a){return a?x:M}function u(a,l){return l?.mode?l.mode:U(a).mode}function F(a,l){return l??U(a)}function O(a,l){return u(null==a||(a.hasZ??!1),l)}function j(a,l){return F(null==a||(a.hasZ??!1),l)}function w(a){const l=I(a);return O(a.geometry,l)}function Z(a){const l=I(a),g=O(a.geometry,l),D=null!=l&&"on-the-ground"!==g?_(l):0,T=l?.featureExpressionInfo;return{mode:g,offset:D,featureExpressionInfo:T}}function C(a){return m(Z(a))}function R(a){return m(a)||i(a)}function i(a){return"0"===a?.featureExpressionInfo?.expression}function m(a){if(!a||"on-the-ground"===a.mode)return!1;const l=a?.featureExpressionInfo?a.featureExpressionInfo.expression:null;return!(!l||"0"===l)}function I(a){return a.layer&&"elevationInfo"in a.layer?a.layer.elevationInfo:null}function v(a,l){if(!a?.offset)return 0;const{offset:g,unit:D}=a;if("decimal-degrees"===D)return 0;const T="unknown"!==D&&D?D:"meters",N=(0,d.mq)(l);return N?(0,d.oU)(g,T,N):0}function S(a,l,g){if(!g?.mode)return;const D=a.hasZ?a.z:0,T=v(g,a.spatialReference);switch(g.mode){case"absolute-height":return D-T;case"on-the-ground":return 0;case"relative-to-ground":return D-((l.elevationProvider.getElevation(a.x,a.y,D,a.spatialReference,"ground")??0)+T);case"relative-to-scene":return D-((l.elevationProvider.getElevation(a.x,a.y,D,a.spatialReference,"scene")??0)+T)}}function c(a,l,g,D=null){return b(a,l.x,l.y,l.hasZ?l.z:0,l.spatialReference,g,D)}function f(a,l,g,D,T=null){return b(a,l[0],l[1],l.length>2?l[2]:0,g,D,T)}function b(a,l,g,D,T,N,$=null){if(null==N)return;const G=null!=$?$.mode:"absolute-height";if("on-the-ground"===G)return 0;const{absoluteZ:Y}=y(l,g,D,T,a,N);return function A(a,l,g,D,T,N,$,G){const Y=v($,T);switch(G){case"absolute-height":return a-Y;case"relative-to-ground":return a-((N.elevationProvider.getElevation(l,g,D,T,"ground")??0)+Y);case"relative-to-scene":return a-((N.elevationProvider.getElevation(l,g,D,T,"scene")??0)+Y)}}(Y,l,g,D,T,a,$,G)}function y(a,l,g,D,T,N){const $=v(N,D);switch(N.mode){case"absolute-height":return{absoluteZ:g+$,elevation:0};case"on-the-ground":{const G=T.elevationProvider.getElevation(a,l,0,D,"ground")??0;return{absoluteZ:G,elevation:G}}case"relative-to-ground":{const G=T.elevationProvider.getElevation(a,l,g,D,"ground")??0;return{absoluteZ:g+G+$,elevation:G}}case"relative-to-scene":{const G=T.elevationProvider.getElevation(a,l,g,D,"scene")??0;return{absoluteZ:g+G+$,elevation:G}}}}function P(a,l){if(null==l)return!1;const{mode:g}=l;return null!=g&&("scene"===a&&"relative-to-scene"===g||"ground"===a&&"absolute-height"!==g)}function h(a,l,g){return g&&g.mode!==l?`${a} only support ${l} elevation mode`:null}function o(a,l,g){return g?.mode===l?`${a} do not support ${l} elevation mode`:null}function n(a,l){return null!=l?.featureExpressionInfo&&"0"!==l.featureExpressionInfo.expression?`${a} do not support featureExpressionInfo`:null}function s(a,l){l&&a.warn(".elevationInfo=",l)}function _(a){return(a?.offset??0)*(0,t.Ao)(a?.unit)}const x={mode:"absolute-height",offset:0},M={mode:"on-the-ground",offset:null}},64935:(z,W,e)=>{e.d(W,{D8:()=>F,TO:()=>U,d0:()=>O});var d=e(10467),t=e(86300);function U(j){return u.apply(this,arguments)}function u(){return(u=(0,d.A)(function*(j,w=j.popupTemplate){if(null==w)return[];const Z=yield w.getRequiredFields(j.fieldsIndex),{lastEditInfoEnabled:C}=w,{objectIdField:R,typeIdField:i,globalIdField:m,relationships:I}=j;if(Z.includes("*"))return["*"];const v=C?(0,t.eX)(j):[],S=(0,t.DB)(j.fieldsIndex,[...Z,...v]);return i&&S.push(i),S&&R&&j.fieldsIndex?.has(R)&&!S.includes(R)&&S.push(R),S&&m&&j.fieldsIndex?.has(m)&&!S.includes(m)&&S.push(m),I&&I.forEach(c=>{const{keyField:f}=c;S&&f&&j.fieldsIndex?.has(f)&&!S.includes(f)&&S.push(f)}),S})).apply(this,arguments)}function F(j,w){return j.popupTemplate?j.popupTemplate:null!=w&&w.defaultPopupTemplateEnabled&&null!=j.defaultPopupTemplate?j.defaultPopupTemplate:null}function O(j,w){return null!=F(j,{defaultPopupTemplateEnabled:w})}},71655:(z,W,e)=>{var d,t;e.d(W,{X:()=>d}),(t=d||(d={}))[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"}}]);