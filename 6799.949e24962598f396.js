"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[6799],{31876:(ot,X,h)=>{h.d(X,{F:()=>Y}),h(89952),h(77806);var K=h(97442),k=h(17181);function Y(p,_,g){if(null==p?.timeInfo)return null;const{datesInUnknownTimezone:R=!1,timeOffset:C,useViewTime:$}=p;let G=p.timeExtent;R&&(G=function M(p){if(!p)return p;const{start:_,end:g}=p;return new k.A({start:null!=_?(0,K.S1)(_,_.getTimezoneOffset(),"minutes"):_,end:null!=g?(0,K.S1)(g,g.getTimezoneOffset(),"minutes"):g})}(G));let L=$?_&&G?_.intersection(G):_||G:G;return!L||L.isEmpty||L.isAllTime?L:(C&&(L=L.offset(-C.value,C.unit)),R&&(L=function O(p){if(!p)return p;const{start:_,end:g}=p;return new k.A({start:null!=_?(0,K.S1)(_,-_.getTimezoneOffset(),"minutes"):_,end:null!=g?(0,K.S1)(g,-g.getTimezoneOffset(),"minutes"):g})}(L)),L.equals(g)?g:L)}h(40920),h(96381)},96381:(ot,X,h)=>{h.d(X,{X:()=>Z});const Z=Symbol("WebScene")},89063:(ot,X,h)=>{h.d(X,{A:()=>Xt});var Z=h(10467),y=h(8189),K=h(81098),k=h(98877),H=h(48900),V=h(85211),j=(h(3248),h(35150)),w=(h(40707),h(76576)),U=h(67685),b=h(31610),f=h(12273);function z(u){return"constant"===u.kind?u.value[0]:u.values[u.values.length-1]}function T(u){const a=u.toRgba();return[a[0]/255,a[1]/255,a[2]/255,a[3]]}function O(u){if(!u.hasVisualVariables("size"))return{kind:"constant",value:[(0,U.Lz)(u.trailWidth)]};const a=u.getVisualVariablesForType("size")[0],s=[],c=[];let m;if(a.stops){for(const d of a.stops)s.push(d.value),c.push((0,U.Lz)(d.size));m=a.stops.length}else s.push(a.minDataValue,a.maxDataValue),c.push((0,U.Lz)(a.minSize),(0,U.Lz)(a.maxSize)),m=2;return{kind:"ramp",stops:s,values:c,count:m}}function Y(u){if(!u.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const a=u.getVisualVariablesForType("opacity")[0],s=[],c=[];for(const m of a.stops)s.push(m.value),c.push(m.opacity);return{kind:"ramp",stops:s,values:c,count:a.stops.length}}function p(u,a,s,c){switch(a){case"int":u.setUniform1iv(s,c);break;case"float":u.setUniform1fv(s,c);break;case"vec2":u.setUniform2fv(s,c);break;case"vec3":u.setUniform3fv(s,c);break;case"vec4":u.setUniform4fv(s,c)}}function _(u,a,s,c){"constant"===c.kind?p(u,s,`u_${a}`,c.value):(p(u,"float",`u_${a}_stops`,c.stops),p(u,s,`u_${a}_values`,c.values),u.setUniform1i(`u_${a}_count`,c.count))}function R(u,a){return u===a||null!=u&&null!=a&&u.equals(a)}function C(u,a){if(!function g(u,a){let s=!0;return s=s&&u.collisions===a.collisions,s=s&&u.density===a.density,s=s&&u.interpolate===a.interpolate,s=s&&u.lineCollisionWidth===a.lineCollisionWidth,s=s&&u.lineSpacing===a.lineSpacing,s=s&&u.maxTurnAngle===a.maxTurnAngle,s=s&&u.minSpeedThreshold===a.minSpeedThreshold,s=s&&u.segmentLength===a.segmentLength,s=s&&u.smoothing===a.smoothing,s=s&&u.velocityScale===a.velocityScale,s=s&&u.verticesPerLine===a.verticesPerLine,s}(u.simulationSettings,a.simulationSettings)||!R(u.timeExtent,a.timeExtent))return!1;let s=!0;return s=s&&u.loadImagery===a.loadImagery,s=s&&u.createFlowMesh===a.createFlowMesh,s=s&&u.color.kind===a.color.kind,s=s&&u.opacity.kind===a.opacity.kind,s=s&&u.size.kind===a.size.kind,s}var G=h(56492),L=h(32788),D=h(50915),ut=h(76169),dt=h(4931),E=h(45513),N=h(30454);class tt{constructor(a){this._params=a,this.animated=!1}isCompatible(a){if(!(a instanceof tt&&R(this._params.timeExtent,a._params.timeExtent)))return!1;let s=!0;return s=s&&this._params.loadImagery===a._params.loadImagery,s=s&&this._params.color.kind===a._params.color.kind,s=s&&this._params.opacity.kind===a._params.opacity.kind,s}load(a,s){var c=this;return(0,Z.A)(function*(){const{extent:m,size:d}=a;(0,G.Te)(s);const v=yield c._params.loadImagery(m,d[0],d[1],c._params.timeExtent,s);return new wt(v,{color:c._params.color,opacity:c._params.opacity})})()}render(a,s,c){const{context:m}=a,{program:d}=c;m.setFaceCullingEnabled(!1),m.setBlendingEnabled(!0),m.setBlendFunction(D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA),m.useProgram(d),d.setUniformMatrix3fv("u_dvsMat3",s.dvsMat3),m.bindTexture(c.texture,0),d.setUniform1i("u_texture",0),d.setUniform1f("u_Min",c.min),d.setUniform1f("u_Max",c.max),_(d,"color","vec4",this._params.color),_(d,"opacity","float",this._params.opacity),m.bindVAO(c.vertexArray),m.drawArrays(D.WR.TRIANGLE_STRIP,0,4)}}const et=new Map;et.set("a_position",0),et.set("a_texcoord",1);const vt=new Map([["geometry",[new N._("a_position",2,D.pe.UNSIGNED_SHORT,0,8),new N._("a_texcoord",2,D.pe.UNSIGNED_SHORT,4,8)]]]),xt={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:et};class wt{constructor(a,s){this._flowData=a,this._values=s}attach(a){const{context:s}=a,{width:c,height:m}=this._flowData,d=L.g.createVertex(s,D._U.STATIC_DRAW,new Uint16Array([0,0,0,1,c,0,1,1,0,m,0,0,c,m,1,0])),x=new E.Z(s,et,vt,new Map([["geometry",d]])),S=[];"ramp"===this._values.color.kind&&S.push("vvColor"),"ramp"===this._values.opacity.kind&&S.push("vvOpacity");const Q=a.getProgram(xt,S);let at=1e6,mt=-1e6;for(let W=0;W<m;W++)for(let B=0;B<c;B++)if(0!==this._flowData.mask[W*c+B]){const lt=this._flowData.data[2*(W*c+B)],ct=this._flowData.data[2*(W*c+B)+1],ht=Math.sqrt(lt*lt+ct*ct);at=Math.min(at,ht),mt=Math.max(mt,ht)}const q=new Uint8Array(4*c*m);for(let W=0;W<m;W++)for(let B=0;B<c;B++)if(0!==this._flowData.mask[W*c+B]){const lt=this._flowData.data[2*(W*c+B)],ct=this._flowData.data[2*(W*c+B)+1],ht=(Math.sqrt(lt*lt+ct*ct)-at)/(mt-at);q[4*(W*c+B)]=255*ht,q[4*(W*c+B)+1]=0,q[4*(W*c+B)+2]=0,q[4*(W*c+B)+3]=255}else q[4*(W*c+B)]=0,q[4*(W*c+B)+1]=0,q[4*(W*c+B)+2]=0,q[4*(W*c+B)+3]=0;const rt=new dt.R;rt.internalFormat=D.Ab.RGBA,rt.wrapMode=D.pF.CLAMP_TO_EDGE,rt.flipped=!0,rt.width=c,rt.height=m;const Jt=new ut.g(s,rt,q);this.vertexArray=x,this.program=Q,this.texture=Jt,this.min=at,this.max=mt,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}class pt{constructor(a){this._params=a}get animated(){return this._params.flowSpeed>0}isCompatible(a){return a instanceof pt&&C(this._params,a._params)}load(a,s){var c=this;return(0,Z.A)(function*(){const{extent:m,size:d}=a;(0,G.Te)(s);const v=yield c._params.loadImagery(m,d[0],d[1],c._params.timeExtent,s),{vertexData:x,indexData:S}=yield c._params.createFlowMesh("Particles",c._params.simulationSettings,v,s);return new Dt(x,S,{color:c._params.color,opacity:c._params.opacity,size:c._params.size})})()}render(a,s,c){const{context:m}=a,{program:d}=c;m.setFaceCullingEnabled(!1),m.setBlendingEnabled(!0),m.setBlendFunction(D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA),m.useProgram(d),d.setUniform1f("u_time",s.time),d.setUniform1f("u_trailLength",this._params.trailLength),d.setUniform1f("u_flowSpeed",this._params.flowSpeed),d.setUniform1f("u_featheringSize",this._params.featheringSize),d.setUniform1f("u_featheringOffset",this._params.featheringOffset),d.setUniform1f("u_introFade",this._params.introFade?1:0),d.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),d.setUniform1f("u_decayRate",this._params.decayRate),d.setUniformMatrix3fv("u_dvsMat3",s.dvsMat3),d.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),_(d,"color","vec4",this._params.color),_(d,"opacity","float",this._params.opacity),_(d,"size","float",this._params.size),m.bindVAO(c.vertexArray),m.drawElements(D.WR.TRIANGLES,c.indexCount,D.pe.UNSIGNED_INT,0)}}const st=new Map;st.set("a_xyts0",0),st.set("a_xyts1",1),st.set("a_typeIdDurationSeed",2),st.set("a_extrudeInfo",3);const St=new Map([["geometry",[new N._("a_xyts0",4,D.pe.FLOAT,0,64),new N._("a_xyts1",4,D.pe.FLOAT,16,64),new N._("a_typeIdDurationSeed",4,D.pe.FLOAT,32,64),new N._("a_extrudeInfo",4,D.pe.FLOAT,48,64)]]]),At={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:st};class Dt{constructor(a,s,c){this._vertexData=a,this._indexData=s,this._values=c}attach(a){const{context:s}=a,c=L.g.createVertex(s,D._U.STATIC_DRAW,this._vertexData),m=L.g.createIndex(s,D._U.STATIC_DRAW,this._indexData),v=new E.Z(s,st,St,new Map([["geometry",c]]),m),x=[];"ramp"===this._values.color.kind&&x.push("vvColor"),"ramp"===this._values.opacity.kind&&x.push("vvOpacity"),"ramp"===this._values.size.kind&&x.push("vvSize");const S=a.getProgram(At,x);this.vertexArray=v,this.program=S,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}class ft{constructor(a){this._styles=a}get animated(){return this._styles.reduce((a,s)=>a||s.animated,!1)}isCompatible(a){if(!(a instanceof ft)||this._styles.length!==a._styles.length)return!1;const s=this._styles.length;for(let c=0;c<s;c++)if(!this._styles[c].isCompatible(a._styles[c]))return!1;return!0}load(a,s){var c=this;return(0,Z.A)(function*(){const m=yield Promise.all(c._styles.map(d=>d.load(a,s)));return new Tt(m)})()}render(a,s,c){for(let m=0;m<this._styles.length;m++)this._styles[m].render(a,s,c.resources[m])}}class Tt{constructor(a){this.resources=a}attach(a){for(const s of this.resources)s.attach(a)}detach(){for(const a of this.resources)a.detach()}get ready(){return this.resources.reduce((a,s)=>a&&s.ready,!0)}}class _t{constructor(a){this._params=a}get animated(){return this._params.flowSpeed>0}isCompatible(a){return a instanceof _t&&C(this._params,a._params)}load(a,s){var c=this;return(0,Z.A)(function*(){const{extent:m,size:d}=a;(0,G.Te)(s);const v=yield c._params.loadImagery(m,d[0],d[1],c._params.timeExtent,s),{vertexData:x,indexData:S}=yield c._params.createFlowMesh("Streamlines",c._params.simulationSettings,v,s);return new Pt(x,S,{color:c._params.color,opacity:c._params.opacity,size:c._params.size})})()}render(a,s,c){const{context:m}=a,{program:d}=c;m.setFaceCullingEnabled(!1),m.setBlendingEnabled(!0),m.setBlendFunction(D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA),m.useProgram(d),d.setUniform1f("u_time",s.time),d.setUniform1f("u_trailLength",this._params.trailLength),d.setUniform1f("u_flowSpeed",this._params.flowSpeed),d.setUniform1f("u_featheringSize",this._params.featheringSize),d.setUniform1f("u_featheringOffset",this._params.featheringOffset),d.setUniform1f("u_introFade",this._params.introFade?1:0),d.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),d.setUniform1f("u_decayRate",this._params.decayRate),d.setUniformMatrix3fv("u_dvsMat3",s.dvsMat3),d.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),_(d,"color","vec4",this._params.color),_(d,"opacity","float",this._params.opacity),_(d,"size","float",this._params.size),m.bindVAO(c.vertexArray),m.drawElements(D.WR.TRIANGLES,c.indexCount,D.pe.UNSIGNED_INT,0)}}const it=new Map;it.set("a_positionAndSide",0),it.set("a_timeInfo",1),it.set("a_extrude",2),it.set("a_speed",3);const Mt=new Map([["geometry",[new N._("a_positionAndSide",3,D.pe.FLOAT,0,36),new N._("a_timeInfo",3,D.pe.FLOAT,12,36),new N._("a_extrude",2,D.pe.FLOAT,24,36),new N._("a_speed",1,D.pe.FLOAT,32,36)]]]),Et={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:it};class Pt{constructor(a,s,c){this._vertexData=a,this._indexData=s,this._values=c}attach(a){const{context:s}=a,c=L.g.createVertex(s,D._U.STATIC_DRAW,this._vertexData),m=L.g.createIndex(s,D._U.STATIC_DRAW,this._indexData),v=new E.Z(s,it,Mt,new Map([["geometry",c]]),m),x=[];"ramp"===this._values.color.kind&&x.push("vvColor"),"ramp"===this._values.opacity.kind&&x.push("vvOpacity"),"ramp"===this._values.size.kind&&x.push("vvSize");const S=a.getProgram(Et,x);this.vertexArray=v,this.program=S,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}var gt=h(91551),Ct=h(67448);class Vt extends Ct.A{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:(0,f.vt)(),displayViewMat3:(0,f.vt)()}}dispose(){}prepareState(a){const{context:s}=a;s.setColorMask(!0,!0,!0,!0),s.setStencilFunction(D.MT.EQUAL,0,255)}draw(a,s){const{requestRender:c,allowDelayedRender:m}=a,{displayData:d}=s;if(null==d||("loaded"===d.state.name&&d.attach({context:a.context,getProgram:(x,S)=>a.painter.materialManager.getProgram(x,S)}),"attached"!==d.state.name))return;const v=d.state.resources;!m||v.ready||null==c?(this._visualState.time=a.time/1e3,this._visualState.dvsMat3=s.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=a.state.displayViewMat3,d.flowStyle.render({context:a.context,getProgram:(x,S)=>a.painter.materialManager.getProgram(x,S)},this._visualState,v),d.flowStyle.animated&&null!=c&&c()):c()}}var Lt=h(69473),Nt=h(54382);class Wt extends Nt.A{constructor(){super(...arguments),this.flowStyle=null}doRender(a){super.doRender(a)}prepareRenderPasses(a){const s=a.registerRenderPass({name:"flow",brushes:[Vt],target:()=>this.children,drawPhase:Lt.S5.MAP});return[...super.prepareRenderPasses(a),s]}}var yt=h(69287),Bt=h(28067),jt=h(1749);class kt{constructor(a,s,c,m){this.state={name:"created"},this.flowStyle=a,this.extent=s,this.size=c,this.pixelRatio=m}load(){var a=this;return(0,Z.A)(function*(){const s=new AbortController;a.state={name:"loading",abortController:s};const c={extent:a.extent,size:a.size,pixelRatio:a.pixelRatio},m=yield a.flowStyle.load(c,s.signal);a.state={name:"loaded",resources:m}})()}attach(a){if("loaded"!==this.state.name)return void j.A.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const s=this.state.resources;s.attach(a),this.state={name:"attached",resources:s}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(a){return!!this.flowStyle.isCompatible(a.flowStyle)&&!(!this.extent.equals(a.extent)||this.size[0]!==a.size[0]||this.size[1]!==a.size[1]||this.pixelRatio!==a.pixelRatio||(this.flowStyle=a.flowStyle,0))}}var Gt=h(63888);class Zt extends Gt.q{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(a){this._displayData=a,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(a){const{displayData:s}=this;if(null==s)return;const d=[0,0];a.toScreen(d,[s.extent.xmin,s.extent.ymax]);const v=(s.extent.xmax-s.extent.xmin)/s.size[0]/a.resolution,x=(0,yt.kU)(a.rotation),{displayViewScreenMat3:S}=this.transforms;(0,b.kN)(S,[-1,1,0]),(0,b.hs)(S,S,[2/(a.size[0]*a.pixelRatio),-2/(a.size[1]*a.pixelRatio),1]),(0,b.Tl)(S,S,[d[0],d[1],0]),(0,b.e$)(S,S,x),(0,b.hs)(S,S,[v*a.pixelRatio,v*a.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:(0,f.vt)()}}}let nt=class extends k.A{constructor(u){super(u),this._flowDisplayObject=new Zt,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(u){const{flowStyle:a}=this.flowContainer;if(null==a)return void this._clear();const{extent:s,rotation:c,resolution:m,pixelRatio:d}=u.state,v=function $t(u,a){const s=new jt.A({x:(u.xmax+u.xmin)/2,y:(u.ymax+u.ymin)/2,spatialReference:u.spatialReference}),c=u.xmax-u.xmin,m=u.ymax-u.ymin,d=Math.abs(Math.cos((0,yt.kU)(a))),v=Math.abs(Math.sin((0,yt.kU)(a))),x=d*c+v*m,S=v*c+d*m,Q=new Bt.A({xmin:s.x-x/2,ymin:s.y-S/2,xmax:s.x+x/2,ymax:s.y+S/2,spatialReference:u.spatialReference});return Q.centerAt(s),Q}(s,c);v.expand(1.15);const x=[Math.round((v.xmax-v.xmin)/m),Math.round((v.ymax-v.ymin)/m)],S=new kt(a,v,x,d);if(null!=this._loading){if(this._loading.update(S))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(S)||(S.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},Q=>{(0,G.zf)(Q)||(j.A.getLogger(this).error("A resource failed to load.",Q),this._loading=null)}),this._loading=S)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};(0,y._)([(0,V.MZ)()],nt.prototype,"_loading",void 0),(0,y._)([(0,V.MZ)()],nt.prototype,"flowContainer",void 0),(0,y._)([(0,V.MZ)()],nt.prototype,"updating",null),nt=(0,y._)([(0,w.$)("esri.views.2d.engine.flow.FlowStrategy")],nt);const Ht=nt;let J=class extends k.A{constructor(){var u;super(...arguments),u=this,this._loadImagery=(a,s,c,m,d)=>(0,gt.pH)(this.layer,a,s,c,m,d),this._createFlowMesh=(a,s,c,m)=>this.layer.createFlowMesh({meshType:a,flowData:c,simulationSettings:s},{signal:m}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=(0,Z.A)(function*(){u._updateVisualization()})}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:u}=this,a=()=>{this._loadImagery=(s,c,m,d,v)=>(0,gt.pH)(u,s,c,m,d,v),this._updateVisualization()};this.addHandles("multidimensionalDefinition"in u?(0,H.wB)(()=>u.multidimensionalDefinition,a):[(0,H.wB)(()=>u.mosaicRule,a),(0,H.wB)(()=>u.rasterFunction,a),(0,H.wB)(()=>u.definitionExpression,a)]),this.container=new Wt,this._strategy=new Ht({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(u){u.stationary?this._strategy.update(u):this.layerView.requestUpdate()}hitTest(u){return new K.A({attributes:{},geometry:u.clone(),layer:this.layer})}moveEnd(){}doRefresh(){return(0,Z.A)(function*(){})()}_updateVisualization(){const u=this.layer.renderer;if(null==u||"flow"!==u.type)return;const a=function zt(u,a){const{flowSpeed:s,trailLength:c}=u,m=function P(u){const a=z(O(u)),s=a,m=Math.max(a/2,5),d=Math.round((0,U.Lz)(u.maxPathLength)/m)+1,{density:x}=u;return{smoothing:(0,U.Lz)(u.smoothing),interpolate:!0,velocityScale:"flow-from"===u.flowRepresentation?1:-1,verticesPerLine:d,minSpeedThreshold:.001,segmentLength:m,maxTurnAngle:1,collisions:!0,lineCollisionWidth:s,lineSpacing:10,density:x}}(u);let d=null;const v={opacity:Y(u),size:O(u)};let x=function M(u){if(!u.hasVisualVariables("color"))return{kind:"constant",value:T(u.color)};const a=u.getVisualVariablesForType("color")[0],s=[],c=[];for(const m of a.stops)s.push(m.value),Array.prototype.push.apply(c,T(m.color));return{kind:"ramp",stops:s,values:c,count:a.stops.length}}(u);"none"===u.background?v.color=x:("constant"===x.kind&&(x={kind:"ramp",stops:[0,1],values:[0,0,0,1,x.value[0],x.value[1],x.value[2],x.value[3]],count:2}),d=new tt({loadImagery:a.loadImagery,timeExtent:a.timeExtent,color:x,opacity:{kind:"constant",value:[1]}}),v.color={kind:"constant",value:[.1,.1,.1,1]});const S={loadImagery:a.loadImagery,createFlowMesh:a.createFlowMesh,simulationSettings:m,timeExtent:a.timeExtent,trailLength:c,flowSpeed:s,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:v.color,opacity:v.opacity,size:v.size},Q="butt"===u.trailCap||z(O(u))<=4?new _t(S):new pt(S);return null!=d?new ft([d,Q]):Q}(u,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=a,this.layerView.requestUpdate()}};(0,y._)([(0,V.MZ)()],J.prototype,"_strategy",void 0),(0,y._)([(0,V.MZ)()],J.prototype,"attached",void 0),(0,y._)([(0,V.MZ)()],J.prototype,"container",void 0),(0,y._)([(0,V.MZ)()],J.prototype,"layer",void 0),(0,y._)([(0,V.MZ)()],J.prototype,"layerView",void 0),(0,y._)([(0,V.MZ)()],J.prototype,"type",void 0),(0,y._)([(0,V.MZ)()],J.prototype,"updating",null),(0,y._)([(0,V.MZ)()],J.prototype,"timeExtent",void 0),J=(0,y._)([(0,w.$)("esri.views.2d.engine.flow.FlowView2D")],J);const Xt=J},21941:(ot,X,h)=>{h.d(X,{A:()=>F});var Z=h(67448),y=h(50915);const K=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),k=new Float32Array([0,92/255,230/255,1]),H={beaufort_ft:K,beaufort_m:K,beaufort_km:K,beaufort_mi:K,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:k,single_arrow:k,wind_speed:new Float32Array([0,0,0,1])},V=[0,20];class F extends Z.A{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:A}){A.setBlendingEnabled(!0),A.setBlendFunctionSeparate(y.dn.ONE,y.dn.ONE_MINUS_SRC_ALPHA,y.dn.ONE,y.dn.ONE_MINUS_SRC_ALPHA),A.setColorMask(!0,!0,!0,!0),A.setStencilWriteMask(0),A.setStencilTestEnabled(!0),A.setStencilOp(y.eA.KEEP,y.eA.KEEP,y.eA.REPLACE)}draw(A,w){if(null==w.source||0===w.source.validPixelCount)return;const{context:U,timeline:b}=A;if(b.begin(this.name),U.setStencilFunction(y.MT.EQUAL,w.stencilRef,255),w.updateVectorFieldVAO(A),"scalar"===A.renderPass){const f=w.vaoData.scalar;f&&this._drawScalars(A,w,f.vao,f.elementCount)}else{const f=w.vaoData.magdir;f&&this._drawTriangles(A,w,f.vao,f.elementCount)}b.end(this.name)}_drawTriangles(A,w,U,b){const{context:f,painter:P,requestRender:z,allowDelayedRender:T}=A,{symbolizerParameters:I}=w,O=I.dataRange?["dataRange"]:[];"geographic"===I.rotationType&&O.push("rotationGeographic");const M=P.materialManager.getProgram(this._desc.magdir,O);if(T&&null!=z&&!M.compiled)return void z();f.useProgram(M);const{coordScale:Y,opacity:p,transforms:_}=w;M.setUniform2fv("u_coordScale",Y),M.setUniform1f("u_opacity",p),M.setUniformMatrix3fv("u_dvsMat3",_.displayViewScreenMat3);const{style:g,dataRange:R,rotation:C,symbolPercentRange:$}=I;M.setUniform4fv("u_colors",H[g]),M.setUniform2fv("u_dataRange",R||V),M.setUniform1f("u_rotation",C),M.setUniform2fv("u_symbolPercentRange",$);const G=this._getSymbolSize(A,w);M.setUniform2fv("u_symbolSize",G),f.bindVAO(U),f.drawElements(y.WR.TRIANGLES,b,y.pe.UNSIGNED_INT,0)}_drawScalars(A,w,U,b){const{context:f,painter:P,requestRender:z,allowDelayedRender:T}=A,{symbolizerParameters:I}=w,O=[];"wind_speed"===I.style?O.push("innerCircle"):I.dataRange&&O.push("dataRange"),"geographic"===I.rotationType&&O.push("rotationGeographic");const M=P.materialManager.getProgram(this._desc.scalar,O);if(T&&null!=z&&!M.compiled)return void z();f.useProgram(M);const{coordScale:Y,opacity:p,transforms:_}=w;M.setUniform2fv("u_coordScale",Y),M.setUniform1f("u_opacity",p),M.setUniformMatrix3fv("u_dvsMat3",_.displayViewScreenMat3);const{dataRange:g,symbolPercentRange:R}=I;M.setUniform2fv("u_dataRange",g||V),M.setUniform2fv("u_symbolPercentRange",R);const C=this._getSymbolSize(A,w);M.setUniform2fv("u_symbolSize",C),f.bindVAO(U),f.drawElements(y.WR.TRIANGLES,b,y.pe.UNSIGNED_INT,0)}_getSymbolSize(A,w){const U=w.key?2**(A.displayLevel-w.key.level):w.resolution/A.state.resolution,{symbolTileSize:b}=w.symbolizerParameters;return[b/(Math.round((w.width-w.offset[0])/b)*b)/U,b/(Math.round((w.height-w.offset[1])/b)*b)/U]}}},74856:(ot,X,h)=>{h.d(X,{X:()=>U}),h(3248);var y=h(31610),K=h(12273),k=h(88532),H=h(50444),V=h(63888),F=h(24370),j=h(32788),A=h(50915),w=h(45513);class U extends V.q{constructor(f=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=f}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(f){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(f)&&(this._symbolizerParameters=f,this.invalidateVAO())}get source(){return this._source}set source(f){this._source=f,this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(f){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){const{style:P}=this.symbolizerParameters;switch(P){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const z=(0,H.gf)(this.source,this.symbolizerParameters),T=this._createVectorFieldVAO(f.context,z);this.vaoData={magdir:T}}break;case"simple_scalar":{const z=(0,H.Ud)(this.source,this.symbolizerParameters),T=this._createVectorFieldVAO(f.context,z);this.vaoData={scalar:T}}break;case"wind_speed":{const z=(0,H.gf)(this.source,this.symbolizerParameters),T=this._createVectorFieldVAO(f.context,z),I=(0,H.Ud)(this.source,this.symbolizerParameters),O=this._createVectorFieldVAO(f.context,I);this.vaoData={magdir:T,scalar:O}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:(0,K.vt)()}}setTransform(f){const P=(0,y.D_)(this.transforms.displayViewScreenMat3),[z,T]=f.toScreenNoRotation([0,0],[this.x,this.y]),I=this.resolution/this.pixelRatio/f.resolution,O=I*this.width,M=I*this.height,Y=Math.PI*this.rotation/180;(0,y.Tl)(P,P,(0,k.fA)(z,T)),(0,y.Tl)(P,P,(0,k.fA)(O/2,M/2)),(0,y.e$)(P,P,-Y),(0,y.Tl)(P,P,(0,k.fA)(-O/2,-M/2)),(0,y.Oe)(P,P,(0,k.fA)(O,M)),(0,y.lw)(this.transforms.displayViewScreenMat3,f.displayViewMat3,P)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(f,P){const{vertexData:z,indexData:T}=P,I=j.g.createVertex(f,A._U.STATIC_DRAW,new Float32Array(z)),O=j.g.createIndex(f,A._U.STATIC_DRAW,new Uint32Array(T)),M=(0,F.ES)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:A.pe.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:A.pe.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:A.pe.FLOAT,normalized:!1}]});return{vao:new w.Z(f,M.attributes,M.bufferLayouts,new Map([["geometry",I]]),O),elementCount:T.length}}}},64935:(ot,X,h)=>{h.d(X,{D8:()=>H,TO:()=>K,d0:()=>V});var Z=h(10467),y=h(86300);function K(F){return k.apply(this,arguments)}function k(){return(k=(0,Z.A)(function*(F,j=F.popupTemplate){if(null==j)return[];const A=yield j.getRequiredFields(F.fieldsIndex),{lastEditInfoEnabled:w}=j,{objectIdField:U,typeIdField:b,globalIdField:f,relationships:P}=F;if(A.includes("*"))return["*"];const z=w?(0,y.eX)(F):[],T=(0,y.DB)(F.fieldsIndex,[...A,...z]);return b&&T.push(b),T&&U&&F.fieldsIndex?.has(U)&&!T.includes(U)&&T.push(U),T&&f&&F.fieldsIndex?.has(f)&&!T.includes(f)&&T.push(f),P&&P.forEach(I=>{const{keyField:O}=I;T&&O&&F.fieldsIndex?.has(O)&&!T.includes(O)&&T.push(O)}),T})).apply(this,arguments)}function H(F,j){return F.popupTemplate?F.popupTemplate:null!=j&&j.defaultPopupTemplateEnabled&&null!=F.defaultPopupTemplate?F.defaultPopupTemplate:null}function V(F,j){return null!=H(F,{defaultPopupTemplateEnabled:j})}}}]);