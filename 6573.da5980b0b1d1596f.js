"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[6573,9557],{53781:(te,K,l)=>{l.d(K,{a:()=>j,b:()=>p,c:()=>P,d:()=>V,e:()=>k,f:()=>Q,g:()=>E,h:()=>G,j:()=>X,l:()=>Z,n:()=>M,s:()=>N,t:()=>O});var m=l(85952);function P(a,u){return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a}function N(a,u,v,$,z){return a[0]=u,a[1]=v,a[2]=$,a[3]=z,a}function E(a,u,v){return a[0]=u[0]+v[0],a[1]=u[1]+v[1],a[2]=u[2]+v[2],a[3]=u[3]+v[3],a}function A(a,u,v){return a[0]=u[0]-v[0],a[1]=u[1]-v[1],a[2]=u[2]-v[2],a[3]=u[3]-v[3],a}function g(a,u,v){return a[0]=u[0]*v[0],a[1]=u[1]*v[1],a[2]=u[2]*v[2],a[3]=u[3]*v[3],a}function x(a,u,v){return a[0]=u[0]/v[0],a[1]=u[1]/v[1],a[2]=u[2]/v[2],a[3]=u[3]/v[3],a}function p(a,u,v){return a[0]=u[0]*v,a[1]=u[1]*v,a[2]=u[2]*v,a[3]=u[3]*v,a}function I(a,u){const v=u[0]-a[0],$=u[1]-a[1],z=u[2]-a[2],Y=u[3]-a[3];return Math.sqrt(v*v+$*$+z*z+Y*Y)}function V(a,u){const v=u[0]-a[0],$=u[1]-a[1],z=u[2]-a[2],Y=u[3]-a[3];return v*v+$*$+z*z+Y*Y}function X(a){const u=a[0],v=a[1],$=a[2],z=a[3];return Math.sqrt(u*u+v*v+$*$+z*z)}function Q(a){const u=a[0],v=a[1],$=a[2],z=a[3];return u*u+v*v+$*$+z*z}function M(a,u){const v=u[0],$=u[1],z=u[2],Y=u[3];let J=v*v+$*$+z*z+Y*Y;return J>0&&(J=1/Math.sqrt(J),a[0]=v*J,a[1]=$*J,a[2]=z*J,a[3]=Y*J),a}function G(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]}function Z(a,u,v,$){const z=u[0],Y=u[1],J=u[2],se=u[3];return a[0]=z+$*(v[0]-z),a[1]=Y+$*(v[1]-Y),a[2]=J+$*(v[2]-J),a[3]=se+$*(v[3]-se),a}function O(a,u,v){const $=u[0],z=u[1],Y=u[2],J=u[3];return a[0]=v[0]*$+v[4]*z+v[8]*Y+v[12]*J,a[1]=v[1]*$+v[5]*z+v[9]*Y+v[13]*J,a[2]=v[2]*$+v[6]*z+v[10]*Y+v[14]*J,a[3]=v[3]*$+v[7]*z+v[11]*Y+v[15]*J,a}function j(a,u){return a[0]===u[0]&&a[1]===u[1]&&a[2]===u[2]&&a[3]===u[3]}function k(a,u){const v=a[0],$=a[1],z=a[2],Y=a[3],J=u[0],se=u[1],oe=u[2],ae=u[3],ce=(0,m.FD)();return Math.abs(v-J)<=ce*Math.max(1,Math.abs(v),Math.abs(J))&&Math.abs($-se)<=ce*Math.max(1,Math.abs($),Math.abs(se))&&Math.abs(z-oe)<=ce*Math.max(1,Math.abs(z),Math.abs(oe))&&Math.abs(Y-ae)<=ce*Math.max(1,Math.abs(Y),Math.abs(ae))}Object.freeze(Object.defineProperty({__proto__:null,add:E,ceil:function f(a,u){return a[0]=Math.ceil(u[0]),a[1]=Math.ceil(u[1]),a[2]=Math.ceil(u[2]),a[3]=Math.ceil(u[3]),a},copy:P,copyVec3:function y(a,u){return a[0]=u[0],a[1]=u[1],a[2]=u[2],a},dist:I,distance:I,div:x,divide:x,dot:G,equals:k,exactEquals:j,floor:function _(a,u){return a[0]=Math.floor(u[0]),a[1]=Math.floor(u[1]),a[2]=Math.floor(u[2]),a[3]=Math.floor(u[3]),a},inverse:function R(a,u){return a[0]=1/u[0],a[1]=1/u[1],a[2]=1/u[2],a[3]=1/u[3],a},len:X,length:X,lerp:Z,max:function D(a,u,v){return a[0]=Math.max(u[0],v[0]),a[1]=Math.max(u[1],v[1]),a[2]=Math.max(u[2],v[2]),a[3]=Math.max(u[3],v[3]),a},min:function T(a,u,v){return a[0]=Math.min(u[0],v[0]),a[1]=Math.min(u[1],v[1]),a[2]=Math.min(u[2],v[2]),a[3]=Math.min(u[3],v[3]),a},mul:g,multiply:g,negate:function c(a,u){return a[0]=-u[0],a[1]=-u[1],a[2]=-u[2],a[3]=-u[3],a},normalize:M,random:function S(a,u=1){const v=m.Ov;let $,z,Y,J,se,oe;do{$=2*v()-1,z=2*v()-1,se=$*$+z*z}while(se>=1);do{Y=2*v()-1,J=2*v()-1,oe=Y*Y+J*J}while(oe>=1);const ae=Math.sqrt((1-se)/oe);return a[0]=u*$,a[1]=u*z,a[2]=u*Y*ae,a[3]=u*J*ae,a},round:function d(a,u){return a[0]=Math.round(u[0]),a[1]=Math.round(u[1]),a[2]=Math.round(u[2]),a[3]=Math.round(u[3]),a},scale:p,scaleAndAdd:function w(a,u,v,$){return a[0]=u[0]+v[0]*$,a[1]=u[1]+v[1]*$,a[2]=u[2]+v[2]*$,a[3]=u[3]+v[3]*$,a},set:N,sqrDist:V,sqrLen:Q,squaredDistance:V,squaredLength:Q,str:function F(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},sub:A,subtract:A,transformMat4:O,transformQuat:function U(a,u,v){const $=u[0],z=u[1],Y=u[2],J=v[0],se=v[1],oe=v[2],ae=v[3],ce=ae*$+se*Y-oe*z,Ae=ae*z+oe*$-J*Y,Re=ae*Y+J*z-se*$,_e=-J*$-se*z-oe*Y;return a[0]=ce*ae+_e*-J+Ae*-oe-Re*-se,a[1]=Ae*ae+_e*-se+Re*-J-ce*-oe,a[2]=Re*ae+_e*-oe+ce*-se-Ae*-J,a[3]=u[3],a}},Symbol.toStringTag,{value:"Module"}))},86468:(te,K,l)=>{l.d(K,{T:()=>y,U:()=>P});var m=l(69287);function P(x,f,_=0){const T=(0,m.qE)(x,0,A);for(let D=0;D<4;D++)f[_+D]=Math.floor(256*g(T*N[D]))}function y(x,f=0){let _=0;for(let T=0;T<4;T++)_+=x[f+T]*E[T];return _}const N=[1,256,65536,16777216],E=[1/256,1/65536,1/16777216,1/4294967296],A=y(new Uint8ClampedArray([255,255,255,255]));function g(x){return x-Math.floor(x)}},32954:(te,K,l)=>{function m(){return[1,0,0,0,1,0,0,0,1]}function y(g,x,f,_,T,D,d,p,w){return[g,x,f,_,T,D,d,p,w]}l.d(K,{fA:()=>y,vt:()=>m,zK:()=>E});const E=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:E,clone:function P(g){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8]]},create:m,createView:function N(g,x){return new Float64Array(g,x,9)},fromValues:y},Symbol.toStringTag,{value:"Module"}))},12225:(te,K,l)=>{function m(){return new Float32Array(3)}function P(I){const V=new Float32Array(3);return V[0]=I[0],V[1]=I[1],V[2]=I[2],V}function y(I,V,X){const Q=new Float32Array(3);return Q[0]=I,Q[1]=V,Q[2]=X,Q}function E(){return m()}function A(){return y(1,1,1)}function g(){return y(1,0,0)}function x(){return y(0,1,0)}function f(){return y(0,0,1)}l.d(K,{fA:()=>y,o8:()=>P,vt:()=>m});const _=E(),T=A(),D=g(),d=x(),p=f();Object.freeze(Object.defineProperty({__proto__:null,ONES:T,UNIT_X:D,UNIT_Y:d,UNIT_Z:p,ZEROS:_,clone:P,create:m,createView:function N(I,V){return new Float32Array(I,V,3)},fromValues:y,ones:A,unitX:g,unitY:x,unitZ:f,zeros:E},Symbol.toStringTag,{value:"Module"}))},89141:(te,K,l)=>{function m(){return[0,0,0,0]}function P(c){return[c[0],c[1],c[2],c[3]]}function y(c,R,M,G){return[c,R,M,G]}function N(c,R,M,G){return[c,R,M,G]}function E(c,R=[0,0,0,0]){const M=Math.min(4,c.length);for(let G=0;G<M;++G)R[G]=c[G];return R}function x(){return y(1,1,1,1)}function f(){return y(1,0,0,0)}function _(){return y(0,1,0,0)}function T(){return y(0,0,1,0)}function D(){return y(0,0,0,1)}l.d(K,{CN:()=>N,Un:()=>p,ci:()=>E,fA:()=>y,o8:()=>P,uY:()=>d,vt:()=>m});const d=[0,0,0,0],p=x(),w=f(),I=_(),V=T(),X=D();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:X,UNIT_X:w,UNIT_Y:I,UNIT_Z:V,ZEROS:d,clone:P,create:m,createView:function A(c,R){return new Float64Array(c,R,4)},freeze:N,fromArray:E,fromValues:y,ones:x,unitW:D,unitX:f,unitY:_,unitZ:T,zeros:function g(){return[0,0,0,0]}},Symbol.toStringTag,{value:"Module"}))},11445:(te,K,l)=>{l.d(K,{Qf:()=>x,Qh:()=>E,RS:()=>y,ez:()=>T,i5:()=>D,lM:()=>N,qK:()=>_});var m=l(79139);const y=16;function N(d){if(!d)return 0;let p=_;for(const w in d)d.hasOwnProperty(w)&&(p+=g(d[w],!1));return p}function E(d){if(!d)return 0;if("number"==typeof d[0])return x(d);if(Array.isArray(d))return function A(d){const p=d.length;if(0===p||"number"==typeof d[0])return f(d,8);let w=T;for(let I=0;I<p;I++)w+=g(d[I]);return w}(d);let p=_;for(const w in d)d.hasOwnProperty(w)&&(p+=g(d[w]));return p}function g(d,p=!0){switch(typeof d){case"object":return p?E(d):_;case"string":return function P(d){return 32+d.length}(d);case"number":return y;case"boolean":return 4;default:return 8}}function x(...d){return d.reduce((p,w)=>p+(w?(0,m.iu)(w)?w.byteLength+D:Array.isArray(w)?f(w,y):0:0),0)}function f(d,p){return T+d.length*p}const _=32,T=16,D=145},16590:(te,K,l)=>{l.d(K,{W:()=>A,g:()=>E});var m=l(10467),P=l(25866),y=l(13970),N=l(23234);function E(f,_,T,D){if((0,y.canProjectWithoutEngine)(f.spatialReference,T))return x[0]=f.x,x[1]=f.y,x[2]=f.z??D??0,(0,N.projectBuffer)(x,f.spatialReference,0,_,T,0);const d=(0,y.tryProjectWithZConversion)(f,T);return!!d&&(_[0]=d?.x,_[1]=d?.y,_[2]=d?.z??D??0,!0)}function A(f,_,T,D,d){return g.apply(this,arguments)}function g(){return(g=(0,m.A)(function*(f,_,T,D,d){return yield(0,y.initializeProjection)(f.spatialReference,T,null,d),E(f,_,T,D)})).apply(this,arguments)}const x=(0,P.vt)()},44929:(te,K,l)=>{l.d(K,{F:()=>E}),l(13970);var P=l(32034),y=l(16590);function E(f,_,T,D,d){return!(null==_||null==D||f.length<2)&&(x.x=f[0],x.y=f[1],x.z=f[2],x.spatialReference=_,(0,y.g)(x,T,D,d))}const x=(0,l(8675).T)(0,0,0,P.A.WGS84)},42086:(te,K,l)=>{l.d(K,{N3:()=>E,Om:()=>N});var m=l(11445),P=l(27999),y=l(13682);class N{constructor(x=null,f={},_,T,D=0){this.geometry=x,this.attributes=f,this.centroid=_,this.objectId=T,this.displayId=D}static fromJSON(x){const f=x.geometry?y.A.fromJSON(x.geometry):null,_=x.centroid?y.A.fromJSON(x.centroid):null;return new N(f,x.attributes,_,x.objectId)}weakClone(){const x=new N(this.geometry,this.attributes,this.centroid,this.objectId);return x.displayId=this.displayId,x}clone(){const x=this.geometry?.clone(),f=new N(x,{...this.attributes},this.centroid?.clone(),this.objectId);return f.displayId=this.displayId,f}ensureCentroid(x){return this.centroid??=(0,P.Q)(new y.A,this.geometry,x.hasZ,x.hasM),this.centroid}get usedMemory(){return 128+(0,m.lM)(this.attributes)+(this.geometry?.usedMemory??0)}}function E(g){return!!g.geometry?.coords?.length}},61808:(te,K,l)=>{l.d(K,{A:()=>m});class m{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const y=new m;return y.objectIdFieldName=this.objectIdFieldName,y.globalIdFieldName=this.globalIdFieldName,y.geohashFieldName=this.geohashFieldName,y.geometryProperties=this.geometryProperties,y.geometryType=this.geometryType,y.spatialReference=this.spatialReference,y.hasZ=this.hasZ,y.hasM=this.hasM,y.features=this.features,y.fields=this.fields,y.transform=this.transform,y.exceededTransferLimit=this.exceededTransferLimit,y.uniqueIdField=this.uniqueIdField,y.queryGeometry=this.queryGeometry,y.queryGeometryType=this.queryGeometryType,y}}},13682:(te,K,l)=>{l.d(K,{A:()=>y});var m=l(11445);class y{constructor(E=[],A=[]){this.lengths=E??[],this.coords=A??[]}static fromJSON(E){return new y(E.lengths,E.coords)}static fromRect(E){const[A,g,x,f]=E,_=x-A,T=f-g;return new y([5],[A,g,_,0,0,T,-_,0,0,-T])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((E,A)=>E+A)}get usedMemory(){return 64+(0,m.Qf)(this.lengths,this.coords)}area(){let E=0,A=0;if(!this.lengths.length)return 0;for(let g=0;g<this.lengths.length;g++){const x=this.lengths[g];if(x<3)continue;let f=this.coords[2*A],_=this.coords[2*A+1];for(let T=1;T<x;T+=1){const D=this.coords[2*(T+A)],d=this.coords[2*(T+A)+1];E+=-.5*(D-f)*(d+_),f=D,_=d}A+=x}return E}forEachVertex(E){let A=0;this.lengths.length||E(this.coords[0],this.coords[1]);for(let g=0;g<this.lengths.length;g++){const x=this.lengths[g];for(let f=0;f<x;f++)E(this.coords[2*(f+A)],this.coords[2*(f+A)+1]);A+=x}}deltaDecode(){const E=this.clone(),{coords:A,lengths:g}=E;let x=0;for(const f of g){for(let _=1;_<f;_++)A[2*(x+_)]+=A[2*(x+_)-2],A[2*(x+_)+1]+=A[2*(x+_)-1];x+=f}return E}clone(E){if(0===this.lengths.length)return new y([],[this.coords[0],this.coords[1]]);const A=2*(0===this.lengths.length?1:this.lengths.reduce((x,f)=>x+f)),g=this.coords.slice(0,A);return E?(E.set(g),new y(this.lengths,E)):new y(Array.from(this.lengths),Array.from(g))}}},27999:(te,K,l)=>{function m(f,_){return f?_?4:3:_?3:2}function P(f,_,T,D){if(!_?.lengths.length)return null;f.lengths.length&&(f.lengths.length=0),f.coords.length&&(f.coords.length=0);const d=f.coords,p=[],w=T?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:I,coords:V}=_,X=m(T,D);let Q=0;for(const c of I){const R=y(w,V,Q,c,T,D);R&&p.push(R),Q+=c*X}if(p.sort((c,R)=>{let M=c[2]-R[2];return 0===M&&T&&(M=c[4]-R[4]),M}),p.length){let c=6*p[0][2];d[0]=p[0][0]/c,d[1]=p[0][1]/c,T&&(c=6*p[0][4],d[2]=0!==c?p[0][3]/c:0),(d[0]<w[0]||d[0]>w[1]||d[1]<w[2]||d[1]>w[3]||T&&(d[2]<w[4]||d[2]>w[5]))&&(d.length=0)}if(!d.length){const c=_.lengths[0]?function N(f,_,T,D,d){const p=m(D,d);let w=_,I=_+p,V=0,X=0,Q=0,c=0;for(let R=0,M=T-1;R<M;R++,w+=p,I+=p){const G=f[w],Z=f[w+1],S=f[w+2],O=f[I],U=f[I+1],F=f[I+2],j=D?A(G,Z,S,O,U,F):E(G,Z,O,U);if(j)if(V+=j,D){const k=x(G,Z,S,O,U,F);X+=j*k[0],Q+=j*k[1],c+=j*k[2]}else{const k=g(G,Z,O,U);X+=j*k[0],Q+=j*k[1]}}return V>0?D?[X/V,Q/V,c/V]:[X/V,Q/V]:T>0?D?[f[_],f[_+1],f[_+2]]:[f[_],f[_+1]]:null}(V,0,I[0],T,D):null;if(!c)return null;d[0]=c[0],d[1]=c[1],T&&c.length>2&&(d[2]=c[2])}return f}function y(f,_,T,D,d,p){const w=m(d,p);let I=T,V=T+w,X=0,Q=0,c=0,R=0,M=0;for(let Z=0,S=D-1;Z<S;Z++,I+=w,V+=w){const O=_[I],U=_[I+1],F=_[I+2],j=_[V],k=_[V+1],ne=_[V+2];let ie=O*k-j*U;R+=ie,X+=(O+j)*ie,Q+=(U+k)*ie,d&&(ie=O*ne-j*F,c+=(F+ne)*ie,M+=ie),O<f[0]&&(f[0]=O),O>f[1]&&(f[1]=O),U<f[2]&&(f[2]=U),U>f[3]&&(f[3]=U),d&&(F<f[4]&&(f[4]=F),F>f[5]&&(f[5]=F))}if(R>0&&(R*=-1),M>0&&(M*=-1),!R)return null;const G=[X,Q,.5*R];return d&&(G[3]=c,G[4]=.5*M),G}function E(f,_,T,D){const d=T-f,p=D-_;return Math.sqrt(d*d+p*p)}function A(f,_,T,D,d,p){const w=D-f,I=d-_,V=p-T;return Math.sqrt(w*w+I*I+V*V)}function g(f,_,T,D){return[f+.5*(T-f),_+.5*(D-_)]}function x(f,_,T,D,d,p){return[f+.5*(D-f),_+.5*(d-_),T+.5*(p-T)]}l.d(K,{Q:()=>P})},8675:(te,K,l)=>{function m(y,N,E,A){return{x:y,y:N,z:E,hasZ:null!=E,hasM:!1,spatialReference:A,type:"point"}}function P(y,N,E,A,g){y.x=N,y.y=E,y.z=A,y.hasZ=null!=A,y.spatialReference=g}l.d(K,{J:()=>P,T:()=>m})},48716:(te,K,l)=>{l.d(K,{j:()=>y});var m=l(82663),P=l(47258);const y={unknown:1,inches:(0,m.oU)(1,"meters","inches"),feet:(0,m.oU)(1,"meters","feet"),"us-feet":(0,m.oU)(1,"meters","us-feet"),yards:(0,m.oU)(1,"meters","yards"),miles:(0,m.oU)(1,"meters","miles"),"nautical-miles":(0,m.oU)(1,"meters","nautical-miles"),millimeters:(0,m.oU)(1,"meters","millimeters"),centimeters:(0,m.oU)(1,"meters","centimeters"),decimeters:(0,m.oU)(1,"meters","decimeters"),meters:(0,m.oU)(1,"meters","meters"),kilometers:(0,m.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,m.vl)(1,"meters",P.$O.radius)}},1832:(te,K,l)=>{function m(P){const y={};for(const N in P){if("declaredClass"===N)continue;const E=P[N];if(null!=E&&"function"!=typeof E)if(Array.isArray(E)){y[N]=[];for(let A=0;A<E.length;A++)y[N][A]=m(E[A])}else"object"==typeof E?E.toJSON&&(y[N]=JSON.stringify(E)):y[N]=E}return y}l.d(K,{z:()=>m})},1277:(te,K,l)=>{l.d(K,{IJ:()=>w,Jf:()=>c,Pk:()=>X,eW:()=>d,gW:()=>Q,kS:()=>V});var m=l(10467),P=l(89563),y=l(45272),N=l(61320),E=l(77098),A=l(58701),g=l(1832),x=l(78304),f=l(98789);const _="Layer does not support extent calculation.";function D(S,O){const U=S.geometry,F=S.toJSON();delete F.compactGeometryEnabled,delete F.defaultSpatialReferenceEnabled;const j=F;let k,ne,ie;if(null!=U&&(ne=U.spatialReference,ie=(0,A.YX)(ne),j.geometryType=(0,N.$B)(U),j.geometry=function T(S,O){if(O&&"extent"===S.type)return`${S.xmin},${S.ymin},${S.xmax},${S.ymax}`;if(O&&"point"===S.type)return`${S.x},${S.y}`;const U=S.toJSON();return delete U.spatialReference,JSON.stringify(U)}(U,S.compactGeometryEnabled),j.inSR=ie),F.groupByFieldsForStatistics&&(j.groupByFieldsForStatistics=F.groupByFieldsForStatistics.join(",")),F.objectIds&&(j.objectIds=F.objectIds.join(",")),F.orderByFields&&(j.orderByFields=F.orderByFields.join(",")),!F.outFields||!F.returnDistinctValues&&(O?.returnCountOnly||O?.returnExtentOnly||O?.returnIdsOnly)?delete j.outFields:j.outFields=F.outFields.includes("*")?"*":F.outFields.join(","),F.outSR?(j.outSR=(0,A.YX)(F.outSR),k=S.outSpatialReference):U&&(F.returnGeometry||F.returnCentroid)&&(j.outSR=j.inSR,k=ne),F.returnGeometry&&delete F.returnGeometry,F.outStatistics&&(j.outStatistics=JSON.stringify(F.outStatistics)),F.fullText&&(j.fullText=JSON.stringify(F.fullText)),F.pixelSize&&(j.pixelSize=JSON.stringify(F.pixelSize)),F.quantizationParameters&&(S.defaultSpatialReferenceEnabled&&null!=ne&&null!=S.quantizationParameters?.extent&&ne.equals(S.quantizationParameters.extent.spatialReference)&&delete F.quantizationParameters.extent.spatialReference,j.quantizationParameters=JSON.stringify(F.quantizationParameters)),F.parameterValues&&(j.parameterValues=JSON.stringify(F.parameterValues)),F.rangeValues&&(j.rangeValues=JSON.stringify(F.rangeValues)),F.dynamicDataSource&&(j.layer=JSON.stringify({source:F.dynamicDataSource}),delete F.dynamicDataSource),F.timeExtent){const ue=F.timeExtent,{start:de,end:ye}=ue;null==de&&null==ye||(j.time=de===ye?de:`${de??"null"},${ye??"null"}`),delete F.timeExtent}return S.defaultSpatialReferenceEnabled&&null!=ne&&null!=k&&ne.equals(k)&&(j.defaultSR=j.inSR,delete j.inSR,delete j.outSR),j}function d(S,O,U,F){return p.apply(this,arguments)}function p(){return(p=(0,m.A)(function*(S,O,U,F){const j=null!=O.timeExtent&&O.timeExtent.isEmpty?{data:{features:[]}}:yield M(S,O,"json",F);return(0,f.q)(O,U,j.data),j})).apply(this,arguments)}function w(S,O,U,F){return I.apply(this,arguments)}function I(){return(I=(0,m.A)(function*(S,O,U,F){if(null!=O.timeExtent&&O.timeExtent.isEmpty)return{data:U.createFeatureResult()};const j=yield V(S,O,F),k=j;return k.data=(0,x.m)(j.data,U),k})).apply(this,arguments)}function V(S,O,U){return M(S,O,"pbf",U)}function X(S,O,U){return null!=O.timeExtent&&O.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):M(S,O,"json",U,{returnIdsOnly:!0})}function Q(S,O,U){return null!=O.timeExtent&&O.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):M(S,O,"json",U,{returnIdsOnly:!0,returnCountOnly:!0})}function c(S,O,U){return R.apply(this,arguments)}function R(){return(R=(0,m.A)(function*(S,O,U){if(null!=O.timeExtent&&O.timeExtent.isEmpty)return{data:{count:0,extent:null}};const F=yield M(S,O,"json",U,{returnExtentOnly:!0,returnCountOnly:!0}),j=F.data;if(j.hasOwnProperty("extent"))return F;if(j.features)throw new Error(_);if(j.hasOwnProperty("count"))throw new Error(_);return F})).apply(this,arguments)}function M(S,O,U){return G.apply(this,arguments)}function G(){return(G=(0,m.A)(function*(S,O,U,F={},j={}){const k="string"==typeof S?(0,y.An)(S):S,ne=O.geometry?[O.geometry]:[],ie=yield(0,E.el)(ne,null,{signal:F.signal}),ue=ie?.[0];null!=ue&&((O=O.clone()).geometry=ue);const de=(0,g.z)({...k.query,f:U,...j,...D(O,j)});return(0,P.A)((0,y.fj)(k.path,function Z(S,O){return null!=S.formatOf3DObjects&&!(O.returnCountOnly||O.returnExtentOnly||O.returnIdsOnly)}(O,j)?"query3d":"query"),{...F,responseType:"pbf"===U?"array-buffer":"json",query:{...de,...F.query}})})).apply(this,arguments)}},98789:(te,K,l)=>{l.d(K,{q:()=>P});var m=l(23743);function P(y,N,E){if(!E?.features||!E.hasZ)return;const A=(0,m.N)(E.geometryType,N,y.outSpatialReference);if(null!=A)for(const g of E.features)A(g.geometry)}},66848:(te,K,l)=>{l.r(K),l.d(K,{default:()=>Vt});var m=l(10467),P=l(8189),y=l(42425),N=l(56492),E=l(48900),A=l(85211),g=l(3248),_=(l(35150),l(40707),l(76576)),T=l(28067),D=l(13970),d=l(32034),p=l(47960),w=l(87086),I=l(98877),V=l(89952),X=l(12619),Q=l(54029),c=l(51995);let R=class extends I.A{constructor(s){super(s),this._updatingCount=0,this._tileHandles=new X.A,this._wanted=new X.A}destroy(){for(const s of this._tileHandles.values())s.abort();this._tileHandles.clear(),this._wanted.clear()}get updating(){return this._updatingCount>0}get _boundingRect(){const{extent:s}=this;return null==s?null:(0,c.VY)(s)}get _missingTiles(){const s=new Array,e=this._wanted;for(const t of this._tileHandles.values())e.has(t.id)&&!Z(t)&&s.push(t);return s}onTileTreeChange(s){var e=this;return(0,m.A)(function*(){++e._updatingCount;try{const{added:t,removed:n}=s,i=e._tileHandles,{_boundingRect:o}=e,h=null!=o?t.filter(L=>(0,c.HY)(o,L.extent)):t,b=e._wanted,B=new Array;for(const L of n){const{id:C}=L;if(b.delete(C),t.some(re=>M(re,L)||M(L,re)))continue;const W=i.get(C);null!=W&&B.push(e._removeTile(W))}for(const L of h)b.set(L.id,L),B.push(e._addTile(L));yield Promise.allSettled(B)}finally{--e._updatingCount}})()}_removeTile(s){var e=this;return(0,m.A)(function*(){e._tileHandles.delete(s.id),s.abort(),e._validate();const{tile:t}=s,n=new O(s.untilSettled(),null!=t?e.createRemoveTileCommand(t):null);s.nextEvent=null;const{command:i}=yield n.getCommand();i?.execute()})()}_addTile(s){var e=this;return(0,m.A)(function*(){const{_tileHandles:t}=e,n=t.get(s.id);if(null!=n)return!Z(n)||n.tile.isComplete||(n.tile=n.tile.reset(),n.nextEvent=e._onTileLoad(n)),void(yield n.untilSettled());const i=new G(s);e._tileHandles.set(i.id,i);const o=e.loadTile(s,i.signal);i.nextEvent=o;const h=yield o;if(i.aborted)throw(0,N.NK)();i.tile=h,function S(s){if(!Z(s))throw new Error}(i),i.nextEvent=e._onTileLoad(i),yield i.untilSettled()})()}_onTileLoad(s){var e=this;return(0,m.A)(function*(){const{_wanted:t,_tileHandles:n,_missingTiles:i}=e,o=s.descriptor,h=new Array,b=new Array,B=new Set;for(const C of n.values()){if(C===s)continue;const{descriptor:W,id:re}=C;if(t.has(re)||i.some(({descriptor:q})=>M(q,W)||M(W,q))){if(Z(C)){if(M(o,W)){const q=C.tile;for(const H of q.objectIds())B.add(H)}if(M(W,o)){const H=new Set(s.tile.objectIds()),ee=C.tile,he=ee.exclude(H);C.tile=he;const fe=AbortSignal.any([C.signal,s.signal]),me=C.untilSettled();h.push(new O(me,e.createRemoveTileCommand(ee))),h.push(new O(me,e.createAddTileCommand(he,fe),fe)),b.push(C),e._validateRemoval(he,H)}}}else{C.abort(),n.delete(re);const{tile:q}=C;null!=q&&h.push(new O(C.untilSettled(),e.createRemoveTileCommand(q))),C.nextEvent=null}}B.size>0&&(s.tile=s.tile.exclude(B),e._validateRemoval(s.tile,B)),h.push(new O(s.untilSettled(),e.createAddTileCommand(s.tile,s.signal),s.signal)),b.push(s),e._validate();const L=e._joinCommands(h);for(const C of b)C.nextEvent=L;yield L})()}_joinCommands(s){return(0,m.A)(function*(){const e=(yield Promise.allSettled(s.map(function(){var t=(0,m.A)(function*(n){return n.getCommand()});return function(n){return t.apply(this,arguments)}}()))).map(t=>"fulfilled"!==t.status||t.value.signal?.aborted?null:t.value.command).filter(V.Ru);0!==e.length&&e.reduce((t,n)=>(t.append(n),t)).execute()})()}_validate(){if(!(0,g.A)("feature-pipeline-3d-test-validation"))return;const s=new Array;for(const e of this._tileHandles.values()){if(!Z(e))continue;const{tile:t}=e,i=new Uint32Array(t.featureCount);t.readObjectIds(i),s.push({tile:t,objectIds:new Set(i)})}for(let e=0;e<s.length;++e){const{tile:t,objectIds:n}=s[e];for(let i=e+1;i<s.length;++i){const{tile:o,objectIds:h}=s[i];for(const b of h)if(n.has(b)){const B=M(o.descriptor,t.descriptor),L=M(t.descriptor,o.descriptor);throw new Error(`${t.descriptor.id} and ${o.descriptor.id} both contain ${b}. aInB: ${B}; bInA: ${L}`)}}}}_validateRemoval(s,e){if((0,g.A)("feature-pipeline-3d-test-validation"))for(const t of s.objectIds())if(e.has(t))throw new Error(`Failed to remove ${t} from ${s.descriptor.id}!`)}};function M({lij:[s,e,t]},{lij:[n,i,o]}){const h=n-s;return h>=0&&e===i>>h&&t===o>>h}(0,P._)([(0,A.MZ)()],R.prototype,"updating",null),(0,P._)([(0,A.MZ)({constructOnly:!0})],R.prototype,"loadTile",void 0),(0,P._)([(0,A.MZ)({constructOnly:!0})],R.prototype,"createAddTileCommand",void 0),(0,P._)([(0,A.MZ)({constructOnly:!0})],R.prototype,"createRemoveTileCommand",void 0),(0,P._)([(0,A.MZ)()],R.prototype,"_updatingCount",void 0),(0,P._)([(0,A.MZ)()],R.prototype,"extent",void 0),(0,P._)([(0,A.MZ)()],R.prototype,"_boundingRect",null),(0,P._)([(0,A.MZ)()],R.prototype,"_missingTiles",null),R=(0,P._)([(0,_.$)("esri.views.3d.layers.graphics.pipeline.Tile3DManager")],R);class G{constructor(e){this.descriptor=e,this._controller=new AbortController,this._tile=(0,Q.v)(null),this.nextEvent=null}get id(){return this.descriptor.id}get tile(){return this._tile.value}set tile(e){this._tile.value=e}get signal(){return this._controller.signal}abort(){this._controller.abort()}get aborted(){return this._controller.signal.aborted}untilSettled(){var e=this;return(0,m.A)(function*(){try{yield e.nextEvent}catch(t){(0,N.zf)(t)||console.error(t)}})()}}function Z(s){return null!=s.tile}class O{constructor(e,t,n){this.previousEventSettled=e,this.commandPromise=t,this.signal=n}getCommand(){var e=this;return(0,m.A)(function*(){const{previousEventSettled:t,commandPromise:n,signal:i}=e,[o]=yield Promise.all([n,t]);if(i?.aborted)throw(0,N.NK)();return{command:o,signal:i}})()}}var U=l(11445);class F{constructor(e,t){this.tile=e,this._tileIndices=t}get id(){return this.tile.id}get featureCount(){return this._tileIndices?.length??this.tile.featureCount}get usedMemory(){return U.qK+(this._tileIndices?.byteLength??0)}get extent(){return this.tile.descriptor.extent}readObjectIds(e,t){const{_tileIndices:n,tile:i}=this;return i.readObjectIds(e,n,t)}readCoordinates(e,t){const{_tileIndices:n,tile:i}=this;return i.readCoordinates(e,n,t)}subset(e){const{_tileIndices:t,tile:n}=this;if(null==t)return new F(n,e);const i=new Uint32Array(e.length);for(let o=0;o<i.length;++o)i[o]=t[e[o]];return new F(n,i)}}class j{constructor(){this._tileToFeatureData=new Map}add(e){this._tileToFeatureData.set(e.tile,e)}remove(e){this._tileToFeatureData.delete(e)}get(e){return this._tileToFeatureData.get(e)}}var k=l(3567),ne=l(27999),ie=l(13682);class ue{constructor(e,t){this._index=e,this._view=t}get usedMemory(){return U.qK+U.RS}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new de(this._index,this._view,e)}}class de extends ue{constructor(e,t,n){super(e,t),this._geometryOverride=n}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return(0,ne.Q)(new ie.A,this._geometryOverride,e.hasZ,e.hasM)}}class ye{constructor(){this._tileBounds=new Map,this.events=new y.A,this.featureAdapter=Ee.shared}get usedMemory(){return U.qK+U.qK*this._tileBounds.size}addTile(e){const{featureCount:t}=e;if(0===t)return;const n=new k.w(9,o=>e.getBounds(o)),i=new Array;for(let o=0;o<t;++o)i[o]=o;n.load(i),this._tileBounds.set(e,n),this.events.emit("changed")}removeTile(e){this._tileBounds.delete(e),this.events.emit("changed")}clear(){this._tileBounds.clear(),this.events.emit("changed")}forEach(e){for(const[t,n]of this._tileBounds)n.all(i=>e(new ue(i,t)))}forEachInBounds(e,t){ve.minX=e[0],ve.minY=e[1],ve.maxX=e[2],ve.maxY=e[3];for(const[n,i]of this._tileBounds)i.search(ve,o=>t(new ue(o,n)))}forEachBounds(e,t){for(const n of e)t(n.getBoundingBox())}getFullExtent(e){let t=1/0,n=1/0,i=-1/0,o=-1/0;for(const h of this._tileBounds.values()){const{minX:b,minY:B,maxX:L,maxY:C}=h.toJSON();t=Math.min(t,b),n=Math.min(n,B),i=Math.min(i,L),o=Math.min(o,C)}return{xmin:t,ymin:n,xmax:i,ymax:o,spatialReference:e}}}class Ee{getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}}Ee.shared=new Ee;const ve=new k.E;var We=l(1277);class a{constructor(e,t,n=function u(s){const e=s.reduce((i,{featureCount:o})=>i+o,0),t=new Array;if(0===e)return t;const n=s[0].featureCount;for(let i=0;i<e;++i)t[2*i]=Math.floor(i/n),t[2*i+1]=i%n;return t}(t)){this.descriptor=e,this._pages=t,this._addressTable=n;const i=U.ez+t.reduce((b,{usedMemory:B})=>b+B,0),o=3*U.RS,h=(0,U.Qf)(n);this.usedMemory=U.qK+i+o+h,this.featureCount=Math.floor(this._addressTable.length/2),this.isComplete=this.featureCount===t.reduce((b,B)=>b+B.featureCount,0)}get id(){return this.descriptor.id}getObjectId(e){const{pageIndex:t,featurePageIndex:n}=this._translateIndex(e);return this._pages[t].getObjectId(n)}getAttribute(e,t){const{pageIndex:n,featurePageIndex:i}=this._translateIndex(e);return this._pages[n].getAttribute(i,t)}getAttributeAsTimestamp(e,t){const{pageIndex:n,featurePageIndex:i}=this._translateIndex(e);return this._pages[n].getAttributeAsTimestamp(i,t)}getAttributes(e){const{pageIndex:t,featurePageIndex:n}=this._translateIndex(e);return this._pages[t].getAttributes(n)}getCoordinates(e,t,n){const{pageIndex:i,featurePageIndex:o}=this._translateIndex(e);this._pages[i].getCoordinates(o,t,n)}getOptimizedGeometry(e){const{pageIndex:t,featurePageIndex:n}=this._translateIndex(e);return this._pages[t].getOptimizedGeometry(n)}getCentroid(e,t){const{pageIndex:n,featurePageIndex:i}=this._translateIndex(e);return this._pages[n].getCentroid(i,t)}getBounds(e){const{pageIndex:t,featurePageIndex:n}=this._translateIndex(e);return this._pages[t].getBounds(n)}getBoundingBox(e){const{pageIndex:t,featurePageIndex:n}=this._translateIndex(e);return this._pages[t].getBoundingBox(n)}readObjectIds(e,t=this._allFeatureIndices(),n=0){let i=n;for(const{page:o,indices:h}of this._batchPageIndices(t))i=o.readObjectIds(e,h,i);return i}readCoordinates(e,t=this._allFeatureIndices(),n=0){let i=n;for(const{page:o,indices:h}of this._batchPageIndices(t))i=o.readCoordinates(e,h,i);return i}*objectIds(e=this._allFeatureIndices()){for(const{page:t,indices:n}of this._batchPageIndices(e))for(const i of t.objectIds(n))yield i}exclude(e){if(0===e.size)return this;const{_addressTable:t,featureCount:n}=this,i=new Array;for(let o=0;o<n;++o){const h=this.getObjectId(o);e.has(h)||(i.push(t[2*o]),i.push(t[2*o+1]))}return new a(this.descriptor,this._pages,i)}reset(){const{isComplete:e,_pages:t}=this;return e?this:new a(this.descriptor,t)}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}_translateIndex(e){const{_addressTable:t}=this;return{pageIndex:t[2*e],featurePageIndex:t[2*e+1]}}*_batchPageIndices(e){const t=new Array;{let i=0,o=new Array;for(const h of e){const{pageIndex:b,featurePageIndex:B}=this._translateIndex(h);i!==b&&(0!==o.length&&t.push({pageIndex:i,indices:o}),i=b,o=[]),o.push(B)}0!==o.length&&t.push({pageIndex:i,indices:o})}const{_pages:n}=this;for(const{pageIndex:i,indices:o}of t)yield{page:n[i],indices:o}}}var v=l(5922),$=l(55912),z=l(25866),Y=l(2296),J=l(721),se=l(73258),oe=l(98455);class ae{constructor(e){this._reader=new $.A(new Uint8Array(e),new DataView(e)),this._index=function ce(s){for(;s.next();){if(2===s.tag())return Ae(s.getMessage());s.skip()}_e()}(this._reader)}get featureCount(){return this._index.featureIndices.length}get exceededTransferLimit(){return this._index.exceededTransferLimit}get usedMemory(){return this._reader.usedMemory}getObjectId(e){return this.getAttribute(e,this._index.objectIdFieldName)}getAttribute(e,t){const{_index:{fieldsIndex:n,attributeIndices:i}}=this,o=n.get(t)?.index;if(null==o)return;const b=this._reader;return b.move(i[e*n.fields.length+o]),Se(b)}getAttributeAsTimestamp(e,t){const n=this.getAttribute(e,t);return"string"==typeof n?new Date(n).getTime():"number"==typeof n||null==n?n:null}getAttributes(e){const{_index:{fieldsIndex:t,attributeIndices:n}}=this,i=e*t.fields.length,o=this._reader,h={};for(const b of t.fields)o.move(n[i+b.index]),h[b.name]=Se(o);return h}getCoordinates(e,t,n=0){const i=this._reader,{transform:o,featureIndices:h}=this._index,{scale:b,translate:B}=o;i.move(h[e]),this._readCoordinates(b,B,t,n)}getOptimizedGeometry(e){const t=(0,z.vt)();return this.getCoordinates(e,t),new ie.A([],t)}getCentroid(e,{hasZ:t,hasM:n}){this.getCoordinates(e,be);const[i,o,h]=be,b=[i,o];return t&&(b[3]=h),n&&(b[t?4:3]=0),new ie.A([],b)}getBounds(e){this.getCoordinates(e,be);const[t,n]=be,i=new k.E;return i.minX=t,i.minY=n,i.maxX=t,i.maxY=n,i}getBoundingBox(e){this.getCoordinates(e,be);const[t,n,i]=be;return(0,Y.fA)(t,n,i,t,n,i)}readObjectIds(e,t=this._allFeatureIndices(),n=0){const i=this._reader,{objectIdFieldName:o,attributeIndices:h,fieldsIndex:b}=this._index,B=b.get(o).index,L=b.fields.length;for(const C of t)i.move(h[C*L+B]),e[n++]=Se(i);return n}readCoordinates(e,t=this._allFeatureIndices(),n=0){const i=this._reader,{transform:o,featureIndices:h}=this._index,{scale:b,translate:B}=o;for(const L of t)i.move(h[L]),n=this._readCoordinates(b,B,e,n);return n}*objectIds(e=this._allFeatureIndices()){const t=this._reader,{objectIdFieldName:n,attributeIndices:i,fieldsIndex:o}=this._index,h=o.get(n).index,b=o.fields.length;for(const B of e)t.move(i[B*b+h]),yield Se(t)}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}_readCoordinates([e,t,n],[i,o,h],b,B){const W=this._reader,re=W.getLength(),q=W.pos()+re;for(;W.pos()<q&&W.next();)switch(W.tag()){case 2:{const H=W.getLength(),ee=W.pos()+H;for(;W.pos()<ee&&W.next();)3===W.tag()?(W.getUInt32(),b[B++]=i+e*W.getSInt64(),b[B++]=o+t*W.getSInt64(),b[B++]=h+n*W.getSInt64()):W.skip();break}default:W.skip()}return B}}function Ae(s){for(;s.next();){if(1===s.tag())return Re(s.getMessage());s.skip()}_e()}function Re(s){let C,W,re=!1,q=!1,H=0;const ee=new Array,he=new Array,fe=new Array;for(;s.next();)switch(s.tag()){case 1:W=s.getString();break;case 7:0!==s.getEnum()&&_e();break;case 9:re=s.getBool()??!1;break;case 12:C=(0,J.Q1)(s.processMessage(oe.ae));break;case 13:{const ge=s.processMessage(oe.cn);ge.index=H++,ee.push(ge);break}case 15:{he.push(s.pos());const ge=s.getUInt32(),we=s.pos()+ge;for(;s.pos()<we&&s.next();)1===s.tag()&&fe.push(s.pos()),s.skip();break}case 10:q=s.getBool()??!1;break;default:s.skip()}const me=new se.A(ee);return null!=C&&q&&null!=W&&me.has(W)||_e(),{transform:C,exceededTransferLimit:re,fieldsIndex:me,objectIdFieldName:W,featureIndices:he,attributeIndices:fe}}function _e(){const s=new v.A("pbf-parsing-failed","Error while parsing PBF",new Error);throw console.error(s),s}function Se(s){const C=s.getLength(),W=s.pos()+C;for(;s.pos()<W&&s.next();)switch(s.tag()){case 1:return s.getString();case 2:return s.getFloat();case 3:return s.getDouble();case 4:return s.getSInt32();case 5:return s.getUInt32();case 6:return s.getInt64();case 7:return s.getUInt64();case 8:return s.getSInt64();case 9:return s.getBool();default:return s.skip(),null}return null}const be=(0,z.vt)();class nt{constructor(e,t,n,i,o){this.spatialReference=e,this.url=n,this.objectIdField=i,this.capabilities=o;const{supportsMaxRecordCountFactor:h,maxRecordCount:b}=this.capabilities.query,B=h?4:1;this._pageSize=Math.min(8e3,(b??8e3)*B);const C=t.clone();C.cacheHint=!0,C.resultType="tile",C.outSpatialReference=e,C.returnGeometry=!0,C.returnZ=!0,C.maxRecordCountFactor=B,C.num=this._pageSize,C.outFields=[i],this._baseQuery=C}fetch(e,t){var n=this;return(0,m.A)(function*(){const{spatialReference:i}=n,o=(0,c.w1)(e.extent,i),h=n._baseQuery.clone();h.geometry=o;const b=new Array;let B=0,L=!1,C=1;for(;!L;){const W=[];for(let q=0;q<C;++q)W.push(n._fetchPage(h,B++,t));const re=yield Promise.all(W);(0,N.Te)(t);for(const q of re){const H=0!==q.featureCount;L||=!q.exceededTransferLimit||!H,H&&b.push(q)}C=Math.min(C+1,4)}return new a(e,b)})()}_fetchPage(e,t,n){var i=this;return(0,m.A)(function*(){const o=e.clone();o.start=t*i._pageSize;const h=(yield(0,We.kS)(i.url,o,{signal:n})).data;return(0,N.Te)(n),new ae(h)})()}}var ze=l(23191),$e=l(83034),st=l(17715),it=l(11432),ot=l(89141),at=l(21128),lt=l(79439),Ce=l(74567),ut=l(85732),dt=l(88577),Ke=l(55128),ct=l(17304);class ht extends ct.gy{constructor(e=(0,z.vt)()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}}let Oe=class extends ut.RW{constructor(s){super(s),this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._vaoCache=null,this._drawParameters=new ht,this._bufferWriter=null}get produces(){return this._produces}get numFeatures(){let e=0;return this._renderGeometries.forEach(t=>e+=t.numElements/6),e}get usedMemory(){let s=0;return this._renderGeometries.forEach(e=>{s+=e.vao.usedMemory}),s}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach((s,e)=>{this._produces.set(e,t=>t!==Ce.V.Highlight&&t!==Ce.V.ShadowHighlight&&s(t))})}destroy(){this._glMaterials.dispose();const s=this._renderGeometries.keys();for(const e of s)this.removeRenderGeometry(e)}acquireTechniques(s){const e=this.material;if(!e.shouldRender(s))return null;const{output:t,bind:n}=s;return e.produces.get(n.slot)?.(t)&&t!==Ce.V.Highlight&&t!==Ce.V.ShadowHighlight?this._glMaterials.load(s.rctx,n.slot,t)?.beginSlot(n):null}render(s,e){const t=this._renderGeometries;if(0===t.size)return;const{bind:n}=s,i=n.slot===Ke.N.OCCLUDER_MATERIAL||n.slot===Ke.N.TRANSPARENT_OCCLUDER_MATERIAL?n.slot:null,o=s.rctx;o.runAppleAmdDriverHelper(),o.bindTechnique(e,n,this.material.parameters);const h=e.program;for(const[b,B]of t)this._drawParameters.origin=B.localOrigin,h.bindDraw(n,this.material.parameters,this._drawParameters),e.ensureAttributeLocations(B.vao),o.bindVAO(B.vao),o.setPipelineState(e.getPipeline(!1,i)),o.drawArrays(e.primitiveType,0,B.numElements)}initializeRenderContext(s,e){this._glMaterials=new dt.c(this.material,s.materials),this._vaoCache=s.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,lt.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}addRenderGeometry(s,e,t){this.removeRenderGeometry(s);const n=this._vaoCache.newVao(e.data.byteLength);n.vertexBuffers.get("geometry").setSubData(new Uint8Array(e.data),0,0,e.data.byteLength);const i={localOrigin:t,vao:n,numElements:e.elementCount};return this._renderGeometries.set(s,i),i}removeRenderGeometry(s){const e=this._renderGeometries.get(s);null!=e&&(this._vaoCache.deleteVao(e.vao),this._renderGeometries.delete(s))}hasHighlightOptions(s){return!1}};(0,P._)([(0,A.MZ)({constructOnly:!0})],Oe.prototype,"material",void 0),Oe=(0,P._)([(0,_.$)("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],Oe);var le=l(40972),ft=l(93758),Pe=l(35404);let Ne=class{constructor(s){this._optionalFields=new Array,this._featureIdToInstanceIndex=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this.layerUid=s.layerUid,this.view=s.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}get numFeatures(){return this._featureIdToInstanceIndex.size}get usedMemory(){return(this._lodRendererResources?.lodRenderer?.symbol?.computeUsedMemory()??0)+16*this._featureIdToInstanceIndex.size}destroy(){this._disposeResourceHandles.forEach(s=>s())}doLoad(s,e,t){var n=this;return(0,m.A)(function*(){(0,g.A)("enable-feature:objectAndLayerId-rendering")&&n._optionalFields.push(le.r.OBJECTANDLAYERIDCOLOR);const i=function mt(s,e){const t=e.levels.map(n=>{const i=n.components.map(o=>{const h=s(o.materialId);if(!function _t(s){return null!=s&&"materialType"in s&&"default"===s.materialType}(h))throw new Error("LodRenderer only supports DefaultMaterial");const b=new Pe.Rn(h,o.renderGeometryBuffer.data,o.renderGeometryBuffer.elementCount,o.boundingInfo);return new Pe.iC(b)});return new Pe.hr(i,n.minScreenSpaceRadius)});return new Pe.Fe(t)}(L=>e(L),s),o=n.view._stage,h=i.getMaterials();o.addMany(h),n._addDisposeResource(()=>o.removeMany(h));const b=i.getTextures();o.addMany(b),n._addDisposeResource(()=>{b.forEach(L=>L.unload()),o.removeMany(b)}),yield Promise.all(b.map(L=>n.view._stage.schedule(()=>L.load(o.renderView.renderingContext),t))),(0,N.Te)(t);const B=yield n._createLodRenderer(i,t);n._lodRendererResources={lodRenderer:B,materials:h,textures:b}})()}addInstances(s){const e=this._lodRendererResources;if(null==e)return;const{featureIds:t,localTransforms:n,globalTransforms:i}=s,o=e.lodRenderer;if(null==o)return;const h=o.instanceData,b=t.length;for(let B=0;B<b;++B){const L=t[B],C=h.addInstance(),W=h.view,re=16*B;W.localTransform.copyFromTypedBuffer(C,n,re),W.globalTransform.copyFromTypedBuffer(C,i,re),h.updateModelTransform(C),h.setVisible(C,!0),this._featureIdToInstanceIndex.set(L,C)}}removeInstances(s){const e=this._lodRendererResources;if(null==e)return;const t=e.lodRenderer.instanceData,n=this._featureIdToInstanceIndex,i=s.length;for(let o=0;o<i;++o){const h=s[o],b=n.get(h);null!=b&&(t.removeInstance(b),n.delete(h))}}_addDisposeResource(s){this._disposeResourceHandles.push(s)}_createLodRenderer(s,e){var t=this;return(0,m.A)(function*(){const n=t.view._stage,o=new ft.L({symbol:s,optionalFields:t._optionalFields,metadata:{layerUid:t.layerUid,graphicUid:h=>1,notifyGraphicGeometryChanged:h=>1,notifyGraphicVisibilityChanged:h=>1},shaderTransformation:null},t.scheduler);return o.slicePlaneEnabled=!1,t._addDisposeResource(()=>{n.removeRenderPlugin(o),o.destroy()}),yield n.addRenderPlugin(o,e),o})()}};Ne=(0,P._)([(0,_.$)("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],Ne);var Ue=l(94302),Ze=l(67496),Ye=l(3781),gt=l(14064),pt=l(30906);let je=class extends I.A{constructor(s){super(),this.view=null,this.layerUid=null,this._renderGeometries=new Map,this._materials=new Map,this._directRenderers=new Map,this._lodRenderers=new Map,this.totalFeatures=0,this.view=s.view,this.layerUid=s.layerUid}initialize(){}destroy(){this.removeAllHandles(),this._lodRenderers.forEach(s=>s.destroy())}executeRenderCommands(s){var e=this;return(0,m.A)(function*(){for(const t of s)switch(t.id){case"create-material":yield e._createMaterial(t);break;case"create-direct-renderer":yield e._createDirectRenderer(t);break;case"add-direct-renderer-geometry":yield e._addDirectRendererGeometry(t),e._updateFeatureCount();break;case"remove-direct-renderer-geometry":yield e._removeDirectRendererGeometry(t),e._updateFeatureCount();break;case"create-lod-renderer":yield e._createLodRenderer(t);break;case"add-lod-instances":yield e._addLodInstances(t),e._updateFeatureCount();break;case"remove-lod-instances":yield e._removeLodInstances(t),e._updateFeatureCount()}})()}_updateFeatureCount(){let s=0;for(const e of this._directRenderers.values())s+=e.numFeatures;for(const e of this._lodRenderers.values())s+=e.numFeatures;this._set("totalFeatures",s)}get usedMemory(){let s=0;for(const e of this._directRenderers.values())s+=e.usedMemory;for(const e of this._lodRenderers.values())s+=e.usedMemory;return s}_createMaterial(s){var e=this;return(0,m.A)(function*(){const{view:t}=e,{sharedSymbolResources:n}=t;if(null==n)throw new Error("No shared symbol resources found!");const{textures:i}=n,o=t.state.viewingMode===ze.RT.Global;let h=null;switch(s.type){case"default":h=function yt(s,e,t){const n={usePBR:e.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:pt.Bt,ambient:z.Un,diffuse:z.Un,hasSlicePlane:e.slicePlaneEnabled,castShadows:e.castShadows,offsetTransparentBackfaces:!e.isPrimitive};return function vt(s){const e=s.opacity??1,t=e<1;s.transparent=t,s.opacity=e,s.cullFace=t?Ze.s2.None:Ze.s2.Back}(n),e.screenSizePerspectiveEnabled&&(n.screenSizePerspective=s.screenSizePerspectiveSettings),n.externalColor=ot.Un,n.isInstanced=!0,new Ye.$U(n,{spherical:t,doublePrecisionRequiresObfuscation:!0})}(n,{physicalBasedRenderingEnabled:!0,slicePlaneEnabled:!1,castShadows:!0,isPrimitive:!0,screenSizePerspectiveEnabled:!0,doublePrecisionRequiresObfuscation:t._stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result},o);break;case"hud":{const[b,B]=He(i,o);e.addHandles([(0,st.hA)(()=>(0,it.Gz)(B))]),h=b}break;default:throw new Error(`unable to create unknown material type ${s.type}`)}e._materials.set(s.materialId,h)})()}_getMaterial(s){return this._materials.get(s)}_createDirectRenderer(s){var e=this;return(0,m.A)(function*(){const t=s.materialId,n=e._getMaterial(t);if(null==n)throw new Error(`material not found ${t}`);const{view:i}=e,o=new Oe({material:n});e._directRenderers.set(t,o),i._stage.addRenderPlugin(o),i._stage.renderView.renderer.updateHasFlags()})()}_addDirectRendererGeometry(s){var e=this;return(0,m.A)(function*(){const t=s.renderGeometryId,n=s.materialId;yield e._removeDirectRendererGeometry({renderGeometryId:t});const i=e._directRenderers.get(n);if(null==i)return void console.error("no renderer assigned to provided material");const o=i.addRenderGeometry(t,s.renderGeometryBuffer,s.localOrigin);e._renderGeometries.set(t,{renderGeometry:o,materialId:n}),e.view._stage.renderView.requestRender()})()}_removeDirectRendererGeometry(s){var e=this;return(0,m.A)(function*(){const n=e._renderGeometries.get(s.renderGeometryId);if(null==n)return;const o=e._directRenderers.get(n.materialId);null!=o?o.removeRenderGeometry(s.renderGeometryId):console.error("no renderer assigned to provided material")})()}_createLodRenderer(s){var e=this;return(0,m.A)(function*(){const t=new Ne({view:e.view,layerUid:e.layerUid}),n=new AbortController;yield t.doLoad(s.lodRenderGeometry,o=>e._getMaterial(o),n.signal),e._lodRenderers.set(s.lodRendererId,t)})()}_addLodInstances(s){var e=this;return(0,m.A)(function*(){const t=e._lodRenderers.get(s.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.addInstances(s.data)})()}_removeLodInstances(s){var e=this;return(0,m.A)(function*(){const t=e._lodRenderers.get(s.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.removeInstances(s.featureIds)})()}};function He(s,e){const t={anchorPosition:at.Zd.center,occlusionTest:!0,hasSlicePlane:!1,color:[1,0,0,1],outlineColor:[0,0,0,1],outlineSize:1,distanceFieldBoundingBox:Ue.PY};if(null!=s){const i=s.fromData("circle-icon",()=>(0,Ue.sZ)("circle"));t.textureId=i.texture.id,t.textureIsSignedDistanceField=!0,t.sampleSignedDistanceFieldTexelCenter=(0,Ue.ny)("circle")}return[new gt.R(t,e),null]}(0,P._)([(0,A.MZ)({readOnly:!0})],je.prototype,"totalFeatures",void 0),je=(0,P._)([(0,_.$)("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],je);var Te=l(92771),Me=l(62789);class Qe{constructor(e){this._bufferWriter=null,this._bufferWriter=e.createBufferWriter()}createBuffer(e,t){const n=this._bufferWriter;let i=null;if(e.transformation&&t)(0,Te.C)(Ie,e.transformation),Ie[12]-=t[0],Ie[13]-=t[1],Ie[14]-=t[2],i=Ie;else{if(t)throw new Error("not implemented");e.transformation&&(i=e.transformation)}let o=null;i&&((0,Te.B8)(Fe,Ie),(0,Te.mg)(Fe,Fe),o=Fe);const h=e.attributes,b=n.elementCount(h);b>Math.floor(xt/(n.vertexBufferLayout.stride/4))&&console.warn("geometry with very large number of elements encountered");const L=n.vertexBufferLayout.createBuffer(b);return n.write(i,o,h,e.objectAndLayerIdColor,L,0),{data:L.buffer,elementCount:b}}}const Ie=(0,Me.vt)(),Fe=(0,Me.vt)(),xt=4194304;var bt=l(88864);class It{constructor(e){this._context=e,this._commands=[],this._transferables=new Set}createMaterial(e){const t=this._context,n=t.generateId("material");switch(e){case"default":{const i=new Ye.$U({},{spherical:this._context.globalViewingMode,doublePrecisionRequiresObfuscation:!0}),o=new Qe(i);t.registerRenderGeometryBufferWriter(n,o)}break;case"hud":{const i=He(null,this._context.globalViewingMode)[0],o=new Qe(i);t.registerRenderGeometryBufferWriter(n,o)}}return this._commands.push({id:"create-material",type:e,materialId:n}),n}createDirectRenderer(e){const t=this._context.generateId("material-renderer");return this._commands.push({id:"create-direct-renderer",materialRendererId:t,materialId:e}),t}addDirectRendererGeometry(e,t,n){const i=t.materialId,o=this._context.getRenderGeometryBufferWriter(i);if(null==o)throw new Error(`no bufferwriter found for material ${i}`);const h=o.createBuffer(t,n);this._transferables.add(h.data),this._commands.push({id:"add-direct-renderer-geometry",renderGeometryId:e,materialId:i,renderGeometryBuffer:h,localOrigin:n})}removeDirectRendererGeometry(e){this._commands.push({id:"remove-direct-renderer-geometry",renderGeometryId:e})}createLodRenderer(e){const t=this._context.generateId("lod-renderer"),n={levels:e.levels.map(i=>({components:i.components.map(o=>{const h=o.attributes.get(le.r.POSITION);if(!h||0===h.indices.length)throw new Error("positions attribute expected");const B=(0,$e.tM)(h.indices.length/3),L=new bt.j(B,3,h),C=this._context.getRenderGeometryBufferWriter(o.materialId);if(null==C)throw new Error("writer not found");const W=C.createBuffer(o,null);return this._transferables.add(W.data),{materialId:o.materialId,renderGeometryBuffer:W,boundingInfo:{bbMax:L.bbMax,bbMin:L.bbMin}}}),minScreenSpaceRadius:i.minScreenSpaceRadius}))};return this._commands.push({id:"create-lod-renderer",lodRendererId:t,lodRenderGeometry:n}),t}addLodInstances(e,t){this._commands.push({id:"add-lod-instances",lodRendererId:e,data:t}),this._transferables.add(t.featureIds.buffer),this._transferables.add(t.globalTransforms.buffer),this._transferables.add(t.localTransforms.buffer)}removeLodInstances(e,t){this._commands.push({id:"remove-lod-instances",lodRendererId:e,featureIds:t}),this._transferables.add(t.buffer)}append(e){if(e._context!==this._context)throw new Error("Cannot append encoders from different contexts");const{_commands:t,_transferables:n}=this;for(const i of e._commands)t.push(i);for(const i of e._transferables)n.add(i)}dispatch(){var e=this;return(0,m.A)(function*(){const t=e._commands,n=Array.from(e._transferables);e._clearCommandBuffer(),yield e._context.dispatchRenderCommands(t,n)})()}_clearCommandBuffer(){this._commands=[],this._transferables.clear()}}class Et{constructor(e){this._idCounter=0,this._bufferWriters=new Map,this._dispatchRenderCommandsCallback=(0,m.A)(function*(){}),this.globalViewingMode=!1,this.globalViewingMode=e.viewingMode===ze.RT.Global,this._dispatchRenderCommandsCallback=e.dispatchRenderCommandsCallback}generateId(e=""){return`${e}${this._idCounter++}`}createEncoder(){return new It(this)}dispatchRenderCommands(e,t){var n=this;return(0,m.A)(function*(){0!==e.length&&(yield n._dispatchRenderCommandsCallback(e,t))})()}registerRenderGeometryBufferWriter(e,t){this._bufferWriters.set(e,t)}getRenderGeometryBufferWriter(e){return this._bufferWriters.get(e)}}class Le{constructor(e,t){this._renderCommands=e,this._pipelineStateCommands=t}append(e){this.appendRenderCommands(e._renderCommands),this.appendPipelineStateCommands(e._pipelineStateCommands)}appendRenderCommands(e){this._renderCommands.append(e)}appendPipelineStateCommand(e){this._pipelineStateCommands.push(e)}appendPipelineStateCommands(e){const{_pipelineStateCommands:t}=this;for(const n of e)t.push(n)}execute(){for(const e of this._pipelineStateCommands)e();this._renderCommands.dispatch()}}var At=l(23234),Rt=l(44929);function Ge(s,e){const{featureCount:t}=s;if(0===t)return new Uint32Array;const n=new Uint32Array(t);return s.readObjectIds(n),n}function Je(s,e){const{featureCount:t}=s;if(0===t)return new Float64Array;const n=new Float64Array(3*t);return s.readCoordinates(n),n}var wt=l(83675),Xe=l(64439),St=l(90673);function ke(s){const e=new Map;for(const[t,n]of s)e.set(t,{...n,indices:(0,$e.Dg)(n.indices)});return e}var Ct=l(86493),Ot=l(36947);function Pt(s,e){switch(s){case"cone":return((n,i,o=!1)=>({levels:n.map(h=>{const b=ke(i(h.tesselation));return o&&function Ft(s){const e=s,t=e.get(le.r.POSITION).data,n=e.get(le.r.NORMAL).data;if(n){const i=qe(s,le.r.NORMAL).data;for(let o=0;o<n.length;o+=3){const h=n[o+1];i[o+1]=-n[o+2],i[o+2]=h}}if(t){const i=qe(s,le.r.POSITION).data;for(let o=0;o<t.length;o+=3){const h=t[o+1];i[o+1]=-t[o+2],i[o+2]=h}}}(b),{components:[{attributes:b,objectAndLayerIdColor:void 0,transformation:null,materialId:e}],minScreenSpaceRadius:h.minScreenSpaceRadius}})}))(Bt,n=>(0,Ot.YG)(1,.5,n,!1),!0);case"sphere":case"cube":case"inverted-cone":case"cylinder":case"tetrahedron":case"diamond":throw new Error("not implemented");default:return}}function qe(s,e){let t=s.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:(0,Ct.S)(t.data)},s.set(e,t)),t}const Bt=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];class Dt{constructor(e){this._context=e,this.lodRendererId=null,this._loaded=!1,this._loadingPromise=null,this._primitive="cone"}get loaded(){return this._loaded}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}_load(){var e=this;return(0,m.A)(function*(){const t=e._context.renderCommandContext.createEncoder(),n=t.createMaterial("default"),i=Pt(e._primitive,n);e.lodRendererId=t.createLodRenderer(i),yield t.dispatch(),e._loaded=!0})()}createAddCommand(e){var t=this;return(0,m.A)(function*(){const n=t._context.renderCommandContext.createEncoder();if(null==t.lodRendererId)throw new Error("expected lod renderer id to not be null");const{featureCount:i}=e;if(0===i)return n;const h=(0,Y.vt)((0,Xe.Fq)(t._primitive)),b=(0,z.ci)((0,Y.Ej)(h)),B=(0,z.ci)((0,Xe.Bb)(b,{isPrimitive:!0,width:100,depth:null,height:null})),L=new Float64Array(16*i),C=new Float64Array(16*i),W=Je(e);for(let H=0;H<i;++H){const ee=H,ge=t._computeGlobalTransform(W[3*H+0],W[3*H+1],W[3*H+2],t._context.viewSpatialReference,Ut),we=t._computeLocalTransform(B,b,Nt);t._writeMatrixToTypedBuffer(L,ee,we),t._writeMatrixToTypedBuffer(C,ee,ge)}const re=Ge(e),q={featureIds:new Uint32Array(re),localTransforms:L,globalTransforms:C};return n.addLodInstances(t.lodRendererId,q),n})()}createRemoveCommand(e){var t=this;return(0,m.A)(function*(){const n=t._context.renderCommandContext.createEncoder();if(null==t.lodRendererId)return n;const i=Ge(e);return n.removeLodInstances(t.lodRendererId,i),n})()}_writeMatrixToTypedBuffer(e,t,n){let i=16*t;for(let o=0;o<16;o++)e[i++]=n[o]}_computeGlobalTransform(e,t,n,i,o){return Be[0]=e,Be[1]=t,Be[2]=n,(0,wt.l)(i,Be,o,this._context.renderSpatialReference),o}_computeLocalTransform(e,t,n){return(0,Te.D_)(n),this._applyObjectScale(e,t,n),n}_applyObjectScale(e,t,n){const i=(0,St.pW)(e,e,t,this._context.renderCoordsHelper.unitInMeters);1===i[0]&&1===i[1]&&1===i[2]||(0,Te.hs)(n,n,i)}}const Be=(0,z.vt)(),Nt=(0,Me.vt)(),Ut=(0,Me.vt)();var xe=l(83346);class jt{constructor(e){this._context=e,this.materialId=null,this._loaded=!1,this._loadingPromise=null}get loaded(){return this._loaded}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}_load(){var e=this;return(0,m.A)(function*(){const t=e._context.renderCommandContext.createEncoder();e.materialId=t.createMaterial("hud"),t.createDirectRenderer(e.materialId),yield t.dispatch(),e._loaded=!0})()}createAddCommand(e){var t=this;return(0,m.A)(function*(){const n=t._context.renderCommandContext.createEncoder();if(null==t.materialId)throw new Error("expected material not to be null");const{featureCount:i,id:o}=e;if(0===i)return n;const h=function Tt(s,e){const{featureCount:t}=s;if(0===t)return new Float64Array;const n=Je(s),i=e.viewSpatialReference,o=e.renderSpatialReference,h=new Float64Array(3*t);if(!(0,At.projectBuffer)(n,i,0,h,o,0,t))throw new Error("Failed to project coordinates");return h}(e,t._context),b=function Mt(s,e){const t=e.viewSpatialReference,n=e.renderSpatialReference,{extent:i}=s,o=(0,c.gX)(i),h=(0,z.vt)();return(0,Rt.F)([o[0],o[1],0],t,h,n),h}(e,t._context),B=new Float64Array([0,0,1]),L=new Float64Array([255,255,255,255]),C=new Float64Array([24,24]),W=new Float64Array([0,0,0,1]),re=new Float64Array([0,0]),q=new Float64Array([0]),H=new Uint32Array(i);for(let pe=0;pe<i;++pe)H[pe]=pe;const ee=new Uint32Array(i);for(let pe=0;pe<i;++pe)ee[pe]=0;const he=new xe.n(h,H,3,!0),fe=new xe.n(B,ee,3,!0),me=new xe.n(re,ee,2,!0),ge=new xe.n(L,ee,4,!0),we=new xe.n(q,ee,1,!0),zt=new xe.n(C,ee,2,!0),$t=new xe.n(W,ee,4,!0),Zt={attributes:ke([[le.r.POSITION,he],[le.r.NORMAL,fe],[le.r.UV0,me],[le.r.COLOR,ge],[le.r.ROTATION,we],[le.r.SIZE,zt],[le.r.CENTEROFFSETANDDISTANCE,$t]]),objectAndLayerIdColor:void 0,transformation:(0,Me.vt)(),materialId:t.materialId};return n.addDirectRendererGeometry(o,Zt,b),n})()}createRemoveCommand(e){var t=this;return(0,m.A)(function*(){const n=t._context.renderCommandContext.createEncoder();return n.removeDirectRendererGeometry(e.id),n})()}}class Lt{constructor(e){this._symbols=new Array,this._featureDataPartitioning=new Map,this._context=e}load(){var e=this;return(0,m.A)(function*(){e._symbols[0]=new jt(e._context),e._symbols[1]=new Dt(e._context)})()}createAddCommand(e){var t=this;return(0,m.A)(function*(){const n=t._partition(e),i=yield Promise.all(n.map(function(){var h=(0,m.A)(function*({index:b,features:B}){return yield(yield t._provisionSymbol(b))?.createAddCommand(B)});return function(b){return h.apply(this,arguments)}}())),o=t._context.renderCommandContext.createEncoder();for(const h of i)null!=h&&o.append(h);return new Le(o,[()=>{t._featureDataPartitioning.set(e,n)}])})()}createRemoveCommand(e){var t=this;return(0,m.A)(function*(){const{_featureDataPartitioning:n}=t,i=n.get(e),o=t._context.renderCommandContext.createEncoder();if(null==i)return new Le(t._context.renderCommandContext.createEncoder(),[]);const h=yield Promise.all(i.map(function(){var b=(0,m.A)(function*({index:B,features:L}){return yield t._getLoadedSymbol(B)?.createRemoveCommand(L)});return function(B){return b.apply(this,arguments)}}()));for(const b of h)null!=b&&o.append(b);return new Le(o,[()=>{n.delete(e)}])})()}_provisionSymbol(e){var t=this;return(0,m.A)(function*(){if(null==e)return null;const n=t._symbols[e];return n?(n.loaded||(yield n.load()),n):null})()}_getLoadedSymbol(e){if(null==e)return null;const t=this._symbols[e];return null!=t&&t.loaded?t:null}_partition(e){const t=Ge(e);if(null==t)throw new Error("unable to fetch objectIds");const{featureCount:n}=e,i=[[],[]];for(let o=0;o<n;++o)i[t[o]%2].push(o);return i.map((o,h)=>new Gt(h,e.subset(new Uint32Array(o)))).filter(o=>o.features.featureCount>0)}}class Gt{constructor(e,t){this.index=e,this.features=t}}var Wt=l(10132);let De=class extends y.A.EventedAccessor{constructor(){super(...arguments),this.remoteClient=null,this._featureDataStore=new j,this._featureStore=new ye,this._tileManager=null,this._renderer=null,this._fetcher=null,this._queryEngine=null,this._defaultQueryJSON=null}get updating(){return this._tileManager.updating}destroy(){this._featureStore.clear(),this._tileManager?.destroy()}setup({viewSpatialReference:s,renderSpatialReference:e,viewingMode:t,baseQuery:n,url:i,objectIdField:o,capabilities:h,fieldsIndex:b,timeInfo:B,fullExtent:L}){var C=this;return(0,m.A)(function*(){const W=d.A.fromJSON(s),re=d.A.fromJSON(e);C._fetcher=new nt(W,w.A.fromJSON(n),i,o,h),C._queryEngine=new p.do({hasZ:!0,hasM:!1,geometryType:"esriGeometryPoint",objectIdField:o,fieldsIndex:b,availableFields:[o],spatialReference:s,featureStore:C._featureStore,timeInfo:B}),C._renderer=new Lt({viewSpatialReference:W,renderSpatialReference:re,renderCoordsHelper:Wt.d.create(t,re),renderCommandContext:new Et({viewingMode:t,dispatchRenderCommandsCallback:(H,ee)=>C.remoteClient.invoke("dispatchRenderCommands",H,{transferList:ee})})}),C._defaultQueryJSON=new w.A({outSpatialReference:W}).toJSON();let q=null;if(null!=L){const H=T.A.fromJSON(L);yield(0,D.initializeProjection)(H.spatialReference,W),q=(0,D.project)(H,W)}return C._tileManager=new R({loadTile:(H,ee)=>C._fetcher.fetch(H,ee),createAddTileCommand:(H,ee)=>C._createAddTileCommand(H,ee),createRemoveTileCommand:H=>C._createRemoveTileCommand(H),extent:q}),C.addHandles((0,E.wB)(()=>C.updating,H=>{C.emit("notify-updating",{updating:H})}),E.Vh),yield C._renderer.load(),et})()}executeQuery(s,e){var t=this;return(0,m.A)(function*(){return{result:yield t._queryEngine.executeQuery(t._ensureQuery(s),e)}})()}executeQueryForIds(s,e){var t=this;return(0,m.A)(function*(){const n=yield t._queryEngine.executeQueryForIdSet(t._ensureQuery(s),e);return{result:Array.from(n)}})()}executeQueryForCount(s,e){var t=this;return(0,m.A)(function*(){return{result:yield t._queryEngine.executeQueryForCount(t._ensureQuery(s),e)}})()}executeQueryForExtent(s,e){var t=this;return(0,m.A)(function*(){return{result:yield t._queryEngine.executeQueryForExtent(t._ensureQuery(s),e)}})()}executeQueryForLatestObservations(s,e){var t=this;return(0,m.A)(function*(){return{result:yield t._queryEngine.executeQueryForLatestObservations(t._ensureQuery(s),e)}})()}onTileTreeChange(s){var e=this;return(0,m.A)(function*(){return yield e._tileManager.onTileTreeChange(s),et})()}_createAddTileCommand(s,e){var t=this;return(0,m.A)(function*(){const n=new F(s),i=yield t._renderer.createAddCommand(n);return(0,N.Te)(e),i.appendPipelineStateCommand(()=>{t._featureDataStore.add(n),t._featureStore.addTile(s)}),i})()}_createRemoveTileCommand(s){var e=this;return(0,m.A)(function*(){const t=e._featureStore,n=e._featureDataStore,i=e._renderer,o=n.get(s);if(null==o)return null;const h=yield i.createRemoveCommand(o);return h.appendPipelineStateCommand(()=>{n.remove(s),t.removeTile(s)}),h})()}_ensureQuery(s){return s??this._defaultQueryJSON}};(0,P._)([(0,A.MZ)()],De.prototype,"updating",null),De=(0,P._)([(0,_.$)("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")],De);const Vt=De,et={result:void 0}},2006:(te,K,l)=>{var m,P;l.d(K,{c:()=>m}),(P=m||(m={}))[P.Bind=0]="Bind",P[P.Pass=1]="Pass",P[P.Draw=2]="Draw"},32788:(te,K,l)=>{l.d(K,{g:()=>_});var m=l(10467),P=l(89952),N=(l(3248),l(35150)),E=l(79139),A=l(77440),g=l(50915);const x=()=>N.A.getLogger("esri.views.webgl.BufferObject");class _{static createIndex(d,p,w){return new _(d,g.NZ.ELEMENT_ARRAY_BUFFER,p,w)}static createVertex(d,p,w){return new _(d,g.NZ.ARRAY_BUFFER,p,w)}static createUniform(d,p,w){return new _(d,g.NZ.UNIFORM_BUFFER,p,w)}static createPixelPack(d,p=g._U.STREAM_READ,w){const I=new _(d,g.NZ.PIXEL_PACK_BUFFER,p);return w&&I.setSize(w),I}static createPixelUnpack(d,p=g._U.STREAM_DRAW,w){return new _(d,g.NZ.PIXEL_UNPACK_BUFFER,p,w)}static createTransformFeedback(d,p=g._U.STATIC_DRAW,w){const I=new _(d,g.NZ.TRANSFORM_FEEDBACK_BUFFER,p);return I.setSize(w),I}constructor(d,p,w,I){this._context=d,this.bufferType=p,this.usage=w,this._glName=null,this._size=-1,this._indexType=void 0,d.instanceCounter.increment(g.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,A.Y2)(this._context.gl),I&&this.setData(I)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===g.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===g.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===g.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===g.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===g.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(g.vt.BufferObject,this),this._context=null):this._glName&&x().warn("Leaked WebGL buffer object")}setSize(d,p=null){if(this.bufferType===g.NZ.ELEMENT_ARRAY_BUFFER&&null!=p)switch(this._indexType=p,p){case g.pe.UNSIGNED_SHORT:d*=2;break;case g.pe.UNSIGNED_INT:d*=4}this._setBufferData(d)}setData(d){if(!d)return;let p=d.byteLength;this.bufferType===g.NZ.ELEMENT_ARRAY_BUFFER&&((0,E.mg)(d)?this._indexType=g.pe.UNSIGNED_BYTE:(0,E.jq)(d)?(p/=2,this._indexType=g.pe.UNSIGNED_SHORT):(0,E.XJ)(d)&&(p/=4,this._indexType=g.pe.UNSIGNED_INT)),this._setBufferData(p,d)}_setBufferData(d,p=null){this._size=d;const w=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const I=this._context.gl;I.bufferData(this.bufferType,null!=p?p:d,this.usage),(0,A.Y2)(I),this._isVAOAware&&this._context.bindVAO(w)}setSubData(d,p,w,I){if(!d)return;const V=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:X}=this._context;X.bufferSubData(this.bufferType,p*d.BYTES_PER_ELEMENT,d,w,I-w),(0,A.Y2)(X),this._isVAOAware&&this._context.bindVAO(V)}getSubData(d,p=0,w,I){if(w<0||I<0)return;const V=function T(D){return(0,P.Xj)(D)}(d)?d.BYTES_PER_ELEMENT:1;if(V*((w??0)+(I??0))>d.byteLength)return;p+V*(I??0)>this.usedMemory&&x().warn("Potential problem getting subdata: requested data exceeds buffer size!");const X=this._context.gl;this.bufferType===g.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,g.NZ.TRANSFORM_FEEDBACK_BUFFER),X.getBufferSubData(g.NZ.TRANSFORM_FEEDBACK_BUFFER,p,d,w,I),this._context.unbindBuffer(g.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,g.NZ.COPY_READ_BUFFER),X.getBufferSubData(g.NZ.COPY_READ_BUFFER,p,d,w,I),this._context.unbindBuffer(g.NZ.COPY_READ_BUFFER))}getSubDataAsync(d,p=0,w,I){var V=this;return(0,m.A)(function*(){yield V._context.clientWaitAsync(),V.getSubData(d,p,w,I)})()}}},43713:(te,K,l)=>{l.d(K,{N5:()=>g});var m=l(5922),y=(l(3248),l(35150)),N=l(2006);const E=()=>y.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class A{constructor(){this._includedModules=new Map}include(c,R){this._includedModules.has(c)?this._includedModules.get(c):(this._includedModules.set(c,R),c(this.builder,R))}}class g extends A{constructor(){super(...arguments),this.vertex=new T,this.fragment=new T,this.attributes=new D,this.varyings=new d,this.extensions=new p,this.outputs=new w}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(c,R=!1){const M=this.extensions.generateSource(c),G=this.attributes.generateSource(c),Z=this.varyings.generateSource(c),S="vertex"===c?this.vertex:this.fragment,O=S.uniforms.generateSource(),U=S.code.generateSource(),F=S.main.generateSource(R),j="vertex"===c?X:V,k=S.constants.generateSource(),ne=this.outputs.generateSource(c);return`#version 300 es\n${M.join("\n")}\n${j}\n${k.join("\n")}\n${O.join("\n")}\n${G.join("\n")}\n${Z.join("\n")}\n${ne.join("\n")}\n${U.join("\n")}\n${F.join("\n")}`}generateBind(c){const R=new Map;this.vertex.uniforms.entries.forEach(Z=>{const S=Z.bind[N.c.Bind];S&&R.set(Z.name,S)}),this.fragment.uniforms.entries.forEach(Z=>{const S=Z.bind[N.c.Bind];S&&R.set(Z.name,S)});const M=Array.from(R.values()),G=M.length;return Z=>{for(let S=0;S<G;++S)M[S](c,Z)}}generateBindPass(c){const R=new Map;this.vertex.uniforms.entries.forEach(Z=>{const S=Z.bind[N.c.Pass];S&&R.set(Z.name,S)}),this.fragment.uniforms.entries.forEach(Z=>{const S=Z.bind[N.c.Pass];S&&R.set(Z.name,S)});const M=Array.from(R.values()),G=M.length;return(Z,S)=>{for(let O=0;O<G;++O)M[O](c,Z,S)}}generateBindDraw(c){const R=new Map;this.vertex.uniforms.entries.forEach(Z=>{const S=Z.bind[N.c.Draw];S&&R.set(Z.name,S)}),this.fragment.uniforms.entries.forEach(Z=>{const S=Z.bind[N.c.Draw];S&&R.set(Z.name,S)});const M=Array.from(R.values()),G=M.length;return(Z,S,O)=>{for(let U=0;U<G;++U)M[U](c,O,Z,S)}}}class x{constructor(c){this._stage=c,this._entries=new Map}add(...c){for(const R of c)this._add(R);return this._stage}get(c){return this._entries.get(c)}_add(c){if(null!=c){if(this._entries.has(c.name)&&!this._entries.get(c.name).equals(c))throw new m.A(`Duplicate uniform name ${c.name} for different uniform type`);this._entries.set(c.name,c)}else E().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map(c=>null!=c.arraySize?`uniform ${c.type} ${c.name}[${c.arraySize}];`:`uniform ${c.type} ${c.name};`)}get entries(){return Array.from(this._entries.values())}}class f{constructor(c){this._stage=c,this._bodies=new Array}add(c){return this._bodies.push(c),this._stage}generateSource(c){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(c)throw new m.A("Shader does not contain main function body.");return[]}}class _{constructor(c){this._stage=c,this._entries=new Array}add(c){return this._entries.push(c),this._stage}generateSource(){return this._entries}}class T extends A{constructor(){super(...arguments),this.uniforms=new x(this),this.main=new f(this),this.code=new _(this),this.constants=new I(this)}get builder(){return this}}class D{constructor(){this._entries=new Array}add(c,R){this._entries.push([c,R])}generateSource(c){return"fragment"===c?[]:this._entries.map(R=>`in ${R[1]} ${R[0]};`)}}class d{constructor(){this._entries=new Map}add(c,R){this._entries.has(c)?E().warn(`Ignoring duplicate varying ${R} ${c}`):this._entries.set(c,R)}generateSource(c){const R=new Array;return this._entries.forEach((M,G)=>R.push("vertex"===c?`out ${M} ${G};`:`in ${M} ${G};`)),R}}class p{constructor(){this._entries=new Set}add(c){this._entries.add(c)}generateSource(c){const R="vertex"===c?p.ALLOWLIST_VERTEX:p.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(M=>R.includes(M)).map(M=>`#extension ${M} : enable`)}}p.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],p.ALLOWLIST_VERTEX=[];class w{constructor(){this._entries=new Map}add(c,R,M=0){const G=this._entries.get(M);G?.name!==c||G?.type!==R?this._entries.set(M,{name:c,type:R}):E().warn(`Fragment shader output location ${M} occupied`)}generateSource(c){if("vertex"===c)return[];0===this._entries.size&&this._entries.set(0,{name:w.DEFAULT_NAME,type:w.DEFAULT_TYPE});const R=new Array;return this._entries.forEach((M,G)=>R.push(`layout(location = ${G}) out ${M.type} ${M.name};`)),R}}w.DEFAULT_TYPE="vec4",w.DEFAULT_NAME="fragColor";class I{constructor(c){this._stage=c,this._entries=new Set}add(c,R,M){let G="ERROR_CONSTRUCTOR_STRING";switch(R){case"float":G=I._numberToFloatStr(M);break;case"int":G=I._numberToIntStr(M);break;case"bool":G=M.toString();break;case"vec2":G=`vec2(${I._numberToFloatStr(M[0])},                            ${I._numberToFloatStr(M[1])})`;break;case"vec3":G=`vec3(${I._numberToFloatStr(M[0])},                            ${I._numberToFloatStr(M[1])},                            ${I._numberToFloatStr(M[2])})`;break;case"vec4":G=`vec4(${I._numberToFloatStr(M[0])},                            ${I._numberToFloatStr(M[1])},                            ${I._numberToFloatStr(M[2])},                            ${I._numberToFloatStr(M[3])})`;break;case"ivec2":G=`ivec2(${I._numberToIntStr(M[0])},                             ${I._numberToIntStr(M[1])})`;break;case"ivec3":G=`ivec3(${I._numberToIntStr(M[0])},                             ${I._numberToIntStr(M[1])},                             ${I._numberToIntStr(M[2])})`;break;case"ivec4":G=`ivec4(${I._numberToIntStr(M[0])},                             ${I._numberToIntStr(M[1])},                             ${I._numberToIntStr(M[2])},                             ${I._numberToIntStr(M[3])})`;break;case"mat2":case"mat3":case"mat4":G=`${R}(${Array.prototype.map.call(M,Z=>I._numberToFloatStr(Z)).join(", ")})`}return this._entries.add(`const ${R} ${c} = ${G};`),this._stage}static _numberToIntStr(c){return c.toFixed(0)}static _numberToFloatStr(c){return Number.isInteger(c)?c.toFixed(1):c.toString()}generateSource(){return Array.from(this._entries)}}const V="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n#endif",X="precision highp float;\nprecision highp sampler2D;"},45513:(te,K,l)=>{l.d(K,{Z:()=>g});var m=l(35150),P=l(11432),y=l(11445),N=l(50915),E=l(84757);const A=()=>m.A.getLogger("esri.views.webgl.VertexArrayObject");let g=class{constructor(x,f,_,T,D=null){this._context=x,this._locations=f,this._layout=_,this._buffers=T,this._indexBuffer=D,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce((x,f)=>x+f.usedMemory,null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(this._buffers.size+(this._indexBuffer?1:0))*y.i5}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach(x=>x.dispose()),this._buffers.clear(),this._indexBuffer=(0,P.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&A().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(N.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:x}=this._context,f=x.createVertexArray();x.bindVertexArray(f),this._bindLayout(),x.bindVertexArray(null),this._glName=f,this._context.instanceCounter.increment(N.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:x,_layout:f,_indexBuffer:_}=this;x||A().error("Vertex buffer dictionary is empty!");const T=this._context.gl;this._buffers.forEach((D,d)=>{const p=f.get(d);p?(0,E.yu)(this._context,this._locations,D,p):A().error("Vertex element descriptor is empty!")}),null!=_&&T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,_.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},30454:(te,K,l)=>{l.d(K,{_:()=>m});class m{constructor(y,N,E,A,g,x=!1,f=0){this.name=y,this.count=N,this.type=E,this.offset=A,this.stride=g,this.normalized=x,this.divisor=f}}}}]);