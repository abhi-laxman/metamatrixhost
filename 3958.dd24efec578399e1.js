"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[3958],{43039:(Ie,R,y)=>{y.d(R,{EG:()=>G,Ll:()=>B,R3:()=>J,UH:()=>k,aM:()=>S,fs:()=>$,i0:()=>Y});var D=y(10467),I=y(48266),L=y(86300),U=y(48218),F=(y(71470),y(20543)),A=y(22639);const k=",",P={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},H=new Set(["integer","small-integer"]);let Z=null;function $(i){return(0,L.vE)(i)||(0,L.zD)(i)||(0,L.Ah)(i)}function G(i){return x.apply(this,arguments)}function x(){return(x=(0,D.A)(function*(i){const{field:l,field2:s,field3:c,normalizationField:T,valueExpression:b}=i;let _=[];if(b){if(!Z){const{arcadeUtils:h}=yield(0,U.lw)();Z=h}_=Z.extractFieldNames(b)}return l&&_.push(l),s&&_.push(s),c&&_.push(c),T&&_.push(T),_})).apply(this,arguments)}function v(i){return String(i).padStart(2,"0")}function j(i,l,s){let c;return"date"===l||"number"===l?("number"===l&&(i=new Date(i)),c=`TIMESTAMP'${s?i.getFullYear():i.getUTCFullYear()}-${v((s?i.getMonth():i.getUTCMonth())+1)}-${v(s?i.getDate():i.getUTCDate())} ${v(s?i.getHours():i.getUTCHours())}:${v(s?i.getMinutes():i.getUTCMinutes())}:${v(s?i.getSeconds():i.getUTCSeconds())}'`):c=i,c}function S(i,l,s,c){const{hasQueryEngine:T}=i,b=`(${j(s,W(i,s),T)} - ${j(l,W(i,l),T)})`;let _=P[c],h="/";return _<1&&(_=1/_,h="*"),{sqlExpression:1===_?b:`(${b} ${h} ${_})`,sqlWhere:null}}function W(i,l){if(l instanceof Date)return"date";if("number"==typeof l)return"number";if("string"==typeof l){const s=i.getField(l);if("<now>"===l.toLowerCase())return;if((0,L.vE)(s))return"field"}}function J(i,l){const s=l&&i.getField(l);return!!s&&H.has(s.type)}function B(i){return`cast(${i} as float)`}function Y(i,l){const{format:s,timeZoneOptions:c,fieldType:T}=l??{};let b,_;if(c&&({timeZone:b,timeZoneName:_}=(0,A.hv)(c.layerTimeZone,c.datesInUnknownTimezone,c.viewTimeZone,(0,I.J2)(s||"short-date-short-time"),T)),"string"==typeof i&&isNaN(Date.parse("time-only"===T?`1970-01-01T${i}Z`:i)))return i;switch(T){case"date-only":{const h=(0,I.J2)(s||"short-date");return"string"==typeof i?(0,I.iS)(i,{...h}):(0,I.Yq)(i,{...h,timeZone:F.n$})}case"time-only":{const h=(0,I.J2)(s||"short-time");return"string"==typeof i?(0,I.F8)(i,h):(0,I.Yq)(i,{...h,timeZone:F.n$})}case"timestamp-offset":{if(!b&&"string"==typeof i&&new Date(i).toISOString()!==i)return i;const h=s||c?(0,I.J2)(s||"short-date-short-time"):void 0,N=h?{...h,timeZone:b,timeZoneName:_}:void 0;return"string"==typeof i?(0,I.Ey)(i,N):(0,I.Yq)(i,N)}default:{const h=s||c?(0,I.J2)(s||"short-date-short-time"):void 0;return(0,I.Yq)("string"==typeof i?new Date(i):i,h?{...h,timeZone:b,timeZoneName:_}:void 0)}}}},93958:(Ie,R,y)=>{y.r(R),y.d(R,{applyTextFormattingHTML:()=>X,createFieldInfoMap:()=>Oe,findRelatedLayer:()=>We,findUtilityNetwork:()=>Ke,fixTokens:()=>se,formatAttributes:()=>xe,formatEditInfo:()=>Ue,formatValueToFieldInfo:()=>de,getAllFieldInfos:()=>Pe,getFieldInfo:()=>ce,getFieldInfoLabel:()=>i,getFixedFieldName:()=>c,getFixedFieldNames:()=>T,getHighlightKeyForFeature:()=>Be,getSourceLayer:()=>W,graphicCallback:()=>le,htmlEntities:()=>Ze,isAssociatedFeatureSupportedLayer:()=>ve,isExpressionField:()=>B,isFeatureSupportedLayer:()=>ue,isGraphicForRelatableFeatureSupportedLayer:()=>De,isRelatableFeatureSupportedLayer:()=>Q,isRelatableLayer:()=>fe,isRelatedField:()=>re,preLayerQueryCallback:()=>$e,preRequestCallback:()=>Se,querySourceLayer:()=>ye,queryUpdatedFeature:()=>Ne,shouldOpenInNewTab:()=>J,substituteAttributes:()=>N,substituteFieldsInLinksAndAttributes:()=>h});var D=y(10467),I=y(3248),L=y(35150),U=y(1119),w=y(48266),F=y(68479),A=y(86300),k=y(58443),O=y(43039),z=y(48218),q=y(22639);const P=()=>L.A.getLogger("esri.widgets.Feature.support.featureUtils"),H=/href=(""|'')/gi,Z=/(\{([^{\r\n]+)\})/g,oe=/'/g,$=/^\s*expression\//i,G=/(\n)/gi,x=/[\u00A0-\u9999<>&]/gim,ae=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,v=/^(?:mailto:|tel:)/,j="relationships/",S=(0,w.J2)("short-date-short-time");function W(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}function le(e){return K.apply(this,arguments)}function K(){return(K=(0,D.A)(function*({type:e,value:t,event:n}){try{return"function"==typeof t?t(n):yield t}catch(r){return void P().error("error",`An error occurred when calling the "${e}" function`,{error:r,graphic:n.graphic,value:t})}})).apply(this,arguments)}function J(e=""){if(e)return!v.test(e.trim().toLowerCase())}function B(e){return!!e&&$.test(e)}function i(e,t){const n=function Y(e,t){if(!t||!B(t)||!e)return;const n=t.replace($,"").toLowerCase();return e.find(({name:r})=>r.toLowerCase()===n)}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function c(e,t){const n=b(t,e);return n?n.name:e}function T(e,t){return e&&e.map(n=>c(n,t))}function b(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function _(e){return`${e}`.trim()}function h({attributes:e,globalAttributes:t,layer:n,text:r,expressionAttributes:a,fieldInfoMap:o}){return r?N({formattedAttributes:t,template:Fe(r,{...t,...a,...e},n),fieldInfoMap:o}):""}function N({formattedAttributes:e,template:t,fieldInfoMap:n}){return _(function s(e){return e.replaceAll(H,"")}((0,U.HC)((0,U.HC)(t,r=>function l(e,t){return`{${t.get(e.toLowerCase())?.fieldName||e}}`}(r,n)),e)))}function se(e,t){return e.replaceAll(Z,(n,r,a)=>{const o=b(t,a);return o?`{${o.name}}`:r})}function Fe(e,t,n){const r=se(e,n);return r&&r.replaceAll(ae,(a,o,f)=>function Te(e,t,n){const r=(t=_(t))&&"{"!==t[0];return(0,U.HC)(e,function Ee(e,t=!1){const n={...e};return Object.keys(n).forEach(r=>function be(e,t,n=!1){const r=t[e];if("string"==typeof r){const a="%27",o=(n?encodeURIComponent(r):r).replaceAll(oe,a);t[e]=o}}(r,n,t)),n}(n,r||!1))}(a,o||f,t))}function ue(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function fe(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function Q(e){return ue(e)&&fe(e)}function ve(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function De(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&Q(e.sourceLayer)}function de(e,t){const{fieldInfos:n,fieldName:r,preventPlacesFormatting:a,layer:o,timeZone:f}=t,m=ce(n,r),p=b(o,r);if(m&&!(0,A.JL)(r)){const g=p?.type,E=m.format?.dateFormat;if("date"===g||"date-only"===g||"time-only"===g||"timestamp-offset"===g||E)return(0,O.i0)(e,{format:E,fieldType:g,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:f,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o)||!o.datesInUnknownTimezone)}})}const d=m?.format;return"string"==typeof e&&(0,A.JL)(r)&&d?function Le(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?V(e,",",", ",t):e.includes(";")?V(e,";","; ",t):e.includes(" ")?V(e," "," ",t):(0,F.ZV)(Number(e),(0,F.yx)(t))}(e,d):"string"==typeof(e=function Me(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const n=Number(e);if(!isNaN(n))return n}return e}(e,d))||null==e||null==d?X(e):(0,F.ZV)(e,a?{...(0,F.yx)(d),minimumFractionDigits:0,maximumFractionDigits:20}:(0,F.yx)(d))}function V(e,t,n,r){return e.trim().split(t).map(a=>(0,F.ZV)(Number(a),(0,F.yx)(r))).join(n)}function ce(e,t){if(e?.length&&t)return e.find(n=>n.fieldName?.toLowerCase()===t.toLowerCase())}function Ue(e,t,n,r){const{creatorField:a,creationDateField:o,editorField:f,editDateField:m}=e;if(!t)return;const p=(0,q.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r)||!r.datesInUnknownTimezone),n,S,"date"),d={...S,...p},g=t[m];if("number"==typeof g){const M=t[f];return{type:"edit",date:(0,w.Yq)(g,d),user:M}}const E=t[o];if("number"==typeof E){const M=t[a];return{type:"create",date:(0,w.Yq)(E,d),user:M}}return null}function Oe(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const a=c(r.fieldName,t);r.fieldName=a,n.set(a.toLowerCase(),r)}return n}function Pe(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)&&r.forEach(a=>{if("fields"===a.type){const o=a?.fieldInfos;o&&t.push(...o)}}),t}function Ze(e){return e.replaceAll(x,t=>`&#${t.charCodeAt(0)};`)}function X(e){return"string"==typeof e?e.replaceAll(G,'<br class="esri-text-new-line" />'):e}function pe(e){const{value:t,fieldName:n,fieldInfos:r,fieldInfoMap:a,layer:o,graphic:f,timeZone:m}=e;if(null==t)return"";const p=function Ce({fieldName:e,value:t,graphic:n,layer:r}){if(re(e)||!r||"function"!=typeof r.getFieldDomain)return null;const a=n&&r.getFieldDomain(e,{feature:n,excludeImpliedDomains:(0,I.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(t):null}({fieldName:n,value:t,graphic:f,layer:o});if(p)return p;const d=function Ae({fieldName:e,graphic:t,layer:n}){if(re(e)||!n||"function"!=typeof n.getFeatureType)return null;const{typeIdField:r}=n;if(!r||e!==r)return null;const a=n.getFeatureType(t);return a?a.name:null}({fieldName:n,graphic:f,layer:o});if(d)return d;if(a.get(n.toLowerCase()))return de(t,{fieldInfos:r||Array.from(a.values()),fieldName:n,layer:o,timeZone:m});const g=o?.fieldsIndex?.get(n);return g&&((0,O.fs)(g)||(0,A.OH)(g))?(0,O.i0)(t,{fieldType:g.type,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:m,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o)||!o.datesInUnknownTimezone)}}):X(t)}function xe({fieldInfos:e,attributes:t,layer:n,graphic:r,fieldInfoMap:a,relatedInfos:o,timeZone:f}){const m={};return o?.forEach(p=>function we({attributes:e,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:a,timeZone:o}){e&&t&&(t.relatedFeatures?.forEach(f=>me({attributes:e,graphic:f,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:a,timeZone:o})),t.relatedStatsFeatures?.forEach(f=>me({attributes:e,graphic:f,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:a,timeZone:o})))}({attributes:m,relatedInfo:p,fieldInfoMap:a,fieldInfos:e,layer:n,timeZone:f})),t&&Object.keys(t).forEach(p=>{m[p]=pe({fieldName:p,fieldInfos:e,fieldInfoMap:a,layer:n,value:t[p],graphic:r,timeZone:f})}),m}function ye(e,t){return ee.apply(this,arguments)}function ee(){return(ee=(0,D.A)(function*(e,t){const{layer:n,graphic:r,outFields:a,objectIds:o,returnGeometry:f,spatialReference:m}=e,p=o[0];if("number"!=typeof p&&"string"!=typeof p){const g="Could not query required fields for the specified feature. The feature's ID is invalid.",E={layer:n,graphic:r,objectId:p,requiredFields:a};return P().warn(g,E),null}if(!(0,k.BR)(n)?.operations?.supportsQuery){const g="The specified layer cannot be queried. The following fields will not be available.",E={layer:n,graphic:r,requiredFields:a,returnGeometry:f};return P().warn(g,E),null}const d=n.createQuery();return d.objectIds=o,d.outFields=a?.length?a:[n.objectIdField],d.returnGeometry=!!f,d.returnZ=!!f,d.returnM=!!f,d.outSpatialReference=m,(yield n.queryFeatures(d,t)).features[0]})).apply(this,arguments)}function te(){return(te=(0,D.A)(function*(e){if(!e.expressionInfos?.length)return!1;const t=yield(0,z.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)})).apply(this,arguments)}function Ne(e,t){return ne.apply(this,arguments)}function ne(){return ne=(0,D.A)(function*({graphic:e,popupTemplate:t,layer:n,spatialReference:r},a){if(!n||!t||("function"==typeof n.load&&(yield n.load(a)),!e.attributes))return;const o=n.objectIdField,f=e.attributes[o];if(null==f)return;const m=[f],p=yield t.getRequiredFields(n.fieldsIndex),d=(0,A.Kl)(p,e),g=d?[]:p.includes(o)?p:[...p,o],E=t.returnGeometry||(yield function je(e){return te.apply(this,arguments)}(t));if(d&&!E)return;const M=yield ye({layer:n,graphic:e,outFields:g,objectIds:m,returnGeometry:E,spatialReference:r},a);M&&(M.geometry&&(e.geometry=M.geometry),M.attributes&&(e.attributes={...e.attributes,...M.attributes}))}),ne.apply(this,arguments)}function re(e=""){return!!e&&e.includes(j)}function me({attributes:e,graphic:t,relatedInfo:n,fieldInfos:r,fieldInfoMap:a,layer:o,timeZone:f}){e&&t&&n&&Object.keys(t.attributes).forEach(m=>{const p=function Re(e){return`${j}${e.layerId}/${e.fieldName}`}({layerId:n.relation.id.toString(),fieldName:m});e[p]=pe({fieldName:p,fieldInfos:r,fieldInfoMap:a,layer:o,value:t.attributes[m],graphic:t,timeZone:f})})}const _e=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ge=({layer:e,method:t,query:n,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;const a=null!=n.where?n.where:null,o=null!=n.geometry?n.geometry:null;_e(r)||_e(a)||"extent"===o?.type||"tile"===n.resultType||(n.cacheHint=!0)},$e=({query:e,layer:t,method:n})=>{ge({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},Se=({queryPayload:e,layer:t,method:n})=>{ge({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function We(e,t,n){return e&&t&&n?"sublayer"===t.type?C({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:n})||C({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):C({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||C({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function Ke(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find(n=>n.isUtilityLayer(t)):null}function he(e,t){return e?.allTables.find(n=>"feature"===n.type&&n.layerId===t.id&&n.url===t.layer?.url)}function C({map:e,relationship:t,relationship:{relatedTableId:n},relatedLayer:r,layers:a}){if(!a)return null;for(const o of a){if("map-image"===o.type){const m=C({layers:o.sublayers,map:e,relatedLayer:r,relationship:t})||C({layers:o.subtables,map:e,relatedLayer:r,relationship:t});if(m)return m;continue}if(!Q(o))continue;if("sublayer"===r.type){if(o!==r&&o.id===n)return o.isTable?he(e,o):o;continue}const f="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!f)return null;if("sublayer"!==o.type){if(o!==r&&o.url===f&&o.layerId===n)return o}else if(o!==r&&o.layer?.url===f&&o.id===n)return o.isTable?he(e,o):o}return null}function Be(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}}}]);