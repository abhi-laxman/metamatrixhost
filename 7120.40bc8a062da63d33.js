"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[7120],{57120:(Y,j,A)=>{A.d(j,{A:()=>x});var T=A(10467),f=A(73446),y=A(62138),P=A(31033),w=A(85922),z=A(71505),R=A(7981),O=A(45211);class x extends w.A{constructor(m){super(m),this._relation="",this._relationString="",this.declaredClass="esri.arcade.featureset.actions.SpatialFilter",this._relationString=m.relationString,this._parent=m.parentfeatureset,this._maxProcessing=40,this._relation=m.relation,this._relationGeom=m.relationGeom}_getSet(m){var _=this;return(0,T.A)(function*(){if(null===_._wset){yield _._ensureLoaded();const L=yield _._parent._getFilteredSet("esriSpatialRelRelation"!==_._relation?_._relation:_._relation+":"+_._relationString,_._relationGeom,null,null,m);return _._checkCancelled(m),_._wset=new z.A(L._candidates.slice(),L._known.slice(),L._ordered,_._clonePageDefinition(L.pagesDefinition)),_._wset}return _._wset})()}_isInFeatureSet(m){let _=this._parent._isInFeatureSet(m);return _===R.J6.NotInFeatureSet?_:(_=this._idstates[m],void 0===_?R.J6.Unknown:_)}_getFeature(m,_,L){return this._parent._getFeature(m,_,L)}_getFeatures(m,_,L,N){return this._parent._getFeatures(m,_,L,N)}_featureFromCache(m){return this._parent._featureFromCache(m)}executeSpatialRelationTest(m){var _=this;return(0,T.A)(function*(){if(null==m.geometry)return!1;switch(_._relation){case"esriSpatialRelEnvelopeIntersects":{const L=(0,f.Yc)(_._relationGeom),N=(0,f.Yc)(m.geometry);return null!=L&&null!=N&&(0,O.C)("intersects",[L.toJSON(),N.toJSON()])}case"esriSpatialRelIntersects":return(0,O.C)("intersects",[_._relationGeom.toJSON(),m.geometry.toJSON()]);case"esriSpatialRelContains":return(0,O.C)("contains",[_._relationGeom.toJSON(),m.geometry.toJSON()]);case"esriSpatialRelOverlaps":return(0,O.C)("overlaps",[_._relationGeom.toJSON(),m.geometry.toJSON()]);case"esriSpatialRelWithin":return(0,O.C)("within",[_._relationGeom.toJSON(),m.geometry.toJSON()]);case"esriSpatialRelTouches":return(0,O.C)("touches",[_._relationGeom.toJSON(),m.geometry.toJSON()]);case"esriSpatialRelCrosses":return(0,O.C)("crosses",[_._relationGeom.toJSON(),m.geometry.toJSON()]);case"esriSpatialRelRelation":return(0,O.C)("relate",[_._relationGeom.toJSON(),m.geometry.toJSON(),_._relationString??""])}})()}_fetchAndRefineFeatures(m,_,L){var N=this;return(0,T.A)(function*(){const D=new z.A([],m,!1,null),b=Math.min(_,m.length);yield N._parent?._getFeatures(D,-1,b,L),N._checkCancelled(L);const U=[];for(let t=0;t<b;t++){const n=N._parent._featureFromCache(m[t]);U.push(yield N.executeSpatialRelationTest(n))}for(let t=0;t<_;t++)N._idstates[m[t]]=!0===U[t]?R.J6.InFeatureSet:R.J6.NotInFeatureSet;return"success"})()}_getFilteredSet(m,_,L,N,D){var b=this;return(0,T.A)(function*(){yield b._ensureLoaded();const U=yield b._parent._getFilteredSet("esriSpatialRelRelation"!==b._relation?b._relation:b._relation+":"+b._relationString,b._relationGeom,L,N,D);let t;return b._checkCancelled(D),t=null!==_?new z.A(U._candidates.slice().concat(U._known.slice()),[],U._ordered,b._clonePageDefinition(U.pagesDefinition)):new z.A(U._candidates.slice(),U._known.slice(),U._ordered,b._clonePageDefinition(U.pagesDefinition)),t})()}_stat(m,_,L,N,D,b,U){var t=this;return(0,T.A)(function*(){if(""!==L)return{calculated:!1};const n=yield t._parent._stat(m,_,"esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,D,b,U);return!1===n.calculated?null===D&&""===L&&null===N?t._manualStat(m,_,b,U):{calculated:!1}:n})()}_canDoAggregates(m,_,L,N,D){var b=this;return(0,T.A)(function*(){return""===L&&null===N&&null!==b._parent&&b._parent._canDoAggregates(m,_,"esriSpatialRelRelation"!==b._relation?b._relation:b._relation+":"+b._relationString,b._relationGeom,D)})()}_getAggregatePagesDataSourceDefinition(m,_,L,N,D,b,U){var t=this;return(0,T.A)(function*(){if(null===t._parent)throw new P.dr(P.D_.NeverReach);return t._parent._getAggregatePagesDataSourceDefinition(m,_,"esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,D,b,U)})()}static registerAction(){w.A._featuresetFunctions.intersects=function(m){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:m})},w.A._featuresetFunctions.envelopeIntersects=function(m){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:m})},w.A._featuresetFunctions.contains=function(m){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:m})},w.A._featuresetFunctions.overlaps=function(m){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:m})},w.A._featuresetFunctions.within=function(m){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:m})},w.A._featuresetFunctions.touches=function(m){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:m})},w.A._featuresetFunctions.crosses=function(m){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:m})},w.A._featuresetFunctions.relate=function(m,_){return null==m?new y.A({parentfeatureset:this}):new x({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:m,relationString:_})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},62138:(Y,j,A)=>{A.d(j,{A:()=>z});var T=A(10467),f=A(31033),y=A(85922),P=A(71505),w=A(7981);class z extends y.A{constructor(O){super(O),this.declaredClass="esri.layers.featureset.sources.Empty",this._maxProcessing=1e3,this._wset=new P.A([],[],!1,null),this._parent=O.parentfeatureset,this._databaseType=w.zl.Standardised}_getSet(){var O=this;return(0,T.A)(function*(){return O._wset})()}optimisePagingFeatureQueries(){}_isInFeatureSet(){return w.J6.NotInFeatureSet}_getFeature(){return(0,T.A)(function*(){throw new f.dr(f.D_.NeverReach)})()}queryAttachments(){return(0,T.A)(function*(){return[]})()}_getFeatures(){return(0,T.A)(function*(){return"success"})()}_featureFromCache(){return null}_fetchAndRefineFeatures(){return(0,T.A)(function*(){throw new f.dr(f.D_.NeverReach)})()}_getFilteredSet(){return(0,T.A)(function*(){return new P.A([],[],!1,null)})()}_stat(O,x,Z,m,_,L,N){return this._manualStat(O,x,L,N)}_canDoAggregates(){return(0,T.A)(function*(){return!1})()}}},85922:(Y,j,A)=>{A.d(j,{A:()=>D});var T=A(10467),f=A(89812),y=A(31033),P=A(63145);class w{constructor(t,n){this._lastId=-1,this._progress=n,this._parent=t}reset(){this._lastId=-1}nextBatchAsArcadeFeatures(t,n){var l=this;return(0,T.A)(function*(){const s=yield l.nextBatch(t);return null===s?s:s.map(u=>P.A.createFromGraphicLikeObject(u.geometry,u.attributes,l._parent,n))})()}nextBatch(t){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(s=>this.nextBatch(t),s=>this.nextBatch(t));const n={returnpromise:null,hasset:!1},l=[];return n.returnpromise=new Promise((s,u)=>{this._parent._getSet(this._progress).then(c=>{const v=c._known;let E=v.length-1;if("GETPAGES"===v[v.length-1]&&(E-=1),this._lastId+t>E&&v.length>0&&"GETPAGES"===v[v.length-1])this._parent._expandPagedSet(c,this._parent._maxQueryRate(),0,0,this._progress).then(B=>{n.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(t).then(s,u)},B=>{n.hasset=!0,this._parent._mainSetInUse=null,u(B)});else{if(E>=this._lastId+t||0===c._candidates.length){for(let B=0;B<t;B++){const o=B+this._lastId+1;if(o>=v.length)break;l[B]=v[o]}return this._lastId+=l.length,0===l.length&&(n.hasset=!0,this._parent._mainSetInUse=null,s([])),void this._parent._getFeatureBatch(l,this._progress).then(B=>{n.hasset=!0,this._parent._mainSetInUse=null,s(B)},B=>{n.hasset=!0,this._parent._mainSetInUse=null,u(B)})}this._parent._refineSetBlock(c,this._parent._maxProcessingRate(),this._progress).then(()=>{n.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(t).then(s,u)},B=>{n.hasset=!0,this._parent._mainSetInUse=null,u(B)})}},c=>{n.hasset=!0,this._parent._mainSetInUse=null,u(c)})}),!1===n.hasset&&(this._parent._mainSetInUse=n.returnpromise,n.hasset=!0),n.returnpromise}next(){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(n=>this.next(),n=>this.next());const t={returnpromise:null,hasset:!1};return t.returnpromise=new Promise((n,l)=>{this._parent._getSet(this._progress).then(s=>{const u=s._known;this._lastId<u.length-1?"GETPAGES"===u[this._lastId+1]?this._parent._expandPagedSet(s,this._parent._maxQueryRate(),0,0,this._progress).then(c=>(t.hasset=!0,this._parent._mainSetInUse=null,this.next())).then(n,l):(this._lastId+=1,this._parent._getFeature(s,u[this._lastId],this._progress).then(c=>{t.hasset=!0,this._parent._mainSetInUse=null,n(c)},c=>{t.hasset=!0,this._parent._mainSetInUse=null,l(c)})):s._candidates.length>0?this._parent._refineSetBlock(s,this._parent._maxProcessingRate(),this._progress).then(()=>{t.hasset=!0,this._parent._mainSetInUse=null,this.next().then(n,l)},c=>{t.hasset=!0,this._parent._mainSetInUse=null,l(c)}):(t.hasset=!0,this._parent._mainSetInUse=null,n(null))},s=>{t.hasset=!0,this._parent._mainSetInUse=null,l(s)})}),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}count(){var t=this;return(0,T.A)(function*(){if(-1!==t._parent._totalCount)return t._parent._totalCount;const n=yield t._parent._getSet(t._progress),l=yield t._refineAllSets(n);return t._parent._totalCount=l._known.length,t._parent._totalCount})()}_refineAllSets(t){var n=this;return(0,T.A)(function*(){if(t._known.length>0&&"GETPAGES"===t._known[t._known.length-1])return yield n._parent._expandPagedSet(t,n._parent._maxQueryRate(),0,1,n._progress),n._refineAllSets(t);if(t._candidates.length>0){if("GETPAGES"===t._known[t._candidates.length-1])return yield n._parent._expandPagedSet(t,n._parent._maxQueryRate(),0,2,n._progress),n._refineAllSets(t);const l=yield n._parent._refineSetBlock(t,n._parent._maxProcessingRate(),n._progress);return l._candidates.length>0?n._refineAllSets(l):l}return t})()}}var z=A(71505),R=A(7981),O=A(7425),x=A(45211),Z=A(56492),m=A(1329),_=A(32034),L=A(61320),N=A(73258);class D{constructor(t){this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=R.zl.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=Object.create(null),this.typeIdField=null,this.types=null,this.subtypeField=null,this.subtypes=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,this.fsetInfo=null,t?.lrucache&&(this.recentlyUsedQueries=t.lrucache),t?.interceptor&&(this.featureSetQueryInterceptor=t.interceptor)}optimisePagingFeatureQueries(t){this._parent&&this._parent.optimisePagingFeatureQueries(t)}_hasMemorySource(){return!0}prop(t,n){return void 0===n?this[t]:(void 0!==this[t]&&(this[t]=n),this)}end(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}_ensureLoaded(){return this.load()}load(){return null===this._loadPromise&&(this._loadPromise=this.loadImpl()),this._loadPromise}loadImpl(){var t=this;return(0,T.A)(function*(){return!0===t._parent?.loaded?(t._initialiseFeatureSet(),t):(yield t._parent?.load(),t._initialiseFeatureSet(),t)})()}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new _.A({wkid:4326}),this.geometryType=R.ik.point)}getField(t,n){let l;return(n=n||this.fields)&&(t=t.toLowerCase(),n.some(s=>(s&&s.name.toLowerCase()===t&&(l=s),!!l))),l}getFieldsIndex(){return null===this._fieldsIndex&&(this._fieldsIndex=N.A.fromLayer({timeInfo:this.timeInfo,editFieldsInfo:this.editFieldsInfo,dateFieldsTimeZone:this.dateFieldsTimeZone,datesInUnknownTimezone:this.datesInUnknownTimezone,fields:this.fields})),this._fieldsIndex}_maxProcessingRate(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}_maxQueryRate(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}_checkCancelled(t){if(null!=t&&t.aborted)throw new y.dr(y.D_.Cancelled)}nativeCapabilities(){return this._parent.nativeCapabilities()}_canDoAggregates(t,n,l,s,u){var c=this;return(0,T.A)(function*(){return null!==c._parent&&c._parent._canDoAggregates(t,n,l,s,u)})()}_getAggregatePagesDataSourceDefinition(t,n,l,s,u,c,v){var E=this;return(0,T.A)(function*(){if(null===E._parent)throw new y.dr(y.D_.NeverReach);return E._parent._getAggregatePagesDataSourceDefinition(t,n,l,s,u,c,v)})()}_getAgregagtePhysicalPage(t,n,l){var s=this;return(0,T.A)(function*(){if(null===s._parent)throw new y.dr(y.D_.NeverReach);return s._parent._getAgregagtePhysicalPage(t,n,l)})()}databaseType(){var t=this;return(0,T.A)(function*(){if(t._databaseType===R.zl.NotEvaluated){if(null!==f.A.applicationCache){const n=f.A.applicationCache.getDatabaseType(t._cacheableFeatureSetSourceKey());if(null!==n)return n}if(null!==t._databaseTypeProbed)return t._databaseTypeProbed;try{t._databaseTypeProbed=t._getDatabaseTypeImpl(),null!==f.A.applicationCache&&f.A.applicationCache.setDatabaseType(t._cacheableFeatureSetSourceKey(),t._databaseTypeProbed)}catch(n){throw null!==f.A.applicationCache&&f.A.applicationCache.clearDatabaseType(t._cacheableFeatureSetSourceKey()),n}return t._databaseTypeProbed}return t._databaseType})()}_getDatabaseTypeImpl(){var t=this;return(0,T.A)(function*(){const n=[{thetype:R.zl.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:R.zl.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:R.zl.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}];for(const l of n)if(!0===(yield t._runDatabaseProbe(l.testwhere)))return l.thetype;return R.zl.StandardisedNoInterval})()}_cacheableFeatureSetSourceKey(){return"MUSTBESET"}_runDatabaseProbe(t){var n=this;return(0,T.A)(function*(){if(null!==n._parent)return n._parent._runDatabaseProbe(t);throw new y.dr(y.D_.NotImplemented)})()}isTable(){return this._parent?.isTable()??!1}_featureFromCache(t){if(void 0!==this._featureCache[t])return this._featureCache[t]}_isInFeatureSet(t){return R.J6.Unknown}_getSet(t){throw new y.dr(y.D_.NotImplemented)}_getFeature(t,n,l){var s=this;return(0,T.A)(function*(){if(s._checkCancelled(l),void 0!==s._featureFromCache(n)||(yield s._getFeatures(t,n,s._maxProcessingRate(),l),s._checkCancelled(l),void 0!==s._featureFromCache(n)))return s._featureFromCache(n);throw new y.dr(y.D_.MissingFeatures)})()}_getFeatureBatch(t,n){var l=this;return(0,T.A)(function*(){l._checkCancelled(n);const s=new z.A([],t,!1,null),u=[];yield l._getFeatures(s,-1,t.length,n),l._checkCancelled(n);for(const c of t)void 0!==l._featureFromCache(c)&&u.push(l._featureFromCache(c));return u})()}_getFeatures(t,n,l,s){return(0,T.A)(function*(){return"success"})()}_getFilteredSet(t,n,l,s,u){throw new y.dr(y.D_.NotImplemented)}_refineSetBlock(t,n,l){var s=this;return(0,T.A)(function*(){if(!0===s._checkIfNeedToExpandCandidatePage(t,s._maxQueryRate()))return yield s._expandPagedSet(t,s._maxQueryRate(),0,0,l),s._refineSetBlock(t,n,l);s._checkCancelled(l);const u=t._candidates.length;s._refineKnowns(t,n);let c=u-t._candidates.length;if(0===t._candidates.length||c>=n)return t;if(yield s._refineIfParentKnown(t,n-c,l),s._checkCancelled(l),s._refineKnowns(t,n-c),c=u-t._candidates.length,c<n&&t._candidates.length>0){const v=n-c,E=s._prepareFetchAndRefineSet(t._candidates);return yield s._fetchAndRefineFeatures(E,E.length>v?v:t._candidates.length,l),s._checkCancelled(l),s._refineKnowns(t,n-c),t}return t})()}_fetchAndRefineFeatures(t,n,l){return null}_prepareFetchAndRefineSet(t){const n=[];for(let l=0;l<t.length;l++)this._isPhysicalFeature(t[l])&&n.push(t[l]);return n}_isPhysicalFeature(t){return null===this._parent||this._parent._isPhysicalFeature(t)}_refineKnowns(t,n){let l=0,s=null;const u=[];n=this._maxQueryRate();for(let c=0;c<t._candidates.length&&"GETPAGES"!==t._candidates[c];c++){let v=!1;const E=this._candidateIdTransform(t._candidates[c]);E!==t._candidates[c]&&(v=!0);const G=this._isInFeatureSet(E);if(G===R.J6.InFeatureSet)!0===v?t._known.includes(E)||(t._known.push(E),l+=1):(t._known.push(t._candidates[c]),l+=1),null===s?s={start:c,end:c}:s.end===c-1?s.end=c:(u.push(s),s={start:c,end:c});else if(G===R.J6.NotInFeatureSet)null===s?s={start:c,end:c}:s.end===c-1?s.end=c:(u.push(s),s={start:c,end:c}),l+=1;else if(G===R.J6.Unknown&&(l+=1,!0===t._ordered))break;if(l>=n)break}null!==s&&u.push(s);for(let c=u.length-1;c>=0;c--)t._candidates.splice(u[c].start,u[c].end-u[c].start+1)}_refineIfParentKnown(t,n,l){const s=new z.A([],[],t._ordered,null);return s._candidates=t._candidates.slice(),this._parent._refineSetBlock(s,n,l)}_candidateIdTransform(t){return this._parent._candidateIdTransform(t)}_checkIfNeedToExpandKnownPage(t,n){if(null===t.pagesDefinition)return!1;let l=0;for(let s=t._lastFetchedIndex;s<t._known.length;s++){if("GETPAGES"===t._known[s])return!0;if(void 0===this._featureCache[t._known[s]]&&(l+=1,l>=n))break}return!1}_checkIfNeedToExpandCandidatePage(t,n){if(null===t.pagesDefinition)return!1;let l=0;for(let s=0;s<t._candidates.length;s++){if("GETPAGES"===t._candidates[s])return!0;if(l+=1,l>=n)break}return!1}_expandPagedSet(t,n,l,s,u){var c=this;return(0,T.A)(function*(){if(null===c._parent)throw new y.dr(y.D_.NotImplemented);return c._parent._expandPagedSet(t,n,l,s,u)})()}_expandPagedSetFeatureSet(t,n,l,s,u){var c=this;return(0,T.A)(function*(){if(t._known.length>0&&"GETPAGES"===t._known[t._known.length-1]&&(s=1),0===s&&t._candidates.length>0&&"GETPAGES"===t._candidates[t._candidates.length-1]&&(s=2),0===s)return"finished";const v=yield c._getPage(t,s,u);return l+v<n?c._expandPagedSet(t,n,l+v,0,u):"success"})()}_getPage(t,n,l){var s=this;return(0,T.A)(function*(){const u=1===n?t._known:t._candidates;if(t.pagesDefinition.internal.set.length>t.pagesDefinition.resultOffset||!0===t.pagesDefinition.internal.fullyResolved){u.length=u.length-1;let c=0;for(let E=0;E<t.pagesDefinition.resultRecordCount&&!(t.pagesDefinition.resultOffset+E>=t.pagesDefinition.internal.set.length);E++)u[u.length]=t.pagesDefinition.internal.set[t.pagesDefinition.resultOffset+E],c++;t.pagesDefinition.resultOffset+=c;let v=!1;return!0===t.pagesDefinition.internal.fullyResolved&&t.pagesDefinition.internal.set.length<=t.pagesDefinition.resultOffset&&(v=!0),!1===v&&u.push("GETPAGES"),c}return yield s._getPhysicalPage(t,n,l),s._getPage(t,n,l)})()}_getPhysicalPage(t,n,l){return null}_clonePageDefinition(t){return null===this._parent?null:this._parent._clonePageDefinition(t)}_first(t){return this.iterator(t).next()}first(t){return this._first(t)}calculateStatistic(t,n,l,s){var u=this;return(0,T.A)(function*(){yield u._ensureLoaded();let c=yield u._stat(t,n,"",null,null,l,s);return!1===c.calculated&&(c=yield u._manualStat(t,n,l,s)),c.result})()}_manualStat(t,n,l,s){var u=this;return(0,T.A)(function*(){let c=null;switch(t.toLowerCase()){case"count":return c=yield(0,O.U9)(u,s),{calculated:!0,result:c};case"distinct":return c=yield(0,O.dM)(u,n,l,s),{calculated:!0,result:c};case"avg":case"mean":return c=yield(0,O.i2)(u,n,s),{calculated:!0,result:c};case"stdev":return c=yield(0,O.b$)(u,n,s),{calculated:!0,result:c};case"variance":return c=yield(0,O.GV)(u,n,s),{calculated:!0,result:c};case"sum":return c=yield(0,O.cz)(u,n,s),{calculated:!0,result:c};case"min":return c=yield(0,O.jk)(u,n,s),{calculated:!0,result:c};case"max":return c=yield(0,O.T9)(u,n,s),{calculated:!0,result:c};default:return{calculated:!0,result:0}}})()}_stat(t,n,l,s,u,c,v){var E=this;return(0,T.A)(function*(){const G=yield E._parent._stat(t,n,l,s,u,c,v);return!1===G.calculated?null===u&&""===l&&null===s?E._manualStat(t,n,c,v):{calculated:!1}:G})()}_unionAllGeomSelf(t){const n=this.iterator(this._defaultTracker(t)),l=[];return new Promise((s,u)=>{this._unionShapeInBatches(l,n,s,u)})}_unionAllGeom(t){return new Promise((n,l)=>{const s=this.iterator(this._defaultTracker(t));this._unionShapeInBatches([],s,n,l)})}_unionShapeInBatches(t,n,l,s){n.next().then(u=>{try{null!==u&&null!==u.geometry&&t.push(u.geometry),t.length>30||null===u&&t.length>1?(0,x.C)("union",[t.map(c=>c.toJSON())]).then(c=>{try{null===u?l(c):(t=[(0,L.rS)(c)],this._unionShapeInBatches(t,n,l,s))}catch(v){s(v)}},s):null===u?l(1===t.length?t[0]:null):this._unionShapeInBatches(t,n,l,s)}catch(c){s(c)}},s)}iterator(t){return new w(this,t)}intersection(t,n=!1){return D._featuresetFunctions.intersection.bind(this)(t,n)}difference(t,n=!1,l=!0){return D._featuresetFunctions.difference.bind(this)(t,n,l)}symmetricDifference(t,n=!1,l=!0){return D._featuresetFunctions.symmetricDifference.bind(this)(t,n,l)}morphShape(t,n,l="unknown",s=null){return D._featuresetFunctions.morphShape.bind(this)(t,n,l,s)}morphShapeAndAttributes(t,n,l="unknown"){return D._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,n,l)}union(t,n=!1){return D._featuresetFunctions.union.bind(this)(t,n)}intersects(t){return D._featuresetFunctions.intersects.bind(this)(t)}envelopeIntersects(t){return D._featuresetFunctions.envelopeIntersects.bind(this)(t)}contains(t){return D._featuresetFunctions.contains.bind(this)(t)}overlaps(t){return D._featuresetFunctions.overlaps.bind(this)(t)}relate(t,n){return D._featuresetFunctions.relate.bind(this)(t,n)}within(t){return D._featuresetFunctions.within.bind(this)(t)}touches(t){return D._featuresetFunctions.touches.bind(this)(t)}top(t){return D._featuresetFunctions.top.bind(this)(t)}crosses(t){return D._featuresetFunctions.crosses.bind(this)(t)}buffer(t,n,l,s=!0){return D._featuresetFunctions.buffer.bind(this)(t,n,l,s)}filter(t,n=null){return D._featuresetFunctions.filter.bind(this)(t,n)}orderBy(t){return D._featuresetFunctions.orderBy.bind(this)(t)}dissolve(t,n){return D._featuresetFunctions.dissolve.bind(this)(t,n)}groupby(t,n){return D._featuresetFunctions.groupby.bind(this)(t,n)}reduce(t,n=null,l){return new Promise((s,u)=>{this._reduceImpl(this.iterator(this._defaultTracker(l)),t,n,0,s,u,0)})}_reduceImpl(t,n,l,s,u,c,v){try{if(++v>1e3)return void setTimeout(()=>{this._reduceImpl(t,n,l,s,u,c,v=0)});t.next().then(E=>{try{if(null===E)u(l);else{const G=n(l,E,s,this);(0,Z.$X)(G)?G.then(B=>{this._reduceImpl(t,n,B,s+1,u,c,v)},c):this._reduceImpl(t,n,G,s+1,u,c,v)}}catch(G){c(G)}},c)}catch(E){c(E)}}removeField(t){return D._featuresetFunctions.removeField.bind(this)(t)}addField(t,n,l=null){return D._featuresetFunctions.addField.bind(this)(t,n,l)}sumArea(t,n=!1,l){var s=this;return(0,T.A)(function*(){const u=s.iterator(l);let c,v=0;for(;null!=(c=yield u.next());)null!=c.geometry&&(v+=n?yield(0,x.C)("geodeticArea",[c.geometry.toJSON(),t]):yield(0,x.C)("area",[c.geometry.toJSON(),t]));return v})()}sumLength(t,n=!1,l){var s=this;return(0,T.A)(function*(){const u=s.iterator(l);let c,v=0;for(;null!=(c=yield u.next());)null!=c.geometry&&(v+=n?yield(0,x.C)("geodeticLength",[c.geometry.toJSON(),t]):yield(0,x.C)("length",[c.geometry.toJSON(),t]));return v})()}distinct(t,n=1e3,l=null,s){var u=this;return(0,T.A)(function*(){yield u.load();const c=m.default.create(t,{fieldsIndex:u.getFieldsIndex(),timeZone:u.dateFieldsTimeZoneDefaultUTC});return b(c,l),u.calculateStatistic("distinct",c,n,u._defaultTracker(s))})()}min(t,n=null,l){var s=this;return(0,T.A)(function*(){yield s.load();const u=m.default.create(t,{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC});return b(u,n),s.calculateStatistic("min",u,-1,s._defaultTracker(l))})()}max(t,n=null,l){var s=this;return(0,T.A)(function*(){yield s.load();const u=m.default.create(t,{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC});return b(u,n),s.calculateStatistic("max",u,-1,s._defaultTracker(l))})()}avg(t,n=null,l){var s=this;return(0,T.A)(function*(){yield s.load();const u=m.default.create(t,{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC});return b(u,n),s.calculateStatistic("avg",u,-1,s._defaultTracker(l))})()}sum(t,n=null,l){var s=this;return(0,T.A)(function*(){yield s.load();const u=m.default.create(t,{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC});return b(u,n),s.calculateStatistic("sum",u,-1,s._defaultTracker(l))})()}stdev(t,n=null,l){var s=this;return(0,T.A)(function*(){yield s.load();const u=m.default.create(t,{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC});return b(u,n),s.calculateStatistic("stdev",u,-1,s._defaultTracker(l))})()}variance(t,n=null,l){var s=this;return(0,T.A)(function*(){yield s.load();const u=m.default.create(t,{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC});return b(u,n),s.calculateStatistic("variance",u,-1,s._defaultTracker(l))})()}count(t){var n=this;return(0,T.A)(function*(){return yield n.load(),n.calculateStatistic("count",m.default.create("1",{fieldsIndex:n.getFieldsIndex(),timeZone:n.dateFieldsTimeZoneDefaultUTC}),-1,n._defaultTracker(t))})()}_defaultTracker(t){return t??{aborted:!1}}forEach(t,n){return new Promise((l,s)=>{this._forEachImpl(this.iterator(this._defaultTracker(n)),t,this,l,s,0)})}_forEachImpl(t,n,l,s,u,c){try{if(++c>1e3)return void setTimeout(()=>{this._forEachImpl(t,n,l,s,u,c=0)},0);t.next().then(v=>{try{if(null===v)s(l);else{const E=n(v);null==E?this._forEachImpl(t,n,l,s,u,c):(0,Z.$X)(E)?E.then(()=>{try{this._forEachImpl(t,n,l,s,u,c)}catch(G){u(G)}},u):this._forEachImpl(t,n,l,s,u,c)}}catch(E){u(E)}},u)}catch(v){u(v)}}convertToJSON(t){const n={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}};for(let l=0;l<this.fields.length;l++)n.layerDefinition.fields.push((0,R.nE)(this.fields[l]));return this.reduce((l,s)=>{const u={geometry:s.geometry?.toJSON(),attributes:{}};for(const c in s.attributes)u.attributes[c]=s.attributes[c];return n.featureSet.features.push(u),1},0,t).then(()=>n)}castToText(t=!1){return"object, FeatureSet"}queryAttachments(t,n,l,s,u){return this._parent.queryAttachments(t,n,l,s,u)}serviceUrl(){return this._parent.serviceUrl()}subtypeMetaData(){return this.subtypeField&&this.subtypes?{subtypeField:this.subtypeField,subtypes:this.subtypes?this.subtypes.map(t=>({name:t.name,code:t.code})):[]}:this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map(t=>({name:t.name,code:t.id})):[]}:null}relationshipMetaData(){return this._parent.relationshipMetaData()}get gdbVersion(){return this._parent?this._parent.gdbVersion:""}schema(){const t=[];for(const n of this.fields)t.push((0,R.nE)(n));return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===R.yT[this.geometryType]?"esriGeometryNull":R.yT[this.geometryType],fields:t}}convertToText(t,n){var l=this;return(0,T.A)(function*(){if("schema"===t)return yield l._ensureLoaded(),JSON.stringify(l.schema());if("featureset"===t){yield l._ensureLoaded();const s=[];yield l.reduce((c,v)=>{const E={geometry:v.geometry?v.geometry.toJSON():null,attributes:v.attributes};return null!==E.geometry&&E.geometry.spatialReference&&delete E.geometry.spatialReference,s.push(E),1},0,n);const u=l.schema();return u.features=s,u.spatialReference=l.spatialReference.toJSON(),JSON.stringify(u)}return l.castToText()})()}getFeatureByObjectId(t,n){return this._parent.getFeatureByObjectId(t,n)}getOwningSystemUrl(){return this._parent.getOwningSystemUrl()}getIdentityUser(){return this._parent.getIdentityUser()}getRootFeatureSet(){return null!==this._parent?this._parent.getRootFeatureSet():this}getDataSourceFeatureSet(){return null!==this._parent?this._parent.getDataSourceFeatureSet():this}castAsJson(t=null){return"keeptype"===t?.featureset?this:"none"===t?.featureset?null:{type:"FeatureSet"}}castAsJsonAsync(t=null,n=null){var l=this;return(0,T.A)(function*(){if("keeptype"===n?.featureset)return l;if("schema"===n?.featureset)return yield l._ensureLoaded(),JSON.parse(JSON.stringify(l.schema()));if("none"===n?.featureset)return null;yield l._ensureLoaded();const s=[];yield l.reduce((c,v)=>{const E={geometry:v.geometry?!0===n?.keepGeometryType?v.geometry:v.geometry.toJSON():null,attributes:v.attributes};return null!==E.geometry&&E.geometry.spatialReference&&!0!==n?.keepGeometryType&&delete E.geometry.spatialReference,s.push(E),1},0,t);const u=l.schema();return u.features=s,u.spatialReference=!0===n?.keepGeometryType?l.spatialReference:l.spatialReference?.toJSON(),u})()}fieldTimeZone(t){return this.getFieldsIndex().getTimeZone(t)}get preferredTimeZone(){return this._parent?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._parent?.dateFieldsTimeZone??null}get dateFieldsTimeZoneDefaultUTC(){if(this.datesInUnknownTimezone)return"unknown";const t=this.dateFieldsTimeZone??"UTC";return""===t?"UTC":t}get datesInUnknownTimezone(){return this._parent.datesInUnknownTimezone}get editFieldsInfo(){return this._parent?.editFieldsInfo??null}get timeInfo(){return this._parent?.timeInfo??null}set featureSetInfo(t){this.fsetInfo=t}getFeatureSetInfo(){var t=this;return(0,T.A)(function*(){return t.fsetInfo??(yield t._parent?.getFeatureSetInfo())??null})()}}function b(U,t){if(null!==t){const n={};for(const l in t)n[l.toLowerCase()]=t[l];U.parameters=n}}D._featuresetFunctions={}},71505:(Y,j,A)=>{A.d(j,{A:()=>T});class T{constructor(y,P,w,z){this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=y,this._known=P,this._ordered=w,this.pagesDefinition=z}}},89812:(Y,j,A)=>{A.d(j,{A:()=>T});let T=(()=>{class f{constructor(){this._databaseTypeMetaData={},this._layerInfo={}}clearDatabaseType(P){void 0===this._databaseTypeMetaData[P]&&delete this._databaseTypeMetaData[P]}getDatabaseType(P){return"MUSTBESET"===P||void 0===this._databaseTypeMetaData[P]?null:this._databaseTypeMetaData[P]}setDatabaseType(P,w){this._databaseTypeMetaData[P]=w}getLayerInfo(P){return void 0===this._layerInfo[P]?null:this._layerInfo[P]}setLayerInfo(P,w){this._layerInfo[P]=w}clearLayerInfo(P){void 0!==this._layerInfo[P]&&delete this._layerInfo[P]}}return f.applicationCache=null,f})()},31033:(Y,j,A)=>{A.d(j,{D_:()=>f,dr:()=>P});var f,w,T=A(1119);(w=f||(f={})).NeverReach="NeverReach",w.NotImplemented="NotImplemented",w.Cancelled="Cancelled",w.InvalidStatResponse="InvalidStatResponse",w.InvalidRequest="InvalidRequest",w.RequestFailed="RequestFailed",w.MissingFeatures="MissingFeatures",w.AggregationFieldNotFound="AggregationFieldNotFound",w.DataElementsNotFound="DataElementsNotFound";const y={[f.Cancelled]:"Cancelled",[f.InvalidStatResponse]:"Invalid statistics response from service",[f.InvalidRequest]:"Invalid request",[f.RequestFailed]:"Request failed - {reason}",[f.MissingFeatures]:"Missing features",[f.AggregationFieldNotFound]:"Aggregation field not found",[f.DataElementsNotFound]:"Data elements not found on service",[f.NeverReach]:"Encountered unreachable logic",[f.NotImplemented]:"Not implemented"};class P extends Error{constructor(z,R){super((0,T.HC)(y[z],R)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,P)}}},97089:(Y,j,A)=>{A.d(j,{C6:()=>t,DA:()=>v,F1:()=>b,F6:()=>L,IY:()=>n,Ju:()=>c,Kb:()=>m,Mi:()=>O,Nf:()=>D,R8:()=>N,YY:()=>R,bD:()=>x,bm:()=>U,kg:()=>Z,oj:()=>B});var T=A(61299),f=A(7981),y=A(89998),P=A(29752),w=A(1329),z=A(44549);function R(o,i){return _(o?.parseTree,i,o?.parameters)}function O(o,i,h){return _(o,i,h)}function x(o,i,h,d){const g=_(o.parseTree,f.zl.Standardised,o.parameters,i,h);return w.default.create(g,{fieldsIndex:d,timeZone:o.timeZone,currentUser:o.currentUser})}function Z(o,i,h="AND"){return w.default.create("(("+R(o,f.zl.Standardised)+")"+h+"("+R(i,f.zl.Standardised)+"))",{fieldsIndex:o.fieldsIndex,timeZone:o.timeZone,currentUser:o.currentUser})}function m(o){return!0===o.delimited?`"${o.column.split('"').join('""')}"`:o.column}function _(o,i,h,d=null,g=null){let M,p,I,F;switch(o.type){case"interval":return B(_(o.value,i,h,d,g),o.qualifier,o.op);case"case-expression":{let S=" CASE ";"simple"===o.format&&(S+=_(o.operand,i,h,d,g));for(let k=0;k<o.clauses.length;k++)S+=" WHEN "+_(o.clauses[k].operand,i,h,d,g)+" THEN "+_(o.clauses[k].value,i,h,d,g);return null!==o.else&&(S+=" ELSE "+_(o.else,i,h,d,g)),S+=" END ",S}case"parameter":{const S=h[o.value.toLowerCase()];if("string"==typeof S)return"'"+h[o.value.toLowerCase()].toString().replaceAll("'","''")+"'";if((0,f.$P)(S)||(0,f.Lk)(S))return U(S,i);if((0,f.eg)(S))return b(S,i);if((0,f.rX)(S))return N(S,i);if((0,f.f0)(S))return D(S,i);if(Array.isArray(S)){const k=[];for(let C=0;C<S.length;C++)"string"==typeof S[C]?k.push("'"+S[C].toString().replaceAll("'","''")+"'"):(0,f.$P)(S[C])||(0,f.Lk)(S[C])?k.push(U(S[C],i)):(0,f.eg)(S[C])?k.push(b(S[C],i)):(0,f.rX)(S[C])?k.push(N(S[C],i)):(0,f.f0)(S[C])?k.push(D(S[C],i)):k.push(S[C].toString());return k}return S.toString()}case"expression-list":p=[];for(const S of o.value)p.push(_(S,i,h,d,g));return p;case"unary-expression":return" ( NOT "+_(o.expr,i,h,d,g)+" ) ";case"binary-expression":switch(o.operator){case"AND":return" ("+_(o.left,i,h,d,g)+" AND "+_(o.right,i,h,d,g)+") ";case"OR":return" ("+_(o.left,i,h,d,g)+" OR "+_(o.right,i,h,d,g)+") ";case"IS":if("null"!==o.right.type)throw new y.L8(y.Z7.UnsupportedIsRhs);return" ("+_(o.left,i,h,d,g)+" IS NULL )";case"ISNOT":if("null"!==o.right.type)throw new y.L8(y.Z7.UnsupportedIsRhs);return" ("+_(o.left,i,h,d,g)+" IS NOT NULL )";case"IN":return M=[],"expression-list"===o.right.type?(M=_(o.right,i,h,d,g)," ("+_(o.left,i,h,d,g)+" IN ("+M.join(",")+")) "):(F=_(o.right,i,h,d,g),Array.isArray(F)?" ("+_(o.left,i,h,d,g)+" IN ("+F.join(",")+")) ":" ("+_(o.left,i,h,d,g)+" IN ("+F+")) ");case"NOT IN":return M=[],"expression-list"===o.right.type?(M=_(o.right,i,h,d,g)," ("+_(o.left,i,h,d,g)+" NOT IN ("+M.join(",")+")) "):(F=_(o.right,i,h,d,g),Array.isArray(F)?" ("+_(o.left,i,h,d,g)+" NOT IN ("+F.join(",")+")) ":" ("+_(o.left,i,h,d,g)+" NOT IN ("+F+")) ");case"BETWEEN":return I=_(o.right,i,h,d,g)," ("+_(o.left,i,h,d,g)+" BETWEEN "+I[0]+" AND "+I[1]+" ) ";case"NOTBETWEEN":return I=_(o.right,i,h,d,g)," ("+_(o.left,i,h,d,g)+" NOT BETWEEN "+I[0]+" AND "+I[1]+" ) ";case"LIKE":return""!==o.escape?" ("+_(o.left,i,h,d,g)+" LIKE "+_(o.right,i,h,d,g)+" ESCAPE '"+o.escape+"') ":" ("+_(o.left,i,h,d,g)+" LIKE "+_(o.right,i,h,d,g)+") ";case"NOT LIKE":return""!==o.escape?" ("+_(o.left,i,h,d,g)+" NOT LIKE "+_(o.right,i,h,d,g)+" ESCAPE '"+o.escape+"') ":" ("+_(o.left,i,h,d,g)+" NOT LIKE "+_(o.right,i,h,d,g)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+_(o.left,i,h,d,g)+" "+o.operator+" "+_(o.right,i,h,d,g)+") ";case"||":return" ("+_(o.left,i,h,d,g)+" "+(i===f.zl.SqlServer?"+":o.operator)+" "+_(o.right,i,h,d,g)+") "}throw new y.L8(y.Z7.UnsupportedOperator,{operator:o.operator});case"null":return"null";case"boolean":return!0===o.value?"1":"0";case"string":return"'"+o.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${o.value}'`;case"date":return`date '${o.value}'`;case"time":return`time '${o.value}'`;case"number":return o.value.toString();case"current-time":return t(o.mode,i);case"current-user":return"CURRENT_USER";case"column-reference":return d&&d.toLowerCase()===o.column.toLowerCase()?"("+g+")":m(o);case"data-type":return o.value;case"function":{const S=_(o.args,i,h,d,g);return L(o.name,S,i)}}throw new y.L8(y.Z7.UnsupportedSyntax,{node:o.type})}function L(o,i,h){switch(o.toLowerCase().trim()){case"cos":case"sin":case"tan":case"cosh":case"tanh":case"sinh":case"acos":case"asin":case"atan":case"floor":case"log10":case"log":case"abs":if(1!==i.length)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:o.toLowerCase().trim()});return`${o.toUpperCase().trim()}(${i[0]})`;case"ceiling":case"ceil":if(1!==i.length)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:"ceiling"});return"CEILING("+i[0]+")";case"mod":case"power":case"nullif":if(2!==i.length)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:o.toLowerCase().trim()});return`${o.toUpperCase().trim()}(${i[0]},${i[1]})`;case"round":if(2===i.length)return"ROUND("+i[0]+","+i[1]+")";if(1===i.length)return"ROUND("+i[0]+")";throw new y.L8(y.Z7.InvalidFunctionParameters,{function:"round"});case"truncate":if(i.length<1||i.length>2)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:"truncate"});return h===f.zl.SqlServer?"ROUND("+i[0]+(1===i.length?"0":","+i[1])+",1)":"TRUNCATE("+i[0]+(1===i.length?")":","+i[1]+")");case"char_length":case"len":if(1!==i.length)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:"char_length"});switch(h){case f.zl.SqlServer:return"LEN("+i[0]+")";case f.zl.Oracle:return"LENGTH("+i[0]+")";default:return"CHAR_LENGTH("+i[0]+")"}case"coalesce":case"concat":{if(i.length<1)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:o.toLowerCase()});let d=o.toUpperCase().trim()+"(";for(let g=0;g<i.length;g++)0!==g&&(d+=","),d+=i[g];return d+=")",d}case"lower":case"lcase":if(1!==i.length)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:"lower"});return"LOWER("+i[0]+")";case"upper":case"ucase":if(1!==i.length)throw new y.L8(y.Z7.InvalidFunctionParameters,{function:"upper"});return"UPPER("+i[0]+")";case"substring":{let d="";switch(h){case f.zl.Oracle:return d="SUBSTR("+i[0]+","+i[1],3===i.length&&(d+=","+i[2]),d+=")",d;case f.zl.SqlServer:return d=3===i.length?"SUBSTRING("+i[0]+","+i[1]+","+i[2]+")":"SUBSTRING("+i[0]+",  "+i[1]+", LEN("+i[0]+") - "+i[1]+")",d;default:return d="SUBSTRING("+i[0]+" FROM "+i[1],3===i.length&&(d+=" FOR "+i[2]),d+=")",d}}case"extract":return"EXTRACT("+i[0].replaceAll("'","")+" FROM "+i[1]+")";case"cast":{let d="";switch(h){case f.zl.Oracle:switch(i[1].type){case"date":d="DATE";break;case"float":d="DOUBLE";break;case"integer":d="INTEGER";break;case"real":d="REAL";break;case"smallint":d="SMALLINT";break;case"timestamp":d="TIMESTAMP";break;case"varchar":d="VARCHAR("+i[1].size.toString()+")"}return`CAST(${i[0]} AS ${d})`;case f.zl.Postgres:switch(i[1].type){case"date":d="DATE";break;case"float":d="DOUBLE PRECISION";break;case"integer":d="INT";break;case"real":d="REAL";break;case"smallint":d="SMALLINT";break;case"timestamp":d="TIMESTAMP";break;case"varchar":d="VARCHAR("+i[1].size.toString()+")"}return`CAST(${i[0]} AS ${d})`;case f.zl.SqlServer:switch(i[1].type){case"date":d="DATE";break;case"float":d="FLOAT";break;case"integer":d="INT";break;case"real":d="REAL";break;case"smallint":d="SMALLINT";break;case"timestamp":d="DATETIME";break;case"varchar":d="VARCHAR("+i[1].size.toString()+")"}return`CAST(${i[0]} AS ${d})`;default:switch(i[1].type){case"date":d="DATE";break;case"float":d="FLOAT";break;case"integer":d="INTEGER";break;case"real":d="REAL";break;case"smallint":d="SMALLINT";break;case"timestamp":d="TIMESTAMP";break;case"varchar":d="VARCHAR("+i[1].size.toString()+")"}return`CAST(${i[0]} AS ${d})`}}}throw new y.L8(y.Z7.InvalidFunctionParameters,{function:o})}function N(o,i){const h=o.toDateTime(),d=0===h.hour&&0===h.minute&&0===h.second&&0===h.millisecond;switch(i){case f.zl.FILEGDB:case f.zl.Standardised:case f.zl.StandardisedNoInterval:return d?`date '${h.toFormat("yyyy-LL-dd")}'`:`timestamp '${h.toFormat("yyyy-LL-dd HH:mm:ss")}'`;case f.zl.Oracle:return d?`TO_DATE('${h.toFormat("yyyy-LL-dd")}','YYYY-MM-DD')`:`TO_DATE('${h.toFormat("yyyy-LL-dd HH:mm:ss")}','YYYY-MM-DD HH24:MI:SS')`;case f.zl.SqlServer:return`'${h.toFormat(d?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss")}'`;case f.zl.PGDB:return`#${h.toFormat(d?"LL-dd-yyyy":"LL-dd-yyyy HH:mm:ss")}#`;case f.zl.Postgres:return`TIMESTAMP '${h.toFormat(d?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss")}'`;default:return`timestamp '${h.toFormat("yyyy-LL-dd HH:mm:ss")}'`}}function D(o,i){switch(i){case f.zl.FILEGDB:case f.zl.Standardised:case f.zl.StandardisedNoInterval:return o.toSQLWithKeyword();case f.zl.Oracle:return`TO_DATE('${o.toFormat("Y-MM-DD")}'`;case f.zl.SqlServer:return`'${o.toFormat("Y-MM-DD")}'`;case f.zl.PGDB:return`#${o.toFormat("Y-MM-DD")}#`;case f.zl.Postgres:return`TIMESTAMP '${o.toFormat("Y-MM-DD")}'`;default:return o.toSQLWithKeyword()}}function b(o,i){switch(o instanceof P.k&&(o=o.toStorageString()),i){case f.zl.Oracle:return`TO_DATE('${o}', 'HH24:MI:SS')`;case f.zl.SqlServer:return`'${o}'`;default:return`time '${o}'`}}function U(o,i){return N(T.lY.dateTimeToArcadeDate((0,f.Lk)(o)?o:z.c9.fromJSDate(o)),i)}function t(o,i){switch(i){case f.zl.FILEGDB:case f.zl.Standardised:case f.zl.StandardisedNoInterval:case f.zl.Oracle:case f.zl.PGDB:default:return"date"===o?"CURRENT_DATE":"time"===o?"CURRENT_TIME":"CURRENT_TIMESTAMP";case f.zl.SqlServer:return"date"===o?"CAST(GETDATE() AS DATE)":"time"===o?"CAST(GETDATE() AS TIME)":"GETDATE()";case f.zl.Postgres:return"date"===o?"CURRENT_DATE":"time"===o?"LOCALTIME":"CURRENT_TIMESTAMP"}}function n(o,i,h={}){const d={},g={},M={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeBigInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeTimeOnly:"time-only",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimestampOffset:"timestamp-offset",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"guid",oid:"integer",long:"integer","small-integer":"integer",integer:"integer","big-integer":"integer",single:"double","time-only":"time-only","date-only":"date-only","timestamp-offset":"timestemp-offset",double:"double",date:"date",guid:"guid","global-id":"guid",string:"string"};for(const p of i){const I=p.type?M[p.type]:void 0;d[p.name.toLowerCase()]=void 0===I?"":I}for(const p in h){const I=M[h[p]];g[p.toLowerCase()]=void 0===I?"":I}switch(l(d,o.parseTree,o.parameters,g)){case"double":return"double";case"integer":return"integer";case"date":return"date";case"date-only":return"date-only";case"time-only":return"time-only";case"timestamp-offset":return"timestamp-offset";case"string":return"string";case"global-id":case"guid":return"guid"}return""}function l(o,i,h,d){let g;switch(i.type){case"interval":return"integer";case"case-expression":{const M=[];if("simple"===i.format){for(let p=0;p<i.clauses.length;p++)M.push(l(o,i.clauses[p].value,h,d));null!==i.else&&M.push(l(o,i.else,h,d))}else{for(let p=0;p<i.clauses.length;p++)M.push(l(o,i.clauses[p].value,h,d));null!==i.else&&M.push(l(o,i.else,h,d))}return u(M)}case"parameter":{const M=d[i.value.toLowerCase()];if(void 0===M&&h){const p=h[i.value.toLowerCase()];if(null==p)return"";if("string"==typeof p||p instanceof String)return"string";if("boolean"==typeof p)return"boolean";if((0,f.$P)(p)||(0,f.rX)(p))return"date";if((0,f.f0)(p))return"date-only";if((0,f.eg)(p))return"time-only";if("number"==typeof p)return p%1==0?"integer":"double"}return void 0===M?"":M}case"expression-list":{const M=[];for(const p of i.value)M.push(l(o,p,h,d));return M}case"unary-expression":return"boolean";case"binary-expression":switch(i.operator){case"AND":case"OR":case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"IS":case"ISNOT":if("null"!==i.right.type)throw new y.L8(y.Z7.UnsupportedIsRhs);return"boolean";case"*":case"-":case"+":case"/":return u([l(o,i.left,h,d),l(o,i.right,h,d)]);case"||":return"string";default:throw new y.L8(y.Z7.UnsupportedOperator,{operator:i.operator})}case"null":return"";case"boolean":return"boolean";case"string":return"string";case"number":return null===i.value?"":i.value%1==0?"integer":"double";case"date":return"date";case"timestamp":return i.withtimezone?"timestamp-offset":"date";case"time":return"time-only";case"current-time":return"time"===i.mode?"time-only":"date";case"current-user":return"string";case"column-reference":{const M=o[i.column.toLowerCase()];return void 0===M?"":M}case"function":switch(i.name.toLowerCase()){case"cast":switch(i.args?.value[1]?.value.type??""){case"integer":case"smallint":return"integer";case"real":case"float":return"double";case"date":case"timestamp":return!0===i.args?.value[1]?.value?.withtimezone?"timestamp-offset":"date";case"time":return"time-only";case"varchar":return"string";default:return""}case"position":case"extract":case"char_length":case"mod":return"integer";case"round":if(g=l(o,i.args,h,d),Array.isArray(g)){if(g.length<=0)return"double";g=g[0]}return g;case"sign":return"integer";case"ceiling":case"floor":case"abs":return g=l(o,i.args,h,d),Array.isArray(g)&&(g=u(g)),"integer"===g||"double"===g?g:"double";case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"cosh":case"sinh":case"tanh":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"nullif":case"coalesce":return g=l(o,i.args,h,d),Array.isArray(g)?g.length>0?g[0]:"":g}return""}throw new y.L8(y.Z7.UnsupportedSyntax,{node:i.type})}const s={boolean:1,string:2,integer:3,double:4,date:5};function u(o){if(o){let i="";for(const h of o)""!==h&&(i=""===i||s[i]<s[h]?h:i);return i}return""}function c(o,i){return E(o.parseTree,i)}function v(o){return"column-reference"===o?.parseTree.type}function E(o,i){if(null==o)return!1;switch(o.type){case"when-clause":return E(o.operand,i)||E(o.value,i);case"case-expression":for(const h of o.clauses)if(E(h,i))return!0;return!("simple"!==o.format||!E(o.operand,i))||!(null===o.else||!E(o.else,i));case"parameter":case"null":case"boolean":case"date":case"timestamp":case"time":case"string":case"number":return!1;case"expression-list":for(const h of o.value)if(E(h,i))return!0;return!1;case"unary-expression":return E(o.expr,i);case"binary-expression":return E(o.left,i)||E(o.right,i);case"column-reference":return i.toLowerCase()===o.column.toLowerCase();case"function":return E(o.args,i)}return!1}function G(o){let i="";return i+=o.period.toUpperCase(),i}function B(o,i,h){let d="";return d="interval-period"===i.type?G(i):G(i.start)+" TO "+G(i.end),"INTERVAL "+h+" "+o+" "+d}},7425:(Y,j,A)=>{A.d(j,{Dp:()=>N,GV:()=>u,T9:()=>t,U9:()=>o,b$:()=>v,cz:()=>G,dM:()=>g,i2:()=>l,jk:()=>b});var T=A(10467),f=A(31033),P=(A(7981),A(97089)),w=A(87257),z=A(16924),R=A(29752);function x(p){let I=0;for(let F=0;F<p.length;F++)I+=p[F];return I/p.length}function m(p){const I=x(p);let F=0;for(let S=0;S<p.length;S++)F+=(I-p[S])**2;return F/(p.length-1)}function N(p){switch(p.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function b(p,I,F){return U.apply(this,arguments)}function U(){return(U=(0,T.A)(function*(p,I,F){const S=yield h(p,I,F);return 0===S.length?null:Math.min.apply(Math,S)})).apply(this,arguments)}function t(p,I,F){return n.apply(this,arguments)}function n(){return(n=(0,T.A)(function*(p,I,F){const S=yield h(p,I,F);return 0===S.length?null:Math.max.apply(Math,S)})).apply(this,arguments)}function l(p,I,F){return s.apply(this,arguments)}function s(){return(s=(0,T.A)(function*(p,I,F){let S="";I&&!(0,P.DA)(I)&&(S=(0,P.IY)(I,p.fields));const k=yield h(p,I,F);if(0===k.length)return null;const C=x(k);return null===C?C:"integer"===S?function O(p){return p=+p,isFinite(p)?p-p%1||(p<0?-0:0===p?p:0):p}(C):C})).apply(this,arguments)}function u(p,I,F){return c.apply(this,arguments)}function c(){return(c=(0,T.A)(function*(p,I,F){const S=yield h(p,I,F);return 0===S.length?null:m(S)})).apply(this,arguments)}function v(p,I,F){return E.apply(this,arguments)}function E(){return(E=(0,T.A)(function*(p,I,F){const S=yield h(p,I,F);return 0===S.length?null:Math.sqrt(m(S))})).apply(this,arguments)}function G(p,I,F){return B.apply(this,arguments)}function B(){return(B=(0,T.A)(function*(p,I,F){const S=yield h(p,I,F);return 0===S.length?null:function _(p){let I=0;for(let F=0;F<p.length;F++)I+=p[F];return I}(S)})).apply(this,arguments)}function o(p,I){return i.apply(this,arguments)}function i(){return(i=(0,T.A)(function*(p,I){return p.iterator(I).count()})).apply(this,arguments)}function h(p,I,F){return d.apply(this,arguments)}function d(){return(d=(0,T.A)(function*(p,I,F){const S=p.iterator(F),k=[],C={ticker:0};let K=yield S.next();for(;null!==K;){if(C.ticker++,F.aborted)throw new f.dr(f.D_.Cancelled);C.ticker%100==0&&(C.ticker=0,yield new Promise($=>{setTimeout($,0)}));const W=I?.calculateValue(K);null===W||(k[k.length]=W instanceof w.n||W instanceof R.k?W.toNumber():W instanceof z.g?W.toMilliseconds():W),K=yield S.next()}return k})).apply(this,arguments)}function g(p,I){return M.apply(this,arguments)}function M(){return(M=(0,T.A)(function*(p,I,F=1e3,S=null){const k=p.iterator(S),C=[],K={},W={ticker:0};let $=yield k.next();for(;null!==$;){if(W.ticker++,S?.aborted)throw new f.dr(f.D_.Cancelled);W.ticker%100==0&&(W.ticker=0,yield new Promise(Q=>{setTimeout(Q,0)}));const J=I?.calculateValue($);let H=J;if(J instanceof w.n?H="!!DATEONLY!!-"+J.toString():J instanceof z.g?H="!!TSOFFSETONLY!!-"+J.toString():J instanceof R.k?H="!!TIMEONLY!!-"+J.toString():J instanceof Date&&(H="!!DATE!!-"+J.toString()),null!=J&&void 0===K[H]&&(C.push(J),K[H]=1),C.length>=F&&-1!==F)return C;$=yield k.next()}return C})).apply(this,arguments)}},45211:(Y,j,A)=>{A.d(j,{C:()=>R});var T=A(10467),f=A(19284);let y,P,w=!1;function R(x,Z){return O.apply(this,arguments)}function O(){return(O=(0,T.A)(function*(x,Z){return w?P.apply("invokeGeometryOp",[x,Z]):(yield function z(){return y??=(0,f.ho)("arcadeGeometryOperatorsWorker").then(x=>{P=x,w=!0,y=void 0})}(),R(x,Z))})).apply(this,arguments)}}}]);