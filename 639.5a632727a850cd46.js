"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[639],{23506:(F,x,a)=>{a.d(x,{v:()=>h});var y=a(99305);function h(L){L?.writtenProperties&&L.writtenProperties.forEach(({target:E,propName:A,newOrigin:c})=>{(0,y.H)(E)&&c&&E.originOf(A)!==c&&E.updateOrigin(A,c)})}},99305:(F,x,a)=>{function y(h){return h&&"getAtOrigin"in h&&"originOf"in h}a.d(x,{H:()=>y})},90639:(F,x,a)=>{a.r(x),a.d(x,{save:()=>Oe,saveAll:()=>xe,saveAllAs:()=>Te,saveAs:()=>Ie});var y=a(10467),h=a(89952),E=(a(3248),a(5922)),A=a(23506),c=a(17994),P=a(68438),U=a(23154),g=a(58443),v=a(15764),d=a(69927);const I="Feature Service",D="feature-layer-utils",K=`${D}-save`,z=`${D}-save-as`,j=`${D}-saveall`,B=`${D}-saveall-as`;function N(e){return{isValid:(0,g.W_)(e)&&(!("dynamicDataSource"in e)||!e.dynamicDataSource),errorMessage:"Feature layer should be a layer or table in a map or feature service"}}function $(e,t){const r=(0,v.m)(e,"portal-item");return t?.isTable&&(r.layerContainerType="tables"),r}function Y(e){const t=$(e),r=$(e);return r.layerContainerType="tables",{forLayers:t,forTables:r}}function Q(e){const t=[],r=[];for(const{layer:n,layerJSON:u}of e)n.isTable?r.push(u):t.push(u);return{layers:t,tables:r}}function G(e){return Q([e])}function H(e,t){return W.apply(this,arguments)}function W(){return(W=(0,y.A)(function*(e,t){return/\/\d+\/?$/.test(e.url)?G(t[0]):X(t,e)})).apply(this,arguments)}function X(e,t){return w.apply(this,arguments)}function w(){return w=(0,y.A)(function*(e,t){if(e.reverse(),!t)return Q(e);const r=yield function o(e,t){return i.apply(this,arguments)}(t,e);for(const n of e)ue(n.layer,n.layerJSON,r);return function T(e,t){const r=[],n=[];for(const{layer:u}of t){const{isTable:s,layerId:l}=u;s?n.push(l):r.push(l)}M(e.layers,r),M(e.tables,n)}(r,e),r}),w.apply(this,arguments)}function i(){return i=(0,y.A)(function*(e,t){let r=yield e.fetchData("json");if(function m(e){return!!(e&&Array.isArray(e.layers)&&Array.isArray(e.tables))}(r))return r;r||={},function p(e){e.layers||=[],e.tables||=[]}(r);const{layer:{url:n,customParameters:u,apiKey:s}}=t[0];return yield function J(e,t,r){return _.apply(this,arguments)}(r,{url:n??"",customParameters:u,apiKey:s},t.map(l=>l.layer.layerId)),r}),i.apply(this,arguments)}function M(e,t){if(e.length<2)return;const r=[];for(const{id:n}of e)r.push(n);(0,h.aI)(r.sort(S),t.slice().sort(S))&&e.sort((n,u)=>{const s=t.indexOf(n.id),l=t.indexOf(u.id);return s<l?-1:s>l?1:0})}function S(e,t){return e<t?-1:e>t?1:0}function _(){return _=(0,y.A)(function*(e,t,r){const{url:n,customParameters:u,apiKey:s}=t,{serviceJSON:l,layersJSON:f}=yield(0,U.Q)(n,{customParameters:u,apiKey:s}),O=C(e.layers,l.layers,r),R=C(e.tables,l.tables,r);e.layers=O.itemResources,e.tables=R.itemResources;const Z=[...O.added,...R.added],Ue=f?[...f.layers,...f.tables]:[];yield function V(e,t,r,n){return b.apply(this,arguments)}(e,Z,n,Ue)}),_.apply(this,arguments)}function C(e,t,r){const n=(0,h.iv)(e,t,(s,l)=>s.id===l.id);e=e.filter(s=>!n.removed.some(l=>l.id===s.id));const u=n.added;return u.forEach(({id:s})=>{e.push({id:s})}),{itemResources:e,added:u.filter(({id:s})=>!r.includes(s))}}function b(){return b=(0,y.A)(function*(e,t,r,n){const u=yield function de(e){return k.apply(this,arguments)}(t),s=t.map(({id:l,type:f})=>new(u.get(f))({url:r,layerId:l,sourceJSON:n.find(({id:O})=>O===l)}));yield Promise.allSettled(s.map(l=>l.load())),s.forEach(l=>{const{layerId:f,loaded:O,defaultPopupTemplate:R}=l;if(!O||null==R)return;const Z={id:f,popupInfo:R.toJSON()};"ArcGISFeatureLayer"!==l.operationalLayerType&&(Z.layerType=l.operationalLayerType),ue(l,Z,e)})}),b.apply(this,arguments)}function k(){return(k=(0,y.A)(function*(e){const t=[];e.forEach(({type:u})=>{switch((0,U.K)(u)){case"CatalogLayer":t.push(Promise.all([a.e(1732),a.e(1595),a.e(9377),a.e(8304),a.e(5931),a.e(8294),a.e(370)]).then(a.bind(a,78512)).then(s=>s.default));break;case"FeatureLayer":t.push(Promise.all([a.e(1595),a.e(4792),a.e(5940),a.e(2117)]).then(a.bind(a,35940)).then(s=>s.default));break;case"OrientedImageryLayer":t.push(Promise.all([a.e(1595),a.e(4792),a.e(5940),a.e(9795)]).then(a.bind(a,77775)).then(s=>s.default))}});const r=yield Promise.all(t),n=new Map;return e.forEach(({type:u},s)=>{n.set(u,r[s])}),n})).apply(this,arguments)}function ue(e,t,r){!function pe(e,t){const r=e.findIndex(({id:n})=>n===t.id);-1===r?e.push(t):e[r]=t}(e.isTable?r.tables:r.layers,t)}function me(e,t){if(!e.length)throw new E.A(`${t}:missing-parameters`,"'layers' array should contain at least one feature layer")}function ye(e,t){const r=e.map(n=>n.layerId);if(new Set(r).size!==r.length)throw new E.A(`${t}:invalid-parameters`,"'layers' array should contain only one instance each of layer or table in a feature service")}function q(){return(q=(0,y.A)(function*(e){me(e,j),yield Promise.all(e.map(t=>t.load()));for(const t of e)(0,c.Y)(t,j,N),(0,c.eP)({layer:t,itemType:I,errorNamePrefix:j});(function fe(e,t){const r=e.map(n=>n.portalItem.id);if(new Set(r).size>1)throw new E.A(`${t}:invalid-parameters`,"All layers in the 'layers' array should be loaded from the same portal item")})(e,j),ye(e,j)})).apply(this,arguments)}function ee(e,t){let r=0,n=0,u=0;for(const{layerType:s}of[...t.layers,...t.tables])switch(s){case"OrientedImageryLayer":r++;break;case"SubtypeGroupLayer":n++;break;case"SubtypeGroupTable":u++}(0,d.Sm)(e,d.mm.ORIENTED_IMAGERY_LAYER,r>0),(0,d.Sm)(e,d.mm.SUBTYPE_GROUP_LAYER,n>0),(0,d.Sm)(e,d.mm.SUBTYPE_GROUP_TABLE,u>0)}function ce(e,t,r){(0,d.OM)(t,d.mm.METADATA),(0,d.Sm)(t,d.mm.MULTI_LAYER,e.length>1),(0,d.Sm)(t,d.mm.SINGLE_LAYER,1===e.length),(0,d.Sm)(t,d.mm.TABLE,r.tables.length>0&&0===r.layers.length),ee(t,r)}function he(e,t,r){return te.apply(this,arguments)}function te(){return(te=(0,y.A)(function*(e,t,r){ee(t,r)})).apply(this,arguments)}function Pe(e,t,r){return re.apply(this,arguments)}function re(){return(re=(0,y.A)(function*(e,t,r){const{url:n,layerId:u,title:s,fullExtent:l,isTable:f}=e,O=(0,P.qg)(n);t.url=("FeatureServer"===O?.serverType?n:`${n}/${u}`)??null,t.title||=s,t.extent=null,f||null==l||(t.extent=yield(0,d.sQ)(l)),ce([e],t,r)})).apply(this,arguments)}function ne(){return(ne=(0,y.A)(function*(e){me(e,B),yield Promise.all(e.map(t=>t.load()));for(const t of e)(0,c.Y)(t,B,N);(function Ee(e,t){for(const s of e){const l=s.parsedUrl.path,f=(0,P.qg)(l);if(!f?.url.path)throw new E.A(`${t}:invalid-parameters`,(0,c.Gy)(s,`has unsupported url pattern: ${l}`),{layer:s});const R=f?.serverType;if("FeatureServer"!==R&&"MapServer"!==R)throw new E.A(`${t}:invalid-parameters`,(0,c.Gy)(s,`has unsupported server type: ${R}`),{layer:s});if("MapServer"===R&&e.length>1)throw new E.A(`${t}:invalid-parameters`,"Only one layer or table in a map service can be saved")}const r=(0,P.qg)(e[0].parsedUrl.path),n=r?.url.path;if(!e.every(s=>(0,P.qg)(s.parsedUrl.path)?.url.path===n))throw new E.A(`${t}:invalid-parameters`,"'layers' array should only contain layers or tables that belong to the same feature service")})(e,B),ye(e,B)})).apply(this,arguments)}function ae(){return(ae=(0,y.A)(function*(e,t,r){let n=0;for(const{isTable:l}of e)l||n++;const u=e[0].parsedUrl.path,s=(0,P.qg)(u);if(t.url="FeatureServer"===s?.serverType?s.url.path:u,t.title||=s.title,t.extent=null,n>0){const l=e.map(f=>f.fullExtent).filter(h.Ru).reduce((f,O)=>f.clone().union(O));l&&(t.extent=yield(0,d.sQ)(l))}ce(e,t,r),(0,c.Y9)(t)})).apply(this,arguments)}function Oe(e,t){return oe.apply(this,arguments)}function oe(){return(oe=(0,y.A)(function*(e,t){return(0,c.UN)({layer:e,itemType:I,validateLayer:N,createJSONContext:r=>$(r,e),createItemData:(r,n)=>H(n,[r]),errorNamePrefix:K,setItemProperties:he},t)})).apply(this,arguments)}function xe(e,t){return se.apply(this,arguments)}function se(){return se=(0,y.A)(function*(e,t){yield function _e(e){return q.apply(this,arguments)}(e);const r=e[0].portalItem,n=Y(r),u=yield Promise.all(e.map(l=>(0,c.CJ)(l,l.isTable?n.forTables:n.forLayers,t))),s=yield H(r,e.map((l,f)=>({layer:l,layerJSON:u[f]})));return function Ae(e,t){ee(e,t),(0,c.Y9)(e)}(r,s),yield r.update({data:s}),yield Promise.all(e.slice(1).map(l=>l.portalItem.reload())),(0,A.v)(n.forLayers),(0,A.v)(n.forTables),r.clone()}),se.apply(this,arguments)}function Ie(e,t,r){return le.apply(this,arguments)}function le(){return(le=(0,y.A)(function*(e,t,r){return(0,c.Uh)({layer:e,itemType:I,validateLayer:N,createJSONContext:n=>$(n,e),createItemData:(n,u)=>Promise.resolve(G(n)),errorNamePrefix:z,newItem:t,setItemProperties:Pe},r)})).apply(this,arguments)}function Te(e,t,r){return ie.apply(this,arguments)}function ie(){return ie=(0,y.A)(function*(e,t,r){yield function ve(e){return ne.apply(this,arguments)}(e);const n=(0,c.Y0)({itemType:I,errorNamePrefix:B,newItem:t}),u=Y(n),s=yield Promise.all(e.map(f=>(0,c.CJ)(f,f.isTable?u.forTables:u.forLayers,r))),l=yield X(e.map((f,O)=>({layer:f,layerJSON:s[O]})));yield function ge(e,t,r){return ae.apply(this,arguments)}(e,n,l),yield(0,c.B5)(n,l,r);for(const f of e)f.portalItem=n.clone();return(0,A.v)(u.forLayers),(0,A.v)(u.forTables),n}),ie.apply(this,arguments)}},17994:(F,x,a)=>{a.d(x,{B5:()=>Q,CJ:()=>N,Gy:()=>I,UN:()=>H,Uh:()=>X,Y:()=>g,Y0:()=>j,Y9:()=>Y,eP:()=>z});var y=a(10467),h=a(5922),L=a(23506),E=a(73874),A=a(46577),c=a(15764),P=a(69927),U=a(95945);function g(o,i,m){const p=m(o);if(!p.isValid)throw new h.A(`${i}:invalid-parameters`,p.errorMessage,{layer:o})}function v(o){return d.apply(this,arguments)}function d(){return(d=(0,y.A)(function*(o){const{layer:i,errorNamePrefix:m,validateLayer:p}=o;yield i.load(),g(i,m,p)})).apply(this,arguments)}function I(o,i){return`Layer (title: ${o.title}, id: ${o.id}) of type '${o.declaredClass}' ${i}`}function D(o){const{item:i,errorNamePrefix:m,layer:p,validateItem:T}=o;if(function K(o){const{item:i,itemType:m,additionalItemType:p,errorNamePrefix:T,layer:M}=o,S=[m];if(p&&S.push(p),!S.includes(i.type)){const J=S.map(_=>`'${_}'`).join(", ");throw new h.A(`${T}:portal-item-wrong-type`,`Portal item type should be one of: "${J}"`,{item:i,layer:M})}}(o),T){const M=T(i);if(!M.isValid)throw new h.A(`${m}:invalid-parameters`,M.errorMessage,{layer:p})}}function z(o){const{layer:i,errorNamePrefix:m}=o,{portalItem:p}=i;if(!p)throw new h.A(`${m}:portal-item-not-set`,I(i,"requires the portalItem property to be set"));if(!p.loaded)throw new h.A(`${m}:portal-item-not-loaded`,I(i,"cannot be saved to a portal item that does not exist or is inaccessible"));D({...o,item:p})}function j(o){const{newItem:i,itemType:m}=o;let p=A.default.from(i);return p.id&&(p=p.clone(),p.id=null),p.type??=m,p.portal??=E.A.getDefault(),D({...o,item:p}),p}function B(o){return(0,c.m)(o,"portal-item")}function N(o,i,m){return $.apply(this,arguments)}function $(){return($=(0,y.A)(function*(o,i,m){"beforeSave"in o&&"function"==typeof o.beforeSave&&(yield o.beforeSave());const p=o.write({},i);return yield Promise.all(i.resources?.pendingOperations??[]),(0,U.c)(i,{errorName:"layer-write:unsupported"},m),p})).apply(this,arguments)}function Y(o){(0,P.LG)(o,P.mm.JSAPI),o.typeKeywords&&(o.typeKeywords=o.typeKeywords.filter((i,m,p)=>p.indexOf(i)===m))}function Q(o,i,m){return G.apply(this,arguments)}function G(){return(G=(0,y.A)(function*(o,i,m){const p=o.portal;yield p.signIn(),yield p.user.addItem({item:o,data:i,folder:m?.folder})})).apply(this,arguments)}function H(o,i){return W.apply(this,arguments)}function W(){return(W=(0,y.A)(function*(o,i){const{layer:m,createItemData:p,createJSONContext:T,setItemProperties:M,saveResources:S,supplementalUnsupportedErrors:J}=o;yield v(o),z(o);const _=m.portalItem,C=T?T(_):B(_),V=yield N(m,C,{...i,supplementalUnsupportedErrors:J}),b=yield p({layer:m,layerJSON:V},_);return yield M?.(m,_,b),Y(_),yield _.update({data:b}),(0,L.v)(C),yield S?.(_,C),_})).apply(this,arguments)}function X(o,i){return w.apply(this,arguments)}function w(){return(w=(0,y.A)(function*(o,i){const{layer:m,createItemData:p,createJSONContext:T,setItemProperties:M,saveResources:S,supplementalUnsupportedErrors:J}=o;yield v(o);const _=j(o),C=T?T(_):B(_),V=yield N(m,C,{...i,supplementalUnsupportedErrors:J}),b=yield p({layer:m,layerJSON:V},_);return yield M(m,_,b),Y(_),yield Q(_,b,i),m.portalItem=_,(0,L.v)(C),yield S?.(_,C),_})).apply(this,arguments)}},15764:(F,x,a)=>{a.d(x,{m:()=>E,v:()=>L});var y=a(45272),h=a(73874);function L(c,P){return{...A(c,P),readResourcePaths:[]}}function E(c,P,U){const g=(0,y.An)(c.itemUrl);return{...A(c,P),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:g?{rootPath:g.path,writtenUrls:[]}:null,resources:U?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function A(c,P){return{origin:P,url:(0,y.An)(c.itemUrl),portal:c.portal||h.A.getDefault(),portalItem:c}}},95945:(F,x,a)=>{a.d(x,{c:()=>c,d:()=>L});var y=a(10467),h=a(5922);function L(P){return E.apply(this,arguments)}function E(){return(E=(0,y.A)(function*(P){const U=[];for(const g of P.allLayers)if("beforeSave"in g&&"function"==typeof g.beforeSave){const v=g.beforeSave();v&&U.push(v)}yield Promise.allSettled(U)})).apply(this,arguments)}const A=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function c(P,U,g){let v=(P.messages??[]).filter(({type:d})=>"error"===d).map(({name:d,message:I,details:D})=>new h.A(d,I,D));if(P.blockedRelativeUrls&&(v=v.concat(P.blockedRelativeUrls.map(d=>new h.A("url:unsupported",`Relative url '${d}' is not supported`)))),g){const{ignoreUnsupported:d,supplementalUnsupportedErrors:I=[],requiredPropertyChecksDisabled:D}=g;d&&(v=v.filter(({name:K})=>!(A.has(K)||I.includes(K)))),D&&(v=v.filter(K=>"web-document-write:property-required"!==K.name))}if(v.length>0)throw new h.A(U.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:v})}}}]);