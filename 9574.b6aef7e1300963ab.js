"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[9574],{33096:($t,Mt,s)=>{s.d(Mt,{a:()=>it,b:()=>bt,d:()=>Y,f:()=>Q,g:()=>ht,h:()=>Tt,u:()=>O}),s(3248);var W=s(35150),F=s(69287),K=s(84149),j=s(92771),E=s(62789),c=s(28714),B=s(25866),Yt=s(51995),$=s(41510),ct=s(71548),_=s(93617),Vt=s(55703),et=s(99608),S=s(19741);const _t=()=>W.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function Y(i=z){return{plane:(0,_.vt)(i.plane),origin:(0,B.o8)(i.origin),basis1:(0,B.o8)(i.basis1),basis2:(0,B.o8)(i.basis2)}}function it(i,n=Y()){return Q(i.origin,i.basis1,i.basis2,n)}function Q(i,n,a,h=Y()){return(0,c.c)(h.origin,i),(0,c.c)(h.basis1,n),(0,c.c)(h.basis2,a),O(h),function R(i,n){Math.abs((0,c.f)(i.basis1,i.basis2)/((0,c.l)(i.basis1)*(0,c.l)(i.basis2)))>1e-6&&_t().warn(n,"Provided basis vectors are not perpendicular"),Math.abs((0,c.f)(i.basis1,H(i)))>1e-6&&_t().warn(n,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,c.f)(H(i),i.origin)-i.plane[3])>1e-6&&_t().warn(n,"Plane offset is not consistent with plane origin")}(h,"fromValues()"),h}function O(i){(0,_.mR)(i.basis2,i.basis1,i.origin,i.plane)}function At(i,n,a){i!==a&&it(i,a);const h=(0,c.h)(S.rq.get(),H(i),n);return(0,c.g)(a.origin,a.origin,h),a.plane[3]-=n,a}function ht(i,n=Y()){const a=(i[2]-i[0])/2,h=(i[3]-i[1])/2;return(0,c.i)(n.origin,i[0]+a,i[1]+h,0),(0,c.i)(n.basis1,a,0,0),(0,c.i)(n.basis2,0,h,0),(0,_.fA)(0,0,1,0,n.plane),n}function dt(i,n,a){return!!(0,_.Ui)(i.plane,n,a)&&at(i,a)}function pt(i,n,a){const h=vt.get();xt(i,n,h,vt.get());let m=Number.POSITIVE_INFINITY;for(const f of Et){const w=u(i,f,nt.get()),P=S.rq.get();if((0,_.T7)(h,w,P)){const C=(0,c.o)(S.rq.get(),n.origin,P),U=Math.abs((0,F.XM)((0,c.f)(n.direction,C)));U<m&&(m=U,(0,c.c)(a,P))}}return m===Number.POSITIVE_INFINITY?Z(i,n,a):a}function Z(i,n,a){if(dt(i,n,a))return a;const h=vt.get(),m=vt.get();xt(i,n,h,m);let f=Number.POSITIVE_INFINITY;for(const w of Et){const P=u(i,w,nt.get()),C=S.rq.get();if((0,_.gv)(h,P,C)){const U=(0,Vt.kb)(n,C);if(!(0,_.Tj)(m,C))continue;U<f&&(f=U,(0,c.c)(a,C))}}return ft(i,n.origin)<f&&ut(i,n.origin,a),a}function ut(i,n,a){const h=(0,_._I)(i.plane,n,S.rq.get()),m=(0,ct.H6)(gt(i,i.basis1),h,-1,1,S.rq.get()),f=(0,ct.H6)(gt(i,i.basis2),h,-1,1,S.rq.get());return(0,c.d)(a,(0,c.g)(S.rq.get(),m,f),i.origin),a}function k(i,n,a){const{origin:h,basis1:m,basis2:f}=i,w=(0,c.d)(S.rq.get(),n,h),P=(0,et.gr)(m,w),C=(0,et.gr)(f,w),U=(0,et.gr)(H(i),w);return(0,c.i)(a,P,C,U)}function ft(i,n){const a=k(i,n,S.rq.get()),{basis1:h,basis2:m}=i,f=(0,c.l)(h),w=(0,c.l)(m),P=Math.max(Math.abs(a[0])-f,0),C=Math.max(Math.abs(a[1])-w,0),U=a[2];return P*P+C*C+U*U}function Tt(i,n){return Math.sqrt(ft(i,n))}function L(i,n){const a=-i.plane[3];return(0,et.gr)(H(i),n)-a}function H(i){return(0,_.Qj)(i.plane)}function at(i,n){const a=(0,c.d)(S.rq.get(),n,i.origin),h=(0,c.k)(i.basis1),m=(0,c.k)(i.basis2),f=(0,c.f)(i.basis1,a),w=(0,c.f)(i.basis2,a);return-f-h<0&&f-h<0&&-w-m<0&&w-m<0}function gt(i,n){const a=nt.get();return(0,c.c)(a.origin,i.origin),(0,c.c)(a.vector,n),a}function u(i,n,a){const{basis1:h,basis2:m,origin:f}=i,w=(0,c.h)(S.rq.get(),h,n.origin[0]),P=(0,c.h)(S.rq.get(),m,n.origin[1]);(0,c.g)(a.origin,w,P),(0,c.g)(a.origin,a.origin,f);const C=(0,c.h)(S.rq.get(),h,n.direction[0]),U=(0,c.h)(S.rq.get(),m,n.direction[1]);return(0,c.h)(a.vector,(0,c.g)(C,C,U),2),a}function xt(i,n,a,h){const m=H(i);(0,_.mR)(m,n.direction,n.origin,a),(0,_.mR)((0,_.Qj)(a),m,n.origin,h)}const z={plane:(0,_.vt)(),origin:(0,B.fA)(0,0,0),basis1:(0,B.fA)(1,0,0),basis2:(0,B.fA)(0,1,0)},vt=new K.I(_.vt),nt=new K.I(ct.vt),Ot=(0,B.vt)(),Ut=new K.I(()=>Y()),Et=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],tt=(0,E.vt)(),Pt=(0,E.vt)(),bt=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class Ht{constructor(){this.plane=(0,_.vt)(),this.origin=(0,B.vt)(),this.basis1=(0,B.vt)(),this.basis2=(0,B.vt)()}},altitudeAt:L,axisAt:function Rt(i,n,a,h){return function Ct(i,n,a){switch(n){case $._.X:(0,c.c)(a,i.basis1),(0,c.n)(a,a);break;case $._.Y:(0,c.c)(a,i.basis2),(0,c.n)(a,a);break;case $._.Z:(0,c.c)(a,H(i))}return a}(i,a,h)},cameraFrustumCoverage:function ot(i,n){return(n-i)/n},closestPoint:Z,closestPointOnSilhouette:pt,copy:it,copyWithoutVerify:function J(i,n){(0,c.c)(n.origin,i.origin),(0,c.c)(n.basis1,i.basis1),(0,c.c)(n.basis2,i.basis2),(0,_.C)(n.plane,i.plane)},create:Y,distance:Tt,distance2:ft,distanceToSilhouette:function Zt(i,n){let a=Number.NEGATIVE_INFINITY;for(const h of Et){const m=u(i,h,nt.get()),f=(0,ct.kb)(m,n);f>a&&(a=f)}return Math.sqrt(a)},elevate:At,equals:function Nt(i,n){return(0,c.p)(i.basis1,n.basis1)&&(0,c.p)(i.basis2,n.basis2)&&(0,c.p)(i.origin,n.origin)},extrusionContainsPoint:function Gt(i,n){return(0,_.Tj)(i.plane,n)&&at(i,n)},fromAABoundingRect:ht,fromValues:Q,getExtent:function mt(i,n){const a=i.basis1[0],h=i.basis2[1],[m,f]=i.origin;return(0,Yt.fA)(m-a,f-h,m+a,f+h,n)},intersectRay:dt,intersectRayClosestSilhouette:function yt(i,n,a){if(dt(i,n,a))return a;const h=pt(i,n,S.rq.get());return(0,c.g)(a,n.origin,(0,c.h)(S.rq.get(),n.direction,(0,c.j)(n.origin,h)/(0,c.l)(n.direction))),a},normal:H,projectPoint:ut,projectPointLocal:k,rotate:function V(i,n,a,h){return i!==h&&it(i,h),(0,j.$0)(Pt,n,a),(0,c.t)(h.basis1,i.basis1,Pt),(0,c.t)(h.basis2,i.basis2,Pt),O(h),h},setAltitudeAt:function zt(i,n,a,h){const m=L(i,n),f=(0,c.h)(Ot,H(i),a-m);return(0,c.g)(h,n,f),h},setExtent:function q(i,n,a){return ht(n,a),At(a,L(i,i.origin),a),a},transform:function wt(i,n,a){return i!==a&&it(i,a),(0,j.B8)(tt,n),(0,j.mg)(tt,tt),(0,c.t)(a.basis1,i.basis1,tt),(0,c.t)(a.basis2,i.basis2,tt),(0,c.t)((0,_.Qj)(a.plane),(0,_.Qj)(i.plane),tt),(0,c.t)(a.origin,i.origin,n),(0,_.mP)(a.plane,a.plane,a.origin),a},up:z,updateUnboundedPlane:O,wrap:function Bt(i,n,a){const h=Ut.get();return h.origin=i,h.basis1=n,h.basis2=a,h.plane=(0,_.LV)(0,0,0,0),O(h),h}},Symbol.toStringTag,{value:"Module"}))},69574:($t,Mt,s)=>{s.r(Mt),s.d(Mt,{ControlPointsTransformTool:()=>V,DrawGraphicTool2D:()=>J,MediaTransformToolsWrapper:()=>X,TransformTool:()=>I});var y=s(8189),W=s(81098),F=s(17715),K=s(11432),j=s(48900),E=s(85211),$=(s(3248),s(35150),s(40707),s(76576)),ct=s(21870),_=s(1749),Vt=s(11911),et=s(81279),S=s(46602);const _t=new et.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),Ht=new S.A({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),jt=new S.A({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var Y=s(34098),Bt=s(68104),it=s(74502);let J=class extends Y.N{constructor(t){super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:t.activeLineSymbol??_t,regularVertices:t.regularVerticesSymbol??Ht,activeVertex:t.activeVertexSymbol??jt,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles((0,j.wB)(()=>this.view?.effectiveTheme?.accentColor,e=>{if(!e)return;const o=this._visualElementSymbols.activeVertex.clone().set({color:e});this._visualElementGraphics.activeVertex?.set("symbol",o),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:o}},j.Vh))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return null!=this._visualElementSymbols.fill&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(Q),(0,F.hA)()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:o}=this;return this._createOrUpdateGraphic(null),new Bt.O0({view:o,manipulators:this.manipulators,geometryType:(0,Y.l)(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new it.uF(o,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new Vt.J(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){if("point"===this.geometryType)return(0,F.hA)();const[e,o]=t,d=new _.A({x:e,y:o,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=d,(0,F.hA)()):(this._visualElementGraphics.activeVertex=new W.A({geometry:d,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(Q),(0,F.hA)(()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,K.pR)(this._visualElementGraphics.activeVertex))}))}onCursorEdgeChanged(t){return null!=this._visualElementGraphics.activeEdge?(this._visualElementGraphics.activeEdge.geometry=t,(0,F.hA)()):(this._visualElementGraphics.activeEdge=new W.A({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(Q),(0,F.hA)(()=>{null!=this._visualElementGraphics.activeEdge&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=(0,K.pR)(this._visualElementGraphics.activeEdge))}))}onRegularVerticesChanged(t){const e=new ct.A({points:t,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=e,(0,F.hA)()):(this._visualElementGraphics.regularVertices=new W.A({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(Q),(0,F.hA)(()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,K.pR)(this._visualElementGraphics.regularVertices))}))}};function Q(t,e){return(t.attributes?.displayOrder??-1/0)-(e.attributes?.displayOrder??-1/0)}(0,y._)([(0,E.MZ)()],J.prototype,"activeFillSymbol",void 0),(0,y._)([(0,E.MZ)({readOnly:!0})],J.prototype,"type",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0,nonNullable:!0})],J.prototype,"view",void 0),J=(0,y._)([(0,$.$)("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],J);var ot,t,O=s(10467),At=s(68677),q=s(13970),mt=s(58701),ht=s(36819),dt=s(76926),yt=s(23191);class pt{get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(o=>o===e)}someManipulator(e){let o=!1;return this.forEachManipulator(d=>{!o&&e(d)&&(o=!0)}),o}}(t=ot||(ot={}))[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE";var Z=s(68736),ut=s(79338),k=s(3969),ft=s(93549);class Tt extends pt{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator(o=>this._tool.manipulators.add(o))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(e){e(this._manipulator,ot.TRANSLATE_XY)}createDragPipeline(e,o){let d=null,r=null,l=0,v=0,p=0;const{offsetX:g,offsetY:b,size:A}=(0,ft.T)(this._graphic.symbol);return(0,Z.Xt)(this._manipulator,(G,rt)=>{rt.next(x=>{if("start"===x.action){const T=e();d=T.editGeometryOperations,r=T.constraints}return x}).next((0,Z.y$)(this._view)).next(x=>{const{x:T,y:M,z:D}=x.mapEnd;if(r&&(T+g<r.xmin||M+b-A<r.ymin||T+g>r.xmax||M+b-A>r.ymax))return x;("start"===x.action||0===l&&0===v&&0===p)&&(l=x.mapStart.x,v=x.mapStart.y,p=x.mapStart.z);const N=T-l,St=M-v,st=D-p;l=T,v=M,p=D;const Lt=d.move(N,St,st,"start"===x.action?k.Y.NEW_STEP:k.Y.ACCUMULATE_STEPS);return o(x,Lt),x})})}_createManipulator(){return new ut.l({view:this._view,graphic:this._graphic,selectable:!0,cursor:"move"})}}var Zt=s(75682),Gt=s(97167),Rt=s(63938);const L_primaryKey=Zt.i,wt=new At.A("#009af2");let V=class extends Gt.g{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new ht.A({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach(e=>e.destroy()),this._controlPointEditGeometryOperations.forEach(e=>e.destroy()),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,K.pR)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return(0,mt.fn)(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if(null==t.georeference)return;const e=t.georeference;"control-points"===e.type&&null!=e.coords&&(this._georeference=e,this._georeference.controlPoints.forEach(({mapPoint:o},d)=>{const r=this._controlPointEditGeometryOperations[d];r.setVertexPosition(r.data.components[0].vertices[0],r.data.coordinateHelper.pointToVector(o))}),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=t.controlPoints,o=e[0].mapPoint.spatialReference,d=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map((r,l)=>{const v=r.data.geometry;return this._controlPointGraphics[l].geometry=v,{mapPoint:(0,q.project)(v,o),sourcePoint:d?e[l].sourcePoint:t.toSource(v)}})}updateActiveHandle(t){if(this.activeHandle===t)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();(0,dt.Fe)(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const o=this._controlPointGraphics[t].symbol.clone();(0,dt.Fe)(o,wt),this._controlPointGraphics[t].symbol=o,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}highlightActiveHandle(){var t=this;return(0,O.A)(function*(){t.removeHighlightActiveHandle();const e=yield t.view.whenLayerView(t._graphicsLayer);t._highlightHandle=e.highlight(t._controlPointGraphics[t.activeHandle])})()}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}_initialize(){var t=this;return(0,O.A)(function*(){const{view:e,mediaElement:o}=t;if(null==o.georeference)return;const d=o.georeference;"control-points"===d.type&&null!=d.coords&&(t._georeference=d,t._initialControlPoints=t._georeference.controlPoints,e.map.addMany([t._graphicsLayer]),e.focus(),t.visible=!1,t.finishToolCreation(),yield t._loadProjectionEngine(),t._controlPointEditGeometryOperations=t._georeference.controlPoints.map(({mapPoint:r})=>Rt.p.fromGeometry((0,q.project)(r,e.spatialReference),yt.RT.Local)),t._controlPointGraphics=t._controlPointEditGeometryOperations.map((r,l)=>new W.A({symbol:new et.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:l===t.activeHandle?wt.toArray():t.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:r.data.geometry})),t._graphicsLayer.graphics.addMany([...t._controlPointGraphics]),t._controlPointManipulations=t._controlPointGraphics.map(r=>new Tt({tool:t,view:e,graphic:r})),t.addHandles([...t._controlPointManipulations.map((r,l)=>r.createDragPipeline(t._getInfo.bind(t,l),(v,p)=>{"start"===v.action&&(t._undoStack.push(l),t._redoStack=[],t._sharedUndoStack.push({tool:t,operation:p}),t._sharedRedoStack.length=0),t.updateGraphics()})),(0,j.wB)(()=>t.view.scale,()=>t.active?t.updateGraphics():null)]),t._controlPointManipulations.forEach((r,l)=>{r.forEachManipulator(p=>{t.addHandles([p.events.on(["click","grab-changed"],g=>t.updateActiveHandle(l))])})}),t.addHandles([e.on("key-down",r=>{e.activeTool===t&&("Shift"!==r.key||r.repeat||(t._isModifierActive=!0,r.stopPropagation()),"t"!==r.key||r.repeat||(o.opacity*=t._isOpacityToggled?2:.5,t._isOpacityToggled=!t._isOpacityToggled,r.stopPropagation()),r.key!==L_primaryKey||r.repeat||(t._factor=10,r.stopPropagation()),t._isModifierActive&&("ArrowUp"===r.key&&(t._move(0,t._factor),r.stopPropagation()),"ArrowDown"===r.key&&(t._move(0,-t._factor),r.stopPropagation()),"ArrowLeft"===r.key&&(t._move(-t._factor,0),r.stopPropagation()),"ArrowRight"===r.key&&(t._move(t._factor,0),r.stopPropagation())))}),e.on("key-up",r=>{e.activeTool===t&&("Shift"===r.key&&(t._isModifierActive=!1,r.stopPropagation()),r.key===L_primaryKey&&(t._factor=1,r.stopPropagation()))})]))})()}_loadProjectionEngine(){var t=this;return(0,O.A)(function*(){return(0,q.initializeProjection)(t._georeference.controlPoints[0].mapPoint.spatialReference,t.view.spatialReference)})()}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const o=this._controlPointEditGeometryOperations[this.activeHandle].move(t*this.view.resolution,e*this.view.resolution,0,k.Y.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:o}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,y._)([(0,E.MZ)()],V.prototype,"_hasValidSpatialReference",null),(0,y._)([(0,E.MZ)()],V.prototype,"activeHandle",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0,nonNullable:!0})],V.prototype,"mediaElement",void 0),(0,y._)([(0,E.MZ)({readOnly:!0})],V.prototype,"type",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0})],V.prototype,"view",void 0),V=(0,y._)([(0,$.$)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],V);var H=s(29430),Ct=s(82663),at=s(83953),gt=s(45475),u=s(28714),R=s(25866),xt=s(55861),z=s(33096),vt=s(88521),nt=s(86807),Ot=s(69287);function Ut(t,e){e.cursor="start"===t.action?"grabbing":"grab"}class Et{constructor(){this._lastDragEvent=null,this.next=new Z.rh,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent){const o={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(o),this.next.execute(o)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const o=0!==e.direction[0]&&0!==e.direction[1]?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-o:o,e.factor2=e.factor2<0?-o:o}}class tt{constructor(){this._lastDragEvent=null,this.next=new Z.rh,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent){const o={...this._lastDragEvent,action:"update"};e&&this._adjustRotateAngle(o),this.next.execute(o)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustRotateAngle(e),e)}_adjustRotateAngle(e){const o=(0,Ot.KJ)(e.rotateAngle);e.rotateAngle=(0,Ot.kU)(5*Math.round(o/5))}}var Pt=s(94137),bt=s(39116),i=s(53950);class n extends pt{constructor(e){super(),this._handles=new nt.A,this._originCache=(0,R.vt)(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._snapRotation=e.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",o=>Ut(o,this._manipulator))]),this.forEachManipulator(o=>this._tool.manipulators.add(o))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(e){e(this._manipulator,ot.ROTATE)}createDragPipeline(e,o){let d=null,r=null;return(0,Z.Xt)(this._manipulator,(l,v)=>{v.next(p=>{if("start"===p.action){l.cursor="grabbing";const g=e();d=g.plane,r=g.editGeometryOperations}return p}).next((0,Z.y$)(this._view)).next(p=>({...p,rotateAngle:(0,Pt.UT)(p.mapStart,p.mapEnd,{x:d.origin[0],y:d.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next(p=>{const g=(0,u.c)(this._originCache,d.origin),A=r.rotate(g,p.rotateAngle,"start"===p.action?k.Y.NEW_STEP:k.Y.ACCUMULATE_STEPS,bt.K.REPLACE);return(0,i.Bb)(A,d),o(p,A),p}).next(p=>("end"===p.action&&(l.cursor="grab"),p))})}_createManipulator(){return new ut.l({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}const h=1e-6;function f(t){const e=(0,u.l)(t.basis1),o=(0,u.l)(t.basis2);return.3*Math.min(e,o)}class w extends pt{constructor(e){super(),this._handles=new nt.A,this._planeStart=(0,z.d)(),this._displayPlaneStart=(0,z.d)(),this._originCache=(0,R.vt)(),this._axisCache=(0,gt.vt)(),this._renderStartCache=(0,R.vt)(),this._renderEndCache=(0,R.vt)(),this._resizeOriginCache=(0,R.vt)(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._direction=e.direction,this._preserveAspectRatio=e.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",o=>Ut(o,this._manipulator))]),this.forEachManipulator(o=>this._tool.manipulators.add(o))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(e){e(this._manipulator,ot.SCALE)}createDragPipeline(e,o){let d=null,r=null,l=null,v=0,p=null,g=null;const b=this._planeStart,A=this._displayPlaneStart,G=this._direction;return(0,Z.Xt)(this._manipulator,(rt,x)=>{x.next(T=>{if("start"===T.action){rt.cursor="grabbing";const M=e();d=M.plane,r=M.displayPlane,l=M.editGeometryOperations,v=10*this._view.resolution,(0,z.a)(d,b),(0,z.a)(r,A);const D=(0,mt.Vp)(l.data.spatialReference);p=D?D.valid[1]-D.valid[0]-30*this._view.resolution:null}return T}).next((0,Z.y$)(this._view)).next(T=>{const M=(0,u.c)(this._renderStartCache,[T.mapStart.x,T.mapStart.y,0]),D=(0,u.c)(this._renderEndCache,[T.mapEnd.x,T.mapEnd.y,0]),N=(0,u.c)(this._resizeOriginCache,A.origin);(0,u.b)(N,N,A.basis1,-G[0]),(0,u.b)(N,N,A.basis2,-G[1]),(0,u.d)(D,D,N),(0,u.d)(M,M,N);const St=0!==G[0]&&0!==G[1],st=f(A),Wt=f(r)/st,Lt=(Ft,Kt)=>{if(0===Ft)return 1;let lt=(0,u.l)(Kt),It=.5*Ft*(0,u.f)(Kt,D)/lt;const kt=It<0?-1:1;St&&(It+=(lt-.5*Ft*(0,u.f)(Kt,M)/lt)*kt*Wt);const re=lt<1.5*v?1:h;return lt=Math.max(lt-v,h),kt>0&&(It-=10*this._view.resolution),kt*Math.max(kt*(It/lt),re)},ae=Lt(G[0],A.basis1),ne=Lt(G[1],A.basis2);return{...T,direction:G,factor1:ae,factor2:ne}}).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(T=>{const M=(0,u.c)(this._originCache,b.origin);(0,u.b)(M,M,b.basis1,-G[0]),(0,u.b)(M,M,b.basis2,-G[1]);const D=(0,at.hZ)(this._axisCache,b.basis1[0],b.basis1[1]);(0,at.S8)(D,D);const N=l.data.allVertices,st=l.scaleVertices(N,M,D,T.factor1,T.factor2,"start"===T.action?k.Y.NEW_STEP:k.Y.ACCUMULATE_STEPS,bt.K.REPLACE);return p&&p<l.data.geometry.extent.width&&g?l.updateVertices(N,g):((0,z.a)(b,d),(0,i.Bb)(st,d),g=st.operation,o(T,st)),T}).next(T=>("end"===T.action&&(rt.cursor="grab"),T))})}_createManipulator(){return new ut.l({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}var P=s(46153),C=s(46175),U=s(94001),Jt=s(77498);const ee=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]];let I=class extends Gt.g{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=(0,z.d)(),this._displayPlaneCache=(0,z.d)(),this._mainAxisCache=(0,gt.vt)(),this._rotationHandleCache=(0,R.vt)(),this._cornerA=(0,R.vt)(),this._cornerB=(0,R.vt)(),this._cornerC=(0,R.vt)(),this._cornerD=(0,R.vt)(),this._avgAB=(0,R.vt)(),this._avgBC=(0,R.vt)(),this._avgCD=(0,R.vt)(),this._avgDA=(0,R.vt)(),this._preserveAspectRatio=new Et,this._snapRotation=new tt,this._graphicsLayer=new ht.A({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=1,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach(e=>e.destroy()),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,K.pR)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const t=this._graphic.geometry;if(null==t)return null;const e=this._editGeometryOperations.data,o=e.components[0].edges[0],d=(0,at.Re)(this._mainAxisCache,o.leftVertex.pos,o.rightVertex.pos);(0,at.S8)(d,d);let r=80*this.view.resolution;const l=this.view.spatialReference;return(0,mt.aI)(l,t.spatialReference)&&(r*=(0,Ct.GA)(l)/(0,Ct.GA)(t.spatialReference)),(0,i.G3)(d,e,r,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;(0,z.a)(t,e);const o=10*this.view.resolution;return(0,u.h)(e.basis1,e.basis1,1+o/(0,u.l)(e.basis1)),(0,u.h)(e.basis2,e.basis2,1+o/(0,u.l)(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new xt.A({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return(0,u.n)(e,t.basis1),(0,u.h)(e,e,30*this.view.resolution),(0,u.g)(e,e,t.origin),(0,u.g)(e,e,t.basis1),new _.A({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:o,_cornerB:d,_cornerC:r,_cornerD:l}=this,v=(0,u.m)(this._avgAB,o,d,.5),p=(0,u.m)(this._avgBC,d,r,.5),g=(0,u.m)(this._avgCD,r,l,.5),b=(0,u.m)(this._avgDA,l,o,.5);return[new _.A({x:o[0],y:o[1],spatialReference:e}),new _.A({x:d[0],y:d[1],spatialReference:e}),new _.A({x:r[0],y:r[1],spatialReference:e}),new _.A({x:l[0],y:l[1],spatialReference:e}),new _.A({x:v[0],y:v[1],spatialReference:e}),new _.A({x:p[0],y:p[1],spatialReference:e}),new _.A({x:g[0],y:g[1],spatialReference:e}),new _.A({x:b[0],y:b[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,d=this._editGeometryOperations,r=d.data.components[0].vertices,l=C.ZE.fromGeometry((0,q.project)("georeference"in e?e.georeference.coords:e.geometry,t.spatialReference),yt.RT.Local).components[0].vertices;r.forEach((v,p)=>{d.setVertexPosition(v,l[p].pos)}),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=t.georeference;"control-points"===e.type&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach((e,o)=>{this._scaleGraphics[o].geometry=e})}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}_initialize(){var t=this;return(0,O.A)(function*(){const{view:e,target:o}=t;if("georeference"in o){const l=o.georeference;t._graphic=new W.A({geometry:l.coords}),t._initialControlPoints="control-points"===l.type?l.controlPoints:null}else t._graphic=o,t._initialGeometry=o.geometry;e.map.addMany([t._graphicsLayer]),e.focus(),t.visible=!1,t.finishToolCreation(),yield t._loadProjectionEngine(),t._editGeometryOperations=Rt.p.fromGeometry((0,q.project)(t._graphic.geometry,e.spatialReference),yt.RT.Local),t._backgroundGraphic=new W.A({symbol:new vt.A({color:"transparent",outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:2}}),geometry:t._backgroundGraphicGeometry}),t._rotateGraphic=new W.A({symbol:new S.A({color:(0,H.bJ)(e.effectiveTheme.accentColor),outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:1}}),geometry:t._rotateGraphicGeometry}),t._scaleGraphics=t._scaleGraphicGeometries.map(l=>new W.A({symbol:new S.A({size:6,style:"square",color:(0,H.bJ)(e.effectiveTheme.accentColor),outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:1}}),geometry:l})),t._graphicsLayer.graphics.addMany([t._backgroundGraphic,t._rotateGraphic,...t._scaleGraphics]),t._dragManipulation=new Tt({tool:t,view:e,graphic:t._graphic}),t._rotateManipulation=new n({tool:t,view:e,graphic:t._rotateGraphic,snapRotation:t._snapRotation}),t._scaleManipulations=t._scaleGraphics.map((l,v)=>new w({tool:t,view:e,graphic:l,direction:ee[v],preserveAspectRatio:t._preserveAspectRatio})),t.addHandles([t._dragManipulation.createDragPipeline(t._getInfo.bind(t),t._updateGraphics.bind(t)),t._rotateManipulation.createDragPipeline(t._getInfo.bind(t),t._updateGraphics.bind(t)),...t._scaleManipulations.map(l=>l.createDragPipeline(t._getInfo.bind(t),t._updateGraphics.bind(t))),(0,j.wB)(()=>t.view.scale,()=>t.active?t.updateGraphics():null),e.on("click",function(){var l=(0,O.A)(function*(v){if(null!=e.activeTool&&e.activeTool!==t)return;const p=(0,Jt.ZV)(v),g=[];e.map.allLayers.forEach(G=>{"vector-tile"!==G.type&&"imagery"!==G.type||g.push(G)});const b=yield t.view.hitTest(p,{exclude:g}),A=b.results;if(0===A.length)e.activeTool=null;else{const G=(0,U.zF)(b.results),rt="georeference"in o,x=A.map(M=>"media"===M.type?M.element:null).filter(Boolean),T=new Set([...t._graphicsLayer.graphics,rt?null:o].filter(Boolean));rt&&x.includes(o)||null!=G&&T.has(G.graphic)?null==e.activeTool&&(e.activeTool=t):e.activeTool=null}});return function(v){return l.apply(this,arguments)}}())]);const d=l=>{t.addHandles(l.events.on("grab-changed",v=>{"georeference"in o&&("start"===v.action?o.opacity*=.5:"end"===v.action&&(o.opacity*=2))}))};t._dragManipulation.forEachManipulator(d),t._rotateManipulation.forEachManipulator(d),t._scaleManipulations.forEach(l=>l.forEachManipulator(d));const r=new P.oe;r.addToggle(P.TU.preserveAspectRatio,()=>{null==t.preserveAspectRatio&&(t._preserveAspectRatio.enabled=!t._preserveAspectRatio.enabled)}),r.addToggle(P.TU.rotateIncrements,()=>{null==t.snapRotation&&(t._snapRotation.enabled=!t._snapRotation.enabled)}),r.add(P.TU.toggleOpacity,()=>{"georeference"in o&&(o.opacity*=t._isOpacityToggled?2:.5,t._isOpacityToggled=!t._isOpacityToggled)}),r.addToggle(P.TU.factorModifier,l=>t._factor="key-down"===l.type?10:1),r.add(P.TU.scaleUp,()=>t._scale(t._factor)),r.add(P.TU.scaleDown,()=>t._scale(-t._factor)),r.add(P.TU.moveUp,()=>t._move(0,t._factor)),r.add(P.TU.moveDown,()=>t._move(0,-t._factor)),r.add(P.TU.moveLeft,()=>t._move(-t._factor,0)),r.add(P.TU.moveRight,()=>t._move(t._factor,0)),t.addHandles([e.on("key-down",l=>{e.activeTool===t&&r.dispatch(e.inputManager,l)}),e.on("key-up",l=>{e.activeTool===t&&r.dispatch(e.inputManager,l)})])})()}_loadProjectionEngine(){var t=this;return(0,O.A)(function*(){return(0,q.initializeProjection)(t._graphic.geometry.spatialReference,t.view.spatialReference)})()}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:o,origin:d}=t,r=this._cornerA;(0,u.g)(r,d,e),(0,u.g)(r,r,o);const l=this._cornerB;(0,u.g)(l,d,e),(0,u.d)(l,l,o);const v=this._cornerC;(0,u.d)(v,d,e),(0,u.d)(v,v,o);const p=this._cornerD;(0,u.d)(p,d,e),(0,u.g)(p,p,o)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){"start"===t.action&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){const e=this._editGeometryOperations,o=e.data.geometry.extent?.width,d=(o+t*this.view.resolution)/o,r=e.scale(this._plane.origin,gt.Cw,d,d,k.Y.NEW_STEP,bt.K.REPLACE);this._sharedUndoStack.push({tool:this,operation:r}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const o=this._editGeometryOperations.move(t*this.view.resolution,e*this.view.resolution,0,k.Y.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:o}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,y._)([(0,E.MZ)()],I.prototype,"_plane",null),(0,y._)([(0,E.MZ)()],I.prototype,"_backgroundGraphicGeometry",null),(0,y._)([(0,E.MZ)()],I.prototype,"_rotateGraphicGeometry",null),(0,y._)([(0,E.MZ)()],I.prototype,"_scaleGraphicGeometries",null),(0,y._)([(0,E.MZ)()],I.prototype,"preserveAspectRatio",void 0),(0,y._)([(0,E.MZ)()],I.prototype,"snapRotation",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0,nonNullable:!0})],I.prototype,"target",void 0),(0,y._)([(0,E.MZ)({readOnly:!0})],I.prototype,"type",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0})],I.prototype,"view",void 0),I=(0,y._)([(0,$.$)("esri.views.2d.interactive.editingTools.TransformTool")],I);var oe=s(98877);let X=class extends oe.A{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){var t=this;const{view:e,mediaElement:o,preserveAspectRatio:d,snapRotation:r,advancedMode:l}=this;this._originalOpacity=o.opacity,this._transformTool=new I({target:o,view:e,preserveAspectRatio:d,snapRotation:r}),this._controlPointsTransformTool=new V({mediaElement:o,view:e}),this._advancedModeTransformTool=new V({mediaElement:l.mediaElement,view:l.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const v=o.georeference,p=l.mediaElement.georeference;l.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in p&&"controlPoints"in v&&this.addHandles([l.view.on("key-down",g=>{"z"===g.key&&this.canUndo()&&(this.undo(),g.stopPropagation()),"r"===g.key&&this.canRedo()&&(this.redo(),g.stopPropagation())}),l.view.on("focus",function(){var g=(0,O.A)(function*(b){t._controlPointsTransformTool.removeHighlightActiveHandle(),t._advancedModeTransformTool.highlightActiveHandle()});return function(b){return g.apply(this,arguments)}}()),(0,j.wB)(()=>p.controlPoints,g=>{v.controlPoints=g.map(({sourcePoint:b},A)=>({sourcePoint:b,mapPoint:v.controlPoints[A].mapPoint})),this._activeTool?.refresh()}),(0,j.wB)(()=>this._controlPointsTransformTool.activeHandle,g=>{this._advancedModeTransformTool.updateActiveHandle(g),this.activeHandle=g}),(0,j.wB)(()=>this._advancedModeTransformTool.activeHandle,g=>{this._controlPointsTransformTool.updateActiveHandle(g),this.activeHandle=g})]),this.addHandles([e.on("key-down",g=>{"z"===g.key&&this.canUndo()&&(this.undo(),g.stopPropagation()),"r"===g.key&&this.canRedo()&&(this.redo(),g.stopPropagation())}),e.on("focus",function(){var g=(0,O.A)(function*(b){t._advancedModeTransformTool.removeHighlightActiveHandle(),t._controlPointsTransformTool.highlightActiveHandle()});return function(b){return g.apply(this,arguments)}}())]),e.tools.addMany([this._transformTool,this._controlPointsTransformTool]),e.activeTool=this._transformTool,this._activeTool=this._transformTool,e.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}enableAdvancedMode(){var t=this;return(0,O.A)(function*(){t.view.activeTool=t._controlPointsTransformTool,t._activeTool=t._controlPointsTransformTool,t._activeTool.refresh(),yield t.advancedMode.view.when(),t.advancedMode.view.activeTool=t._advancedModeTransformTool,t._originalOpacity=t._controlPointsTransformTool.mediaElement.opacity,t._controlPointsTransformTool.mediaElement.opacity=.25*t._originalOpacity})()}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};(0,y._)([(0,E.MZ)()],X.prototype,"activeHandle",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0})],X.prototype,"advancedMode",void 0),(0,y._)([(0,E.MZ)()],X.prototype,"preserveAspectRatio",void 0),(0,y._)([(0,E.MZ)()],X.prototype,"snapRotation",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0,nonNullable:!0})],X.prototype,"mediaElement",void 0),(0,y._)([(0,E.MZ)({constructOnly:!0})],X.prototype,"view",void 0),X=(0,y._)([(0,$.$)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],X)}}]);