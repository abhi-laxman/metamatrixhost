"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[4014],{94014:(V,G,r)=>{r.r(G),r.d(G,{RouteLayerInteraction:()=>et});var v=r(10467),h=r(8189),T=r(98877),f=r(17715),P=r(11432),M=r(48900),c=r(85211),C=(r(3248),r(35150)),I=(r(40707),r(76576)),R=r(56985),N=r(36819),b=r(23632),z=r(34720),Y=r(51882),rt=r(48393),$=r(31178),jt=r(5922),mt=r(42425),Q=r(56492),Zt=r(87477),nt=r(13970),Pt=r(15268),Bt=r(58701),wt=r(58443),Kt=r(92262),Wt=r(64484),Ft=r(88521),Vt=r(55417),At=r(46602),st=r(94048),K=r(66298),Yt=r(70903),at=r(73812);var Ct=r(4398),Z=r(19824),H=r(46153),Qt=r(70789),Dt=r(56023),Jt=r(40511),_t=r(10960),kt=r(89447),J=r(29280),pt=r(56083),dt=r(26161),qt=r(89952);let q=class extends T.A{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new $.A}};(0,h._)([(0,c.MZ)({constructOnly:!0})],q.prototype,"layer",void 0),(0,h._)([(0,c.MZ)()],q.prototype,"enabled",void 0),(0,h._)([(0,c.MZ)()],q.prototype,"updating",void 0),(0,h._)([(0,c.MZ)()],q.prototype,"availability",void 0),(0,h._)([(0,c.MZ)()],q.prototype,"sublayerSources",void 0),q=(0,h._)([(0,I.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],q);const Rt=q;let w=class extends T.A{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new $.A,this.distance=pt.N.distance,this.touchSensitivityMultiplier=pt.N.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const t=this.featureSources;t.some(Gt)&&C.A.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=t.filter(ee),a=this._get("_effectiveFeatureSources")?.filter(Gt)??new $.A;for(const d of i){const g=a.find(y=>y.layer===d.layer.parent);if(g)g.sublayerSources.includes(d)||g.sublayerSources.add(d);else if(d.layer.parent){const y=new Rt({layer:d.layer.parent});y.sublayerSources.add(d),a.add(y)}}for(const d of a){const g=d.sublayerSources.filter(y=>!i.includes(y));d.sublayerSources.removeMany(g)}a.removeMany(a.filter(d=>0===d.sublayerSources.length));const n=t.filter(te),s=this._get("_effectiveFeatureSources")??new $.A,{added:l,removed:p}=(0,qt.iv)(s.toArray(),[...n,...a]);return s.removeMany(p),s.addMany(l),s}};(0,h._)([(0,c.MZ)()],w.prototype,"enabled",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"enabledToggled",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"forceDisabled",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"selfEnabled",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"featureEnabled",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"gridEnabled",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"attributeRulesEnabled",void 0),(0,h._)([(0,c.MZ)({type:$.A.ofType(Rt)})],w.prototype,"featureSources",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"distance",void 0),(0,h._)([(0,c.MZ)()],w.prototype,"touchSensitivityMultiplier",void 0),(0,h._)([(0,c.MZ)({readOnly:!0})],w.prototype,"effectiveEnabled",null),(0,h._)([(0,c.MZ)({readOnly:!0})],w.prototype,"effectiveGridEnabled",null),(0,h._)([(0,c.MZ)({readOnly:!0})],w.prototype,"effectiveSelfEnabled",null),(0,h._)([(0,c.MZ)({readOnly:!0})],w.prototype,"effectiveFeatureEnabled",null),(0,h._)([(0,c.MZ)({readOnly:!0})],w.prototype,"_effectiveFeatureSources",null),w=(0,h._)([(0,I.$)("esri.views.interactive.snapping.SnappingOptions")],w);const ft=w;function Gt(t){return"subtype-group"===t.layer.type}function te(t){return"subtype-group"!==t.layer.type}function ee(t){return"subtype-sublayer"===t.layer.type}var Et=r(3548),oe=r(50044),ne=r(75602),ct=r(87246),ae=r(27279),ie=r(34518),It=r(34958),re=r(37154),se=r(84586);let X=class extends(mt.A.EventedMixin(T.A)){constructor(t){super(t),this.options=new ft,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=_.MAIN}initialize(){this.addHandles([(0,M.wB)(()=>{const{distance:t,touchSensitivityMultiplier:i,effectiveSelfEnabled:a,effectiveFeatureEnabled:n,effectiveGridEnabled:s}=this.options;return{selfEnabled:a,featureEnabled:n,gridEnabled:"2d"===this.view.type&&s,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:t,touchSensitivityMultiplier:i}},(t,i)=>{i&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=(0,kt.UT)(a=>this._updateEngines(t,i,a))},M.pc),(0,M.wB)(()=>this.options,t=>{for(const i of this._engines)i.options=t},M.OH)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(t=>t.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(t=>t.destroy()),this._engineCache.clear(),this._engines=[]}_updateEngines(t,i,a){var n=this;return(0,v.A)(function*(){if(!t.viewReady)return void n._destroyEngines();i?.viewSpatialReference!==t.viewSpatialReference&&n._destroyEngines();const s=n._engineCache,l=yield Promise.allSettled([t.featureEnabled&&!s.has("feature")?n._createFeatureSnappingEngine(a):void 0,t.selfEnabled&&!s.has("self")?n._createSelfSnappingEngine(a):void 0,t.gridEnabled&&!s.has("grid")?n._createGridSnappingEngine(a):void 0]);if(a.aborted)for(const p of l)"fulfilled"===p.status&&p.value?.engine.destroy();else{for(const p of l)"fulfilled"===p.status&&p.value&&s.set(p.value.type,p.value.engine);n._engines=Array.from(s.values())}})()}_createSelfSnappingEngine(t){var i=this;return(0,v.A)(function*(){const{SelfSnappingEngine:a}=yield Promise.all([r.e(3930),r.e(2010)]).then(r.bind(r,28790));return(0,Q.Te)(t),{type:"self",engine:new a({view:i.view,options:i.options})}})()}_createGridSnappingEngine(t){var i=this;return(0,v.A)(function*(){const{view:a}=i;if("2d"!==a.type)return;const{GridSnappingEngine:n}=yield Promise.all([r.e(2076),r.e(7191)]).then(r.bind(r,97191));return(0,Q.Te)(t),{type:"grid",engine:new n({view:a,options:i.options})}})()}_createFeatureSnappingEngine(t){var i=this;return(0,v.A)(function*(){const{FeatureSnappingEngine:a}=yield r.e(9245).then(r.bind(r,49245));(0,Q.Te)(t);const{view:n,options:s}=i,{spatialReference:l}=n;return{type:"feature",engine:new a({view:n,options:s,spatialReference:l})}})()}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:i}=this.options,a=t*i;return a*a}snap(t){return function de(t){return null!=t.scenePoint}(t)?this._snapMultiPoint(t):this._snapSinglePoint(t)}update(t){const{point:i,context:a}=t;this._removeVisualization();const n=this._currentMainCandidate;if(null==n)return i;const s=this._selectUpdateInput(t);if(null==s)return i;const{spatialReference:l}=a,p=(0,nt.project)(s,l);if(null==p)return i;const{view:d}=this,{elevationInfo:g,visualizer:y}=a,u=[],m=(0,J.vf)(p,d,g),E=n.constraint.closestTo(m);if(!this._arePointsWithinScreenThreshold(m,E,a)||!Ot(n,a.drawConstraints))return this._resetSnappingState(),i;n.targetPoint=(0,J.de)(E),u.push(...n.hints);for(const A of this._currentOtherActiveCandidates)Ot(A,a.drawConstraints)&&(A.targetPoint=(0,J.de)(E),u.push(...A.hints));return null!=y&&this.addHandles(y.draw(u,{spatialReference:l,elevationInfo:ce(a),view:d,selfSnappingZ:a.selfSnappingZ}),Mt),(0,J.xF)(E,d,i,a)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:t,scenePoint:i}){switch(this._currentSnappedType){case _.MAIN:return t;case _.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=_.MAIN}_removeVisualization(){this.removeHandles(Mt)}_snapSinglePoint({point:t,context:i,signal:a}){var n=this;return(0,v.A)(function*(){const{view:s}=n,{elevationInfo:l}=i,p=(0,J.vf)(t,s,l),d=yield n._fetchCandidates(p,dt.n.ALL,i,a);return n._createSnapResult(p,_.MAIN,d,s,t,i,a)})()}_snapMultiPoint({point:t,scenePoint:i,context:a,signal:n}){var s=this;return(0,v.A)(function*(){const{view:l}=s,{coordinateHelper:p,elevationInfo:d,spatialReference:g}=a;yield(0,nt.initializeProjection)(i.spatialReference,g);const y=(0,nt.project)(i,g),u=(0,J.vf)(y,l,d),m=yield s._fetchCandidates(u,dt.n.FEATURE,a,n);if(m.length>0){const S=yield s._fetchCandidates(u,dt.n.SELF,a,n);return s._createSnapResult(u,_.SCENE,[...m,...S],l,y,a,n)}const E=(0,J.vf)(t,l,d),A=yield s._fetchCandidates(E,dt.n.SELF,a,n);return s._createSnapResult(E,_.MAIN,A,l,{z:p.hasZ()&&t.hasZ?t.z??0:void 0,m:p.hasM()&&t.hasM?t.m??0:void 0},a,n)})()}_fetchCandidates(t,i,a,n){var s=this;return(0,v.A)(function*(){return(yield Promise.all(s._engines.map(l=>l.fetchCandidates(t,i,a,n)))).flat()})()}_createSnapResult(t,i,a,n,s,l,p){return{get valid(){return!(0,Q.G4)(p)},apply:()=>{const{spatialReference:d}=l,{snappedPoint:g,hints:y}=this._processCandidates(t,i,a,l);return this._removeVisualization(),null!=l.visualizer&&this.addHandles(l.visualizer.draw(y,{spatialReference:d,elevationInfo:at.qt,view:n,selfSnappingZ:l.selfSnappingZ}),Mt),(0,J.xF)(g,n,s,l)}}}_processCandidates(t,i,a,n){if(a.length<1)return this.doneSnapping(),{snappedPoint:t,hints:[]};this._currentSnappedType!==i&&this._resetSnappingState(),(0,Et.xX)(t,a);const s=this._currentMainCandidate;if(null!=s){const l=function pe(t,i){return t instanceof ct.N?St(i,t.first)>=0&&St(i,t.second)>=0?0:-1:St(i,t)}(s,a);if(l>=0){if(!(a[l]instanceof ct.N))return this._intersectWithOtherCandidates(l,a,t,i,n);if(this._arePointsWithinScreenThreshold(t,s.targetPoint,n))return this._updateSnappingCandidate(s,i,a,n)}}return this._intersectWithOtherCandidates(0,a,t,i,n)}_intersectWithOtherCandidates(t,i,a,n,s){const{coordinateHelper:l}=s,p=i[t],d=[];for(let g=0;g<i.length;++g){if(g===t)continue;const y=i[g],u=p.constraint.intersect(y.constraint);if(u)for(const m of u.closestPoints(p.targetPoint))d.push([new ct.N((0,J.de)(m),p,y,y.isDraped),this._squaredScreenDistance(a,m,l)])}return d.length>0&&(d.sort((g,y)=>g[1]-y[1]),d[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(d[0][0],n,i,s):Ot(p,s.drawConstraints)?this._updateSnappingCandidate(p,n,i,s):{snappedPoint:a,hints:[]}}_updateSnappingCandidate(t,i,a,n){this.doneSnapping(),this._currentMainCandidate=t,this._currentSnappedType=i;const s=this._currentMainCandidate.targetPoint,l=[];l.push(...t.hints);for(const p of a){if(t instanceof ct.N){if(p.constraint.equals(t.first.constraint)||p.constraint.equals(t.second.constraint))continue}else if(p.constraint.equals(t.constraint))continue;const d=p.constraint.closestTo(s);this._squaredScreenDistance(d,s,n.coordinateHelper)<pt.N.satisfiesConstraintScreenThreshold*pt.N.satisfiesConstraintScreenThreshold&&(p.targetPoint=s,this._currentOtherActiveCandidates.push(p),l.push(...p.hints))}return{snappedPoint:s,hints:l}}_squaredPointProximityThreshold(t){return"touch"===t?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(t,i,a){return this._squaredScreenDistance(t,i,a.coordinateHelper)<this._squaredPointProximityThreshold(a.pointer)}_squaredScreenDistance(t,i,a){return(0,Et.pM)(this._toScreen(t,a),this._toScreen(i,a))}_toScreen(t,i){return(0,se.j)(t,i.spatialReference,at.qt,this.view)}get test(){}};var _,t;(0,h._)([(0,c.MZ)({constructOnly:!0})],X.prototype,"view",void 0),(0,h._)([(0,c.MZ)()],X.prototype,"options",void 0),(0,h._)([(0,c.MZ)({readOnly:!0})],X.prototype,"updating",null),(0,h._)([(0,c.MZ)()],X.prototype,"_loadTask",void 0),(0,h._)([(0,c.MZ)()],X.prototype,"_engines",void 0),(0,h._)([(0,c.MZ)()],X.prototype,"_squaredMouseProximityThreshold",null),(0,h._)([(0,c.MZ)()],X.prototype,"_squaredTouchProximityThreshold",null),X=(0,h._)([(0,I.$)("esri.views.interactive.snapping.SnappingManager")],X),(t=_||(_={}))[t.MAIN=0]="MAIN",t[t.SCENE=1]="SCENE";const Mt="visualization-handle";function Ot(t,i){return!i||null==i.direction&&null==i.distance||!(t instanceof oe.X||t instanceof ne.z||t instanceof ae.o||t instanceof ie.B||t instanceof re.R)&&(!(t instanceof It.HJ)||null==i.direction&&t.selfSnappingType===It._b.LastVertex)}function St(t,i){let a=-1;for(let n=0;n<t.length;++n)if(i.constraint.equals(t[n].constraint)){a=n;break}return a}function ce({coordinateHelper:t,elevationInfo:i}){return t.hasZ()?at.qt:i}var he=r(94001),Ut=r(77498),ue=r(69690);let W=class extends mt.A.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,ue.Xb)(this.activeComponent)}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const t=this.activeComponent;t&&("box"!==t.type&&"reshape"!==t.type&&"graphic-mover"!==t.type||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};(0,h._)([(0,c.MZ)()],W.prototype,"activeComponent",void 0),(0,h._)([(0,c.MZ)()],W.prototype,"cancelled",void 0),(0,h._)([(0,c.MZ)()],W.prototype,"history",void 0),(0,h._)([(0,c.MZ)()],W.prototype,"tool",null),(0,h._)([(0,c.MZ)()],W.prototype,"type",void 0),(0,h._)([(0,c.MZ)()],W.prototype,"canUndo",null),(0,h._)([(0,c.MZ)()],W.prototype,"canRedo",null),(0,h._)([(0,c.MZ)()],W.prototype,"onEnd",void 0),(0,h._)([(0,c.MZ)()],W.prototype,"undo",null),(0,h._)([(0,c.MZ)()],W.prototype,"redo",null),(0,h._)([(0,c.MZ)()],W.prototype,"toggleTool",void 0),(0,h._)([(0,c.MZ)()],W.prototype,"addToSelection",void 0),(0,h._)([(0,c.MZ)()],W.prototype,"removeFromSelection",void 0),W=(0,h._)([(0,I.$)("esri.widgets.Sketch.support.OperationHandle")],W);let ht=class extends W{};(0,h._)([(0,c.MZ)()],ht.prototype,"activeComponent",void 0),ht=(0,h._)([(0,I.$)("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],ht);let k=class extends W{};var bt;(0,h._)([(0,c.MZ)()],k.prototype,"activeComponent",void 0),k=(0,h._)([(0,I.$)("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],k),function(t){t[t.ForceCollapse=-1]="ForceCollapse",t[t.Low=0]="Low",t[t.Medium=10]="Medium",t[t.High=100]="High",t[t.Max=1e3]="Max"}(bt||(bt={}));const Lt={defaultZ:0},lt={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let D=class extends mt.A.EventedAccessor{constructor(t){super(t),this._defaultSnappingManager=null,this._updatingHandles=new R.U,this._internalGraphicsLayer=new N.A({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new At.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Ft.A({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Vt.A({color:[130,130,130,1],width:2}),this.meshSymbol=new Wt.A({symbolLayers:new $.A([new Kt.A])}),this.updateGraphics=new $.A,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new At.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Dt.A,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Lt,this.defaultUpdateOptions=lt,this.snappingOptions=t?.snappingManager?.options??t?.snappingOptions??new ft}initialize(){this.addHandles([(0,M.on)(()=>this.view?.map?.layers,"change",t=>{t.removed.includes(this.layer)&&this.cancel()}),(0,M.on)(()=>this.layer?.graphics,"change",t=>{if(null!=this._operationHandle)for(const i of t.removed)this.updateGraphics.includes(i)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(i):this._operationHandle.cancel())}),(0,M.wB)(()=>this.layer?.elevationInfo??null,t=>{t!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=t)},M.pc),(0,M.wB)(()=>this.view,t=>{this._defaultSnappingManager=(0,P.pR)(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new X({view:t,options:this.snappingOptions})),"2d"===t.type?Promise.all([r.e(3930),r.e(8066),r.e(3085),r.e(4424),r.e(5073),r.e(9574)]).then(r.bind(r,69574)):"3d"===t.type&&(Promise.all([r.e(3930),r.e(5434),r.e(7284),r.e(8066),r.e(9146),r.e(3085),r.e(3926),r.e(4424),r.e(8023),r.e(9468),r.e(2814),r.e(271),r.e(2076),r.e(1521)]).then(r.bind(r,61156)),Promise.all([r.e(2253),r.e(3318),r.e(5434),r.e(7284),r.e(9146),r.e(3926),r.e(3781),r.e(9468),r.e(271),r.e(5340),r.e(2076),r.e(4909)]).then(r.bind(r,34909))))},M.pc),(0,M.wB)(()=>this.view?.spatialReference,(t,i)=>{t&&i&&!t.equals(i)&&this.cancel()})]),(0,Et.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,P.pR)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return"create"===this._operationHandle?.type&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:t,destroyed:i}=this,a=!i&&t&&"tooltip"in t?t.tooltip:null;return a?.visible?a:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...Lt,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...lt,...t,reshapeOptions:{...lt.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...lt.highlightOptions,...t?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(t){this.sketchOptions.labels=t}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(t){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=t),this._set("snappingOptions",t)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(t){if(t)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,P.pR)(this._defaultSnappingManager)),this._override("snappingManager",t);else{const{view:i}=this;!this._defaultSnappingManager&&i&&(this._defaultSnappingManager=new X({options:this.snappingOptions,view:i})),this._clearOverride("snappingManager")}}get state(){const t=!(!this.view?.ready||!this.layer);return t&&this._operationHandle?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(t){this.sketchOptions.tooltips=t}get valueOptions(){return this.sketchOptions.values}set valueOptions(t){this.sketchOptions.values=t}get view(){return this._get("view")}set view(t){const i=this._get("view");if(i){const{container:n,map:s}=i;n&&(i.cursor=null),s?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const a="view-ready";this.removeHandles(a),t&&this.addHandles((0,M.z7)(()=>t.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(t),this._viewHandlesKey)},M.pc),a),this._set("view",t)}cancel(){this._moduleLoaderAbortController=(0,P.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,P.DC)(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:t,updateGraphics:i}=this;if("active"===t&&i.length){const{activeTool:a,layer:n}=this,s=i.toArray();n.removeMany(s),this.cancel(),this._emitDeleteEvent({graphics:s,tool:a})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const t=this.updateGraphics.map(i=>i.clone()).toArray();return this.layer.addMany(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}create(t,i){var a=this;return(0,v.A)(function*(){a.cancel(),yield a._waitViewReady();const{view:n,layer:s}=a;if(!n||"disabled"===a.state)throw s||a._logMissingLayer(),(0,Q.NK)();if(null!=n.activeTool&&(n.activeTool=null),!t)return void a._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,Ct.Y)(n,a._internalGraphicsLayer);const l=yield a._updatingHandles.addPromise(a._setupCreateOperation(t,i));null==l||a.destroyed?n.map.remove(a._internalGraphicsLayer):(l.on("complete",()=>{if(l===a._operationHandle){const d=a.createGraphic,g=a._operationHandle.cancelled;if(a._operationHandle.destroy(),a._operationHandle=null,a._set("createGraphic",null),a.view?.map&&a.view.map.remove(a._internalGraphicsLayer),l.cancelled||null==d||s.add(d),a._sketchContinuationFlag=!1,a.emit("create",{graphic:d,state:g?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"}),g||a._sketchContinuationFlag)return;const{creationMode:y}=a;if("continuous"===y){if(i?.geometryToPlace)return;a._updatingHandles.addPromise((0,Q.QZ)(a.create(t,i)))}else"update"===y&&d&&a._updatingHandles.addPromise((0,Q.QZ)(a.update([d])))}}),a._operationHandle=l,n.ready&&n.focus())})()}place(t,i){var a=this;return(0,v.A)(function*(){return a.create("mesh",{mode:"click",hasZ:t.hasZ,geometryToPlace:t,...i})})()}update(t,i){var a=this;return(0,v.A)(function*(){a.cancel(),yield a._waitViewReady();const{layer:n,view:s,state:l}=a;if(!s||"disabled"===l)throw n||a._logMissingLayer(),(0,Q.NK)();null!=s.activeTool&&(s.activeTool=null);const p=Array.isArray(t)?t:[t];if(null==t||!p?.length)return void a._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(p.some(g=>g.layer!==n?(a._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==g.geometry&&(a._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const d=yield a._updatingHandles.addPromise(a._setupUpdateOperation(p,i));a.destroyed||null==d||j(d)||((0,Ct.Y)(s,a._internalGraphicsLayer),a._setUpdateOperationHandle(d,i),a.emit("update",{graphics:p,state:"start",aborted:!1,tool:d.tool,toolEventInfo:null,type:"update"}))})()}_updateSpatialReference(t){var i=this;return(0,v.A)(function*(){const a=i.view;if(a){t=Array.isArray(t)?t:[t];for(const n of t)null==n.geometry||"mesh"===n.geometry.type||(0,Bt.aI)(n.geometry.spatialReference,a.spatialReference)||((0,nt.canProjectWithoutEngine)(n.geometry.spatialReference,a.spatialReference)||(0,nt.isLoaded)()||(yield(0,nt.load)()),n.geometry=(0,nt.project)(n.geometry,a.spatialReference))}else i._logMissingView()})()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}_getFirstHit(t){var i=this;return(0,v.A)(function*(){const a=i.view;if(!a)return i._logMissingView(),null;if("2d"===a.type){const l=[];a.map.allLayers.forEach(d=>{"vector-tile"!==d.type&&"imagery"!==d.type||l.push(d)});const p=yield a.hitTest(t,{exclude:l});return(0,he.zF)(p.results)}const n=[a.map.ground];a.map.allLayers.forEach(l=>{(0,wt.Eq)(l.type)&&n.push(l)});const s=yield a.hitTest(t,{exclude:n});if(s.results.length>0){const l=s.results[0];if(null!=l&&"graphic"===l.type&&l.graphic&&(!s.ground.mapPoint||a.map.ground.opacity<1||s.ground.distance-(l.distance??0)>-Math.min(3*s.ground.distance,"global"===a.viewingMode?(0,Zt.tO)(a.renderCoordsHelper.spatialReference).radius/a.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return l}return null})()}_generateViewHandles(t){var i=this;return[t.on("immediate-click",function(){var a=(0,v.A)(function*(n){"disabled"!==i.state&&("active"!==i.state||"create"!==i._operationHandle?.type)&&i.updateOnGraphicClick&&(yield i._updatingHandles.addPromise(i._handleImmediateClick(n)))});return function(n){return a.apply(this,arguments)}}(),Z.o.WIDGET)]}_handleImmediateClick(t){var i=this;return(0,v.A)(function*(){const a=yield t.async(()=>i._getFirstHit((0,Ut.ZV)(t)));let n=null;if(null!=a){const s=a.graphic;i.updateGraphics.includes(s)||s.layer===i.layer?(t.stopPropagation(),n=s):"2d"!==i.view?.type||i._isComponentGraphic(s)||"active"!==i.state||i.cancel()}else"active"===i.state&&i.cancel();null==n||i.updateGraphics.includes(n)||(yield i.update([n],{...i.defaultUpdateOptions,reshapeOptions:{...i.defaultUpdateOptions.reshapeOptions}}))})()}_setupCreateOperation(t,i){var a=this;return(0,v.A)(function*(){const n=a.view;if(!n)return a._logMissingView(),null;const s={hasZ:"3d"===n.type,...a.defaultCreateOptions,...i},l=yield a._setupDrawGraphicTool(t,n,s);return null==l?null:(n.tools.add(l),n.activeTool=l,a._setupCreateOperationHandle(l))})()}_setupDrawGraphicTool(t,i,a){var n=this;return(0,v.A)(function*(){if("multipoint"===t&&"3d"===i.type)return n._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!i)return n._logMissingView(),null;const{cursor:s,defaultZ:l,hasZ:p,geometryToPlace:d,graphicProperties:g,mode:y,preserveAspectRatio:u}=a,m=function ye(t,i){return"freehandPolygon"===i||"freehandPolyline"===i?"freehand":t??("rectangle"===i||"circle"===i?"hybrid":"click")}(y,t),E=function ge(t){switch(t){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return t}}(t),A=a?.optionsPerTool?.has(t)?a.optionsPerTool.get(t):{},S=A?.preserveAspectRatio??u??"rectangle"!==t,O={centered:"rectangle"!==t&&!("circle"===t&&!S),cursor:s,defaultZ:l,forceUniformSize:S,graphicProperties:{...g,attributes:{...g?.attributes}},geometryToPlace:d,geometryType:E,mode:m,graphicSymbol:n._getGraphicSymbolFromTool(t),hasZ:p,snappingManager:n.snappingManager,snapToScene:!1,view:i,...A};return"2d"===i.type?n._makeDrawGraphicTool2D(O):n._makeDrawGraphicTool3D(O)})()}_makeDrawGraphicTool2D(t){var i=this;return(0,v.A)(function*(){const a=yield i._requireModule(Promise.all([r.e(3930),r.e(8066),r.e(3085),r.e(4424),r.e(5073),r.e(9574)]).then(r.bind(r,69574)));return j(a)||i.destroyed?null:new a.module.DrawGraphicTool2D({...t,activeVertexSymbol:i.activeVertexSymbol,regularVerticesSymbol:i.vertexSymbol,activeLineSymbol:i.activeLineSymbol,activeFillSymbol:me(t.geometryType)?i.activeFillSymbol:null,sketchOptions:i.sketchOptions})})()}_makeDrawGraphicTool3D(t){var i=this;return(0,v.A)(function*(){const a=yield i._requireModule(Promise.all([r.e(3930),r.e(5434),r.e(7284),r.e(8066),r.e(9146),r.e(3085),r.e(3926),r.e(4424),r.e(8023),r.e(9468),r.e(2814),r.e(271),r.e(2076),r.e(1521)]).then(r.bind(r,61156)));if(j(a)||i.destroyed)return null;const{elevationInfo:n}=i.layer;return new a.module.DrawGraphicTool3D({...t,elevationInfo:n,snapToScene:!0,sketchOptions:i.sketchOptions})})()}_setupCreateOperationHandle(t){const i=this.view;if(!i)return this._logMissingView(),null;let a=null;const n=t.forceUniformSize,s=t.centered,l=[i.on("key-down",d=>{if(d.key===H.NE.pan)d.stopPropagation(),d.repeat||(t.enabled=!1);else if(d.key===H.NE.complete)d.stopPropagation(),t.completeCreateOperation();else if(d.key!==H.NE.vertexAdd||d.repeat)d.key===H.NE.undo?(d.stopPropagation(),p.undo()):d.key===H.NE.redo?(d.stopPropagation(),p.redo()):d.key!==H.NE.constraint||"rectangle"!==t.geometryType&&"circle"!==t.geometryType||d.repeat?d.key===H.NE.center&&(d.repeat||(t.centered=!s,d.stopPropagation())):(t.forceUniformSize=!n,d.stopPropagation());else{const g=t.drawOperation.geometryType;"polyline"!==g&&"polygon"!==g&&"multipoint"!==g||(d.stopPropagation(),t.drawOperation.commitStagedVertex())}},Z.o.WIDGET),i.on("key-up",d=>{d.key===H.NE.pan?t.enabled=!0:d.key!==H.NE.constraint||"rectangle"!==t.geometryType&&"circle"!==t.geometryType?d.key===H.NE.center&&(t.centered=s,d.stopPropagation()):(t.forceUniformSize=n,d.stopPropagation())},Z.o.WIDGET),t.on("vertex-add",d=>{switch(a=null==a?"start":"active",d.operation){case"apply":this.emit("create",{graphic:t.graphic,state:a,tool:this.activeTool,toolEventInfo:d,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",d=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:d.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",d=>{switch(d.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:d,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",d=>{this._set("createGraphic",d.graphic),a="complete",d.aborted?p&&p.cancel():p&&p.complete()}),(0,M.wB)(()=>this._getGraphicSymbolFromTool(t.geometryType),d=>{t.graphicSymbol=d})],p=new ht({activeComponent:t,tool:t.geometryType,type:"create",onEnd:()=>{(0,f.ei)(l),i.tools?.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return p}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}_setupUpdateOperation(t,i){var a=this;return(0,v.A)(function*(){const{layer:n,view:s}=a;if(!s)return a._logMissingView(),null;const l={...a.defaultUpdateOptions,...i,reshapeOptions:{...a.defaultUpdateOptions.reshapeOptions,...i?.reshapeOptions},highlightOptions:{...a.defaultUpdateOptions.highlightOptions,...i?.highlightOptions}};let p=l.tool??lt.tool;for(const d of t)n.remove(d),n.add(d);if("3d"===s.type){if(0===t.length)return null;switch(p){case"move":return a._setupMove3DOperation(t,l,s,p);case"reshape":return t.length>1?(a._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):a._setupReshape3DOperation(t[0],l,s);case"transform":return a._setupGraphicTransform3DOperation(t,l,s)}}switch(p){case"move":return a._setupMove2DOperation(t,l,s);case"reshape":return t.length>1?(a._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):a._setupTransformOrReshape2DOperation(t,p,l,s);case"transform":if(1===t.length){const d=t[0].geometry?.type;"point"!==d&&"multipoint"!==d||(p="reshape")}return a._setupTransformOrReshape2DOperation(t,p,l,s)}})()}_setupMove3DOperation(t,i,a,n,s=!1){var l=this;return(0,v.A)(function*(){const p=yield l._requireModule(Promise.all([r.e(3930),r.e(5434),r.e(7284),r.e(8066),r.e(9146),r.e(3085),r.e(3926),r.e(4424),r.e(8023),r.e(9468),r.e(2814),r.e(271),r.e(2076),r.e(1521)]).then(r.bind(r,61156)));if(j(p))return p;const{ManipulatedObject3DGraphic:d,MoveTool3D:g}=p.module,y=new Map,u=()=>{y.forEach(S=>S.destroy()),y.clear()};for(const S of t){const O=new d({view:a,graphic:S}),L=(0,Yt.Y)(O);if(L!==K.d.SUPPORTED)return u(),l._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,K.c)(L)}).`),null;y.set(S,O)}const m=new g({view:a,enableZ:i.enableZ,snappingManager:l.snappingManager,sketchOptions:l.sketchOptions});a.tools.add(m),m.objects.addMany(Array.from(y.values())),s||l.updateGraphics.addMany(t);const E=[],A=new k({activeComponent:m,tool:n,type:"update",onEnd:()=>{(0,f.ei)(E),gt(a,m),u()},undo:()=>{Nt(l.view,m),ut(A,l.updateGraphics.toArray()),l._emitUndoEvent({graphics:l.updateGraphics.toArray(),tool:n})},redo:()=>{yt(A,l.updateGraphics.toArray()),l._emitRedoEvent({graphics:l.updateGraphics.toArray(),tool:n})},addToSelection:S=>{l.updateGraphics.push(S);const O=new d({view:a,graphic:S});y.set(S,O),m.objects.push(O),l.emit("update",{graphics:l.updateGraphics.toArray(),state:"active",aborted:!1,tool:l.activeTool,toolEventInfo:{added:[S],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:S=>{const O=l.updateGraphics.indexOf(S);if(A.history.undo.forEach(x=>x.updates.splice(O,1)),A.history.redo.forEach(x=>x.updates.splice(O,1)),l.updateGraphics.remove(S),l.emit("update",{graphics:l.updateGraphics.toArray(),state:"active",aborted:!1,tool:l.activeTool,toolEventInfo:{added:[],removed:[S],type:"selection-change"},type:"update"}),0===l.updateGraphics.length)return void A.complete();const L=y.get(S);L&&(m.objects.remove(L),L.destroy(),y.delete(S))},toggleTool:(S=(0,v.A)(function*(){if(1!==l.updateGraphics.length||!1===i.toggleToolOnClick||"transform"!==n)return;const O=l.updateGraphics.at(0),L=yield l._setupReshape3DOperation(O,i,a,!0);L&&!j(L)&&(A.onEnd(),A.destroy(),l._setUpdateOperationHandle(L,i))}),function(){return S.apply(this,arguments)})});var S;return E.push(...l._getHandlesForComponent(A,i),a.on("immediate-click",S=>l._getCommonUpdateOperationClickHandlers(A,S,i),Z.o.WIDGET),a.on("key-down",S=>{l._getCommonUpdateOperationKeyDownHandlers(A,S)},Z.o.WIDGET)),A})()}_setupGraphicTransform3DOperation(t,i,a,n=!1){if(1===t.length&&function Xt(t){if("graphics"!==t.layer?.type)return K.d.GRAPHICS_LAYER_MISSING;if(null==t.geometry)return K.d.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return K.d.SUPPORTED;default:return K.d.GEOMETRY_TYPE_UNSUPPORTED}const i=null!=t.symbol&&"point-3d"===t.symbol.type&&t.symbol.symbolLayers;return i&&i.some(a=>"object"===a.type)?"on-the-ground"!==(0,at.ky)(t)&&(0,at.NN)(t)?K.d.ELEVATION_MODE_UNSUPPORTED:K.d.SUPPORTED:K.d.SYMBOL_TYPE_UNSUPPORTED}(t[0])===K.d.SUPPORTED){const s=t[0],l=s.geometry;if(null!=l&&("point"===l.type||"mesh"===l.type))return this._setupPointTransform3DOperation(s,i,a);if(null!=l&&("polygon"===l.type||"polyline"===l.type))return this._setupPolyTransform3DOperation(s,i,a,n)}return this._setupMove3DOperation(t,i,a,"transform",n)}_setupPointTransform3DOperation(t,i,a){var n=this;return(0,v.A)(function*(){const s="transform",{enableRotation:l,enableScaling:p,enableZ:d}=i,g=yield n._requireModule(Promise.all([r.e(3930),r.e(5434),r.e(7284),r.e(8066),r.e(9146),r.e(3085),r.e(3926),r.e(4424),r.e(8023),r.e(9468),r.e(2814),r.e(271),r.e(2076),r.e(1521)]).then(r.bind(r,61156)));if(j(g))return g;const{TransformTool3D:y,ManipulatedObject3DGraphic:u}=g.module,m=new u({graphic:t,view:a}),E=new y({object:m,view:a,enableRotation:l,enableScaling:p,enableZ:d,snappingManager:n.snappingManager,sketchOptions:n.sketchOptions});a.tools.add(E),n.updateGraphics.add(t);const A=[],S=new k({activeComponent:E,tool:s,type:"update",onEnd:()=>{(0,f.ei)(A),gt(a,E),m.destroy()},undo:()=>{Nt(n.view,E),ut(S,n.updateGraphics.toArray()),n._emitUndoEvent({graphics:n.updateGraphics.toArray(),tool:s})},redo:()=>{yt(S,n.updateGraphics.toArray()),n._emitRedoEvent({graphics:n.updateGraphics.toArray(),tool:s})},addToSelection:(O=(0,v.A)(function*(L){n.updateGraphics.add(L),n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{added:[L],removed:[],type:"selection-change"},type:"update"}),S.onEnd(),S.destroy();const x=yield n._setupMove3DOperation(n.updateGraphics.toArray(),i,a,"transform",!0);j(x)||n._setUpdateOperationHandle(x,i)}),function(x){return O.apply(this,arguments)}),removeFromSelection:O=>{n.updateGraphics.remove(O),n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{added:[],removed:[O],type:"selection-change"},type:"update"}),S.complete()},toggleTool:()=>{}});var O;return A.push(...n._getHandlesForComponent(S,i),a.on("immediate-click",O=>n._getCommonUpdateOperationClickHandlers(S,O,i),Z.o.WIDGET),a.on("key-down",O=>{n._getCommonUpdateOperationKeyDownHandlers(S,O)},Z.o.WIDGET)),S})()}_setupPolyTransform3DOperation(t,i,a,n=!1){var s=this;return(0,v.A)(function*(){const l="transform",{enableRotation:p,enableScaling:d,enableZ:g,preserveAspectRatio:y}=i,u=yield s._requireModule(Promise.all([r.e(3930),r.e(5434),r.e(7284),r.e(8066),r.e(9146),r.e(3085),r.e(3926),r.e(4424),r.e(8023),r.e(9468),r.e(2814),r.e(271),r.e(2076),r.e(1521)]).then(r.bind(r,61156)));if(j(u))return u;const{ManipulatedObject3DGraphic:m,ExtentTransformTool:E}=u.module,A=s.view?.inputManager?.isModifierKeyDown(H.NE.constraint),S=new m({view:a,graphic:t}),O=new E({object:S,view:a,enableRotation:p,enableScaling:d,enableZ:g,preserveAspectRatio:!!y!=!!A,sketchOptions:s.sketchOptions});a.tools.add(O),n||s.updateGraphics.add(t);const L=[],x=new k({activeComponent:O,tool:l,type:"update",onEnd:()=>{(0,f.ei)(L),gt(a,O),S.destroy()},canUndo:()=>!O.destroyed&&O.canUndo,undo:()=>{O.destroyed||(O.undo(),s._emitUndoEvent({graphics:s.updateGraphics.toArray(),tool:l}))},canRedo:()=>!O.destroyed&&O.canRedo,redo:()=>{O.destroyed||(O.redo(),s._emitRedoEvent({graphics:s.updateGraphics.toArray(),tool:l}))},addToSelection:(F=(0,v.A)(function*(ot){s.updateGraphics.add(ot),s.emit("update",{graphics:s.updateGraphics.toArray(),state:"active",aborted:!1,tool:s.activeTool,toolEventInfo:{added:[ot],removed:[],type:"selection-change"},type:"update"}),x.onEnd(),x.destroy();const Tt=yield s._setupMove3DOperation(s.updateGraphics.toArray(),i,a,"transform",!0);j(Tt)||s._setUpdateOperationHandle(Tt,i)}),function(Tt){return F.apply(this,arguments)}),removeFromSelection:F=>{s.updateGraphics.remove(F),s.emit("update",{graphics:s.updateGraphics.toArray(),state:"active",aborted:!1,tool:s.activeTool,toolEventInfo:{added:[],removed:[F],type:"selection-change"},type:"update"}),x.complete()},toggleTool:function(){var F=(0,v.A)(function*(){if(1!==s.updateGraphics.length||!1===i.toggleToolOnClick)return;const ot=yield s._setupReshape3DOperation(t,i,a,!0);ot&&!j(ot)&&(x.onEnd(),x.destroy(),s._setUpdateOperationHandle(ot,i))});return function(){return F.apply(this,arguments)}}()});var F;return L.push(...s._getHandlesForComponent(x,i),a.on("immediate-click",F=>s._getCommonUpdateOperationClickHandlers(x,F,i),Z.o.WIDGET),a.on("key-down",F=>s._getCommonUpdateOperationKeyDownHandlers(x,F),Z.o.WIDGET),a.on("key-down",F=>{F.key!==H.NE.constraint||F.repeat||(O.preserveAspectRatio=!O.preserveAspectRatio,F.stopPropagation())},Z.o.WIDGET),a.on("key-up",F=>{F.key===H.NE.constraint&&(O.preserveAspectRatio=!O.preserveAspectRatio,F.stopPropagation())},Z.o.WIDGET)),x})()}_setupMove2DOperation(t,i,a){var n=this;return(0,v.A)(function*(){const s="move";n.updateGraphics.addMany(t),yield n._updatingHandles.addPromise(n._updateSpatialReference(t));const l=yield n._getGraphicMover(t,i,a);if(j(l))return l;const p=new k({activeComponent:l,tool:s,type:"update",onEnd:()=>{n._displayDefaultCursor(),(0,f.ei)(y),(0,f.ei)(g),l.destroy(),n._internalGraphicsLayer?.removeMany([...n.updateGraphics.toArray()])},undo:()=>{const u=n.updateGraphics.toArray();ut(p,u),p.refreshComponent(),n._emitUndoEvent({graphics:u,tool:s})},redo:()=>{const u=n.updateGraphics.toArray();yt(p,u),p.refreshComponent(),n._emitRedoEvent({graphics:u,tool:s})},addToSelection:(u=(0,v.A)(function*(m){yield n._updatingHandles.addPromise(n._updateSpatialReference(m)),n.updateGraphics.push(m),l.graphics=n.updateGraphics.toArray(),n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{added:[m],removed:[],type:"selection-change"},type:"update"})}),function(E){return u.apply(this,arguments)}),removeFromSelection:u=>{const m=n.updateGraphics.indexOf(u);p.history.undo.forEach(A=>A.updates.splice(m,1)),p.history.redo.forEach(A=>A.updates.splice(m,1)),n.updateGraphics.remove(u);const E=n.updateGraphics.toArray();n.emit("update",{graphics:E,state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),0!==n.updateGraphics.length?l.graphics=E:p.complete()}});var u;let d=!1;const g=[a.on("immediate-click",u=>n._getCommonUpdateOperationClickHandlers(p,u,i),Z.o.WIDGET),a.on("key-down",u=>{n._getCommonUpdateOperationKeyDownHandlers(p,u),u.key!==H.NE.constraint||u.repeat||(d=!0,l.enableMoveAllGraphics=!l.enableMoveAllGraphics)},Z.o.WIDGET),a.on("key-up",u=>{u.key===H.NE.constraint&&d&&(d=!1,l.enableMoveAllGraphics=!l.enableMoveAllGraphics)},Z.o.WIDGET)],y=n._getHandlesForComponent(p,i);return p})()}_setupReshape3DOperation(t,i,a,n=!1){var s=this;return(0,v.A)(function*(){const l="reshape",p=yield s._requireModule(Promise.all([r.e(3930),r.e(5434),r.e(7284),r.e(8066),r.e(9146),r.e(3085),r.e(3926),r.e(4424),r.e(8023),r.e(9468),r.e(2814),r.e(271),r.e(2076),r.e(1521)]).then(r.bind(r,61156)));if(j(p))return p;const{ManipulatedObject3DGraphic:d,ReshapeTool3D:g}=p.module,y=new d({view:a,graphic:t}),u=function zt(t){return function $t(t){if(t.graphic&&"graphics"!==t.graphic.layer?.type)return{result:K.d.GRAPHICS_LAYER_MISSING};if(!t.operations)return{result:K.d.GEOMETRY_MISSING};if((0,at.wz)(t.elevationInfo))return{result:K.d.ELEVATION_MODE_UNSUPPORTED};const i=t.operations.data.type;return"point"===i||"mesh"===i||"polyline"===i||"polygon"===i?{result:K.d.SUPPORTED,geometry:t.operations.data.geometry}:{result:K.d.GEOMETRY_TYPE_UNSUPPORTED}}(t).result}(y);if(u!==K.d.SUPPORTED)return y.destroy(),s._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,K.c)(u)}).`),null;const m=i.reshapeOptions,E=new g({view:a,object:y,enableZVertex:i.enableZ&&"move"===m?.vertexOperation,enableZShape:i.enableZ&&"move"===m?.shapeOperation,enableMoveObject:"move"===m?.shapeOperation||"move-xy"===m?.shapeOperation,enableMidpoints:"split"===m?.edgeOperation,enableEdgeOffset:"offset"===m?.edgeOperation,snappingManager:s.snappingManager,sketchOptions:s.sketchOptions});a.tools.add(E),n||s.updateGraphics.add(y.graphic);const A=[],S=new k({activeComponent:E,tool:l,type:"update",onEnd:()=>{(0,f.ei)(A),gt(a,E),y.destroy()},canUndo:()=>!E.destroyed&&E.canUndo,undo:()=>{E.destroyed||(E.undo(),s._emitUndoEvent({graphics:s.updateGraphics.toArray(),tool:l}))},canRedo:()=>!E.destroyed&&E.canRedo,redo:()=>{E.destroyed||(E.redo(),s._emitRedoEvent({graphics:s.updateGraphics.toArray(),tool:l}))},addToSelection:(O=(0,v.A)(function*(L){s.updateGraphics.add(L),s.emit("update",{graphics:s.updateGraphics.toArray(),state:"active",aborted:!1,tool:s.activeTool,toolEventInfo:{added:[L],removed:[],type:"selection-change"},type:"update"}),S.onEnd(),S.destroy();const x=yield s._setupMove3DOperation(s.updateGraphics.toArray(),i,a,"transform",!0);j(x)||s._setUpdateOperationHandle(x,i)}),function(x){return O.apply(this,arguments)}),removeFromSelection:O=>{s.updateGraphics.remove(O),s.emit("update",{graphics:s.updateGraphics.toArray(),state:"active",aborted:!1,tool:s.activeTool,toolEventInfo:{added:[],removed:[O],type:"selection-change"},type:"update"}),S.complete()},toggleTool:function(){var O=(0,v.A)(function*(){if(!1===i.toggleToolOnClick)return;S.onEnd(),S.destroy();const L=yield s._setupGraphicTransform3DOperation(s.updateGraphics.toArray(),i,a,!0);j(L)||s._setUpdateOperationHandle(L,i)});return function(){return O.apply(this,arguments)}}()});var O;return A.push(...s._getHandlesForComponent(S,i),a.on("immediate-click",O=>s._getCommonUpdateOperationClickHandlers(S,O,i),Z.o.WIDGET),a.on("key-down",O=>{s._getCommonUpdateOperationKeyDownHandlers(S,O)},Z.o.WIDGET)),S})()}_setupTransformOrReshape2DOperation(t,i,a,n){var s=this;return(0,v.A)(function*(){s.updateGraphics.addMany(t),yield s._updatingHandles.addPromise(s._updateSpatialReference(t));const l="transform"===i?yield s._getBox(t,a,n):yield s._getReshape(t,a,n);if(j(l))return l;const p=new k({activeComponent:l,type:"update",onEnd:()=>{(0,f.ei)(g),(0,f.ei)(d),p.activeComponent&&!p.activeComponent.destroyed&&p.activeComponent.destroy(),s._internalGraphicsLayer.removeMany(s.updateGraphics.toArray())},undo:()=>{ut(p,s.updateGraphics.toArray()),p.refreshComponent(),s._emitUndoEvent({graphics:s.updateGraphics.toArray(),tool:p.tool})},redo:()=>{yt(p,s.updateGraphics.toArray()),p.refreshComponent(),s._emitRedoEvent({graphics:s.updateGraphics.toArray(),tool:p.tool})},addToSelection:(y=(0,v.A)(function*(u){let m=p.activeComponent;if("reshape"===m?.type){const E=[...s.updateGraphics,u];s.updateGraphics.removeAll(),p.onEnd(),p.destroy();const A=yield s._setupTransformOrReshape2DOperation(E,"transform",a,n);if(j(A))return;s._setUpdateOperationHandle(A,a)}else s.updateGraphics.add(u),m.graphics=s.updateGraphics.toArray(),m.refresh(),p.resetHistory();s.emit("update",{graphics:s.updateGraphics.toArray(),state:"active",aborted:!1,tool:s.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"})}),function(m){return y.apply(this,arguments)}),removeFromSelection:function(){var y=(0,v.A)(function*(u){const m=s.updateGraphics.indexOf(u);p.history.undo.forEach(A=>A.updates.splice(m,1)),p.history.redo.forEach(A=>A.updates.splice(m,1)),s.updateGraphics.remove(u);const E=s.updateGraphics.toArray();if(0===E.length)p.complete();else{const A=E[0].geometry;1!==E.length||null==A||"point"!==A.type&&"multipoint"!==A.type?p.activeComponent.graphics=E:p.toggleTool()}s.emit("update",{graphics:E,state:"active",aborted:!1,tool:s.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"})});return function(m){return y.apply(this,arguments)}}(),toggleTool:function(){var y=(0,v.A)(function*(){if(s.updateGraphics.length>1)return;const u=s.updateGraphics.at(0),m=u.geometry;if(null!=m&&("reshape"===p.tool&&("point"===m.type||"multipoint"===m.type)||"transform"===p.tool&&"extent"===m.type))return;let E=null;"transform"===p.tool?E=yield s._getReshape([u],a,n):"reshape"===p.tool&&(E=yield s._getBox([u],a,n)),j(E)||(p.activeComponent?.destroy(),p.activeComponent=E,p.activeComponent&&((0,f.ei)(g),g=s._getHandlesForComponent(p,a)))});return function(){return y.apply(this,arguments)}}()}),d=[n.on("immediate-click",y=>s._getCommonUpdateOperationClickHandlers(p,y,a),Z.o.WIDGET),n.on("key-down",y=>{if(s._getCommonUpdateOperationKeyDownHandlers(p,y),y.key===H.NE.constraint&&!y.repeat&&p){const u=p.activeComponent;u&&"box"===u.type&&(u.preserveAspectRatio=!u.preserveAspectRatio)}},Z.o.WIDGET),n.on("key-up",y=>{if(y.key===H.NE.constraint&&p){const u=p.activeComponent;u&&"box"===u.type&&(u.preserveAspectRatio=!u.preserveAspectRatio)}},Z.o.WIDGET)];var y;let g=s._getHandlesForComponent(p,a);return p})()}_getGraphicMover(t,i,a){var n=this;return(0,v.A)(function*(){const{enableMoveAllGraphics:s,highlightOptions:l}=i,p=yield n._requireModule(Promise.all([r.e(3958),r.e(2076),r.e(3298)]).then(r.bind(r,772)));return j(p)?p:new p.module.default({enableMoveAllGraphics:s,highlightsEnabled:!!l?.enabled,indicatorsEnabled:!1,graphics:t,view:a,callbacks:{onGraphicMoveStart:({dx:d,dy:g,graphic:y})=>{n._displayGrabbingCursor(),n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{dx:d,dy:g,mover:y,type:"move-start"},type:"update"})},onGraphicMove:({dx:d,dy:g,graphic:y})=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{dx:d,dy:g,mover:y,type:"move"},type:"update"}),onGraphicMoveStop:({dx:d,dy:g,graphic:y})=>{n._displayPointerCursor(),n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{dx:d,dy:g,mover:y,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>n._displayPointerCursor(),onGraphicPointerOut:()=>n._displayDefaultCursor()}})})()}_getBox(t,i,a){var n=this;return(0,v.A)(function*(){const{enableRotation:s,enableScaling:l,highlightOptions:p,preserveAspectRatio:d}=i,g=yield n._requireModule(Promise.all([r.e(3930),r.e(8066),r.e(3958),r.e(2076),r.e(8684)]).then(r.bind(r,16352)));if(j(g))return g;const y=n.view?.inputManager?.isModifierKeyDown(H.NE.constraint);return new g.module.default({graphics:t,enableRotation:s,enableScaling:l,highlightsEnabled:!!p?.enabled,preserveAspectRatio:!!d!=!!y,layer:n._internalGraphicsLayer,view:a,sketchOptions:n.sketchOptions,callbacks:{onMoveStart:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onMove:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onMoveStop:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStart:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onScale:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onScaleStop:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStart:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onRotate:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"}),onRotateStop:u=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...u},type:"update"})}})})()}_getReshape(t,i,a){var n=this;return(0,v.A)(function*(){const s="split"===i.reshapeOptions?.edgeOperation,l="move"===i.reshapeOptions?.shapeOperation,p=!!i.highlightOptions?.enabled,d=yield n._requireModule(Promise.all([r.e(3930),r.e(8066),r.e(3958),r.e(3085),r.e(5073),r.e(2076),r.e(5124)]).then(r.bind(r,65124)));return j(d)?d:new d.module.default({enableMidpoints:s,enableMovement:l,graphic:t[0],highlightsEnabled:p,layer:n._internalGraphicsLayer,snappingManager:n.snappingManager,sketchOptions:n.sketchOptions,view:a,callbacks:{onReshapeStart:g=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...g},type:"update"}),onReshape:g=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{...g},type:"update"}),onReshapeStop:({mover:g,type:y})=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{mover:g,type:y},type:"update"}),onMoveStart:({dx:g,dy:y,mover:u,type:m})=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{dx:g,dy:y,mover:u,type:m},type:"update"}),onMove:({dx:g,dy:y,mover:u,type:m})=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{dx:g,dy:y,mover:u,type:m},type:"update"}),onMoveStop:({dx:g,dy:y,mover:u,type:m})=>n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{dx:g,dy:y,mover:u,type:m},type:"update"}),onVertexAdd:({added:g,type:y,vertices:u})=>{const m=g.map(E=>(0,Pt.$K)(E.geometry));n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{added:m,vertices:u,type:y},type:"update"})},onVertexRemove:({removed:g,type:y,vertices:u})=>{const m=g.map(E=>(0,Pt.$K)(E.geometry));n.emit("update",{graphics:n.updateGraphics.toArray(),state:"active",aborted:!1,tool:n.activeTool,toolEventInfo:{removed:m,vertices:u,type:y},type:"update"})}}})})()}_getHandlesForComponent(t,i){const a=t.activeComponent;if(!a)return[];switch(a.type){case"graphic-mover":return[a.on("graphic-click",({graphic:n,viewEvent:s})=>{s.native?.shiftKey&&(s.stopPropagation(),t.removeFromSelection(n))}),a.on("graphic-move-start",n=>t.addToHistory(tt(n.allGraphics)))];case"box":return[a.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,i,n)),a.on("move-start",n=>t.addToHistory(tt(n.graphics))),a.on("rotate-start",n=>t.addToHistory(tt(n.graphics))),a.on("scale-start",n=>t.addToHistory(tt(n.graphics)))];case"reshape":return[a.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(t,i,n)),a.on("move-start",n=>t.addToHistory(tt([n.mover]))),a.on("reshape-start",n=>t.addToHistory(tt([n.graphic]))),a.on("vertex-add",n=>t.addToHistory(tt([n.oldGraphic]))),a.on("vertex-remove",n=>t.addToHistory(tt([n.oldGraphic])))];case"move-3d":return[a.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),a.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),a.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),a.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),a.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,i):t.toggleTool()})];case"transform-3d":return[a.events.on("record-undo",({updates:n})=>{t.addToHistory({updates:n})}),a.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),a.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),a.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),a.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),a.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),a.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),a.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),a.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),a.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),a.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,i):t.toggleTool()})];case"reshape-3d":return[a.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),a.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),a.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),a.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),a.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],t,i):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,i,a){const{graphic:n,viewEvent:s}=a;return s.native?.shiftKey&&n.layer===this.layer?(s.stopPropagation(),t.removeFromSelection(n)):i.toggleToolOnClick?(s.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,i){this._operationHandle=t;const a=this.view?.map;this._disablePopup(i),t.on("complete",()=>{if(t===this._operationHandle){const s=this.updateGraphics.toArray(),l=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),a&&a.remove(this._internalGraphicsLayer),this._restorePopup(i),this.emit("update",{graphics:s,state:"complete",aborted:t.cancelled,tool:l,toolEventInfo:null,type:"update"})}})}_getCommonUpdateOperationClickHandlers(t,i,a){var n=this;return(0,v.A)(function*(){const s=(0,Ut.ZV)(i),l=yield i.async(()=>n._getFirstHit(s));null!=l&&(i.native.shiftKey&&n._toggleSelection([l.graphic],t,a)||n.updateGraphics.includes(l.graphic))?i.stopPropagation():t.complete()})()}_toggleSelection(t,i,a){const n=!!a.multipleSelectionEnabled;return t.some(s=>null!=s&&!(!n||s.layer!==this.layer)&&(this.updateGraphics.includes(s)?i.removeFromSelection(s):i.addToSelection(s),!0))}_getCommonUpdateOperationKeyDownHandlers(t,i){if(!t)return;const a=i.key;a===H.NE.undo&&t.canUndo()?(i.stopPropagation(),t.undo()):a===H.NE.redo&&t.canRedo()?(i.stopPropagation(),t.redo()):a===H.NE.cancel?(i.stopPropagation(),t.cancel()):this.allowDeleteKey&&H.NE.delete.includes(a)&&this._onDeleteKey(i)}_onDeleteKey(t){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const i=this.activeComponent,a=this.updateGraphics.toArray();null!=i&&("reshape"!==i.type||1===a.length&&"point"===a[0].geometry?.type)&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,P.pR)(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:i}=this;return!(!t||null==i)&&(t.attributes?.esriSketchTool||"draw-2d"===i.type&&i.graphic===t||("box"===i.type||"reshape"===i.type)&&i.isUIGraphic(t))}_displayPointerCursor(){this.view?.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(t,i,a){C.A.getLogger(this).error(new jt.A(t,i,a))}_requireModule(t){var i=this;return(0,v.A)(function*(){const a=new AbortController;i._moduleLoaderAbortController=a;const n=yield t;return i._moduleLoaderAbortController!==a||a.signal.aborted?{requireError:"aborted"}:{module:n}})()}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}get test(){}wait(){return(0,M.C_)(()=>!this.updating)}_disablePopupEnabled(t){return"3d"!==this.view?.type||this.updateOnGraphicClick||(t?.toggleToolOnClick??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}_waitViewReady(){var t=this;return(0,v.A)(function*(){const i=t.view;i?((0,P.DC)(t._viewReadyAbortController),t._viewReadyAbortController=new AbortController,yield(0,Q.qr)((0,M.C_)(()=>i?.ready),t._viewReadyAbortController.signal)):t._logMissingView()})()}_logMissingView(){this._logError("sketch:missing-property",Ht("view"))}_logMissingLayer(){this._logError(ve,Ht("layer"))}};(0,h._)([(0,c.MZ)()],D.prototype,"_defaultSnappingManager",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"updating",null),(0,h._)([(0,c.MZ)({readOnly:!0})],D.prototype,"_updatingHandles",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"_operationHandle",void 0),(0,h._)([(0,c.MZ)({readOnly:!0})],D.prototype,"activeTool",null),(0,h._)([(0,c.MZ)({readOnly:!0})],D.prototype,"activeCreateToolDrawMode",null),(0,h._)([(0,c.MZ)()],D.prototype,"activeTooltip",null),(0,h._)([(0,c.MZ)({types:st.Es})],D.prototype,"activeFillSymbol",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"activeLineSymbol",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"activeVertexSymbol",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"allowDeleteKey",void 0),(0,h._)([(0,c.MZ)({readOnly:!0})],D.prototype,"createGraphic",null),(0,h._)([(0,c.MZ)()],D.prototype,"defaultCreateOptions",null),(0,h._)([(0,c.MZ)()],D.prototype,"defaultUpdateOptions",null),(0,h._)([(0,c.MZ)({type:Qt.A,nonNullable:!0})],D.prototype,"labelOptions",null),(0,h._)([(0,c.MZ)()],D.prototype,"layer",void 0),(0,h._)([(0,c.MZ)({types:st.Es})],D.prototype,"pointSymbol",void 0),(0,h._)([(0,c.MZ)({types:st.Es})],D.prototype,"polygonSymbol",void 0),(0,h._)([(0,c.MZ)({types:st.Es})],D.prototype,"polylineSymbol",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"meshSymbol",void 0),(0,h._)([(0,c.MZ)({type:ft,nonNullable:!0})],D.prototype,"snappingOptions",null),(0,h._)([(0,c.MZ)()],D.prototype,"snappingManager",null),(0,h._)([(0,c.MZ)({readOnly:!0})],D.prototype,"state",null),(0,h._)([(0,c.MZ)({type:Jt.A,nonNullable:!0})],D.prototype,"tooltipOptions",null),(0,h._)([(0,c.MZ)({readOnly:!0})],D.prototype,"updateGraphics",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"updateOnGraphicClick",void 0),(0,h._)([(0,c.MZ)()],D.prototype,"creationMode",void 0),(0,h._)([(0,c.MZ)({type:_t.A,nonNullable:!0})],D.prototype,"valueOptions",null),(0,h._)([(0,c.MZ)({types:st.Es})],D.prototype,"vertexSymbol",void 0),(0,h._)([(0,c.MZ)({value:null})],D.prototype,"view",null),(0,h._)([(0,c.MZ)({constructOnly:!0,type:Dt.A})],D.prototype,"sketchOptions",void 0),D=(0,h._)([(0,I.$)("esri.widgets.Sketch.SketchViewModel")],D);const ve="sketch:missing-property",Ht=t=>`Property '${t}' is missing on SketchViewModel.`;function me(t){return"polygon"===t||"rectangle"===t||"circle"===t}function ut(t,i){xt("undo",t.history.undo,t.history.redo,i)}function yt(t,i){xt("redo",t.history.redo,t.history.undo,i)}function xt(t,i,a,n){const s=i.pop();if(!s)return;const l=s.updates,p=[];n.forEach((d,g)=>{const y=l[g];null!=y&&("geometry"in y&&null!=y.geometry&&(p.push({geometry:d.geometry}),d.geometry=y.geometry),"symbol"in y&&null!=y.symbol&&(p.push({symbol:d.symbol}),d.symbol=y.symbol),"undo"in y&&(p.push(y),y[t](d)))}),a.push({updates:p})}function Nt(t,i){null!=t&&i.hasGrabbedManipulators&&(t.activeTool=null)}function tt(t){return{updates:t.map(({geometry:i})=>"mesh"===i?.type?{geometry:i.cloneShallow()}:{geometry:i})}}function gt(t,i){t.tools?.remove(i),i.destroyed||i.destroy()}function j(t){return"requireError"in t&&"aborted"===t.requireError}const fe=D;function vt(t,i){t.networkFeature=i}function it(t){return t.networkFeature}function Oe(t){return"point"===t?.type||"polyline"===t?.type||"polygon"===t?.type}let et=class extends T.A{constructor(t){var i;super(t),i=this,this._createMode=null,this._graphicsLayer=new N.A({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new R.U,this.enabled=!0,this._handleSketchViewModelEvents=function(){var a=(0,v.A)(function*(n){switch(n.type){case"update":switch(n.state){case"active":case"complete":for(const s of n.graphics)it(s).geometry=Oe(s.geometry)?s.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const s of n.graphics){const l=it(s);i._removeNetworkFeature(l)}break;case"create":if(n.graphic&&"complete"===n.state&&i._createMode){const s=n.graphic.geometry?.clone(),l=n.graphic.symbol?.clone();if(!s)break;switch(i._createMode){case"stop":{if("point"!==s.type)break;const{stops:p}=i.layer;if(p.length>0&&p.every(({geometry:g})=>!g)){p.at(0).geometry=s;break}if(p.length>1&&p.filter((g,y)=>0!==y).every(({geometry:g})=>!g)){p.at(1).geometry=s;break}const d=new rt.A({geometry:s});p.add(d),vt(n.graphic,d);break}case"point-barrier":{if("point"!==s.type)break;const p=new b.A({geometry:s,symbol:l});i.layer.pointBarriers.add(p),vt(n.graphic,p);break}case"polyline-barrier":{if("polyline"!==s.type)break;const p=new Y.A({geometry:s,symbol:l});i.layer.polylineBarriers.add(p),vt(n.graphic,p);break}case"polygon-barrier":{if("polygon"!==s.type)break;const p=new z.A({geometry:s,symbol:l});i.layer.polygonBarriers.add(p),vt(n.graphic,p);break}}}}(yield i.view.whenLayerView(i.layer)).emit(n.type,"create"===n.type?function Ee(t){const i=it(t.graphic);return{...t,networkFeature:i}}(n):function Me(t){const i=t.graphics.map(a=>it(a));return{...t,networkFeatures:i}}(n))});return function(n){return a.apply(this,arguments)}}()}initialize(){this._sketchViewModel=new fe({layer:this._graphicsLayer,view:this.view}),this.addHandles([(0,M.wB)(()=>this.enabled,t=>{t?this._activate():this._deactivate()},M.Vh),(0,M.wB)(()=>{const{stops:t,pointBarriers:i,polylineBarriers:a,polygonBarriers:n}=this.layer;return{stops:t,pointBarriers:i,polylineBarriers:a,polygonBarriers:n}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),(0,f.DQ)(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,P.pR)(this._graphicsLayer),this._sketchViewModel=(0,P.pR)(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(t=>it(t))}get updating(){return this._updatingHandles.updating}create(t){switch(this._createMode=t,t){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(t){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(t){const i=this._graphicsLayer.graphics.find(a=>it(a)===t);i&&this._graphicsLayer.remove(i),this._removeNetworkFeature(t)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const t=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(i=>i.toArray().map(a=>{const n=a.toGraphic();return n.networkFeature=a,n}));this._graphicsLayer.removeAll().addMany(t)}_removeNetworkFeature(t){switch(t.type){case"stop":this.layer.stops.remove(t);break;case"point-barrier":this.layer.pointBarriers.remove(t);break;case"polyline-barrier":this.layer.polylineBarriers.remove(t);break;case"polygon-barrier":this.layer.polygonBarriers.remove(t)}}};(0,h._)([(0,c.MZ)()],et.prototype,"enabled",void 0),(0,h._)([(0,c.MZ)({constructOnly:!0})],et.prototype,"layer",void 0),(0,h._)([(0,c.MZ)({readOnly:!0})],et.prototype,"selectedNetworkFeatures",null),(0,h._)([(0,c.MZ)()],et.prototype,"updating",null),(0,h._)([(0,c.MZ)({constructOnly:!0})],et.prototype,"view",void 0),et=(0,h._)([(0,I.$)("esri.views.2d.layers.support.RouteLayerInteraction")],et)},66298:(V,G,r)=>{var T,f;function h(f){switch(f){case T.SUPPORTED:break;case T.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case T.GEOMETRY_MISSING:return"no geometry";case T.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case T.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case T.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}r.d(G,{c:()=>h,d:()=>T}),r(3248),(f=T||(T={}))[f.SUPPORTED=0]="SUPPORTED",f[f.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",f[f.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",f[f.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",f[f.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",f[f.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"},70903:(V,G,r)=>{r.d(G,{Y:()=>f}),r(3248);var h=r(73812),T=r(66298);function f(P){if(P.graphic&&"graphics"!==P.graphic.layer?.type)return T.d.GRAPHICS_LAYER_MISSING;const M=P.operations?.data.type;if(!M)return T.d.GEOMETRY_TYPE_UNSUPPORTED;switch(M){case"polygon":case"point":case"polyline":case"mesh":break;default:return T.d.GEOMETRY_TYPE_UNSUPPORTED}return(0,h.wz)(P.elevationInfo)?T.d.ELEVATION_MODE_UNSUPPORTED:T.d.SUPPORTED}},74794:(V,G,r)=>{r.d(G,{X:()=>c});var v=r(67685),T=(r(83953),r(28714)),f=r(25866),P=r(73812);function c(I,R,N,b,z=(0,f.vt)()){const Y=(0,T.c)(U,I);return Y[2]=(0,P.xS)(b,Y,R,N)||0,b.renderCoordsHelper.toRenderCoords(Y,R,z),z}const U=(0,f.vt)();(0,v.QG)(),(0,v.QG)()},4398:(V,G,r)=>{function v(T,f,P){if(!f||!T?.map)return;const{map:M}=T,c=M.layers.find(U=>U===f);c||M.add(f,P),c&&null!=P&&M.layers.reorder(c,P)}function h(T,f){const P="subtype-sublayer"===f?.type?f.parent:f;return T.allLayerViews.find(M=>{const c=M.layer;return c===P||"sublayers"in c&&null!=c.sublayers&&c.sublayers.includes(P)})}r.d(G,{Y:()=>v,i:()=>h})},50044:(V,G,r)=>{r.d(G,{X:()=>P});var v=r(79765),h=r(3548),T=r(77245),f=r(49973);class P extends T.w{constructor(c){super({...c,isDraped:!0,constraint:new v.en(c.edgeStart,c.edgeEnd,c.getGroundElevation)})}get hints(){return[new f.c(h.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75602:(V,G,r)=>{r.d(G,{z:()=>P});var v=r(79765),h=r(3548),T=r(77245),f=r(49973);class P extends T.w{constructor(c){super({...c,constraint:new v.Mn(c.edgeStart,c.edgeEnd)})}get hints(){return[new f.c(h.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},77245:(V,G,r)=>{r.d(G,{w:()=>T});var v=r(26161),h=r(59093);class T extends h.C{constructor({targetPoint:P,objectId:M,constraint:c,isDraped:U}){super(P,c,U,v.n.FEATURE),this.objectId=M}}},87246:(V,G,r)=>{r.d(G,{N:()=>P});var v=r(79765),h=r(26161),T=r(59093),f=r(53726);class P extends T.C{constructor(c,U,C,B){super(c,new v.i7(c),B,h.n.ALL),this.first=U,this.second=C}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new f.v(this.targetPoint,this.isDraped,this.domain)]}}},27279:(V,G,r)=>{r.d(G,{o:()=>M});var v=r(79765),h=r(26161),T=r(3548),f=r(59093),P=r(49973);class M extends f.C{constructor({lineStart:U,lineEnd:C,targetPoint:B,isDraped:I}){super(B,new v.WG(U,C),I,h.n.SELF),this._referenceLineHint=new P.c(T.H3.REFERENCE_EXTENSION,U,C,I,this.domain)}get hints(){return[this._referenceLineHint,new P.c(T.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}},34518:(V,G,r)=>{r.d(G,{B:()=>B});var v=r(28714),h=r(25866),T=r(79765),f=r(29280),P=r(26161),M=r(3548),c=r(59093),U=r(49973),C=r(5579);class B extends c.C{constructor({referenceLine:R,lineStart:N,targetPoint:b,isDraped:z}){const Y=(0,h.o8)(N),{left:rt,right:$}=R;(0,v.d)(Y,(0,v.g)(Y,Y,$),rt),super(b,new T.WG(N,(0,f._7)(Y)),z,P.n.SELF),this._referenceLines=[{edge:R,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new U.c(M.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new C.r(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(R=>new U.c(M.H3.REFERENCE,R.edge.left,R.edge.right,this.isDraped,this.domain,R.fadeLeft,R.fadeRight))]}addReferenceLine(R){const N={edge:R,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(b=>{(0,v.p)(R.right,b.edge.left)&&(b.fadeLeft=!1,N.fadeRight=!1),(0,v.p)(R.right,b.edge.right)&&(b.fadeRight=!1,N.fadeRight=!1),(0,v.p)(R.left,b.edge.right)&&(b.fadeRight=!1,N.fadeLeft=!1),(0,v.p)(R.left,b.edge.left)&&(b.fadeLeft=!1,N.fadeLeft=!1)}),this._referenceLines.push(N)}}},34958:(V,G,r)=>{r.d(G,{HJ:()=>M,_b:()=>U,pn:()=>c});var c,U,C,v=r(26161),h=r(3548),T=r(59093),f=r(49973),P=r(31158);class M extends T.C{constructor({targetPoint:B,constraint:I,previousVertex:R,otherVertex:N,otherVertexType:b,isDraped:z,selfSnappingType:Y,objectId:rt,domain:$}){super(B,I,z,$??v.n.SELF),this.previousVertex=R,this.otherVertex=N,this.otherVertexType=b,this.selfSnappingType=Y??U.None,this.objectId=rt??null}get hints(){const B=this.previousVertex,I=this.otherVertexType===c.CENTER?this.otherVertex:this.targetPoint,R=this.otherVertexType===c.CENTER?this.targetPoint:this.otherVertex;return[new f.c(h.H3.TARGET,I,R,this.isDraped,this.domain),new f.c(h.H3.REFERENCE,B,I,this.isDraped,this.domain),new P.l(this.previousVertex,I,R,this.isDraped,this.domain)]}}(C=c||(c={}))[C.NEXT=0]="NEXT",C[C.CENTER=1]="CENTER",function(C){C[C.None=0]="None",C[C.LastVertex=1]="LastVertex",C[C.FirstVertex=2]="FirstVertex",C[C.ExistingEdge=3]="ExistingEdge"}(U||(U={}))},37154:(V,G,r)=>{r.d(G,{R:()=>I});var v=r(83953),h=r(28714),T=r(25866),f=r(79765),P=r(29280),M=r(26161),c=r(3548),U=r(59093),C=r(49973),B=r(31158);class I extends U.C{constructor({targetPoint:N,point1:b,point2:z,isDraped:Y}){super(N,new f.ej((0,P._7)((0,h.m)((0,T.vt)(),b,z,.5)),.5*(0,v.Io)((0,P.Xz)(b),(0,P.Xz)(z))),Y,M.n.SELF),this._p1=b,this._p2=z}get hints(){return[new C.c(c.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new C.c(c.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new B.l(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}},59093:(V,G,r)=>{r.d(G,{C:()=>v});class v{constructor(T,f,P,M){this.targetPoint=T,this.constraint=f,this.isDraped=P,this.domain=M}}},84586:(V,G,r)=>{r.d(G,{j:()=>P});var v=r(67685),h=r(25866),T=r(8675),f=r(74794);function P(C,B,I,R){return"2d"===R.type?(M.x=C[0],M.y=C[1],M.spatialReference=B,R.toScreen(M)):((0,f.X)(C,B,I,R,c),R.state.camera.projectToScreen(c,U),(0,v.tc)(U[0],U[1]))}const M=(0,T.T)(0,0,0,null),c=(0,h.vt)(),U=(0,v.gs)()}}]);