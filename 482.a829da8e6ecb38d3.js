"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[482,7451],{39693:(H,S,e)=>{e.d(S,{P:()=>d,L:()=>c});var g=e(8189),f=e(98877),C=e(29529),m=e(77806),p=e(26514);class D{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(p.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(r){const t=new D,s=this._originStores[p.Gr.DEFAULTS];s&&s.forEach((n,u)=>{t.set(u,(0,m.o8)(n),p.Gr.DEFAULTS)});for(let n=p.Gr.SERVICE;n<p.AU;n++){const u=this._originStores[n];u&&u.forEach((P,E)=>{r&&r.has(E)||t.set(E,(0,m.o8)(P),n)})}return t}get(r,t){const s=void 0===t?this._values:this._originStores[t];return s?s.get(r):void 0}keys(r){const t=null==r?this._values:this._originStores[r];return t?[...t.keys()]:[]}set(r,t,s=p.Gr.USER){let n=this._originStores[s];if(n||(n=new Map,this._originStores[s]=n),n.set(r,t),!this._values.has(r)||this._propertyOriginMap.get(r)<=s){const u=this._values.get(r);return this._values.set(r,t),this._propertyOriginMap.set(r,s),u!==t}return!1}delete(r,t=p.Gr.USER){const s=this._originStores[t];if(!s)return;const n=s.get(r);if(s.delete(r),this._values.has(r)&&this._propertyOriginMap.get(r)===t){this._values.delete(r);for(let u=t-1;u>=0;u--){const P=this._originStores[u];if(P&&P.has(r)){this._values.set(r,P.get(r)),this._propertyOriginMap.set(r,u);break}}}return n}has(r,t){const s=void 0===t?this._values:this._originStores[t];return!!s&&s.has(r)}revert(r,t){for(;t>0&&!this.has(r,t);)--t;const s=this._originStores[t],n=s?.get(r),u=this._values.get(r);return this._values.set(r,n),this._propertyOriginMap.set(r,t),u!==n}originOf(r){return this._propertyOriginMap.get(r)||p.Gr.DEFAULTS}forEach(r){this._values.forEach(r)}}var B=e(34813),v=e(74220),I=e(76576);const y=h=>{let r=class extends h{constructor(...t){super(...t);const s=(0,v.oY)(this),n=s.store,u=new D;s.store=u,(0,C.k)(s,n,u)}read(t,s){(0,B.L)(this,t,s)}getAtOrigin(t,s){const n=M(this),u=(0,p.aB)(s);if("string"==typeof t)return n.get(t,u);const P={};return t.forEach(E=>{P[E]=n.get(E,u)}),P}originOf(t){return(0,p.OL)(this.originIdOf(t))}originIdOf(t){return M(this).originOf(t)}revert(t,s){const n=M(this),u=(0,p.aB)(s),P=(0,v.oY)(this);let E;E="string"==typeof t?"*"===t?n.keys(u):[t]:t,E.forEach(l=>{P.invalidate(l),n.revert(l,u),P.commit(l)})}};return r=(0,g._)([(0,I.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],r),r};function M(h){return(0,v.oY)(h).store}let O=class extends(y(f.A)){};O=(0,g._)([(0,I.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],O);var R=e(92073),A=e(56558);const U=h=>{let r=class extends h{constructor(...t){super(...t)}clear(t,s="user"){return _(this).delete(t,(0,p.aB)(s))}write(t,s){return(0,A.M)(this,t=t||{},s),t}setAtOrigin(t,s,n){(0,v.oY)(this).setAtOrigin(t,s,(0,p.aB)(n))}removeOrigin(t){const s=_(this),n=(0,p.aB)(t),u=s.keys(n);for(const P of u)s.originOf(P)===n&&s.set(P,s.get(P,n),p.Gr.USER)}updateOrigin(t,s){const n=_(this),u=(0,p.aB)(s),P=(0,R.Jt)(this,t);for(let E=u+1;E<p.AU;++E)n.delete(t,E);n.set(t,P,u)}toJSON(t){return this.write({},t)}};return r=(0,g._)([(0,I.$)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],r),r.prototype.toJSON.isDefaultToJSON=!0,r};function _(h){return(0,v.oY)(h).store}const d=h=>{let r=class extends(U(y(h))){constructor(...t){super(...t)}};return r=(0,g._)([(0,I.$)("esri.core.MultiOriginJSONSupport")],r),r};let c=class extends(d(f.A)){};c=(0,g._)([(0,I.$)("esri.core.MultiOriginJSONSupport")],c)},30482:(H,S,e)=>{e.r(S),e.d(S,{default:()=>R});var g=e(8189),f=e(5922),C=e(39693),m=e(3804),p=e(85211),I=(e(3248),e(35150),e(40707),e(76576)),y=e(95478),M=e(85551);let O=class extends((0,M.A)((0,C.P)(y.A))){constructor(A){super(A),this.resourceInfo=null,this.type="unknown"}initialize(){this.addResolvingPromise(new Promise((A,U)=>{(0,m._)(()=>{const _=this.resourceInfo&&(this.resourceInfo.layerType||this.resourceInfo.type);let d="Unknown layer type";_&&(d+=" "+_),U(new f.A("layer:unknown-layer-type",d,{layerType:_}))})}))}read(A,U){super.read({resourceInfo:A},U)}write(A,U){return null}};(0,g._)([(0,p.MZ)({readOnly:!0})],O.prototype,"resourceInfo",void 0),(0,g._)([(0,p.MZ)({type:["show","hide"]})],O.prototype,"listMode",void 0),(0,g._)([(0,p.MZ)({json:{read:!1},readOnly:!0,value:"unknown"})],O.prototype,"type",void 0),O=(0,g._)([(0,I.$)("esri.layers.UnknownLayer")],O);const R=O},85551:(H,S,e)=>{e.d(S,{A:()=>n});var g=e(10467),f=e(8189),C=e(23098),m=e(77469),p=e(89563),D=e(89447),B=e(5922),v=e(35150),I=e(11432),y=e(56492),M=e(45272),O=e(85211),U=(e(3248),e(40707),e(17221)),_=e(76576),d=e(50305),c=e(58443),h=e(73874),r=e(46577),t=e(52606),s=e(69927);const n=P=>{let E=class extends P{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,I.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(l){l!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",l))}readPortalItem(l,o,i){if(o.itemId)return new r.default({id:o.itemId,portal:i?.portal})}writePortalItem(l,o){l?.id&&(o.itemId=l.id)}loadFromPortal(l,o){var i=this;return(0,g.A)(function*(){if(i.portalItem?.id)try{const{load:a}=yield Promise.all([e.e(2076),e.e(6180)]).then(e.bind(e,56180));return(0,y.Te)(o),yield a({instance:i,supportedTypes:l.supportedTypes,validateItem:l.validateItem,supportsData:l.supportsData,layerModuleTypeMap:l.layerModuleTypeMap,populateGroupLayer:l.populateGroupLayer},o)}catch(a){throw(0,y.zf)(a)||v.A.getLogger(i).warn(`Failed to load layer (${i.title}, ${i.id}) portal item (${i.portalItem.id})\n  ${a}`),a}})()}finishLoadEditablePortalLayer(l){var o=this;return(0,g.A)(function*(){o._set("userHasEditingPrivileges",yield o._fetchUserHasEditingPrivileges(l).catch(i=>((0,y.QP)(i),!0)))})()}setUserPrivileges(l,o){var i=this;return(0,g.A)(function*(){if(!C.A.userPrivilegesApplied)return i.finishLoadEditablePortalLayer(o);if(i.url)try{const{features:{edit:a,fullEdit:j},content:{updateItem:L}}=yield i._fetchUserPrivileges(l,o);i._set("userHasEditingPrivileges",a),i._set("userHasFullEditingPrivileges",j),i._set("userHasUpdateItemPrivileges",L)}catch(a){(0,y.QP)(a)}})()}_fetchUserPrivileges(l,o){var i=this;return(0,g.A)(function*(){let a=i.portalItem;if(!l||!a||!a.loaded||a.sourceUrl)return i._fetchFallbackUserPrivileges(o);const j=!m.id?.findCredential(i.url),L=l===a.id;if(L&&a.portal.user)return i._getUserPrivileges(a,j);let T,G;if(L)T=a.portal.url;else try{T=yield(0,c.wI)(i.url,o)}catch(K){(0,y.QP)(K)}if(!T||!(0,M.b8)(T,a.portal.url))return i._fetchFallbackUserPrivileges(o);try{const K=null!=o?o.signal:null;G=yield m.id?.getCredential(`${T}/sharing`,{prompt:!1,signal:K})}catch(K){(0,y.QP)(K)}if(!G)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(L?yield a.reload():(a=new r.default({id:l,portal:{url:T}}),yield a.load(o)),a.portal.user)return i._getUserPrivileges(a,j)}catch(K){(0,y.QP)(K)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_getUserPrivileges(l,o){const i=(0,s.It)(l);return o&&(i.features.edit=!0),i}_fetchFallbackUserPrivileges(l){var o=this;return(0,g.A)(function*(){let i=!0;try{i=yield o._fetchUserHasEditingPrivileges(l)}catch(a){(0,y.QP)(a)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(l){var o=this;return(0,g.A)(function*(){const i=o.url?m.id?.findCredential(o.url):null;if(!i)return!0;const a=u.credential===i?u.user:yield o._fetchEditingUser(l);return u.credential=i,u.user=a,null==a?.privileges||a.privileges.includes("features:user:edit")})()}_fetchEditingUser(l){var o=this;return(0,g.A)(function*(){const i=o.portalItem?.portal?.user;if(i)return i;const a=m.id?.findServerInfo(o.url??"");if(!a?.owningSystemUrl)return null;const j=`${a.owningSystemUrl}/sharing/rest`,L=h.A.getDefault();if(L&&L.loaded&&(0,M.S8)(L.restUrl)===(0,M.S8)(j))return L.user;const T=`${j}/community/self`,G=null!=l?l.signal:null,W=yield(0,D.Ke)((0,p.A)(T,{authMode:"no-prompt",query:{f:"json"},signal:G}));return W.ok?t.A.fromJSON(W.value.data):null})()}read(l,o){o&&(o.layer=this),super.read(l,o)}write(l,o){const i=o?.portal,a=this.portalItem?.id&&(this.portalItem.portal||h.A.getDefault());return i&&a&&!(0,M.ut)(a.restUrl,i.restUrl)?(o.messages&&o.messages.push(new B.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(l,{...o,layer:this})}};return(0,f._)([(0,O.MZ)({type:r.default})],E.prototype,"portalItem",null),(0,f._)([(0,U.w)("web-document","portalItem",["itemId"])],E.prototype,"readPortalItem",null),(0,f._)([(0,d.K)("web-document","portalItem",{itemId:{type:String}})],E.prototype,"writePortalItem",null),(0,f._)([(0,O.MZ)({clonable:!1})],E.prototype,"resourceReferences",void 0),(0,f._)([(0,O.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasEditingPrivileges",void 0),(0,f._)([(0,O.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasFullEditingPrivileges",void 0),(0,f._)([(0,O.MZ)({type:Boolean,readOnly:!0})],E.prototype,"userHasUpdateItemPrivileges",void 0),E=(0,f._)([(0,_.$)("esri.layers.mixins.PortalLayer")],E),E},u={credential:null,user:null}},69927:(H,S,e)=>{e.d(S,{It:()=>U,LG:()=>B,OM:()=>y,Sm:()=>M,Y:()=>v,bK:()=>I,mm:()=>A,sQ:()=>O});var g=e(10467),f=e(13970),C=e(32034),m=e(55039);function D(){return(D=(0,g.A)(function*(_){const d=_.spatialReference;if(d.isWGS84)return _.clone();if(d.isWebMercator)return(0,m.ci)(_);const c=C.A.WGS84;return yield(0,f.initializeProjection)(d,c),(0,f.project)(_,c)})).apply(this,arguments)}function B(_,d){if(!v(_,d)){const c=_.typeKeywords;c?c.push(d):_.typeKeywords=[d]}}function v(_,d){return!!_.typeKeywords?.includes(d)}function I(_){return v(_,A.HOSTED_SERVICE)}function y(_,d){const c=_.typeKeywords;if(c){const h=c.indexOf(d);h>-1&&c.splice(h,1)}}function M(_,d,c){c?B(_,d):y(_,d)}function O(_){return R.apply(this,arguments)}function R(){return R=(0,g.A)(function*(_){const d=_.clone().normalize();let c;if(d.length>1)for(const h of d)c?h.width>c.width&&(c=h):c=h;else c=d[0];return function p(_){return D.apply(this,arguments)}(c)}),R.apply(this,arguments)}const A={DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function U(_){const{portal:d,isOrgItem:c,itemControl:h}=_,r=d.user?.privileges;let t=!r||r.includes("features:user:edit"),s=!!c&&!!r?.includes("features:user:fullEdit");const n="update"===h||"admin"===h;return n?s=t=!0:s&&(t=!0),{features:{edit:t,fullEdit:s},content:{updateItem:n}}}}}]);