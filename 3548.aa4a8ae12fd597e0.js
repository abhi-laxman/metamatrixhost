"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[3548],{76974:(j,b,s)=>{s.d(b,{g:()=>v});var x=s(8189),S=s(98877),H=s(63484),T=s(85211),R=(s(3248),s(35150),s(40707),s(76576)),B=s(40856),C=s(14916),G=s(87293);const w={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let v=class extends S.A{constructor(h){super(h),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const h=this.visibleSublayers.map(g=>{const P=(0,C.f)(this.floors,g);return g.toExportImageJSON(P)});return h.length?JSON.stringify(h):null}get hasDynamicLayers(){return this.layer&&(0,G.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(h){this._get("layer")!==h&&(this._set("layer",h),this.removeHandles("layer"),h&&this.addHandles([h.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),h.on("sublayer-update",g=>this.notifyChange(w[g.propertyName]))],"layer"))}get layers(){const h=this.visibleSublayers;return h?h.length?"show:"+h.map(g=>g.id).join(","):"show:-1":null}get layerDefs(){const h=!!this.floors?.length,g=this.visibleSublayers.filter(P=>null!=P.definitionExpression||h&&null!=P.floorInfo);return g.length?JSON.stringify(g.reduce((P,D)=>{const A=(0,C.f)(this.floors,D),M=(0,H.mA)(A,D.definitionExpression);return null!=M&&(P[D.id]=M),P},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers");const h=this.layer;return h&&(h.commitProperty("dpi"),h.commitProperty("imageFormat"),h.commitProperty("imageTransparency"),h.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const h=[];if(!this.layer)return h;const g=this.layer.sublayers,P=this.scale,D=M=>{M.visible&&(0===P||(0,B.zx)(P,M.minScale,M.maxScale))&&(M.sublayers?M.sublayers.forEach(D):h.unshift(M))};g&&g.forEach(D);const A=this._get("visibleSublayers");return!A||A.length!==h.length||A.some((M,Z)=>h[Z]!==M)?h:A}toJSON(){const h=this.layer;let g={dpi:h.dpi,format:h.imageFormat,transparent:h.imageTransparency,gdbVersion:h.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?g.dynamicLayers=this.dynamicLayers:g={...g,layers:this.layers,layerDefs:this.layerDefs},g}};(0,x._)([(0,T.MZ)({readOnly:!0})],v.prototype,"dynamicLayers",null),(0,x._)([(0,T.MZ)()],v.prototype,"floors",void 0),(0,x._)([(0,T.MZ)({readOnly:!0})],v.prototype,"hasDynamicLayers",null),(0,x._)([(0,T.MZ)()],v.prototype,"layer",null),(0,x._)([(0,T.MZ)({readOnly:!0})],v.prototype,"layers",null),(0,x._)([(0,T.MZ)({readOnly:!0})],v.prototype,"layerDefs",null),(0,x._)([(0,T.MZ)({type:Number})],v.prototype,"scale",void 0),(0,x._)([(0,T.MZ)({readOnly:!0})],v.prototype,"version",null),(0,x._)([(0,T.MZ)({readOnly:!0})],v.prototype,"visibleSublayers",null),v=(0,x._)([(0,R.$)("esri.layers.support.ExportImageParameters")],v)},31876:(j,b,s)=>{s.d(b,{F:()=>Z}),s(89952),s(77806);var H=s(97442),T=s(17181);function Z(a,u,m){if(null==a?.timeInfo)return null;const{datesInUnknownTimezone:c=!1,timeOffset:E,useViewTime:f}=a;let O=a.timeExtent;c&&(O=function M(a){if(!a)return a;const{start:u,end:m}=a;return new T.A({start:null!=u?(0,H.S1)(u,u.getTimezoneOffset(),"minutes"):u,end:null!=m?(0,H.S1)(m,m.getTimezoneOffset(),"minutes"):m})}(O));let n=f?u&&O?u.intersection(O):u||O:O;return!n||n.isEmpty||n.isAllTime?n:(E&&(n=n.offset(-E.value,E.unit)),c&&(n=function A(a){if(!a)return a;const{start:u,end:m}=a;return new T.A({start:null!=u?(0,H.S1)(u,-u.getTimezoneOffset(),"minutes"):u,end:null!=m?(0,H.S1)(m,-m.getTimezoneOffset(),"minutes"):m})}(n)),n.equals(m)?m:n)}s(40920),s(96381)},96381:(j,b,s)=>{s.d(b,{X:()=>x});const x=Symbol("WebScene")},93548:(j,b,s)=>{s.r(b),s.d(b,{default:()=>O});var x=s(10467),S=s(8189),H=s(17715),T=s(35150),W=s(56492),_=s(48900),U=s(85211),C=(s(3248),s(40707),s(76576)),G=s(27641),w=s(72663),v=s(88219),h=s(57141),g=s(9468),P=s(68418),D=s(62931),A=s(41474),M=s(76974),Z=s(31876);const a=n=>{let p=class extends n{initialize(){this.exportImageParameters=new M.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return(0,Z.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,S._)([(0,U.MZ)()],p.prototype,"exportImageParameters",void 0),(0,S._)([(0,U.MZ)({readOnly:!0})],p.prototype,"floors",null),(0,S._)([(0,U.MZ)({readOnly:!0})],p.prototype,"exportImageVersion",null),(0,S._)([(0,U.MZ)()],p.prototype,"layer",void 0),(0,S._)([(0,U.MZ)()],p.prototype,"suspended",void 0),(0,S._)([(0,U.MZ)({readOnly:!0})],p.prototype,"timeExtent",null),p=(0,S._)([(0,C.$)("esri.views.layers.MapImageLayerView")],p),p};var u=s(96081),m=s(96006),c=s(23868),E=s(56253);let f=class extends(a((0,u.A)((0,v.e)(A.A)))){constructor(){super(...arguments),this._highlightGraphics=new G.Y,this._updateHash=""}fetchPopupFeaturesAtLocation(n,p){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(n,p)}update(n){const p=`${this.exportImageVersion}/${n.state.id}/${n.pixelRatio}/${n.stationary}`;this._updateHash!==p&&(this._updateHash=p,this.strategy.update(n).catch(d=>{(0,W.zf)(d)||T.A.getLogger(this).error(d)}),n.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(n.state.resolution)),this._highlightView.processUpdate(n)}attach(){const{imageMaxWidth:n,imageMaxHeight:p,version:d}=this.layer,I=d>=10.3,y=d>=10;this._bitmapContainer=new w.l,this.container.addChild(this._bitmapContainer),this._highlightView=new h.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new m.Uh({createFetchPopupFeaturesQueryGeometry:(L,V)=>(0,c.V)(L,V,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(L,V)=>{this._highlightView.graphicUpdateHandler({graphic:L,property:V})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new P.A({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:n,imageMaxHeight:p,imageRotationSupported:I,imageNormalizationSupported:y,hidpi:!0}),this.addAttachHandles((0,_.wB)(()=>this.exportImageVersion,()=>this.requestUpdate())),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(n){return this.layer.serviceSupportsSpatialReference(n)}doRefresh(){var n=this;return(0,x.A)(function*(){n._updateHash="",n.requestUpdate()})()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(n,p,d,I){return this.layer.fetchImage(n,p,d,{timeExtent:this.timeExtent,floors:this.floors,...I})}fetchImageBitmap(n,p,d,I){return this.layer.fetchImageBitmap(n,p,d,{timeExtent:this.timeExtent,floors:this.floors,...I})}highlight(n,p){const d=(0,D.Oq)(n);if(0===d.length)return(0,H.hA)();const I=p?.name??E.Tv;return this._addHighlightGraphics(d,I),(0,H.hA)(()=>!this.destroyed&&this._removeHighlightGraphics(d,I))}_processHighlight(){const n=this._getHighlights();this._highlightView?.setHighlight(n)}_addHighlightGraphics(n,p){this._highlightGraphics.addMany(n),this._addHighlights(n.map(d=>d.uid),p)}_removeHighlightGraphics(n,p){this._highlightGraphics.removeMany(n),this._removeHighlights(n.map(d=>d.uid),p)}};(0,S._)([(0,U.MZ)()],f.prototype,"strategy",void 0),(0,S._)([(0,U.MZ)()],f.prototype,"updating",void 0),f=(0,S._)([(0,C.$)("esri.views.2d.layers.MapImageLayerView2D")],f);const O=f}}]);