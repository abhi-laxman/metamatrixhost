"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[8779,9557],{53781:(te,z,o)=>{o.d(z,{a:()=>g,b:()=>I,c:()=>h,d:()=>w,e:()=>V,f:()=>Y,g:()=>_,h:()=>F,j:()=>W,l:()=>J,n:()=>Z,s:()=>M,t:()=>f});var u=o(85952);function h(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s}function M(s,i,a,x,U){return s[0]=i,s[1]=a,s[2]=x,s[3]=U,s}function _(s,i,a){return s[0]=i[0]+a[0],s[1]=i[1]+a[1],s[2]=i[2]+a[2],s[3]=i[3]+a[3],s}function d(s,i,a){return s[0]=i[0]-a[0],s[1]=i[1]-a[1],s[2]=i[2]-a[2],s[3]=i[3]-a[3],s}function b(s,i,a){return s[0]=i[0]*a[0],s[1]=i[1]*a[1],s[2]=i[2]*a[2],s[3]=i[3]*a[3],s}function C(s,i,a){return s[0]=i[0]/a[0],s[1]=i[1]/a[1],s[2]=i[2]/a[2],s[3]=i[3]/a[3],s}function I(s,i,a){return s[0]=i[0]*a,s[1]=i[1]*a,s[2]=i[2]*a,s[3]=i[3]*a,s}function H(s,i){const a=i[0]-s[0],x=i[1]-s[1],U=i[2]-s[2],B=i[3]-s[3];return Math.sqrt(a*a+x*x+U*U+B*B)}function w(s,i){const a=i[0]-s[0],x=i[1]-s[1],U=i[2]-s[2],B=i[3]-s[3];return a*a+x*x+U*U+B*B}function W(s){const i=s[0],a=s[1],x=s[2],U=s[3];return Math.sqrt(i*i+a*a+x*x+U*U)}function Y(s){const i=s[0],a=s[1],x=s[2],U=s[3];return i*i+a*a+x*x+U*U}function Z(s,i){const a=i[0],x=i[1],U=i[2],B=i[3];let L=a*a+x*x+U*U+B*B;return L>0&&(L=1/Math.sqrt(L),s[0]=a*L,s[1]=x*L,s[2]=U*L,s[3]=B*L),s}function F(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]}function J(s,i,a,x){const U=i[0],B=i[1],L=i[2],$=i[3];return s[0]=U+x*(a[0]-U),s[1]=B+x*(a[1]-B),s[2]=L+x*(a[2]-L),s[3]=$+x*(a[3]-$),s}function f(s,i,a){const x=i[0],U=i[1],B=i[2],L=i[3];return s[0]=a[0]*x+a[4]*U+a[8]*B+a[12]*L,s[1]=a[1]*x+a[5]*U+a[9]*B+a[13]*L,s[2]=a[2]*x+a[6]*U+a[10]*B+a[14]*L,s[3]=a[3]*x+a[7]*U+a[11]*B+a[15]*L,s}function g(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]}function V(s,i){const a=s[0],x=s[1],U=s[2],B=s[3],L=i[0],$=i[1],ee=i[2],re=i[3],q=(0,u.FD)();return Math.abs(a-L)<=q*Math.max(1,Math.abs(a),Math.abs(L))&&Math.abs(x-$)<=q*Math.max(1,Math.abs(x),Math.abs($))&&Math.abs(U-ee)<=q*Math.max(1,Math.abs(U),Math.abs(ee))&&Math.abs(B-re)<=q*Math.max(1,Math.abs(B),Math.abs(re))}Object.freeze(Object.defineProperty({__proto__:null,add:_,ceil:function c(s,i){return s[0]=Math.ceil(i[0]),s[1]=Math.ceil(i[1]),s[2]=Math.ceil(i[2]),s[3]=Math.ceil(i[3]),s},copy:h,copyVec3:function v(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s},dist:H,distance:H,div:C,divide:C,dot:F,equals:V,exactEquals:g,floor:function m(s,i){return s[0]=Math.floor(i[0]),s[1]=Math.floor(i[1]),s[2]=Math.floor(i[2]),s[3]=Math.floor(i[3]),s},inverse:function N(s,i){return s[0]=1/i[0],s[1]=1/i[1],s[2]=1/i[2],s[3]=1/i[3],s},len:W,length:W,lerp:J,max:function R(s,i,a){return s[0]=Math.max(i[0],a[0]),s[1]=Math.max(i[1],a[1]),s[2]=Math.max(i[2],a[2]),s[3]=Math.max(i[3],a[3]),s},min:function S(s,i,a){return s[0]=Math.min(i[0],a[0]),s[1]=Math.min(i[1],a[1]),s[2]=Math.min(i[2],a[2]),s[3]=Math.min(i[3],a[3]),s},mul:b,multiply:b,negate:function A(s,i){return s[0]=-i[0],s[1]=-i[1],s[2]=-i[2],s[3]=-i[3],s},normalize:Z,random:function T(s,i=1){const a=u.Ov;let x,U,B,L,$,ee;do{x=2*a()-1,U=2*a()-1,$=x*x+U*U}while($>=1);do{B=2*a()-1,L=2*a()-1,ee=B*B+L*L}while(ee>=1);const re=Math.sqrt((1-$)/ee);return s[0]=i*x,s[1]=i*U,s[2]=i*B*re,s[3]=i*L*re,s},round:function p(s,i){return s[0]=Math.round(i[0]),s[1]=Math.round(i[1]),s[2]=Math.round(i[2]),s[3]=Math.round(i[3]),s},scale:I,scaleAndAdd:function O(s,i,a,x){return s[0]=i[0]+a[0]*x,s[1]=i[1]+a[1]*x,s[2]=i[2]+a[2]*x,s[3]=i[3]+a[3]*x,s},set:M,sqrDist:w,sqrLen:Y,squaredDistance:w,squaredLength:Y,str:function y(s){return"vec4("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+")"},sub:d,subtract:d,transformMat4:f,transformQuat:function P(s,i,a){const x=i[0],U=i[1],B=i[2],L=a[0],$=a[1],ee=a[2],re=a[3],q=re*x+$*B-ee*U,ce=re*U+ee*x-L*B,de=re*B+L*U-$*x,ue=-L*x-$*U-ee*B;return s[0]=q*re+ue*-L+ce*-ee-de*-$,s[1]=ce*re+ue*-$+de*-L-q*-ee,s[2]=de*re+ue*-ee+q*-$-ce*-L,s[3]=i[3],s}},Symbol.toStringTag,{value:"Module"}))},63583:(te,z,o)=>{var u,h;o.d(z,{u:()=>u}),(h=u||(u={}))[h.KILOBYTES=1024]="KILOBYTES",h[h.MEGABYTES=1048576]="MEGABYTES",h[h.GIGABYTES=1073741824]="GIGABYTES"},89141:(te,z,o)=>{function u(){return[0,0,0,0]}function h(A){return[A[0],A[1],A[2],A[3]]}function v(A,N,Z,F){return[A,N,Z,F]}function M(A,N,Z,F){return[A,N,Z,F]}function _(A,N=[0,0,0,0]){const Z=Math.min(4,A.length);for(let F=0;F<Z;++F)N[F]=A[F];return N}function C(){return v(1,1,1,1)}function c(){return v(1,0,0,0)}function m(){return v(0,1,0,0)}function S(){return v(0,0,1,0)}function R(){return v(0,0,0,1)}o.d(z,{CN:()=>M,Un:()=>I,ci:()=>_,fA:()=>v,o8:()=>h,uY:()=>p,vt:()=>u});const p=[0,0,0,0],I=C(),O=c(),H=m(),w=S(),W=R();Object.freeze(Object.defineProperty({__proto__:null,ONES:I,UNIT_W:W,UNIT_X:O,UNIT_Y:H,UNIT_Z:w,ZEROS:p,clone:h,create:u,createView:function d(A,N){return new Float64Array(A,N,4)},freeze:M,fromArray:_,fromValues:v,ones:C,unitW:R,unitX:c,unitY:m,unitZ:S,zeros:function b(){return[0,0,0,0]}},Symbol.toStringTag,{value:"Module"}))},11445:(te,z,o)=>{o.d(z,{Qf:()=>C,Qh:()=>_,RS:()=>v,ez:()=>S,i5:()=>R,lM:()=>M,qK:()=>m});var u=o(79139);const v=16;function M(p){if(!p)return 0;let I=m;for(const O in p)p.hasOwnProperty(O)&&(I+=b(p[O],!1));return I}function _(p){if(!p)return 0;if("number"==typeof p[0])return C(p);if(Array.isArray(p))return function d(p){const I=p.length;if(0===I||"number"==typeof p[0])return c(p,8);let O=S;for(let H=0;H<I;H++)O+=b(p[H]);return O}(p);let I=m;for(const O in p)p.hasOwnProperty(O)&&(I+=b(p[O]));return I}function b(p,I=!0){switch(typeof p){case"object":return I?_(p):m;case"string":return function h(p){return 32+p.length}(p);case"number":return v;case"boolean":return 4;default:return 8}}function C(...p){return p.reduce((I,O)=>I+(O?(0,u.iu)(O)?O.byteLength+R:Array.isArray(O)?c(O,v):0:0),0)}function c(p,I){return S+p.length*I}const m=32,S=16,R=145},42086:(te,z,o)=>{o.d(z,{N3:()=>_,Om:()=>M});var u=o(11445),h=o(27999),v=o(13682);class M{constructor(C=null,c={},m,S,R=0){this.geometry=C,this.attributes=c,this.centroid=m,this.objectId=S,this.displayId=R}static fromJSON(C){const c=C.geometry?v.A.fromJSON(C.geometry):null,m=C.centroid?v.A.fromJSON(C.centroid):null;return new M(c,C.attributes,m,C.objectId)}weakClone(){const C=new M(this.geometry,this.attributes,this.centroid,this.objectId);return C.displayId=this.displayId,C}clone(){const C=this.geometry?.clone(),c=new M(C,{...this.attributes},this.centroid?.clone(),this.objectId);return c.displayId=this.displayId,c}ensureCentroid(C){return this.centroid??=(0,h.Q)(new v.A,this.geometry,C.hasZ,C.hasM),this.centroid}get usedMemory(){return 128+(0,u.lM)(this.attributes)+(this.geometry?.usedMemory??0)}}function _(b){return!!b.geometry?.coords?.length}},61808:(te,z,o)=>{o.d(z,{A:()=>u});class u{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const v=new u;return v.objectIdFieldName=this.objectIdFieldName,v.globalIdFieldName=this.globalIdFieldName,v.geohashFieldName=this.geohashFieldName,v.geometryProperties=this.geometryProperties,v.geometryType=this.geometryType,v.spatialReference=this.spatialReference,v.hasZ=this.hasZ,v.hasM=this.hasM,v.features=this.features,v.fields=this.fields,v.transform=this.transform,v.exceededTransferLimit=this.exceededTransferLimit,v.uniqueIdField=this.uniqueIdField,v.queryGeometry=this.queryGeometry,v.queryGeometryType=this.queryGeometryType,v}}},13682:(te,z,o)=>{o.d(z,{A:()=>v});var u=o(11445);class v{constructor(_=[],d=[]){this.lengths=_??[],this.coords=d??[]}static fromJSON(_){return new v(_.lengths,_.coords)}static fromRect(_){const[d,b,C,c]=_,m=C-d,S=c-b;return new v([5],[d,b,m,0,0,S,-m,0,0,-S])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((_,d)=>_+d)}get usedMemory(){return 64+(0,u.Qf)(this.lengths,this.coords)}area(){let _=0,d=0;if(!this.lengths.length)return 0;for(let b=0;b<this.lengths.length;b++){const C=this.lengths[b];if(C<3)continue;let c=this.coords[2*d],m=this.coords[2*d+1];for(let S=1;S<C;S+=1){const R=this.coords[2*(S+d)],p=this.coords[2*(S+d)+1];_+=-.5*(R-c)*(p+m),c=R,m=p}d+=C}return _}forEachVertex(_){let d=0;this.lengths.length||_(this.coords[0],this.coords[1]);for(let b=0;b<this.lengths.length;b++){const C=this.lengths[b];for(let c=0;c<C;c++)_(this.coords[2*(c+d)],this.coords[2*(c+d)+1]);d+=C}}deltaDecode(){const _=this.clone(),{coords:d,lengths:b}=_;let C=0;for(const c of b){for(let m=1;m<c;m++)d[2*(C+m)]+=d[2*(C+m)-2],d[2*(C+m)+1]+=d[2*(C+m)-1];C+=c}return _}clone(_){if(0===this.lengths.length)return new v([],[this.coords[0],this.coords[1]]);const d=2*(0===this.lengths.length?1:this.lengths.reduce((C,c)=>C+c)),b=this.coords.slice(0,d);return _?(_.set(b),new v(this.lengths,_)):new v(Array.from(this.lengths),Array.from(b))}}},27999:(te,z,o)=>{function u(c,m){return c?m?4:3:m?3:2}function h(c,m,S,R){if(!m?.lengths.length)return null;c.lengths.length&&(c.lengths.length=0),c.coords.length&&(c.coords.length=0);const p=c.coords,I=[],O=S?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:H,coords:w}=m,W=u(S,R);let Y=0;for(const A of H){const N=v(O,w,Y,A,S,R);N&&I.push(N),Y+=A*W}if(I.sort((A,N)=>{let Z=A[2]-N[2];return 0===Z&&S&&(Z=A[4]-N[4]),Z}),I.length){let A=6*I[0][2];p[0]=I[0][0]/A,p[1]=I[0][1]/A,S&&(A=6*I[0][4],p[2]=0!==A?I[0][3]/A:0),(p[0]<O[0]||p[0]>O[1]||p[1]<O[2]||p[1]>O[3]||S&&(p[2]<O[4]||p[2]>O[5]))&&(p.length=0)}if(!p.length){const A=m.lengths[0]?function M(c,m,S,R,p){const I=u(R,p);let O=m,H=m+I,w=0,W=0,Y=0,A=0;for(let N=0,Z=S-1;N<Z;N++,O+=I,H+=I){const F=c[O],J=c[O+1],T=c[O+2],f=c[H],P=c[H+1],y=c[H+2],g=R?d(F,J,T,f,P,y):_(F,J,f,P);if(g)if(w+=g,R){const V=C(F,J,T,f,P,y);W+=g*V[0],Y+=g*V[1],A+=g*V[2]}else{const V=b(F,J,f,P);W+=g*V[0],Y+=g*V[1]}}return w>0?R?[W/w,Y/w,A/w]:[W/w,Y/w]:S>0?R?[c[m],c[m+1],c[m+2]]:[c[m],c[m+1]]:null}(w,0,H[0],S,R):null;if(!A)return null;p[0]=A[0],p[1]=A[1],S&&A.length>2&&(p[2]=A[2])}return c}function v(c,m,S,R,p,I){const O=u(p,I);let H=S,w=S+O,W=0,Y=0,A=0,N=0,Z=0;for(let J=0,T=R-1;J<T;J++,H+=O,w+=O){const f=m[H],P=m[H+1],y=m[H+2],g=m[w],V=m[w+1],X=m[w+2];let k=f*V-g*P;N+=k,W+=(f+g)*k,Y+=(P+V)*k,p&&(k=f*X-g*y,A+=(y+X)*k,Z+=k),f<c[0]&&(c[0]=f),f>c[1]&&(c[1]=f),P<c[2]&&(c[2]=P),P>c[3]&&(c[3]=P),p&&(y<c[4]&&(c[4]=y),y>c[5]&&(c[5]=y))}if(N>0&&(N*=-1),Z>0&&(Z*=-1),!N)return null;const F=[W,Y,.5*N];return p&&(F[3]=A,F[4]=.5*Z),F}function _(c,m,S,R){const p=S-c,I=R-m;return Math.sqrt(p*p+I*I)}function d(c,m,S,R,p,I){const O=R-c,H=p-m,w=I-S;return Math.sqrt(O*O+H*H+w*w)}function b(c,m,S,R){return[c+.5*(S-c),m+.5*(R-m)]}function C(c,m,S,R,p,I){return[c+.5*(R-c),m+.5*(p-m),S+.5*(I-S)]}o.d(z,{Q:()=>h})},48716:(te,z,o)=>{o.d(z,{j:()=>v});var u=o(82663),h=o(47258);const v={unknown:1,inches:(0,u.oU)(1,"meters","inches"),feet:(0,u.oU)(1,"meters","feet"),"us-feet":(0,u.oU)(1,"meters","us-feet"),yards:(0,u.oU)(1,"meters","yards"),miles:(0,u.oU)(1,"meters","miles"),"nautical-miles":(0,u.oU)(1,"meters","nautical-miles"),millimeters:(0,u.oU)(1,"meters","millimeters"),centimeters:(0,u.oU)(1,"meters","centimeters"),decimeters:(0,u.oU)(1,"meters","decimeters"),meters:(0,u.oU)(1,"meters","meters"),kilometers:(0,u.oU)(1,"meters","kilometers"),"decimal-degrees":1/(0,u.vl)(1,"meters",h.$O.radius)}},1832:(te,z,o)=>{function u(h){const v={};for(const M in h){if("declaredClass"===M)continue;const _=h[M];if(null!=_&&"function"!=typeof _)if(Array.isArray(_)){v[M]=[];for(let d=0;d<_.length;d++)v[M][d]=u(_[d])}else"object"==typeof _?_.toJSON&&(v[M]=JSON.stringify(_)):v[M]=_}return v}o.d(z,{z:()=>u})},1277:(te,z,o)=>{o.d(z,{IJ:()=>O,Jf:()=>A,Pk:()=>W,eW:()=>p,gW:()=>Y,kS:()=>w});var u=o(10467),h=o(89563),v=o(45272),M=o(61320),_=o(77098),d=o(58701),b=o(1832),C=o(78304),c=o(98789);const m="Layer does not support extent calculation.";function R(T,f){const P=T.geometry,y=T.toJSON();delete y.compactGeometryEnabled,delete y.defaultSpatialReferenceEnabled;const g=y;let V,X,k;if(null!=P&&(X=P.spatialReference,k=(0,d.YX)(X),g.geometryType=(0,M.$B)(P),g.geometry=function S(T,f){if(f&&"extent"===T.type)return`${T.xmin},${T.ymin},${T.xmax},${T.ymax}`;if(f&&"point"===T.type)return`${T.x},${T.y}`;const P=T.toJSON();return delete P.spatialReference,JSON.stringify(P)}(P,T.compactGeometryEnabled),g.inSR=k),y.groupByFieldsForStatistics&&(g.groupByFieldsForStatistics=y.groupByFieldsForStatistics.join(",")),y.objectIds&&(g.objectIds=y.objectIds.join(",")),y.orderByFields&&(g.orderByFields=y.orderByFields.join(",")),!y.outFields||!y.returnDistinctValues&&(f?.returnCountOnly||f?.returnExtentOnly||f?.returnIdsOnly)?delete g.outFields:g.outFields=y.outFields.includes("*")?"*":y.outFields.join(","),y.outSR?(g.outSR=(0,d.YX)(y.outSR),V=T.outSpatialReference):P&&(y.returnGeometry||y.returnCentroid)&&(g.outSR=g.inSR,V=X),y.returnGeometry&&delete y.returnGeometry,y.outStatistics&&(g.outStatistics=JSON.stringify(y.outStatistics)),y.fullText&&(g.fullText=JSON.stringify(y.fullText)),y.pixelSize&&(g.pixelSize=JSON.stringify(y.pixelSize)),y.quantizationParameters&&(T.defaultSpatialReferenceEnabled&&null!=X&&null!=T.quantizationParameters?.extent&&X.equals(T.quantizationParameters.extent.spatialReference)&&delete y.quantizationParameters.extent.spatialReference,g.quantizationParameters=JSON.stringify(y.quantizationParameters)),y.parameterValues&&(g.parameterValues=JSON.stringify(y.parameterValues)),y.rangeValues&&(g.rangeValues=JSON.stringify(y.rangeValues)),y.dynamicDataSource&&(g.layer=JSON.stringify({source:y.dynamicDataSource}),delete y.dynamicDataSource),y.timeExtent){const ie=y.timeExtent,{start:oe,end:ae}=ie;null==oe&&null==ae||(g.time=oe===ae?oe:`${oe??"null"},${ae??"null"}`),delete y.timeExtent}return T.defaultSpatialReferenceEnabled&&null!=X&&null!=V&&X.equals(V)&&(g.defaultSR=g.inSR,delete g.inSR,delete g.outSR),g}function p(T,f,P,y){return I.apply(this,arguments)}function I(){return(I=(0,u.A)(function*(T,f,P,y){const g=null!=f.timeExtent&&f.timeExtent.isEmpty?{data:{features:[]}}:yield Z(T,f,"json",y);return(0,c.q)(f,P,g.data),g})).apply(this,arguments)}function O(T,f,P,y){return H.apply(this,arguments)}function H(){return(H=(0,u.A)(function*(T,f,P,y){if(null!=f.timeExtent&&f.timeExtent.isEmpty)return{data:P.createFeatureResult()};const g=yield w(T,f,y),V=g;return V.data=(0,C.m)(g.data,P),V})).apply(this,arguments)}function w(T,f,P){return Z(T,f,"pbf",P)}function W(T,f,P){return null!=f.timeExtent&&f.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):Z(T,f,"json",P,{returnIdsOnly:!0})}function Y(T,f,P){return null!=f.timeExtent&&f.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):Z(T,f,"json",P,{returnIdsOnly:!0,returnCountOnly:!0})}function A(T,f,P){return N.apply(this,arguments)}function N(){return(N=(0,u.A)(function*(T,f,P){if(null!=f.timeExtent&&f.timeExtent.isEmpty)return{data:{count:0,extent:null}};const y=yield Z(T,f,"json",P,{returnExtentOnly:!0,returnCountOnly:!0}),g=y.data;if(g.hasOwnProperty("extent"))return y;if(g.features)throw new Error(m);if(g.hasOwnProperty("count"))throw new Error(m);return y})).apply(this,arguments)}function Z(T,f,P){return F.apply(this,arguments)}function F(){return(F=(0,u.A)(function*(T,f,P,y={},g={}){const V="string"==typeof T?(0,v.An)(T):T,X=f.geometry?[f.geometry]:[],k=yield(0,_.el)(X,null,{signal:y.signal}),ie=k?.[0];null!=ie&&((f=f.clone()).geometry=ie);const oe=(0,b.z)({...V.query,f:P,...g,...R(f,g)});return(0,h.A)((0,v.fj)(V.path,function J(T,f){return null!=T.formatOf3DObjects&&!(f.returnCountOnly||f.returnExtentOnly||f.returnIdsOnly)}(f,g)?"query3d":"query"),{...y,responseType:"pbf"===P?"array-buffer":"json",query:{...oe,...y.query}})})).apply(this,arguments)}},98789:(te,z,o)=>{o.d(z,{q:()=>h});var u=o(23743);function h(v,M,_){if(!_?.features||!_.hasZ)return;const d=(0,u.N)(_.geometryType,M,v.outSpatialReference);if(null!=d)for(const b of _.features)d(b.geometry)}},88485:(te,z,o)=>{o.d(z,{A:()=>Z});var I,u=o(8189),h=o(49976),v=o(71065),M=o(11432),_=o(85211),c=(o(3248),o(35150),o(40707),o(17221)),m=o(76576),S=o(50305),R=o(10467),p=o(86300);let O=I=class extends v.A{constructor(F){super(F)}collectRequiredFields(F,J){var T=this;return(0,R.A)(function*(){return(0,p.Dx)(F,J,T.expression)})()}clone(){return new I({expression:this.expression,title:this.title})}equals(F){return this.expression===F.expression&&this.title===F.title}};(0,u._)([(0,_.MZ)({type:String,json:{write:{isRequired:!0}}})],O.prototype,"expression",void 0),(0,u._)([(0,_.MZ)({type:String,json:{write:!0}})],O.prototype,"title",void 0),O=I=(0,u._)([(0,m.$)("esri.symbols.support.FeatureExpressionInfo")],O);const H=O;var W,w=o(82575);const Y=(0,h.O)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),A=new h.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let N=W=class extends v.A{constructor(F){super(F),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(F,J){return F??(J.featureExpression&&0===J.featureExpression.value?{expression:"0"}:void 0)}writeFeatureExpressionInfo(F,J,T,f){J[T]=F.write({},f),"0"===F.expression&&(J.featureExpression={value:0})}get mode(){const{offset:F,featureExpressionInfo:J}=this;return this._isOverridden("mode")?this._get("mode"):null!=F||J?"relative-to-ground":"on-the-ground"}set mode(F){this._override("mode",F)}set unit(F){this._set("unit",F)}write(F,J){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(F,J):null}clone(){return new W({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(F){return this.mode===F.mode&&this.offset===F.offset&&this.unit===F.unit&&(0,M.CM)(this.featureExpressionInfo,F.featureExpressionInfo)}};(0,u._)([(0,_.MZ)({type:H,json:{write:!0}})],N.prototype,"featureExpressionInfo",void 0),(0,u._)([(0,c.w)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],N.prototype,"readFeatureExpressionInfo",null),(0,u._)([(0,S.K)("featureExpressionInfo",{featureExpressionInfo:{type:H},"featureExpression.value":{type:[0]}})],N.prototype,"writeFeatureExpressionInfo",null),(0,u._)([(0,_.MZ)({type:Y.apiValues,nonNullable:!0,json:{type:Y.jsonValues,read:Y.read,write:{writer:Y.write,isRequired:!0}}})],N.prototype,"mode",null),(0,u._)([(0,_.MZ)({type:Number,json:{write:!0}})],N.prototype,"offset",void 0),(0,u._)([(0,_.MZ)({type:w.KQ,json:{type:String,read:A.read,write:A.write}})],N.prototype,"unit",null),N=W=(0,u._)([(0,m.$)("esri.symbols.support.ElevationInfo")],N);const Z=N},82575:(te,z,o)=>{o.d(z,{Ao:()=>M,KQ:()=>d,Tg:()=>v});var u=o(89952),h=o(48716);function v(b){return!!b&&null!=h.j[b]}function M(b){return 1/(h.j[b]||1)}const d=function _(){const b=Object.keys(h.j);return(0,u.TF)(b,"decimal-degrees"),b.sort(),b}()},22079:(te,z,o)=>{o.r(z),o.d(z,{default:()=>Ee});var j,e,u=o(10467),h=o(8189),v=o(42425),M=o(56492),_=o(48900),d=o(85211),C=(o(3248),o(35150)),m=(o(40707),o(76576)),S=o(56985),R=o(32034),p=o(61320),I=o(17256),O=o(64373),H=o(47960),w=o(11333),W=o(87086),Y=o(88485),A=o(97083),N=o(25206),Z=o(16397),F=o(98877),J=o(89952),T=o(89447),f=o(17435),P=o(43085),y=o(28067),g=o(51995),V=o(31732),X=o(68438),k=o(42122),ie=o(1277);class oe{constructor(t,r){this.data=t,this.resolution=r,this.state={type:j.CREATED},this.alive=!0}process(t){switch(this.state.type){case j.CREATED:return this.state=this._gotoFetchCount(this.state,t),this.state.task.promise.then(t.resume,t.resume);case j.FETCH_COUNT:break;case j.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,t),this.state.task.promise.then(t.resume,t.resume);case j.FETCH_FEATURES:break;case j.FETCHED_FEATURES:this.state=this._goToDone(this.state,t)}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case j.CREATED:case j.FETCH_COUNT:return 0;case j.FETCHED_COUNT:return this.state.featureCount;case j.FETCH_FEATURES:return this.state.previous.featureCount;case j.FETCHED_FEATURES:return this.state.features.length;case j.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case j.CREATED:return"created";case j.FETCH_COUNT:return"fetch-count";case j.FETCHED_COUNT:return"fetched-count";case j.FETCH_FEATURES:return"fetch-features";case j.FETCHED_FEATURES:return"fetched-features";case j.DONE:return"done"}}_gotoFetchCount(t,r){var n=this;return{type:j.FETCH_COUNT,previous:t,task:(0,T.UT)(function(){var l=(0,u.A)(function*(E){const D=yield(0,T.DZ)(r.fetchCount(n,E));n.state.type===j.FETCH_COUNT&&(n.state=function ae(e,t){return{type:j.FETCHED_COUNT,featureCount:t,previous:e}}(n.state,D.ok?D.value:1/0))});return function(E){return l.apply(this,arguments)}}())}}_gotoFetchFeatures(t,r){var n=this;return{type:j.FETCH_FEATURES,previous:t,task:(0,T.UT)(function(){var l=(0,u.A)(function*(E){const D=yield(0,T.DZ)(r.fetchFeatures(n,t.featureCount,E));n.state.type===j.FETCH_FEATURES&&(n.state=function me(e,t){return{type:j.FETCHED_FEATURES,previous:e,features:t}}(n.state,D.ok?D.value:[]))});return function(E){return l.apply(this,arguments)}}())}}_goToDone(t,r){return r.finish(this,t.features),{type:j.DONE,previous:t}}reset(){const t=this.state;switch(this.state={type:j.CREATED},t.type){case j.CREATED:case j.FETCHED_COUNT:case j.FETCHED_FEATURES:case j.DONE:break;case j.FETCH_COUNT:case j.FETCH_FEATURES:t.task.abort()}}intersects(t){return null==t||!this.data.extent||((0,g.VY)(t,_e),(0,g.HY)(this.data.extent,_e))}}(e=j||(j={}))[e.CREATED=0]="CREATED",e[e.FETCH_COUNT=1]="FETCH_COUNT",e[e.FETCHED_COUNT=2]="FETCHED_COUNT",e[e.FETCH_FEATURES=3]="FETCH_FEATURES",e[e.FETCHED_FEATURES=4]="FETCHED_FEATURES",e[e.DONE=5]="DONE";const _e=(0,g.vt)();let s=class extends F.A{get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}get _mandatoryOutFields(){const e=new Set;return this.objectIdField&&e.add(this.objectIdField),this.globalIdField&&e.add(this.globalIdField),e}set outFields(e){const t=this._get("outFields"),r=(0,f.KC)(e,this._mandatoryOutFields);(0,f.aI)(r,t)||(this._set("outFields",r),(0,f.Yy)(r,t)||this.refresh())}get outFields(){return this._get("outFields")??this._mandatoryOutFields}set filter(e){const t=this._get("filter"),r=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(r)&&this._set("filter",r)}set customParameters(e){const t=this._get("customParameters");JSON.stringify(t)!==JSON.stringify(e)&&this._set("customParameters",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get("tileInfo");t!==e&&(null!=e&&null!=t&&JSON.stringify(e)===JSON.stringify(t)||(this._set("tileInfo",e),this.store.tileInfo=e))}set tileSize(e){this._get("tileSize")!==e&&this._set("tileSize",e)}get updating(){return this._updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(e){super(e),this.suspended=!0,this._historicMoment=null,this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._updatingHandles=new S.U}initialize(){this._initializeFetchExtent(),this._updatingHandles.add(()=>this._configuration,()=>this.refresh()),this._updatingHandles.add(()=>this.tilesOfInterest,()=>{this._updatePriorities(),this._process()},{sync:!0,initial:!0,equals:(e,t)=>(0,J.aI)(e,t,({id:r},{id:n})=>r===n)}),this.addHandles((0,_.z7)(()=>!this.suspended,()=>this._process()))}_updatePriorities(){this.store.setPriorityOrderByKey(this.tilesOfInterest.map(e=>e.id??"")??[])}destroy(){this._pendingTiles.forEach(e=>this._deletePendingTile(e)),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._updatingHandles.destroy()}refresh(){this.store.refresh(),this._pendingTiles.forEach(e=>this._deletePendingTile(e)),this._process()}handleEdits(e){var t=this;return(0,u.A)(function*(){if(e.historicMoment&&(t._historicMoment=e.historicMoment),!e.addedFeatures.length&&!e.updatedFeatures.length&&!e.deletedFeatures.length)return;for(const l of t._pendingTiles.values())l.reset();const r={...e,deletedFeatures:e.deletedFeatures.map(({objectId:l,globalId:E})=>l&&-1!==l?l:t._lookupObjectIdByGlobalId(E))},n=(0,T.UT)(function(){var l=(0,u.A)(function*(E){try{yield t.store.processEdits(r,(D,G)=>t._queryFeaturesById(D,G),E),t._processPendingTiles()}catch(D){(0,M.QP)(D),C.A.getLogger(t).warn("Failed to apply edits",D)}});return function(E){return l.apply(this,arguments)}}());t.addHandles(n),yield t._updatingHandles.addPromise(n.promise)})()}setHistoricMoment(e){e?.getTime()!==this._historicMoment?.getTime()&&(this._historicMoment=e,this.refresh())}_initializeFetchExtent(){var e=this;if(!this.capabilities.query.supportsExtent||!(0,X.Wo)(this.url))return;const t=(0,T.UT)(function(){var r=(0,u.A)(function*(n){try{const l=yield(0,ie.Jf)(e.url,new W.A({where:"1=1",outSpatialReference:e.spatialReference,cacheHint:e.capabilities.query.supportsCacheHint??void 0}),{query:e._configuration.customParameters,signal:n});e.store.extent=y.A.fromJSON(l.data?.extent)}catch(l){(0,M.QP)(l),C.A.getLogger(e).warn("Failed to fetch data extent",l)}});return function(n){return r.apply(this,arguments)}}());this._updatingHandles.addPromise(t.promise.then(()=>this._process())),this.addHandles(t)}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map(e=>e.debugInfo),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const e of this._pendingTiles.values())e.alive=!1}_createPendingTiles(){if(this.suspended)return;const e=this._collectMissingTilesInfo();if(this._setAvailability(null==e?1:e.coveredArea/e.fullArea),null!=e)for(const{data:t,resolution:r}of e.missingTiles){const n=this._pendingTiles.get(t.id);n?(n.resolution=r,n.alive=!0):this._createPendingTile(t,r)}}_collectMissingTilesInfo(){let e=null;for(const t of this.tilesOfInterest){const r=this.store.process(t,(n,l)=>this._verifyTileComplexity(n,l),this.outFields);null==e?e=r:e.prepend(r)}return e}_deletePendingTiles(){for(const e of this._pendingTiles.values())e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(t,r)=>this._fetchCount(t,r),fetchFeatures:(t,r,n)=>this._fetchFeatures(t,r,n),finish:(t,r)=>this._finishPendingTile(t,r),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const t of this._pendingTiles.values())this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this._updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<x}_verifyFeatureDensity(e,t){if(null==this.tileInfo)return!1;const r=this.tileSize*t;return e*(U/(r*r))<B}_ensureFetchAllCounts(e){let t=!0;for(const r of this._pendingTiles.values())r.state.type<j.FETCHED_COUNT&&this._updatingHandles.addPromise(r.process(e)),r.state.type<=j.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(null==e?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set("availability",e)}_createPendingTile(e,t){const r=new oe(e,t);return this._pendingTiles.set(e.id,r),r}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}_fetchCount(e,t){var r=this;return(0,u.A)(function*(){return r.store.fetchCount(e.data,r.url,r._createCountQuery(e),{query:r.customParameters,timeout:a,signal:t})})()}_fetchFeatures(e,t,r){var n=this;return(0,u.A)(function*(){let l=0;const E=[];let D=0,G=t;for(;;){const K=n._createFeaturesQuery(e),Q=n._setPagingParameters(K,l,G),{features:se,exceededTransferLimit:fe}=yield n._queryFeatures(K,r);Q&&(l+=K.num),D+=se.length;for(const Te of se)E.push(Te);if(G=t-D,!Q||!fe||G<=0)return E}})()}_filterProperties(e){return null==e?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,r=this.objectIdField;if(null==t)throw new Error("Expected globalIdField to be defined");let n=null;const l=e&&(0,P.AG)(e);if(this.store.featureStore.forEach(E=>{l===(0,P.AG)(E.attributes[t])&&(n=E.objectId??E.attributes[r])}),null==n)throw new Error(`Expected to find a feature with globalId ${e}`);return n}_queryFeaturesById(e,t){const r=this._createFeaturesQuery();return r.objectIds=e,this._queryFeatures(r,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}_queryFeaturesPBF(e,t){var r=this;return(0,u.A)(function*(){const{sourceSpatialReference:n}=r,{data:l}=yield(0,ie.IJ)(r.url,e,new k.S({sourceSpatialReference:n}),{query:r._configuration.customParameters,timeout:a,signal:t});return(0,V.eY)(l)})()}_queryFeaturesJSON(e,t){var r=this;return(0,u.A)(function*(){const{sourceSpatialReference:n}=r,{data:l}=yield(0,ie.eW)(r.url,e,n,{query:r._configuration.customParameters,timeout:a,signal:t});return(0,V.q3)(l,r.objectIdField)})()}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e=null){const t=this._createBaseQuery(e),r=null!=e?.data?this.store.getAttributesForTile(e?.data?.id):null,n=(0,f.KC)((0,f.iv)(this.outFields,r??new Set),this._mandatoryOutFields);return t.outFields=Array.from(n),t.returnGeometry=!0,null!=e&&(this.capabilities.query.supportsResultType?t.resultType="tile":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new W.A({returnZ:this.hasZ,returnM:!1,historicMoment:this._historicMoment,geometry:null!=this.tileInfo&&null!=e?(0,g.w1)(e.data.extent,this.tileInfo.spatialReference):void 0}),r=this._configuration.filter;return null!=r&&(t.where=r.where,t.gdbVersion=r.gdbVersion,t.timeExtent=r.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,r){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:n,supportsCacheHint:l,tileMaxRecordCount:E,maxRecordCount:D,supportsResultType:G}=this.capabilities.query,K=n?W.A.MAX_MAX_RECORD_COUNT_FACTOR:1,Q=K*((G||l)&&E?E:D||i);return e.start=t,n?(e.maxRecordCountFactor=Math.min(K,Math.ceil(r/Q)),e.num=Math.min(r,e.maxRecordCountFactor*Q)):e.num=Math.min(r,Q),!0}};(0,h._)([(0,d.MZ)({constructOnly:!0})],s.prototype,"url",void 0),(0,h._)([(0,d.MZ)({constructOnly:!0})],s.prototype,"objectIdField",void 0),(0,h._)([(0,d.MZ)({constructOnly:!0})],s.prototype,"globalIdField",void 0),(0,h._)([(0,d.MZ)({constructOnly:!0})],s.prototype,"capabilities",void 0),(0,h._)([(0,d.MZ)({constructOnly:!0})],s.prototype,"sourceSpatialReference",void 0),(0,h._)([(0,d.MZ)({constructOnly:!0})],s.prototype,"spatialReference",void 0),(0,h._)([(0,d.MZ)({constructOnly:!0})],s.prototype,"store",void 0),(0,h._)([(0,d.MZ)({readOnly:!0})],s.prototype,"_minimumVerticesPerFeature",null),(0,h._)([(0,d.MZ)()],s.prototype,"_mandatoryOutFields",null),(0,h._)([(0,d.MZ)()],s.prototype,"outFields",null),(0,h._)([(0,d.MZ)()],s.prototype,"suspended",void 0),(0,h._)([(0,d.MZ)()],s.prototype,"_historicMoment",void 0),(0,h._)([(0,d.MZ)()],s.prototype,"filter",null),(0,h._)([(0,d.MZ)()],s.prototype,"customParameters",null),(0,h._)([(0,d.MZ)({readOnly:!0})],s.prototype,"_configuration",null),(0,h._)([(0,d.MZ)()],s.prototype,"tileInfo",null),(0,h._)([(0,d.MZ)()],s.prototype,"tileSize",null),(0,h._)([(0,d.MZ)()],s.prototype,"tilesOfInterest",void 0),(0,h._)([(0,d.MZ)({readOnly:!0})],s.prototype,"updating",null),(0,h._)([(0,d.MZ)({readOnly:!0})],s.prototype,"availability",void 0),(0,h._)([(0,d.MZ)()],s.prototype,"hasZ",null),s=(0,h._)([(0,m.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],s);const i=2e3,a=6e5,x=1e6,U=25,B=1;var L=o(63583),$=o(59894),ee=o(25858);class re{constructor(){this._store=new Map,this._priorities=new Map}get size(){return this._store.size}setPriorityOrderByKey(t){this._priorities.clear();for(let r=t.length-1;r>=0;r--)this._priorities.set(t[r],t.length-r)}hasLowerPriority(t){const r=this._priorities.get(t);if(null==r)return!0;for(const[n]of this._store){const l=this._priorities.get(n);if(null==l||l<r)return!0}return!1}someFromLowestToHighestPriority(t){const{_priorities:r}=this;for(const[n,l]of this._store)if(!r.has(n)&&t(l,n))return!0;for(const[n]of r){const l=this._store.get(n);if(l&&t(l,n))return!0}return!1}set(t,r){this._store.set(t,r)}delete(t){return this._store.delete(t)}get(t){return this._store.get(t)}has(t){return this._store.has(t)}clear(){this._store.clear()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}}let q=class extends F.A{setPriorityOrderByKey(e){this._tiles.setPriorityOrderByKey(e)}get _memoryLimitExceeded(){return this.featureStore.usedMemory>=this.maximumByteSize}constructor(e){super(e),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*L.u.MEGABYTES,this._tileBounds=new $.F,this._tiles=new re,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=(0,g.vt)()}add(e,t){for(const E of t)this._referenceFeature(E.objectId);const r=this.featureStore.upsertMany(t),n=r.map(E=>new Set(Object.keys(E.attributes))).reduce((E,D)=>(0,f.E$)(E,D),new Set(Object.keys(r[0]?.attributes??[]))),l=this._memoryLimitExceeded;this._addTileStorage(e,new Set(r.map(E=>E.objectId)),n),l&&this._applyCacheMemoryLimits()}_applyCacheMemoryLimits(){if(!this._memoryLimitExceeded)return;const{_tiles:e,featureStore:t,maximumByteSize:r}=this;e.someFromLowestToHighestPriority(n=>!this._memoryLimitExceeded||t.usedMemory-this._estimateRemoveTileMemoryReduction(n)<r||(this._removeTileStorage(n),!1))}_estimateRemoveTileMemoryReduction(e){let t=0;for(const r of e.objectIds)if(1===this._refCounts.get(r)){const n=this.featureStore.getFeature(r);n&&(t+=this.featureStore.estimateFeatureUsedMemory?.(n)??0)}return t}getAttributesForTile(e){return e?this._tiles.get(e)?.attributeKeys:null}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(e,t,r){return this._processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this._processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),t,r)}_addTileStorage(e,t,r){const n=e.id;this._tiles.set(n,new de(e,t,r)),this._tileBounds.set(n,e.extent),this._tileFeatureCounts.set(n,t.size)}_remove({id:e}){const t=this._tiles.get(e);t&&this._removeTileStorage(t)}_removeTileStorage(e){const t=[];for(const n of e.objectIds)this._unreferenceFeature(n)===le.REMOVED&&t.push(n);this.featureStore.removeManyById(t);const r=e.data.id;this._tiles.delete(r),this._tileBounds.delete(r)}_processEditsDelete(e){this.featureStore.removeManyById(e);for(const t of this._tiles.values()){for(const r of e)t.objectIds.delete(r);this._tileFeatureCounts.set(t.data.id,t.objectIds.size)}for(const t of e)this._refCounts.delete(t)}_processEditsRefetch(e,t,r){var n=this;return(0,u.A)(function*(){if(!e.length)return;const l=(yield t(e,r)).features,{hasZ:E,hasM:D}=n.featureStore;for(const G of l){const K=(0,V.jQ)(n._tmpBoundingRect,G.geometry,E,D);null!=K&&n._tileBounds.forEachInBounds(K,Q=>{const se=n._tiles.get(Q);n.featureStore.add(G);const fe=G.objectId;se.objectIds.has(fe)||(se.objectIds.add(fe),n._referenceFeature(fe),n._tileFeatureCounts.set(se.data.id,se.objectIds.size))})}})()}process(e,t=(()=>!0),r){if(null==this.tileInfo||!e.extent||null!=this.extent&&!(0,g.HY)((0,g.VY)(this.extent,this._tmpBoundingRect),e.extent))return new pe(e);if(this._memoryLimitExceeded&&!this._tiles.hasLowerPriority(e.id??""))return new pe(e);const n=this.getAttributesForTile(e.id);if((0,f.Yy)(r,n))return new pe(e);const l=this._createTileTree(e,this.tileInfo);return this._simplify(l,t,null,0,1),this._collectMissingTiles(e,l,this.tileInfo,r)}get debugInfo(){return Array.from(this._tiles.values()).map(({data:e})=>({data:e,featureCount:this._tileFeatureCounts.get(e.id)||0}))}getFeatureCount(e){return this._tileFeatureCounts.get(e.id)??0}fetchCount(e,t,r,n){var l=this;return(0,u.A)(function*(){const E=l._tileFeatureCounts.get(e.id);if(null!=E)return E;const D=yield(0,ie.gW)(t,r,n);return l._tileFeatureCounts.set(e.id,D.data.count),D.data.count})()}_createTileTree(e,t){const r=new ue(e.level,e.row,e.col);return t.updateTileInfo(r,w.A.ExtrapolateOptions.POWER_OF_TWO),this._tileBounds.forEachInBounds(e.extent,n=>{const l=this._tiles.get(n)?.data;l&&function ce(e,t){if(!e||!t)return!1;if(e.level===t.level)return e.row===t.row&&e.col===t.col;const r=e.level<t.level,n=r?e:t,l=r?t:e,E=1<<l.level-n.level;return Math.floor(l.row/E)===n.row&&Math.floor(l.col/E)===n.col}(e,l)&&this._populateChildren(r,l,t,this._tileFeatureCounts.get(l.id)||0)}),r}_populateChildren(e,t,r,n){const l=t.level-e.level-1;if(l<0)return void(e.isLeaf=!0);const E=t.row>>l,D=t.col>>l,K=D-(e.col<<1)+(E-(e.row<<1)<<1),Q=e.children[K];if(null!=Q)this._populateChildren(Q,t,r,n);else{const se=new ue(e.level+1,E,D);r.updateTileInfo(se,w.A.ExtrapolateOptions.POWER_OF_TWO),e.children[K]=se,this._populateChildren(se,t,r,n)}}_simplify(e,t,r,n,l){const E=l*l;if(e.isLeaf)return t(this.getFeatureCount(e),l)?0:(this._remove(e),null!=r&&(r.children[n]=null),E);const D=l/2,G=D*D;let K=0;for(let Q=0;Q<e.children.length;Q++){const se=e.children[Q];K+=null!=se?this._simplify(se,t,e,Q,D):G}return 0===K?this._mergeChildren(e):1-K/E<ge&&(this._purge(e),null!=r&&(r.children[n]=null),K=E),K}_mergeChildren(e){const t=new Set;let r;this._forEachLeaf(e,n=>{const l=this._tiles.get(n.id);if(l){r=r?(0,f.E$)(r,l.attributeKeys):new Set(l.attributeKeys);for(const E of l.objectIds)t.has(E)||(t.add(E),this._referenceFeature(E));this._remove(n)}}),this._addTileStorage(e,t,r??new Set),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this._tileFeatureCounts.set(e.id,t.size)}_forEachLeaf(e,t){for(const r of e.children)null!=r&&(r.isLeaf?t(r):this._forEachLeaf(r,t))}_purge(e){if(null!=e)if(e.isLeaf)this._remove(e);else for(let t=0;t<e.children.length;t++)this._purge(e.children[t]),e.children[t]=null}_collectMissingTiles(e,t,r,n){const l=new ye(r,e,this.extent);return this._collectMissingTilesRecurse(t,l,1,n),l.info}_collectMissingTilesRecurse(e,t,r,n){const l=this.getAttributesForTile(e.id),E=l&&!(0,f.Yy)(n,l);if(E&&t.addMissing(e.level,e.row,e.col,r),e.isLeaf)return;if(!e.hasChildren)return void(E||t.addMissing(e.level,e.row,e.col,r));const D=r/2;for(let G=0;G<e.children.length;G++){const K=e.children[G];null==K?t.addMissing(e.level+1,(e.row<<1)+((2&G)>>1),(e.col<<1)+(1&G),D):this._collectMissingTilesRecurse(K,t,D,n)}}_referenceFeature(e){const t=(this._refCounts.get(e)||0)+1;return this._refCounts.set(e,t),1===t?le.ADDED:le.UNCHANGED}_unreferenceFeature(e){const t=(this._refCounts.get(e)||0)-1;return 0===t?(this._refCounts.delete(e),le.REMOVED):(t>0&&this._refCounts.set(e,t),le.UNCHANGED)}get test(){}};(0,h._)([(0,d.MZ)({constructOnly:!0})],q.prototype,"featureStore",void 0),(0,h._)([(0,d.MZ)()],q.prototype,"tileInfo",void 0),(0,h._)([(0,d.MZ)()],q.prototype,"extent",void 0),(0,h._)([(0,d.MZ)()],q.prototype,"maximumByteSize",void 0),q=(0,h._)([(0,m.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],q);class de{constructor(t,r,n){this.data=t,this.objectIds=r,this.attributeKeys=n}}class ue{constructor(t,r,n){this.level=t,this.row=r,this.col=n,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(null!=this.children[0]||null!=this.children[1]||null!=this.children[2]||null!=this.children[3])}}class pe{constructor(t,r=[]){this.missingTiles=r,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,g.Wc)(t.extent),this.coveredArea=this.fullArea}prepend(t){this.missingTiles=t.missingTiles.concat(this.missingTiles),this.coveredArea+=t.coveredArea,this.fullArea+=t.fullArea}}class ye{constructor(t,r,n){this._tileInfo=t,this._extent=null,this.info=new pe(r),null!=n&&(this._extent=(0,g.VY)(n))}addMissing(t,r,n,l){const E=new ee.U(null,t,r,n);this._tileInfo.updateTileInfo(E,w.A.ExtrapolateOptions.POWER_OF_TWO),null==E.extent||null!=this._extent&&!(0,g.HY)(this._extent,E.extent)||(this.info.missingTiles.push({data:E,resolution:l}),this.info.coveredArea-=(0,g.Wc)(E.extent))}}const ge=.18751;var le;!function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.UNCHANGED=2]="UNCHANGED"}(le||(le={}));let he=class extends v.A.EventedAccessor{constructor(){var e;super(...arguments),e=this,this._isInitializing=!0,this.remoteClient=null,this._whenSetup=(0,M.Tw)(),this._elevationAligner=(0,A.n)(),this._elevationFilter=(0,N.z)(),this._symbologyCandidatesFetcher=(0,Z.H)(),this._updatingHandles=new S.U,this._alignPointsInFeatures=function(){var t=(0,u.A)(function*(r,n){const l={query:r},E=yield e.remoteClient.invoke("alignElevation",l,{signal:n});return(0,M.Te)(n),E});return function(r,n){return t.apply(this,arguments)}}(),this._getSymbologyCandidates=function(){var t=(0,u.A)(function*(r,n){const l={candidates:r,spatialReference:e._spatialReference.toJSON()},E=yield e.remoteClient.invoke("getSymbologyCandidates",l,{signal:n});return(0,M.Te)(n),E});return function(r,n){return t.apply(this,arguments)}}()}get updating(){return this._isInitializing||this._updatingHandles.updating||this._featureFetcher.updating}destroy(){this._featureFetcher?.destroy(),this._queryEngine?.destroy(),this._featureStore?.clear()}setup(e){var t=this;return(0,u.A)(function*(){if(t.destroyed)return{result:{}};const{geometryType:r,objectIdField:n,timeInfo:l,fieldsIndex:E}=e.serviceInfo,{hasZ:D}=e,G=R.A.fromJSON(e.spatialReference);t._spatialReference=G,t._featureStore=new O.A({...e.serviceInfo,hasZ:D,hasM:!1}),t._featureStore.estimateFeatureUsedMemory=Q=>Q.usedMemory,t._queryEngine=new H.do({spatialReference:e.spatialReference,featureStore:t._featureStore,geometryType:r,fieldsIndex:E,hasZ:D,hasM:!1,objectIdField:n,timeInfo:l}),t._featureFetcher=new s({store:new q({featureStore:t._featureStore}),url:e.serviceInfo.url,objectIdField:e.serviceInfo.objectIdField,globalIdField:e.serviceInfo.globalIdField,capabilities:e.serviceInfo.capabilities,spatialReference:G,sourceSpatialReference:R.A.fromJSON(e.serviceInfo.spatialReference),customParameters:e.configuration.customParameters});const K="3d"===e.configuration.viewType;return t._elevationAligner=(0,A.n)(K,{elevationInfo:null!=e.elevationInfo?Y.A.fromJSON(e.elevationInfo):null,alignPointsInFeatures:t._alignPointsInFeatures}),t._elevationFilter=(0,N.z)(K),t.addHandles([(0,_.wB)(()=>t._featureFetcher.availability,Q=>t.emit("notify-availability",{availability:Q}),_.OH),(0,_.wB)(()=>t.updating,()=>t._notifyUpdating())]),t._whenSetup.resolve(),t._isInitializing=!1,t.configure(e.configuration)})()}configure(e){var t=this;return(0,u.A)(function*(){return yield t._updatingHandles.addPromise(t._whenSetup.promise),t._updateFeatureFetcherConfiguration(e),ne})()}setSuspended(e,t){var r=this;return(0,u.A)(function*(){return yield r._updatingHandles.addPromise(r._whenSetup.promise),(0,M.Te)(t),r._featureFetcher.suspended=e,ne})()}updateOutFields(e,t){var r=this;return(0,u.A)(function*(){return yield r._updatingHandles.addPromise(r._whenSetup.promise),(0,M.Te)(t),r._featureFetcher.outFields=new Set(e??[]),ne})()}fetchCandidates(e,t){var r=this;return(0,u.A)(function*(){yield r._whenSetup.promise,(0,M.Te)(t);const n=function ve(e){if(!e.filter)return{...e,query:{where:"1=1"}};const{distance:t,units:r,spatialRel:n,where:l,timeExtent:E,objectIds:D}=e.filter,G={geometry:e.filter.geometry?(0,p.rS)(e.filter.geometry):void 0,distance:t,units:r,spatialRel:n,timeExtent:E,objectIds:D,where:l??"1=1"};return{...e,query:G}}(e),l=t?.signal,E=yield(0,I.J)(r._queryEngine,n,l);(0,M.Te)(l);const D=yield r._elevationAligner.alignCandidates(E.candidates,R.A.fromJSON(e.point.spatialReference)??R.A.WGS84,l);(0,M.Te)(l);const G=yield r._symbologyCandidatesFetcher.fetch(D,l);(0,M.Te)(l);const K=0===G.length?D:D.concat(G);return{result:{candidates:r._elevationFilter.filter(n,K)}}})()}updateTiles(e,t){var r=this;return(0,u.A)(function*(){return yield r._updatingHandles.addPromise(r._whenSetup.promise),(0,M.Te)(t),r._featureFetcher.tileSize=e.tileSize,r._featureFetcher.tilesOfInterest=e.tiles,r._featureFetcher.tileInfo=null!=e.tileInfo?w.A.fromJSON(e.tileInfo):null,ne})()}refresh(e,t){var r=this;return(0,u.A)(function*(){return yield r._updatingHandles.addPromise(r._whenSetup.promise),(0,M.Te)(t),r._featureFetcher.refresh(),ne})()}whenNotUpdating(e,t){var r=this;return(0,u.A)(function*(){return yield r._updatingHandles.addPromise(r._whenSetup.promise),(0,M.Te)(t),yield(0,_.C_)(()=>!r.updating,t),(0,M.Te)(t),ne})()}getDebugInfo(e,t){var r=this;return(0,u.A)(function*(){return(0,M.Te)(t),{result:r._featureFetcher.debugInfo}})()}handleEdits(e,t){var r=this;return(0,u.A)(function*(){return yield r._updatingHandles.addPromise(r._whenSetup.promise),(0,M.Te)(t),yield r._updatingHandles.addPromise(r._featureFetcher.handleEdits(e)),(0,M.Te)(t),ne})()}setHistoricMoment(e,t){var r=this;return(0,u.A)(function*(){return r._featureFetcher.setHistoricMoment(e.moment),ne})()}notifyElevationSourceChange(e,t){var r=this;return(0,u.A)(function*(){return r._elevationAligner.notifyElevationSourceChange(),ne})()}notifySymbologyChange(e,t){var r=this;return(0,u.A)(function*(){return r._symbologyCandidatesFetcher.notifySymbologyChange(),ne})()}setSymbologySnappingSupported(e){var t=this;return(0,u.A)(function*(){return t._symbologyCandidatesFetcher=(0,Z.H)(e,t._getSymbologyCandidates),ne})()}_updateFeatureFetcherConfiguration(e){this._featureFetcher.filter=null!=e.filter?W.A.fromJSON(e.filter):null,this._featureFetcher.customParameters=e.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};(0,h._)([(0,d.MZ)({readOnly:!0})],he.prototype,"updating",null),(0,h._)([(0,d.MZ)()],he.prototype,"_isInitializing",void 0),he=(0,h._)([(0,m.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],he);const Ee=he,ne={result:{}}}}]);