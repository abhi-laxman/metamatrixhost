"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[6050],{72211:(le,te,h)=>{h.d(te,{LF:()=>P,M9:()=>J,zu:()=>Q});var v=h(5922),w=h(89221),H=h(79845),x=h(26073);function P(N,W,L){try{return function $(N){if(!N||0===N.length)return null;if(function G(N){const W=N[0];return!!W&&"scale"in W}(N)){const W=[];for(const L of N)W.push({scale:L.scale,value:Q(L.value)});return W}return Q(N)}(N)}catch(j){L?.messages?.push(j)}return null}function J(N,W,L,j){try{const R=function Y(N){const W=(0,H.q)(N);return W?(0,x.dw)(W)?W.map(L=>L.toJSON()):W.map(({scale:L,effects:j})=>({scale:L,value:j.map(R=>R.toJSON())})):null}(N);(0,w.sM)(L,R,W)}catch(R){j.messages&&j.messages.push(R)}}function Q(N){if(!N?.length)return"";const W=[];for(const L of N){let j=[];switch(L.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":j=[Z(L,"amount")];break;case"blur":j=[Z(L,"radius","pt")];break;case"hue-rotate":j=[Z(L,"angle","deg")];break;case"drop-shadow":j=[Z(L,"xoffset","pt"),Z(L,"yoffset","pt"),Z(L,"blurRadius","pt"),q(L,"color")];break;case"bloom":j=[Z(L,"strength"),Z(L,"radius","pt"),Z(L,"threshold")]}const R=`${L.type}(${j.filter(Boolean).join(" ")})`;(0,H.q)(R),W.push(R)}return W.join(" ")}function Z(N,W,L){if(null==N[W])throw new v.A("effect:missing-parameter",`Missing parameter '${W}' in ${N.type} effect`,{effect:N});return L?N[W]+L:""+N[W]}function q(N,W){if(null==N[W])throw new v.A("effect:missing-parameter",`Missing parameter '${W}' in ${N.type} effect`,{effect:N});const L=N[W];return`rgba(${L[0]||0}, ${L[1]||0}, ${L[2]||0}, ${L[3]/255||0})`}},62799:(le,te,h)=>{h.d(te,{BL:()=>J,Cz:()=>w,KQ:()=>H,M1:()=>P,T1:()=>x,dr:()=>v});const v="ESRI__ID",w="ESRI__OriginID",H="ESRI__DestID",x="ESRI__LayoutGeometry",P="ESRI__AggregationCount",J="LC.ESRI__IsSpatial"},66722:(le,te,h)=>{h.d(te,{A:()=>R});var q,v=h(8189),w=h(5922),H=h(71065),x=h(89221),P=h(85211),G=(h(3248),h(35150),h(40707),h(76576)),Q=h(72211),Z=h(95877);const N={read:{reader:Q.LF},write:{writer:Q.M9,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},W={read:{reader:Q.LF},write:{writer:Q.M9,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},L={name:"showExcludedLabels",default:!0};let j=q=class extends H.A{constructor(y){super(y),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(y,I){const m=super.write(y,I);if(I?.origin){if(m.filter){const _=Object.keys(m.filter);if(_.length>1||"where"!==_[0])return I.messages?.push(new w.A("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:I.layer,effect:this})),null}if("showExcludedLabels"in m)return I.messages?.push(new w.A("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:I.layer,effect:this})),null}return m}clone(){return new q({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,v._)([(0,P.MZ)({type:Z.A,json:{write:{allowNull:!0,writer(y,I,m,_){const g=y?.write({},_);g&&0!==Object.keys(g).length?(0,x.sM)(m,g,I):(0,x.sM)(m,null,I)}}}})],j.prototype,"filter",void 0),(0,v._)([(0,P.MZ)({json:{read:Q.LF,write:{writer:Q.M9,allowNull:!0},origins:{"web-map":N,"portal-item":N}}})],j.prototype,"includedEffect",void 0),(0,v._)([(0,P.MZ)({json:{read:Q.LF,write:{writer:Q.M9,allowNull:!0},origins:{"web-map":W,"portal-item":W}}})],j.prototype,"excludedEffect",void 0),(0,v._)([(0,P.MZ)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":L,"portal-item":L}}})],j.prototype,"excludedLabelsVisible",void 0),j=q=(0,v._)([(0,G.$)("esri.layers.support.FeatureEffect")],j);const R=j},95877:(le,te,h)=>{h.d(te,{A:()=>j});var q,v=h(8189),w=h(49976),H=h(71065),x=h(77806),P=h(85211),$=(h(3248),h(35150),h(76576)),G=h(6434),Q=h(87086),Z=h(17181);const N=new w.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),W=new w.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let L=q=class extends H.A{constructor(R){super(R),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(R={}){const{where:y,geometry:I,spatialRelationship:m,timeExtent:_,objectIds:g,units:b,distance:T}=this;return new Q.A({geometry:(0,x.o8)(I),objectIds:(0,x.o8)(g),spatialRelationship:m,timeExtent:(0,x.o8)(_),where:y,units:b,distance:T,...R})}clone(){const{where:R,geometry:y,spatialRelationship:I,timeExtent:m,objectIds:_,units:g,distance:b}=this;return new q({geometry:(0,x.o8)(y),objectIds:(0,x.o8)(_),spatialRelationship:I,timeExtent:(0,x.o8)(m),where:R,units:g,distance:b})}};(0,v._)([(0,P.MZ)({type:String,json:{write:!0}})],L.prototype,"where",void 0),(0,v._)([(0,P.MZ)({types:G.yR,json:{write:!0}})],L.prototype,"geometry",void 0),(0,v._)([(0,P.MZ)({type:N.apiValues,json:{name:"spatialRel",read:{reader:N.read},write:{allowNull:!1,writer:N.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],L.prototype,"spatialRelationship",void 0),(0,v._)([(0,P.MZ)({type:Number,json:{write:{overridePolicy(R){return{enabled:null!=R&&null!=this.geometry}}}}})],L.prototype,"distance",void 0),(0,v._)([(0,P.MZ)({type:[Number],json:{write:!0}})],L.prototype,"objectIds",void 0),(0,v._)([(0,P.MZ)({type:W.apiValues,json:{read:W.read,write:{writer:W.write,overridePolicy(R){return{enabled:null!=R&&null!=this.geometry}}}}})],L.prototype,"units",void 0),(0,v._)([(0,P.MZ)({type:Z.A,json:{write:!0}})],L.prototype,"timeExtent",void 0),L=q=(0,v._)([(0,$.$)("esri.layers.support.FeatureFilter")],L);const j=L},15848:(le,te,h)=>{h.d(te,{A:()=>q});var G,v=h(8189),w=h(49976),H=h(71065),x=h(85211),$=(h(3248),h(35150),h(40707),h(76576));const Q=new w.J({asc:"ascending",desc:"descending"});let Z=G=class extends H.A{constructor(N){super(N),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new G({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,v._)([(0,x.MZ)({type:String,json:{write:!0}})],Z.prototype,"field",void 0),(0,v._)([(0,x.MZ)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Z.prototype,"valueExpression",void 0),(0,v._)([(0,x.MZ)({type:Q.apiValues,json:{type:Q.jsonValues,read:Q.read,write:Q.write}})],Z.prototype,"order",void 0),Z=G=(0,v._)([(0,$.$)("esri.layers.support.OrderByInfo")],Z);const q=Z},14916:(le,te,h)=>{function v(x){const P=x.layer;return"floorInfo"in P&&P.floorInfo?.floorField&&"floors"in x.view?H(x.view.floors,P.floorInfo.floorField):null}function w(x,P){return"floorInfo"in P&&P.floorInfo?.floorField?H(x,P.floorInfo.floorField):null}function H(x,P){if(!x?.length)return null;const J=x.filter(Y=>""!==Y).map(Y=>`'${Y}'`);return J.push("''"),`${P} IN (${J.join(",")}) OR ${P} IS NULL`}h.d(te,{E:()=>v,f:()=>w})},48865:(le,te,h)=>{h.d(te,{i_:()=>w});var v=h(86300);function w(P,J,Y){J=(0,v.rS)(J)?.toLowerCase(),Y=(0,v.rS)(Y)?.toLowerCase();const $=P.map(Z=>Z.toLowerCase()),G=J?P[$.indexOf(J)]:null,Q=Y?P[$.indexOf(Y)]:null;return{longitudeFieldName:G||P[$.indexOf(x.find(Z=>$.includes(Z)))],latitudeFieldName:Q||P[$.indexOf(H.find(Z=>$.includes(Z)))]}}const H=["lat","lat83","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],x=["lon","lng","lng83","long","long83","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"]},31876:(le,te,h)=>{h.d(te,{F:()=>m}),h(89952),h(77806);var H=h(97442),x=h(17181);function m(_,g,b){if(null==_?.timeInfo)return null;const{datesInUnknownTimezone:T=!1,timeOffset:O,useViewTime:D}=_;let C=_.timeExtent;T&&(C=function I(_){if(!_)return _;const{start:g,end:b}=_;return new x.A({start:null!=g?(0,H.S1)(g,g.getTimezoneOffset(),"minutes"):g,end:null!=b?(0,H.S1)(b,b.getTimezoneOffset(),"minutes"):b})}(C));let k=D?g&&C?g.intersection(C):g||C:C;return!k||k.isEmpty||k.isAllTime?k:(O&&(k=k.offset(-O.value,O.unit)),T&&(k=function y(_){if(!_)return _;const{start:g,end:b}=_;return new x.A({start:null!=g?(0,H.S1)(g,-g.getTimezoneOffset(),"minutes"):g,end:null!=b?(0,H.S1)(b,-b.getTimezoneOffset(),"minutes"):b})}(k)),k.equals(b)?b:k)}h(40920),h(96381)},78592:(le,te,h)=>{h.d(te,{O3:()=>G,PU:()=>Y,YW:()=>Z,ex:()=>P,hv:()=>Q,zp:()=>J});var v=h(69287),w=h(67685),H=h(53781),x=h(89141);const P=2.4;function J(q){return(0,w.PN)(q*P)}function Y(q){return(0,w.Lz)(q)/P}function $(q,N,W,L){let{color:j,ratio:R}=N,{color:y,ratio:I}=W;I===R&&(1===I?R-=1e-6:I+=1e-6);const m=(0,v.qE)((L-R)/(I-R),0,1);(0,H.l)(q,j.toArray(),y.toArray(),m)}function G(q){const W=new Uint8ClampedArray(2048);if((q=q.filter(({ratio:I})=>I>=0&&I<=1).sort((I,m)=>I.ratio-m.ratio).map(({color:I,ratio:m})=>({color:I,ratio:Math.max(m,.001)}))).length<1)return W;let L=q[0],j=q[0],R=1;const y=(0,x.vt)();for(let I=0;I<512;I++){const m=(I+.5)/512;for(;m>j.ratio&&R<q.length;)L=j,j=q[R++];$(y,L,j,m),W.set(y,4*I)}return W}function Q(q,N,W){const L=Math.sqrt(q**2+N**2)/W;return L>1?0:3/(Math.PI*W**2)*(1-L**2)**2}function Z(q){return"function"==typeof q?q:q?N=>+N[q]:()=>1}},70831:(le,te,h)=>{h.d(te,{A:()=>j});var G,v=h(8189),w=h(81098),H=h(90660),x=h(77806),P=h(85211),$=(h(3248),h(35150),h(76576));let Q=G=class extends(H.A.ClonableMixin(w.A)){constructor(R){super(R),this.stackedAttributes=null}cloneShallow(){return new G({...super.cloneShallow(),stackedAttributes:this.stackedAttributes})}toJSON(){return{...super.toJSON(),stackedAttributes:(0,x.o8)(this.stackedAttributes)}}};(0,v._)([(0,P.MZ)()],Q.prototype,"stackedAttributes",void 0),Q=G=(0,v._)([(0,$.$)("esri.AttributeBinsGraphic")],Q);const Z=Q;h(40707);var N=h(17221),W=h(93327);let L=class extends(H.A.ClonableMixin(W.A)){constructor(){super(...arguments),this.features=[]}readFeatures(R,y){return this.readFeaturesWithClass(R,y,Z)}};(0,v._)([(0,P.MZ)({type:[Z],json:{write:!0}})],L.prototype,"features",void 0),(0,v._)([(0,N.w)("features")],L.prototype,"readFeatures",null),L=(0,v._)([(0,$.$)("esri.rest.support.AttributeBinsFeatureSet")],L);const j=L},93327:(le,te,h)=>{h.d(te,{A:()=>I});var j,v=h(8189),w=h(81098),H=h(49976),x=h(71065),P=h(77806),J=h(85211),G=(h(3248),h(35150),h(17221)),Q=h(76576),Z=h(50305),q=h(32034),N=h(61320),W=h(6434),L=h(29141);const R=new H.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let y=j=class extends x.A{constructor(m){super(m),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(m,_){return this.readFeaturesWithClass(m,_,w.A)}writeGeometryType(m,_,g,b){if(m)return void R.write(m,_,g,b);const{features:T}=this;if(T)for(const O of T)if(null!=O?.geometry)return void R.write(O.geometry.type,_,g,b)}readQueryGeometry(m,_){if(!m)return null;const g=!!m.spatialReference,b=(0,N.rS)(m);return b&&!g&&_.spatialReference&&(b.spatialReference=q.A.fromJSON(_.spatialReference)),b}writeSpatialReference(m,_){if(m)return void(_.spatialReference=m.toJSON());const{features:g}=this;if(g)for(const b of g)if(b&&null!=b.geometry&&b.geometry.spatialReference)return void(_.spatialReference=b.geometry.spatialReference.toJSON())}clone(){return new j(this.cloneProperties())}cloneProperties(){return(0,P.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(m){const _=this.write();if(_.features&&Array.isArray(m)&&m.length>0)for(let g=0;g<_.features.length;g++){const b=_.features[g];if(b.geometry){const T=m?.[g];b.geometry=T?.toJSON()||b.geometry}}return _}quantize(m){const{scale:[_,g],translate:[b,T]}=m,C=this.features,k=this._getQuantizationFunction(this.geometryType,U=>Math.round((U-b)/_),U=>Math.round((T-U)/g));for(let U=0,B=C.length;U<B;U++)k?.(C[U].geometry)||(C.splice(U,1),U--,B--);return this.transform=m,this}unquantize(){const{geometryType:m,features:_,transform:g}=this;if(!g)return this;const{translate:[b,T],scale:[O,D]}=g;let U=null,B=null;if(this.hasZ&&null!=g?.scale?.[2]){const{translate:[,,V],scale:[,,ie]}=g;U=X=>X*ie+V}if(this.hasM&&null!=g?.scale?.[3]){const{translate:[,,,V],scale:[,,,ie]}=g;B=X=>null==X?X:X*ie+V}const K=this._getHydrationFunction(m,V=>V*O+b,V=>T-V*D,U,B);for(const{geometry:V}of _)null!=V&&K&&K(V);return this.transform=null,this}readFeaturesWithClass(m,_,g){const b=q.A.fromJSON(_.spatialReference),T=[];for(let O=0;O<m.length;O++){const D=m[O],C=g.fromJSON(D),k=D.geometry?.spatialReference;null==C.geometry||k||(C.geometry.spatialReference=b);const U=D.aggregateGeometries,B=C.aggregateGeometries;if(U&&null!=B)for(const K in B){const V=B[K],ie=U[K],X=ie?.spatialReference;null==V||X||(V.spatialReference=b)}T.push(C)}return T}_quantizePoints(m,_,g){let b,T;const O=[];for(let D=0,C=m.length;D<C;D++){const k=m[D];if(D>0){const U=_(k[0]),B=g(k[1]);U===b&&B===T||(O.push([U-b,B-T]),b=U,T=B)}else b=_(k[0]),T=g(k[1]),O.push([b,T])}return O.length>0?O:null}_getQuantizationFunction(m,_,g){return"point"===m?b=>(b.x=_(b.x),b.y=g(b.y),b):"polyline"===m||"polygon"===m?b=>{const T=(0,N.Bi)(b)?b.rings:b.paths,O=[];for(let D=0,C=T.length;D<C;D++){const U=this._quantizePoints(T[D],_,g);U&&O.push(U)}return O.length>0?((0,N.Bi)(b)?b.rings=O:b.paths=O,b):null}:"multipoint"===m?b=>{const T=this._quantizePoints(b.points,_,g);return T&&T.length>0?(b.points=T,b):null}:"extent"===m?b=>b:null}_getHydrationFunction(m,_,g,b,T){return"point"===m?O=>{O.x=_(O.x),O.y=g(O.y),b&&(O.z=b(O.z))}:"polyline"===m||"polygon"===m?O=>{const D=(0,N.Bi)(O)?O.rings:O.paths;let C,k;for(let U=0,B=D.length;U<B;U++){const K=D[U];for(let V=0,ie=K.length;V<ie;V++){const X=K[V];V>0?(C+=X[0],k+=X[1]):(C=X[0],k=X[1]),X[0]=_(C),X[1]=g(k)}}if(b&&T)for(let U=0,B=D.length;U<B;U++){const K=D[U];for(let V=0,ie=K.length;V<ie;V++){const X=K[V];X[2]=b(X[2]),X[3]=T(X[3])}}else if(b)for(let U=0,B=D.length;U<B;U++){const K=D[U];for(let V=0,ie=K.length;V<ie;V++){const X=K[V];X[2]=b(X[2])}}else if(T)for(let U=0,B=D.length;U<B;U++){const K=D[U];for(let V=0,ie=K.length;V<ie;V++){const X=K[V];X[2]=T(X[2])}}}:"extent"===m?O=>{O.xmin=_(O.xmin),O.ymin=g(O.ymin),O.xmax=_(O.xmax),O.ymax=g(O.ymax),b&&null!=O.zmax&&null!=O.zmin&&(O.zmax=b(O.zmax),O.zmin=b(O.zmin)),T&&null!=O.mmax&&null!=O.mmin&&(O.mmax=T(O.mmax),O.mmin=T(O.mmin))}:"multipoint"===m?O=>{const D=O.points;let C,k;for(let U=0,B=D.length;U<B;U++){const K=D[U];U>0?(C+=K[0],k+=K[1]):(C=K[0],k=K[1]),K[0]=_(C),K[1]=g(k)}if(b&&T)for(let U=0,B=D.length;U<B;U++){const K=D[U];K[2]=b(K[2]),K[3]=T(K[3])}else if(b)for(let U=0,B=D.length;U<B;U++){const K=D[U];K[2]=b(K[2])}else if(T)for(let U=0,B=D.length;U<B;U++){const K=D[U];K[2]=T(K[2])}}:null}};(0,v._)([(0,J.MZ)({type:String,json:{write:!0}})],y.prototype,"displayFieldName",void 0),(0,v._)([(0,J.MZ)({type:Boolean,json:{write:{overridePolicy:m=>({enabled:m})}}})],y.prototype,"exceededTransferLimit",void 0),(0,v._)([(0,J.MZ)({type:[w.A],json:{write:!0}})],y.prototype,"features",void 0),(0,v._)([(0,G.w)("features")],y.prototype,"readFeatures",null),(0,v._)([(0,J.MZ)({type:[L.A],json:{write:!0}})],y.prototype,"fields",void 0),(0,v._)([(0,J.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:R.read}}})],y.prototype,"geometryType",void 0),(0,v._)([(0,Z.K)("geometryType")],y.prototype,"writeGeometryType",null),(0,v._)([(0,J.MZ)({type:Boolean,json:{write:{overridePolicy:m=>({enabled:m})}}})],y.prototype,"hasM",void 0),(0,v._)([(0,J.MZ)({type:Boolean,json:{write:{overridePolicy:m=>({enabled:m})}}})],y.prototype,"hasZ",void 0),(0,v._)([(0,J.MZ)({types:W.yR,json:{write:!0}})],y.prototype,"queryGeometry",void 0),(0,v._)([(0,G.w)("queryGeometry")],y.prototype,"readQueryGeometry",null),(0,v._)([(0,J.MZ)({type:q.A,json:{write:!0}})],y.prototype,"spatialReference",void 0),(0,v._)([(0,Z.K)("spatialReference")],y.prototype,"writeSpatialReference",null),(0,v._)([(0,J.MZ)({json:{write:!0}})],y.prototype,"transform",void 0),y=j=(0,v._)([(0,Q.$)("esri.rest.support.FeatureSet")],y),y.prototype.toJSON.isDefaultToJSON=!0;const I=y},68470:(le,te,h)=>{h.d(te,{K:()=>q,Q:()=>G});var v=h(8189),w=h(49976),H=h(35150),x=h(85211),Y=(h(3248),h(40707),h(15463)),$=h(76576);const G=(0,w.O)()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),Q="percent-of-total",Z="field",q=N=>{let W=class extends N{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let L=this._get("normalizationType");const j=!!this.normalizationField,R=null!=this.normalizationTotal;return j||R?(L=j&&Z||R&&Q||null,j&&R&&H.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):L!==Z&&L!==Q||(L=null),L}set normalizationType(L){this._set("normalizationType",L)}};return(0,v._)([(0,x.MZ)({type:String,json:{name:"parameters.normalizationField",write:!0}})],W.prototype,"normalizationField",void 0),(0,v._)([(0,x.MZ)({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],W.prototype,"normalizationMaxValue",void 0),(0,v._)([(0,x.MZ)({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],W.prototype,"normalizationMinValue",void 0),(0,v._)([(0,x.MZ)({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],W.prototype,"normalizationTotal",void 0),(0,v._)([(0,Y.e)(G,{name:"parameters.normalizationType"})],W.prototype,"normalizationType",null),W=(0,v._)([(0,$.$)("esri.rest.support.NormalizationBinParametersMixin")],W),W}},96381:(le,te,h)=>{h.d(te,{X:()=>v});const v=Symbol("WebScene")},54935:(le,te,h)=>{h.d(te,{Fj:()=>q,Z7:()=>Q,ce:()=>N,eR:()=>J,xt:()=>Z});var v=h(86468),w=h(61320),H=h(9792),x=h(47669);const P=.45;function J(R,y=.5){switch(R.type){case"CIMPointSymbol":{const I=R.symbolLayers;if(!I||1!==I.length)return null;const m=I[0];return"CIMVectorMarker"!==m.type?null:J(m)}case"CIMVectorMarker":{const I=R.markerGraphics;if(!I||1!==I.length)return null;const m=I[0];if(!m)return null;const _=m.geometry;if(!_)return null;const g=m.symbol;return!g||"CIMPolygonSymbol"!==g.type&&"CIMLineSymbol"!==g.type||g.symbolLayers?.some(b=>!!b.effects)?null:{type:"sdf",geom:_,sdfPaddingRatio:y,asFill:"CIMPolygonSymbol"===g.type}}}}function G(R){let y=1/0,I=-1/0,m=1/0,_=-1/0;for(const g of R)for(const b of g)b[0]<y&&(y=b[0]),b[0]>I&&(I=b[0]),b[1]<m&&(m=b[1]),b[1]>_&&(_=b[1]);return[y,m,I,_]}function Q(R){return R?R.rings?G(R.rings):R.paths?G(R.paths):(0,w.ZC)(R)?[R.xmin,R.ymin,R.xmax,R.ymax]:null:null}function Z(R,y){const[I,m,_,g]=Q(R),b=_-I,T=g-m,O=x.p,D=x.hM,C=Math.floor(.5*(O*y-D)),k=(O-2*(C+D))/Math.max(b,T),U=Math.round(b*k),B=Math.round(T*k);return{pixelDimensions:[b,T],texelDimensions:[Math.round((U+2*C)/k),Math.round((B+2*C)/k)]}}function q(R,y,I,m,_,g,b){const[T,O,D,C]=R;if(D<T||C<O)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const k=D-T,U=C-O,B=Math.max(k,U);let K=.5;if(null!=g&&null!=I){!b&&null!=y&&(g*=(y.ymax-y.ymin)/I);const Se=g/(g+B);Se>P&&Se<1&&(K=Math.min(Se+.1,.99))}const V=x.p,ie=x.hM,X=Math.floor(.5*(V*K-ie)),se=(V-2*(X+ie))/B,Ae=Math.round(k*se)+2*X,he=Math.round(U*se)+2*X;let ne=1;y&&(ne=he*(1-K)/((y.ymax-y.ymin)*se));let me=0,fe=0,ve=1;m&&(_?y&&I&&y.ymax-y.ymin>0&&(ve=(y.xmax-y.xmin)/(y.ymax-y.ymin),me=m.x/(I*ve),fe=m.y/I):(me=m.x,fe=m.y)),y&&(me=.5*(y.xmax+y.xmin)+me*(y.xmax-y.xmin),fe=.5*(y.ymax+y.ymin)+fe*(y.ymax-y.ymin)),me-=T,fe-=O,me*=se,fe*=se,me+=X,fe+=X;let be=me/Ae-.5,Oe=fe/he-.5;return _&&I&&(be*=I*ve,Oe*=I),{frameSizeRatio:ne,anchorX:be,anchorY:Oe,widthRatio:ve,sdfPaddingRatio:K}}function N(R){const y=function Y(R){return R?R.rings?R.rings:R.paths?R.paths:void 0!==R.xmin&&void 0!==R.ymin&&void 0!==R.xmax&&void 0!==R.ymax?[[[R.xmin,R.ymin],[R.xmin,R.ymax],[R.xmax,R.ymax],[R.xmax,R.ymin],[R.xmin,R.ymin]]]:null:null}(R.geom),I=function $(R){let y=1/0,I=-1/0,m=1/0,_=-1/0;for(const g of R)for(const b of g)b[0]<y&&(y=b[0]),b[0]>I&&(I=b[0]),b[1]<m&&(m=b[1]),b[1]>_&&(_=b[1]);return new H.A(y,m,I-y,_-m)}(y),m=x.p,_=x.hM,g=Math.floor(.5*(m*R.sdfPaddingRatio-_)),b=m-2*(g+_),T=b/Math.max(I.width,I.height),O=Math.round(I.width*T)+2*g,D=Math.round(I.height*T)+2*g,C=[];for(const U of y)if(U&&U.length>1){const B=[];for(const K of U){let[V,ie]=K;V-=I.x,ie-=I.y,V*=T,ie*=T,V+=g-.5,ie+=g-.5,B.push(R.asFill?[V,ie]:[Math.round(V),Math.round(ie)])}if(R.asFill){const K=B.length-1;B[0][0]===B[K][0]&&B[0][1]===B[K][1]||B.push(B[0])}C.push(B)}const k=function W(R,y,I,m){const _=y*I,g=new Array(_),b=m*m+1;for(let T=0;T<_;++T)g[T]=b;for(const T of R){const O=T.length;for(let D=1;D<O;++D){const C=T[D-1],k=T[D];let U,B,K,V;C[0]<k[0]?(U=C[0],B=k[0]):(U=k[0],B=C[0]),C[1]<k[1]?(K=C[1],V=k[1]):(K=k[1],V=C[1]);let ie=Math.floor(U)-m,X=Math.floor(B)+m,se=Math.floor(K)-m,Ae=Math.floor(V)+m;ie<0&&(ie=0),X>y&&(X=y),se<0&&(se=0),Ae>I&&(Ae=I);const he=k[0]-C[0],ne=k[1]-C[1],me=he*he+ne*ne;for(let fe=ie;fe<X;fe++)for(let ve=se;ve<Ae;ve++){const be=fe+.5,Oe=ve+.5;let Se,ue,je=(be-C[0])*he+(Oe-C[1])*ne;je<0?(Se=C[0],ue=C[1]):je>me?(Se=k[0],ue=k[1]):(je/=me,Se=C[0]+je*he,ue=C[1]+je*ne);const Qe=(be-Se)*(be-Se)+(Oe-ue)*(Oe-ue),$e=(I-ve-1)*y+fe;Qe<g[$e]&&(g[$e]=Qe)}}}for(let T=0;T<_;++T)g[T]=Math.sqrt(g[T]);return g}(C,O,D,g);return R.asFill&&function L(R,y,I,m,_){for(const g of R){const b=g.length;for(let T=1;T<b;++T){const O=g[T-1],D=g[T];let C,k,U,B;O[0]<D[0]?(C=O[0],k=D[0]):(C=D[0],k=O[0]),O[1]<D[1]?(U=O[1],B=D[1]):(U=D[1],B=O[1]);let K=Math.floor(C),V=Math.floor(k)+1,ie=Math.floor(U),X=Math.floor(B)+1;K<m&&(K=m),V>y-m&&(V=y-m),ie<m&&(ie=m),X>I-m&&(X=I-m);for(let se=ie;se<X;++se){if(O[1]>se==D[1]>se)continue;const Ae=se+.5,he=(I-se-1)*y;for(let ne=K;ne<V;++ne)ne+.5<(D[0]-O[0])*(Ae-O[1])/(D[1]-O[1])+O[0]&&(_[he+ne]=-_[he+ne]);for(let ne=m;ne<K;++ne)_[he+ne]=-_[he+ne]}}}}(C,O,D,g,k),{data:j(k,g),width:O,height:D,sdfPaddingRatio:R.sdfPaddingRatio,sdfDecodeCoeff:2*g/b}}function j(R,y){const I=2*y,m=R.length,_=new Uint8Array(4*m);for(let g=0;g<m;++g)(0,v.U)(.5-R[g]/I,_,4*g);return _}},66803:(le,te,h)=>{h.d(te,{j:()=>j});var v=h(5922),w=h(3248),H=h(35150),x=h(47669),P=h(53212),J=h(24370),Y=h(50915),$=h(79061),G=h(76169),Q=h(4931);class q{constructor(y,I,m){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:_,pixelType:g,textureOnly:b}=y,T=(0,J.Qz)(g);this.blockIndex=m,this.pixelType=g,this.size=I,this.textureOnly=b,b||(this.data=new T(_)),this._resetRange()}destroy(){this._texture?.dispose();for(const y in this._fbos){const I=this._fbos[y];I&&("0"===y&&I.detachColorTexture(),I.dispose()),this._fbos[y]=null}this._texture=null}get _textureDesc(){const y=new Q.R;return y.wrapMode=Y.pF.CLAMP_TO_EDGE,y.samplingMode=Y.Cj.NEAREST,y.dataType=this.pixelType,y.width=this.size,y.height=this.size,y}setData(y,I,m){const _=(0,P.Q4)(y),g=this.data,b=_*this.texelSize+I;!g||b>=g.length||(g[b]=m,this.dirtyStart=Math.min(this.dirtyStart,_),this.dirtyEnd=Math.max(this.dirtyEnd,_))}getData(y,I){if(null==this.data)return null;const m=(0,P.Q4)(y)*this.texelSize+I;return!this.data||m>=this.data.length?null:this.data[m]}getTexture(y){return this._texture??this._initTexture(y)}getFBO(y,I=0){if(!this._fbos[I]){const m=0===I?this.getTexture(y):this._textureDesc;this._fbos[I]=new $.H(y,m)}return this._fbos[I]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(y,I){try{const m=this.dirtyStart,_=this.dirtyEnd;if(!this.hasDirty)return;(0,w.A)("esri-2d-update-debug")&&console.debug(`Version[${I}] AttributeStoreView.updateTexture`,{start:m,end:_,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const g=this.data.buffer,b=this.getTexture(y),T=4,O=(m-m%this.size)/this.size,C=O,U=(_-_%this.size)/this.size,B=O*this.size*T,K=(this.size+U*this.size)*T-B,V=(0,J.Qz)(this.pixelType),ie=new V(g,B*V.BYTES_PER_ELEMENT,K),X=this.size,se=U-C+1;if(se>this.size)return void H.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new v.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));b.updateData(0,0,C,X,se,ie)}catch{}}update(y){const{data:I,start:m,end:_}=y;if(null!=I&&null!=this.data){const g=this.data,b=m*this.texelSize;for(let T=0;T<I.length;T++)y.layout&1<<T%this.texelSize&&(g[b+T]=I[T])}this.dirtyStart=Math.min(this.dirtyStart,m),this.dirtyEnd=Math.max(this.dirtyEnd,_)}resize(y,I){const m=this.size;if(this.size=I,this.textureOnly)return void(m!==this.size&&(this._lastTexture=this._texture,this._texture=null));const _=(0,J.Qz)(this.pixelType);this.destroy(),this.data=new _(y.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(y){const I=new G.g(y,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const m=this._lastTexture.descriptor.width,_=this._lastTexture.descriptor.height,g=this._lastTexture.descriptor.dataType,b=this._lastTexture.descriptor.pixelFormat,T=this.getFBO(y),O=(0,J.AV)(g),D=new((0,J.Qz)(g))(new ArrayBuffer(m*_*O*this.texelSize)),C=y.getBoundFramebufferObject(),{x:k,y:U,width:B,height:K}=y.getViewport();y.bindFramebuffer(T),T.readPixels(0,0,m,_,b,g,D),I.updateData(0,0,0,2*m,_/2,D),y.setViewport(k,U,B,K),y.bindFramebuffer(C)}return this.destroy(),this._texture=I,this._texture}}class N{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}get locked(){return this._locked}_initialize(y){if(!y)throw new Error("InternalError: initArgs must be defined");const I=y.blockDescriptors;if(this.size=y.blockSize,(0,w.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:y}),null==this._data)this._data=I.map((m,_)=>null!=m?new q(m,this.size,_):null);else for(let m=0;m<this._data.length;m++){const _=this._data[m],g=I[m];null!=g&&(null==_?this._data[m]=new q(g,this.size,m):_.resize(g,this.size))}}destroy(){for(const y of this._data??[])y?.destroy();this._defaultTexture?.dispose(),this._defaultTexture=null,this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(y){return null==this._data?null:this._data[y]}setLabelMinZoom(y,I){this.setData(y,x.dV.FilterFlags,1,I)}setLocalTimeOrigin(y,I){this.setData(y,x.dV.LocalTimeOrigin,0,I)}getLabelMinZoom(y){return this.getData(y,x.dV.FilterFlags,1,255)}getFilterFlags(y){return this.getData(y,x.dV.FilterFlags,0,0)}getVisualVariableData(y,I){return this.getData(y,x.dV.VV,I,0)}getData(y,I,m,_){if(!this._data)return 0;const g=this._data[I];return null==g?0:g.getData(y,m)??_}setData(y,I,m,_){this._data[I].setData(y,m,_)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(y){this._version=y.version,this._pendingAttributeUpdates.push(y),(0,w.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:y})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const y=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const I of y){const{blockData:m,initArgs:_,sendUpdateEpoch:g,version:b}=I;(0,w.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${g}] AttributeStoreView.applyUpdate`),this._version=b,this._epoch=g,null!=_&&this._initialize(_);const T=this._data;for(let O=0;O<m.length;O++){const D=m[O],C=T[O];null!=C&&null!=D&&((0,w.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${O}] AttributeStoreView.update`,{block:D}),C.update(D))}}}getUniforms(y){return{filterFlags:{texture:this._getTexture(y,x.dV.FilterFlags),unit:x.uM},animation:{texture:this._getTexture(y,x.dV.Animation),unit:x.z2},gpgpu:{texture:this._getTexture(y,x.dV.GPGPU),unit:x.Sr},localTimeOrigin:{texture:this._getTexture(y,x.dV.LocalTimeOrigin),unit:x.zt},visualVariableData:{texture:this._getTexture(y,x.dV.VV),unit:x.nM},dataDriven0:{texture:this._getTexture(y,x.dV.DD0),unit:x.lL},dataDriven1:{texture:this._getTexture(y,x.dV.DD1),unit:x.sn},dataDriven2:{texture:this._getTexture(y,x.dV.DD2),unit:x.n9},size:this.size}}_getTexture(y,I){const m=this._data?.[I];return m?(m.updateTexture(y,this._version),m.getTexture(y)):this._getDefaultTexture(y)}_getDefaultTexture(y){if(null==this._defaultTexture){const I=new Q.R;I.wrapMode=Y.pF.CLAMP_TO_EDGE,I.samplingMode=Y.Cj.NEAREST,I.width=1,I.height=1,this._defaultTexture=new G.g(y,I,new Uint8Array(4))}return this._defaultTexture}}var W=h(37188);class j extends W.A{constructor(y){super(y),this._statisticsByLevel=new Map,this._entityIndex=new Map,this.attributeView=new N}destroy(){this.children.forEach(y=>y.destroy()),this.removeAllChildren(),this.attributeView.destroy()}doRender(y){y.context.capabilities.enable("textureFloatLinear"),super.doRender(y)}get hasAnimations(){for(const y of this.children)if(y.hasAnimations)return!0;return!1}_reindexAndUpdateFeaturesIfNeeded(){if(this.hasAnimations&&(this._reindexFeatures(),0!==this.attributeView.size))for(const y of this._entityIndex.values())y.dirty&&(this.attributeView.setData(y.displayId,x.dV.LocalTimeOrigin,0,y.firstIndexed),y.dirty=!1)}restartAnimation(y){const I=this._entityIndex.get(y);if(!I)return;const m=performance.now()/1e3;I.firstIndexed=m,I.dirty=!0}restartAllAnimations(){const y=performance.now()/1e3;for(const[I,m]of this._entityIndex)m.firstIndexed=y,m.dirty=!0}_reindexFeatures(){const y=performance.now()/1e3;for(const I of this.children)for(const m of I.entityIds){const{objectId:_}=m;let g=this._entityIndex.get(_);g||(g={objectId:_,displayId:0,firstIndexed:y,lastIndexed:0,dirty:!0},this._entityIndex.set(_,g)),g.lastIndexed=y,g.displayId=m.displayId}for(const[I,m]of this._entityIndex)y-m.lastIndexed>60&&this._entityIndex.delete(I)}_updateAttributeView(){this.attributeView.update(),this._reindexAndUpdateFeaturesIfNeeded()}createRenderParams(y){const I=super.createRenderParams(y);return I.attributeView=this.attributeView,I.instanceStore=this._instanceStore,I.statisticsByLevel=this._statisticsByLevel,I}}},37188:(le,te,h)=>{h.d(te,{A:()=>Y});var v=h(3248),w=h(69473),H=h(54382),x=h(89298),P=h(99065);const J=($,G)=>$.key.level-G.key.level!=0?$.key.level-G.key.level:$.key.row-G.key.row!=0?$.key.row-G.key.row:$.key.col-G.key.col;class Y extends H.A{constructor(G){super(),this.tileInfoView=G,this.sortFunction=J}renderChildren(G){this.setStencilReference(G),super.renderChildren(G)}createRenderParams(G){const{state:Q}=G,Z=super.createRenderParams(G);return Z.requiredLevel=this.tileInfoView.getClosestInfoForScale(Q.scale).level,Z.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(Q.scale),Z}prepareRenderPasses(G){const Q=super.prepareRenderPasses(G);return Q.push(G.registerRenderPass({name:"stencil",brushes:[x.A],drawPhase:w.S5.DEBUG|w.S5.MAP|w.S5.HIGHLIGHT|w.S5.LABEL,target:()=>this.getStencilTarget()})),(0,v.A)("esri-tiles-debug")&&Q.push(G.registerRenderPass({name:"tileInfo",brushes:[P.A],drawPhase:w.S5.DEBUG,target:()=>this.children})),Q}getStencilTarget(){return this.children}setStencilReference(G){let Q=1;for(const Z of this.children)Z.stencilRef=Q++}}},87250:(le,te,h)=>{h.d(te,{c:()=>w});var v=h(69522);class w{constructor(x,P,J){this._instanceId=x,this.techniqueRef=P,this._input=J}get instanceId(){return(0,v.P)(this._instanceId)}createMeshInfo(x){return{id:(0,v.P)(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:x,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(x){this._input=x}}},69522:(le,te,h)=>{function v(H){return H}function w(H){return H}h.d(te,{P:()=>v,U:()=>w})},43435:(le,te,h)=>{h.r(te),h.d(te,{default:()=>Ni});var v=h(10467),w=h(8189),H=h(81098),x=h(85211),P=h(3248),J=h(35150),$=(h(40707),h(76576));let G=class extends H.A{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(u=!1){if(this.popupTemplate)return this.popupTemplate;const s=this.sourceLayer?.featureReduction;return s&&"popupTemplate"in s&&s.popupEnabled?s.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};(0,w._)([(0,x.MZ)({type:Boolean})],G.prototype,"isAggregate",void 0),G=(0,w._)([(0,$.$)("esri.AggregateGraphic")],G);const Q=G;let Z=class extends H.A{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(u=!1){if(this.popupTemplate)return this.popupTemplate;const s=this.sourceLayer?.trackInfo;return s?.enabled&&s.popupEnabled?s.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};(0,w._)([(0,x.MZ)({type:Boolean})],Z.prototype,"isAggregate",void 0),Z=(0,w._)([(0,$.$)("esri.TrackGraphic")],Z);const q=Z;var N=h(89952),W=h(31178),L=h(69690),j=h(5922),R=h(17715),y=h(11432),I=h(89221),m=h(56492),_=h(48900),g=h(63484),b=h(56985),T=h(28067),O=h(98877),D=h(40702);let C=class extends O.A{constructor(u){super(u),this._filter=null,this.duration=(0,P.A)("mapview-transitions-duration"),this._excludedEffectView=new D.$B(u),this._includedEffectView=new D.$B(u)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(u){this._get("featureEffect")!==u&&this._transitionTo(u)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(u){this._set("scale",u),this._excludedEffectView.scale=u,this._includedEffectView.scale=u}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}get transitioningToEmpty(){return!this._excludedEffectView.final&&!this._includedEffectView.final}transitionStep(u,s){this._set("scale",s),this.transitioning?(this._includedEffectView.transitionStep(u,s),this._excludedEffectView.transitionStep(u,s),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=s,this._includedEffectView.scale=s)}endTransition(){this._includedEffectView.endTransition(),this._excludedEffectView.endTransition(),this._filter=null}_transitionTo(u){const s=this._get("featureEffect"),a=u,c=a?.includedEffect,d=a?.excludedEffect,p=this._includedEffectView.canTransitionTo(c)&&this._excludedEffectView.canTransitionTo(d);this._includedEffectView.effect=c,this._excludedEffectView.effect=d,this._set("featureEffect",a),this._filter=a?.filter||s?.filter||null,p||this.endTransition()}};(0,w._)([(0,x.MZ)()],C.prototype,"_filter",void 0),(0,w._)([(0,x.MZ)()],C.prototype,"_excludedEffectView",void 0),(0,w._)([(0,x.MZ)()],C.prototype,"_includedEffectView",void 0),(0,w._)([(0,x.MZ)()],C.prototype,"duration",void 0),(0,w._)([(0,x.MZ)()],C.prototype,"excludedEffects",null),(0,w._)([(0,x.MZ)()],C.prototype,"featureEffect",null),(0,w._)([(0,x.MZ)()],C.prototype,"filter",null),(0,w._)([(0,x.MZ)()],C.prototype,"hasEffects",null),(0,w._)([(0,x.MZ)()],C.prototype,"includedEffects",null),(0,w._)([(0,x.MZ)({value:0})],C.prototype,"scale",null),(0,w._)([(0,x.MZ)()],C.prototype,"transitioning",null),(0,w._)([(0,x.MZ)()],C.prototype,"transitioningToEmpty",null),C=(0,w._)([(0,$.$)("esri.layers.effects.FeatureEffectView")],C);const k=C;var U=h(31732),B=h(95877),K=h(47516),V=h(86300),ie=h(58443),X=h(31876),se=h(17221),Ae=h(32034),he=h(93327);let ne=class extends he.A{constructor(){super(...arguments),this.features=[]}readFeatures(u,s){const a=Ae.A.fromJSON(s.spatialReference),c=[];for(let d=0;d<u.length;d++){const p=u[d],f=Q.fromJSON(p),S=p.geometry?.spatialReference;null==f.geometry||S||(f.geometry.spatialReference=a);const E=p.aggregateGeometries,M=f.aggregateGeometries;if(E&&null!=M)for(const F in M){const A=M[F],z=E[F],ee=z?.spatialReference;null==A||ee||(A.spatialReference=a)}c.push(f)}return c}};(0,w._)([(0,x.MZ)({type:[Q],json:{write:!0}})],ne.prototype,"features",void 0),(0,w._)([(0,se.w)("features")],ne.prototype,"readFeatures",null),ne=(0,w._)([(0,$.$)("esri.rest.support.AggregateFeatureSet")],ne);const me=ne;var fe=h(70831),ve=h(85423),be=h(87086),Oe=h(88219),Se=h(66803),ue=h(69473),je=h(1119),Qe=h(87250),$e=h(69522);class tr{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}updateStart(){this._instanceByIdNext=new Map,this._shaderCountByMesh=new Map,this._shaderIndices=new Map}updateEnd(){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");for(const s of this._instanceById.keys())this._instanceByIdNext.has(s)||this._instanceById.delete(s);for(const[s,a]of this._instanceByIdNext.entries()){const c=this._instanceById.get(s);c?c.setInput(a.getInput()):this._instanceById.set(s,a)}this._instanceByIdNext=null,this._shaderCountByMesh=null,this._shaderIndices=null}values(){return this._instanceById.values()}ensureInstance(s,a){let c;if("object"==typeof a&&"optionalAttributes"in a&&"uniforms"in a){const p=`${s.type}.${JSON.stringify(a.optionalAttributes)}`,f=p+`.${JSON.stringify(a.uniforms)}`;let S=0;null!=this._instanceByIdNext&&(this._shaderIndices.has(f)?S=this._shaderIndices.get(f):(S=this._shaderCountByMesh.get(p)??0,this._shaderCountByMesh.set(p,S+1),this._shaderIndices.set(f,S))),c=p+`.${S}`}else c=`${s.type}.${JSON.stringify(a)}`;const d=(0,je.Wm)(c);if(this._instanceByIdNext){const p=new Qe.c((0,$e.U)(d),s,a);return this._instanceByIdNext.set(d,p),p}if(!this._instanceById.has(d)){const p=new Qe.c((0,$e.U)(d),s,a);this._instanceById.set(d,p)}return this._instanceById.get(d)}getInstance(s){const a=this._instanceById.get(s);if(null==a)throw new Error(`InternalError: Unable to get instance for ${s}`);return a}}var de=h(12598),lt=h(8137),kt=h(15590),rr=h(51995),He=(h(54290),h(74847)),ir=(h(15215),h(77031),h(38093));class nr{constructor(s,a,c,d){this.getStage=s,this.getSubscriptionVersion=a,this.version=c,this._tileInfoView=d,this._pendingUpdates=new kt.A(1e3),this._locked=!1,this._tiles=new Map}destroy(){for(const s of this.tiles())s.destroy();this._pendingUpdates.clear(),this._tiles.clear()}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(s){this._tiles.clear();for(const a of s)this._tiles.set(a.key.id,a)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1,this.flush()}enqueueUpdate(s){this._pendingUpdates.enqueue(s)}update(s){if(!this._locked)for(;this._pendingUpdates.size;){const a=this._pendingUpdates.peek();if(null==a||a.inner.attributeEpoch>s)break;this._updateTile(a),this._pendingUpdates.dequeue()}}removeTile(s){const a=this._tiles.get(s);(0,P.A)("esri-2d-update-debug")&&console.debug(`Tile[${s}] RenderState.removeTile`),a?.destroy(),this._tiles.delete(s)}isTileDone(s){const a=this._tiles.get(s.id);return!!a&&a.isReady}flush(){for(;this._pendingUpdates.size;){const s=this._pendingUpdates.dequeue();null!=s&&this._updateTile(s)}for(const s of this._tiles.values())s.upload()}_updateTile(s){const{inner:a,objectIdMap:c}=s,d=this.getSubscriptionVersion(a.id);if(d!==a.subscriptionVesrion)return void((0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${a.subscriptionVesrion} != ${d}] Tile[${a.id}] FeatureContainer - Dropping message, outdated version]`,a));(0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${a.version}] Tile[${a.id}] Chunk[${a.debugInfo?.chunkId??"<EnsureEnd>"}] RenderState.updateTile [${a.type}]`,a);const p=this._ensureTile(a.id);if("update"===a.type){const[E,...M]=a.modify;p.onMessage({type:"update",modify:E,remove:a.remove,end:a.end,attributeEpoch:a.attributeEpoch,objectIdMap:c});for(const F of M){const A=this._tiles.get(F.tileId);A&&A.onMessage({type:"update",modify:F,remove:a.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:c})}return}if(null==a.append)return void p.onMessage({type:"append",clear:a.clear,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch,objectIdMap:c});const[f,...S]=a.append;p.onMessage({type:"append",clear:a.clear,append:f,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch,objectIdMap:c});for(const E of S){const M=this._tiles.get(E.tileId);M&&M.onMessage({type:"update",modify:E,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:c})}}_ensureTile(s){if(!this._tiles.has(s)){const a=this._createTile(s);this._copyPixelBufferedEntitiesInto(a),this._tiles.set(s,a)}return this._tiles.get(s)}_createTile(s){(0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${s}] RenderState.createTile`);const a=new He.A(s),c=this._tileInfoView.getTileBounds((0,rr.vt)(),a),d=this._tileInfoView.getTileResolution(a.level),p=new ir.R(a,d,c[0],c[3],!0);if(p.stage=this.getStage(),!p.stage){const f=new j.A("featurelayerview:webgl","Cannot create tile with empty stage");J.A.getLogger("esri.views.2d.layers.features.RenderState").error(f)}return p}_copyPixelBufferedEntitiesInto(s){let a=7;const c=this._tileInfoView.getLODInfoAt(s.key);for(let d=-1;d<=1;d++)for(let p=-1;p<=1;p++){if(0===d&&0===p)continue;const f=s.key.getNormalizedNeighbor(p,d,c).id,S=this._tiles.get(f);null!=S&&s.copyPixelBufferedEntitesFrom(S,1<<a,p,d),a--}}}var Kt=h(62931);class ar{constructor(s,a){this.id=s,this.version=a,this._resolver=(0,m.Tw)(),this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve(),this._done=!0}destroy(){this._resolver.reject()}}class or extends Se.j{constructor(s){super(s.view.featuresTilingScheme),this.updatingHandles=new b.U,this._hitTestsRequests=[],this._store=new tr,this._visibleTiles=new Set,this._subscriptions=new Map,this._updateStatisticsRequests=[],this._lockStatisticUpdates=!1,this._shouldUnlockAttributeView=!1,this._layerView=s,this.addTransitionable(this._layerView.featureEffectView)}renderChildren(s){if(this._updateAttributeView(),this._renderState?.update(this.attributeView.currentEpoch),this._renderState){const a=Array.from(this._renderState.tiles()).filter(c=>c.needsUpload);a.length&&(a[Math.floor(Math.random()*a.length)].upload(),a.length>=2&&this.requestRender());for(const c of this._renderState.tiles())c.tryReady(this.attributeView.currentEpoch)&&(this._subscriptions.get(c.key.id)?.end(),this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender())}for(const a of this.children)a.setTransform(s.state);switch(super.renderChildren(s),s.drawPhase){case ue.S5.MAP:return this._renderMapPhase(s);case ue.S5.HIGHLIGHT:return this._renderHighlightPhase(s);case ue.S5.LABEL:return this._renderLabelPhase(s)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return this._layerView.labelingCollisionInfos.length>0}get hasHighlight(){return this._layerView.hasHighlight}get _layer(){return this._layerView.layer}_getHeatmapInstance(s){if(null==this._instanceStore||!(s.drawPhase&de.YS.heatmap.drawPhase))return null;for(const a of this._instanceStore.values())if(a.techniqueRef.type===lt.N.Heatmap)return a;return null}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(s=>this._visibleTiles.has(s.key.id)):[]}updateAttributeView(s){this.requestRender(),this.attributeView.requestUpdate(s),this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(s){for(const{tileId:a,version:c}of s.subscribe)if(this._subscriptions.has(a))this._subscriptions.get(a).version=c;else{const d=new ar(a,c);this._subscriptions.set(a,d),this.updatingHandles.addPromise(d.promise)}for(const a of s.unsubscribe)this._subscriptions.get(a)?.destroy(),this._subscriptions.delete(a),this.removeTile(a)}isDone(s){return!!this._renderState&&this._renderState.isTileDone(s)}updateRenderState(s){var a=this;return(0,v.A)(function*(){(0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${s}] FeatureContainer.updateRenderState`),a._renderStateNext=new nr(()=>a._stage,c=>a._subscriptions.get(c)?.version,s,a.tileInfoView)})()}getDisplayStatistics(s,a){const c=this._statisticsByLevel.get(s);return c?c.get(a):null}updateStatistics(s,a){if(this._lockStatisticUpdates)return void this._updateStatisticsRequests.push({level:s,statistics:a});let c=this._statisticsByLevel.get(s);c||(c=new Map,this._statisticsByLevel.set(s,c));for(const d of a)c.set(d.fieldName,{minValue:d.minValue,maxValue:d.maxValue})}lockForOverrides(){this._renderState?.lockUploads(),this._lockStatisticUpdates=!0,this.attributeView.locked||(this.attributeView.lockTextureUploads(),this._shouldUnlockAttributeView=!0)}unlockForOverrides(){this._renderState?.unlockUploads(),this._shouldUnlockAttributeView&&(this.attributeView.unlockTextureUploads(),this._shouldUnlockAttributeView=!1),this._lockStatisticUpdates=!1;for(const s of this._updateStatisticsRequests)this.updateStatistics(s.level,s.statistics);this._updateStatisticsRequests=[],this._renderState?.flush(),this.requestRender()}trySwapRenderState(){this._renderStateNext&&((0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderState.flush(),this._renderStateNext=null),this.requestRender()}setVisibleTiles(s){this._visibleTiles=s}onMessage(s,a){var c=this;return(0,v.A)(function*(){(0,m.Te)(a);const d=s.inner;if(!c._subscriptions.has(d.id))return;const p=c._subscriptions.get(d.id);if(p.version!==d.subscriptionVesrion)return void((0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${d.subscriptionVesrion} != ${p.version}] Tile[${d.id}] FeatureContainer - Dropping message, outdated version]`,d));const f=c._renderStateNext??c._renderState;if(!f)throw new Error("InternalError: No renderState defined");f.version!==d.version&&console.error(`InternalError: Version mismatch. [renderState: ${f.version}, message: ${d.version}]`),f.enqueueUpdate(s),c.requestRender(),c._layerView.view.labelManager.requestUpdate(),c._layerView.requestUpdate()})()}removeTile(s){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(s),this._renderStateNext&&this._renderStateNext.removeTile(s))}hitTest(s){let a=this._hitTestsRequests.find(({x:d,y:p})=>d===s.x&&p===s.y);const c=(0,m.Tw)();return a?a.resolvers.push(c):(a={x:s.x,y:s.y,resolvers:[c]},this._hitTestsRequests.push(a)),this.requestRender(),c.promise}getSortKeys(s){const a=new Set(s),c=new Map;for(const d of this.children)if(d.getSortKeys(a).forEach((p,f)=>c.set(f,p)),c.size===a.size)break;return c}get hasAnimation(){return this.hasLabels}doRender(s){const{minScale:a,maxScale:c}=this._layer.effectiveScaleRange,d=s.state.scale;d<=(a||1/0)&&d>=c&&super.doRender(s)}afterRender(s){super.afterRender(s),this._hitTestsRequests.length&&this.requestRender()}setStencilReference(s){if(null==this._getHeatmapInstance(s))super.setStencilReference(s);else for(const a of this.children)a.stencilRef=de.YS.heatmap.getStencilReference(a)}_renderMapPhase(s){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(s),this._renderInsideEffect(s)):this._renderFeatures(s,ue.RI.All),this._hitTestsRequests.length>0&&this._renderHittest(s)}_renderHighlightPhase(s){this.hasHighlight&&(0,Kt.lB)(s,!1,a=>{this._renderFeatures(a,ue.RI.Highlight)})}_renderLabelPhase(s){this._renderFeatures(s,ue.RI.All)}_renderInsideEffect(s){const a=s.painter.effects.insideEffect;a.bind(s),this._renderFeatures(s,ue.RI.InsideEffect),a.draw(s,this._layerView.featureEffectView.includedEffects),a.unbind()}_renderOutsideEffect(s){const a=s.painter.effects.outsideEffect;a.bind(s),this._renderFeatures(s,ue.RI.OutsideEffect),a.draw(s,this._layerView.featureEffectView.excludedEffects),a.unbind()}_renderHittest(s){const{context:a}=s,c=s.painter.effects.hittest,d=a.getBoundFramebufferObject(),p=a.getViewport(),f=s.passOptions,S=s.drawPhase;c.bind(s),s.passOptions=c.createOptions(s,this._hitTestsRequests),s.drawPhase=ue.S5.HITTEST;const{distance:E,smallSymbolDistance:M}=s.passOptions,F=Math.max(E,M);for(const A of this.children)A.visible&&A.containsScreenPoint(s.state,s.passOptions.position,2*F)&&this._renderTile(A,s,ue.RI.All);c.draw(s),c.unbind(),a.bindFramebuffer(d),a.restoreViewport(p),s.passOptions=f,s.drawPhase=S}_renderFeatures(s,a){const c=this._getHeatmapInstance(s);null!=c?this._renderHeatmapFeatures(s,a,c):this._renderGeometryFeatures(s,a)}_renderGeometryFeatures(s,a){for(const c of this.children)c.visible&&this._renderTile(c,s,a)}_renderHeatmapFeatures(s,a,c){for(const d of this.children)d.visible&&this._renderTile(d,s,a,lt.N.Heatmap);c.techniqueRef.renderResolvePass(s,c)}_renderTile(s,a,c,d){const p=(0,P.A)("featurelayer-strict-draw-order")?ue.ch.STRICT_ORDER:(0,P.A)("featurelayer-force-marker-text-draw-order")?ue.ch.STRICT_MARKERS_AND_TEXT:ue.ch.BATCHING,f=s.getDisplayList(this._instanceStore,p);a.selection=c,f?.render(a,d)}}var ur=h(19284);function ut(){return(ut=(0,v.A)(function*(u){const s=yield(0,ur.ho)("FeaturePipelineWorker",{client:u,strategy:"dedicated"});return new dr(s)})).apply(this,arguments)}class dr{constructor(s){this._connection=s,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}var pr=h(42425),hr=h(12619);let Me=class extends O.A{constructor(){super(...arguments),this.events=new pr.A,this._updatingStrategy=!0,this._tileToEvent=new hr.A,this._fetchStatus={outstanding:0,done:0}}get hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}get willQueryAllFeatures(){return this._strategyInfo?.willQueryAllFeatures??!1}get willQueryFullResolutionGeometry(){return this._strategyInfo?.willQueryAllFeatures??!1}onEvent(u){switch(u.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(u);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=u.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",u);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),u.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllTileData(){for(const u of this._tileToEvent.values())if("loaded"!==u.peekLast()?.type)return!1;return!0}_handleTileEvent(u){switch(u.type){case"subscribe":{const s=new kt.A(10);s.enqueue(u),this._tileToEvent.set(u.tile,s);break}case"unsubscribe":this._tileToEvent.delete(u.tile);break;case"loaded":{const s=this._tileToEvent.get(u.tile);if(!s)return;s.enqueue(u),this._tileToEvent.set(u.tile,s);break}case"error":{const s=this._tileToEvent.get(u.tile);if(!s)return;s.enqueue(u),this._tileToEvent.set(u.tile,s),this.events.emit("error",u);break}}}};(0,w._)([(0,x.MZ)({readOnly:!0})],Me.prototype,"hasAllData",null),(0,w._)([(0,x.MZ)()],Me.prototype,"willQueryAllFeatures",null),(0,w._)([(0,x.MZ)()],Me.prototype,"willQueryFullResolutionGeometry",null),(0,w._)([(0,x.MZ)()],Me.prototype,"_updatingStrategy",void 0),(0,w._)([(0,x.MZ)()],Me.prototype,"_strategyInfo",void 0),(0,w._)([(0,x.MZ)()],Me.prototype,"_tileToEvent",void 0),Me=(0,w._)([(0,$.$)("esri.views.2d.layers.features.FeatureSourceEventLog")],Me);var qe=h(77806),it=h(68438);function xe(u){switch(u.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"mesh":case"polygon":return"esriGeometryPolygon";case"multipatch":return"esriGeometryMultiPatch";case"multipoint":return"esriGeometryMultipoint";default:return null}}var Ke=h(67685);function ye(u,s){const a=u.featureReduction;return a&&"selection"!==a.type&&(!("maxScale"in a)||!a.maxScale||a.maxScale<s.scale)?a:null}var st=h(69287),yr=h(48716),Te=h(64765);const mr=Math.PI;function Zt(u,s){switch(s.transformationType){case Te._w.Additive:return function gr(u,s){return u+(Ie(s.minSize,u)||s.minDataValue)}(u,s);case Te._w.Constant:return function _r(u,s){const a=u.stops;let c=a?.length&&a[0].size;return null==c&&(c=u.minSize),Ie(c,s)}(s,u);case Te._w.ClampedLinear:return function vr(u,s){const a=s.minDataValue,c=s.maxDataValue,d=(u-a)/(c-a),p=Ie(s.minSize,u),f=Ie(s.maxSize,u);return u<=a?p:u>=c?f:p+d*(f-p)}(u,s);case Te._w.Proportional:return function br(u,s){const a=u/s.minDataValue,c=Ie(s.minSize,u),d=Ie(s.maxSize,u);let p=null;return p=a*c,(0,st.qE)(p,c,d)}(u,s);case Te._w.Stops:return function Sr(u,s){const[a,c,d]=function xr(u,s){if(!s)return;let a=0,c=s.length-1;return s.some((d,p)=>u<d?(c=p,!0):(a=p,!1)),[a,c,(u-s[a])/(s[c]-s[a])]}(u,s.cache.ipData);if(a===c)return Ie(s.stops[a].size,u);{const p=Ie(s.stops[a].size,u);return p+(Ie(s.stops[c].size,u)-p)*d}}(u,s);case Te._w.RealWorldSize:return function Ir(u,s){const a=yr.j[s.valueUnit],c=Ie(s.minSize,u),d=Ie(s.maxSize,u),{valueRepresentation:p}=s;let f=null;return f="area"===p?2*Math.sqrt(u/mr)/a:"radius"===p||"distance"===p?2*u/a:u/a,(0,st.qE)(f,c,d)}(u,s);case Te._w.Identity:return u;case Te._w.Unknown:return null}}function Ie(u,s){return"number"==typeof u?u:Zt(s,u)}function we(u){return(u.labelsVisible&&u.labelingInfo?.every(s=>"none"!==s.deconflictionStrategy))??!1}function Be(u,s){const a=ye(u,s);if(a?.labelsVisible&&a.labelingInfo?.length)return a.labelingInfo.every(c=>"none"!==c.deconflictionStrategy)}function Er(u){return s=>(0,Ke.Lz)(Zt(s,u))}function Ve(u){const s=null!=u&&"visualVariables"in u&&u.visualVariables;if(!s)return null;for(const a of s)if("size"===a.type)return Er(a);return null}function Ne(u,s,a,c){const p=(0,g.mA)(u.definitionExpression,null!=u.subtypeCode?`${u.subtypeField} = ${u.subtypeCode}`:null),f=u.customParameters??{},S=s.displayFilterEnabled&&u.displayFilterInfo?u.displayFilterInfo.toJSON():null;return c&&(f.token=c),{type:"feature",mutable:{sourceRefreshVersion:a,availableFields:s.availableFields,displayFilterInfo:S,dataFilter:{definitionExpression:p,customParameters:f,gdbVersion:u.gdbVersion,historicMoment:u.historicMoment?.getTime(),queryScaleRanges:u.queryScaleRanges??[],timeExtent:u.timeExtent?.toJSON()}}}}var Fr=h(15848),Ar=h(73975),Mr=h(78592),Jt=h(88521),wr=h(55417),Rr=h(46602),We=h(26747),Ee=h(65374),Or=h(54935),Tr=h(30365);function Vr(u,s,a=0){if(null==s)return u[a]=0,u[a+1]=0,u[a+2]=0,void(u[a+3]=0);const{r:c,g:d,b:p,a:f}=s;u[a]=c*f/255,u[a+1]=d*f/255,u[a+2]=p*f/255,u[a+3]=f}h(97550);var nt=h(47669),at=h(29822),ae=h(13220),Ye=h(34155),Pe=h(99845);function Re(u,s){return ct.apply(this,arguments)}function ct(){return(ct=(0,v.A)(function*(u,s){if(!u)return[];switch(u.type){case"simple-fill":return mt(u,s);case"picture-fill":return function Wr(u,s){const{outline:a}=u,{uniforms:c,schemaOptions:d}=s,{store:p}=d,f=[],S=We.wp.createPictureFillRasterizationParam(u);if(!S)return[];const{width:E,height:M,xoffset:F,yoffset:A,xscale:z,yscale:ee}=u,re={color:[255,255,255,255],sprite:S,height:M,aspectRatio:E/M,offsetX:F,offsetY:A,scaleX:z,scaleY:ee,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===a?.style)return[p.ensureInstance(de.YS.complexOutlineFill,{uniforms:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableSizeScaleStops:c.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({...re,...yt(a,!!c.visualVariableSizeOutlineScaleStops)})];const oe=p.ensureInstance(de.YS.complexFill,{uniforms:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity},optionalAttributes:{zoomRange:!1}});return f.push(oe.createMeshInfo(re)),a&&f.push(...Ze(a,s,!0)),f}(u,s);case"simple-marker":return Qt(u,s);case"picture-marker":return function Ur(u,s){const{uniforms:a,schemaOptions:c}=s,{store:d}=c,p=d.ensureInstance(de.YS.marker,{uniforms:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeMinMaxValue:a.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:a.visualVariableSizeScaleStops,visualVariableSizeStops:a.visualVariableSizeStops,visualVariableSizeUnitValue:a.visualVariableSizeUnitValue,visualVariableRotation:a.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),f=We.wp.createPictureMarkerRasterizationParam(u);return f?[p.createMeshInfo({type:"picture",color:[255,255,255,255],height:u.height,width:u.width,offsetX:u.xoffset,offsetY:u.yoffset,angle:u.angle,alignment:(0,Pe.N)(a)?Ee.C1.MAP:Ee.C1.SCREEN,outlineColor:null,outlineSize:0,referenceSize:u.height,sprite:f,overrideOutlineColor:!1,hasSizeVV:(0,Pe.I)(a),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,ae.j0)(a)})]:[]}(u,s);case"simple-line":return Ze(u,s,!1);case"text":return function zr(u,s){const{uniforms:a,schemaOptions:c}=s,{store:d}=c;return[d.ensureInstance(de.YS.text,{uniforms:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity,visualVariableRotation:a.visualVariableRotation,visualVariableSizeMinMaxValue:a.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:a.visualVariableSizeScaleStops,visualVariableSizeStops:a.visualVariableSizeStops,visualVariableSizeUnitValue:a.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}}).createMeshInfo({boxBackgroundColor:u.backgroundColor?.toArray(),boxBorderLineColor:u.borderLineColor?.toArray(),boxBorderLineSize:u.borderLineSize??0,color:u.color?.toArray()??[0,0,0,0],offsetX:u.xoffset,offsetY:u.yoffset,postAngle:u.angle,fontSize:u.font.size,decoration:u.font.decoration,haloColor:u.haloColor?.toArray()??[0,0,0,0],haloSize:u.haloSize??0,outlineColor:[0,0,0,0],outlineSize:0,lineWidth:u.lineWidth,lineHeightRatio:u.lineHeight,horizontalAlignment:u.horizontalAlignment,verticalAlignment:u.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:u.font.toJSON(),textString:u.text,symbol:We.wp.createCIMTextSymbolfromTextSymbol(u)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:(0,ae.j0)(a),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}(u,s);case"label":return function jr(u,s){const{schemaOptions:a,uniforms:c}=s,{store:d}=a,p=u.symbol,{allowOverrun:f,repeatLabel:S,repeatLabelDistance:E}=u,M={maxScale:u.maxScale??0,minScale:u.minScale??0},F=d.ensureInstance(de.YS.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:c.visualVariableRotation,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}}),A=u.labelPlacement,[z,ee]=(0,Tr.fO)(A);return[F.createMeshInfo({boxBackgroundColor:p.backgroundColor?.toArray(),boxBorderLineColor:p.borderLineColor?.toArray(),boxBorderLineSize:p.borderLineSize??0,color:p.color?.toArray()??[0,0,0,0],offsetX:p.xoffset,offsetY:p.yoffset,postAngle:p.angle,fontSize:p.font.size,decoration:p.font.decoration,outlineColor:[0,0,0,0],outlineSize:0,haloColor:p.haloColor?.toArray()??[0,0,0,0],haloSize:p.haloSize??0,lineWidth:p.lineWidth,lineHeightRatio:p.lineHeight,horizontalAlignment:z,verticalAlignment:ee,repeatLabel:S,repeatLabelDistance:(0,Ke.Lz)(E),allowOverrun:f,labelPosition:u.labelPosition,scaleInfo:M,minPixelBuffer:(0,ae.j0)(c),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:p.font.toJSON(),textString:p.text,symbol:We.wp.createCIMTextSymbolfromTextSymbol(p),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==u.labelExpressionInfo?.expression,overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:u.labelExpressionInfo?.expression??u.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1})]}(u,s);case"cim":return(0,Ye.Jk)(u.data,s);case"web-style":{const a=yield u.fetchCIMSymbol();return(0,Ye.Jk)(a.data,s)}case"line-3d":return J.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${u.type}" unsupported in MapView. Defaulting to simple-line`),Ze(new wr.A,s,!1);case"point-3d":return J.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${u.type}" unsupported in MapView. Defaulting to simple-marker`),Qt(new Rr.A,s);case"polygon-3d":return J.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${u.type}" unsupported in MapView. Defaulting to simple-fill`),mt(new Jt.A,s);case"mesh-3d":case"label-3d":return J.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${u.type}" unsupported in MapView. Ignoring`),[];case"CIMSymbolReference":throw new Error("InternalError: CIMSymbolReference should already be resolved")}})).apply(this,arguments)}function Pr(u,s){return dt.apply(this,arguments)}function dt(){return(dt=(0,v.A)(function*(u,s){const{schemaOptions:a}=s,{store:c}=a,d=new Array(nt.ju),p=new Array(nt.ju/4);for(let A=0;A<nt.ju;A++){const z=A<u.attributes.length?u.attributes[A].color:null;d[A]=[0,0,0,0],Vr(d[A],z)}for(let A=0;A<nt.ju/4;A++)p[A]=[0,0,0,0],p[A][0]=4*A<u.attributes.length?1:0,p[A][1]=4*A+1<u.attributes.length?1:0,p[A][2]=4*A+2<u.attributes.length?1:0,p[A][3]=4*A+3<u.attributes.length?1:0;const S=c.ensureInstance(de.YS.dotDensity,{uniforms:{isActive:p,colors:d,dotValue:u.dotValue,dotScale:u.referenceScale,blending:u.dotBlendingEnabled,dotSize:u.dotSize,seed:u.seed},optionalAttributes:{}}).createMeshInfo({effects:null}),E=[],M=new Jt.A({color:u.backgroundColor??[0,0,0,0],outline:null}),F=yield Re(M,s);if(E.push(...F),E.push(S),u.outline){const A=Ze(u.outline,s,!0);E.push(...A)}return E})).apply(this,arguments)}function Cr(u,s){return pt.apply(this,arguments)}function pt(){return(pt=(0,v.A)(function*(u,s){const{store:a}=s,{radius:c,minDensity:d,maxDensity:p,referenceScale:f,field:S,valueExpression:E,colorStops:M}=u,F=(0,Mr.O3)(M);return[a.ensureInstance(de.YS.heatmap,{uniforms:{radius:(0,Ke.Lz)(c),minDensity:d,maxDensity:p,referenceScale:f,isFieldActive:!(!S&&!E),gradient:F,gradientHash:F.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]})).apply(this,arguments)}function Dr(u,s){return ht.apply(this,arguments)}function ht(){return(ht=(0,v.A)(function*(u,s){const{store:a}=s,c=u.outline?.width||0,d=(0,ae.K4)(u),p=a.ensureInstance(de.YS.pieChart,{uniforms:{shader:{outlineWidth:Math.round((0,Ke.Lz)(c)),defaultColor:(0,at.p)(u.defaultColor),outlineColor:(0,at.p)(u.outline?.color),othersColor:(0,at.p)(u.othersCategory?.color),donutRatio:u.holePercentage,sectorThreshold:u.othersCategory?.threshold||0,colors:u.attributes.map(f=>(0,at.p)(f.color)),visualVariableOpacity:d.visualVariableOpacity,visualVariableSizeMinMaxValue:d.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:d.visualVariableSizeScaleStops,visualVariableSizeStops:d.visualVariableSizeStops,visualVariableSizeUnitValue:d.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:u.attributes.length},optionalAttributes:{}}).createMeshInfo({size:u.size,outlineWidth:c,effects:null,scaleInfo:null,minPixelBuffer:(0,ae.j0)(d)});return[...u.backgroundFillSymbol?yield mt(u.backgroundFillSymbol,{schemaOptions:s,path:"",uniforms:ae.Dk}):[],p]})).apply(this,arguments)}function Gt(u){if("path"===u.style){if(null==u.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:u.path,asFill:!0}}}const s=We.wp.fromSimpleMarker(u);if("outline"in u&&u.outline&&"none"!==u.outline.style&&"solid"!==u.outline.style){if(!s||!s.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:s.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:(0,Or.eR)(s),overrides:[]}}function Qt(u,s){return ft.apply(this,arguments)}function ft(){return(ft=(0,v.A)(function*(u,s){const{uniforms:a,schemaOptions:c}=s,{store:d}=c;if("path"===u.style||u.outline&&"solid"!==u.outline.style&&"none"!==u.outline.style){const z=We.wp.fromSimpleMarker(u);if(!z||!z.symbolLayers)throw new Error("Error handling marker! ");if(a.visualVariableRotation&&(z.angleAlignment="Map"),"path"!==u.style){const ee=z.symbolLayers[0];if((0,Pe.I)(s.uniforms)){const re=(0,ae.j0)(s.uniforms,0,1);if(re>ee.size){const oe=re/ee.size;ee.size=re;const ge=ee.markerGraphics?.[0].symbol;(ge.symbolLayers&&ge.symbolLayers[0]).width*=oe}}}return(0,Ye.Jk)({type:"CIMSymbolReference",symbol:z},s)}const p=d.ensureInstance(de.YS.marker,{uniforms:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeMinMaxValue:a.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:a.visualVariableSizeScaleStops,visualVariableSizeStops:a.visualVariableSizeStops,visualVariableSizeUnitValue:a.visualVariableSizeUnitValue,visualVariableRotation:a.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),f=Gt(u);let S=u.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===f.resource.type&&(S=[255,255,255,255]);const M=u.size,A=null!=a.visualVariableColor&&("cross"===u.style||"x"===u.style);return[p.createMeshInfo({type:"simple",color:S,height:M,width:M*("triangle"===u.style?124/116:1),offsetX:u.xoffset,offsetY:u.yoffset,angle:u.angle,alignment:(0,Pe.N)(a)?Ee.C1.MAP:Ee.C1.SCREEN,outlineColor:u.outline?.color?.toArray()??[0,0,0,0],outlineSize:u.outline?.width??1,referenceSize:M,sprite:f,overrideOutlineColor:A,hasSizeVV:(0,Pe.I)(a),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,ae.j0)(a)})]})).apply(this,arguments)}function yt(u,s){const a=u.width;return{outlineColor:u.color?.toArray()||[0,0,0,1],width:a,referenceWidth:a,capType:u.cap??"round",joinType:u.join??"round",miterLimit:u.miterLimit,hasSizeVV:s}}function mt(u,s){return gt.apply(this,arguments)}function gt(){return(gt=(0,v.A)(function*(u,s){if("cim"===u.type)return(0,Ye.Jk)(u.data,s);const{style:a}=u;return a&&"none"!==a&&"solid"!==a?function Br(u,s){const{uniforms:a,schemaOptions:c}=s,{store:d}=c,p=u.color?.toArray()??[0,0,0,0],f={type:"sprite-rasterization-param",resource:{type:"fill-style",style:u.style},overrides:[]};if("solid"===u.outline?.style)return[d.ensureInstance(de.YS.patternOutlineFill,{uniforms:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeScaleStops:a.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:p,...yt(u.outline,!!a.visualVariableSizeOutlineScaleStops),sprite:f,scaleInfo:null,effects:null})];const S=[],E=d.ensureInstance(de.YS.patternFill,{uniforms:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:u.color?.toArray()??[0,0,0,0],sprite:f,scaleInfo:null,effects:null});return S.push(E),u.outline&&S.push(...Ze(u.outline,s,!0)),S}(u,s):function Nr(u,s){const{uniforms:a,schemaOptions:c}=s,{store:d}=c,p=u.color?.toArray()??[0,0,0,0];if("none"!==u.style&&"solid"===u.outline?.style)return[d.ensureInstance(de.YS.outlineFill,{uniforms:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeScaleStops:a.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:p,...yt(u.outline,!!a.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null})];const f=[];if("none"!==u.style){const S=d.ensureInstance(de.YS.fill,{uniforms:{visualVariableColor:a.visualVariableColor,visualVariableOpacity:a.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:p,scaleInfo:null,effects:null});f.push(S)}return u.outline&&f.push(...Ze(u.outline,s,!0)),f}(u,s)})).apply(this,arguments)}function Ze(u,s,a){const{color:c,style:d,width:p,cap:f,join:S}=u,{schemaOptions:E}=s,{store:M}=E,F=[],A=a?{...ae.Dk,visualVariableSizeScaleStops:s.uniforms.visualVariableSizeOutlineScaleStops}:s.uniforms,z={uniforms:{visualVariableColor:A.visualVariableColor,visualVariableOpacity:A.visualVariableOpacity,visualVariableSizeMinMaxValue:A.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:A.visualVariableSizeScaleStops,visualVariableSizeStops:A.visualVariableSizeStops,visualVariableSizeUnitValue:A.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}},ee={color:c?.toArray()??[0,0,0,0],width:p,referenceWidth:p,capType:f,joinType:S,miterLimit:u.miterLimit,hasSizeVV:(0,Pe.I)(A),effects:null,scaleInfo:null};if(null==d||"solid"===d){const re=M.ensureInstance(de.YS.line,z).createMeshInfo(ee);F.push(re)}else if("none"!==d){const re=M.ensureInstance(de.YS.texturedLine,z).createMeshInfo({...ee,offsetAlongLine:0,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:(0,We.BW)(d,f)},overrides:[]}});F.push(re)}return null!=u.marker&&F.push(...function Lr(u,s,a){const{uniforms:c,schemaOptions:d}=a,{store:p}=d,f=p.ensureInstance(de.YS.marker,{uniforms:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue,visualVariableRotation:c.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),S=Gt(u),M=6*s.width,F=M,A=u.color?.toArray()??s.color?.toArray()??[0,0,0,0],z="cross"===u.style||"x"===u.style;let ee;switch(u.placement){case"begin-end":ee=Ee.$2.Both;break;case"begin":ee=Ee.$2.JustBegin;break;case"end":ee=Ee.$2.JustEnd;break;default:ee=Ee.$2.None}const re={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:ee,offsetAlongLine:0},overrides:[]};return[f.createMeshInfo({type:"simple",color:A,height:F,width:M,offsetX:0,offsetY:0,angle:0,alignment:(0,Pe.N)(c)?Ee.C1.MAP:Ee.C1.SCREEN,outlineColor:A,outlineSize:z?s.width:0,referenceSize:F/6,sprite:S,overrideOutlineColor:z&&null!=c.visualVariableColor,hasSizeVV:(0,Pe.I)(c),placement:re,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:(0,ae.j0)(c)})]}(u.marker,u,s)),F}function Ce(u,s,a){return _t.apply(this,arguments)}function _t(){return _t=(0,v.A)(function*(u,s,a){const c=s.labelsVisible&&s.labelingInfo||[],d=xe(s),p=(0,Ar.z)(c,d);return{type:"label",classes:yield Promise.all(p.map((f,S)=>function kr(u,s,a,c){return vt.apply(this,arguments)}(u,f,S,a)))}}),_t.apply(this,arguments)}function vt(){return(vt=(0,v.A)(function*(u,s,a,c){const d=yield Re(s,{path:`${a}`,schemaOptions:u,uniforms:c});return{maxScale:s.maxScale,minScale:s.minScale,expression:s.labelExpressionInfo?.expression??s.labelExpression,where:s.where,meshes:d}})).apply(this,arguments)}function De(u,s){return bt.apply(this,arguments)}function bt(){return bt=(0,v.A)(function*(u,s){if(!s)return{type:"simple",meshes:[]};switch(s.type){case"simple":return function Kr(u,s){return St.apply(this,arguments)}(u,s);case"dot-density":return function Zr(u,s){return It.apply(this,arguments)}(u,s);case"class-breaks":return function Jr(u,s){return xt.apply(this,arguments)}(u,s);case"unique-value":return function Gr(u,s){return Et.apply(this,arguments)}(u,s);case"dictionary":return function Qr(u){const s=(0,ae.K4)(u),a=u.scaleExpression;return{type:"dictionary",fieldMap:u.fieldMap,scaleExpression:null!=a&&"1"!==a?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:u.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0,visualVariableUniforms:s}}(s);case"heatmap":return function $r(u,s){return Ft.apply(this,arguments)}(u,s);case"pie-chart":return function Hr(u,s){return At.apply(this,arguments)}(u,s)}}),bt.apply(this,arguments)}function St(){return(St=(0,v.A)(function*(u,s){const a=s.symbols,c=a.length?a[0]:null,d=(0,ae.K4)(s);return{type:"simple",meshes:yield Re(c,{schemaOptions:u,uniforms:d,path:"renderer.symbol"})}})).apply(this,arguments)}function It(){return(It=(0,v.A)(function*(u,s){const a=(0,ae.K4)(s);return{type:"dot-density",meshes:yield Pr(s,{schemaOptions:u,uniforms:a,path:"renderer.symbol"})}})).apply(this,arguments)}function xt(){return xt=(0,v.A)(function*(u,s){const a=(0,ae.K4)(s),c=s.backgroundFillSymbol,d=s.normalizationType,p="log"===d?"esriNormalizeByLog":"percent-of-total"===d?"esriNormalizeByPercentOfTotal":"field"===d?"esriNormalizeByField":null,f=s.classBreakInfos.map(function(){var F=(0,v.A)(function*(A){return{meshes:yield Re(A.symbol,{path:`renderer-stop-${A.minValue}-${A.maxValue}`,schemaOptions:u,uniforms:a}),min:A.minValue,max:A.maxValue}});return function(A){return F.apply(this,arguments)}}()),S=(yield Promise.all(f)).sort((F,A)=>F.min-A.min),E=yield Re(c,{schemaOptions:u,path:"renderer.backgroundFill",uniforms:{...ae.Dk,visualVariableSizeOutlineScaleStops:a.visualVariableSizeOutlineScaleStops}}),M=yield Re(s.defaultSymbol,{schemaOptions:u,path:"renderer.defaultSymbol",uniforms:a});return{type:"interval",field:s.field,expression:s.valueExpression,backgroundFill:E,defaultSymbol:M,intervals:S,normalizationField:s.normalizationField,normalizationTotal:s.normalizationTotal,normalizationType:p,isMaxInclusive:s.isMaxInclusive}}),xt.apply(this,arguments)}function Et(){return(Et=(0,v.A)(function*(u,s){const a=[],c=(0,ae.K4)(s),d=yield Re(s.backgroundFillSymbol,{schemaOptions:u,path:"renderer.backgroundFill",uniforms:{...ae.Dk,visualVariableSizeOutlineScaleStops:c.visualVariableSizeOutlineScaleStops}}),p=yield Re(s.defaultSymbol,{schemaOptions:u,path:"renderer.defaultSymbol",uniforms:c});for(const f of s.uniqueValueInfos??[]){const S=yield Re(f.symbol,{path:`renderer-unique-value-${f.value}`,schemaOptions:u,uniforms:c});a.push({value:""+f.value,symbol:S})}return{type:"map",field:s.field,expression:s.valueExpression,field2:s.field2,field3:s.field3,fieldDelimiter:s.fieldDelimiter,backgroundFill:d,defaultSymbol:p,map:a}})).apply(this,arguments)}function Ft(){return(Ft=(0,v.A)(function*(u,s){return{type:"heatmap",meshes:yield Cr(s,u)}})).apply(this,arguments)}function At(){return(At=(0,v.A)(function*(u,s){return{type:"pie-chart",meshes:yield Dr(s,u)}})).apply(this,arguments)}var Xe=h(84836);function Mt(){return(Mt=(0,v.A)(function*(u,s){const a=s.renderer,c=(0,ae.K4)(a);return{symbology:yield De(u,a),labels:yield Ce(u,s,c)}})).apply(this,arguments)}function Ue(u,s,a,c){return wt.apply(this,arguments)}function wt(){return wt=(0,v.A)(function*(u,s,a,c){const d=a.featureReduction;if(d)switch(d.type){case"binning":return function Xr(u,s,a,c,d){return Ot.apply(this,arguments)}(d,u,s,a,c);case"cluster":return function ei(u,s,a,c,d){return Tt.apply(this,arguments)}(d,u,s,a,c)}if(a.trackInfo?.enabled)return function ti(u,s,a,c,d){return Vt.apply(this,arguments)}(a.trackInfo,u,s,a,c);const p=function ri(u,s,a){const c=null!=s&&"unique-value"===s.type&&s.orderByClassesEnabled;if("default"!==u||c||(u=[new Fr.A({field:a,order:"descending"})]),"default"!==u&&u?.length){const d=u[0],p="ascending"===d.order?"asc":"desc";return d.field?{field:d.field,order:p}:d.valueExpression?{expression:d.valueExpression,order:p}:null}return c?{byRenderer:!0,order:"asc"}:null}(a.orderBy,a.renderer,a.objectIdField),f=(0,Xe.T9)(a.renderer,s.filters),S=yield function qr(u,s){return Mt.apply(this,arguments)}(u,a),E=ot(S.symbology);return{storage:f,mesh:{properties:{sortKey:p,timeZone:s.timeZone,returnMeshObjectId:E,displayRefreshVersion:c,currentUser:s.currentUser},strategy:{type:"feature"},factory:S},expressionProperties:{timeExtent:s.timeExtent?.toJSON()}}}),wt.apply(this,arguments)}function Rt(u,s){return u.fields.map(a=>({...a.toJSON(),type:Yr(a,s)}))}function Yr(u,s){const{onStatisticExpression:a,onStatisticField:c,statisticType:d}=u;switch(d){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(a){const{returnType:f}=a;return f?"string"===f?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}const p=s.find(f=>f.name===c);return p?p.type:"esriFieldTypeString"}}}function Ot(){return(Ot=(0,v.A)(function*(u,s,a,c,d){const p=Rt(u,c.fields),f=u.renderer,S=yield De(s,f),E=(0,Xe.T9)(f,[null,null]),M=(0,ae.K4)(f),F=yield Ce(s,{geometryType:"polygon",labelingInfo:u.labelingInfo,labelsVisible:u.labelsVisible},M),A=ot(S),z="geohash"===u.binType?{type:"geohash",fixBinLevel:u.fixedBinLevel??3}:{type:"grid",size:(0,Ke.Lz)(u.size),fixedBinLevel:u.fixedBinLevel};return{storage:E,mesh:{properties:{sortKey:null,timeZone:a.timeZone,returnMeshObjectId:A,displayRefreshVersion:d,currentUser:a.currentUser},strategy:{type:"binning",fields:p,index:z,featureFilter:a.filters[0]},factory:{labels:F,symbology:S}},expressionProperties:{timeExtent:a.timeExtent?.toJSON()}}})).apply(this,arguments)}function Tt(){return(Tt=(0,v.A)(function*(u,s,a,c,d){const p=Rt(u,c.fields),f={type:"cluster",feature:yield De(s,u.effectiveFeatureRenderer),cluster:yield De(s,u.effectiveClusterRenderer)},S=(0,ae.K4)(u.effectiveFeatureRenderer),E={type:"cluster",feature:yield Ce(s,c,S),cluster:yield Ce(s,{geometryType:"point",labelingInfo:u.labelingInfo,labelsVisible:u.labelsVisible},S)},M=(0,Xe.T9)(u.effectiveFeatureRenderer,[null,null]),F=ot(f);return{storage:M,mesh:{properties:{sortKey:null,timeZone:a.timeZone,displayRefreshVersion:d,returnMeshObjectId:F,currentUser:a.currentUser},strategy:{type:"cluster",fields:p,featureFilter:a.filters[0],clusterRadius:(0,Ke.Lz)(u.clusterRadius/2)},factory:{labels:E,symbology:f}},expressionProperties:{timeExtent:a.timeExtent?.toJSON()}}})).apply(this,arguments)}function Vt(){return(Vt=(0,v.A)(function*(u,s,a,c,d){const p=Rt(u,c.fields),f={type:"track",previousObservation:yield De(s,u.previousObservations.renderer),latestObservation:yield De(s,u.latestObservations.renderer),trackLine:yield De(s,u.trackLines.renderer)},S={type:"track",previousObservation:yield Ce(s,{geometryType:c.geometryType,labelingInfo:u.previousObservations.labelingInfo,labelsVisible:u.previousObservations.labelsVisible},(0,ae.K4)(u.previousObservations.renderer)),latestObservation:yield Ce(s,{geometryType:c.geometryType,labelingInfo:u.latestObservations.labelingInfo,labelsVisible:u.latestObservations.labelsVisible},(0,ae.K4)(u.latestObservations.renderer)),trackLine:yield Ce(s,{geometryType:"polyline",labelingInfo:u.trackLines.labelingInfo,labelsVisible:u.trackLines.labelsVisible},(0,ae.K4)(u.trackLines.renderer))},E=(0,Xe.uH)(u,[null,null]),M=ot(f);return{storage:E,mesh:{properties:{sortKey:null,timeZone:a.timeZone,returnMeshObjectId:M,displayRefreshVersion:d,currentUser:a.currentUser},strategy:{type:"track",featureFilter:a.filters[0],fields:p,maxDisplayDuration:u.maxDisplayDuration?.toMilliseconds()??0,maxDisplayObservationsPerTrack:u.maxDisplayObservationsPerTrack,showLatestObservation:u.latestObservations.visible,showPreviousObservations:u.previousObservations.visible,showTrackLine:u.trackLines.visible,timeField:u.timeField},factory:{labels:S,symbology:f}},expressionProperties:{timeExtent:a.timeExtent?.toJSON()}}})).apply(this,arguments)}function et(u){return u.techniqueType===lt.N.AnimatedMarker}function ot(u){return!!("simple"===u.type&&u.meshes.some(et)||"interval"===u.type&&(u.intervals.some(s=>s.meshes.some(et))||u.backgroundFill.some(et))||"map"===u.type&&(u.map.some(s=>s.symbol.some(et))||u.backgroundFill.some(et)))}var Le=h(79213);class ii{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const a=this.layer,c=we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{capabilities:d,editingInfo:p,objectIdField:f,globalIdField:S,datesInUnknownTimezone:E,dateFieldsTimeZone:M,orderBy:F,parsedUrl:A}=c,z=c.fieldsIndex.toJSON(),ee=xe(c),re=c.timeInfo?.toJSON(),oe=c.spatialReference.toJSON(),ge=(0,qe.o8)(A);let ze=f;if(F?.length){const Fe=!F[0].valueExpression&&F[0].field;Fe&&(ze=Fe)}const ke=(0,it.Wo)(ge.path),_e=s.spatialReference.toJSON();return{type:"feature-service",source:ge,isSourceHosted:ke,orderByFields:ze,outSpatialReference:_e,metadata:{timeReferenceUnknownClient:E,dateFieldsTimeZone:M,globalIdField:S,fieldsIndex:z,geometryType:ee,objectIdField:f,timeInfo:re,spatialReference:oe,outSpatialReference:_e,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:p?.lastEditDate?.getTime(),snapshotInfo:null}}})()}createSourceSchema(s,a){const{definitionExpression:c,displayFilterInfo:d,customParameters:p,timeExtent:f,apiKey:S}=this.layer;return Ne({definitionExpression:c,displayFilterInfo:d,customParameters:p,timeExtent:f},s,a,S)}createProcessorSchema(s,a,c){const{fields:d,geometryType:p,orderBy:f,objectIdField:S,renderer:E,labelingInfo:M,labelsVisible:F}=this.layer;return Ue(s,a,{featureReduction:null,fields:d.map(z=>z.toJSON()),geometryType:p,labelingInfo:M,labelsVisible:F,objectIdField:S,orderBy:f??"default",renderer:E?.clone()},c)}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(s){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy]}setGraphicOrigin(s){s.origin={type:"catalog",layer:this.layer}}}function Pt(u,s){const a=u.extent,c=s?.clone().intersection(a),p=s?s.width*s.height:0,f=0===p?0:(null!=c?c.width*c.height:0)/p,S=(0,P.A)("featurelayer-snapshot-point-coverage");return!isNaN(f)&&f>=S}function Ct(u,s){return null!=u.floorInfo&&(u.floorInfo.viewAllLevelIds.length>0||s.floors.length>0)}function Dt(u,s,a){const c=function si(u,s,a){if(null==u.floorInfo||!a.floors?.length)return s;let c=a.floors;const{floorField:d,viewAllLevelIds:p}=u.floorInfo;p.length&&(c=p);const f=c.filter(E=>""!==E).map(E=>"'"+E+"'");if(f.push("''"),s?.includes(d)){let E=new RegExp("AND \\("+d+".*NULL\\)","g");s=s.replace(E,""),E=new RegExp("\\("+d+".*NULL\\)","g"),s=(s=s.replace(E,"")).replaceAll(/\s+/g," ").trim()}let S="("+d+" IN ({ids}) OR "+d+" IS NULL)";return S=S.replace("{ids}",f.join(", ")),(0,g.mA)(s,S)}(u,s?.where,a);return c&&(s??=new B.A,s.where=c),s}class ni{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const a=this.layer,c=Be(a,s)??we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{capabilities:d,editingInfo:p,objectIdField:f,typeIdField:S,globalIdField:E,datesInUnknownTimezone:M,dateFieldsTimeZone:F,orderBy:A,subtypeField:z,refreshInterval:ee}=c,re=c.fieldsIndex.toJSON(),oe=xe(c),ge=c.timeInfo?.toJSON(),ze=c.spatialReference.toJSON(),ke=c.types?.map(Ge=>Ge.toJSON()),_e=(0,qe.o8)(a.layer.parsedUrl);a.layer.dynamicDataSource&&(_e.query={layer:JSON.stringify({source:a.layer.dynamicDataSource})});let Fe=a.layer.objectIdField;if(A?.length){const Ge=!A[0].valueExpression&&A[0].field;Ge&&(Fe=Ge)}const Nt=null==p?.lastEditDate&&ee>0,rt=!!(0,P.A)("featurelayer-snapshot-enabled")&&"point"===c.geometryType&&d?.query.supportsPagination&&!d?.operations.supportsEditing&&!Nt,Wt=rt&&Pt(s,c.fullExtent),Wi=(0,it.Wo)(_e.path),er=s.spatialReference.toJSON();return{type:"feature-service",source:_e,isSourceHosted:Wi,orderByFields:Fe,outSpatialReference:er,metadata:{typeIdField:S??void 0,types:ke,timeReferenceUnknownClient:M,dateFieldsTimeZone:F,subtypeField:z,globalIdField:E,fieldsIndex:re,geometryType:oe,objectIdField:f,timeInfo:ge,spatialReference:ze,outSpatialReference:er,subtypes:a.layer.subtypes?.map(Ge=>Ge.toJSON())},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:p?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:rt,supportsSnapshotMaxThreshold:Wt,snapshotCountThresholds:{min:(0,P.A)("featurelayer-snapshot-point-min-threshold"),max:(0,P.A)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(s,a){const{apiKey:c,definitionExpression:d,displayFilterInfo:p,customParameters:f,gdbVersion:S,historicMoment:E,subtypeCode:M,subtypeField:F,timeExtent:A}=this.layer;return Ne({definitionExpression:d,displayFilterInfo:p,customParameters:f,gdbVersion:S,historicMoment:E,subtypeCode:M,subtypeField:F,timeExtent:A},s,a,c)}createProcessorSchema(s,a,c){const{fields:d,renderer:p,geometryType:f,labelingInfo:S,labelsVisible:E,orderBy:M,objectIdField:F,trackInfo:A}=this.layer;return Ue(s,a,{fields:d.map(ee=>ee.toJSON()),renderer:p?.clone(),featureReduction:ye(this.layer,a),geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:F,orderBy:M??"default",trackInfo:A},c)}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(s,a){return Dt(this.layer,s,a)}getUpdateHashProperties(s){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>ye(this.layer,s),()=>Ct(this.layer,s)?s.floors:null,()=>this.layer.gdbVersion,()=>this.layer.historicMoment,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.subtypeCode,()=>this.layer.trackInfo]}}class $t{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const a=this.layer,c=Be(a,s)??we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{capabilities:d,objectIdField:p}=c,f=c.fieldsIndex.toJSON(),S=xe(c),E=c.timeInfo?.toJSON(),M=c.spatialReference.toJSON();!function ai(u){if(!("openPorts"in u))throw new j.A("source-not-supported")}(c.source);const F=yield c.source.openPorts(),A=p,z=s.spatialReference.toJSON();return{type:"memory",source:F,orderByFields:A,outSpatialReference:z,metadata:{fieldsIndex:f,geometryType:S,objectIdField:p,timeInfo:E,spatialReference:M,outSpatialReference:z,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:"datesInUnknownTimezone"in c?c.datesInUnknownTimezone:null,dateFieldsTimeZone:"dateFieldsTimeZone"in c?c.dateFieldsTimeZone:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(s,a){const{definitionExpression:c,timeExtent:d,displayFilterInfo:p}=this.layer;return Ne({customParameters:null,definitionExpression:c,displayFilterInfo:p,timeExtent:d},s,a,null)}createProcessorSchema(s,a,c){const{fields:d,renderer:p,geometryType:f,labelingInfo:S,labelsVisible:E,orderBy:M,objectIdField:F}=this.layer,A="trackInfo"in this.layer?this.layer.trackInfo:null;return Ue(s,a,{fields:d.map(ee=>ee.toJSON()),renderer:p?.clone(),featureReduction:ye(this.layer,a),geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:F,orderBy:M??"default",trackInfo:A},c)}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(s){return[()=>this.layer.definitionExpression,()=>this.layer.displayFilterInfo,()=>this.layer.orderBy,()=>"outFields"in this.layer?this.layer.outFields:null,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>ye(this.layer,s),()=>"trackInfo"in this.layer?this.layer.trackInfo:null]}}var Ht=h(62799);class oi{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const a=this.layer,c=Be(a,s)??we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{capabilities:d,objectIdField:p}=c,f=c.fieldsIndex.toJSON(),S=xe(c),E=c.spatialReference.toJSON(),M=yield c.source.openPorts(),F=p,A=s.spatialReference.toJSON();return{type:"memory",source:M,orderByFields:F,outSpatialReference:A,metadata:{fieldsIndex:f,geometryType:S,objectIdField:p,spatialReference:E,outSpatialReference:A,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:c.timeInfo?.toJSON(),timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(s,a){const{definitionExpression:c,displayFilterInfo:d}=this.layer;return Ne({definitionExpression:c,displayFilterInfo:d,customParameters:null},s,a,null)}createProcessorSchema(s,a,c){const{fields:d,renderer:p,geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:M}=this.layer;return Ue(s,a,{fields:d.map(A=>A.toJSON()),renderer:p?.clone(),featureReduction:ye(this.layer,a),geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:M,orderBy:"default"},c)}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(s){return[()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>ye(this.layer,s),()=>Ut(this.layer)]}hasFilters(s){return Ut(this.layer)}addFilters(s,a){if(Ut(this.layer)){const c=(0,g.mA)(s?.where,`${Ht.BL}=1`);if(!c)return s;s??=new B.A,s.where=c}return s}}function Ut(u){return"link-chart"===u.parentCompositeLayer.type&&"hidden"===u.parentCompositeLayer.linkChart?.linkChartProperties.nonspatialDataDisplay?.mode}class li{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const a=this.layer,c=Be(a,s)??we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{capabilities:d,objectIdField:p}=c,f=c.fieldsIndex.toJSON(),S=xe(c),E=c.timeInfo?.toJSON(),M=c.spatialReference.toJSON(),F=c.source.getSource(),A=a.layer.objectIdField,z=(0,qe.o8)(d);z.query.maxRecordCount=F.maxRecordCount;const ee=s.spatialReference.toJSON();return{type:"ogc",source:F,orderByFields:A,outSpatialReference:ee,metadata:{fieldsIndex:f,geometryType:S,objectIdField:p,timeInfo:E,spatialReference:M,outSpatialReference:ee,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:z.query.maxRecordCount,supportsCompactGeometry:z.query.supportsCompactGeometry,supportsDefaultSpatialReference:z.query.supportsDefaultSpatialReference,supportsFormatPBF:z.query.supportsFormatPBF,supportsMaxRecordCountFactor:z.query.supportsMaxRecordCountFactor,supportsQuantization:z.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(s,a){const{customParameters:c,timeExtent:d,apiKey:p}=this.layer;return Ne({customParameters:c,timeExtent:d},s,a,p)}createProcessorSchema(s,a,c){const{fields:d,renderer:p,geometryType:f,labelingInfo:S,labelsVisible:E,orderBy:M,objectIdField:F}=this.layer;return Ue(s,a,{fields:d.map(z=>z.toJSON()),renderer:p?.clone(),featureReduction:ye(this.layer,a),geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:F,orderBy:M??"default"},c)}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(s){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>ye(this.layer,s),()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy,()=>this.layer.renderer]}}class ui{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const a=this.layer,c=Be(a,s)??we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{capabilities:d,objectIdField:p,globalIdField:f,orderBy:S,refreshInterval:E}=c,M=c.fieldsIndex.toJSON(),F=xe(c),A=c.timeInfo?.toJSON(),z=c.spatialReference.toJSON(),ee=(0,qe.o8)(a.layer.parsedUrl);let re=a.layer.objectIdField;if(S?.length){const Fe=!S[0].valueExpression&&S[0].field;Fe&&(re=Fe)}const oe=E>0,ge=!!(0,P.A)("featurelayer-snapshot-enabled")&&"point"===c.geometryType&&d?.query.supportsPagination&&!d?.operations.supportsEditing&&!oe,ze=ge&&Pt(s,c.fullExtent),ke=(0,it.Wo)(ee.path),_e=s.spatialReference.toJSON();return{type:"feature-service",source:ee,isSourceHosted:ke,orderByFields:re,outSpatialReference:_e,metadata:{globalIdField:f,fieldsIndex:M,geometryType:F,objectIdField:p,timeInfo:A,spatialReference:z,outSpatialReference:_e,timeReferenceUnknownClient:c.datesInUnknownTimezone,dateFieldsTimeZone:c.dateFieldsTimeZone,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:ge,supportsSnapshotMaxThreshold:ze,snapshotCountThresholds:{min:(0,P.A)("featurelayer-snapshot-point-min-threshold"),max:(0,P.A)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(s,a){const{definitionExpression:c,displayFilterInfo:d,customParameters:p,timeExtent:f}=this.layer;return Ne({definitionExpression:c,displayFilterInfo:d,customParameters:p,timeExtent:f},s,a,null)}createProcessorSchema(s,a,c){const{fields:d,renderer:p,geometryType:f,labelingInfo:S,labelsVisible:E,orderBy:M,objectIdField:F}=this.layer;return Ue(s,a,{fields:d.map(z=>z.toJSON()),renderer:p?.clone(),featureReduction:ye(this.layer,a),geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:F,orderBy:M??"default"},c)}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(s,a){return Dt(this.layer,s,a)}getUpdateHashProperties(s){return[()=>this.layer.outFields,()=>this.layer.orderBy,()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>ye(this.layer,s),()=>this.layer.customParameters,()=>Ct(this.layer,s)?s.floors:null]}}var ci=h(49976);h(48865),h(98260);const di=new ci.J({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});function pi(u){return di.toJSON(u)}class mi{constructor(s){this.layer=s}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return null}getLabelingDeconflictionInfo(s){const a=this.layer,c=Be(a,s)??we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}getUpdateHashProperties(s){return[()=>this.layer.outFields,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>ye(this.layer,s),()=>this.layer.customParameters,()=>this.layer.orderBy,()=>this.layer.renderer,()=>this.layer.popupTemplate]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=xe(a.layer),d=s.spatialReference.toJSON();return{type:"parquet",source:{urls:a.layer.urls.items},outSpatialReference:d,geometryInfo:(u=a.layer.source.geometryInfo,"location"===u.type?{type:"location",geometryType:"esriGeometryPoint",spatialReference:"toJSON"in u.spatialReference?u.spatialReference.toJSON():u.spatialReference,latitudeFieldName:u.latitudeFieldName,longitudeFieldName:u.longitudeFieldName}:{type:"geometry",geometryType:pi(u.geometryType),spatialReference:u.spatialReference.toJSON(),format:u.format,primaryFieldName:u.primaryFieldName,multiscale:u.multiscale??null}),metadata:{spatialReference:a.layer.spatialReference,outSpatialReference:d,fieldsIndex:a.layer.fieldsIndex.toJSON(),objectIdField:a.layer.objectIdField,geometryType:c,types:null,subtypes:null,timeInfo:null,typeIdField:null,subtypeField:null,globalIdField:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null}};var u})()}createSourceSchema(s,a){return{type:"parquet",mutable:{sourceRefreshVersion:a,availableFields:s.availableFields.includes("*")?this.layer.fields.map(c=>c.name):s.availableFields,dataFilter:{customParameters:this.layer.customParameters??null}}}}createProcessorSchema(s,a,c){return Ue(s,a,{fields:this.layer.fields.map(p=>p.toJSON()),renderer:this.layer.renderer?.clone(),featureReduction:ye(this.layer,a),geometryType:this.layer.geometryType,labelingInfo:this.layer.labelingInfo,labelsVisible:this.layer.labelsVisible,objectIdField:this.layer.objectIdField,orderBy:this.layer.orderBy},c)}}class gi{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){const a=this.layer,c=Be(a,s)??we(a);return[{vvEvaluators:{0:Ve(a.renderer)},deconflictionEnabled:c}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{objectIdField:d}=c,p=xe(c),f=c.timeInfo?.toJSON()||null,S=c.spatialReference?c.spatialReference.toJSON():null,E=s.spatialReference.toJSON();return{type:"stream",source:a.layer.parsedUrl,outSpatialReference:E,metadata:{fieldsIndex:a.layer.fieldsIndex.toJSON(),geometryType:p,objectIdField:d,timeInfo:f,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,spatialReference:S,outSpatialReference:E,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}})()}createSourceSchema(s,a){const{definitionExpression:c,geometryDefinition:d,customParameters:p}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:a,availableFields:s.availableFields,dataFilter:{geometryDefinition:d?.toJSON(),definitionExpression:c,customParameters:p??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(s,a,c){const{fields:d,renderer:p,geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:M,trackInfo:F}=this.layer;return Ue(s,a,{fields:d.map(z=>z.toJSON()),renderer:p?.clone(),featureReduction:ye(this.layer,a),geometryType:f,labelingInfo:S,labelsVisible:E,objectIdField:M,orderBy:"default",trackInfo:F},c)}get hasRequiredSupport(){return(0,Le.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(s){return[()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>ye(this.layer,s),()=>this.layer.customParameters,()=>this.layer.geometryDefinition,()=>this.layer.definitionExpression,()=>this.layer.trackInfo]}}var _i=h(54551);function vi(u,s){return zt.apply(this,arguments)}function zt(){return(zt=(0,v.A)(function*(u,{subtypeField:s,sublayers:a}){const c=yield Promise.all(a.map(({renderer:d})=>De(u,d)));return{type:"subtype",subtypeField:s,renderers:a.reduce((d,{subtypeCode:p},f)=>({...d,[p]:c[f]}),{})}})).apply(this,arguments)}function bi(u,s){const a=(0,_i.C)();return{type:"multi",filters:u.filters,capabilities:{maxTextureSize:a.maxTextureSize},keyField:s.subtypeField,target:"feature",bindings:s.sublayers.reduce((c,{renderer:d,subtypeCode:p})=>({...c,[p]:(0,Xe.Jz)(d)}),{})}}function Si(u,s){return jt.apply(this,arguments)}function jt(){return(jt=(0,v.A)(function*(u,{subtypeField:s,sublayers:a}){const c=yield Promise.all(a.map(d=>{const p=(0,ae.K4)(d.renderer),f={...d,geometryType:d.geometryType??null};return Ce(u,f,p)}));return{type:"subtype",subtypeField:s,renderers:a.reduce((d,{subtypeCode:p},f)=>({...d,[p]:c[f]}),{})}})).apply(this,arguments)}function Bt(){return(Bt=(0,v.A)(function*(u,s,a,c){return{storage:bi(s,a),mesh:{properties:{timeZone:s.timeZone,displayRefreshVersion:c,returnMeshObjectId:!1,sortKey:null,currentUser:s.currentUser},strategy:{type:"feature"},factory:{symbology:yield vi(u,a),labels:yield Si(u,a)}},expressionProperties:{timeExtent:s.timeExtent?.toJSON()}}})).apply(this,arguments)}class xi{constructor(s){this.layer=s}getLabelingDeconflictionInfo(s){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.some(a=>we(a))}]}createServiceOptions(s){var a=this;return(0,v.A)(function*(){const c=a.layer,{capabilities:d,datesInUnknownTimezone:p,dateFieldsTimeZone:f,editingInfo:S,globalIdField:E,objectIdField:M,refreshInterval:F,subtypeField:A}=c,z=c.fieldsIndex.toJSON(),ee=xe(c),re=c.timeInfo?.toJSON(),oe=c.spatialReference.toJSON(),ge=(0,qe.o8)(a.layer.parsedUrl),ze=M,ke=null==S?.lastEditDate&&F>0,_e=!!(0,P.A)("featurelayer-snapshot-enabled")&&"point"===c.geometryType&&d?.query.supportsPagination&&!d?.operations.supportsEditing&&!ke,Fe=_e&&Pt(s,c.fullExtent),Nt=(0,it.Wo)(ge.path),rt=s.spatialReference.toJSON();return{type:"feature-service",source:ge,isSourceHosted:Nt,orderByFields:ze,outSpatialReference:rt,metadata:{timeReferenceUnknownClient:p,dateFieldsTimeZone:f,subtypeField:A,globalIdField:E,fieldsIndex:z,geometryType:ee,objectIdField:M,timeInfo:re,spatialReference:oe,outSpatialReference:rt,subtypes:a.layer.subtypes?.map(Wt=>Wt.toJSON()),typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:S?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:_e,supportsSnapshotMaxThreshold:Fe,snapshotCountThresholds:{min:(0,P.A)("featurelayer-snapshot-point-min-threshold"),max:(0,P.A)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(s,a){const{definitionExpression:c,customParameters:d,gdbVersion:p,historicMoment:f,subtypeField:S,timeExtent:E,apiKey:M,displayFilterInfo:F}=this.layer;return Ne({queryScaleRanges:this.layer.sublayers.items.map(z=>({subtypeCode:z.subtypeCode,minScale:z.minScale,maxScale:z.maxScale})),definitionExpression:c,displayFilterInfo:F,customParameters:d,gdbVersion:p,historicMoment:f,subtypeField:S,timeExtent:E},s,a,M)}createProcessorSchema(s,a,c){return function Ii(u,s,a,c){return Bt.apply(this,arguments)}(s,a,{subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,p=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:p.labelingInfo,labelsVisible:p.labelsVisible,renderer:p.renderer,subtypeCode:p.subtypeCode,orderBy:null}))},c)}addFilters(s,a){s=Dt(this.layer,s,a);const c=this.layer.sublayers.filter(p=>!function Ei(u,s){return u.visible&&(0===u.minScale||(0,st.Sp)(s.scale,u.minScale)||s.scale<u.minScale)&&(0===u.maxScale||(0,st.Sp)(s.scale,u.maxScale)||s.scale>u.maxScale)}(p,a)).map(p=>p.subtypeCode);if(!c.length)return s;s??=new B.A;const d=`NOT ${this.layer.subtypeField} IN (${c.join(",")})`;return s.where=(0,g.mA)(s.where,d),s}get hasRequiredSupport(){return!0}get timeOptions(){return this.layer}getUpdateHashProperties(s){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>Ct(this.layer,s)?s.floors:null,()=>this.layer.outFields,()=>this.layer.gdbVersion,()=>this.layer.historicMoment,()=>this.layer.sublayers.map(({renderer:a,labelsVisible:c,labelingInfo:d,visible:p,minScale:f,maxScale:S})=>({renderer:a,labelsVisible:c,labelingInfo:d,visible:p,minScale:f,maxScale:S}))]}setGraphicOrigin(s){const a=this.layer.fieldsIndex.get(this.layer.subtypeField),c=s.attributes[a.name],d=this.layer.sublayers.find(p=>p.subtypeCode===c);s.layer=s.sourceLayer=d}}class qt{constructor(){this._commands=new Map,this._historicMoment=null}add(s){switch(s.type){case"override":return this._addOverride(s);case"override-by-id":return this._addOverrideById(s)}}toMessage(){const s={historicMoment:this._historicMoment,commands:{updateByIdWeak:[],updateWeak:[],removeWeak:[],update:[],remove:[],release:[]}};for(const[a,c]of this._commands.entries())switch(c.type){case"override-update-by-id":s.commands.updateByIdWeak.push(a);break;case"override-update":c.isWeak?s.commands.updateWeak.push(c.feature):s.commands.update.push(c.feature);break;case"override-remove":c.isWeak?s.commands.removeWeak.push(a):s.commands.remove.push(a);break;case"override-release":s.commands.release.push(a)}return s}_addOverrideById(s){this._historicMoment=s.historicMoment;for(const a of s.updates)this._commands.set(a,{type:"override-update-by-id",isWeak:s.isWeak});for(const a of s.removed)this._commands.set(a,{type:"override-remove",isWeak:s.isWeak})}_addOverride(s){this._historicMoment=s.historicMoment;for(const a of s.updates)this._commands.set(a.objectId,{type:"override-update",feature:a,isWeak:s.isWeak});for(const a of s.removed)this._commands.set(a,{type:"override-remove",isWeak:s.isWeak});for(const a of s.release)this._commands.set(a,{type:"override-release"})}}var Fi=h(31411),ce=h(74238);function Je(u,s){const a=new Set;for(const c of u instanceof Set?u.values():u.keys())s.has(c)||a.add(c);return a}class Ai{constructor(s,a,c){const d=c?s.getTileCoverage(c,0,!0,"closest"):null,p=s.getTileCoverage(a,0,!0,"closest");if(this._tileKeys=new Map,d)for(const f of d.keys())this._tileKeys.set(f.id,f);if(p)for(const f of p.keys())this._tileKeys.set(f.id,f)}get coverageSet(){return new Set(this._tileKeys.keys())}keys(){return this._tileKeys.values()}}class Mi{constructor(s){this.version=s}}class wi{constructor(s){this._subscriptions=new Map,this._visible=new Set,this._paused=new Set,this._version=0,this._config=s}destroy(){}get _coverageSet(){return this._coverage?.coverageSet??new Set}suspend(){this._suspendedOverage=this._coverage,this._coverage=null,this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(s,a){return this._version=(this._version+1)%Number.MAX_SAFE_INTEGER,this._updateCoverage(s,a),this._updateSubscriptions(),new Set(this._visible)}_updateCoverage(s,a){this._coverage=new Ai(this._config.tileInfoView,s,a)}_updateSubscriptions(){const s=this._coverageSet,a=this._updateVisibility(),c=Je(a,s),d=Je(this._subscriptions,a),p=Je(s,this._subscriptions),f=Je(d,s),S=Je(c,f),E=Je(S,this._paused);this._visible=a;for(const M of p.values())this._subscriptions.set(M,new Mi(this._version));for(const M of E.values())this._paused.add(M);for(const M of f.values())this._subscriptions.delete(M),this._paused.delete(M);(p.size||f.size||E.size)&&this._sendUpdateSubscriptions(p,f,E)}_sendUpdateSubscriptions(s,a,c){const d=Array.from(s.values()).map(p=>({tileId:p,version:this._subscriptions.get(p).version}));this._config.updateSubscriptions({subscribe:d,unsubscribe:Array.from(a.values()),pause:Array.from(c.values())})}_updateVisibility(){const s=new Set,a=new Set;if(!this._coverage)return s;for(const p of this._coverage.keys())this._config.isDone(p)?s.add(p.id):this._addVisibleParent(s,a,p)||this._addVisibleChildren(s,p)||s.add(p.id);const c=new He.A(0,0,0,0),d=new He.A(0,0,0,0);for(const p of a){c.id=p;for(const f of s)d.id=f,c.containsChild(d)&&s.delete(f)}return s}_addVisibleParent(s,a,c){let d=!1;for(const p of this._visible.values())new He.A(p).containsChild(c)&&(s.add(p),a.add(p),d=!0);return d}_addVisibleChildren(s,a){let c=!1;for(const d of this._visible.values()){const p=new He.A(d);a.containsChild(p)&&(s.add(d),c=!0)}return c}}var Ri=h(27960),Oi=h(66722),Yt=h(14916);function Ti(u,s){if("feature"!==s.type&&"subtype-group"!==s.type)return[];if(!s.url)return[];const a="utilityNetworks"in u.map?u.map.utilityNetworks??[]:[];for(const c of a)if(c.isUtilityLayer(s)){const d=s.fieldsIndex.get("assetgroup"),p=s.fieldsIndex.get("assettype");return[d?.name,p?.name].filter(f=>null!=f)}return[]}var Vi=h(48218),tt=h(64935);class Pi{constructor(s){this._fieldsIndex=s,this._clauses=[]}finish(){var s=this;return(0,v.A)(function*(){return{requiresCurrentUser:(yield Promise.all(s._clauses)).some(a=>a.currentUserRequired)}})()}visitClientWhereClause(s){s&&this._clauses.push((0,g.GP)(s,this._fieldsIndex))}visitFeatureReduction(s){if(s)switch(s.type){case"binning":case"cluster":this.visitLabelingInfo(s.labelsVisible,s.labelingInfo)}}visitLabelingInfo(s,a){if(s&&null!=a)for(const c of a)this.visitClientWhereClause(c.where)}visitDisplayFilter(s,a){if(s)for(const c of a?.filters??[])this.visitClientWhereClause(c.where)}visitFilter(s){this.visitClientWhereClause(s?.where)}visitTrackInfo(s){null!=s&&(this.visitLabelingInfo(s?.latestObservations.labelsVisible,s?.latestObservations.labelingInfo),this.visitLabelingInfo(s?.previousObservations.labelsVisible,s?.previousObservations.labelingInfo),this.visitLabelingInfo(s?.trackLines.labelsVisible,s?.trackLines.labelingInfo))}}const Ci=u=>{let s=class extends u{constructor(...a){super(...a),this._updatingRequiredPromise=null,this.filter=null,this.layer=null,this.requiresCurrentUser=!1,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,_.wB)(()=>{const a=this.layer,c=this.view;return[a&&"elevationInfo"in a?a.elevationInfo?.featureExpressionInfo:null,a&&"displayField"in a?a.displayField:null,a&&"timeInfo"in a&&a.timeInfo,a&&"renderer"in a&&a.renderer,a&&"labelingInfo"in a&&a.labelingInfo,a&&"floorInfo"in a&&a.floorInfo,c?.requiredFieldsOptions?.featureTitleFields&&a&&"featureTitleFields"in a&&a.featureTitleFields,c?.requiredFieldsOptions?.utilityNetworkFields&&Ti(c,a),a.displayFilterInfo,this.displayFilterEnabled,this.filter,this.featureEffect,this.timeExtent,"knowledge-graph-sublayer"===a?.type&&"link-chart"===a.parentCompositeLayer.type&&a.parentCompositeLayer.linkChart?.linkChartProperties.nonspatialDataDisplay?.mode,"parquet"===a?.type&&a.popupTemplate]},()=>this._handleChange(),_.pc),(0,_.on)(()=>this.view?.floors,"change",()=>this._handleChange()),(0,_.on)(()=>this.layer.displayFilterInfo?.filters,"change",()=>this._handleChange()),(0,_.on)(()=>this.layer&&"sublayers"in this.layer?this.layer.sublayers:null,"change",()=>this._handleChange())])}get availableFields(){if(!this.layer)return[];const{layer:a,layer:{fieldsIndex:c},requiredFields:d}=this;return(0,V.DB)(c,"outFields"in a&&a.outFields?[...(0,V.hL)(c,a.outFields),...d]:d)}get displayFilterEnabled(){return(this.view?.displayFilterEnabled??!0)&&(!("displayFilterEnabled"in this.layer)||(this.layer?.displayFilterEnabled??!0))}get effectiveDisplayFilter(){const a=this.layer;return this.displayFilterEnabled&&a.displayFilterInfo?(0,Ri.u2)(a.displayFilterInfo,this.view):null}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(a){this._override("featureEffect",a)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(a){J.A.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}get signedInUser(){return this.layer?.url?(0,K.fE)(this.layer.url):Promise.resolve(null)}highlight(a,c){throw new Error("missing implementation")}createQuery(){const a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},c=null!=this.filter?this.filter.createQuery(a):new be.A(a);return"floorInfo"in this.layer&&this.layer.floorInfo&&(c.where=(0,g.mA)(c.where,(0,Yt.E)(this))),this.displayFilterEnabled&&(c.where=(0,g.mA)(c.where,this.effectiveDisplayFilter?.where)),null!=this.timeExtent&&(c.timeExtent=null!=c.timeExtent?c.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),c}createAggregateQuery(){return new be.A({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(a,c){throw new Error("missing implementation")}queryObjectIds(a,c){throw new Error("missing implementation")}queryFeatureCount(a,c){throw new Error("missing implementation")}queryExtent(a,c){throw new Error("missing implementation")}fetchPopupFeaturesFromGraphics(a,c){var d=this;return(0,v.A)(function*(){return d._validateFetchPopupFeatures(a,c),d._fetchPopupFeatures(a,c)})()}_loadArcadeModules(a){return a.expressionInfos?.length||Array.isArray(a.content)&&a.content.some(c=>"expression"===c.type)?(0,Vi.lw)():Promise.resolve()}_handleChange(){const a=Promise.all([this._updateRequiredFields(),this._updateClientWhereClauseRequirements()]).then(()=>{});return this._set("_updatingRequiredPromise",a),a.then(()=>{this._updatingRequiredPromise===a&&this._set("_updatingRequiredPromise",null)}),a}_updateClientWhereClauseRequirements(){var a=this;return(0,v.A)(function*(){if(!a.layer||!a.view)return;const{layer:c}=a,d=new Pi(c.fieldsIndex);if(d.visitFilter(a.filter),"featureReduction"in c&&d.visitFeatureReduction(c.featureReduction),"labelingInfo"in c&&d.visitLabelingInfo(c.labelsVisible,c.labelingInfo),"trackInfo"in c&&d.visitTrackInfo(c.trackInfo),"2d"===a.view.type&&(d.visitFilter(a.featureEffect?.filter),d.visitDisplayFilter(a.displayFilterEnabled,c.displayFilterInfo),"featureReduction"in c&&d.visitFeatureReduction(c.featureReduction)),"subtype-group"===c.type)for(const p of c.sublayers)d.visitLabelingInfo(p.labelsVisible,p.labelingInfo);try{const p=yield d.finish();a._set("requiresCurrentUser",p.requiresCurrentUser)}catch(p){J.A.getLogger(a).error(p)}})()}_updateRequiredFields(){var a=this;return(0,v.A)(function*(){if(!a.layer||!a.view)return;const c="3d"===a.view.type,{layer:d,layer:{fieldsIndex:p,objectIdField:f}}=a,S="renderer"in d&&d.renderer,E="orderBy"in d&&d.orderBy,M="featureReduction"in d?d.featureReduction:null,F=new Set,A=[S?S.collectRequiredFields(F,p):null,(0,V.Im)(F,d),c&&"elevationInfo"in d?(0,V.NO)(F,d):null,null!=a.filter?(0,V.o)(F,d,a.filter):null,c||null==a.featureEffect?null:(0,V.o)(F,d,a.featureEffect.filter),!c&&M?(0,V.RP)(F,d,M):null,!c&&E?(0,V.f)(F,d,E):null];if("timeInfo"in d&&d.timeInfo&&a.timeExtent&&(0,V._w)(F,d.fieldsIndex,[d.timeInfo.startField,d.timeInfo.endField]),"timeInfo"in d&&d.timeInfo&&"trackInfo"in d&&d.trackInfo){const{trackInfo:re}=d;(0,V._w)(F,d.fieldsIndex,[d.timeInfo.trackIdField]),"feature"!==d.type&&"startTimeField"!==re.timeField||(0,V._w)(F,d.fieldsIndex,[d.timeInfo.startField]),"endTimeField"===re.timeField&&(0,V._w)(F,d.fieldsIndex,[d.timeInfo.endField]),yield(0,V.d)(F,d)}if("floorInfo"in d&&d.floorInfo&&(0,V._w)(F,d.fieldsIndex,[d.floorInfo.floorField]),"featureTitleFields"in d&&a.view?.requiredFieldsOptions?.featureTitleFields&&d.featureTitleFields&&(0,V._w)(F,d.fieldsIndex,d.featureTitleFields),"feature"===d.type&&d.globalIdField&&a.view?.requiredFieldsOptions?.globalIdField&&(0,V._w)(F,d.fieldsIndex,[d.globalIdField]),a.displayFilterEnabled&&A.push((0,V.A6)(F,d,d.displayFilterInfo)),"feature"===d.type&&c&&null!=d.infoFor3D&&(null==d.globalIdField&&J.A.getLogger(a).error("globalIdField missing on 3DObjectFeatureLayer"),(0,V._w)(F,d.fieldsIndex,[d.globalIdField])),"subtype-group"===d.type){(0,V.rq)(F,p,d.subtypeField);const re=d.sublayers.map(oe=>Promise.all([oe.renderer?.collectRequiredFields(F,p),(0,V.Im)(F,oe)]));A.push(Promise.all(re))}if("catalog-footprint"===d.type&&d.parent){const re=d.parent;(0,V._w)(F,p,[re.itemNameField,re.itemSourceField,re.itemTypeField,re.maxScaleField,re.minScaleField])}"knowledge-graph-sublayer"===d.type&&"link-chart"===d.parentCompositeLayer.type&&(0,V.rq)(F,p,Ht.BL),"parquet"===d.type&&A.push((0,tt.TO)(d,d.popupTemplate).then(re=>{for(const oe of re)F.add(oe)}));const z=yield Promise.allSettled(A);(0,V.rq)(F,p,f),c&&"displayField"in d&&d.displayField&&(0,V.rq)(F,p,d.displayField);for(const re of z)"rejected"===re.status&&J.A.getLogger(a).error(re.reason);const ee=Array.from(F).sort();a._set("requiredFields",ee)})()}_validateFetchPopupFeatures(a,c){if(null!=c)for(const d of a){const p=d.origin&&"layer"in d.origin?d.origin.layer:d.layer;if("popupEnabled"in p&&!p.popupEnabled)throw new j.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:p});if(d.isAggregate){const f="featureReduction"in p?p.featureReduction:null,S="trackInfo"in p?p.trackInfo:null;if(null==f&&null==S||null!=f&&(!("popupTemplate"in f)||!f.popupEnabled||!f.popupTemplate)||S?.enabled&&(!("popupTemplate"in S)||!S.popupEnabled||!S.popupTemplate))throw new j.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:p})}else if("popupTemplate"in p&&!(0,tt.D8)(p,c))throw new j.A("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:p})}}_popupFeatureHasRequiredFields(a,c){return(0,V.Kl)(c,a)}_fetchPopupFeatures(a,c){var d=this;return(0,v.A)(function*(){const p=new Array(a.length),f=new Map,S=yield d._createPopupQuery(a.map(E=>E.origin?.layer??E.layer),c);for(let E=0;E<a.length;E++){const M=a[E];if(M.isAggregate){p[E]=M;continue}const F=M.origin?.layer??M.layer;if(!F||!("popupEnabled"in F))continue;const A=(0,V.hL)(d.layer.fieldsIndex,S.outFields),z=(0,tt.D8)(F,c);if(null==z)continue;const ee=yield d._loadArcadeModules(z);(0,m.Te)(c),ee&&ee.arcadeUtils.hasGeometryOperations(z)||!d._popupFeatureHasRequiredFields(M,A)?f.set(M.getObjectId(),{graphic:M,index:E}):p[E]=M}if("stream"===d.layer.type||"parquet"===d.layer.type||0===f.size)return p.filter(Boolean);S.objectIds=Array.from(f.keys());try{const E=yield d.layer.queryFeatures(S,c);for(const M of E.features){const{graphic:{geometry:F,origin:A},index:z}=f.get(M.getObjectId());M.geometry||=F,M.origin=A,p[z]=M}}catch{}return p.filter(Boolean)})()}_createPopupQuery(a,c){var d=this;return(0,v.A)(function*(){const p=d.layer.createQuery(),f=new Set;let S=!1;const E=a??[d.layer];for(const M of E){if(!("popupEnabled"in M))continue;const F=(0,tt.D8)(M,c);if(null==F)continue;const A=yield d._loadArcadeModules(F);(0,m.Te)(c);const z=A&&A.arcadeUtils.hasGeometryOperations(F);S=!("point"!==d.layer.geometryType&&!z);const ee=yield(0,tt.TO)(d.layer,F);(0,m.Te)(c);for(const re of ee)f.add(re)}if(p.returnGeometry=S,p.returnZ=S,p.returnM=S,p.outFields=Array.from(f),p.outSpatialReference=d.view.spatialReference,"floorInfo"in d.layer&&d.layer.floorInfo){const M=(0,Yt.E)(d);null!=M&&(p.where=p.where?`(${p.where}) AND (${M})`:M)}return p})()}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return(0,w._)([(0,x.MZ)()],s.prototype,"_updatingRequiredPromise",void 0),(0,w._)([(0,x.MZ)({readOnly:!0})],s.prototype,"availableFields",null),(0,w._)([(0,x.MZ)({readOnly:!0})],s.prototype,"displayFilterEnabled",null),(0,w._)([(0,x.MZ)({readOnly:!0})],s.prototype,"effectiveDisplayFilter",null),(0,w._)([(0,x.MZ)({type:Oi.A})],s.prototype,"featureEffect",null),(0,w._)([(0,x.MZ)({type:B.A})],s.prototype,"filter",void 0),(0,w._)([(0,x.MZ)()],s.prototype,"layer",void 0),(0,w._)([(0,x.MZ)({type:Number})],s.prototype,"maximumNumberOfFeatures",null),(0,w._)([(0,x.MZ)({readOnly:!0,type:Boolean})],s.prototype,"maximumNumberOfFeaturesExceeded",null),(0,w._)([(0,x.MZ)()],s.prototype,"requiresCurrentUser",void 0),(0,w._)([(0,x.MZ)({readOnly:!0})],s.prototype,"requiredFields",void 0),(0,w._)([(0,x.MZ)({readOnly:!0})],s.prototype,"signedInUser",null),(0,w._)([(0,x.MZ)()],s.prototype,"suspended",void 0),(0,w._)([(0,x.MZ)()],s.prototype,"view",void 0),s=(0,w._)([(0,$.$)("esri.views.layers.FeatureLayerView")],s),s};var Di=h(41474),Ui=h(96081),Li=h(56253);const Xt=4294967294;let pe=class extends(Ci((0,Ui.A)((0,Oe.e)(Di.A)))){constructor(){super(...arguments),this._commandsQueue=new Fi.j({process:u=>{switch(u.type){case"override-batch":return this._doOverride(u);case"update":return this._doUpdate();case"highlight":return this._updateHighlights()}}}),this._visibilityOverrides=new Set,this._lastAvailableFields=[],this._lastTargetState=null,this.eventLog=new Me,this._sourceRefreshVersion=1,this._displayRefreshVersion=1,this._pipelineUpdating=!1,this._editUpdatingHandles=new b.U,this._fields=null,this._sourceUpdating=!1,this.featureEffectView=new k}destroy(){this._workerProxy?.destroy(),this._workerAttached.reject((0,m.NK)()),this._commandsQueue.destroy()}initialize(){this._workerAttached=(0,m.Tw)(),(0,m.QZ)(this._workerAttached.promise),this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransition()}_initProxy(){var u=this;return(0,v.A)(function*(){const s=u.layer;if("isTable"in s&&s.isTable)throw new j.A("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:s});if(("feature"===s.type||"subtype-group"===s.type)&&!1===(0,ie.BR)(s)?.operations.supportsQuery)throw new j.A("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:s});u._workerProxy&&u._workerProxy.destroy();const a=u._createClientOptions();u._workerProxy=yield function cr(u){return ut.apply(this,arguments)}(a)})()}_attachProxy(){var u=this;return(0,v.A)(function*(){const s={service:yield u.layerAdapter.createServiceOptions(u.view),tileInfoJSON:u.view?.featuresTilingScheme?.tileInfo?.toJSON()};let a=[];Array.isArray(s.service.source)&&(a=s.service.source);try{yield u._workerProxy.pipeline.onAttach(s,{transferList:a}),u._workerAttached.resolve()}catch(c){u._workerAttached.reject((0,m.NK)()),(0,m.jH)(c)}})()}_detachProxy(){var u=this;return(0,v.A)(function*(){return u._workerProxy.pipeline.onDetach()})()}getWorker(){var u=this;return(0,v.A)(function*(){return yield u._workerAttached.promise,u._workerProxy})()}get dataUpdating(){return this._sourceUpdating||this._editUpdatingHandles.updating}get effectiveDisplayFilterClause(){const u=this.effectiveDisplayFilter?.where??null;return u&&this.hasHighlight?(0,g.IW)(u,(0,g.Yp)(this.layer.objectIdField,this.highlightIds)):u}get hasAllFeatures(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&this.eventLog.willQueryAllFeatures}get hasAllFeaturesInView(){const u=this.effectiveDisplayFilter?.where||null;return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&!(!this.eventLog.willQueryAllFeatures&&null!=u&&"1=1"!==u)}get hasFullGeometries(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&this.eventLog.willQueryFullResolutionGeometry}get labelingCollisionInfos(){const u=this.layerAdapter.getLabelingDeconflictionInfo(this.view),s=this.layer.geometryType,a=!this.suspended;return u.map(({vvEvaluators:c,deconflictionEnabled:d})=>({container:this.featureContainer,vvEvaluators:c,deconflictionEnabled:d,geometryType:s,visible:a}))}get layerAdapter(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new $t(this.layer):new ni(this.layer);case"geojson":case"csv":case"wfs":return new $t(this.layer);case"parquet":return new mi(this.layer);case"subtype-group":return new xi(this.layer);case"ogc-feature":return new li(this.layer);case"stream":return new gi(this.layer);case"oriented-imagery":return new ui(this.layer);case"knowledge-graph-sublayer":return new oi(this.layer);case"catalog-footprint":return new ii(this.layer);default:(0,L.Xb)(this.layer)}return null}get timeExtent(){return(0,X.F)(this.layerAdapter.timeOptions,this.view?.timeExtent,this._get("timeExtent"))}getDisplayStatistics(u,s){return this.featureContainer?.getDisplayStatistics(u,s)}queryHeatmapStatistics(u){var s=this;return(0,v.A)(function*(){return(yield s.getWorker()).pipeline.queryHeatmapStatistics(u)})()}highlight(u,s){let a;u instanceof H.A?a=[u.getObjectId()]:"number"==typeof u||"string"==typeof u?a=[u]:W.A.isCollection(u)&&u.length>0?a=u.map(p=>p?.getObjectId()).toArray():Array.isArray(u)&&u.length>0&&(a="number"==typeof u[0]||"string"==typeof u[0]?u:u.map(p=>p?.getObjectId()));const c=a?.filter(N.Ru);if(!c?.length)return(0,R.hA)();const d=s?.name??Li.Tv;return this._addHighlights(c,d),(0,R.hA)(()=>!this.destroyed&&this._removeHighlights(c,d))}hitTest(u,s){var a=this;return(0,v.A)(function*(){const c=yield a.featureContainer.hitTest(s);if(0===c.length)return null;const d=yield a.getWorker(),{features:p,aggregates:f,tracks:S}=yield d.pipeline.getDisplayFeatures(c),E=a.featureContainer.getSortKeys(c),M=({displayId:F},{displayId:A})=>E.has(F)&&E.has(A)?E.get(F)-E.get(A):F-A;return p.sort(M).reverse(),f.sort(M).reverse(),[...f.map(F=>a._createGraphicHit(u,Q.fromJSON(F))),...S.map(F=>a._createGraphicHit(u,q.fromJSON(F))),...p.map(F=>a._createGraphicHit(u,H.A.fromJSON(F)))]})()}queryStatistics(){var u=this;return(0,v.A)(function*(){const s=yield u.getWorker();return(0,ce.E)(s.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})})()}querySummaryStatistics(u,s,a){var c=this;return(0,v.A)(function*(){const d=yield c.getWorker(),p={...s,scale:c.view.scale},f=d.features.executeQueryForSummaryStatistics(c._cleanUpQuery(u),p,a);return(0,ce.E)(f,{})})()}queryAggregateSummaryStatistics(u,s,a){var c=this;return(0,v.A)(function*(){const d={...s,scale:c.view.scale},p=(yield c.getWorker()).aggregates.executeQueryForSummaryStatistics(c._cleanUpAggregateQuery(u),d,a);return(0,ce.E)(p,{})})()}queryUniqueValues(u,s,a){var c=this;return(0,v.A)(function*(){const d=yield c.getWorker(),p={...s,scale:c.view.scale},f=d.features.executeQueryForUniqueValues(c._cleanUpQuery(u),p,a);return(0,ce.E)(f,{uniqueValueInfos:[]})})()}queryAggregateUniqueValues(u,s,a){var c=this;return(0,v.A)(function*(){const d=yield c.getWorker(),p={...s,scale:c.view.scale},f=d.aggregates.executeQueryForUniqueValues(c._cleanUpAggregateQuery(u),p,a);return(0,ce.E)(f,{uniqueValueInfos:[]})})()}queryClassBreaks(u,s,a){var c=this;return(0,v.A)(function*(){const d=yield c.getWorker(),p={...s,scale:c.view.scale},f=d.features.executeQueryForClassBreaks(c._cleanUpQuery(u),p,a);return(0,ce.E)(f,{classBreakInfos:[]})})()}queryAggregateClassBreaks(u,s,a){var c=this;return(0,v.A)(function*(){const d=yield c.getWorker(),p={...s,scale:c.view.scale},f=d.aggregates.executeQueryForClassBreaks(c._cleanUpAggregateQuery(u),p,a);return(0,ce.E)(f,{classBreakInfos:[]})})()}queryHistogram(u,s,a){var c=this;return(0,v.A)(function*(){const d=yield c.getWorker(),p={...s,scale:c.view.scale},f=d.features.executeQueryForHistogram(c._cleanUpQuery(u),p,a);return(0,ce.E)(f,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})})()}queryAggregateHistogram(u,s,a){var c=this;return(0,v.A)(function*(){const d=yield c.getWorker(),p={...s,scale:c.view.scale},f=d.aggregates.executeQueryForHistogram(c._cleanUpAggregateQuery(u),p,a);return(0,ce.E)(f,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})})()}queryFeatures(u,s){return this.queryFeaturesJSON(u,s).then(a=>{const c=he.A.fromJSON(a);return c.features.forEach(d=>this._setLayersForFeature(d)),c})}queryVisibleFeatures(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).pipeline.queryVisibleFeatures(a._cleanUpQuery(u),s),d=yield(0,ce.E)(c,{features:[]}),p=he.A.fromJSON(d);return p.features.forEach(f=>a._setLayersForFeature(f)),p})()}queryAggregates(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).aggregates.executeQuery(a._cleanUpAggregateQuery(u),s),d=yield(0,ce.E)(c,{features:[]}),p=me.fromJSON(d);return p.features.forEach(f=>a._setLayersForFeature(f)),p})()}queryAggregateIds(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).aggregates.executeQueryForIds(a._cleanUpAggregateQuery(u),s);return(0,ce.E)(c,[])})()}queryAggregateCount(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).aggregates.executeQueryForCount(a._cleanUpAggregateQuery(u),s);return(0,ce.E)(c,0)})()}queryAggregateJSON(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).aggregates.executeQuery(a._cleanUpAggregateQuery(u),s);return(0,ce.E)(c,{features:[]})})()}queryFeaturesJSON(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).features.executeQuery(a._cleanUpQuery(u),s);return(0,ce.E)(c,{features:[]})})()}queryObjectIds(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).features.executeQueryForIds(a._cleanUpQuery(u),s);return(0,ce.E)(c,[])})()}queryFeatureCount(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).features.executeQueryForCount(a._cleanUpQuery(u),s);return(0,ce.E)(c,0)})()}queryExtent(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).features.executeQueryForExtent(a._cleanUpQuery(u),s),d=yield(0,ce.E)(c,{count:0,extent:null});return{count:d.count,extent:T.A.fromJSON(d.extent)}})()}queryAttributeBins(u,s){var a=this;return(0,v.A)(function*(){const c=(yield a.getWorker()).features.executeAttributeBinsQuery(a._cleanUpAttributeBinsQuery(u),s),d=yield(0,ce.E)(c,{features:[]});return fe.A.fromJSON(d)})()}getSampleFeatures(u){var s=this;return(0,v.A)(function*(){return(yield s.getWorker()).pipeline.getSampleFeatures(u)})()}setVisibility(u,s){s?this._visibilityOverrides.delete(u):this._visibilityOverrides.add(u),this._update()}update(u){if(!this._subscriptionManager)return;this.view.animation&&!this._lastTargetState&&(this._lastTargetState=u.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null);const s=this._subscriptionManager.update(u.targetState,this._lastTargetState);this.featureContainer.setVisibleTiles(s)}attach(){var u,s;(0,P.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),(0,m.QZ)(this._updatingHandles.addPromise(this._workerAttached.promise)),(0,m.QZ)(this._attachProxy()),this.featureContainer=new or(this),this.container.addChild(this.featureContainer),this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._subscriptionManager=new wi({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:u=>{this.featureContainer.updateSubscriptions(u),(0,m.QZ)(this._updatingHandles.addPromise(this.getWorker().then(s=>s.pipeline.updateSubscriptions(u))))},isDone:u=>this.featureContainer.isDone(u)}),this.requestUpdate(),this.addAttachHandles([(u=[()=>this._displayRefreshVersion,()=>this.layer.displayFilterInfo,()=>this.timeExtent,()=>this.clips,()=>this.filter,()=>this.effectiveDisplayFilterClause,()=>this.featureEffect,()=>this._sourceRefreshVersion,()=>this.view.timeZone,()=>this.view.timeExtent,...this.layerAdapter.getUpdateHashProperties(this.view)],s=()=>this._update(),(0,R.vE)(u.map(a=>(0,_.wB)(()=>{const c=a();return c&&"object"==typeof c?"getTime"in c&&"function"==typeof c.getTime?c.getTime():JSON.stringify(c):c},s)))),(0,_.wB)(()=>this.updateSuspended,u=>{u||(this._subscriptionManager.resume(),this.view.labelManager.requestUpdate())}),(0,_.wB)(()=>this.visible,u=>{this.view.labelManager.requestUpdate()})]),this._update(),"stream"!==this.layer.type&&"parquet"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",u=>this._editUpdatingHandles.addPromise(this._edit(u))))}detach(){(0,P.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._detachProxy(),this._fields=null,this.featureContainer.destroy(),this.featureContainer=null,this._commandsQueue.clear(),this.container.removeAllChildren(),this._subscriptionManager=(0,y.pR)(this._subscriptionManager),this._workerProxy.pipeline.onDetach(),this._workerAttached=(0,m.Tw)(),(0,m.QZ)(this._workerAttached.promise),this._lastAvailableFields=[],this._lastSchema=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}addOverrides(u){return this._commandsQueue.push({type:"override",options:{...u,release:[]}})}removeOverrides(u){for(const a of u)if(null==a)throw new j.A("featurelayerview:bad-override","Tried to remove an override for an invalid objectId",{objectId:a});return this._commandsQueue.push({type:"override",options:{added:[],updated:[],removed:[],release:u,isWeak:!1,historicMoment:null}})}isUpdating(){const u="renderer"in this.layer&&null!=this.layer.renderer,s=this._commandsQueue.updateTracking.updating,a=null!=this._updatingRequiredPromise,c=this.featureContainer.updatingHandles.updating,d=this.updateRequested||u&&(s||a)||c||this._pipelineUpdating||this.dataUpdating;if((0,P.A)("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${d}\n  -> updateRequested ${this.updateRequested}\n  -> hasRenderer ${u}\n  -> updatingRequiredFields ${a}\n  -> hasPendingCommand ${s}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${c}\n`);for(const p of this.featureContainer.subscriptions())console.log(`    -> Tile[${p.id}] Done: ${p.done}`)}return d}_createClientOptions(){const u=this;return{get container(){return u.featureContainer},setUpdating:s=>{this._set("_pipelineUpdating",s.pipeline),this._set("_sourceUpdating",s.source)},emitEvent:s=>{this.emit(s.name,s.event)},get eventLog(){return u.eventLog},fetch:(s=(0,v.A)(function*(a){if((0,P.A)("esri-2d-stabilize-glyphs")){const c=[];for(const d of a)c.push(yield u.view.stage.painter.textureManager.rasterizeItem(d));return c}return Promise.all(a.map(c=>u.view.stage.painter.textureManager.rasterizeItem(c)))}),function(c){return s.apply(this,arguments)}),fetchDictionary:s=>Promise.all(s.map(a=>this._fetchDictionaryRequest(a)))};var s}_fetchDictionaryRequest(u){var s=this;return(0,v.A)(function*(){try{if("subtype-group"===s.layer.type)throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const a=s.layer.renderer;if(!a||"dictionary"!==a.type)throw new Error("InternalError: Expected layer to have a DictionaryRenderer");const c=s._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==c.type)throw new Error("InternalError: Expected schema to be of type 'dictionary'");const d={cimAnalyzer:s.view.stage.cimAnalyzer,cimResourceManager:s.view.stage.painter.textureManager.resourceManager,store:s.featureContainer.instanceStore,scaleExpression:c.scaleExpression};s._fields||(s._fields=s.layer.fields.map(S=>S.toJSON()));const p=c.visualVariableUniforms,f=yield a.getSymbolAsync(u.feature,{fields:s._fields});return f&&f.data?{type:"dictionary-response",meshes:yield(0,Ye.Jk)(f.data,{uniforms:p,path:"renderer",schemaOptions:d})}:{type:"dictionary-response",meshes:[]}}catch{return{type:"dictionary-response",meshes:[]}}})()}_cleanUpQuery(u){const s=be.A.from(u)||this.createQuery();return s.outSpatialReference||(s.outSpatialReference=this.view.spatialReference),s.toJSON()}_cleanUpAttributeBinsQuery(u){const s=ve.default.from(u);return s.outSpatialReference||(s.outSpatialReference=this.view.spatialReference),s.toJSON()}_cleanUpAggregateQuery(u){const s=be.A.from(u)||this.createAggregateQuery();s.outSpatialReference||(s.outSpatialReference=this.view.spatialReference);const a=s.objectIds??[];for(const c of s.aggregateIds??[])a.push(c);return s.objectIds=a,s.aggregateIds=[],s.toJSON()}_update(){var u=this;return(0,v.A)(function*(){return u._commandsQueue.push({type:"update"})})()}_edit(u){return this.updateSuspended?(this._subscriptionManager.suspend(),Promise.resolve()):this._commandsQueue.push({type:"edit",event:u})}doRefresh(u){var s=this;return(0,v.A)(function*(){s.attached&&(s.updateSuspended&&u||(u?s.incrementSourceRefreshVersion():s.incrementDisplayRefreshVersion()))})()}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%Xt+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%Xt+1}_resolveIdenifiers(u){var s=this;return(0,v.A)(function*(){const a=[],c=[];for(const f of u)null==f.objectId||-1===f.objectId?null==f.globalId?J.A.getLogger(s).warn("mapview-apply-edits","A feature identifier must contain either a GlobalId or ObjectId. Ignoring",{identifier:f}):c.push(f.globalId):a.push(f.objectId);const d="globalIdField"in s.layer&&s.layer.globalIdField,p=d&&s.availableFields.includes(d);if(c.length&&!p)return J.A.getLogger(s).error(new j.A("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${d} to be included the layer's outFields for updates to be reflected on the map`)),a;if(c.length){const f=yield s._workerProxy.pipeline.getObjectIdsFromGlobalIds(c);for(const S of f)a.push(S)}return a})()}_resolveOverrides(u){const c=(0,Kt.eh)(this.layer.geometryType),d=this.layer.objectIdField,p=[];for(const f of u.added){const S=(0,U.E2)(f,c,!1,!1,d);if(null==S.objectId)throw new j.A("featurelayerview:bad-override","Feature does not have an objectId",{feature:f});p.push(S)}for(const f of u.updated){const S=(0,U.E2)(f,c,!1,!1,d);if(null==S.objectId)throw new j.A("featurelayerview:bad-override","Feature does not have an objectId",{feature:f});p.push(S)}for(const f of u.removed)if(null==f)throw new j.A("featurelayerview:bad-override","Tried to remove an invalid objectId",{objectId:f});return{type:"override",updates:p,removed:u.removed,release:u.release,isWeak:u.isWeak??!1,historicMoment:u.historicMoment??null}}_resolveEdit(u){var s=this;return(0,v.A)(function*(){const a=s.layer,c=u.historicMoment?.getTime()??null,d="layerId"in a&&u.editedFeatures?.find(E=>E.layerId===a.layerId);if(d&&s._canEditByFeature(d)){const{adds:E,deletes:M,updates:F}=d.editedFeatures,A=s.layer.objectIdField,z=F.map(oe=>oe.current),ee=M.map(oe=>"attributes"in oe?{objectId:A?oe.attributes[A]:null}:oe),re=yield s._resolveIdenifiers(ee);return s._resolveOverrides({added:E,updated:z,removed:re,historicMoment:c,isWeak:!0,release:[]})}const[p,f,S]=yield Promise.all([s._resolveIdenifiers(u.addedFeatures),s._resolveIdenifiers(u.updatedFeatures),s._resolveIdenifiers(u.deletedFeatures)]);return{type:"override-by-id",updates:[...p,...f],removed:S,historicMoment:c,isWeak:!0}})()}_canEditByFeature(u){const{adds:s,updates:a}=u.editedFeatures;return s.every(c=>this.view.spatialReference.equals(c.geometry?.spatialReference))&&a.every(c=>this.view.spatialReference.equals(c.current.geometry?.spatialReference))}_doUpdate(){var u=this;return(0,v.A)(function*(){"featureReduction"in u.layer&&u.layer.featureReduction&&u.layer.featureReduction!==u._lastFeatureReduction&&(u.layer.featureReduction=u.layer.featureReduction?.clone(),u._lastFeatureReduction=u.layer.featureReduction);try{if(yield Promise.allSettled([u._handleChange(),(0,K.d$)(u.layer)]),u.destroyed||!u.layerAdapter?.hasRequiredSupport||!u._subscriptionManager)return;const s=u.featureContainer.instanceStore;u.featureContainer.attributeView.lockTextureUploads(),s.updateStart();const a=u.featureEffect,c={store:s,cimAnalyzer:u.view.stage.cimAnalyzer,cimResourceManager:u.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},d=yield u._createViewSchemaConfig(),p={source:u.layerAdapter.createSourceSchema(d,u._sourceRefreshVersion),processor:yield u.layerAdapter.createProcessorSchema(c,d,u._displayRefreshVersion)},f=(0,I.i8)(u._lastSchema?.source.mutable,p.source.mutable)||(0,I.i8)(u._lastSchema?.processor,p.processor);if(!f)return u.featureContainer.requestRender(),u.featureContainer.attributeView.unlockTextureUploads(),s.updateEnd(),void(u.featureEffectView.featureEffect=a);u._lastSchema=p,u._fields=null;const S=Math.round(performance.now());(0,P.A)("esri-2d-update-debug")&&console.debug(`Id[${u.layer.uid}] Version[${S}] FeatureLayerView2D._doUpdate`,{changes:f}),yield(yield u.getWorker()).pipeline.updateSchema(p,S),s.updateEnd(),u.featureEffectView.featureEffect=a,u.featureEffectView.endTransition(),u.featureContainer.restartAllAnimations(),u.featureContainer.attributeView.unlockTextureUploads(),u.featureContainer.trySwapRenderState(),u.featureContainer.requestRender(),(0,P.A)("esri-2d-update-debug")&&console.debug(`Version[${S}] FeatureLayerView2D.updateEnd`),u.requestUpdate()}catch(s){(0,P.A)("esri-2d-update-debug")&&console.error("Encountered an error during update",s)}})()}_doOverride(u){var s=this;return(0,v.A)(function*(){const a=yield s.getWorker();try{for(const c of u.messages)switch(c.type){case"edit":{const d=new qt;d.add(yield s._resolveEdit(c.event)),yield a.pipeline.onOverride(d.toMessage());break}case"override":{const d=new qt;d.add(s._resolveOverrides(c.options)),yield a.pipeline.onOverride(d.toMessage());break}}}catch(c){(0,m.zf)(c)}})()}_getEffectiveAvailableFields(u){const s=function zi(u,s){const a=new Set;return u&&u.forEach(c=>a.add(c)),s&&s.forEach(c=>a.add(c)),a.has("*")?["*"]:Array.from(a)}(this._lastAvailableFields,u);return this._lastAvailableFields=s,(0,V.hW)(this.layer.fieldsIndex,s)}_createViewSchemaConfig(){var u=this;return(0,v.A)(function*(){const s=u.requiresCurrentUser?yield u.signedInUser:null,a=[Bi(u.view,u.layerAdapter,u.timeExtent,u._visibilityOverrides,u.filter,u.effectiveDisplayFilterClause),u.featureEffect?.filter?.toJSON()??null];return{availableFields:u._getEffectiveAvailableFields(u.availableFields),displayFilterEnabled:u.displayFilterEnabled,filters:a,scale:u.view.scale,timeZone:u.view.timeZone,timeExtent:u.view.timeExtent,currentUser:s}})()}_processHighlight(){this._commandsQueue.push({type:"highlight"})}_updateHighlights(){var u=this;return(0,v.A)(function*(){const s=u._getHighlights(),a=yield u.getWorker();if(u.destroyed)return;const c=a.pipeline.updateHighlight({highlights:s}).catch(d=>{(0,m.zf)(d)||J.A.getLogger(u).error(d)});u._updatingHandles.addPromise(c)})()}_setLayersForFeature(u){u.layer=u.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(u)}_createGraphicHit(u,s){return this._setLayersForFeature(s),null!=s.geometry&&(s.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:s,layer:this.layer,mapPoint:u}}};function Bi(u,s,a,c,d,p){d&&(d=d.clone());const f=null!=d?d.timeExtent:null,S=null!=a&&null!=f?a.intersection(f):a||f;S&&(d??=new B.A,d.timeExtent=S),d=s.addFilters?.(d,u)??d,p&&(d??=new B.A,d.where=(0,g.mA)(d.where,p));let E=d?.toJSON()??null;return c.size&&(E??=(new B.A).toJSON(),E.hiddenIds=Array.from(c)),E}(0,w._)([(0,x.MZ)()],pe.prototype,"_commandsQueue",void 0),(0,w._)([(0,x.MZ)()],pe.prototype,"_sourceRefreshVersion",void 0),(0,w._)([(0,x.MZ)()],pe.prototype,"_displayRefreshVersion",void 0),(0,w._)([(0,x.MZ)({readOnly:!0})],pe.prototype,"_pipelineUpdating",void 0),(0,w._)([(0,x.MZ)()],pe.prototype,"_sourceUpdating",void 0),(0,w._)([(0,x.MZ)({readOnly:!0})],pe.prototype,"dataUpdating",null),(0,w._)([(0,x.MZ)({readOnly:!0})],pe.prototype,"effectiveDisplayFilterClause",null),(0,w._)([(0,x.MZ)({readOnly:!0})],pe.prototype,"hasAllFeatures",null),(0,w._)([(0,x.MZ)({readOnly:!0})],pe.prototype,"hasAllFeaturesInView",null),(0,w._)([(0,x.MZ)({readOnly:!0})],pe.prototype,"hasFullGeometries",null),(0,w._)([(0,x.MZ)()],pe.prototype,"featureEffectView",void 0),(0,w._)([(0,x.MZ)()],pe.prototype,"labelingCollisionInfos",null),(0,w._)([(0,x.MZ)()],pe.prototype,"layerAdapter",null),(0,w._)([(0,x.MZ)({readOnly:!0})],pe.prototype,"timeExtent",null),(0,w._)([(0,x.MZ)()],pe.prototype,"updating",void 0),pe=(0,w._)([(0,$.$)("esri.views.2d.layers.FeatureLayerView2D")],pe);const Ni=pe},74238:(le,te,h)=>{h.d(te,{E:()=>w});var v=h(10467);function w(x,P){return H.apply(this,arguments)}function H(){return(H=(0,v.A)(function*(x,P){try{return yield x}catch(J){if("no-queryEngine"!==J.name)throw J;return P}})).apply(this,arguments)}},96081:(le,te,h)=>{h.d(te,{A:()=>G});var v=h(8189),w=h(35150),H=h(56492),x=h(48900),$=(h(3248),h(40707),h(5922),h(76576));const G=Q=>{let Z=class extends Q{initialize(){this.addHandles((0,x.on)(()=>this.layer,"refresh",q=>{this.doRefresh(q.dataChanged).catch(N=>{(0,H.zf)(N)||w.A.getLogger(this).error(N)})}),"RefreshableLayerView")}};return Z=(0,v._)([(0,$.$)("esri.views.layers.RefreshableLayerView")],Z),Z}},64935:(le,te,h)=>{h.d(te,{D8:()=>P,TO:()=>H,d0:()=>J});var v=h(10467),w=h(86300);function H(Y){return x.apply(this,arguments)}function x(){return(x=(0,v.A)(function*(Y,$=Y.popupTemplate){if(null==$)return[];const G=yield $.getRequiredFields(Y.fieldsIndex),{lastEditInfoEnabled:Q}=$,{objectIdField:Z,typeIdField:q,globalIdField:N,relationships:W}=Y;if(G.includes("*"))return["*"];const L=Q?(0,w.eX)(Y):[],j=(0,w.DB)(Y.fieldsIndex,[...G,...L]);return q&&j.push(q),j&&Z&&Y.fieldsIndex?.has(Z)&&!j.includes(Z)&&j.push(Z),j&&N&&Y.fieldsIndex?.has(N)&&!j.includes(N)&&j.push(N),W&&W.forEach(R=>{const{keyField:y}=R;j&&y&&Y.fieldsIndex?.has(y)&&!j.includes(y)&&j.push(y)}),j})).apply(this,arguments)}function P(Y,$){return Y.popupTemplate?Y.popupTemplate:null!=$&&$.defaultPopupTemplateEnabled&&null!=Y.defaultPopupTemplate?Y.defaultPopupTemplate:null}function J(Y,$){return null!=P(Y,{defaultPopupTemplateEnabled:$})}}}]);