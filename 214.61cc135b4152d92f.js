"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[214],{83316:(D,S,n)=>{n.r(S),n.d(S,{SceneLayerSnappingSource:()=>p});var a=n(10467),o=n(8189),u=n(98877),P=n(89952),h=n(56492),d=n(85211),L=(n(3248),n(35150),n(76576)),M=n(17715),x=n(11432),R=(n(40707),n(56985)),w=n(79139),I=n(94542),C=n(7006),V=n(32230);class Z extends I.B{constructor(t){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},t)}process(t,r,i){var s=this;return(0,a.A)(function*(){return i?(0,V.o6)(t):function b(e){return{regular:{instancesData:(0,C.s)(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,C.s)(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}(yield s.invoke(new m(t),r))})()}extractEdgeLocations(t,r){var i=this;return(0,a.A)(function*(){const s=yield i.invokeMethod("extractEdgeLocations",new m(t),r);return(0,C.s)(s)})()}extractComponentsEdgeLocations(t,r){var i=this;return(0,a.A)(function*(){const s=yield i.invokeMethod("extractComponentsEdgeLocations",new m(t),r);return(0,C.s)(s)})()}}class m{constructor(t){this.dataBuffer=t.data.buffer,this.writerSettings=t.writerSettings,this.skipDeduplicate=t.skipDeduplicate,this.indices=(0,w.iu)(t.indices)?t.indices.buffer:t.indices,this.indicesType=(0,w.iu)(t.indices)?(0,w.XJ)(t.indices)?"Uint32Array":"Uint16Array":"Array",this.indicesLength=t.indicesLength}}var k=n(25866),B=n(83989),A=n(29280),U=n(75602),W=n(40175);let g=class extends u.A{constructor(e){super(e),this.availability=0,this._ids=new Set}destroy(){this._workerHandle.destroy(),this._workerHandle=null}initialize(){this._workerHandle=new j(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)})}fetchCandidates(e,t){var r=this;return(0,a.A)(function*(){const i=e.coordinateHelper,{point:s}=e,c=z;r.renderCoordsHelper.toRenderCoords(s,i.spatialReference,c);const y=e.distance,v="number"==typeof y?y:y.distance,f=yield r._workerHandle.invoke({bounds:(0,B.f)(c[0],c[1],c[2],v),returnEdge:e.returnEdge,returnVertex:"none"!==e.vertexMode},t);return f.candidates.sort((E,T)=>E.distance-T.distance),f.candidates.map(E=>r._convertCandidate(i,E))})()}add(e,t){var r=this;return(0,a.A)(function*(){r._ids.add(e.id),yield r._workerHandle.invokeMethod("add",e,t)})()}remove(e,t){var r=this;return(0,a.A)(function*(){r._ids.delete(e.id),yield r._workerHandle.invokeMethod("remove",e,t)})()}_convertCandidate(e,t){switch(t.type){case"edge":return new U.z({objectId:t.objectId,targetPoint:(0,A.de)(this._convertRenderCoordinate(e,t.target)),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),isDraped:!1});case"vertex":return new W.C({objectId:t.objectId,targetPoint:(0,A.de)(this._convertRenderCoordinate(e,t.target)),isDraped:!1})}}_convertRenderCoordinate({spatialReference:e},t){const r=(0,k.vt)();return this.renderCoordsHelper.fromRenderCoords(t,r,e),(0,A._7)(r)}_fetchAllEdgeLocations(e,t){var r=this;return(0,a.A)(function*(){const i=[],s=[];for(const{id:c,uid:y}of e.components)r._ids.has(c)&&i.push((0,a.A)(function*(){const v=yield r.fetchEdgeLocations(c,t.signal),f=v.locations.buffer;return s.push(f),{id:c,uid:y,objectIds:v.objectIds,locations:f,origin:v.origin,type:v.type}})());return{result:{components:(yield Promise.all(i)).filter(({id:c})=>r._ids.has(c))},transferList:s}})()}};(0,o._)([(0,d.MZ)({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0),(0,o._)([(0,d.MZ)({constructOnly:!0})],g.prototype,"fetchEdgeLocations",void 0),(0,o._)([(0,d.MZ)({constructOnly:!0})],g.prototype,"schedule",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],g.prototype,"availability",void 0),g=(0,o._)([(0,L.$)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorkerHandle")],g);class j extends I.B{constructor(t,r){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},t,{strategy:"dedicated",client:r})}}const z=(0,k.vt)();let l=class extends u.A{get updating(){return this._updatingHandles.updating}constructor(e){super(e),this.availability=1,this._updatingHandles=new R.U,this._abortController=new AbortController}destroy(){this._tracker=(0,x.xt)(this._tracker),this._abortController=(0,x.DC)(this._abortController),this._updatingHandles.destroy()}initialize(){var e=this;const{view:t}=this,r=t.resourceController;var i;this._edgeWorker=new Z(O(r)),this._workerHandle=new g({renderCoordsHelper:this.view.renderCoordsHelper,schedule:O(r),fetchEdgeLocations:(i=(0,a.A)(function*(s,c){if(null==e._tracker)throw new Error("tracker-not-initialized");return e._tracker.fetchEdgeLocations(s,e._edgeWorker,c)}),function(c,y){return i.apply(this,arguments)})}),this._updatingHandles.addPromise(this._setupLayerView()),this.addHandles([(0,M.DQ)(this._workerHandle),(0,M.DQ)(this._edgeWorker)])}fetchCandidates(e,t){var r=this;return(0,a.A)(function*(){return r._workerHandle.fetchCandidates(e,t)})()}refresh(){}_setupLayerView(){var e=this;return(0,a.A)(function*(){if(e.destroyed)return;const t=e._abortController?.signal,r=yield e.getLayerView();null==r||(0,h.G4)(t)||(e._tracker=r.trackSnappingSources({add:(i,s)=>{e._updatingHandles.addPromise(e._workerHandle.add({id:i,bounds:s},t))},remove:i=>{e._updatingHandles.addPromise(e._workerHandle.remove({id:i},t))}}))})()}};function O(e){return t=>e.immediate.schedule(t)}(0,o._)([(0,d.MZ)({constructOnly:!0})],l.prototype,"getLayerView",void 0),(0,o._)([(0,d.MZ)({constructOnly:!0})],l.prototype,"view",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],l.prototype,"updating",null),(0,o._)([(0,d.MZ)({readOnly:!0})],l.prototype,"availability",void 0),l=(0,o._)([(0,L.$)("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],l);let p=class extends u.A{get updating(){return this._i3sSources.some(e=>e.updating)}constructor(e){super(e),this.availability=1,this._i3sSources=[]}destroy(){this._i3sSources.forEach(e=>e.destroy()),this._i3sSources.length=0}initialize(){const{view:e}=this,t=this.layerSource.layer;this._i3sSources="building-scene"===t.type?this._getBuildingSceneI3SSources(e,t):[this._getSceneLayerI3SSource(e,t)]}fetchCandidates(e,t){var r=this;return(0,a.A)(function*(){const i=yield Promise.all(r._i3sSources.map(s=>s.fetchCandidates(e,t)));return(0,h.Te)(t),i.flat()})()}refresh(){this._i3sSources.forEach(e=>e.refresh())}_getBuildingSceneI3SSources(e,t){return t.allSublayers.toArray().map(r=>{return"building-component"===r.type?new l({getLayerView:(i=(0,a.A)(function*(){return(yield e.whenLayerView(t)).whenSublayerView(r)}),function(){return i.apply(this,arguments)}),view:e}):null;var i}).filter(P.Ru)}_getSceneLayerI3SSource(e,t){return new l({getLayerView:(r=(0,a.A)(function*(){const i=yield e.whenLayerView(t);return"scene-layer-graphics-3d"===i.type?void 0:i}),function(){return r.apply(this,arguments)}),view:e});var r}};(0,o._)([(0,d.MZ)({constructOnly:!0})],p.prototype,"layerSource",void 0),(0,o._)([(0,d.MZ)({constructOnly:!0})],p.prototype,"view",void 0),(0,o._)([(0,d.MZ)({readOnly:!0})],p.prototype,"updating",null),(0,o._)([(0,d.MZ)({readOnly:!0})],p.prototype,"availability",void 0),p=(0,o._)([(0,L.$)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],p)},93151:(D,S,n)=>{n.d(S,{_:()=>u});var a=n(28714),o=n(77171);class u extends o.m{constructor(h,d,H){super(d,H),this.point=h}equals(h){return h instanceof u&&(0,a.p)(this.point,h.point)}}}}]);