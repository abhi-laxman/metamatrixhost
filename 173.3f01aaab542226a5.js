"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[173],{76582:(k,P,i)=>{i.d(P,{LG:()=>V,mb:()=>O,yr:()=>T});var E=i(10467),o=i(56492),r=i(31610),u=i(12273),h=i(88532),e=i(63888),d=i(28399),x=i(50915),s=i(76169),M=i(4931);function V(S){return S&&"render"in S}function T(S){const g=document.createElement("canvas");return g.width=S.width,g.height=S.height,S.render(g.getContext("2d")),g}class O extends e.q{constructor(g=null,v=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._texture=null,this._width=void 0,this.x=0,this.y=0,this.immutable=v,this.source=g,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(g){this._height=g}get source(){return this._source}set source(g){null==g&&null==this._source||(this._source=g,this.invalidateTexture(),this.requestRender())}get texture(){return this._texture}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(g){this._width=g}beforeRender(g){super.beforeRender(g),this.updateTexture(g)}setSourceAsync(g,v){var n=this;return(0,E.A)(function*(){null!=n._uploadStatus&&n._uploadStatus.controller.abort();const _=new AbortController,y=(0,o.Tw)();return(0,o.NY)(v,()=>_.abort()),(0,o.NY)(_,b=>y.reject(b)),n._uploadStatus={controller:_,resolver:y},n.source=g,y.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}transitionStep(g,v){g>=64&&(this.fadeTransitionEnabled=!1),super.transitionStep(g,v)}setTransform(g){const v=(0,r.D_)(this.transforms.displayViewScreenMat3),[n,_]=g.toScreenNoRotation([0,0],[this.x,this.y]),y=this.resolution/this.pixelRatio/g.resolution,b=y*this.width,C=y*this.height,B=Math.PI*this.rotation/180;(0,r.Tl)(v,v,(0,h.fA)(n,_)),(0,r.Tl)(v,v,(0,h.fA)(b/2,C/2)),(0,r.e$)(v,v,-B),(0,r.Tl)(v,v,(0,h.fA)(-b/2,-C/2)),(0,r.Oe)(v,v,(0,h.fA)(b,C)),(0,r.lw)(this.transforms.displayViewScreenMat3,g.displayViewMat3,v)}setSamplingProfile(g){this._texture&&(g.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(g.samplingMode))}bind(g,v){this._texture&&g.bindTexture(this._texture,v)}updateTexture({context:g,painter:v}){var n=this;return(0,E.A)(function*(){if(!n._textureInvalidated)return;if(n._textureInvalidated=!1,n._texture||(n._texture=n._createTexture(g)),!n.source)return void n._texture.setData(null);n._texture.resize(n._sourceWidth,n._sourceHeight);const _=function p(S){return V(S)?S instanceof d.A?S.getRenderedRasterPixels()?.renderedRasterPixels:T(S):S}(n.source);try{if(null!=n._uploadStatus){const{controller:y,resolver:b}=n._uploadStatus,C={signal:y.signal},{width:B,height:I}=n,w=n._texture;yield v.textureUploadManager.enqueueTextureUpdate({data:_,texture:w,width:B,height:I},C),b.resolve(),n._uploadStatus=null}else n._texture.setData(_);n.ready()}catch(y){(0,o.jH)(y)}})()}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,u.vt)()}}_createTexture(g){const v=this.immutable,n=new M.R;return n.internalFormat=v?x.H0.RGBA8:x.Ab.RGBA,n.wrapMode=x.pF.CLAMP_TO_EDGE,n.isImmutable=v,n.width=this._sourceWidth,n.height=this._sourceHeight,new s.g(g,n)}}},72663:(k,P,i)=>{i.d(P,{l:()=>u});var E=i(69473),o=i(54382),r=i(34531);class u extends o.A{constructor(){super(...arguments),this._hasCrossfade=!1,this._bitmapTechnique=null}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}onAttach(){super.onAttach(),this._bitmapTechnique=new r.C}onDetach(){super.onDetach(),this._bitmapTechnique?.shutdown(),this._bitmapTechnique=null}renderChildren(e){super.renderChildren(e),this.visible&&e.drawPhase===E.S5.MAP&&null!=this._bitmapTechnique&&this._bitmapTechnique.render(e,{bitmaps:this.children})}_manageFade(){this.children.reduce((e,d)=>e+(d.inFadeTransition?1:0),0)>=2?(this.children.forEach(e=>e.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(e=>e.blendFunction="standard"),this._hasCrossfade=!1)}}},28399:(k,P,i)=>{i.d(P,{A:()=>E});class E{constructor(r,u,h){this.pixelBlock=r,this.extent=u,this.originalPixelBlock=h}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(r){const u=this.pixelBlock;if(null==u)return;const h=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??u});if(null==h.pixelBlock)return;h.pixelBlock.maskIsAlpha&&(h.pixelBlock.premultiplyAlpha=!0);const e=h.pixelBlock.getAsRGBA(),d=r.createImageData(h.pixelBlock.width,h.pixelBlock.height);d.data.set(e),r.putImageData(d,0,0)}getRenderedRasterPixels(){const r=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==r.pixelBlock?null:(r.pixelBlock.maskIsAlpha&&(r.pixelBlock.premultiplyAlpha=!0),{width:r.pixelBlock.width,height:r.pixelBlock.height,renderedRasterPixels:new Uint8Array(r.pixelBlock.getAsRGBA().buffer)})}}},34531:(k,P,i)=>{i.d(P,{C:()=>v});var E=i(47669),o=i(14089),r=i(8137),u=i(8189),h=i(84035),e=i(3902);function x(n){const _=function d(n){const _=new e.nt(.16666666666666666),y=n.multiply(n),b=y.multiply(n),C=_.multiply(b.multiply(-1).add(new e.nt(3).multiply(y)).subtract(new e.nt(3).multiply(n)).add(1)),B=_.multiply(b.multiply(3).subtract(y.multiply(6)).add(4)),I=_.multiply(b.multiply(-3).add(y.multiply(3)).add(n.multiply(3)).add(1)),w=_.multiply(b);return new e.Zb(C,B,I,w)}(n),y=_.x.add(_.y),b=_.z.add(_.w),C=new e.nt(1).subtract(_.y.divide(y)).add(n),B=new e.nt(1).add(_.w.divide(b)).subtract(n);return new e.Zb(C,B,y,b)}class M extends h.ZA{}(0,u._)([(0,h.C5)(0,e.ZY)],M.prototype,"position",void 0);class T extends h.k2{}(0,u._)([(0,h.Pi)(e.z7)],T.prototype,"texture",void 0),(0,u._)([(0,h.Pi)(e.U)],T.prototype,"dvsMat3",void 0),(0,u._)([(0,h.Pi)(e.ZY)],T.prototype,"coordScale",void 0),(0,u._)([(0,h.Pi)(e.nt)],T.prototype,"opacity",void 0);class p extends h.A{constructor(){super(...arguments),this.type="BitmapShader"}vertex(_){const y=this.config.dvsMat3.multiply(new e.eB(_.position.multiply(this.config.coordScale),1));return{glPosition:new e.Zb(y,1),texcoord:_.position}}fragment(_){const y=new h.mm;let b;return b=this.bicubic?function s(n,_,y){const b=new e.ZY(new e.nt(1).divide(y.x),0),C=new e.ZY(0,new e.nt(1).divide(y.y)),B=_.multiply(y).subtract(.5),I=x((0,e.jc)(B).x).xyz,w=x((0,e.jc)(B).y).xyz;let U=_.add(I.x.multiply(b)),K=_.subtract(I.y.multiply(b));const z=U.add(w.x.multiply(C)),X=K.add(w.x.multiply(C));U=U.subtract(w.y.multiply(C)),K=K.subtract(w.y.multiply(C));let N=(0,e.US)(n,K),Y=(0,e.US)(n,U);const G=(0,e.US)(n,X),q=(0,e.US)(n,z);return N=(0,e.jh)(N,G,w.z),Y=(0,e.jh)(Y,q,w.z),N=(0,e.jh)(N,Y,I.z),N}(this.config.texture,_.texcoord,this.config.coordScale):(0,e.US)(this.config.texture,_.texcoord),y.fragColor=new e.Zb(b.rgb.multiply(this.config.opacity),b.a.multiply(this.config.opacity)),y}}(0,u._)([(0,h.Pi)(T)],p.prototype,"config",void 0),(0,u._)([h.E8],p.prototype,"bicubic",void 0),(0,u._)([(0,u.a)(0,(0,h.hF)(M))],p.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,h.hF)(class V extends h.HS{}))],p.prototype,"fragment",null);var O=i(50915);const S={nearest:{samplingMode:O.Cj.NEAREST,mips:!1},bilinear:{samplingMode:O.Cj.LINEAR,mips:!1},bicubic:{samplingMode:O.Cj.LINEAR,mips:!1},trilinear:{samplingMode:O.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},g=(n,_,y)=>{if("dynamic"===y.samplingMode){const{state:b}=n,C=_.resolution/_.pixelRatio/b.resolution,B=Math.round(n.pixelRatio)!==n.pixelRatio;return b.rotation||C>1.05||C<.95||B||_.isSourceScaled||_.rotation?S.bilinear:S.nearest}return S[y.samplingMode]};class v extends o.j{constructor(){super(...arguments),this.name="BrushBitmap",this.type=r.N.Bitmap,this.shaders={bitmap:new p}}render(_,y){const{context:b,renderingOptions:C,painter:B}=_;for(const I of y.bitmaps){const w=I.texture;if(!I.source||!I.isReady||null==w)continue;const U=g(_,I,C);_.timeline.begin(this.name),B.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:I.stencilRef,compare:O.MT.EQUAL,op:{fail:O.eA.KEEP,zFail:O.eA.KEEP,zPass:O.eA.KEEP}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"additive"===I.blendFunction?"additive":"composite"}}),I.setSamplingProfile(U);const{coordScale:K,computedOpacity:z,transforms:X}=I;B.submitDrawMesh(b,{shader:this.shaders.bitmap,uniforms:{config:{texture:{texture:w,unit:E.YS},dvsMat3:X.displayViewScreenMat3,coordScale:K,opacity:z}},defines:{bicubic:U===S.bicubic},optionalAttributes:null,useComputeBuffer:!1},B.quadMesh),_.timeline.end(this.name)}}}},1416:(k,P,i)=>{i.d(P,{Ph:()=>r,Z0:()=>h,hU:()=>o});var E=i(1119);function o(e){const d=e.map(({name:x,count:s,type:M})=>`${x}.${s}.${M}`).join(",");return(0,E.Wm)(d)}function r(e,d,x,s,M,V,T){if(e.primitiveName===d){let p=s?.readWithDefault(M,V,e[x]&&T);return"text"===e.type&&(p=p.toString()),void(e[x]=p)}if("type"in e&&null!=e.type){if(e.effects)for(const p of e.effects)r(p,d,x,s,M,V,T);switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.symbolLayers)for(const p of e.symbolLayers)r(p,d,x,s,M,V,T);break;case"CIMTextSymbol":e.symbol&&r(e.symbol,d,x,s,M,V,T);break;case"CIMHatchFill":e.lineSymbol&&r(e.lineSymbol,d,x,s,M,V,T);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(e.markerPlacement&&r(e.markerPlacement,d,x,s,M,V,T),"CIMVectorMarker"===e.type&&e.markerGraphics)for(const p of e.markerGraphics)r(p,d,x,s,M,V,T),r(p.symbol,d,x,s,M,V,T)}}}const u=400;function h(e){return null!=e.effects?u:Math.max(1.25*e.width,8)}},45255:(k,P,i)=>{i.r(P),i.d(P,{default:()=>dt});var E=i(10467),o=i(8189),r=i(77469),u=i(31178),h=i(11432),e=i(48900),d=i(45272),x=i(85211),T=(i(3248),i(35150),i(40707),i(76576)),p=i(28067),O=i(13970),S=i(32034),g=i(71065);let v=class extends g.A{constructor(){super(...arguments),this.id=0,this.rotation=0,this.href="",this.extent=new p.A}};(0,o._)([(0,x.MZ)({nonNullable:!0,json:{write:!0}})],v.prototype,"id",void 0),(0,o._)([(0,x.MZ)({nonNullable:!0,json:{write:!0}})],v.prototype,"rotation",void 0),(0,o._)([(0,x.MZ)({nonNullable:!0,json:{write:!0}})],v.prototype,"href",void 0),(0,o._)([(0,x.MZ)({type:p.A,nonNullable:!0,json:{write:!0}})],v.prototype,"extent",void 0),v=(0,o._)([(0,T.$)("esri.layers.support.KMLMapImage")],v);var n=i(70264),_=i(68800),y=i(27641),b=i(76582),C=i(72663),B=i(88219),I=i(57052),w=i(57141),U=i(41474),K=i(89563),z=i(1749),X=i(40018),N=i(91837),Y=i(3276),G=i(50915),q=i(79061),rt=i(31071),ut=i(48458),at=i(76169),lt=i(4931);let ot=(()=>{class a{constructor(c){if(this._ownsRctx=!1,c)this._ownsRctx=!1,this._rctx=c;else{if(a._instance)return a._instanceRefCount++,a._instance;a._instanceRefCount=1,a._instance=this,this._ownsRctx=!0;const f=document.createElement("canvas").getContext("webgl2");f.getExtension("OES_texture_float"),this._rctx=new ut.e(f,{})}const L=(0,Y.p)("raster/reproject","raster/reproject",new Map([["a_position",0]]),{applyProjection:!0,bilinear:!1,bicubic:!1});this._program=this._rctx.programCache.acquire(L.shaders.vertexShader,L.shaders.fragmentShader,L.attributes),this._rctx.useProgram(this._program),this._program.setUniform1f("u_opacity",1),this._program.setUniform1i("u_image",0),this._program.setUniform1i("u_flipY",0),this._program.setUniform1i("u_transformGrid",1),this._quad=new N.A(this._rctx,[0,0,1,0,0,1,1,1])}reprojectTexture(c,R,L=!1){const f=(0,O.project)(c.extent,R),t=new z.A({x:(c.extent.xmax-c.extent.xmin)/c.texture.descriptor.width,y:(c.extent.ymax-c.extent.ymin)/c.texture.descriptor.height,spatialReference:c.extent.spatialReference}),{x:l,y:D}=(0,X.Wo)(t,R,c.extent);let A=(l+D)/2;const j=Math.round((f.xmax-f.xmin)/A),W=Math.round((f.ymax-f.ymin)/A);A=(f.width/j+f.height/W)/2;const Q=new z.A({x:A,y:A,spatialReference:f.spatialReference}),$=(0,X.l0)({projectedExtent:f,srcBufferExtent:c.extent,pixelSize:Q,hasWrapAround:!0,spacing:[16,16]}),tt=(0,rt.kc)(this._rctx,$),et=new lt.R(j,W);et.wrapMode=G.pF.CLAMP_TO_EDGE;const F=new q.H(this._rctx,et);this._rctx.bindFramebuffer(F),this._rctx.setViewport(0,0,j,W),this._rctx.useProgram(this._program),this._rctx.bindTexture(c.texture,0),this._rctx.bindTexture(tt,1),this._quad.bind();const{width:it=0,height:st=0}=c.texture.descriptor;if(this._program.setUniform2f("u_srcImageSize",it,st),this._program.setUniform2fv("u_transformSpacing",$.spacing),this._program.setUniform2fv("u_transformGridSize",$.size),this._program.setUniform2f("u_targetImageSize",j,W),this._quad.draw(),this._quad.unbind(),this._rctx.useProgram(null),this._rctx.bindFramebuffer(null),tt.dispose(),L){const{width:nt,height:J}=F,ct=new ImageData(nt??0,J??0);F.readPixels(0,0,nt??0,J??0,G.Ab.RGBA,G.ld.UNSIGNED_BYTE,ct.data);const pt=F.detachColorTexture(G.Nm.COLOR_ATTACHMENT0);return F.dispose(),{texture:pt,extent:f,imageData:ct}}const Z=F.detachColorTexture(G.Nm.COLOR_ATTACHMENT0);return F.dispose(),{texture:Z,extent:f}}reprojectBitmapData(c,R){const L=(0,b.LG)(c.bitmapData)?(0,b.yr)(c.bitmapData):c.bitmapData,f=new lt.R;f.wrapMode=G.pF.CLAMP_TO_EDGE,f.width=c.bitmapData.width,f.height=c.bitmapData.height;const t=new at.g(this._rctx,f,L),l=this.reprojectTexture({texture:t,extent:c.extent},R,!0);l.texture.dispose();const D=document.createElement("canvas"),A=l.imageData;return D.width=A.width,D.height=A.height,D.getContext("2d").putImageData(A,0,0),{bitmapData:D,extent:l.extent}}loadAndReprojectBitmapData(c,R,L){var f=this;return(0,E.A)(function*(){const t=(yield(0,K.A)(c,{responseType:"image"})).data,l=document.createElement("canvas");l.width=t.width,l.height=t.height;const D=l.getContext("2d");D.drawImage(t,0,0);const A=D.getImageData(0,0,l.width,l.height);if(R.spatialReference.equals(L))return{bitmapData:A,extent:R};const j=f.reprojectBitmapData({bitmapData:A,extent:R},L);return{bitmapData:j.bitmapData,extent:j.extent}})()}destroy(){this._ownsRctx?(a._instanceRefCount--,0===a._instanceRefCount&&(this._quad.dispose(),this._program.dispose(),this._rctx.dispose(),a._instance=null)):(this._quad.dispose(),this._program.dispose())}}return a._instanceRefCount=0,a})();class ht{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let H=class extends((0,B.e)(U.A)){constructor(){super(...arguments),this._bitmapIndex=new Map,this._mapImageContainer=new C.l,this._kmlVisualData=new ht,this._fetchController=null,this.allVisiblePoints=new y.Y,this.allVisiblePolylines=new y.Y,this.allVisiblePolygons=new y.Y,this.allVisibleMapImages=new u.A}hitTest(a,m){var c=this;return(0,E.A)(function*(){const R=c.layer;return[c._pointsView?.hitTest(a),c._polylinesView?.hitTest(a),c._polygonsView?.hitTest(a)].flat().filter(Boolean).map(L=>(L.layer=R,L.sourceLayer=R,{type:"graphic",graphic:L,layer:R,mapPoint:a}))})()}update(a){this._polygonsView&&this._polygonsView.processUpdate(a),this._polylinesView&&this._polylinesView.processUpdate(a),this._pointsView&&this._pointsView.processUpdate(a)}attach(){this._fetchController=new AbortController,this.container.addChild(this._mapImageContainer),this._polygonsView=new w.A({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new I.A(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new w.A({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new I.A(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new w.A({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new I.A(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.addAttachHandles([this.allVisibleMapImages.on("change",a=>{a.added.forEach(m=>this._addMapImage(m)),a.removed.forEach(m=>this._removeMapImage(m))}),(0,e.wB)(()=>this.layer.visibleSublayers,a=>{for(const m of this._kmlVisualData.allSublayers.values())m.visibility=0;for(const m of a){const c=this._kmlVisualData.allSublayers.get(m.id);c&&(c.visibility=1)}this._refreshCollections()})]),this._updatingHandles.addPromise(this._fetchService(this._fetchController.signal)),this._imageReprojector=new ot}detach(){this._fetchController=(0,h.DC)(this._fetchController),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView=(0,h.pR)(this._polygonsView),this._polylinesView=(0,h.pR)(this._polylinesView),this._pointsView=(0,h.pR)(this._pointsView),this._imageReprojector=(0,h.pR)(this._imageReprojector)}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(a){(this.view.spatialReference?.isWGS84||this.view.spatialReference?.isWebMercator)&&this._imageReprojector.loadAndReprojectBitmapData(a.href,a.extent,this.view.spatialReference).then(m=>{const c=new b.mb(m.bitmapData);c.x=m.extent.xmin,c.y=m.extent.ymax,c.resolution=m.extent.width/m.bitmapData.width,c.rotation=a.rotation,this._mapImageContainer.addChild(c),this._bitmapIndex.set(a,c)})}_getViewDependentUrl(a,m){return(0,E.A)(function*(){const{viewFormat:c,viewBoundScale:R,httpQuery:L}=a;if(null!=c){if(null==m)throw new Error("Loading this network link requires a view state.");let f;if(yield(0,O.load)(),null!=R&&1!==R){const Z=new p.A(m.extent);Z.expand(R),f=Z}else f=m.extent;f=(0,O.project)(f,S.A.WGS84);const t=(0,O.project)(f,S.A.WebMercator),l=f.xmin,D=f.xmax,A=f.ymin,j=f.ymax,W=m.size[0]*m.pixelRatio,Q=m.size[1]*m.pixelRatio,$=Math.max(t.width,t.height),tt={"[bboxWest]":l.toString(),"[bboxEast]":D.toString(),"[bboxSouth]":A.toString(),"[bboxNorth]":j.toString(),"[lookatLon]":f.center.x.toString(),"[lookatLat]":f.center.y.toString(),"[lookatRange]":$.toString(),"[lookatTilt]":"0","[lookatHeading]":m.rotation.toString(),"[lookatTerrainLon]":f.center.x.toString(),"[lookatTerrainLat]":f.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":f.center.x.toString(),"[cameraLat]":f.center.y.toString(),"[cameraAlt]":$.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":W.toString(),"[vertPixels]":Q.toString(),"[terrainEnabled]":"0","[clientVersion]":r.rE,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},et=Z=>{for(const nt in Z){let J;for(J in tt)Z[nt]=Z[nt].replace(J,tt[J])}},F=(0,d.zf)(c);et(F);let it={};null!=L&&(it=(0,d.zf)(L),et(it));const st=(0,_.Dl)(a.href);return st.query={...st.query,...F,...it},`${st.path}?${(0,d.x0)(F)}`}return a.href})()}_fetchService(a){var m=this;return(0,E.A)(function*(){const c=new ht;yield m._loadVisualData(m.layer.url,c,a),m._kmlVisualData=c,m._refreshCollections()})()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter(a=>this._isSublayerVisible(a.sublayerId)).map(({item:a})=>a)),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter(a=>this._isSublayerVisible(a.sublayerId)).map(({item:a})=>a)),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter(a=>this._isSublayerVisible(a.sublayerId)).map(({item:a})=>a)),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter(a=>this._isSublayerVisible(a.sublayerId)).map(({item:a})=>a))}_isSublayerVisible(a){const m=this._kmlVisualData.allSublayers.get(a);return!!m?.visibility&&(-1===m.parentFolderId||this._isSublayerVisible(m.parentFolderId))}_loadVisualData(a,m,c){var R=this;return this._fetchParsedKML(a,c).then(function(){var L=(0,E.A)(function*(f){for(const t of f.sublayers){m.allSublayers.set(t.id,t);const l=t.points?yield(0,n.Sp)(t.points):[],D=t.polylines?yield(0,n.Sp)(t.polylines):[],A=t.polygons?yield(0,n.Sp)(t.polygons):[],j=t.mapImages?.map(W=>v.fromJSON(W))??[];if(m.allPoints.push(...l.map(W=>({item:W,sublayerId:t.id}))),m.allPolylines.push(...D.map(W=>({item:W,sublayerId:t.id}))),m.allPolygons.push(...A.map(W=>({item:W,sublayerId:t.id}))),m.allMapImages.push(...j.map(W=>({item:W,sublayerId:t.id}))),t.networkLink){const W=yield R._getViewDependentUrl(t.networkLink,R.view.state);yield R._loadVisualData(W,m,c)}}});return function(f){return L.apply(this,arguments)}}())}_fetchParsedKML(a,m){return(0,n.Ox)(a,this.layer.spatialReference,this.layer.refreshInterval,m).then(c=>(0,n._4)(c.data))}_removeMapImage(a){const m=this._bitmapIndex.get(a);m&&(this._mapImageContainer.removeChild(m),this._bitmapIndex.delete(a))}};(0,o._)([(0,x.MZ)()],H.prototype,"_pointsView",void 0),(0,o._)([(0,x.MZ)()],H.prototype,"_polylinesView",void 0),(0,o._)([(0,x.MZ)()],H.prototype,"_polygonsView",void 0),(0,o._)([(0,x.MZ)()],H.prototype,"updating",void 0),H=(0,o._)([(0,T.$)("esri.views.2d.layers.KMLLayerView2D")],H);const dt=H},24493:(k,P,i)=>{function E(r,...u){let h="";for(let e=0;e<u.length;e++)h+=r[e]+u[e];return h+=r[r.length-1],h}function o(r,u,h=""){return r?u:h}var r;i.d(P,{H:()=>E,If:()=>o}),(r=E).int=function u(e){return Math.round(e).toString()},r.float=function h(e){return e.toPrecision(8)}},67496:(k,P,i)=>{var E,o,r,u,h,e,d,x,s;i.d(P,{Am:()=>u,C7:()=>r,JS:()=>x,Mg:()=>e,dd:()=>h,it:()=>o,s2:()=>E,sf:()=>d}),(s=E||(E={}))[s.None=0]="None",s[s.Front=1]="Front",s[s.Back=2]="Back",s[s.COUNT=3]="COUNT",function(s){s[s.Less=0]="Less",s[s.Lequal=1]="Lequal",s[s.COUNT=2]="COUNT"}(o||(o={})),function(s){s[s.BACKGROUND=0]="BACKGROUND",s[s.UPDATE=1]="UPDATE"}(r||(r={})),function(s){s[s.NOT_LOADED=0]="NOT_LOADED",s[s.LOADING=1]="LOADING",s[s.LOADED=2]="LOADED"}(u||(u={})),function(s){s[s.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",s[s.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(h||(h={})),function(s){s[s.Highlight=0]="Highlight",s[s.MaskOccludee=1]="MaskOccludee"}(e||(e={})),function(s){s[s.Blend=0]="Blend",s[s.Opaque=1]="Opaque",s[s.Mask=2]="Mask",s[s.MaskBlend=3]="MaskBlend",s[s.COUNT=4]="COUNT"}(d||(d={})),function(s){s.DDS_ENCODING="image/vnd-ms.dds",s.KTX2_ENCODING="image/ktx2",s.BASIS_ENCODING="image/x.basis"}(x||(x={}))},52274:(k,P,i)=>{i.d(P,{_:()=>o});var E=i(11432);class o{constructor(){this._result=!1}dispose(){this._program=(0,E.WD)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},54949:(k,P,i)=>{i.d(P,{_R:()=>r});class E{constructor(h,e,d,x,s,M,V,T,p){this.createQuery=h,this.deleteQuery=e,this.resultAvailable=d,this.getResult=x,this.disjoint=s,this.beginTimeElapsed=M,this.endTimeElapsed=V,this.createTimestamp=T,this.timestampBits=p}}let o=!1;function r(u,h){if(h.disjointTimerQuery)return null;let e=u.getExtension("EXT_disjoint_timer_query_webgl2");return e?new E(()=>u.createQuery(),d=>{u.deleteQuery(d),o=!1},d=>u.getQueryParameter(d,u.QUERY_RESULT_AVAILABLE),d=>u.getQueryParameter(d,u.QUERY_RESULT),()=>u.getParameter(e.GPU_DISJOINT_EXT),d=>{o||(o=!0,u.beginQuery(e.TIME_ELAPSED_EXT,d))},()=>{u.endQuery(e.TIME_ELAPSED_EXT),o=!1},d=>e.queryCounterEXT(d,e.TIMESTAMP_EXT),()=>u.getQuery(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)):(e=u.getExtension("EXT_disjoint_timer_query"),e?new E(()=>e.createQueryEXT(),d=>{e.deleteQueryEXT(d),o=!1},d=>e.getQueryObjectEXT(d,e.QUERY_RESULT_AVAILABLE_EXT),d=>e.getQueryObjectEXT(d,e.QUERY_RESULT_EXT),()=>u.getParameter(e.GPU_DISJOINT_EXT),d=>{o||(o=!0,e.beginQueryEXT(e.TIME_ELAPSED_EXT,d))},()=>{e.endQueryEXT(e.TIME_ELAPSED_EXT),o=!1},d=>e.queryCounterEXT(d,e.TIMESTAMP_EXT),()=>e.getQueryEXT(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)):null)}},41396:(k,P,i)=>{i.d(P,{Ey:()=>I,Ky:()=>s,Ms:()=>f,Os:()=>x,Uy:()=>p,Xt:()=>T,gh:()=>h,hG:()=>V,kn:()=>O,p3:()=>u});var E=i(67496),o=i(50915);function r(t,l,D=o.Tb.ADD,A=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:l,dstAlpha:l,opRgb:D,opAlpha:D,color:{r:A[0],g:A[1],b:A[2],a:A[3]}}}function u(t,l,D,A,j=o.Tb.ADD,W=o.Tb.ADD,Q=[0,0,0,0]){return{srcRgb:t,srcAlpha:l,dstRgb:D,dstAlpha:A,opRgb:j,opAlpha:W,color:{r:Q[0],g:Q[1],b:Q[2],a:Q[3]}}}const h=r(o.dn.ZERO,o.dn.ONE_MINUS_SRC_ALPHA),x=(r(o.dn.ONE,o.dn.ZERO),r(o.dn.ONE,o.dn.ONE),r(o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA)),s=u(o.dn.SRC_ALPHA,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA,o.dn.ONE_MINUS_SRC_ALPHA),M={face:o.Y7.BACK,mode:o.Ac.CCW},V={face:o.Y7.FRONT,mode:o.Ac.CCW},T=t=>t===E.s2.Back?M:t===E.s2.Front?V:null,p={zNear:0,zFar:1},O={r:!0,g:!0,b:!0,a:!0};function S(t){return K.intern(t)}function g(t){return X.intern(t)}function v(t){return Y.intern(t)}function n(t){return q.intern(t)}function _(t){return ut.intern(t)}function y(t){return lt.intern(t)}function b(t){return ht.intern(t)}function C(t){return dt.intern(t)}function B(t){return m.intern(t)}function I(t){return R.intern(t)}class w{constructor(l,D){this._makeKey=l,this._makeRef=D,this._interns=new Map}intern(l){if(!l)return null;const D=this._makeKey(l),A=this._interns;return A.has(D)||A.set(D,this._makeRef(l)),A.get(D)??null}}function U(t){return"["+t.join(",")+"]"}const K=new w(z,t=>({__tag:"Blending",...t}));function z(t){return t?U([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const X=new w(N,t=>({__tag:"Culling",...t}));function N(t){return t?U([t.face,t.mode]):null}const Y=new w(G,t=>({__tag:"PolygonOffset",...t}));function G(t){return t?U([t.factor,t.units]):null}const q=new w(rt,t=>({__tag:"DepthTest",...t}));function rt(t){return t?U([t.func]):null}const ut=new w(at,t=>({__tag:"StencilTest",...t}));function at(t){return t?U([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const lt=new w(ot,t=>({__tag:"DepthWrite",...t}));function ot(t){return t?U([t.zNear,t.zFar]):null}const ht=new w(H,t=>({__tag:"ColorWrite",...t}));function H(t){return t?U([t.r,t.g,t.b,t.a]):null}const dt=new w(a,t=>({__tag:"StencilWrite",...t}));function a(t){return t?U([t.mask]):null}const m=new w(c,t=>({__tag:"DrawBuffers",...t}));function c(t){return t?U(t.buffers):null}const R=new w(function L(t){return t?U([z(t.blending),N(t.culling),G(t.polygonOffset),rt(t.depthTest),at(t.stencilTest),ot(t.depthWrite),H(t.colorWrite),a(t.stencilWrite),c(t.drawBuffers)]):null},t=>({blending:S(t.blending),culling:g(t.culling),polygonOffset:v(t.polygonOffset),depthTest:n(t.depthTest),stencilTest:_(t.stencilTest),depthWrite:y(t.depthWrite),colorWrite:b(t.colorWrite),stencilWrite:C(t.stencilWrite),drawBuffers:B(t.drawBuffers)}));class f{constructor(l){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=l}setPipeline(l){(this._pipelineInvalid||l!==this._pipeline)&&(this._setBlending(l.blending),this._setCulling(l.culling),this._setPolygonOffset(l.polygonOffset),this._setDepthTest(l.depthTest),this._setStencilTest(l.stencilTest),this._setDepthWrite(l.depthWrite),this._setColorWrite(l.colorWrite),this._setStencilWrite(l.stencilWrite),this._setDrawBuffers(l.drawBuffers),this._pipeline=l),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(l){this._blending=this._setSubState(l,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(l){this._culling=this._setSubState(l,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(l){this._polygonOffset=this._setSubState(l,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(l){this._depthTest=this._setSubState(l,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(l){this._stencilTest=this._setSubState(l,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(l){this._depthWrite=this._setSubState(l,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(l){this._colorWrite=this._setSubState(l,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(l){this._stencilWrite=this._setSubState(l,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(l){this._drawBuffers=this._setSubState(l,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(l,D,A,j){return(A||l!==D)&&(j(l),this._pipelineInvalid=!0),l}}},20047:(k,P,i)=>{i.d(P,{H:()=>s});var E=i(9599),o=i(32788),r=i(50915),u=i(79061),h=i(76169),e=i(4931),d=i(45513),x=i(52274);class s extends x._{constructor(T){super(),this._rctx=T,this._program=T.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(T){const p=this._rctx;if(!p.gl)return T.dispose(),!0;const O=new e.R(1);O.wrapMode=r.pF.CLAMP_TO_EDGE,O.samplingMode=r.Cj.NEAREST;const S=new u.H(p,O),g=o.g.createVertex(p,r._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),v=new d.Z(p,new Map([["a_pos",0]]),E.VS,new Map([["geometry",g]])),n=new e.R;n.samplingMode=r.Cj.LINEAR,n.wrapMode=r.pF.CLAMP_TO_EDGE;const _=new h.g(p,n,M);p.useProgram(T),p.bindTexture(_,0),T.setUniform1i("u_texture",0);const y=p.getBoundFramebufferObject(),{x:b,y:C,width:B,height:I}=p.getViewport();p.bindFramebuffer(S),p.setViewport(0,0,1,1),p.setClearColor(0,0,0,0),p.setBlendingEnabled(!1),p.clear(r.NV.COLOR),p.bindVAO(v),p.drawArrays(r.WR.TRIANGLE_STRIP,0,4);const w=new Uint8Array(4);return S.readPixels(0,0,1,1,r.Ab.RGBA,r.ld.UNSIGNED_BYTE,w),v.dispose(),S.dispose(),_.dispose(),p.setViewport(b,C,B,I),p.bindFramebuffer(y),255!==w[0]}}const M=new Image;M.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",M.width=5,M.height=5,M.decode()}}]);