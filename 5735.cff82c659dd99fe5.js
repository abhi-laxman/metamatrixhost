"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[5735],{33087:(Le,ee,p)=>{p.d(ee,{q:()=>E});var P=p(60611);class E{constructor(D,F){this._storage=new P.F,this.id="",this.name="",this.size=0,this._storage.maxSize=D,this._storage.register(this),F&&this._storage.registerRemoveFunc("",F)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(D,F,te=1){this._storage.put(this,D,F,te,1)}pop(D){return this._storage.pop(this,D)}get(D){return this._storage.get(this,D)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(D){this._storage.maxSize=D}resetHitRate(){}}},60611:(Le,ee,p)=>{p.d(ee,{F:()=>te,Ti:()=>E});var P=p(12438);const E=-3,me=E-1;var D,R;(R=D||(D={}))[R.ALL=0]="ALL",R[R.SOME=1]="SOME";class te{get size(){return this._size}constructor(h=10485760){this._maxSize=h,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new P.A,this._users=new P.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(h){this._users.push(h)}deregister(h){this._users.removeUnordered(h)}registerRemoveFunc(h,m){this._removeFuncs.push([h,m])}deregisterRemoveFunc(h){this._removeFuncs.filterInPlace(m=>m[0]!==h)}get maxSize(){return this._maxSize}set maxSize(h){this._maxSize=Math.max(h,-1),this._checkSize()}getSize(h,m){return this._db.get(h.id+m)?.size??0}put(h,m,b,L,W){const w=this._db.get(m=h.id+m);if(w&&(this._size-=w.size,h.size-=w.size,this._db.delete(m),w.entry!==b&&this._notifyRemove(m,w.entry,w.size,D.ALL)),L>this._maxSize)return void this._notifyRemove(m,b,L,D.ALL);if(void 0===b)return void console.warn("Refusing to cache undefined entry ");if(!L||L<0)return console.warn(`Refusing to cache entry with size ${L} for key ${m}`),void this._notifyRemove(m,b,0,D.ALL);const _=1+Math.max(W,me)-E;this._db.set(m,new ne(b,L,_)),this._size+=L,h.size+=L,this._checkSize()}updateSize(h,m,b,L){const W=this._db.get(m=h.id+m);if(W&&W.entry===b){for(this._size-=W.size,h.size-=W.size;L>this._maxSize;){const w=this._notifyRemove(m,b,L,D.SOME);if(!(null!=w&&w>0))return void this._db.delete(m);L=w}W.size=L,this._size+=L,h.size+=L,this._checkSize()}}pop(h,m){const b=this._db.get(m=h.id+m);if(b)return this._size-=b.size,h.size-=b.size,this._db.delete(m),++this._hit,b.entry;++this._miss}get(h,m){const b=this._db.get(m=h.id+m);if(void 0!==b)return this._db.delete(m),b.lives=b.lifetime,this._db.set(m,b),++this._hit,b.entry;++this._miss}peek(h,m){const b=this._db.get(h.id+m);return b?++this._hit:++this._miss,b?.entry}get performanceInfo(){const h={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},m={},b=new Array;this._db.forEach((w,_)=>{const G=w.lifetime;b[G]=(b[G]||0)+w.size,this._users.forAll(N=>{const{id:X,name:J}=N;_.startsWith(X)&&(m[J]=(m[J]||0)+w.size)})});const L={};this._users.forAll(w=>{const _=w.name;"hitRate"in w&&"number"==typeof w.hitRate&&!isNaN(w.hitRate)&&w.hitRate>0?(m[_]=m[_]||0,L[_]=Math.round(100*w.hitRate)+"%"):L[_]="0%"});const W=Object.keys(m);W.sort((w,_)=>m[_]-m[w]),W.forEach(w=>h[w]=Math.round(m[w]/2**20)+"MB / "+L[w]);for(let w=b.length-1;w>=0;--w){const _=b[w];_&&(h["Priority "+(w+E-1)]=Math.round(_/this._size*100)+"%")}return h}resetStats(){this._hit=this._miss=0,this._users.forAll(h=>h.resetHitRate())}clear(h){const m=h.id;this._db.forEach((b,L)=>{L.startsWith(m)&&(this._size-=b.size,this._db.delete(L),this._notifyRemove(L,b.entry,b.size,D.ALL))}),h.size=0}clearAll(){this._db.forEach((h,m)=>this._notifyRemove(m,h.entry,h.size,D.ALL)),this._users.forAll(h=>h.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(h,m,b,L){let W;return this._removeFuncs.some(w=>{if(h.startsWith(w[0])){const _=w[1](m,L,b);return"number"==typeof _&&(W=_),!0}return!1}),W}_checkSize(){this._users.forAll(h=>this._checkSizeLimits(h)),this._checkSizeLimits()}_checkSizeLimits(h){const m=h??this;if(m.maxSize<0||m.size<=m.maxSize)return;const b=h?.id;let L=!0;for(;L;){L=!1;for(const[W,w]of this._db)if(0===w.lifetime&&(!b||W.startsWith(b))){if(this._purgeItem(W,w,h),m.size<=.9*m.maxSize)return;L||=this._db.has(W)}}for(const[W,w]of this._db)if((!b||W.startsWith(b))&&(this._purgeItem(W,w,h),m.size<=.9*m.maxSize))return}_purgeItem(h,m,b=this._users.find(L=>h.startsWith(L.id))){if(this._db.delete(h),m.lives<=1){this._size-=m.size,b&&(b.size-=m.size);const L=this._notifyRemove(h,m.entry,m.size,D.SOME);null!=L&&L>0&&(this._size+=L,b&&(b.size+=L),m.lives=m.lifetime,m.size=L,this._db.set(h,m))}else--m.lives,this._db.set(h,m)}}class ne{constructor(h,m,b){this.entry=h,this.size=m,this.lifetime=b,this.lives=b}}},98897:(Le,ee,p)=>{p.r(ee),p.d(ee,{default:()=>_t});var P=p(10467),E=p(8189),me=p(92165),D=p(90660),F=p(5922),te=p(39693),ie=p(56492),ne=p(48900),R=p(85211),m=(p(3248),p(35150)),L=(p(40707),p(76576)),W=p(95478),w=p(93410),_=p(23e3),G=p(4695),N=p(17049),X=p(85551),J=p(1151),he=p(33036),le=p(84311),j=p(22329),$=p(29141),B=p(95373),O=p(28067),M=p(32282),C=p(89563),i=p(19639);function T(t){return t.endsWith("?")?t.slice(0,-1):t}function ce(t){return t.filter(({coverageSubType:e})=>null==e||""===e||/^rectified(grid|dataset)/i.test(e))}function ue(t){const e={};for(let n=0;n<t.childNodes.length;n++){const a=t.childNodes[n];if(1!==a.nodeType)continue;const r=(0,i.vv)(a).toLowerCase();switch(r){case"title":case"abstract":e[r]=(0,i.mX)(a);break;case"identifier":e.id=(0,i.mX)(a);break;case"wgs84boundingbox":{const o=(0,i.pN)(a,"LowerCorner"),s=(0,i.pN)(a,"UpperCorner");e.lonLatEnvelope=new O.A({xmin:o[0],ymin:o[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":e.coverageSummaries=e.coverageSummaries||[],e.coverageSummaries.push(ue(a))}}return e}function be(t,e){if(t.coverageSummaries)for(let n=0;n<t.coverageSummaries.length;n++)t.coverageSummaries[n].abstract=t.coverageSummaries[n].abstract||t.abstract,t.coverageSummaries[n].lonLatEnvelope=t.coverageSummaries[n].lonLatEnvelope||t.lonLatEnvelope,t.coverageSummaries[n].title=t.coverageSummaries[n].title||t.title,be(t.coverageSummaries[n],e);null!=t.id&&e.push(t)}function ve(t){const e=(0,i.V6)(t.querySelector("Operation[name=GetCapabilities]"),"Get")?.getAttribute("xlink:href")||"",n=(0,i.V6)(t.querySelector("Operation[name=DescribeCoverage]"),"Get")?.getAttribute("xlink:href")||"",a=(0,i.V6)(t.querySelector("Operation[name=GetCoverage]"),"Get")?.getAttribute("xlink:href")||"";return{getCapabilities:T(e),describeCoverage:T(n),getCoverage:T(a)}}var Xe=p(55861),Re=p(83179),_e=p(20053);function Oe(t){t.variables.forEach(e=>e.dimensions.forEach(n=>n.values??=(0,_e.Xg)(n)))}function Ke(t){return{requestResponseCRSs:(0,i.Dy)(t,"requestResponseCRSs").map(e=>e.split(":")[1]),nativeCRSs:(0,i.Dy)(t,"nativeCRSs").map(e=>e.split(":")[1])}}function $e(t,e){const n=(0,i.Dy)(t,"1.0.0"===e?"interpolationMethod":"InterpolationMethod"),a="1.0.0"===e?t.getAttribute("default"):(0,i.mX)(t,"InterpolationMethods/Default");return null!=a?[a].concat(n.filter(r=>r.toLowerCase()!==a.toLowerCase())):n}function Ge(t){return null==t?["nearest"]:t.map(e=>{const n=e.toLowerCase();return n.includes("nearest")?"nearest":n.includes("linear")?"bilinear":n.includes("cubic")?"cubic":null}).filter(e=>!!e)}function Ze(t){const e=(0,i.IC)(t,"pos"),n=(0,i.pN)(e[0]),a=(0,i.pN)(e[1]);return new O.A({xmin:n[0],ymin:n[1],xmax:a[0],ymax:a[1],spatialReference:{wkid:4326}})}function Ve(t,e){const n=(0,i.Dy)(t,e);return n?.length&&""!==n[0]&&!isNaN(Number(n[0]))?n.map(a=>Number(a)):null}function He(t){const e=(0,i.pN)(t,"MinimumValue"),n=(0,i.pN)(t,"MaximumValue");return e.length&&n.length?e.map((a,r)=>({min:a,max:n[r],avg:-1,stddev:-1})):null}function Ue(t){return null==t?null:t.every(e=>e===t[0])?t[0]:t}function Ye(t){const e=[],n=(0,i.IC)(t,"RangeSet");let a=[];for(let r=0;r<n.length;r++){const o=(0,i.mX)(n[r],"name"),s=(0,i.mX)(n[r],"label"),l=[],u=Ve(n[r],"nullValues/singleValue"),c=(0,i.IC)(n[r],"AxisDescription");for(let d=0;d<c.length;d++){const y=(0,i.mX)(c[d],"name"),g=(0,i.mX)(c[d],"label"),f=(0,i.Dy)(c[d],"singleValue");if(0===f.length){const S=(0,i.mX)(c[d],"min"),v=(0,i.mX)(c[d],"max"),I=Number((0,i.mX)(c[d],"res"))||1;if(null!==S&&null!==v)for(let A=parseInt(S,10);A<=parseInt(v,10);A+=I)f.push(A.toString())}"band"===y.toLowerCase()&&(a=f),l.push({name:y,label:g,values:f})}e.push({name:o,label:s,nullValues:u,axis:l})}return{rangeSet:e,bandNames:a}}function Qe(t=null){if(!t)return{resolution:null,units:null};let e=t.toUpperCase();const r=["Years","Months","Days","Hours","Minutes","Seconds"];let o,s,l;return e.includes("PT")?(e=e.slice(2),l=["H","M","S"].findIndex(u=>e.includes(u)),o=r[3+l],s=parseFloat(e.slice(0,-1))):(e=e.slice(1),l=["Y","M","D"].findIndex(u=>e.includes(u)),l>-1&&(o=r[l]),s=parseFloat(e.slice(0,-1))),{resolution:s,units:o}}function Me(t){const e=(0,i.IC)(t,"timeposition");if(e.length>0){const a=[];for(let r=0;r<e.length;r++)a.push(new Date((0,i.mX)(e[r])));return{begin:a[0],end:a[a.length-1],values:a}}const n=(0,i.V6)(t,"timePeriod")||(0,i.V6)(t,"TimePeriod");return n?{begin:new Date((0,i.mX)(n,"beginPosition")||(0,i.mX)(n,"BeginPosition")),end:new Date((0,i.mX)(n,"endPosition")||(0,i.mX)(n,"EndPosition")),...Qe((0,i.mX)(n,"timeResolution")||(0,i.mX)(n,"TimeResolution"))}:null}function Je(t){const e=(0,i.V6)(t,"spatialDomain"),n=(0,i.V6)(e,"Envelope")||(0,i.V6)(e,"EnvelopeWithTimePeriod"),a=n.getAttribute("srsName").split(":"),r=a[a.length-1],o=(0,i.IC)(n,"pos"),s=(0,i.pN)(o[0]),l=(0,i.pN)(o[1]),u=parseInt(r,10),c=isNaN(u)?null:{wkid:u},d=new O.A({xmin:s[0],ymin:s[1],xmax:l[0],ymax:l[1],spatialReference:c}),y=(0,i.V6)(e,"RectifiedGrid"),g=(0,i.mX)(y,"low").split(" "),f=(0,i.mX)(y,"high").split(" "),S=parseInt(f[0],10)-parseInt(g[0],10)+1,v=parseInt(f[1],10)-parseInt(g[1],10)+1,I=(0,i.pN)(e,"origin/pos"),A=(0,i.IC)(e,"offsetVector"),x={envelope:d,columns:S,rows:v,offset:{x:parseFloat((0,i.mX)(A[0]).split(" ")[0]),y:parseFloat((0,i.mX)(A[1]).split(" ")[1])},origin:{x:I[0],y:I[1]}},V=(0,i.V6)(t,"temporalDomain")||(0,i.V6)(t,"TemporalDomain");return{spatialDomain:x,temporalDomain:V?Me(V):null}}function et(t,e){const n=[],a=(0,i.IC)(t,"Field");let r,o=[];for(let s=0;s<a.length;s++){const l=(0,i.mX)(a[s],"Identifier"),u=(0,i.mX)(a[s],"Description"),c=(0,i.mX)(a[s],"Definition"),d=(0,i.mX)(a[s],"Abstract"),y=(0,i.mX)(a[s],"Title"),g=Ve(a[s],"NullValue"),f=(0,i.V6)(a[s],"AllowedValues"),S=f?He(f):null,v=$e(a[s],"1.1.0"),I=[],A=(0,i.IC)(a[s],"Axis");for(let x=0;x<A.length;x++){const V=A[x].getAttribute("identifier"),U=(0,i.mX)(A[x],"UOM"),H=(0,i.mX)(A[x],"DataType"),de=(0,i.Dy)(A[x],"Key");e&&!V.toLowerCase().includes("band")||(o=de,r=g),I.push({identifier:V,uom:U,dataType:H,values:de,bandNoDataValues:r})}n.push({identifier:l,description:u,definition:c,abstract:d,title:y,supportedInterpolations:v,axis:I,nullValues:g,statistics:S})}return{rangeSet:n,bandNames:o,bandNoDataValues:r,statistics:n[0].statistics}}function it(t){const e=(0,i.V6)(t,"SpatialDomain"),n=(0,i.V6)(e,"GridCRS"),a=(0,i.mX)(n,"GridBaseCRS"),r=(0,i.mX)(n,"GridOrigin"),o=r?.split(" ").map(A=>parseFloat(A))??[0,0],s=(0,i.pN)(n,"GridOffsets"),l=(0,i.IC)(e,"BoundingBox");let u,c,d,y;for(let A=0;A<l.length;A++){const x=l[A].getAttribute("crs")?.toLowerCase();if(null!=x)if(x.includes("imagecrs")){const V=(0,i.pN)(l[A],"LowerCorner"),U=(0,i.pN)(l[A],"UpperCorner");u=U[0]-V[0]+1,c=U[1]-V[1]+1}else if(x.indexOf("epsg")>0){const V=x.split(":");d=parseInt(V[V.length-1],10);const U=(0,i.pN)(l[A],"LowerCorner"),H=(0,i.pN)(l[A],"UpperCorner");y=new O.A({xmin:U[0],ymin:U[1],xmax:H[0],ymax:H[1],spatialReference:{wkid:d}})}}const g=u>c,f=y.xmax-y.xmin>y.ymax-y.ymin;let S=!1;(0,M.m)(d)&&(g===f?S=!1:(S=!0,y=new O.A({xmin:y.ymin,ymin:y.xmin,xmax:y.ymax,ymax:y.xmax,spatialReference:{wkid:d}})));const v={columns:u,rows:c,origin:{x:o[0],y:o[1]},offset:{x:s[0],y:s[s.length-1]},gridBaseCRS:a,envelope:y,useEPSGAxis:S},I=(0,i.V6)(t,"temporalDomain")||(0,i.V6)(t,"TemporalDomain");return{spatialDomain:v,temporalDomain:I?Me(I):null}}function rt(t){const e=(0,i.V6)(t,"Envelope")||(0,i.V6)(t,"EnvelopeWithTimePeriod"),n=e.getAttribute("srsName"),a=n.slice(n.lastIndexOf("/")+1),r=e.getAttribute("axisLabels").split(" ").map(v=>v.trim()).filter(v=>""!==v.trim()),o=(0,i.pN)(e,"lowerCorner"),s=(0,i.pN)(e,"upperCorner"),l=!["y","lat","latitude","north","nor","n","b"].includes(r[0].toLowerCase());let u;const c=parseInt(a,10),d=isNaN(c)?null:{wkid:c};u=new O.A(l?{xmin:o[0],ymin:o[1],xmax:s[0],ymax:s[1],spatialReference:d}:{xmin:o[1],ymin:o[0],xmax:s[1],ymax:s[0],spatialReference:d});const y={mins:o,maxs:s},g=e.getAttribute("uomLabels").trim().split(" ");let f,S;if((0,i.g7)(e,"EnvelopeWithTimePeriod")){f=new Date((0,i.mX)(t,"beginPosition")||(0,i.mX)(t,"BeginPosition")),S=new Date((0,i.mX)(t,"endPosition")||(0,i.mX)(t,"EndPosition"));const v=g?.findIndex(I=>"oledatetime"===I?.toLowerCase());v>-1&&(g[v]="ISO8601")}return{envelope:u,axisLabels:r,uomLabels:g.length?g:null,envelopeAllDims:y,beginPosition:f,endPosition:S,isEastFirst:l}}function st(t,e){const n=[],a=(0,i.IC)(t,"DataRecord"),r=[];let o,s=[];for(let l=0;l<a.length;l++){const u=(0,i.IC)(a[l],"field"),c=[];for(let d=0;d<u.length;d++){const y=u[d].getAttribute("name"),g=(0,i.mX)(u[d],"description")||"",f=(0,i.V6)(u[d],"uom")?.getAttribute("code")||"",S=(0,i.pN)(u[d],"interval"),v=Ve(u[d],"nilValue")?.[0];e&&!y.toLowerCase().includes("band")||(r.push(y),S?.length&&(o=o||[],o.push({min:S[0],max:S[1],avg:-1,stddev:-1})),s.push(v)),c.push({name:y,description:g,uom:f,allowedValues:S,nilValue:v})}n.push(c)}return s.some(l=>null!=l)||(s=null),{rangeType:n,bandNames:r,bandStats:o,bandNoDataValues:s}}function at(t){let e=1,n="";const a=.01;return Math.abs(t-1/24)<1/24*a?n="Hours":Math.abs(t-1)<1*a?n="Days":t<1?(e=Math.round(24*t),n="Hours"):t>28-a&&t<31+a||Math.round(t/30)<12?n="Months":t>365-a&&t<366+a&&(n="Years"),{interval:e,intervalUnit:n}}function lt(t,e){const n=(0,i.V6)(t,"RectifiedGrid"),a=(0,i.pN)(n,"low"),r=(0,i.pN)(n,"high"),o=[];for(let I=0;I<a.length;I++)o.push(r[I]-a[I]+1);const s=(0,i.mX)(n,"axisLabels").split(" "),l=(0,i.pN)(n,"origin/pos"),u=(0,i.IC)(n,"offsetVector"),c=[];for(let I=0;I<u.length;I++){const A=(0,i.pN)(u[I]),x=A.findIndex(V=>0!==V);c[x]=A[x]}let f,S,v,y=!1;return e?.length&&s?.length&&(y=[...e].sort((I,A)=>I<A?-1:1).join(",")===[...s].sort((I,A)=>I<A?-1:1).join(",")),["y","lat","latitude","north","nor","n","b"].includes((y?s:e)[0].toLowerCase())?(f=o[1],S=o[0],v={y:Math.abs(c[0]),x:Math.abs(c[1])}):(f=o[0],S=o[1],v={x:Math.abs(c[0]),y:Math.abs(c[1])}),{columns:f,rows:S,origin:l,offset:c,resolution:v,gridSamples:o,axisLabels:s,hasSameAxisLabelsAsBoundedBy:y}}function ct(t){const e=(0,i.V6)(t,"EarthObservation");if(!e)return null;const n=(0,i.V6)(e,"phenomenonTime"),a=n?Me(n):null,r=(0,i.V6)(e,"phenomenonTime"),o=r?Me(r):null,s=(0,i.mX)(e,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let l=null;if(s){const u=s.split(" ").map(c=>c.trim()).filter(c=>null!=c&&""!==c).map(Number);if(u.length){const c=[];for(let d=0;d<u.length/2;d+=2)c.push(u[d],u[d+1]);l=new Xe.A({rings:[[c]]})}}return{observation:{phenomenonTime:a,resultTime:o,footprint:l,identifier:(0,i.mX)(t,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:(0,i.mX)(t,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:(0,i.mX)(t,"metaDataProperty/EarthObservationMetaData/status")}}}function ze(){return(ze=(0,P.A)(function*(t,e){const{version:n,customParameters:a,signal:r}=e??{},o=n?.startsWith("1.0")?"version":"acceptVersions",s={service:"WCS",request:"GetCapabilities",[o]:n,...a};try{let{data:l}=yield(0,C.A)(t,{query:s,responseType:"xml",signal:r});return e?.version||function fe(t){let e=null;e="string"==typeof t?(new DOMParser).parseFromString(t,"text/xml"):t;const n=e.documentElement.getAttribute("version"),a=n?.slice(0,3);return null!=a&&a<"2.1"}(l)||(s[o]="2.0.1",({data:l}=yield(0,C.A)(t,{query:s,responseType:"xml",signal:r}))),function je(t,e=null){let n=null;n="string"==typeof t?(new DOMParser).parseFromString(t,"text/xml"):t;let a=n.documentElement.getAttribute("version");"1.0"===a?a="1.0.0":"1.1"===a&&(a="1.1.0");const r=a||e||"1.0.0",o=r.slice(0,3);let s;if("2.0"===o)s=function Ee(t){const e=(0,i.V6)(t,"ServiceIdentification"),n=(0,i.mX)(e,"Title"),a=(0,i.Dy)(e,"ServiceTypeVersion"),r=(0,i.Dy)(e,"Profile"),o=ve((0,i.V6)(t,"OperationsMetadata")),s=(0,i.IC)(t,"Contents/CoverageSummary"),l=[];for(let c=0;c<s.length;c++){const d=s[c],y=(0,i.mX)(d,"CoverageId"),g=(0,i.V6)(d,"WGS84BoundingBox");let f;if(g){const v=(0,i.pN)(g,"LowerCorner"),I=(0,i.pN)(g,"UpperCorner");f=new O.A({xmin:v[0],ymin:v[1],xmax:I[0],ymax:I[1],spatialReference:{wkid:4326}})}const S=(0,i.mX)(d,"CoverageSubtype")||"RectifiedGridCoverage";l.push({id:y,lonLatEnvelope:f,coverageSubType:S})}const u=(0,i.V6)(t,"ServiceMetadata");return{name:n,supportedVersions:a,supportedFormats:(0,i.Dy)(u,"formatSupported"),supportedInterpolations:(0,i.Dy)(u,"interpolationSupported").concat((0,i.Dy)(u,"InterpolationSupported")),onlineResources:o,profiles:r,coverages:l,gridCoverages:ce(l),version:"2.0.1"}}(n);else if("1.1"===o)s=function we(t){const e=(0,i.mX)(t,"ServiceIdentification/Title"),n=(0,i.Dy)(t,"ServiceIdentification/ServiceTypeVersion"),a=ve((0,i.V6)(t,"OperationsMetadata")),r=[],o=(0,i.V6)(t,"Contents");for(let l=0;l<o.childNodes.length;l++){const u=o.childNodes[l];1===u.nodeType&&(0,i.g7)(u,"CoverageSummary")&&be(ue(u),r)}const s=(0,i.Dy)(o,"SupportedFormat");return{name:e,onlineResources:a,coverages:r,gridCoverages:ce(r),supportedVersions:n,supportedFormats:s,version:"1.1.0"}}(n);else{if("1.0"!==o)throw new F.A("wcsraster:parsecapabilities","the capabilities version is not supported");s=function re(t){const e=(0,i.mX)(t,"Service/name"),n=(0,i.V6)(t,"Capability"),a=(0,i.V6)(n,"GetCapabilities/Get/OnlineResource")?.getAttribute("xlink:href")??"",r=(0,i.V6)(n,"DescribeCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",o=(0,i.V6)(n,"GetCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",s={getCapabilities:T(a),describeCoverage:T(r),getCoverage:T(o)},l=(0,i.IC)(t,"CoverageOfferingBrief"),u=[];for(let c=0;c<l.length;c++){const d=l[c],y=(0,i.mX)(d,"name"),g=(0,i.IC)(d,"pos"),f=(0,i.pN)(g[0]),S=(0,i.pN)(g[1]),v=new O.A({xmin:f[0],ymin:f[1],xmax:S[0],ymax:S[1],spatialReference:{wkid:4326}});u.push({id:y,lonLatEnvelope:v})}return{name:e,onlineResources:s,coverages:u,gridCoverages:ce(u),supportedVersions:["1.0.0"],version:"1.0.0"}}(n)}return s.version=r,s}(l)}catch(l){throw(0,ie.zf)(l)?l:new F.A("wcslayer:open","wcs capabilities is not valid or supported")}})).apply(this,arguments)}function We(t,e){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,P.A)(function*(t,e){const{coverageIds:n,version:a,customParameters:r,signal:o}=e,s=a.slice(0,3),u={service:"WCS",request:"DescribeCoverage",version:a,["1.0"===s?"coverage":"1.1"===s?"identifiers":"coverageId"]:n.join(","),...r};try{const{data:c}=yield(0,C.A)(t,{query:u,responseType:"xml",signal:o});return function dt(t,e){let n=null;if(n="string"==typeof t?(new DOMParser).parseFromString(t,"text/xml"):t,"1.0.0"===e)return(0,i.IC)(n,"CoverageOffering").map(r=>function ke(t){const e={version:"1.0"};let n,a=[];for(let S=0;S<t.childNodes.length;S++){const v=t.childNodes[S];if(1===v.nodeType)if((0,i.g7)(v,"description"))e.description=(0,i.mX)(v);else if((0,i.g7)(v,"name"))e.name=(0,i.mX)(v);else if((0,i.g7)(v,"label"))e.label=(0,i.mX)(v);else if((0,i.g7)(v,"supportedFormats"))e.supportedFormats=(0,i.Dy)(v,"formats");else if((0,i.g7)(v,"supportedCRSs"))e.supportedCRSs=Ke(v);else if((0,i.g7)(v,"supportedInterpolations"))e.supportedInterpolations=$e(v,"1.0.0");else if((0,i.g7)(v,"lonLatEnvelope"))e.lonLatEnvelope=Ze(v);else if((0,i.g7)(v,"rangeSet")){const I=Ye(v);e.rangeSet=I.rangeSet,a=I.bandNames;const A=I.rangeSet[0].nullValues;A?.length&&(n=Ue(A))}else(0,i.g7)(v,"domainSet")&&(e.domainSet=Je(v))}const r=Ge(e.supportedInterpolations),{name:o,description:s,label:l,lonLatEnvelope:u,supportedFormats:c}=e,{spatialDomain:d}=e.domainSet,y={x:Math.abs(d.offset.x),y:Math.abs(d.offset.y)},g=function qe(t){if(!t.temporalDomain)return null;const{begin:e,end:n,values:a,units:r,resolution:o}=t.temporalDomain,s={variables:[{name:"default",description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:a?.map(l=>l.getTime()),hasRegularIntervals:!a,interval:o,intervalUnit:r,extent:[e.getTime(),n.getTime()]}]}]};return Oe(s),s}(e.domainSet),f=new Re.A({width:d.columns,height:d.rows,pixelSize:y,pixelType:"unknown",extent:d.envelope,spatialReference:d.envelope.spatialReference,bandCount:a.length||1,noDataValue:n,multidimensionalInfo:g});return{id:o,title:e.name,description:s||l,lonLatEnvelope:u,rasterInfo:f,bandNames:a,supportedFormats:c,supportedInterpolations:r,coverageDescription:e,version:"1.0.0",useEPSGAxis:!1}}(r));return(0,i.IC)(n,"CoverageDescription").map("1.1.0"===e||"1.1.1"===e||"1.1.2"===e?r=>function nt(t,e){const n=[],a=[],r={supportedFormats:n,supportedCRSs:a,version:"1.1"};let o,s,l=[];for(let A=0;A<t.childNodes.length;A++){const x=t.childNodes[A];if(1!==x.nodeType)continue;const V=(0,i.vv)(x).toLowerCase();switch(V){case"title":case"abstract":case"identifier":r[V]=(0,i.mX)(x);break;case"supportedformat":{const U=(0,i.mX)(x);n.includes(U)||n.push(U)}break;case"supportedcrs":{const U=(0,i.mX)(x);a.includes(U)||a.push(U)}break;case"range":{const U=et(x,!!r.domain?.temporalDomain);r.range=U.rangeSet,l=U.bandNames;const{bandNoDataValues:H}=U;H?.length&&(o=Ue(H)),s=U.statistics}break;case"domain":r.domain=it(x)}}const u=Ge(r.range[0].supportedInterpolations),{identifier:c,abstract:d,title:y,domain:g,range:f}=r,S={x:Math.abs(g.spatialDomain.offset.x),y:Math.abs(g.spatialDomain.offset.y)},v=function tt(t,e){if(!e.temporalDomain)return null;const n=t.filter(r=>!r.identifier.toLowerCase().includes("field_1")&&!r.axis.some(o=>o.identifier.includes("band"))),a=[];if(n.length&&n.forEach(r=>{const o=r.axis.map(s=>{const l=s.values.map(c=>"ISO8601"===s.uom?(c=c.trim()).toLowerCase().includes("z")?new Date(c).getTime():new Date(c+"Z").getTime():parseFloat(c.trim())),u=[Math.min.apply(null,l),Math.max.apply(null,l)];return{name:s.identifier.trim(),description:"",field:s.identifier.trim(),unit:s.uom?s.uom.trim():"",hasRegularIntervals:!1,values:l,extent:u}});a.push({name:r.identifier.trim(),description:r.description?.trim()??"",unit:"",dimensions:o,statistics:r.statistics})}),e.temporalDomain){const{begin:r,end:o,values:s,units:l,resolution:u}=e.temporalDomain;a.some(c=>c.dimensions.some(d=>"stdtime"===d.name.toLowerCase()))||a.forEach(c=>{c.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:s?.map(d=>d.getTime()),hasRegularIntervals:!s,interval:u,intervalUnit:l,extent:[r.getTime(),o.getTime()]})})}if(a.length){const r={variables:a};return Oe(r),r}return null}(f,g);v&&(o=f[0].nullValues,1===o?.length&&(o=o[0]));const I=new Re.A({width:g.spatialDomain.columns,height:g.spatialDomain.rows,pixelSize:S,pixelType:"unknown",extent:g.spatialDomain.envelope,spatialReference:g.spatialDomain.envelope.spatialReference,bandCount:l.length||1,noDataValue:o,statistics:s,multidimensionalInfo:v});return{id:c,title:r.title,description:d||y,bandNames:l,rasterInfo:I,supportedFormats:n,supportedInterpolations:u,coverageDescription:r,version:e,useEPSGAxis:g.spatialDomain.useEPSGAxis}}(r,e):r=>function ut(t){const e={version:"2.0"};let n,a,r=[];for(let y=0;y<t.childNodes.length;y++){const g=t.childNodes[y];if(1===g.nodeType)if((0,i.g7)(g,"coverageId"))e.coverageId=(0,i.mX)(g);else if((0,i.g7)(g,"ServiceParameters"))e.serviceParameters={supportedFormats:(0,i.Dy)(g,"nativeFormat")};else if((0,i.g7)(g,"boundedBy"))e.boundedBy=rt(g);else if((0,i.g7)(g,"rangeType")){const f=st(g,e.boundedBy?.axisLabels.length>2||e.domainSet?.axisLabels.length>2);e.rangeType=f.rangeType,r=f.bandNames,n=f.bandStats;const{bandNoDataValues:S}=f;S?.length&&(a=Ue(S))}else if((0,i.g7)(g,"domainSet"))e.domainSet=lt(g,e.boundedBy?.axisLabels);else if((0,i.g7)(g,"metadata")){const f=(0,i.V6)(g,"EOMetadata");e.eoMetadata=f?ct(f):null}}const{coverageId:o,boundedBy:s,domainSet:l,rangeType:u,serviceParameters:c}=e,d=function ot(t,e,n){if(n.axisLabels.length<=2)return null;const a=[];for(let o=0;o<t.length;o++){const s=t[o];for(let l=0;l<s.length;l++)s[l].name.toLowerCase().includes("band")||a.push(s[l])}const r=[];if(a.length){const o=[];for(let s=2;s<n.axisLabels.length;s++){const l=e.uomLabels?.[s]?.trim()??"",u=n.axisLabels[s].toLowerCase().includes("time")||"iso8601"===l.toLowerCase()||"oledatetime"===l.toLowerCase();let c,d;if(u){const g=at(n.offset[s]);c=g.interval,d=g.intervalUnit}else c=n.offset[s],d=l;const y=[];u?(y.push((0,_e.$E)(e.envelopeAllDims.mins[s])),y.push((0,_e.$E)(e.envelopeAllDims.maxs[s]))):(y.push(e.envelopeAllDims.mins[s]),y.push(e.envelopeAllDims.maxs[s])),o.push({name:n.axisLabels[s].trim(),description:n.axisLabels[s].trim(),unit:u?"ISO8601":l,hasRegularIntervals:!0,extent:y,interval:c,intervalUnit:d})}if(a.forEach(s=>{const{allowedValues:l}=s,u=2===l?.length?[{min:l[0],max:l[1],avg:-1,stddev:-1}]:null;r.push({name:s.name.trim(),description:s.description?.trim()??"",unit:s.uom.trim(),statistics:u,dimensions:[...o]})}),r.length){const s={variables:r};return Oe(s),s}}return null}(u,s,l);return!n&&d&&(n=d?.variables[0].statistics),null!=d&&(a=u[0][0].nilValue),{id:o,title:o,description:o,bandNames:r,rasterInfo:new Re.A({width:l.columns,height:l.rows,pixelSize:l.resolution,pixelType:"unknown",extent:s.envelope,spatialReference:s.envelope.spatialReference,bandCount:r.length||1,statistics:n,noDataValue:a,multidimensionalInfo:d}),supportedFormats:c.supportedFormats,coverageDescription:e,version:"2.0.1",useEPSGAxis:!1}}(r))}(c,a)}catch(c){throw(0,ie.zf)(c)?c:new F.A("wcslayer:open","wcs coverage description is not valid or supported")}})).apply(this,arguments)}var mt=p(52593),ht=p(78240);function ft(t,e,n=0){const a="--"+e.boundary,r=[];for(let I=0;I<a.length;I++)r.push(a.charCodeAt(I));const o=[],s="\n--"+e.boundary+"--";for(let I=0;I<s.length;I++)o.push(s.charCodeAt(I));const l=[10],u=[13,10],c=[],d=r.length,y=new Uint8Array(t,n),g=y.length-d;let f=0,S=0;for(let I=0;I<g;I++){for(S=0;S<d&&y[I+S]===r[S];S++);if(S!==d)continue;let A=!1;if(f){const x=Be(y.subarray(f,I),e);c.push(x),A=!!x.isValidImage}if(I+=d-1,y[I+1]===l[0]?I+=1:y[I+1]===u[0]&&y[I+2]===u[1]&&(I+=2),f=I+1,A)break}const v=o.length;for(let I=y.length-v-10;I<y.length-v;I++){for(S=0;S<v&&y[I+S]===o[S];S++);if(S===v){c.push(Be(y.subarray(f,I),e));break}}return c}function Be(t,e){const n=String.fromCharCode.apply(null,t.subarray(0,Math.min(300,t.length))).split("\n"),a=Math.min(n.length,7),r={contentDisposition:"inline"};let o=0;for(let s=0;s<a;s++)if(n[s].length<4)o=o+n[s].length+1;else if("content"===n[s].slice(0,7).toLowerCase()){o=o+n[s].length+1;const l=n[s].indexOf(":");if(-1===l)continue;const u=n[s].slice(0,l).trim(),c=n[s].slice(l+1).trim();switch(u.toLowerCase()){case"content-type":r.contentType=c;break;case"content-description":r.contentDescription=c;break;case"content-transfer-encoding":r.contentTransferEncoding=c;break;case"content-id":r.contentID=c;break;case"content-disposition":r.contentDisposition=c;break;case"content-location":r.contentLocation=c}}else{if(r.contentDisposition.toLowerCase().includes("inline")&&n[s].length>=4&&r.contentType?.toLowerCase().indexOf("image")>-1){let l=!0,u=t.subarray(o,t.length);if(r.contentType.toLowerCase().indexOf("tif")>0){if("base64"===r.contentTransferEncoding){let c="";const d=u;for(let g=0;g<d.length;g+=65535){const f=d.subarray(g,g+65535>d.length-1?d.length-1:g+65535);c+=String.fromCharCode.apply(null,f)}const y=atob(c);u=new Uint8Array(y.length);for(let g=0;g<u.length;g++)u[g]=y.charCodeAt(g)}l=73===u[0]&&73===u[1]||77===u[0]&&77===u[1]}if(l){let c=u.buffer;"base64"!==r.contentTransferEncoding&&(c=new ArrayBuffer(t.length-o),u=new Uint8Array(c),u.set(t.subarray(o,t.length))),r.contentData=c,r.isValidImage=!0}break}if((""===e.start||r.contentID===e.start)&&r.contentType){if(r.contentType.includes("text")||r.contentType.includes("xml")){r.contentData=String.fromCharCode.apply(null,t.subarray(o,t.length));break}r.contentData=t.subarray(o,t.length)}}return r}var vt=p(99263),St=p(40275);const It=["nearest neighbor","bilinear","bicubic"],bt=["nearest","linear","cubic"],Fe="response is not a supported multipart/related mediaType with inline tiff,  switching to compatibility mode",Te=new Set(["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"]);let Se=class extends ht.A{constructor(){super(...arguments),this.datasetFormat="WCSServer",this.tileType="Raster"}get rasterId(){return`${this.url}-${this.coverageId}-${this.version}`}fetchRawTile(t,e,n,a={}){var r=this;return(0,P.A)(function*(){if(r.isBlockOutside(t,e,n))return null;const{nativePixelSize:o,spatialReference:s}=r.rasterInfo,l=2**t,u=o.x*l,c=o.y*l,{blockWidth:d,blockHeight:y}=r.getBlockWidthHeight(t),{origin:g}=r.rasterInfo.storageInfo.tileInfo,f=r.getTileExtent({x:u,y:c},e,n,g,s,[d,y]),S=r.rasterInfo.extent,v=f.xmax>S.xmax,I=f.ymin<S.ymin,A=v||I;let x=f,V=d,U=y;if(A&&(x=f.clone().intersection(S),null!=x&&(v&&(V=Math.floor((x.xmax-x.xmin)/u),x.xmax=x.xmin+u*V),I&&(U=Math.floor((x.ymax-x.ymin)/c),x.ymin=x.ymax-c*U))),null==x||V<=1||U<=1)return null;const H=yield r._getCoverage(x,V,U,l,a);if(!H)return null;const{coverageDescription:de}=r.coverageInfo,{noDataValue:k,multidimensionalInfo:xe}=r.rasterInfo,{multidimensionalDefinition:ge}=a;let Ie;if(null!=xe&&null!=ge&&ge.length){const Ce=ge[0].variableName;"2.0"===de.version?Ie=de.rangeType[0].find(Y=>Y.name===Ce)?.nilValue:"1.1"===de.version&&(Ie=de.range.find(Y=>Y.identifier===Ce)?.nullValues)}const ye=Ie??k,se=yield r.decodePixelBlock(H,{width:V,height:U,planes:null,pixelType:null,tiffNoDataValue:Array.isArray(ye)?ye[0]:ye,matchAllNoData:!0});if(null==se)return null;if(se&&(se.width!==V||se.height!==U))throw new F.A("wcsraster-fetch",`the response has unexpected dimension width: ${se.width}, height: {pixelBlock.height}`);return A?(0,St.$Q)(se,{x:0,y:0},{width:y,height:y}):se})()}_open(t){var e=this;return(0,P.A)(function*(){const{customFetchParameters:n}=e.ioConfig,a=t?.signal,r=yield function pt(t,e){return ze.apply(this,arguments)}(e.url,{version:n?.version??e.version,customParameters:n,signal:a});if(e.capabilities=r,!e.version){let f=r.version.slice(0,3);"2.0"===f||"1.1"===f||"1.0"===f?e.version=r.version:(f=r.supportedVersions.find(S=>"2.0.1"===S)||r.supportedVersions.find(S=>"2.0"===S.slice(0,3))||r.supportedVersions.find(S=>"1.1"===S.slice(0,3))||r.supportedVersions.find(S=>"1.0"===S.slice(0,3))||"1.0.0",e.version=f)}const{version:o}=e;if(!Te.has(o))throw new F.A("wcsraster-open",`unsupported WCS version ${o}`);const{gridCoverages:s}=r;if(!s.length)throw new F.A("wcsraster-open","cannot find rectified grid coverages");e.coverageId??=s[0].id;const{coverageId:l}=e,u=s.find(f=>f.id===l);if(null==u)throw new F.A("wcsraster-open",`the coverageId ${l} does not exist in capabilities`);const c=yield We(e.url,{coverageIds:[l],version:o,customParameters:n,signal:a});if(e.coverageInfo=c[0],"2.0"===o.slice(0,3)){const{coverageInfo:f}=e;f.lonLatEnvelope=u.lonLatEnvelope,f.supportedInterpolations=Ge(r.supportedInterpolations),e._patchDimensionValues201(l,a)}e.datasetName=e.coverageInfo.title;const{rasterInfo:d}=e.coverageInfo;if(e.createRemoteDatasetStorageInfo(d,512,512),e._set("rasterInfo",d),null==d.spatialReference)throw new F.A("wcsraster-open",`coverage without spatial reference is not supported: ${l}`);const{pixelType:y,bandCount:g}=yield e._getPixelTypeAndBandCount(a);d.pixelType=y,1===d.bandCount&&g>1&&(d.bandCount=g),e.updateTileInfo()})()}_patchDimensionValues201(t,e){var n=this;return(0,P.A)(function*(){const{coverageInfo:a}=n,r=a.rasterInfo.multidimensionalInfo?.variables,o=Te.has("1.1.2")?"1.1.2":Te.has("1.1.1")?"1.1.1":Te.has("1.1.0")?"1.1.0":null,{customFetchParameters:s}=n.ioConfig;if(r&&o)try{const l=n.url.includes("/ImageServer/"),u=t.length>8&&t.startsWith("Coverage")&&l?t.slice(8):t,c=yield We(n.url,{coverageIds:[u??t],version:o,customParameters:s,signal:e}).catch(()=>{if(u)return We(n.url,{coverageIds:[t],version:o,customParameters:s,signal:e})}),d=c?.[0].rasterInfo.multidimensionalInfo?.variables;if(d)for(const y of r){const g=d.find(({name:f})=>f===y.name);if(g?.dimensions?.length)for(let f=y.dimensions.length-1;f>=0;f--){const S=y.dimensions[f],v=g.dimensions.find(({name:I})=>I===S.name);v?v.values&&v.extent?.join(",")===S.extent?.join(",")&&(y.dimensions[f]={...S,values:v.values}):l&&y.dimensions.splice(f,1)}}}catch{}})()}_getPixelTypeAndBandCount(t){var e=this;return(0,P.A)(function*(){const{pixelSize:n,extent:a,multidimensionalInfo:r}=e.rasterInfo,o=a.center,s=new O.A({xmin:o.x-n.x,xmax:o.x+n.x,ymin:o.y-n.y,ymax:o.y+n.y,spatialReference:a.spatialReference});let l=[];if(null!=r){const v=r.variables[0];l=[],v.dimensions.forEach(I=>{l.push(new mt.A({variableName:v.name,dimensionName:I.name,values:I.hasRegularIntervals?I.extent?.[0]:I.values?.[0],isSlice:!0}))})}const{coverageDescription:u}=e.coverageInfo,c={interpolation:"nearest",multidimensionalDefinition:l,signal:t},{version:d}=u,{ioConfig:y}=e,g="2.0"===d&&null==y.allowAnyMediaType||"1.1"===d&&null==y.use2GridOffsets;let f;try{f=yield e._getCoverage(s,2,2,1,c,!0)}catch(v){if(!g)throw v;if("1.1"===d){if(!v.details?.isResolutionMismatch)throw v;y.use2GridOffsets=!0}}if(!f&&g&&("2.0"===d&&(y.allowAnyMediaType=!0),f=yield e._getCoverage(s,2,2,1,c),f&&m.A.getLogger(e).warn("wcsraster:getcoverage",Fe)),!f)throw new F.A("wcsraster-open","unable to determine pixel type");const S=yield e.decodePixelBlock(f,{width:2,height:2,planes:null,pixelType:null});if(null==S)throw new F.A("wcsraster-open","unable to determine pixel type");return{pixelType:S.pixelType,bandCount:S.getPlaneCount()??0}})()}_getCoverage(t,e,n,a,r,o=!1){var s=this;return(0,P.A)(function*(){const{coverageDescription:l}=s.coverageInfo,{version:u}=l,c="2.0"===u?s._getCoverage201Parameters(t,e,n,a,r,l):"1.1"===u?s._getCoverage110Parameters(t,e,n,r,l):s._getCoverage100Parameters(t,e,n,r),d="2.0"===u?yield s.request(s._constructWCS201Url(c),{signal:r.signal,responseType:"array-buffer"}):yield s.request(s.url,{query:c,signal:r.signal,responseType:"array-buffer"});if("1.0"===u)return d.data;if("2.0"===u&&!1!==s.ioConfig.allowAnyMediaType&&"tiff"===(0,vt.g)(d.data))return o&&(s.ioConfig.allowAnyMediaType=!0,m.A.getLogger(s).warn("wcsraster:getcoverage",Fe)),d.data;const y=function gt(t){const e=function yt(t){const e=t.getHeader?.("Content-Type")?.split(";");if(!e||!(e[0].trim()??"").startsWith("multipart/"))return null;const n={boundary:"",start:"",type:""};for(let a=1;a<e.length;a++){const r=e[a].indexOf("=");if(r>0){const o=e[a].slice(0,r).trim(),s=e[a].slice(r+1).trim();n[o]=s.startsWith('"')?s.slice(1,-1):s}}return n}(t);return e?{isMultipart:!0,data:e.boundary?ft(t.data,e,0):null}:{isMultipart:!1,data:null}}(d);if(y.isMultipart&&y.data){const v=y.data.find(I=>I.isValidImage);return o&&"base64"===v?.contentTransferEncoding&&m.A.getLogger(s).warn("wcsraster:getcoverage","response is base64 encoded which may impact layer display performance"),v?.contentData}const g=new Uint8Array(d.data,0,Math.min(d.data.byteLength,2e3)),f=String.fromCharCode.apply(null,g).toLowerCase().includes("exception"),S=f&&String.fromCharCode.apply(null,g).includes("A non-zero RESX/RESY or WIDTH/HEIGHT is required but neither was provided");throw f?new F.A("wcsraster:getcoverage","server returns an exception",{isResolutionMismatch:S}):new F.A("wcsraster:getcoverage","response is not a supported multipart mediaType with inline tiff")})()}_getInterpolationIndex(t){return t&&this.coverageInfo.supportedInterpolations?.includes(t)?"nearest"===t?0:"bilinear"===t?1:"cubic"===t?2:0:0}_getCoverage100Parameters(t,e,n,a){const r=`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`,o=t.spatialReference.wkid,s=(this.coverageInfo.supportedFormats||[]).find(S=>S.toLowerCase().includes("tiff"))||"GEOTIFF",{bandIds:l,interpolation:u}=a,c=this._getInterpolationIndex(u),d=l?l.map(S=>this.coverageInfo.bandNames[S]):null,y=It[c],{multidimensionalDefinition:g}=a;let f;if(null!=g&&null!=this.rasterInfo.multidimensionalInfo){let v=g.find(I=>"StdTime"===I.dimensionName)?.values;v&&v.length>0&&(Array.isArray(v[0])&&(v=v[0]),f=v.map(I=>Pe(I)).join(","))}return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:s,crs:`EPSG:${o}`,bbox:r,width:e,height:n,time:f,interpolation:y,band:d?.join(",")}}_getCoverage110Parameters(t,e,n,a,r){const{multidimensionalDefinition:o,bandIds:s,interpolation:l}=a,u=t.spatialReference.wkid,c=`urn:ogc:def:crs:EPSG::${u}`,d=(this.coverageInfo.supportedFormats||[]).find(Z=>Z.toLowerCase().includes("tiff"))||"image/tiff",y=this._getInterpolationIndex(l),g=bt[y],f=null==l||0===this.coverageInfo.supportedInterpolations?.indexOf(l),S=r.domain.spatialDomain,v=S.origin.x<=S.envelope.xmin&&S.origin.y<=S.envelope.ymin,I=t.width/e,A=t.height/n*(v?1:-1),x=v?[t.xmin,t.ymin]:[t.xmin,t.ymax],V=S.useEPSGAxis&&(0,M.m)(u),U=V?`${x[1]},${x[0]}`:`${x[0]},${x[1]}`,H=this.ioConfig.use2GridOffsets,de=V?H?`${A},${I}`:`${A},0,0,${I}`:H?`${I},${A}`:`${I},0,0,${A}`,k=I/2,xe=t.xmin+k,ge=t.xmax-k,Ie=Math.abs(A)/2,ye=t.ymin+Ie,se=t.ymax-Ie,Ce=V?`${ye},${xe},${se},${ge},${c}`:`${xe},${ye},${ge},${se},${c}`,z=r.range.find(Z=>Z.axis.some(ae=>ae.identifier.toLowerCase().includes("band")));let Y,Q=z&&g&&s?f?`${z.identifier}[${z.axis[0].identifier}[${s.join(",")}]]`:`${z.identifier}:${g}[${z.axis[0].identifier}[${s.join(",")}]]`:null;if(null!=o&&o.length)for(let Z=0;Z<o.length;Z++){let ae=o[Z].values;const q=o[Z].dimensionName?.toLowerCase(),Ae=o[Z].variableName?.toLowerCase(),oe=r.range.find(pe=>pe.identifier.toLowerCase()===Ae);if(ae.length>0)if(Array.isArray(ae[0])&&(ae=ae[0]),"stdtime"===q)Y=ae.map(pe=>Pe(pe)).join(",");else if(oe){const pe=oe.axis.find(Mt=>Mt.identifier.toLowerCase()===q);pe&&(Q=f?oe.identifier+"["+pe.identifier+"["+ae.join(",")+"]]":oe.identifier+":"+g+"["+pe.identifier+"["+ae.join(",")+"]]")}Z===o.length-1&&oe&&!Q&&(Q=f?oe.identifier:oe.identifier+":"+g)}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:d,crs:`EPSG:${u}`,boundingbox:Ce,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:U,gridOffsets:de,gridBaseCRS:c,timeSequence:Y,rangeSubset:Q}}_getCoverage201Parameters(t,e,n,a,r,o){const{multidimensionalDefinition:s,interpolation:l}=r,u=this._getInterpolationIndex(l);let c=null;const{supportedInterpolations:d}=this.capabilities;if(d?.length)switch(u){case 0:c=d.find(z=>z.toLowerCase().includes("nearest"));break;case 1:c=d.find(z=>z.toLowerCase().includes("linear"));break;case 2:c=d.find(z=>z.toLowerCase().includes("cubic")||z.toLowerCase().includes("quadratic"))}const y=(this.coverageInfo.supportedFormats||[]).find(z=>z.toLowerCase().includes("tiff"))||"image/tiff",{bandNames:g}=this.coverageInfo,{boundedBy:f,domainSet:S,rangeType:v}=o,I=f.isEastFirst?0:1,A=1-I,{axisLabels:x}=f,V=x[I],U=x[A],H=`http://www.opengis.net/def/crs/EPSG/0/${t.spatialReference.wkid}`,de=H,k=[];k.push(`${V}(${t.xmin},${t.xmax})`),k.push(`${U}(${t.ymin},${t.ymax})`);const xe=[];if(x.length>2)for(let z=2;z<x.length;z++){const Y=S.origin[z];if(x[z].toLowerCase().includes("time")){let Q=Y.toString();f.uomLabels?.[z].toLowerCase().includes("ole")&&(xe.push(x[z]),Q=Pe(Y,!0)),k.push(x[z]+",http://www.opengis.net("+Q+")")}else k.push(x[z]+",http://www.opengis.net("+Y+")")}let ge=null;if(null!=s&&s.length){const z=[];v.forEach(Q=>Q.forEach(Z=>z.push(Z.name)));const Y=[];for(let Q=0;Q<s.length;Q++){const Z=x.find(q=>q===s[Q].dimensionName),ae=z.find(q=>q===s[Q].variableName);if(Y.includes(ae)||Y.push(ae),Z){let q=s[Q].values;if(q.length>0){Array.isArray(q[0])&&(q=q[0]);let Ae="";Ae=Z.toLowerCase().includes("time")?q.map(pe=>Pe(pe)).join(","):q.join(",");const oe=k.findIndex(pe=>0===pe.indexOf(Z+",http://www.opengis.net"));-1===oe&&k.push(Z+",http://www.opengis.net("+Ae+")"),-1===oe||k[oe].includes("("+Ae+")")||k.splice(oe,1,Z+",http://www.opengis.net("+Ae+")")}}}Y.length&&(ge=Y.join(","))}else g?.length>=2&&(ge=(r.bandIds?r.bandIds.map(z=>g[z]):g).join(","));const Ie=k.join("&subset="),ye=!o.domainSet.hasSameAxisLabelsAsBoundedBy&&!1!==this.ioConfig.allowScaleFactor;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:ge,interpolation:c,scaleSize:ye?null:`${V}(${e}),${U}(${n})`,scaleFactor:ye?1/a:null,subset:Ie,format:y,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:H,subsettingcrs:de}}_constructWCS201Url(t){const e={...this.ioConfig.customFetchParameters,...t},n=[];return Object.keys(e).forEach(a=>{const r=e[a];null!=r&&("subset"===a?"string"==typeof r&&r.split("&subset=").forEach(o=>{o&&n.push(`subset=${encodeURIComponent(o)}`)}):n.push(`${a}=${encodeURIComponent(r)}`))}),`${encodeURI(this.url)}?${n.join("&")}`}};function Pe(t,e=!1){return(e?new Date((0,_e.$E)(t)):new Date(t)).toISOString()}(0,E._)([(0,R.MZ)({type:String,json:{write:!0}})],Se.prototype,"datasetFormat",void 0),(0,E._)([(0,R.MZ)({readOnly:!0})],Se.prototype,"tileType",void 0),(0,E._)([(0,R.MZ)({type:String,json:{write:!0}})],Se.prototype,"version",void 0),(0,E._)([(0,R.MZ)({type:String,json:{write:!0}})],Se.prototype,"coverageId",void 0),(0,E._)([(0,R.MZ)({readOnly:!0})],Se.prototype,"rasterId",null),Se=(0,E._)([(0,L.$)("esri.layers.support.rasterDatasets.WCSRaster")],Se);const Lt=Se;var wt=p(41843),De=p(71655);const Et=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let K=class extends((0,w.dM)((0,he.j)((0,N.q)((0,X.A)((0,_.d)((0,G.o)((0,le.e)((0,J.J)((0,te.P)(D.A.ClonableMixin(W.A))))))))))){constructor(...t){var e;super(...t),e=this,this.coverageId=null,this.version=null,this.isReference=null,this.legendEnabled=!0,this.noData=0,this.operationalLayerType="WCS",this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this._debouncedSaveOperations=(0,ie.sg)(function(){var n=(0,P.A)(function*(a,r,o){const{save:s,saveAs:l}=yield p.e(3518).then(p.bind(p,23518));switch(a){case De.X.SAVE:return s(e,r);case De.X.SAVE_AS:return l(e,o,r)}});return function(a,r,o){return n.apply(this,arguments)}}())}normalizeCtorArgs(t,e){return"string"==typeof t?{url:t,...e}:t}load(t){const e=null!=t?t.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WCS"]},t).catch(ie.QP).then(()=>this._openRaster(e))),Promise.resolve(this)}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){return[(0,B.rZ)("Pixel Value")]}createPopupTemplate(t){return(0,wt.tn)({fields:this.rasterFields,title:this.title},t)}save(t){var e=this;return(0,P.A)(function*(){return e._debouncedSaveOperations(De.X.SAVE,t)})()}saveAs(t,e){var n=this;return(0,P.A)(function*(){return n._debouncedSaveOperations(De.X.SAVE_AS,e,t)})()}_openRaster(t){var e=this;return(0,P.A)(function*(){const n=new Lt({url:e.url,version:e.version,coverageId:e.coverageId,ioConfig:{sampling:"closest",...e.ioConfig,customFetchParameters:e.customParameters}});if(yield n.open({signal:t}),!n.rasterInfo)throw n.destroy(),new F.A("wcs-layer:load","cannot load resources on "+e.url);const{rasterInfo:a}=n;null==a.noDataValue&&(a.noDataValue=e.noData),e._set("serviceRasterInfo",a),e._set("spatialReference",a.spatialReference),null==e.title&&e.setAtOrigin("title",n.datasetName,"service"),null==e.coverageId&&e.setAtOrigin("coverageId",n.coverageInfo.id,"service"),null==e.version&&n.version&&e.setAtOrigin("version",n.version,"service"),e.setAtOrigin("tileInfo",n.rasterInfo.storageInfo.tileInfo,"service");const{multidimensionalInfo:r}=a;if(null!=r){const o=r.variables[0].dimensions.find(({name:s})=>"StdTime"===s);if(o){let s=o.extent?.[0]??o.values[0];Array.isArray(s)&&(s=s[0]);let l=o.extent?.[1]??o.values[o.values.length-1];Array.isArray(l)&&(l=l[1]);const u=Et.has(o.intervalUnit?.toLowerCase())?o.intervalUnit?.toLowerCase():null;e.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:s,end:l},timeZone:null,interval:u?{value:o.interval,unit:u}:null})}}e.raster=n,e._configDefaultSettings(),e.addHandles((0,ne.wB)(()=>e.customParameters,o=>e.raster.ioConfig.customFetchParameters=o))})()}};(0,E._)([(0,R.MZ)({type:String,nonNullable:!0,json:{name:"wcsInfo.coverageId",write:{isRequired:!0,ignoreOrigin:!0}}})],K.prototype,"coverageId",void 0),(0,E._)([(0,R.MZ)()],K.prototype,"coverageInfo",null),(0,E._)([(0,R.MZ)({type:["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"],nonNullable:!0,json:{name:"wcsInfo.version",write:{isRequired:!0,ignoreOrigin:!0}}})],K.prototype,"version",void 0),(0,E._)([(0,R.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],K.prototype,"isReference",void 0),(0,E._)([(0,R.MZ)({json:{read:!0,write:!0}})],K.prototype,"blendMode",void 0),(0,E._)([(0,R.MZ)(j.fV)],K.prototype,"legendEnabled",void 0),(0,E._)([(0,R.MZ)({type:["show","hide"]})],K.prototype,"listMode",void 0),(0,E._)([(0,R.MZ)()],K.prototype,"noData",void 0),(0,E._)([(0,R.MZ)({type:["WCS"]})],K.prototype,"operationalLayerType",void 0),(0,E._)([(0,R.MZ)()],K.prototype,"raster",void 0),(0,E._)([(0,R.MZ)({readOnly:!0})],K.prototype,"type",void 0),(0,E._)([(0,R.MZ)(j.M6)],K.prototype,"popupEnabled",void 0),(0,E._)([(0,R.MZ)({type:me.A,json:{name:"popupInfo",write:!0}})],K.prototype,"popupTemplate",void 0),(0,E._)([(0,R.MZ)({readOnly:!0})],K.prototype,"defaultPopupTemplate",null),(0,E._)([(0,R.MZ)({readOnly:!0,type:[$.A]})],K.prototype,"fields",void 0),(0,E._)([(0,R.MZ)({readOnly:!0,type:[$.A]})],K.prototype,"rasterFields",null),K=(0,E._)([(0,L.$)("esri.layers.WCSLayer")],K);const _t=K},17049:(Le,ee,p)=>{p.d(ee,{q:()=>J});var P=p(8189),E=p(5922),me=p(45272),D=p(85211),F=p(55739),ne=(p(3248),p(40707),p(17221)),R=p(76576),h=p(50305),m=p(50501),b=p(34813),L=p(56558);const W={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},w={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},_={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},G={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":W,"web-map/basemap":w,"web-map/tables":_,"link-chart/operational-layers":{...W,LinkChartLayer:!0},"link-chart/basemap":w,"link-chart/tables":_,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}};var N=p(22329),X=p(17181);const J=le=>{let j=class extends le{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId($,B,O){return"Group Layer"===O?.portalItem?.type?void 0:$}writeListMode($,B,O,M){(M&&"ground"===M.layerContainerType||$&&(0,L.R)(this,O,{},M))&&(B[O]=$)}writeOperationalLayerType($,B,O){$&&(B[O]=$)}writeTitle($,B){B.title=$??"Layer"}readVisibilityTimeExtent($){return $?X.A.fromArray($):null}writeVisibilityTimeExtent($,B,O,M){$&&"tables"!==M.layerContainerType&&($.isEmpty?M?.messages&&M.messages.push(new E.A("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):B[O]=$.toArray())}read($,B){B&&(B.layer=this),(0,b.t)(this,$,O=>super.read($,O),B)}write($,B){if(!this.persistenceEnabled&&!B?.ignorePersistenceEnabled)return null;if(B?.origin){const C=`${B.origin}/${B.layerContainerType||"operational-layers"}`;let T=!!G[C]?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===C&&(T=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===C&&(T=!1),!T)return B.messages?.push(new E.A("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${C}'`,{layer:this})),null}const O=super.write($,{...B,layer:this}),M=!!B&&!!B.messages&&!!B.messages.filter(C=>C instanceof E.A&&"web-document-write:property-required"===C.name).length;return(0,me.w8)(O?.url)?(B?.messages?.push(new E.A("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&M?null:O}beforeSave(){}};return(0,P._)([(0,D.MZ)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],j.prototype,"id",void 0),(0,P._)([(0,ne.w)("id",["id"])],j.prototype,"readId",null),(0,P._)([(0,D.MZ)(N.C1)],j.prototype,"listMode",void 0),(0,P._)([(0,h.K)("listMode")],j.prototype,"writeListMode",null),(0,P._)([(0,D.MZ)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:m.K,isRequired:!0}}}}})],j.prototype,"operationalLayerType",void 0),(0,P._)([(0,h.K)("operationalLayerType")],j.prototype,"writeOperationalLayerType",null),(0,P._)([(0,D.MZ)(N.ke)],j.prototype,"opacity",void 0),(0,P._)([(0,D.MZ)({type:Boolean,readOnly:!1})],j.prototype,"persistenceEnabled",void 0),(0,P._)([(0,D.MZ)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],j.prototype,"title",void 0),(0,P._)([(0,h.K)("title"),(0,h.K)(["web-scene"],"title")],j.prototype,"writeTitle",null),(0,P._)([(0,D.MZ)({type:X.A,json:{origins:{"web-scene":{write:{layerContainerTypes:m.K}}}}})],j.prototype,"visibilityTimeExtent",void 0),(0,P._)([(0,ne.w)("visibilityTimeExtent")],j.prototype,"readVisibilityTimeExtent",null),(0,P._)([(0,h.K)(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[F.jz,F.Uv]]}})],j.prototype,"writeVisibilityTimeExtent",null),(0,P._)([(0,D.MZ)({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:m.K}}})],j.prototype,"visible",void 0),j=(0,P._)([(0,R.$)("esri.layers.mixins.OperationalLayer")],j),j}},85551:(Le,ee,p)=>{p.d(ee,{A:()=>j});var P=p(10467),E=p(8189),me=p(23098),D=p(77469),F=p(89563),te=p(89447),ie=p(5922),ne=p(35150),R=p(11432),h=p(56492),m=p(45272),b=p(85211),w=(p(3248),p(40707),p(17221)),_=p(76576),G=p(50305),N=p(58443),X=p(73874),J=p(46577),he=p(52606),le=p(69927);const j=B=>{let O=class extends B{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,R.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(M){M!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",M))}readPortalItem(M,C,i){if(C.itemId)return new J.default({id:C.itemId,portal:i?.portal})}writePortalItem(M,C){M?.id&&(C.itemId=M.id)}loadFromPortal(M,C){var i=this;return(0,P.A)(function*(){if(i.portalItem?.id)try{const{load:T}=yield Promise.all([p.e(2076),p.e(6180)]).then(p.bind(p,56180));return(0,h.Te)(C),yield T({instance:i,supportedTypes:M.supportedTypes,validateItem:M.validateItem,supportsData:M.supportsData,layerModuleTypeMap:M.layerModuleTypeMap,populateGroupLayer:M.populateGroupLayer},C)}catch(T){throw(0,h.zf)(T)||ne.A.getLogger(i).warn(`Failed to load layer (${i.title}, ${i.id}) portal item (${i.portalItem.id})\n  ${T}`),T}})()}finishLoadEditablePortalLayer(M){var C=this;return(0,P.A)(function*(){C._set("userHasEditingPrivileges",yield C._fetchUserHasEditingPrivileges(M).catch(i=>((0,h.QP)(i),!0)))})()}setUserPrivileges(M,C){var i=this;return(0,P.A)(function*(){if(!me.A.userPrivilegesApplied)return i.finishLoadEditablePortalLayer(C);if(i.url)try{const{features:{edit:T,fullEdit:ce},content:{updateItem:re}}=yield i._fetchUserPrivileges(M,C);i._set("userHasEditingPrivileges",T),i._set("userHasFullEditingPrivileges",ce),i._set("userHasUpdateItemPrivileges",re)}catch(T){(0,h.QP)(T)}})()}_fetchUserPrivileges(M,C){var i=this;return(0,P.A)(function*(){let T=i.portalItem;if(!M||!T||!T.loaded||T.sourceUrl)return i._fetchFallbackUserPrivileges(C);const ce=!D.id?.findCredential(i.url),re=M===T.id;if(re&&T.portal.user)return i._getUserPrivileges(T,ce);let ue,be;if(re)ue=T.portal.url;else try{ue=yield(0,N.wI)(i.url,C)}catch(fe){(0,h.QP)(fe)}if(!ue||!(0,m.b8)(ue,T.portal.url))return i._fetchFallbackUserPrivileges(C);try{const fe=null!=C?C.signal:null;be=yield D.id?.getCredential(`${ue}/sharing`,{prompt:!1,signal:fe})}catch(fe){(0,h.QP)(fe)}if(!be)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(re?yield T.reload():(T=new J.default({id:M,portal:{url:ue}}),yield T.load(C)),T.portal.user)return i._getUserPrivileges(T,ce)}catch(fe){(0,h.QP)(fe)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_getUserPrivileges(M,C){const i=(0,le.It)(M);return C&&(i.features.edit=!0),i}_fetchFallbackUserPrivileges(M){var C=this;return(0,P.A)(function*(){let i=!0;try{i=yield C._fetchUserHasEditingPrivileges(M)}catch(T){(0,h.QP)(T)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(M){var C=this;return(0,P.A)(function*(){const i=C.url?D.id?.findCredential(C.url):null;if(!i)return!0;const T=$.credential===i?$.user:yield C._fetchEditingUser(M);return $.credential=i,$.user=T,null==T?.privileges||T.privileges.includes("features:user:edit")})()}_fetchEditingUser(M){var C=this;return(0,P.A)(function*(){const i=C.portalItem?.portal?.user;if(i)return i;const T=D.id?.findServerInfo(C.url??"");if(!T?.owningSystemUrl)return null;const ce=`${T.owningSystemUrl}/sharing/rest`,re=X.A.getDefault();if(re&&re.loaded&&(0,m.S8)(re.restUrl)===(0,m.S8)(ce))return re.user;const ue=`${ce}/community/self`,be=null!=M?M.signal:null,ve=yield(0,te.Ke)((0,F.A)(ue,{authMode:"no-prompt",query:{f:"json"},signal:be}));return ve.ok?he.A.fromJSON(ve.value.data):null})()}read(M,C){C&&(C.layer=this),super.read(M,C)}write(M,C){const i=C?.portal,T=this.portalItem?.id&&(this.portalItem.portal||X.A.getDefault());return i&&T&&!(0,m.ut)(T.restUrl,i.restUrl)?(C.messages&&C.messages.push(new ie.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(M,{...C,layer:this})}};return(0,E._)([(0,b.MZ)({type:J.default})],O.prototype,"portalItem",null),(0,E._)([(0,w.w)("web-document","portalItem",["itemId"])],O.prototype,"readPortalItem",null),(0,E._)([(0,G.K)("web-document","portalItem",{itemId:{type:String}})],O.prototype,"writePortalItem",null),(0,E._)([(0,b.MZ)({clonable:!1})],O.prototype,"resourceReferences",void 0),(0,E._)([(0,b.MZ)({type:Boolean,readOnly:!0})],O.prototype,"userHasEditingPrivileges",void 0),(0,E._)([(0,b.MZ)({type:Boolean,readOnly:!0})],O.prototype,"userHasFullEditingPrivileges",void 0),(0,E._)([(0,b.MZ)({type:Boolean,readOnly:!0})],O.prototype,"userHasUpdateItemPrivileges",void 0),O=(0,E._)([(0,_.$)("esri.layers.mixins.PortalLayer")],O),O},$={credential:null,user:null}},69927:(Le,ee,p)=>{p.d(ee,{It:()=>w,LG:()=>ie,OM:()=>h,Sm:()=>m,Y:()=>ne,bK:()=>R,mm:()=>W,sQ:()=>b});var P=p(10467),E=p(13970),me=p(32034),D=p(55039);function te(){return(te=(0,P.A)(function*(_){const G=_.spatialReference;if(G.isWGS84)return _.clone();if(G.isWebMercator)return(0,D.ci)(_);const N=me.A.WGS84;return yield(0,E.initializeProjection)(G,N),(0,E.project)(_,N)})).apply(this,arguments)}function ie(_,G){if(!ne(_,G)){const N=_.typeKeywords;N?N.push(G):_.typeKeywords=[G]}}function ne(_,G){return!!_.typeKeywords?.includes(G)}function R(_){return ne(_,W.HOSTED_SERVICE)}function h(_,G){const N=_.typeKeywords;if(N){const X=N.indexOf(G);X>-1&&N.splice(X,1)}}function m(_,G,N){N?ie(_,G):h(_,G)}function b(_){return L.apply(this,arguments)}function L(){return L=(0,P.A)(function*(_){const G=_.clone().normalize();let N;if(G.length>1)for(const X of G)N?X.width>N.width&&(N=X):N=X;else N=G[0];return function F(_){return te.apply(this,arguments)}(N)}),L.apply(this,arguments)}const W={DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function w(_){const{portal:G,isOrgItem:N,itemControl:X}=_,J=G.user?.privileges;let he=!J||J.includes("features:user:edit"),le=!!N&&!!J?.includes("features:user:fullEdit");const j="update"===X||"admin"===X;return j?le=he=!0:le&&(he=!0),{features:{edit:he,fullEdit:le},content:{updateItem:j}}}}}]);