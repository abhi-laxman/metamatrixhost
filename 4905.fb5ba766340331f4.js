"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[4905,7340],{23506:(B,R,n)=>{n.d(R,{v:()=>f});var p=n(99305);function f(U){U?.writtenProperties&&U.writtenProperties.forEach(({target:m,propName:I,newOrigin:d})=>{(0,p.H)(m)&&d&&m.originOf(I)!==d&&m.updateOrigin(I,d)})}},99305:(B,R,n)=>{function p(f){return f&&"getAtOrigin"in f&&"originOf"in f}n.d(R,{H:()=>p})},44905:(B,R,n)=>{n.r(R),n.d(R,{save:()=>h,saveAs:()=>L});var p=n(10467),f=n(17994),U=n(15764),m=n(69927),I=n(3458);const d="Media Layer",P="media-layer-save",b="media-layer-save-as",v=["media-layer:unsupported-source"];function y(t){return{isValid:"media"===t.type,errorMessage:"Layer.type should be 'media'"}}function A(t){return(0,U.m)(t,"portal-item",!0)}function T(t){return Promise.resolve(t.layerJSON)}function j(t,a){return u.apply(this,arguments)}function u(){return(u=(0,p.A)(function*(t,a){a.extent=t.fullExtent?yield(0,m.sQ)(t.fullExtent):null})).apply(this,arguments)}function _(t,a){return E.apply(this,arguments)}function E(){return(E=(0,p.A)(function*(t,a){a.title||=t.title,yield j(t,a),(0,m.OM)(a,m.mm.METADATA)})).apply(this,arguments)}function h(t,a){return M.apply(this,arguments)}function M(){return(M=(0,p.A)(function*(t,a){return(0,f.UN)({layer:t,itemType:d,validateLayer:y,createJSONContext:c=>A(c),createItemData:T,errorNamePrefix:P,supplementalUnsupportedErrors:v,setItemProperties:j,saveResources:(c,x)=>(0,I.r)(t.resourceReferences,x)},a)})).apply(this,arguments)}function L(t,a,c){return e.apply(this,arguments)}function e(){return(e=(0,p.A)(function*(t,a,c){return(0,f.Uh)({layer:t,itemType:d,validateLayer:y,createJSONContext:x=>A(x),createItemData:T,errorNamePrefix:b,supplementalUnsupportedErrors:v,newItem:a,setItemProperties:_,saveResources:(x,i)=>(0,I.r)(t.resourceReferences,i)},c)})).apply(this,arguments)}},17994:(B,R,n)=>{n.d(R,{B5:()=>t,CJ:()=>M,Gy:()=>T,UN:()=>c,Uh:()=>i,Y:()=>v,Y0:()=>E,Y9:()=>e,eP:()=>_});var p=n(10467),f=n(5922),U=n(23506),m=n(73874),I=n(46577),d=n(15764),P=n(69927),b=n(95945);function v(r,o,s){const l=s(r);if(!l.isValid)throw new f.A(`${o}:invalid-parameters`,l.errorMessage,{layer:r})}function y(r){return A.apply(this,arguments)}function A(){return(A=(0,p.A)(function*(r){const{layer:o,errorNamePrefix:s,validateLayer:l}=r;yield o.load(),v(o,s,l)})).apply(this,arguments)}function T(r,o){return`Layer (title: ${r.title}, id: ${r.id}) of type '${r.declaredClass}' ${o}`}function j(r){const{item:o,errorNamePrefix:s,layer:l,validateItem:D}=r;if(function u(r){const{item:o,itemType:s,additionalItemType:l,errorNamePrefix:D,layer:C}=r,w=[s];if(l&&w.push(l),!w.includes(o.type)){const K=w.map(g=>`'${g}'`).join(", ");throw new f.A(`${D}:portal-item-wrong-type`,`Portal item type should be one of: "${K}"`,{item:o,layer:C})}}(r),D){const C=D(o);if(!C.isValid)throw new f.A(`${s}:invalid-parameters`,C.errorMessage,{layer:l})}}function _(r){const{layer:o,errorNamePrefix:s}=r,{portalItem:l}=o;if(!l)throw new f.A(`${s}:portal-item-not-set`,T(o,"requires the portalItem property to be set"));if(!l.loaded)throw new f.A(`${s}:portal-item-not-loaded`,T(o,"cannot be saved to a portal item that does not exist or is inaccessible"));j({...r,item:l})}function E(r){const{newItem:o,itemType:s}=r;let l=I.default.from(o);return l.id&&(l=l.clone(),l.id=null),l.type??=s,l.portal??=m.A.getDefault(),j({...r,item:l}),l}function h(r){return(0,d.m)(r,"portal-item")}function M(r,o,s){return L.apply(this,arguments)}function L(){return(L=(0,p.A)(function*(r,o,s){"beforeSave"in r&&"function"==typeof r.beforeSave&&(yield r.beforeSave());const l=r.write({},o);return yield Promise.all(o.resources?.pendingOperations??[]),(0,b.c)(o,{errorName:"layer-write:unsupported"},s),l})).apply(this,arguments)}function e(r){(0,P.LG)(r,P.mm.JSAPI),r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,s,l)=>l.indexOf(o)===s))}function t(r,o,s){return a.apply(this,arguments)}function a(){return(a=(0,p.A)(function*(r,o,s){const l=r.portal;yield l.signIn(),yield l.user.addItem({item:r,data:o,folder:s?.folder})})).apply(this,arguments)}function c(r,o){return x.apply(this,arguments)}function x(){return(x=(0,p.A)(function*(r,o){const{layer:s,createItemData:l,createJSONContext:D,setItemProperties:C,saveResources:w,supplementalUnsupportedErrors:K}=r;yield y(r),_(r);const g=s.portalItem,S=D?D(g):h(g),N=yield M(s,S,{...o,supplementalUnsupportedErrors:K}),W=yield l({layer:s,layerJSON:N},g);return yield C?.(s,g,W),e(g),yield g.update({data:W}),(0,U.v)(S),yield w?.(g,S),g})).apply(this,arguments)}function i(r,o){return O.apply(this,arguments)}function O(){return(O=(0,p.A)(function*(r,o){const{layer:s,createItemData:l,createJSONContext:D,setItemProperties:C,saveResources:w,supplementalUnsupportedErrors:K}=r;yield y(r);const g=E(r),S=D?D(g):h(g),N=yield M(s,S,{...o,supplementalUnsupportedErrors:K}),W=yield l({layer:s,layerJSON:N},g);return yield C(s,g,W),e(g),yield t(g,W,o),s.portalItem=g,(0,U.v)(S),yield w?.(g,S),g})).apply(this,arguments)}},15764:(B,R,n)=>{n.d(R,{m:()=>m,v:()=>U});var p=n(45272),f=n(73874);function U(d,P){return{...I(d,P),readResourcePaths:[]}}function m(d,P,b){const v=(0,p.An)(d.itemUrl);return{...I(d,P),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:v?{rootPath:v.path,writtenUrls:[]}:null,resources:b?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function I(d,P){return{origin:P,url:(0,p.An)(d.itemUrl),portal:d.portal||f.A.getDefault(),portalItem:d}}},57340:(B,R,n)=>{n.r(R),n.d(R,{addOrUpdateResources:()=>P,contentToBlob:()=>E,fetchResources:()=>I,getSiblingOfSameType:()=>M,getSiblingOfSameTypeI:()=>L,removeAllResources:()=>A,removeResource:()=>v,splitPrefixFileNameAndExtension:()=>u});var p=n(10467),f=n(89563),U=n(5922),m=n(45272);function I(e){return d.apply(this,arguments)}function d(){return(d=(0,p.A)(function*(e,t={},a){yield e.load(a);const c=(0,m.fj)(e.itemUrl,"resources"),{start:x=1,num:i=10,sortOrder:O="asc",sortField:r="resource"}=t,o={query:{start:x,num:i,sortOrder:O,sortField:r,token:e.apiKey},signal:a?.signal},s=yield e.portal.request(c,o);return{total:s.total,nextStart:s.nextStart,resources:s.resources.map(({created:l,size:D,resource:C})=>({created:new Date(l),size:D,resource:e.resourceFromPath(C)}))}})).apply(this,arguments)}function P(e,t,a,c){return b.apply(this,arguments)}function b(){return(b=(0,p.A)(function*(e,t,a,c){const x=new Map;for(const{resource:O,content:r,compress:o,access:s}of t){if(!O.hasPath())throw new U.A(`portal-item-resource-${a}:invalid-path`,"Resource does not have a valid path");const[l,D]=j(O.path),C=`${l}/${o??""}/${s??""}`;x.has(C)||x.set(C,{prefix:l,compress:o,access:s,files:[]}),x.get(C).files.push({fileName:D,content:r})}yield e.load(c);const i=(0,m.fj)(e.userItemUrl,"add"===a?"addResources":"updateResources");for(const{prefix:O,compress:r,access:o,files:s}of x.values())for(let D=0;D<s.length;D+=25){const C=s.slice(D,D+25),w=new FormData;O&&"."!==O&&w.append("resourcesPrefix",O),r&&w.append("compress","true"),o&&w.append("access",o);let K=0;for(const{fileName:g,content:S}of C)w.append("file"+ ++K,S,g);w.append("f","json"),yield e.portal.request(i,{method:"post",body:w,signal:c?.signal})}})).apply(this,arguments)}function v(e,t,a){return y.apply(this,arguments)}function y(){return(y=(0,p.A)(function*(e,t,a){if(!t.hasPath())throw new U.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield e.load(a);const c=(0,m.fj)(e.userItemUrl,"removeResources");yield e.portal.request(c,{method:"post",query:{resource:t.path},signal:a?.signal}),t.portalItem=null})).apply(this,arguments)}function A(e,t){return T.apply(this,arguments)}function T(){return(T=(0,p.A)(function*(e,t){yield e.load(t);const a=(0,m.fj)(e.userItemUrl,"removeResources");return e.portal.request(a,{method:"post",query:{deleteAll:!0},signal:t?.signal})})).apply(this,arguments)}function j(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function u(e){const[t,a]=function _(e){const t=(0,m.Zo)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[c,x]=j(t);return[c,x,a]}function E(e){return h.apply(this,arguments)}function h(){return(h=(0,p.A)(function*(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(yield(0,f.A)(e.url,{responseType:"blob"})).data})).apply(this,arguments)}function M(e,t){if(!e.hasPath())return null;const[a,,c]=u(e.path);return e.portalItem.resourceFromPath((0,m.fj)(a,t+c))}function L(e,t){if(!e.hasPath())return null;const[a,,c]=u(e.path);return e.portalItem.resourceFromPath((0,m.fj)(a,t+c))}},3458:(B,R,n)=>{n.d(R,{S:()=>b,r:()=>d});var p=n(10467),f=n(5922),U=n(56492),m=n(43085),I=n(57340);function d(u,_,E){return P.apply(this,arguments)}function P(){return(P=(0,p.A)(function*(u,_,E){const h=yield y(u,_,E);yield T(h,_,E)})).apply(this,arguments)}function b(u,_,E,h,M){return v.apply(this,arguments)}function v(){return(v=(0,p.A)(function*(u,_,E,h,M){const L=yield y(E,h,M);yield u.update({data:_}),yield T(L,h,M)})).apply(this,arguments)}function y(u,_,E){return A.apply(this,arguments)}function A(){return(A=(0,p.A)(function*(u,_,E){if(!_?.resources)return;const h=_.portalItem===u.portalItem?new Set(u.paths):new Set;u.paths.length=0,u.portalItem=_.portalItem;const M=new Set(_.resources.toKeep.map(i=>i.resource.path)),L=new Set,e=[];M.forEach(i=>{h.delete(i),u.paths.push(i)});const t=[],a=[],c=[];for(const i of _.resources.toUpdate)if(h.delete(i.resource.path),M.has(i.resource.path)||L.has(i.resource.path)){const{resource:O,content:r,finish:o}=i,s=(0,I.getSiblingOfSameTypeI)(O,(0,m.lk)());u.paths.push(s.path),t.push({resource:s,content:yield(0,I.contentToBlob)(r),compress:i.compress}),o&&c.push(()=>o(s))}else{u.paths.push(i.resource.path),a.push({resource:i.resource,content:yield(0,I.contentToBlob)(i.content),compress:i.compress});const O=i.finish;O&&c.push(()=>O(i.resource)),L.add(i.resource.path)}for(const i of _.resources.toAdd)if(u.paths.push(i.resource.path),h.has(i.resource.path))h.delete(i.resource.path);else{t.push({resource:i.resource,content:yield(0,I.contentToBlob)(i.content),compress:i.compress});const O=i.finish;O&&c.push(()=>O(i.resource))}if(t.length||a.length){const{addOrUpdateResources:i}=yield Promise.resolve().then(n.bind(n,57340));yield i(_.portalItem,t,"add",E),yield i(_.portalItem,a,"update",E)}if(c.forEach(i=>i()),0===e.length)return h;const x=yield(0,U.Ol)(e);if((0,U.Te)(E),x.length>0)throw new f.A("save:resources","Failed to save one or more resources",{errors:x});return h})).apply(this,arguments)}function T(u,_,E){return j.apply(this,arguments)}function j(){return(j=(0,p.A)(function*(u,_,E){if(!u||!_.portalItem)return;const h=[];for(const M of u){const L=_.portalItem.resourceFromPath(M);h.push(L.portalItem.removeResource(L,E))}yield(0,U.Lx)(h)})).apply(this,arguments)}},95945:(B,R,n)=>{n.d(R,{c:()=>d,d:()=>U});var p=n(10467),f=n(5922);function U(P){return m.apply(this,arguments)}function m(){return(m=(0,p.A)(function*(P){const b=[];for(const v of P.allLayers)if("beforeSave"in v&&"function"==typeof v.beforeSave){const y=v.beforeSave();y&&b.push(y)}yield Promise.allSettled(b)})).apply(this,arguments)}const I=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function d(P,b,v){let y=(P.messages??[]).filter(({type:A})=>"error"===A).map(({name:A,message:T,details:j})=>new f.A(A,T,j));if(P.blockedRelativeUrls&&(y=y.concat(P.blockedRelativeUrls.map(A=>new f.A("url:unsupported",`Relative url '${A}' is not supported`)))),v){const{ignoreUnsupported:A,supplementalUnsupportedErrors:T=[],requiredPropertyChecksDisabled:j}=v;A&&(y=y.filter(({name:u})=>!(I.has(u)||T.includes(u)))),j&&(y=y.filter(u=>"web-document-write:property-required"!==u.name))}if(y.length>0)throw new f.A(b.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:y})}}}]);