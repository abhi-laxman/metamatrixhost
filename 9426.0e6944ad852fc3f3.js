"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[9426],{79426:(P,c,r)=>{r.r(c),r.d(c,{default:()=>I});var u=r(10467),n=r(8189),p=r(5922),y=r(17715),h=r(48900),o=r(85211),v=(r(3248),r(35150),r(40707),r(76576)),m=r(93327),f=r(68778),C=r(43435),S=r(74238),M=r(95877);const E=t=>{let s=class extends t{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(...e){super(...e),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&"connected"===this._streamConnectionStatus?"paused":this._streamConnectionStatus}_onSuspendedChange(e){e?this._doPause():this._isUserPaused||this._doResume()}};return(0,n._)([(0,o.MZ)()],s.prototype,"_isUserPaused",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],s.prototype,"connectionStatus",null),(0,n._)([(0,o.MZ)({type:M.A})],s.prototype,"filter",void 0),s=(0,n._)([(0,v.$)("esri.views.layers.StreamLayerView")],s),s};let a=class extends(E(C.default)){constructor(){super(...arguments),this.pipelineConnectionStatus="disconnected",this.pipelineErrorString=null}initialize(){var t=this;this.addHandles([(0,h.wB)(()=>this.layer.customParameters,function(){var s=(0,u.A)(function*(e){(yield t.getWorker()).streamMessenger.updateCustomParameters(e)});return function(e){return s.apply(this,arguments)}}()),this.layer.on("send-message-to-socket",function(){var s=(0,u.A)(function*(e){(yield t.getWorker()).streamMessenger.sendMessageToSocket(e)});return function(e){return s.apply(this,arguments)}}()),this.layer.on("send-message-to-client",function(){var s=(0,u.A)(function*(e){(yield t.getWorker()).streamMessenger.sendMessageToClient(e),t._isUserPaused&&"type"in e&&"clear"===e.type&&t.incrementSourceRefreshVersion()});return function(e){return s.apply(this,arguments)}}()),(0,h.wB)(()=>this.layer.purgeOptions,()=>this._update()),(0,h.wB)(()=>this.suspended,this._onSuspendedChange.bind(this))],"constructor"),this._doResume()}destroy(){this._doPause()}get connectionError(){return this.pipelineErrorString?new p.A("stream-controller",this.pipelineErrorString):null}on(t,s){if(Array.isArray(t))return(0,y.vE)(t.map(i=>this.on(i,s)));const e=["data-received","message-received"].includes(t);e&&this.getWorker().then(i=>i.streamMessenger.enableEvent(t,!0));const l=super.on(t,s),d=this;return(0,y.hA)(()=>{l.remove(),e&&(d._workerProxy.closed||d.hasEventListener(t)||d.getWorker().then(i=>i.streamMessenger.enableEvent(t,!1)))})}queryLatestObservations(t,s){var e=this;return(0,u.A)(function*(){if(!(e.layer.timeInfo?.endField||e.layer.timeInfo?.startField||e.layer.timeInfo?.trackIdField))throw new p.A("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");const l=yield e.getWorker();return(0,S.E)(l.features.executeQueryForLatestObservations(e._cleanUpQuery(t),s).then(d=>{const i=m.A.fromJSON(d);return i.features.forEach(g=>{g.layer=e.layer,g.sourceLayer=e.layer}),i}),new m.A({features:[]}))})()}detach(){super.detach(),this.pipelineConnectionStatus="disconnected"}queryObjectIds(t,s){var e=()=>super.queryObjectIds,l=this;return(0,u.A)(function*(){return(yield e().call(l,t,s)).filter(f.Et)})()}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){null!=this._refreshInterval&&(clearInterval(this._refreshInterval),this._refreshInterval=null)}_doResume(){this._refreshInterval=setInterval(()=>this.incrementSourceRefreshVersion(),this.layer.updateInterval)}_doDisconnect(){this.getWorker().then(t=>t.streamMessenger.disconnect()),this._doPause()}_doConnect(){this.getWorker().then(t=>t.streamMessenger.connect()),this.resume()}_doClear(){this.getWorker().then(t=>t.streamMessenger.clear()),null==this._refreshInterval&&this.incrementSourceRefreshVersion()}_createClientOptions(){const t=super._createClientOptions(),s=this;return{...t,get container(){return s.featureContainer},setProperty:e=>{this.set(e.propertyName,e.value)}}}};(0,n._)([(0,o.MZ)()],a.prototype,"pipelineConnectionStatus",void 0),(0,n._)([(0,o.MZ)()],a.prototype,"pipelineErrorString",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],a.prototype,"connectionError",null),(0,n._)([(0,o.MZ)({readOnly:!0})],a.prototype,"_streamConnectionStatus",null),a=(0,n._)([(0,v.$)("esri.views.2d.layers.StreamLayerView2D")],a);const I=a}}]);