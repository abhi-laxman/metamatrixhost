"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[5940],{35940:(z,Z,i)=>{i.r(Z),i.d(Z,{default:()=>_e});var u=i(10467),o=i(8189),R=i(92165),J=i(89563),G=i(90660),A=i(31178),y=i(5922),m=i(77806),v=i(35150),g=i(11432),I=i(39693),O=i(89221),N=i(56492),X=i(63484),V=i(45272),l=i(85211),P=i(48669),c=i(17221),w=i(76576),$=i(50305),T=i(50501),H=i(8297),Y=i(32034),C=i(95478),L=i(81098),q=i(3248),k=i(55098),B=i(64261),he=i(19284),fe=i(55739),me=(i(40707),i(69039)),ve=i(28067),ge=i(55861),oe=i(6434),be=i(28872),se=i(98789),ae=i(93327);let Te=0,j=class extends(k.A.LoadableMixin(B.A.EsriPromiseMixin(A.A))){constructor(t){super(t),this._idToClientGraphic=null,this.type="memory"}load(t){return this.addResolvingPromise(this._startWorker(null!=t?t.signal:null)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const t=this.layer?.geometryType;return t?this._geometryTypeRequiresClientGraphicMapping(t)?"polygon":t:null}applyEdits(t){return this.load().then(()=>this._applyEdits(t))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(t,e={}){var r=this;return(0,u.A)(function*(){yield r.load(e);const n=yield r._connection.invoke("queryFeatures",t?t.toJSON():null,e);(0,se.q)(t,r.layer.spatialReference,n);const s=ae.A.fromJSON(n);if(!r._requiresClientGraphicMapping())return s;const d=r.layer.objectIdField;for(const p of s.features){const E=r._idToClientGraphic.get(p.attributes[d]);E&&(p.geometry=E.geometry)}return s.geometryType=r.layer.geometryType,s})()}queryFeaturesJSON(t,e={}){var r=this;return(0,u.A)(function*(){if(r._requiresClientGraphicMapping())throw new y.A("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");yield r.load(e);const n=yield r._connection.invoke("queryFeatures",t?t.toJSON():null,e);return(0,se.q)(t,r.layer.spatialReference,n),n})()}queryFeatureCount(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryFeatureCount",t?t.toJSON():null,e))}queryObjectIds(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryObjectIds",t?t.toJSON():null,e))}queryExtent(t,e={}){return this.load(e).then(()=>this._connection.invoke("queryExtent",t?t.toJSON():null,e)).then(r=>({count:r.count,extent:ve.A.fromJSON(r.extent)}))}querySnapping(t,e={}){return this.load(e).then(()=>this._connection.invoke("querySnapping",t,e))}queryAttributeBins(t,e={}){var r=this;return(0,u.A)(function*(){return yield r.load(),r._connection.invoke("queryAttributeBins",t?.toJSON(),e)})()}_applyEdits(t){var e=this;return(0,u.A)(function*(){if(!e._connection)throw new y.A("feature-layer-source:edit-failure","Memory source not loaded");const r=e.layer.objectIdField;let n=null;const s=[],d=[];yield Promise.all([e._prepareClientMapping(t.addFeatures,null),e._prepareClientMapping(t.updateFeatures,null)]);const p=b=>"objectId"in b&&null!=b.objectId?b.objectId:"attributes"in b&&null!=b.attributes[r]?b.attributes[r]:null;if(t.addFeatures&&(n=e._prepareAddFeatures(t.addFeatures)),t.deleteFeatures)for(const b of t.deleteFeatures){const D=p(b);null!=D&&s.push(D)}const f=t.updateFeatures&&e._idToClientGraphic?new Map:null;if(t.updateFeatures)for(const b of t.updateFeatures)if(d.push(e._serializeFeature(b)),f){const D=p(b);null!=D&&f.set(D,b)}(0,be.u)(n?n.features:null,d,e.layer.spatialReference);const{fullExtent:E,featureEditResults:M}=yield e._connection.invoke("applyEdits",{adds:n?n.features:[],updates:d,deletes:s});return e.fullExtent=E,n&&n.finish(M.uidToObjectId),e._updateClientGraphicIds(f,M),e._createEditsResult(M)})()}_prepareClientMapping(t,e){var r=this;return(0,u.A)(function*(){if("mesh"!==r._layerOrSourceGeometryType||null==t)return;const n=[];for(const{geometry:s}of t)null==s||"mesh"!==s.type||s.hasExtent||s.loaded||n.push(s.load({signal:e}));n.length&&(yield Promise.all(n))})()}_updateClientGraphicIds(t,e){if(this._idToClientGraphic){if(t)for(const r of e.updateResults){if(!r.success)continue;const n=t.get(r.objectId);null!=n&&this._addIdToClientGraphic(n)}for(const r of e.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(t){return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(t){const e=!0===t.success?null:t.error||{code:void 0,description:void 0};return{objectId:t.objectId,globalId:t.globalId,error:e?new y.A("feature-layer-source:edit-failure",e.description,{code:e.code}):null}}_prepareAddFeatures(t){const e=new Map,r=new Array(t.length);let n=null;for(let d=0;d<t.length;d++){const p=t[d],f=this._serializeFeature(p);n||null==p.geometry||(n=p.geometry.type),r[d]=f,e.set(`${f.uid}`,p)}const s=this;return{features:r,inferredGeometryType:n,finish(d){const p=s.sourceJSON.objectIdField;for(const f in d){const E=d[f],M=e.get(f);M&&(M.attributes||(M.attributes={}),-1===E?delete M.attributes[p]:M.attributes[p]=E,s._addIdToClientGraphic(M))}}}}_addIdToClientGraphic(t){if(!this._idToClientGraphic)return;const e=this.sourceJSON.objectIdField,r=t.attributes?.[e];null!=r&&this._idToClientGraphic.set(r,t)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(t){return this._geometryTypeRequiresClientGraphicMapping(t.type)}_geometryTypeRequiresClientGraphicMapping(t){return"mesh"===t||"multipatch"===t||"extent"===t}_serializeFeature(t){const{attributes:e}=t,r=this._geometryForSerialization(t),n=(Te++).toString();return r?{uid:n,geometry:r.toJSON(),attributes:e}:{uid:n,attributes:e}}_geometryForSerialization(t){const{geometry:e}=t;return null==e?null:this._geometryRequiresClientGraphicMapping(e)?e.extent?ge.A.fromExtent(e.extent):null:e}_startWorker(t){var e=this;return(0,u.A)(function*(){e._connection=yield(0,he.ho)("MemorySourceWorker",{strategy:(0,q.A)("feature-layers-workers")?"dedicated":"local",signal:t,registryTarget:e});const{fields:r,spatialReference:n,objectIdField:s,hasM:d,hasZ:p,timeInfo:f,dateFieldsTimeZone:E}=e.layer,M="defaults"===e.layer.originOf("spatialReference");yield e._prepareClientMapping(e.items,t);const b=e._prepareAddFeatures(e.items);e.addHandles(e.on("before-changes",U=>{v.A.getLogger(e).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),U.preventDefault()}));const D={features:b.features,fields:r?.map(U=>U.toJSON()),geometryType:oe.Ye.toJSON(e._workerGeometryType),hasM:"mesh"!==e._layerOrSourceGeometryType&&d,hasZ:"mesh"===e._layerOrSourceGeometryType||p,objectIdField:s,spatialReference:M?null:n&&n.toJSON(),timeInfo:f?.toJSON()??null,dateFieldsTimeZone:E},S=yield e._connection.invoke("load",D,{signal:t});for(const U of S.warnings)v.A.getLogger(e.layer).warn("#load()",`${U.message} (title: '${e.layer.title||"no title"}', id: '${e.layer.id??"no id"}')`,{warning:U});S.featureErrors.length&&v.A.getLogger(e.layer).warn("#load()",`Encountered ${S.featureErrors.length} validation errors while loading features. (title: '${e.layer.title||"no title"}', id: '${e.layer.id??"no id"}')`,{errors:S.featureErrors});const ne=S.layerDefinition;e._geometryTypeRequiresClientGraphicMapping(b.inferredGeometryType)&&(ne.geometryType=oe.Ye.toJSON(b.inferredGeometryType)),e.sourceJSON=ne,e._requiresClientGraphicMapping()&&(e._idToClientGraphic=new Map),b.finish(S.assignedObjectIds)})()}};(0,o._)([(0,me.u)({Type:L.A,ensureType:(0,fe.dp)(L.A)})],j.prototype,"itemType",void 0),(0,o._)([(0,l.MZ)()],j.prototype,"type",void 0),(0,o._)([(0,l.MZ)({constructOnly:!0})],j.prototype,"layer",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],j.prototype,"_workerGeometryType",null),(0,o._)([(0,l.MZ)()],j.prototype,"sourceJSON",void 0),j=(0,o._)([(0,w.$)("esri.layers.graphics.sources.MemorySource")],j);var Fe=i(94376),Me=i(25936),Ae=i(93410),Se=i(23e3),Ie=i(73955),Ee=i(58277),De=i(31446),Oe=i(29674),Ce=i(25263),Le=i(17049),je=i(43124),Ze=i(85551),Pe=i(98877);let K=class extends Pe.A{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};(0,o._)([(0,l.MZ)()],K.prototype,"updating",void 0),(0,o._)([(0,l.MZ)()],K.prototype,"status",void 0),K=(0,o._)([(0,w.$)("esri.layers.support.PublishingInfo")],K);const we=K,le=Symbol(),xe=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const n=this._get("publishingInfo");if(n)return n;const s=new we;return this._checkPublishingStatus(s),s}_checkPublishingStatus(n){var s=this;let f=0;const E=function(){var b=(0,u.A)(function*(D){let S;n.updating=!0;try{S=yield s.fetchPublishingStatus()}catch{S="unavailable"}"published"!==S&&"unavailable"!==S||("publishing"===n.status&&s.refresh(),M.remove()),n.status=S,n.updating=!1,M.removed||(f=setTimeout(E,D,D+125))});return function(S){return b.apply(this,arguments)}}(),M={removed:!1,remove(){this.removed=!0,clearTimeout(f)}};this.when().catch(()=>M.remove()),E(250),this.addHandles(M)}};return e=le,(0,o._)([(0,l.MZ)({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=(0,o._)([(0,w.$)("esri.layers.mixins.PublishableLayer")],r),r};var Re=i(1151),Ge=i(33036),Je=i(84311),Ne=i(77486),_=i(68438),x=i(22329),h=i(47516),ue=i(69741),de=i(47063),Ue=i(3404),ee=i(86300),Ve=i(54947),te=i(73975),$e=i(90543),Be=i(38488),Ke=i(85791),We=i(5540),Qe=i(93164),ze=i(85718),Xe=i(8691),ye=i(31595),He=i(87086),pe=i(68778),Ye=i(41843),qe=i(94048),W=i(71655),ke=i(46873);const F="FeatureLayer";function Q(t,e){return new y.A("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function ce(t){return t&&t instanceof A.A}const re=(0,Ue.p)();function ie(t,e,r){const n=!!r?.writeLayerSchema;return{enabled:n,ignoreOrigin:n}}let a=class extends((0,Oe.j)((0,Ce.J)((0,De.F)(xe((0,Ee.w6)((0,Ie.FJ)((0,Ae.dM)((0,je.fY)((0,Je.e)((0,Ne.d)((0,Ge.j)((0,Re.J)((0,Me.b)((0,Le.q)((0,Ze.A)((0,I.P)((0,Se.d)((0,Fe.p)(G.A.ClonableMixin(C.A)))))))))))))))))))){constructor(...t){var e;super(...t),e=this,this.attributeTableTemplate=null,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="ArcGISFeatureLayer",this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Y.A.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=(0,N.sg)(function(){var r=(0,u.A)(function*(n,s,d){const{save:p,saveAs:f}=yield Promise.all([i.e(639),i.e(2076)]).then(i.bind(i,90639));switch(n){case W.X.SAVE:return p(e,s);case W.X.SAVE_AS:return f(e,d,s)}});return function(n,s,d){return r.apply(this,arguments)}}())}destroy(){this.source?.destroy()}normalizeCtorArgs(t,e){return"string"==typeof t?{url:t,...e}:t}load(t){var e=this;const r=null!=t?t.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const n=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(N.QP).then((0,u.A)(function*(){if(e.url&&null==e.layerId&&/FeatureServer|MapServer\/*$/i.test(e.url)){const s=yield e._fetchFirstValidLayerId(r);null!=s&&(e.layerId=s)}if(!e.url&&!e._hasMemorySource())throw new y.A("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return e.initLayerProperties(yield e.createGraphicsSource(r))})).then(()=>(0,h.VA)(this,"load",t));return this.addResolvingPromise(n),Promise.resolve(this)}get _titleCreator(){const t=this._get("_titleCreator");return(0,g.pR)(t),new Ke.A({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,fields:this.fields,displayField:this.displayField,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}readCapabilities(t,e){return(0,$e.S)(e=e.layerDefinition||e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,r){return this._readEditingEnabled(e,!0,r)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,r,n){this._writeEditingEnabled(t,e,!0,n)}get effectiveEditingEnabled(){return(0,h.C$)(this)}get featureTitleFields(){return[...this._titleCreator.requiredFields]}readIsTable(t,e){return"Table"===(e=e?.layerDefinition??e).type||!e.geometryType}writeIsTable(t,e,r,n){n?.writeLayerSchema&&(0,O.sM)(r,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return(0,h.jD)(e.layerDefinition||e)}readObjectIdField(t,e){return(0,h.Zm)(e.layerDefinition||e)}get parsedUrl(){const t=(0,V.An)(this.url);return null!=t&&(null!=this.dynamicDataSource?t.path=(0,V.fj)(t.path,"dynamicLayer"):null!=this.layerId&&(t.path=(0,V.fj)(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){(0,ee.yp)(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,r){e=e.layerDefinition||e;const n=e.drawingInfo?.renderer;if(n){const s=(0,ze.L)(n,e,r)??void 0;return s||v.A.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:r}),s}return(0,h.PD)(e,r)}set source(t){const e=this._get("source");e!==t&&(ce(e)&&this._resetMemorySource(e),ce(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof A.A?new j({layer:this,items:t}):t:null}readSource(t,e){const r=ae.A.fromJSON(e.featureSet);return new j({layer:this,items:r?.features??[]})}readTemplates(t,e){const r=e.editFieldsInfo,n=r?.creatorField,s=r?.editorField;return t=t?.map(d=>ue.A.fromJSON(d)),this._fixTemplates(t,n),this._fixTemplates(t,s),t}readTitle(t,e){const r=e.layerDefinition?.name??e.name,n=e.title||e.layerDefinition?.title;if(r){const s=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,_.yG)(this.url,r):r;let d=r;if(!d&&this.url){const p=(0,_.qg)(this.url);null!=p&&(d=p.title)}return d?("item-title-and-service-name"===this.sublayerTitleMode&&s&&s!==d&&(d=s+" - "+d),(0,_.cr)(d)):void 0}if("item-title"===this.sublayerTitleMode&&n)return n}readTitleFromWebMap(t,e){return e.title||e.layerDefinition?.name}readTypeIdField(t,e){let r=(e=e.layerDefinition||e).typeIdField;if(r&&e.fields){r=r.toLowerCase();const n=e.fields.find(s=>s.name.toLowerCase()===r);n&&(r=n.name)}return r}readTypes(t,e){t=(e=e.layerDefinition||e).types;const r=e.editFieldsInfo,n=r?.creatorField,s=r?.editorField;return t?.map(d=>(d=de.A.fromJSON(d),this._fixTemplates(d.templates,n),this._fixTemplates(d.templates,s),d))}readVisible(t,e){return null!=e.layerDefinition?.defaultVisibility?!!e.layerDefinition.defaultVisibility:null!=e.visibility?!!e.visibility:void 0}addAttachment(t,e){var r=this;return(0,u.A)(function*(){const n=yield(0,h.Xl)(r,t,e,F);return r.lastEditsEventDate=new Date,n})()}updateAttachment(t,e,r){var n=this;return(0,u.A)(function*(){const s=yield(0,h.bt)(n,t,e,r,F);return n.lastEditsEventDate=new Date,s})()}applyEdits(t,e){var r=this;return(0,u.A)(function*(){return(0,h.ct)(r,t,e)})()}uploadAssets(t,e){var r=this;return(0,u.A)(function*(){return(0,h.rn)(r,t,e)})()}on(t,e){return super.on(t,e)}createPopupTemplate(t){return(0,Ye.tn)(this,t)}createGraphicsSource(t){var e=this;return(0,u.A)(function*(){if(e._hasMemorySource()&&e.source)return e.source.load({signal:t});const{default:r}=yield(0,N.qr)(Promise.all([i.e(1732),i.e(8304),i.e(5931),i.e(8294)]).then(i.bind(i,28570)),t);return new r({layer:e,supportedSourceTypes:e.supportedSourceTypes}).load({signal:t})})()}createQuery(){const t=(0,h.VZ)(this);t.dynamicDataSource=this.dynamicDataSource;const r=(0,X.mA)(this.definitionExpression,null!=this.subtypeCode?`${this.subtypeField} = ${this.subtypeCode}`:null);return t.where=r||"1=1",t}deleteAttachments(t,e){var r=this;return(0,u.A)(function*(){const n=yield(0,h.mm)(r,t,e,F);return r.lastEditsEventDate=new Date,n})()}fetchRecomputedExtents(t){var e=this;return(0,u.A)(function*(){return(0,h.WP)(e,t,F)})()}getFeatureTitle(t,e={timeZone:"system",fetchMissingFields:!1}){return this._titleCreator.getTitle(this,t,e)}getFeatureType(t){return(0,h.xd)(this.types,this.typeIdField,t)}getFieldDomain(t,e){return(0,h.Vq)(this,t,e,this.getField(t)?.domain??null)}queryAttachments(t,e){var r=this;return(0,u.A)(function*(){return(0,h.lV)(r,t,e,F)})()}queryFeatures(t,e){var r=this;return(0,u.A)(function*(){const n=yield r.load(),s=yield n.source.queryFeatures(He.A.from(t)??n.createQuery(),e);if(s?.features)for(const d of s.features)d.layer=d.sourceLayer=n;return s})()}queryObjectIds(t,e){var r=this;return(0,u.A)(function*(){return(yield(0,h.sg)(r,t,e,F)).filter(pe.Et)})()}queryFeatureCount(t,e){var r=this;return(0,u.A)(function*(){return(0,h.Ye)(r,t,e,F)})()}queryExtent(t,e){var r=this;return(0,u.A)(function*(){return(0,h.B5)(r,t,e,F)})()}queryRelatedFeatures(t,e){var r=this;return(0,u.A)(function*(){return(0,h.hM)(r,t,e,F)})()}queryRelatedFeaturesCount(t,e){var r=this;return(0,u.A)(function*(){return(0,h.S2)(r,t,e,F)})()}queryTopFeatures(t,e){var r=this;return(0,u.A)(function*(){const{source:n,capabilities:s}=yield r.load();if(!n.queryTopFeatures||!s?.query?.supportsTopFeaturesQuery)throw new y.A(F,"Layer source does not support queryTopFeatures capability");const d=yield i.e(2076).then(i.bind(i,61569)),p=yield n.queryTopFeatures(d.default.from(t),e);if(p?.features)for(const f of p.features)f.layer=f.sourceLayer=r;return p})()}queryAttributeBins(t,e){var r=this;return(0,u.A)(function*(){const{source:n,capabilities:s}=yield r.load();if(!n.queryAttributeBins||!s?.operations?.supportsQueryBins)throw new y.A(F,"Layer source does not support queryAttributeBins capability");(0,h.ZJ)(t,s,F);const d=yield i.e(5423).then(i.bind(i,85423)),p=yield n.queryAttributeBins(d.default.from(t),e);if(p.features)for(const f of p.features)f.layer=f.sourceLayer=r;return p})()}queryTopObjectIds(t,e){var r=this;return(0,u.A)(function*(){const{source:n,capabilities:s}=yield r.load();if(!n.queryTopObjectIds||!s?.query.supportsTopFeaturesQuery)throw new y.A(F,"Layer source does not support queryTopObjectIds capability");const d=yield i.e(2076).then(i.bind(i,61569));return(yield n.queryTopObjectIds(d.default.from(t),e)).filter(pe.Et)})()}queryTopFeaturesExtent(t,e){var r=this;return(0,u.A)(function*(){const{source:n,capabilities:s}=yield r.load();if(!n.queryTopExtents||!s?.query?.supportsTopFeaturesQuery)throw new y.A(F,"Layer source does not support queryTopExtents capability");const d=yield i.e(2076).then(i.bind(i,61569));return n.queryTopExtents(d.default.from(t),e)})()}queryTopFeatureCount(t,e){var r=this;return(0,u.A)(function*(){const{source:n,capabilities:s}=yield r.load();if(!n.queryTopCount||!s?.query?.supportsTopFeaturesQuery)throw new y.A(F,"Layer source does not support queryFeatureCount capability");const d=yield i.e(2076).then(i.bind(i,61569));return n.queryTopCount(d.default.from(t),e)})()}read(t,e){const r=t.featureCollection;if((r||"Feature Collection"===t.type)&&(this.resourceInfo=t),r){const n=r.layers;n&&1===n.length&&(super.read(n[0],e),null!=r.showLegend&&super.read({showLegend:r.showLegend},e))}super.read(t,e),e&&"service"===e.origin&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:e?.origin??void 0,writeLayerSchema:e?.writeLayerSchema??this._hasMemorySource()};const{origin:r,layerContainerType:n,messages:s}=e;if(this.dynamicDataSource)return s?.push(Q(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(("web-map"===r||"web-scene"===r)&&"tables"!==n)return s?.push(Q(this,`a table source can only be written to tables, not ${n}`)),null;if(this._hasMemorySource())return s?.push(Q(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&("web-map"===r||"web-scene"===r)&&"tables"===n)return s?.push(Q(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new y.A(F,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){return!!this.loaded&&("memory"===this.source?.type||(0,We.D)(this,t))}save(t){var e=this;return(0,u.A)(function*(){return e._debouncedSaveOperations(W.X.SAVE,t)})()}saveAs(t,e){var r=this;return(0,u.A)(function*(){return r._debouncedSaveOperations(W.X.SAVE_AS,e,t)})()}_readEditingEnabled(t,e,r){let n=t.layerDefinition?.capabilities;return n?this._hasEditingCapability(n):(n=t.capabilities,e&&"web-map"===r?.origin&&!this._hasMemorySource()&&n?this._hasEditingCapability(n):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,r,n){if(!t){const s=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";(0,O.sM)("layerDefinition.capabilities",s,e),r&&!n?.writeLayerSchema&&(e.capabilities=s)}}_fetchFirstValidLayerId(t){return(0,J.A)(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const r=e.data;if(r)return this.findFirstValidLayerId(r)})}initLayerProperties(t){var e=this;return(0,u.A)(function*(){return e._set("source",t),t.sourceJSON&&(e.sourceJSON=t.sourceJSON,e.read(t.sourceJSON,{origin:"service",portalItem:e.portalItem,portal:e.portalItem?.portal,url:e.parsedUrl})),e._verifySource(),e._verifyFields(),(0,ee.yp)(e.renderer,e.fieldsIndex),(0,ee.sv)(e.timeInfo,e.fieldsIndex),e._hasMemorySource()&&"mesh"===e.geometryType&&(e.capabilities.query.supportsReturnMesh=!0),(0,Xe.L)(e,{origin:"service"})})()}hasDataChanged(){var t=this;return(0,u.A)(function*(){return(0,h.jp)(t)})()}fetchPublishingStatus(){var t=this;return(0,u.A)(function*(){const e=t.source;return e?.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"})()}_verifyFields(){const t=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||-1!==t.search(/\/FeatureServer\//i)||this.fields?.some(e=>"geometry"===e.type)||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(r=>{const n=r.prototype?.attributes;n&&e&&delete n[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new y.A("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new y.A("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};(0,o._)([(0,l.MZ)({clonable:!1,readOnly:!0})],a.prototype,"_titleCreator",null),(0,o._)([(0,l.MZ)(x.zQ)],a.prototype,"attributeTableTemplate",void 0),(0,o._)([(0,c.w)("service","capabilities")],a.prototype,"readCapabilities",null),(0,o._)([(0,l.MZ)({json:{origins:{"web-scene":{write:!1}},write:!0}})],a.prototype,"charts",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],a.prototype,"createQueryVersion",null),(0,o._)([(0,l.MZ)({json:{read:{source:"layerDefinition.copyrightText"}}})],a.prototype,"copyright",void 0),(0,o._)([(0,l.MZ)({json:{read:{source:"layerDefinition.displayField"}}})],a.prototype,"displayField",void 0),(0,o._)([(0,l.MZ)({types:qe.Es,readOnly:!0})],a.prototype,"defaultSymbol",void 0),(0,o._)([(0,l.MZ)({type:Qe.L})],a.prototype,"dynamicDataSource",void 0),(0,o._)([(0,l.MZ)({type:Boolean})],a.prototype,"editingEnabled",null),(0,o._)([(0,c.w)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],a.prototype,"readEditingEnabled",null),(0,o._)([(0,c.w)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],a.prototype,"readEditingEnabledFromWebMap",null),(0,o._)([(0,$.K)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],a.prototype,"writeEditingEnabled",null),(0,o._)([(0,$.K)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],a.prototype,"writeEditingEnabledToWebMap",null),(0,o._)([(0,l.MZ)({readOnly:!0})],a.prototype,"effectiveEditingEnabled",null),(0,o._)([(0,l.MZ)({clonable:!1,readOnly:!0})],a.prototype,"featureTitleFields",null),(0,o._)([(0,l.MZ)({...re.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:ie}}}}})],a.prototype,"fields",void 0),(0,o._)([(0,l.MZ)(re.fieldsIndex)],a.prototype,"fieldsIndex",void 0),(0,o._)([(0,l.MZ)({type:H.A,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"formTemplate",void 0),(0,o._)([(0,l.MZ)({json:{read:{source:"layerDefinition.extent"}}})],a.prototype,"fullExtent",void 0),(0,o._)([(0,l.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:ie,writer(t,e,r){const n=t?h.iX.toJSON(t):null;n&&(0,O.sM)(r,n,e)}}}},read:{source:"layerDefinition.geometryType",reader:h.iX.read}}})],a.prototype,"geometryType",void 0),(0,o._)([(0,l.MZ)({json:{read:{source:"layerDefinition.hasM"}}})],a.prototype,"hasM",void 0),(0,o._)([(0,l.MZ)({json:{read:{source:"layerDefinition.hasZ"}}})],a.prototype,"hasZ",void 0),(0,o._)([(0,l.MZ)(x.id)],a.prototype,"id",void 0),(0,o._)([(0,l.MZ)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],a.prototype,"infoFor3D",void 0),(0,o._)([(0,l.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],a.prototype,"isTable",void 0),(0,o._)([(0,c.w)("service","isTable",["type","geometryType"]),(0,c.w)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],a.prototype,"readIsTable",null),(0,o._)([(0,$.K)("web-map","isTable")],a.prototype,"writeIsTable",null),(0,o._)([(0,l.MZ)(x.kF)],a.prototype,"labelsVisible",void 0),(0,o._)([(0,l.MZ)({type:[Ve.A],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:te.w,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:te.w,write:{enabled:!0,layerContainerTypes:T.K}}},name:"layerDefinition.drawingInfo.labelingInfo",read:te.w,write:!0}})],a.prototype,"labelingInfo",void 0),(0,o._)([(0,l.MZ)((()=>{const t=(0,m.o8)(x.Ih);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,n){(0,O.sM)(n,(0,ke.p)(e),r)}}},t})())],a.prototype,"opacity",void 0),(0,o._)([(0,l.MZ)(x.fV)],a.prototype,"legendEnabled",void 0),(0,o._)([(0,l.MZ)({type:["show","hide"],json:(()=>{const t=(0,m.o8)(x.C1.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],a.prototype,"listMode",void 0),(0,o._)([(0,c.w)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],a.prototype,"readGlobalIdField",null),(0,o._)([(0,l.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:ie}}}}})],a.prototype,"objectIdField",void 0),(0,o._)([(0,c.w)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],a.prototype,"readObjectIdField",null),(0,o._)([(0,l.MZ)({type:["ArcGISFeatureLayer"],json:{write:{target:"layerType",ignoreOrigin:!0,layerContainerTypes:T.K}}})],a.prototype,"operationalLayerType",void 0),(0,o._)([(0,l.MZ)(re.outFields)],a.prototype,"outFields",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],a.prototype,"parsedUrl",null),(0,o._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],a.prototype,"path",void 0),(0,o._)([(0,l.MZ)(x.M6)],a.prototype,"popupEnabled",void 0),(0,o._)([(0,l.MZ)({type:R.A,json:{name:"popupInfo",write:!0}})],a.prototype,"popupTemplate",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],a.prototype,"defaultPopupTemplate",null),(0,o._)([(0,l.MZ)({types:ye.Hg,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:ye.XJ,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:T.K,overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r?.writeLayerSchema})}}})],a.prototype,"renderer",null),(0,o._)([(0,c.w)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,c.w)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],a.prototype,"readRenderer",null),(0,o._)([(0,l.MZ)()],a.prototype,"resourceInfo",void 0),(0,o._)([(0,l.MZ)((()=>{const t=(0,m.o8)(x.PY);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],a.prototype,"screenSizePerspectiveEnabled",void 0),(0,o._)([(0,l.MZ)({clonable:!1})],a.prototype,"source",null),(0,o._)([(0,P.w)("source")],a.prototype,"castSource",null),(0,o._)([(0,c.w)("portal-item","source",["featureSet"]),(0,c.w)("web-map","source",["featureSet"])],a.prototype,"readSource",null),(0,o._)([(0,l.MZ)({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],a.prototype,"spatialReference",void 0),(0,o._)([(0,l.MZ)({type:Number})],a.prototype,"subtypeCode",void 0),(0,o._)([(0,l.MZ)({type:[ue.A]})],a.prototype,"templates",void 0),(0,o._)([(0,c.w)("templates",["editFieldsInfo","creatorField","editorField","templates"])],a.prototype,"readTemplates",null),(0,o._)([(0,l.MZ)({type:Be.A})],a.prototype,"timeInfo",void 0),(0,o._)([(0,l.MZ)()],a.prototype,"title",void 0),(0,o._)([(0,c.w)("service","title",["name"]),(0,c.w)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],a.prototype,"readTitle",null),(0,o._)([(0,c.w)("web-map","title",["layerDefinition.name","title"])],a.prototype,"readTitleFromWebMap",null),(0,o._)([(0,l.MZ)({type:String})],a.prototype,"sublayerTitleMode",void 0),(0,o._)([(0,l.MZ)({json:{read:!1}})],a.prototype,"type",void 0),(0,o._)([(0,l.MZ)({type:String})],a.prototype,"typeIdField",void 0),(0,o._)([(0,c.w)("service","typeIdField"),(0,c.w)("typeIdField",["layerDefinition.typeIdField"])],a.prototype,"readTypeIdField",null),(0,o._)([(0,l.MZ)({type:[de.A]})],a.prototype,"types",void 0),(0,o._)([(0,c.w)("service","types",["types"]),(0,c.w)("types",["layerDefinition.types"])],a.prototype,"readTypes",null),(0,o._)([(0,l.MZ)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],a.prototype,"visible",void 0),(0,o._)([(0,c.w)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],a.prototype,"readVisible",null),a=(0,o._)([(0,w.$)("esri.layers.FeatureLayer")],a);const _e=a},77486:(z,Z,i)=>{i.d(Z,{d:()=>Y});var u=i(8189),o=i(85211),A=(i(3248),i(35150),i(40707),i(76576)),y=i(92165),m=i(90660),v=i(71065),g=i(89221),I=i(50305),O=i(2052),N=i(22329),X=i(54947),V=i(31595);let l=class extends(m.A.ClonableMixin(v.A)){constructor(C){super(C),this.labelingInfo=null,this.labelsVisible=!0,this.renderer=null,this.visible=!0}};(0,u._)([(0,o.MZ)({type:[X.A],json:{write:!0}})],l.prototype,"labelingInfo",void 0),(0,u._)([(0,o.MZ)(N.kF)],l.prototype,"labelsVisible",void 0),(0,u._)([(0,o.MZ)({types:V.Hg,json:{write:!0}})],l.prototype,"renderer",void 0),(0,u._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],l.prototype,"visible",void 0),l=(0,u._)([(0,A.$)("esri.layers.support.TrackPartInfo")],l);const P=l;var c=i(73747),w=i(91644),$=i(89352);let T=class extends(m.A.ClonableMixin(v.A)){constructor(C){super(C),this.enabled=!0,this.fields=[],this.latestObservations=new P({renderer:new c.A({symbol:w.UK.clone()})}),this.maxDisplayDuration=null,this.maxDisplayObservationsPerTrack=0,this.popupEnabled=!0,this.popupTemplate=null,this.previousObservations=new P({renderer:new c.A({symbol:w.UK.clone()})}),this.trackLines=new P({renderer:new c.A({symbol:w.A7.clone()})}),this.timeField="startTimeField"}writeFields(C,L,q){const k=C.filter(B=>"avg_angle"!==B.statisticType).map(B=>B.toJSON());(0,g.sM)(q,k,L)}};(0,u._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],T.prototype,"enabled",void 0),(0,u._)([(0,o.MZ)({type:[O.A],json:{write:!0}})],T.prototype,"fields",void 0),(0,u._)([(0,I.K)("fields")],T.prototype,"writeFields",null),(0,u._)([(0,o.MZ)({type:P,json:{write:!0}})],T.prototype,"latestObservations",void 0),(0,u._)([(0,o.MZ)({type:$.A,json:{write:!0}})],T.prototype,"maxDisplayDuration",void 0),(0,u._)([(0,o.MZ)({type:Number,json:{write:!0}})],T.prototype,"maxDisplayObservationsPerTrack",void 0),(0,u._)([(0,o.MZ)(N.M6)],T.prototype,"popupEnabled",void 0),(0,u._)([(0,o.MZ)({type:y.A,json:{name:"popupInfo",write:!0}})],T.prototype,"popupTemplate",void 0),(0,u._)([(0,o.MZ)({type:P,json:{write:!0}})],T.prototype,"previousObservations",void 0),(0,u._)([(0,o.MZ)({type:P,json:{write:!0}})],T.prototype,"trackLines",void 0),(0,u._)([(0,o.MZ)({type:["timeReceived","startTimeField","endTimeField"],json:{read:!0,write:!0}})],T.prototype,"timeField",void 0),T=(0,u._)([(0,A.$)("esri.layers.support.TrackInfo")],T);const H=T,Y=C=>{let L=class extends C{constructor(){super(...arguments),this.trackInfo=null}};return(0,u._)([(0,o.MZ)({type:H})],L.prototype,"trackInfo",void 0),L=(0,u._)([(0,A.$)("esri.layers.mixins.TrackableLayer")],L),L}},8691:(z,Z,i)=>{i.d(Z,{L:()=>G});var u=i(10467),o=i(89447),R=i(56492),J=i(96996);function G(y,m,v){return A.apply(this,arguments)}function A(){return(A=(0,u.A)(function*(y,m,v){const g=y&&y.getAtOrigin&&y.getAtOrigin("renderer",m.origin);if(g&&"unique-value"===g.type&&g.styleOrigin){const I=yield(0,o.Ke)(g.populateFromStyle());if((0,R.Te)(v),!1===I.ok){const O=I.error;m?.messages&&m.messages.push(new J.A("renderer:style-reference",`Failed to create unique value renderer from style reference: ${O.message}`,{error:O,context:m})),y.clear("renderer",m?.origin)}}})).apply(this,arguments)}},28872:(z,Z,i)=>{i.d(Z,{u:()=>J});var u=i(82663),o=i(58701);function R(y,m,v){if(null==y.hasM||y.hasZ)for(const g of m)for(const I of g)I.length>2&&(I[2]*=v)}function J(y,m,v){if(!y&&!m||!v)return;const g=(0,u.G9)(v);G(y,v,g),G(m,v,g)}function G(y,m,v){if(y)for(const g of y)A(g.geometry,m,v)}function A(y,m,v){if(!y?.spatialReference||(0,o.aI)(y.spatialReference,m))return;const g=(0,u.G9)(y.spatialReference)/v;if(1!==g)if("x"in y)null!=y.z&&(y.z*=g);else if("rings"in y)R(y,y.rings,g);else if("paths"in y)R(y,y.paths,g);else if("points"in y&&(null==y.hasM||y.hasZ))for(const I of y.points)I.length>2&&(I[2]*=g)}}}]);