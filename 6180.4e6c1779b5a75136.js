"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[6180],{61597:(S,I,_)=>{_.d(I,{v:()=>L});var d=_(10467),v=_(56151);class L{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}fetchServiceMetadata(g,m){var p=this;return(0,d.A)(function*(){const o=p._serviceMetadatas.get(g);if(o)return o;const P=yield(0,v.V)(g,m);return p._serviceMetadatas.set(g,P),P})()}fetchItemData(g){var m=this;return(0,d.A)(function*(){const{id:p}=g;if(!p)return null;const{_itemDatas:o}=m;if(o.has(p))return o.get(p);const P=yield g.fetchData();return o.set(p,P),P})()}fetchCustomParameters(g,m){var p=this;return(0,d.A)(function*(){const o=yield p.fetchItemData(g);return o&&"object"==typeof o&&(m?m(o):o.customParameters)||null})()}}},15764:(S,I,_)=>{_.d(I,{m:()=>A,v:()=>L});var d=_(45272),v=_(73874);function L(m,p){return{...g(m,p),readResourcePaths:[]}}function A(m,p,o){const P=(0,d.An)(m.itemUrl);return{...g(m,p),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:P?{rootPath:P.path,writtenUrls:[]}:null,resources:o?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function g(m,p){return{origin:p,url:(0,d.An)(m.itemUrl),portal:m.portal||v.A.getDefault(),portalItem:m}}},56180:(S,I,_)=>{_.r(I),_.d(I,{load:()=>x});var d=_(10467),v=_(5922),L=_(68438),A=_(23154),g=_(61597),m=_(73874),p=_(15764),o=_(43092),P=_(69927),D=_(8691),O=_(56151);function x(e,n){return T.apply(this,arguments)}function T(){return T=(0,d.A)(function*(e,n){const r=e.instance.portalItem;if(r?.id)return yield r.load(n),function C(e){const n=e.instance.portalItem;if(!n?.type||!e.supportedTypes.includes(n.type))throw new v.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:n?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),function s(e,n){return u.apply(this,arguments)}(e,n)}),T.apply(this,arguments)}function u(){return u=(0,d.A)(function*(e,n){const r=e.instance,t=r.portalItem;if(!t)return;const{url:l,title:a}=t,c=(0,p.v)(t,"portal-item");if("group"===r.type)return function h(e,n,r){return b.apply(this,arguments)}(r,c,e);l&&"media"!==r.type&&r.read({url:l},c);const f=new g.v,i=yield N(e,f,n);return i&&r.read(i,c),r.resourceReferences={portalItem:t,paths:c.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:a},c),(0,D.L)(r,c)}),u.apply(this,arguments)}function b(){return b=(0,d.A)(function*(e,n,r){const t=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:l,type:a}=t;if("Group Layer"===a){if(!(0,P.Y)(t,"Map"))throw new v.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return function j(e,n){return M.apply(this,arguments)}(e,r)}return e.read({title:l},n),function R(e,n){return K.apply(this,arguments)}(e,r)}),b.apply(this,arguments)}function M(){return(M=(0,d.A)(function*(e,n){const r=e.portalItem,t=yield r.fetchData("json");if(!t)return;if(!n.populateGroupLayer)throw new v.A("portal:missing-populate-group-layer","Missing populate group layer");const l=(0,p.v)(r,"web-map");e.read(t,l),yield n.populateGroupLayer(e,t,{context:l}),e.resourceReferences={portalItem:r,paths:l.readResourcePaths??[]}})).apply(this,arguments)}function K(){return K=(0,d.A)(function*(e,n){let r;const{portalItem:t}=e;if(!t)return;const l=t.type,a=n.layerModuleTypeMap;if(!a)throw new v.A("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(l){case"Feature Service":case"Feature Collection":r=a.FeatureLayer;break;case"Stream Service":r=a.StreamLayer;break;case"Scene Service":r=a.SceneLayer;break;default:throw new v.A("portal:unsupported-item-type-as-group",`The item type '${l}' is not supported as a 'IGroupLayer'`)}const c=new g.v;let[f,i]=yield Promise.all([r(),N(n,c)]),y=()=>f;if("Feature Service"===l){const E=(0,o.pJ)(i)?.customParameters;i=t.url?yield(0,o.bO)(i,t.url,c):{},y=(yield function k(e,n){return $.apply(this,arguments)}(i,a))||y;const U=yield function Z(e,n){return J.apply(this,arguments)}(t.url,{customParameters:E,loadContext:c});return yield B(e,y,y,i,a,U)}return"Scene Service"===l&&t.url&&(i=yield(0,o.nu)(t,i,c)),(0,o.XH)(i)>0?yield B(e,y,null,i,a):yield function X(e,n,r){return W.apply(this,arguments)}(e,y,a)}),K.apply(this,arguments)}function W(){return(W=(0,d.A)(function*(e,n,r){const{portalItem:t}=e;if(!t?.url)return;const l=yield(0,O.V)(t.url);l&&B(e,n,null,{layers:l.layers?.map(o._r),tables:l.tables?.map(o._r)},r)})).apply(this,arguments)}function B(e,n,r,t,l,a){return w.apply(this,arguments)}function w(){return(w=(0,d.A)(function*(e,n,r,t,l,a){let c=t.layers||[];const f=t.tables||[];if("Feature Collection"===e.portalItem?.type?(c.forEach((i,y)=>{i.id=y,"Table"===i?.layerDefinition?.type&&f.push(i)}),c=c.filter(i=>"Table"!==i?.layerDefinition?.type)):(c.reverse(),f.reverse()),c.forEach(i=>{const y=a?.(i);if(y||!a){const E=H(e,n(i),t,i,y);e.add(E)}}),f.length){const i=r?null:yield l.FeatureLayer();f.forEach(y=>{const E=a?.(y);if(E||!a){const U=H(e,r?r(y):i,t,y,E);e.tables.add(U)}})}})).apply(this,arguments)}function H(e,n,r,t,l){const a=e.portalItem,c={portalItem:a.clone(),layerId:t.id};null!=t.url&&(c.url=t.url);const f=new n(c);if("sourceJSON"in f&&(f.sourceJSON=l),"subtype-group"!==f.type&&"catalog"!==f.type&&(f.sublayerTitleMode="service-name"),"Feature Collection"===a.type){const i={origin:"portal-item",portal:a.portal||m.A.getDefault()};f.read(t,i);const y=r.showLegend;null!=y&&f.read({showLegend:y},i)}return f}function N(e,n,r){return F.apply(this,arguments)}function F(){return F=(0,d.A)(function*(e,n,r){if(!1===e.supportsData)return;const t=e.instance,l=t.portalItem;if(!l)return;let a=null;try{a=yield l.fetchData("json",r)}catch{}if(function Y(e){return"stream"!==e.type&&"layerId"in e}(t)){let c=null;const f=yield function V(e,n,r){return G.apply(this,arguments)}(l,a,n);if((a?.layers||a?.tables)&&f>0){if(null==t.layerId){const i=(0,o.l)(t.type),y=i?.length?(0,o.Ju)(a,i)[0]:(0,o.pJ)(a);y&&(t.layerId=y.id)}c=function Q(e,n){const{layerId:r}=n,t=e.layers?.find(l=>l.id===r)||e.tables?.find(l=>l.id===r);return t&&function z(e,n){const r="layerType"in e&&e.layerType,{type:t}=n;return!("feature"===t&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===t&&!r||"oriented-imagery"===t&&!r||"subtype-group"===t&&!r)}(t,n)?t:null}(a,t),"OrientedImageryLayer"===c?.layerType&&"oriented-imagery"===t.type&&t.supportedSourceTypes.add("Feature Layer"),c&&null!=a.showLegend&&(c.showLegend=a.showLegend)}return f>1&&"sublayerTitleMode"in t&&"service-name"!==t.sublayerTitleMode&&(t.sublayerTitleMode="item-title-and-service-name"),c}return a}),F.apply(this,arguments)}function G(){return(G=(0,d.A)(function*(e,n,r){if(n?.layers&&n?.tables)return(0,o.XH)(n);const t=(0,L.qg)(e.url);if(!t)return 1;const l=yield r.fetchServiceMetadata(t.url.path,{customParameters:(0,o.pJ)(n)?.customParameters}).catch(()=>null);return(n?.layers?.length??l?.layers?.length??0)+(n?.tables?.length??l?.tables?.length??0)})).apply(this,arguments)}function J(){return(J=(0,d.A)(function*(e,n){const{layersJSON:r}=yield(0,A.Q)(e,n);if(!r)return null;const t=[...r.layers,...r.tables];return l=>t.find(a=>a.id===l.id)})).apply(this,arguments)}function $(){return($=(0,d.A)(function*(e,n){const{layers:r,tables:t}=e,l=[...r??[],...t??[]];if(!l.length)return;const a=new Set,c=[];for(const{layerType:y}of l){const E=y??"ArcGISFeatureLayer";if(a.has(E))continue;a.add(E);const U=n[(0,o.K8)(E)];c.push(U())}const f=yield Promise.all(c),i=new Map;return Array.from(a).forEach((y,E)=>{i.set(y,f[E])}),({layerType:y})=>i.get(y??"ArcGISFeatureLayer")})).apply(this,arguments)}},43092:(S,I,_)=>{_.d(I,{Ju:()=>P,K8:()=>x,XH:()=>D,_r:()=>A,bO:()=>g,l:()=>O,nu:()=>T,pJ:()=>p,rc:()=>o});var d=_(10467),v=_(86537),L=_(23154);function A(s){const u={id:s.id,name:s.name},h=(0,L.K)(s.type);return"FeatureLayer"!==h&&(u.layerType=h),u}function g(s,u,h){return m.apply(this,arguments)}function m(){return(m=(0,d.A)(function*(s,u,h){if(null==s?.layers||null==s?.tables){const b=yield h.fetchServiceMetadata(u,{customParameters:p(s)?.customParameters});(s=s||{}).layers=s.layers||b?.layers?.map(A),s.tables=s.tables||b?.tables?.map(A)}return s})).apply(this,arguments)}function p(s){if(!s)return null;const{layers:u,tables:h}=s;return u?.length?u[0]:h?.length?h[0]:null}function o(s,u){return null==u?null:[...s.layers||[],...s.tables||[]].find(h=>h.id===u)}function P(s,u){return[...s.layers||[],...s.tables||[]].filter(({layerType:h})=>u.includes(h||"ArcGISFeatureLayer"))}function D(s){return(s?.layers?.length??0)+(s?.tables?.length??0)}function O(s){switch(s){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function x(s){switch(s){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}function T(s,u,h){return C.apply(this,arguments)}function C(){return(C=(0,d.A)(function*(s,u,h){if(!s?.url)return u??{};if(u??={},!u.layers){const M=yield h.fetchServiceMetadata(s.url);u.layers=M.layers?.map(A)}const{serverUrl:b,portalItem:j}=yield(0,v.L)(s.url,{sceneLayerItem:s,customParameters:p(u)?.customParameters}).catch(()=>({serverUrl:null,portalItem:null}));if(null==b)return u.tables=[],u;if(!u.tables&&j){const M=yield j.fetchData().catch(()=>null);if(M?.tables)u.tables=M.tables.map(A);else{const R=yield h.fetchServiceMetadata(b,{customParameters:p(M)?.customParameters}).catch(()=>null);u.tables=R?.tables?.map(A)}}if(u.tables)for(const M of u.tables)M.url=`${b}/${M.id}`;return u})).apply(this,arguments)}},8691:(S,I,_)=>{_.d(I,{L:()=>g});var d=_(10467),v=_(89447),L=_(56492),A=_(96996);function g(p,o,P){return m.apply(this,arguments)}function m(){return(m=(0,d.A)(function*(p,o,P){const D=p&&p.getAtOrigin&&p.getAtOrigin("renderer",o.origin);if(D&&"unique-value"===D.type&&D.styleOrigin){const O=yield(0,v.Ke)(D.populateFromStyle());if((0,L.Te)(P),!1===O.ok){const x=O.error;o?.messages&&o.messages.push(new A.A("renderer:style-reference",`Failed to create unique value renderer from style reference: ${x.message}`,{error:x,context:o})),p.clear("renderer",o?.origin)}}})).apply(this,arguments)}}}]);