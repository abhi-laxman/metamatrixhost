"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[4424],{43141:(It,vt,c)=>{c.d(vt,{A:()=>et});var l=c(9700),$=c(4032);class et{constructor(X){this._observable=new $.I,this._set=new Set(X)}get size(){return(0,l.gc)(this._observable),this._set.size}add(X){const W=this._set.size;return this._set.add(X),this._set.size!==W&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(X){const W=this._set.delete(X);return W&&this._observable.notify(),W}entries(){return(0,l.gc)(this._observable),this._set.entries()}forEach(X,W){(0,l.gc)(this._observable),this._set.forEach((T,ft)=>X.call(W,T,ft,this),W)}has(X){return(0,l.gc)(this._observable),this._set.has(X)}keys(){return(0,l.gc)(this._observable),this._set.keys()}values(){return(0,l.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,l.gc)(this._observable),this._set[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},97669:(It,vt,c)=>{c.d(vt,{EL:()=>a,RS:()=>m,gr:()=>ft,wP:()=>C,wZ:()=>L});var l=c(81098),et=(c(3248),c(77806)),ut=c(79139),X=c(32034),W=c(61320),T=c(8675);function ft(u){return"declaredClass"in u}function Y(u){return"declaredClass"in u}function C(u,g){return u?function rt(u){return"declaredClass"in u}(u)?u:new l.A({layer:g,sourceLayer:g,visible:u.visible,symbol:(0,et.o8)(u.symbol),attributes:(0,et.o8)(u.attributes),geometry:L(u.geometry)}):null}function L(u){return null==u?null:ft(u)?u:(0,W.rS)(function A(u){const{wkid:g,wkt:y,wkt2:D,latestWkid:B}=u.spatialReference,K={wkid:g,wkt:y,wkt2:D,latestWkid:B};switch(u.type){case"point":{const{x:Q,y:at,z:nt,m:lt}=u;return{x:Q,y:at,z:nt,m:lt,spatialReference:K}}case"polygon":{const{rings:Q,hasZ:at,hasM:nt}=u;return{rings:U(Q),hasZ:at,hasM:nt,spatialReference:K}}case"polyline":{const{paths:Q,hasZ:at,hasM:nt}=u;return{paths:U(Q),hasZ:at,hasM:nt,spatialReference:K}}case"extent":{const{xmin:Q,xmax:at,ymin:nt,ymax:lt,zmin:G,zmax:M,mmin:x,mmax:d,hasZ:f,hasM:v}=u;return{xmin:Q,xmax:at,ymin:nt,ymax:lt,zmin:G,zmax:M,mmin:x,mmax:d,hasZ:f,hasM:v,spatialReference:K}}case"multipoint":{const{points:Q,hasZ:at,hasM:nt}=u;return{points:Z(Q)?S(Q):Q,hasZ:at,hasM:nt,spatialReference:K}}default:return}}(u))}function U(u){return function H(u){for(const g of u)if(0!==g.length)return Z(g);return!1}(u)?u.map(g=>S(g)):u}function S(u){return u.map(g=>Array.from(g))}function Z(u){return u.length>0&&((0,ut.vZ)(u[0])||(0,ut.aI)(u[0]))}function a(u,g){if(!u)return null;let y;if(Y(u)){if(null==g)return u.clone();if(Y(g))return g.copy(u)}return null!=g?(y=g,y.x=u.x,y.y=u.y,y.spatialReference=u.spatialReference,u.hasZ?(y.z=u.z,y.hasZ=u.hasZ):(y.z=void 0,y.hasZ=!1),u.hasM?(y.m=u.m,y.hasM=!0):(y.m=void 0,y.hasM=!1)):(y=(0,T.T)(u.x,u.y,u.z,u.spatialReference),u.hasM&&(y.m=u.m,y.hasM=!0)),y}function m(u){const{wkid:g,wkt:y,wkt2:D,latestWkid:B}=u;return X.A.fromJSON({wkid:g,wkt:y,wkt2:D,latestWkid:B})}},76926:(It,vt,c)=>{c.d(vt,{Fe:()=>A,Km:()=>W,Nk:()=>rt});var l=c(68677),$=c(32117);function W(a,m,u,g){if(a)if("CIMTextSymbol"!==a.type){if(u&&a.effects)for(const y of a.effects)Y(y,m);if(a.symbolLayers)for(const y of a.symbolLayers){switch(y.type){case"CIMPictureMarker":case"CIMVectorMarker":T(y,m,g);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!g?.preserveOutlineWidth&&y.width&&(y.width*=m);break;case"CIMPictureFill":y.height&&(y.height*=m),y.offsetX&&(y.offsetX*=m),y.offsetY&&(y.offsetY*=m);break;case"CIMHatchFill":W(y.lineSymbol,m,!0,{...g,preserveOutlineWidth:!1}),y.offsetX&&(y.offsetX*=m),y.offsetY&&(y.offsetY*=m),y.separation&&(y.separation*=m)}if(y.effects)for(const D of y.effects)Y(D,m)}}else null!=a.height&&(a.height*=m)}function T(a,m,u){if(a&&(a.markerPlacement&&function ft(a,m){switch((0,$.zr)(a)&&a.offset&&(a.offset*=m),a.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(a.customEndingOffset&&(a.customEndingOffset*=m),a.offsetAlongLine&&(a.offsetAlongLine*=m),a.placementTemplate&&a.placementTemplate.length){const u=a.placementTemplate.map(g=>g*m);a.placementTemplate=u}break;case"CIMMarkerPlacementAlongLineVariableSize":if(a.maxRandomOffset&&(a.maxRandomOffset*=m),a.placementTemplate&&a.placementTemplate.length){const u=a.placementTemplate.map(g=>g*m);a.placementTemplate=u}break;case"CIMMarkerPlacementOnLine":a.startPointOffset&&(a.startPointOffset*=m);break;case"CIMMarkerPlacementAtExtremities":a.offsetAlongLine&&(a.offsetAlongLine*=m);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":a.beginPosition&&(a.beginPosition*=m),a.endPosition&&(a.endPosition*=m);break;case"CIMMarkerPlacementPolygonCenter":a.offsetX&&(a.offsetX*=m),a.offsetY&&(a.offsetY*=m);break;case"CIMMarkerPlacementInsidePolygon":a.offsetX&&(a.offsetX*=m),a.offsetY&&(a.offsetY*=m),a.stepX&&(a.stepX*=m),a.stepY&&(a.stepY*=m)}}(a.markerPlacement,m),a.offsetX&&(a.offsetX*=m),a.offsetY&&(a.offsetY*=m),a.anchorPoint&&"Absolute"===a.anchorPointUnits&&(a.anchorPoint={x:a.anchorPoint.x*m,y:a.anchorPoint.y*m}),a.size=null!=a.size?a.size*m:0,"CIMVectorMarker"===a.type&&a.markerGraphics))for(const g of a.markerGraphics)a.scaleSymbolsProportionally||W(g.symbol,m,!0,u)}function Y(a,m){switch(a.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":a.width&&(a.width*=m);break;case"CIMGeometricEffectBuffer":a.size&&(a.size*=m);break;case"CIMGeometricEffectCut":a.beginCut&&(a.beginCut*=m),a.endCut&&(a.endCut*=m),a.middleCut&&(a.middleCut*=m);break;case"CIMGeometricEffectDashes":if(a.customEndingOffset&&(a.customEndingOffset*=m),a.offsetAlongLine&&(a.offsetAlongLine*=m),a.dashTemplate&&a.dashTemplate.length){const u=a.dashTemplate.map(g=>g*m);a.dashTemplate=u}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":a.length&&(a.length*=m);break;case"CIMGeometricEffectMove":a.offsetX&&(a.offsetX*=m),a.offsetY&&(a.offsetY*=m);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":a.offset&&(a.offset*=m);break;case"CIMGeometricEffectRegularPolygon":a.radius&&(a.radius*=m);break;case"CIMGeometricEffectTaperedPolygon":a.fromWidth&&(a.fromWidth*=m),a.length&&(a.length*=m),a.toWidth&&(a.toWidth*=m);break;case"CIMGeometricEffectWave":a.amplitude&&(a.amplitude*=m),a.period&&(a.period*=m)}}function rt(a){const m=[];return C((0,$.lW)(a),m),m.length?new l.A((0,$.e6)(m[0])):null}function C(a,m){if(!a)return;let u;u="CIMTextSymbol"===a.type?a.symbol:a;const g="CIMPolygonSymbol"===a.type;if(u?.symbolLayers)for(const y of u.symbolLayers)if(!(y.colorLocked||g&&((0,$.mA)(y)||(0,$.MM)(y)&&y.markerPlacement&&(0,$.zr)(y.markerPlacement))))switch(y.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":y.tintColor&&L(m,y.tintColor);break;case"CIMVectorMarker":y.markerGraphics?.forEach(D=>{C(D.symbol,m)});break;case"CIMSolidStroke":case"CIMSolidFill":L(m,y.color);break;case"CIMHatchFill":C(y.lineSymbol,m)}}function L(a,m){for(const u of a)if(u.join(".")===m.join("."))return;a.push(m)}function A(a,m,u){m instanceof l.A||(m=new l.A(m));const g=(0,$.lW)(a);g&&U(g,m,u)}function U(a,m,u){if(!a)return;let g;g="CIMTextSymbol"===a.type?a.symbol:a;const y="CIMPolygonSymbol"===g?.type;if(g?.symbolLayers)for(const D of g.symbolLayers){if(D.colorLocked)continue;if(y)if(u){const{layersToColor:K}=u;if(((0,$.mA)(D)||(0,$.MM)(D)&&D.markerPlacement&&(0,$.zr)(D.markerPlacement))&&"fill"===K||(0,$.jn)(D)&&"outline"===K)continue}else if((0,$.mA)(D)||(0,$.MM)(D)&&D.markerPlacement&&(0,$.zr)(D.markerPlacement))continue;const B=m.toArray();switch(D.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":D.tintColor=B;break;case"CIMVectorMarker":D.markerGraphics?.forEach(K=>{U(K.symbol,m,u)});break;case"CIMSolidStroke":case"CIMSolidFill":D.color=B;break;case"CIMHatchFill":U(D.lineSymbol,m,u)}}}},34098:(It,vt,c)=>{c.d(vt,{N:()=>pt,l:()=>rn});var A,e,U,l=c(8189),$=c(81098),et=c(10467),ut=c(98877),X=c(31178),W=c(48900),T=c(85211),C=(c(3248),c(35150),c(40707),c(76576)),L=c(56985);(e=A||(A={}))[e.NeverApplied=0]="NeverApplied",e[e.Applied=1]="Applied",e[e.Undone=2]="Undone",function(e){e.UndoRedoUpdating="UndoRedoUpdating",e.UndoInvalidError="UndoInvalidError",e.RedoInvalidError="RedoInvalidError",e.ApplyInvalidError="ApplyInvalidError"}(U||(U={}));const S={[U.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[U.UndoInvalidError]:"There are no items to Undo",[U.RedoInvalidError]:"There are no items to Redo",[U.ApplyInvalidError]:"Cannot apply an item that is already applied"};class H extends Error{constructor(){super(S[U.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class Z extends Error{constructor(){super(S[U.UndoInvalidError]),this.type="undo-redo-undo-error"}}class a extends Error{constructor(){super(S[U.RedoInvalidError]),this.type="undo-redo-redo-error"}}class m extends Error{constructor(){super(S[U.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var u;!function(e){e[e.Apply=0]="Apply",e[e.Undo=1]="Undo",e[e.Redo=2]="Redo"}(u||(u={}));let g=class extends ut.A{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=A.NeverApplied}get canUndo(){return this.status===A.Applied}get canRedo(){return this.status===A.Undone}executeUndoRedoOperation(e){var i=this;return(0,et.A)(function*(){switch(e){case u.Apply:if(i.status!==A.NeverApplied)throw new m;return yield i.apply(),void(i.status=A.Applied);case u.Undo:if(i.status!==A.Applied)throw new Z;return yield i.undo(),void(i.status=A.Undone);case u.Redo:if(i.status!==A.Undone)throw new Z;return yield i.redo(),void(i.status=A.Applied)}})()}};(0,l._)([(0,T.MZ)()],g.prototype,"name",void 0),(0,l._)([(0,T.MZ)()],g.prototype,"tag",void 0),g=(0,l._)([(0,C.$)("esri.undoredo.UndoableOperation")],g);let y=class extends ut.A{constructor(){super(...arguments),this._stack=new X.A,this._stackPosition=-1,this._updatingHandles=new L.U}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}undo(){var e=this;return(0,et.A)(function*(){if(!e.hasUndo)throw new Z;if(e.updating)throw new H;const i=e._stack.getItemAt(e._stackPosition);i&&(yield e._updatingHandles.addPromise((0,et.A)(function*(){yield i.executeUndoRedoOperation(u.Undo),--e._stackPosition,i.canRedo||e._truncateForwardStack()})()))})()}redo(){var e=this;return(0,et.A)(function*(){if(!e.hasRedo)throw new a;if(e.updating)throw new H;const i=e._stack.getItemAt(e._stackPosition+1);if(!i)throw new a;yield e._updatingHandles.addPromise((0,et.A)(function*(){yield i.executeUndoRedoOperation(u.Redo),++e._stackPosition})())})()}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}inject(e){var i=this;return(0,et.A)(function*(){if(i.updating)throw new H;yield i._updatingHandles.addPromise((0,et.A)(function*(){e.status===A.NeverApplied&&(yield e.executeUndoRedoOperation(u.Apply)),e.canUndo?(i._stack.splice(i._stackPosition+1,0,e),i._stackPosition++):i._stackPosition>-1&&(i._stack.splice(0,i._stackPosition+1).forEach(p=>p.destroy()),i._stackPosition=-1)})())})()}add(e){var i=this;return(0,et.A)(function*(){if(i.updating)throw new H;yield i._updatingHandles.addPromise((0,et.A)(function*(){e.status===A.NeverApplied&&(yield e.executeUndoRedoOperation(u.Apply)),i._stackPosition>=-1&&i._truncateForwardStack(),e.canUndo?(i._stack.push(e),i._stackPosition=i._stack.length-1):i._drainStack()})())})()}removeTagged(e,i=!1){var p=this;return(0,et.A)(function*(){if(p.updating&&!i)return;yield(0,W.C_)(()=>!p.updating);const _=new X.A;for(let E=0;E<p._stack.length;E++){const P=p._stack.getItemAt(E);P&&(P.tag===e?(P.destroy(),E===p._stackPosition&&(p._stackPosition=_.length-1)):_.push(P))}p._stack=_,p._stackPosition>_.length-1&&(p._stackPosition=_.length-1)})()}clear(e=!1){var i=this;return(0,et.A)(function*(){if(i.updating&&!e)throw new H;yield(0,W.C_)(()=>!i.updating),i._drainStack()})()}};(0,l._)([(0,T.MZ)()],y.prototype,"_stack",void 0),(0,l._)([(0,T.MZ)()],y.prototype,"_stackPosition",void 0),(0,l._)([(0,T.MZ)()],y.prototype,"updating",null),(0,l._)([(0,T.MZ)({readOnly:!0})],y.prototype,"canUndo",null),(0,l._)([(0,T.MZ)({readOnly:!0})],y.prototype,"hasUndo",null),(0,l._)([(0,T.MZ)({readOnly:!0})],y.prototype,"canRedo",null),(0,l._)([(0,T.MZ)({readOnly:!0})],y.prototype,"hasRedo",null),y=(0,l._)([(0,C.$)("esri.UndoRedo")],y);var D=c(89447),B=c(42425),K=c(17715),Q=c(11432),at=c(46867),nt=c(36819),lt=c(94782);class G{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}var h,M=c(89952),x=c(77806),d=c(82663),f=c(28714),v=c(25866),w=c(87477),V=c(1749),F=c(55861),tt=c(32034),mt=c(79283),z=c(55039),Pt=c(98946);let O=h=class extends F.A{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,i=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const p=(0,d.oU)(this.radius,this.radiusUnit,"meters"),_=e.spatialReference;let E,P="geographic";if(_.isWebMercator?P="webMercator":(null!=(_.wkid&&Pt.A[_.wkid])||(_.wkt2||_.wkt)&&(0,d.x1)(_.wkt2||_.wkt))&&(P="projected"),this.geodesic){let b;switch(P){case"webMercator":b=(0,z.ci)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":b=e}E=this._createGeodesicCircle(b,p,i),"webMercator"===P&&(E=(0,z.Gh)(E))}else{let b;"webMercator"===P||"projected"===P?b=p/(0,d.Ao)(e.spatialReference):"geographic"===P&&(b=(0,d.vl)(p,"meters",(0,w.tO)(e.spatialReference).radius)),E=this._createPlanarCircle(e,b,i)}this.spatialReference=E.spatialReference,this.addRing(E.rings[0])}clone(){const{center:e,numberOfPoints:i,radius:p,radiusUnit:_,geodesic:E}=this;return new h({center:e?.clone(),numberOfPoints:i,radius:p,radiusUnit:_,geodesic:E})}_createGeodesicCircle(e,i,p){const _=[],E=[e.x,e.y];for(let P=0;P<360;P+=360/p){const b=this.hasZ?[0,0,e.z??0]:[0,0];(0,mt.vN)(b,E,P,i,tt.A.WGS84),_.push(b)}return _.push(_[0]),new F.A({rings:[_]})}_createPlanarCircle(e,i,p){const _=[],E=2*Math.PI/p;for(let P=0;P<p;++P){const b=E*P,q=[e.x+Math.cos(-b)*i,e.y+Math.sin(-b)*i];this.hasZ&&q.push(e.z??0),_.push(q)}return _.push(_[0]),new F.A({spatialReference:e.spatialReference,rings:[_]})}};(0,l._)([(0,T.MZ)({type:V.A})],O.prototype,"center",void 0),(0,l._)([(0,T.MZ)()],O.prototype,"geodesic",void 0),(0,l._)([(0,T.MZ)()],O.prototype,"numberOfPoints",void 0),(0,l._)([(0,T.MZ)()],O.prototype,"radius",void 0),(0,l._)([(0,T.MZ)()],O.prototype,"radiusUnit",void 0),O=h=(0,l._)([(0,C.$)("esri.geometry.Circle")],O);const R=O;var I=c(46041),J=c(21870),N=c(93615),st=c(15268),j=c(58701),it=c(76329),Et=c(44999),Ut=c(19890),Bt=c(14214),Lt=c(41510);function bt(e,i,p=null){return null!=p?[e,i,p]:[e,i]}function ht(e,i,p=null){return null!=p?{x:e,y:i,z:p}:{x:e,y:i}}class pe{constructor(i){this.spatialReference=i}mapToLocalMultiple(i){return i.map(p=>this.mapToLocal(p)).filter(M.Ru)}get doUnnormalization(){return!1}}class Se extends pe{constructor(i,p,_=null){super(p),this._defaultZ=_,this.transform=(0,Et.vt)(),this.transformInv=(0,Et.vt)(),this.transform=(0,Et.o8)(i),(0,it.B8)(this.transformInv,this.transform)}makeMapPoint(i,p){return bt(i,p,this._defaultZ)}mapToLocal(i){return ht(this.transform[0]*i[0]+this.transform[2]*i[1]+this.transform[4],this.transform[1]*i[0]+this.transform[3]*i[1]+this.transform[5])}localToMap(i){return bt(this.transformInv[0]*i.x+this.transformInv[2]*i.y+this.transformInv[4],this.transformInv[1]*i.x+this.transformInv[3]*i.y+this.transformInv[5],this._defaultZ)}}class Ie extends pe{constructor(i,p){super(i.spatialReference),this.view=i,this.defaultZ=null,this.pWS=(0,v.vt)(),this.tangentFrameUpWS=(0,v.vt)(),this.tangentFrameRightWS=(0,v.vt)(),this.tangentFrameForwardWS=(0,v.vt)(),this.localFrameRightWS=(0,v.vt)(),this.localFrameUpWS=(0,v.vt)(),this.worldToLocalTransform=(0,Bt.vt)(),this.localToWorldTransform=(0,Bt.vt)(),this.scale=1,this.scale=i.resolution,this.referenceMapPoint=p,this.defaultZ=p.hasZ?p.z:null;const _=i.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Lt._.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Lt._.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Lt._.Z,this.tangentFrameForwardWS);const E=(0,v.vt)();(0,f.h)(E,this.tangentFrameForwardWS,(0,f.f)(_,this.tangentFrameForwardWS)),(0,f.d)(this.localFrameRightWS,_,E),(0,f.n)(this.localFrameRightWS,this.localFrameRightWS),(0,f.e)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,Ut.Yc)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,Ut.B8)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(i,p){return bt(i,p,this.defaultZ)}mapToLocal(i){const p=(0,v.vt)();this.view.renderCoordsHelper.toRenderCoords(new V.A({x:i[0],y:i[1],spatialReference:this.spatialReference}),p),(0,f.w)(p,p,this.worldToLocalTransform);const _=this.view.renderCoordsHelper.fromRenderCoords(p,new V.A({spatialReference:this.view.spatialReference}));return null!=_?ht(_.x/this.scale,_.y/this.scale):null}localToMap(i){const p=(0,v.vt)();this.view.renderCoordsHelper.toRenderCoords(new V.A({x:i.x*this.scale,y:i.y*this.scale,spatialReference:this.spatialReference}),p),(0,f.w)(p,p,this.localToWorldTransform);const _=this.view.renderCoordsHelper.fromRenderCoords(p,new V.A({spatialReference:this.view.spatialReference}));return null!=_?bt(_.x,_.y,this.defaultZ):null}}function Dt(e,i){const p=new V.A({x:e[0],y:e[1],spatialReference:i});return e.length>2&&(p.z=e[2]),p}function de(e,i,p){const _=new N.A({paths:e,spatialReference:i});return p&&(0,st._7)(_),_}function jt(e,i,p,_=!0){const E=(0,x.o8)(e);E.forEach(b=>{(0,M.aI)(b[0],b[b.length-1])&&1!==b.length||b.push(b[0])});let P=new F.A({rings:E,spatialReference:i});return P.rings.forEach(b=>{(0,st.$3)(b)||b.reverse()}),p&&(0,st._7)(P),_&&P.isSelfIntersecting&&(0,j.fn)(i)&&(P=(0,I.simplify)(P)),P}function ue(e,i,p){const _=i.mapToLocalMultiple(e),E=[],P={x:_[0].x,y:_[0].y},b_y=_[1].y,q=Math.round(_[1].x-P.x),k=Math.round(b_y-P.y),ot=Math.max(Math.abs(q),Math.abs(k));if(p){const ct={x:P.x+ot,y:P.y+ot},Mt={x:P.x-ot,y:P.y-ot};E.push(ht(ct.x,Mt.y),ht(Mt.x,Mt.y),ht(Mt.x,ct.y),ht(ct.x,ct.y))}else{const ct={x:q>0?P.x+ot:P.x-ot,y:k>0?P.y+ot:P.y-ot};E.push(ht(P.x,P.y),ht(ct.x,P.y),ht(ct.x,ct.y),ht(P.x,ct.y))}return he(jt([E.map(ct=>i.localToMap(ct)).filter(M.Ru)],i.spatialReference,i.doUnnormalization,!0),E,i)}function he(e,i,p){const _=qt(i[3],i[2],p),E=qt(i[1],i[2],p),P=qt(i[0],i[1],p),b=qt(i[0],i[3],p);return{geometry:e,midpoints:null!=_&&null!=E&&null!=P&&null!=b?{top:_,right:E,bottom:P,left:b}:null}}function qt(e,i,p){Gt[0]=e.x,Gt[1]=e.y,Gt[2]=0,kt[0]=i.x,kt[1]=i.y,kt[2]=0,(0,f.m)(Gt,Gt,kt,.5),te.x=Gt[0],te.y=kt[1],te.z=kt[2];const _=p.localToMap(te);return null!=_?Dt(_,p.spatialReference):null}const te=ht(0,0,0),Gt=(0,v.vt)(),kt=(0,v.vt)();function me(e,i,p,_){const E=i.mapToLocalMultiple(e);let P=null,b=null;if(p)P=E[0],b=E[1];else{const gt=E[0],yt=E[1],Ct=Math.round(yt.x-gt.x),Ot=Math.round(yt.y-gt.y),Tt=Math.max(Math.abs(Ct),Math.abs(Ot));P=ht(Ct>0?gt.x+Tt/2:gt.x-Tt/2,Ot>0?gt.y+Tt/2:gt.y-Tt/2),b=ht(Math.abs(Ct)>Math.abs(Ot)?P.x-Tt/2:P.x,Math.abs(Ct)>Math.abs(Ot)?P.y:P.y-Tt/2)}const q=i.localToMap(P),k=i.localToMap(b);if(null==q||null==k)return null;i.doUnnormalization&&(0,st.JM)([[q,k]],i.spatialReference);const ot=Dt(q,i.spatialReference),ct=Dt(k,i.spatialReference),Mt=(0,d.GA)(i.spatialReference);let _t=0;if((0,j.fn)(i.spatialReference))_t=Mt*(0,I.distance)(ot,ct,null);else{const gt=P.x-b.x,yt=P.y-b.y;_t=Mt*Math.sqrt(gt*gt+yt*yt)*(_||1)}const dt=new R({center:ot,radius:_t,radiusUnit:"meters",spatialReference:i.spatialReference});return{geometry:jt(dt.rings,dt.spatialReference,!1),center:ot,edge:ct}}var xt=c(81142),ee=c(73812);function zt(e,i,p){if(null==e)return"noTool";switch(e){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function Ze(e,i){const p=null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0;return"freehand"===i?p<2?"freehandStart":"freehandEnd":p<2?"polylineZeroVertices":"polylineOneVertex"}(i,p);case"polygon":return function De(e,i){const p=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;if(p<3)switch(i){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(p<4)return"freehand"===i?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(i,p);case"rectangle":case"circle":return function Ve(e,i){if((null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0)<3)switch(i){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(i){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(i,p);default:return}}const ne=(0,v.vt)();var We=c(68129),ie=c(64015),Vt=c(89381);let wt=class extends Vt.w{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=xt.iT}get allFields(){return[]}};(0,l._)([(0,T.MZ)()],wt.prototype,"type",void 0),(0,l._)([(0,T.MZ)()],wt.prototype,"radius",void 0),(0,l._)([(0,T.MZ)()],wt.prototype,"xSize",void 0),(0,l._)([(0,T.MZ)()],wt.prototype,"ySize",void 0),(0,l._)([(0,T.MZ)()],wt.prototype,"area",void 0),(0,l._)([(0,T.MZ)()],wt.prototype,"helpMessage",void 0),(0,l._)([(0,T.MZ)()],wt.prototype,"allFields",null),wt=(0,l._)([(0,C.$)("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],wt);var Zt=c(33983),Kt=c(26530);let Nt=class extends((0,Kt.B)(Vt.w)){constructor(e){super(e),this.type="draw-mesh",this.orientation=(0,Zt.LJ)({lockable:!1}),this.scale=(0,Zt.dy)({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,l._)([(0,T.MZ)()],Nt.prototype,"helpMessage",void 0),(0,l._)([(0,T.MZ)()],Nt.prototype,"allFields",null),Nt=(0,l._)([(0,C.$)("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Nt);let Xt=class extends((0,Kt.B)(Vt.w)){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,l._)([(0,T.MZ)()],Xt.prototype,"helpMessage",void 0),(0,l._)([(0,T.MZ)()],Xt.prototype,"allFields",null),Xt=(0,l._)([(0,C.$)("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],Xt);let Yt=class extends((0,Kt.B)(Vt.w)){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,l._)([(0,T.MZ)()],Yt.prototype,"helpMessage",void 0),(0,l._)([(0,T.MZ)()],Yt.prototype,"allFields",null),Yt=(0,l._)([(0,C.$)("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],Yt);let Wt=class extends((0,Kt.B)(Vt.w)){constructor(e){super(e),this.type="draw-polygon",this.direction=(0,Zt.Gk)(),this.distance=(0,Zt.Ku)(),this.area=(0,Zt.Am)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};(0,l._)([(0,T.MZ)()],Wt.prototype,"xyMode",void 0),(0,l._)([(0,T.MZ)()],Wt.prototype,"helpMessage",void 0),(0,l._)([(0,T.MZ)()],Wt.prototype,"allFields",null),Wt=(0,l._)([(0,C.$)("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Wt);let Ft=class extends((0,Kt.B)(Vt.w)){constructor(e){super(e),this.type="draw-polyline",this.direction=(0,Zt.Gk)(),this.distance=(0,Zt.Ku)(),this.totalLength=(0,Zt.fr)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};(0,l._)([(0,T.MZ)()],Ft.prototype,"helpMessage",void 0),(0,l._)([(0,T.MZ)()],Ft.prototype,"xyMode",void 0),(0,l._)([(0,T.MZ)()],Ft.prototype,"allFields",null),Ft=(0,l._)([(0,C.$)("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Ft);let At=class extends Vt.w{constructor(e){super(e),this.type="draw-rectangle",this.xSize=xt.r7,this.ySize=xt.r7,this.area=xt.iT}get allFields(){return[]}};(0,l._)([(0,T.MZ)()],At.prototype,"type",void 0),(0,l._)([(0,T.MZ)()],At.prototype,"xSize",void 0),(0,l._)([(0,T.MZ)()],At.prototype,"ySize",void 0),(0,l._)([(0,T.MZ)()],At.prototype,"area",void 0),(0,l._)([(0,T.MZ)()],At.prototype,"helpMessage",void 0),(0,l._)([(0,T.MZ)()],At.prototype,"allFields",null),At=(0,l._)([(0,C.$)("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],At);var Fe=c(12724),fe=c(84177),$t=c(69441),ge=c(25566);function ye(e){const{directionOptions:i,geometryType:p,sketchOptions:_,tooltipInfos:E}=e,P=q=>{const k=oe(e).mode,ot=E[q].elevation;"relative-to-ground"===k||"relative-to-scene"===k||"on-the-ground"===k?ot.lock(le(e)):ot.unlock()};switch(p){case"polygon":case"polyline":P(p),(q=>{if(i){const k=E[q].direction;k.committed=i.angle,k.unlockOnVertexPlacement=!1,_.values.directionMode=i.mode}})(p);break;case"point":case"mesh":P(p)}}function ve(e){re(e)?.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function re({geometryType:e,graphic:i,tooltipInfos:p}){return i?.geometry?.type!==je[e]?"circle"===e||"rectangle"===e?p[e]:null:p[e]}const je={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function ae(e,i,p){const{drawOperation:_,view:E,sketchOptions:P}=p,{cursorVertex:b}=_;e.sketchOptions=P,e.viewType=E.type;const q="multipoint"===i?.type?i.getPoint(i.points.length-1):i;e.setLocationFromPoint(q,Ht(p)),_e(e.elevation,p),_.constraints=b?{context:Ce(b,p),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}:void 0}function Me(e,i){const{drawOperation:p,sketchOptions:_,view:E}=i,{cursorVertex:P,lastVertex:b,secondToLastVertex:q}=p,k=_.values.effectiveDirectionMode;e.sketchOptions=_,e.viewType=E.type;const ot=b&&P?(0,$t.Kt)(b,P)??xt.r7:null;if(e.distance.actual=ot,e.distance.readOnly=null==b,e.direction.actual=null,e.direction.readOnly=!0,b&&P&&("absolute"===k||q)){const _t=(0,Fe.uR)(q,b,P,k);e.direction.actual=_t??xt.n0,e.direction.readOnly=!1}e.setLocationFromPoint(P,Ht(i)),_e(e.elevation,i);const ct=function Qe(e,{sketchOptions:i}){const p=i.tooltips.xyMode;return"auto"===p?e?"direction-distance":"coordinates":p}(b,i);e.xyMode=ct,e.direction.visible="direction-distance"===ct,e.distance.visible="direction-distance"===ct,e.effectiveX.visible="coordinates"===ct,e.effectiveY.visible="coordinates"===ct;const Mt=P??b;p.constraints=Mt?{context:Ce(Mt,i),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function _e(e,i){const{drawOperation:p}=i;e.actual=(0,ge.Of)(p?.cursorVertex??p?.lastVertex)??le(i),e.visible=p.hasZ,e.readOnly=!1,e.showAsZ=!0}function xe(e){const i=e.createOperationGeometry?.full;return"polygon"!==i?.type?xt.iT:(0,fe.n)(i)??xt.iT}function Pe(e){const i=e.createOperationGeometry?.rectangle?.midpoints;return(null!=i?(0,$t.Kt)(i.left,i.right):null)??xt.r7}function Ee(e){const i=e.createOperationGeometry?.rectangle?.midpoints;return(null!=i?(0,$t.Kt)(i.top,i.bottom):null)??xt.r7}function oe(e){return e.drawOperation.elevationInfo??ee.qt}function Ht(e){return e.drawOperation.coordinateHelper.spatialReference}function le(e){const i=(0,d.G9)(Ht(e));return(0,xt.d_)(e.defaultZ*i,"meters")}function Ce(e,i){return(0,We.hj)(e,i.view,Ht(i),oe(i),i.drawOperation.coordinateHelper.hasZ(),i.sketchOptions.values.effectiveDirectionMode)}var sn=c(97167),Oe=c(56023),Te=c(34703);let pt=class extends(B.A.EventedMixin(sn.g)){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Oe.A}initialize(){const{view:e}=this;this.internalGraphicsLayer=new nt.A({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const i=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=function He(e,i){return{point:new Yt({sketchOptions:i,viewType:e}),multipoint:new Xt({sketchOptions:i,viewType:e}),polyline:new Ft({sketchOptions:i,viewType:e}),polygon:new Wt({sketchOptions:i,viewType:e}),mesh:new Nt({sketchOptions:i,viewType:e}),rectangle:new At({sketchOptions:i}),circle:new wt({sketchOptions:i})}}(e.type,this.sketchOptions);const p=(0,ie.A)(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=p,ye(this._tooltipsContext),this._coordinateFormatterLoadTask=(0,D.UT)(()=>(0,at.Hh)()),this.addHandles([i.on("vertex-add",_=>this.onVertexAdd(_)),i.on("vertex-remove",_=>this.onVertexRemove(_)),i.on("vertex-update",_=>this.onVertexUpdate(_)),i.on("cursor-update",_=>this.onCursorUpdate(_)),i.on("cursor-remove",()=>this._updateGraphic()),i.on("complete",_=>this.onComplete(_)),this._coordinateFormatterLoadTask,p.on("paste",_=>(0,ie.HA)(_,this.activeTooltipInfo)),(0,W.wB)(()=>this.cursor,_=>{i.cursor=_},W.pc),(0,Te.fm)(()=>{const{activeTooltipInfo:_,sketchOptions:E}=this;(function Ke(e,i){switch(e?.type){case"draw-point":!function Ne(e,i){const p=i.graphic?.geometry;"point"===p?.type&&(ae(e,p,i),e.helpMessage=zt("point",p,i.drawOperation.drawingMode))}(e,i);break;case"draw-multipoint":!function Xe(e,i){const p=i.graphic?.geometry;"multipoint"===p?.type&&(ae(e,p,i),e.helpMessage=zt("multipoint",p,i.drawOperation.drawingMode))}(e,i);break;case"draw-polyline":!function $e(e,i){const{createOperationGeometry:p,drawOperation:_}=i,E=null!=p?p.full:null;E&&"polyline"!==E.type||(Me(e,i),e.totalLength.actual=_.lastVertex?(E?(0,$t.ob)(E):null)??xt.r7:null,e.helpMessage=zt("polyline",E,i.drawOperation.drawingMode))}(e,i);break;case"draw-polygon":!function Je(e,i){const{createOperationGeometry:p,drawOperation:_}=i,E=null!=p?p.full:null;E&&"polygon"!==E.type||(Me(e,i),e.area.actual=_.lastVertex?(E?(0,fe.n)(E):null)??xt.iT:null,e.helpMessage=zt("polygon",E,i.drawOperation.drawingMode))}(e,i);break;case"draw-rectangle":!function qe(e,i){e.sketchOptions=i.sketchOptions,e.xSize=Pe(i),e.ySize=Ee(i),e.area=xe(i),e.helpMessage=zt("rectangle",i.graphic?.geometry,i.drawOperation.drawingMode)}(e,i);break;case"draw-circle":!function tn(e,i){const{forceUniformSize:p,sketchOptions:_}=i;e.sketchOptions=_,e.radius=p?function en({createOperationGeometry:e}){return(null!=e?.circle?.center&&null!=e.circle.edge?(0,$t.Kt)(e.circle.center,e.circle.edge):null)??xt.r7}(i):null,e.xSize=p?null:Pe(i),e.ySize=p?null:Ee(i),e.area=xe(i),e.helpMessage=zt("circle",i.graphic?.geometry,i.drawOperation.drawingMode)}(e,i);break;case"draw-mesh":!function Ye(e,i){const{graphic:p,view:_}=i,E=p?.geometry;"3d"!==_.type||E&&"mesh"!==E.type||(ae(e,E?.origin,i),E&&(0,ie.Ue)(e,E),e.helpMessage=function Le(e,i){const p=e?.geometry;if(!e||"mesh"!==p?.type||!i)return;const{renderCoordsHelper:_,elevationProvider:E}=i,{camera:P}=i.state,{extent:b}=p,{center:q,spatialReference:k}=b,ot=(0,d.GA)(k),ct=(0,d.G9)(k),Mt=(0,d.GA)(_.spatialReference),gt=(b.zmax??0)*ct,yt=gt-(b.zmin??0)*ct,Ct=Math.max(b.width*ot,b.height*ct,yt)/Mt,{x:Ot,y:Tt}=q,Jt=q.z??0;(0,f.i)(ne,Ot,Tt,Jt),_.toRenderCoords(ne,k,ne);const Qt=Ct/P.computeScreenPixelSizeAt(ne);if(Qt>1*P.width)return"meshTooClose";if(Qt<20)return"meshTooFar";const se=(0,ee.bh)(e),{absoluteZ:Rt}=(0,ee.Q5)(Ot,Tt,gt,k,i,se);return Rt<(E.getElevation(Ot,Tt,Jt,k,"ground")??0)*ct+.1*yt?"meshUnderground":"mesh"}(p,_))}(e,i)}})(_,this._tooltipsContext),p.info=E.tooltips.effectiveEnabled?_:null}),(0,Te.fm)(()=>{i.constraintZ=function nn(e){const{geometryType:i,tooltipInfos:p}=e;switch(i){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const _=p[i].elevation.committed;return _?(0,xt.l3)(_,"meters")/(0,d.G9)(Ht(e)):void 0}default:return}}(this._tooltipsContext)},W.OH)]),this.finishToolCreation()}destroy(){this.drawOperation=(0,Q.pR)(this.drawOperation),this.tooltip=(0,Q.pR)(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,Q.pR)(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),null!=this._graphic&&(this._graphic.symbol=e)}set mode(e){const i=this.drawOperation;i&&(i.drawingMode=e),this._set("mode",e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:e,map:i}}=this;return"2d"===e&&i&&"undoRedo"in i&&i.undoRedo instanceof y?i.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||(0,ie.wG)(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&ye(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(St.outline),this.removeHandles(St.regularVertices),this.removeHandles(St.activeVertex),this.removeHandles(St.activeEdge),this.removeHandles(ce)}_createOrUpdateGraphic(e){if(null!=this._graphic)return this.updateGraphicGeometry(e),this._graphic;const i=new $.A({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=i,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(i),this.addHandles(this.initializeGraphic(i)),this.notifyChange("graphic"),this.addHandles((0,K.hA)(()=>{this.internalGraphicsLayer.remove(i),this._graphic===i&&(this._graphic=null)}),ce),i}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation)return;const{coordinateHelper:i,view:p,visualizationCursorVertex:_,lastVertex:E,committedVertices:P,geometryIncludingUncommittedVertices:b,numCommittedVertices:q}=this.drawOperation;if(!(q>0||null!=_))return;const k=e.operationComplete?P:b,ot=k.length,ct=null!=_?i.pointToArray(_):null,Mt=this._drawSpatialReference,_t="3d"===p.type&&"global"===p.viewingMode,dt=new G;dt.committedVertices=P,dt.cursorVertex=ct;const{geometryType:gt}=this;switch(gt){case"point":case"mesh":dt.full=i.arrayToPoint(k[0]);break;case"multipoint":dt.full=ot>0?function Re(e,i){return new J.A({points:e,spatialReference:i})}(k,Mt):null;break;case"polyline":case"polygon":ot>0&&(dt.full="polygon"===gt?jt([k],Mt,_t,!0):de([k],Mt,_t),dt.cursorEdge=null!=ct&&E&&!(0,lt.CI)(_,E)?de([[ct,i.pointToArray(E)]],Mt,_t):null,dt.outline=ot>1?dt.full:null);break;case"circle":case"rectangle":{if(dt.committedVertices=dt.cursorVertex=null,!ot)break;const yt=function we(e,i){if("2d"===e.type)return new Se(e.state.transform,e.spatialReference,i.length>2?i[2]:null);if("3d"===e.type){const p=new V.A(i.length>2?{x:i[0],y:i[1],z:i[2],spatialReference:e.spatialReference}:{x:i[0],y:i[1],spatialReference:e.spatialReference});return new Ie(e,p)}return null}(p,k[0]),Ct=k[0],Ot=yt.makeMapPoint(Ct[0]+an*p.resolution,Ct[1]);"circle"===gt?1===ot&&e.operationComplete?dt.circle=me([Ct,Ot],yt,!0):2===ot&&(this.forceUniformSize?dt.circle=me(k,yt,this.centered):dt.rectangle=function Ae(e,i,p){const _=i.mapToLocalMultiple(e),E=_[0],P=_[1],b=Math.round(P.x-E.x),q=Math.round(P.y-E.y),k=ht(p?E.x:E.x+b/2,p?E.y:E.y+q/2),ot=p?b:b/2,ct=p?q:q/2,_t=[],dt=2*Math.PI/60;function gt(Rt){const ln=Math.cos(Rt),cn=Math.sin(Rt);return ht(ot*ln+k.x,ct*cn+k.y)}for(let Rt=0;Rt<60;Rt++)_t.push(gt(Rt*dt));_t.push(_t[0]);const{spatialReference:yt,doUnnormalization:Ct}=i,Ot=jt([_t.map(Rt=>i.localToMap(Rt)).filter(M.Ru)],yt,Ct,!1),Tt=i.localToMap(gt(Math.PI/2)),Jt=i.localToMap(gt(0)),Qt=i.localToMap(gt(-Math.PI/2)),se=i.localToMap(gt(Math.PI));return{geometry:Ot,midpoints:null!=Tt&&null!=Jt&&null!=Qt&&null!=se?{top:Dt(Tt,yt),right:Dt(Jt,yt),bottom:Dt(Qt,yt),left:Dt(se,yt)}:null}}(k,yt,this.centered)):1===ot&&e.operationComplete?dt.rectangle=ue([Ct,Ot],yt,!0):2===ot&&(dt.rectangle=this.forceUniformSize?ue(k,yt,this.centered):function be(e,i,p){let _=i.mapToLocalMultiple(e);if(1===_.length){const k=_[0];_=[ht(k.x-48,k.y+48),ht(k.x+48,k.y-48),ht(k.x+48,k.y-48),ht(k.x-48,k.y+48)]}const E=[],P={x:_[0].x,y:_[0].y},b={x:_[1].x,y:_[1].y};if(p){const q=Math.round(b.x-P.x),k=Math.round(b.y-P.y);E.push(ht(P.x-q,P.y-k),ht(b.x,P.y-k),ht(b.x,b.y),ht(P.x-q,b.y))}else E.push(ht(P.x,P.y),ht(b.x,P.y),ht(b.x,b.y),ht(P.x,b.y));return he(jt([E.map(q=>i.localToMap(q)).filter(M.Ru)],i.spatialReference,i.doUnnormalization,!0),E,i)}(k,yt,this.centered)),dt.full=null!=dt.circle?dt.circle.geometry:dt.rectangle?.geometry,dt.outline="polygon"===dt.full?.type?dt.full:null;break}default:return null}return dt}initializeGraphic(e){return(0,K.hA)()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let i=null;if(this.drawOperation.isCompleted){const p=this._getCreateOperationGeometry({operationComplete:!0});null!=p&&(i=this._createOrUpdateGraphic(p.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:i,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return(0,K.hA)()}onCursorEdgeChanged(e){return(0,K.hA)()}onVertexAdd(e){ve(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||function Be(e,i){const{drawOperation:p,view:_}=i,E=re(i),P=oe(i);if("2d"===_.type||!e||"absolute-height"!==P.mode||1!==p?.numCommittedVertices||!E||"draw-polyline"!==E.type&&"draw-polygon"!==E.type||E.elevation.locked)return;const[b,q,k]=e,ot=function on(e,i,p,_,E){const{view:P,drawOperation:b}=E;if("3d"!==P.type||!b)return;p??=0;const q=Ht(E),k=oe(E),ot=(0,ee.Fo)(P,e,i,p,q,k,_);return(0,ge.Qc)(ot,q)??le(E)}(b,q,k,P,i);null!=ot&&E.elevation.lock(ot)}(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){ve(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,null!=e?(null!=e.cursorEdge?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),St.activeEdge):this.removeHandles(St.activeEdge),null!=e.outline?this.addHandles(this.onOutlineChanged(e.outline),St.outline):this.removeHandles(St.outline),null!=e.committedVertices?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),St.regularVertices):this.removeHandles(St.regularVertices),null!=e.cursorVertex?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),St.activeVertex):this.removeHandles(St.activeVertex),null!=e.full?this._createOrUpdateGraphic(e.full):this.removeHandles(ce)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?re(this._tooltipsContext):null}};(0,l._)([(0,T.MZ)()],pt.prototype,"_coordinateFormatterLoadTask",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"_createOperationGeometry",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"_tooltipsContext",null),(0,l._)([(0,T.MZ)({value:!0})],pt.prototype,"centered",null),(0,l._)([(0,T.MZ)()],pt.prototype,"cursor",null),(0,l._)([(0,T.MZ)({nonNullable:!0})],pt.prototype,"defaultZ",void 0),(0,l._)([(0,T.MZ)({constructOnly:!0})],pt.prototype,"directionOptions",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"drawOperation",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"elevationLockOnVertexAddDisabled",void 0),(0,l._)([(0,T.MZ)({value:!0})],pt.prototype,"enabled",null),(0,l._)([(0,T.MZ)({value:!0})],pt.prototype,"forceUniformSize",null),(0,l._)([(0,T.MZ)({constructOnly:!0})],pt.prototype,"geometryType",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"graphic",null),(0,l._)([(0,T.MZ)({constructOnly:!0})],pt.prototype,"graphicProperties",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"graphicSymbol",null),(0,l._)([(0,T.MZ)({constructOnly:!0})],pt.prototype,"hasZ",void 0),(0,l._)([(0,T.MZ)({constructOnly:!0})],pt.prototype,"geometryToPlace",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"mode",null),(0,l._)([(0,T.MZ)()],pt.prototype,"snappingManager",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"snapToScene",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"tooltip",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"tooltipInfos",void 0),(0,l._)([(0,T.MZ)({constructOnly:!0,type:Oe.A})],pt.prototype,"sketchOptions",void 0),(0,l._)([(0,T.MZ)()],pt.prototype,"updating",null),(0,l._)([(0,T.MZ)({constructOnly:!0,nonNullable:!0})],pt.prototype,"view",void 0),(0,l._)([(0,T.MZ)({constructOnly:!0})],pt.prototype,"undoRedo",null),(0,l._)([(0,T.MZ)()],pt.prototype,"activeTooltipInfo",null),pt=(0,l._)([(0,C.$)("esri.views.draw.DrawGraphicTool")],pt);const ce=Symbol("create-operation-graphic"),St={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function rn(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const an=48},68104:(It,vt,c)=>{c.d(vt,{O0:()=>z});var l=c(8189),$=c(98877),et=c(42425),ut=c(77806),X=c(11432),W=c(14784),T=c(56492),ft=c(43141),Y=c(48900),rt=c(67685),C=c(85211),U=(c(3248),c(35150),c(76576)),S=c(48237),H=c(56985),Z=c(94782),a=c(73812),m=c(23191);const g="click";class y{constructor({consumesClicks:O,grabbableForEvent:R}){this.events=new et.A,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=O,this.grabbableForEvent=R}destroy(){}intersectionDistance(O,R){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var D=c(5216),B=c(68736),K=c(46175),Q=c(63938),at=c(79765),nt=c(68129),lt=c(70789),G=c(86478),M=c(21783),x=c(10467),f=(c(40707),c(34150));let v=class extends $.A{constructor(h){var O;super(h),O=this,this.constrainResult=R=>R,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,T.sg)(function(){var R=(0,x.A)(function*(I,J,N,st){const j=O._frameTask;if(null==j)return;const it=yield j.schedule(()=>J.snap({...I,context:N,signal:st}),st);it.valid&&(yield j.schedule(()=>{O.stagedPoint=it.apply(),I!==O._snapPoints&&null!=O._snapPoints&&(O.stagedPoint=J.update({...O._snapPoints,context:N}))},st))});return function(I,J,N,st){return R.apply(this,arguments)}}())}get stagedPoint(){return this._stagedPoint}set stagedPoint(h){this._stagedPoint=this.constrainResult(h)}initialize(){const h="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=h?h.registerTask(f.W6.SNAPPING):f.nu}destroy(){this._abortController=(0,X.DC)(this._abortController),this._frameTask=(0,X.xt)(this._frameTask)}update(h,O,R){this._snapPoints=h;const{point:I,scenePoint:J}=h,N=O.update({point:I,scenePoint:J,context:R});return this.stagedPoint=N,N}snap(h,O,R){var I=this;return(0,x.A)(function*(){const{point:J,scenePoint:N}=h;return I.stagedPoint=O.update({point:J,scenePoint:N,context:R}),I._snapPoints=h,null==I._abortController&&(I._abortController=new AbortController),I._snap(h,O,R,I._abortController.signal)})()}snapAgainNearPreviousMapPoint(h,O){var R=this;return(0,x.A)(function*(){null!=R._snapPoints&&(yield R.snap(R._snapPoints,h,O))})()}abort(){this._abortController=(0,X.DC)(this._abortController),this._snapPoints=null}};(0,l._)([(0,C.MZ)({constructOnly:!0})],v.prototype,"view",void 0),(0,l._)([(0,C.MZ)()],v.prototype,"stagedPoint",null),(0,l._)([(0,C.MZ)()],v.prototype,"constrainResult",void 0),(0,l._)([(0,C.MZ)()],v.prototype,"_stagedPoint",void 0),v=(0,l._)([(0,U.$)("esri.views.interactive.snapping.SnappingOperation")],v);var w=c(3548);const tt=Symbol(),mt=Symbol();let z=class extends(et.A.EventedMixin($.A)){constructor(h){super(h),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new ft.A,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new H.U,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=(0,W.B)(nt.cx),this._getPolylineOrPolygonConstraint=(0,W.B)(nt.lJ),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new lt.A,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==h.elevationInfo&&(this.elevationInfo=(0,a.bK)(!!h.hasZ))}initialize(){const{geometryType:h,view:O}=this,R=O.spatialReference,I="viewingMode"in O.state?O.state.viewingMode:m.RT.Local,J="segment"===h||"multipoint"===h?"polyline":h;this.coordinateHelper=(0,D.BV)(this.hasZ,this.hasM,R),this._editGeometryOperations=new Q.p(new K.ZE(J,this.coordinateHelper),I),this._snappingOperation=new v({view:O}),this.addHandles([(0,Y.wB)(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:j,constraint:it},Et)=>{const{snappingOptions:Ut}=this;if(Ut&&(Ut.forceDisabled=null!=it&&(0,at.fT)(it)),null!=Et&&j===Et.stagedPoint&&it!==Et.constraint)return this._onKeyboardBasedChange();this._processCursor(j??this._screenToMap(this._stagedScreenPoint))},{equals:(j,it)=>j.stagedPoint===it.stagedPoint&&(0,X.CM)(j.constraint,it.constraint)}),(0,Y.wB)(()=>this.view.viewpoint,(j,it)=>{j&&it&&(0,S.Ui)(j,it)&&this._onKeyboardBasedChange()})]),this._activeComponent=new K.uA(R,I),this._editGeometryOperations.data.components.push(this._activeComponent);const N=this.segmentLabels;null!=N&&(N.context={view:O,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles((0,Y.wB)(()=>this.labelOptions.enabled,j=>{N.visible=j},Y.pc))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],j=>{const it=j.vertices.map(bt=>({componentIndex:0,vertexIndex:bt.index,coordinates:this.coordinateHelper.vectorToArray(bt.pos)})),Et=it.map(bt=>bt.coordinates),Ut=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;(0,Z.CI)(Ut,this.firstVertex)||(this.firstVertex=Ut);const Bt=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;(0,Z.CI)(Bt,this.lastVertex)||(this.lastVertex=Bt);const Lt=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch((0,Z.CI)(Lt,this.secondToLastVertex)||(this.secondToLastVertex=Lt),this._processCursor(this.cursorVertex),j.type){case"vertex-add":this.emit(j.type,{...j,added:Et,vertices:it});break;case"vertex-update":this.emit(j.type,{...j,updated:Et,vertices:it});break;case"vertex-remove":this.emit(j.type,{...j,removed:Et,vertices:it})}}));const st=this._manipulator=new y({consumesClicks:!1,grabbableForEvent:j=>"click"!==this.drawingMode||"touch"===j.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(st),st.grabbable="point"!==h&&"multipoint"!==h,this.addHandles([st.events.on("immediate-click",j=>this._onImmediateClick(j)),st.events.on("immediate-double-click",j=>this._onImmediateDoubleClick(j)),(0,Y.wB)(()=>this.drawingMode,()=>{this.removeHandles(tt),this.addHandles(this._createManipulatorDragPipeline(st),tt)},Y.pc),(0,Y.wB)(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:j})=>{st.cursor=j},Y.pc)]),(0,w.BY)(this,()=>{const it=this._getSnappingContext(this.view.inputManager.latestPointerType??"mouse");if(null!=this.snappingManager){const Et=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,it);this._updatingHandles.addPromise((0,T.QZ)(Et))}})}destroy(){(0,X.pR)(this.segmentLabels),(0,X.pR)(this._snappingOperation),this._editGeometryOperations=(0,X.pR)(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:h,_manipulator:O}=this;return null!=h&&this._pointerDownStates.has(h)||O.grabbing||!O.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const h=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==h}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(h=>this.coordinateHelper.vectorToArray(h.pos))}get _constraint(){const{constraints:h,constraintsEnabled:O}=this;if(h&&O)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(h);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,h)}}set drawingMode(h){this._set("drawingMode",h??g)}get effectiveCursor(){return this.loading?"progress":this._hideDefaultCursor?null:this.cursor||"crosshair"}get interactive(){return this._manipulator.interactive}set interactive(h){this._manipulator.interactive=h}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:h,lastVertex:O,firstVertex:R,geometryType:I}=this;return"polygon"===I&&(0,Z.fk)(h,R)||(0,Z.fk)(h,O)?null:h}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:h,committableVertex:O,coordinateHelper:R}=this,I=h.slice();return null!=O&&I.push(R.pointToArray(O)),I}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:h}=this;null!=h&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(h))}complete(h){const O=h?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:R,numCommittedVertices:I}=this,J="multipoint"===R&&0===I||"polyline"===R&&I<2||"polygon"===R&&I<3;"segment"!==R&&"point"!==R||this.commitStagedVertex(),this._createOperationCompleted=!J,(this.isCompleted||O)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((N,st)=>({componentIndex:0,vertexIndex:st,coordinates:N})),aborted:O,type:"complete"}))}onInputEvent(h){switch(h.type){case"pointer-down":this._pointerDownStates.add(h.pointerId);break;case"pointer-up":this._pointerDownStates.delete(h.pointerId)}switch(h.type){case"pointer-move":return this._onPointerMove(h);case"hold":return this._onHold(h)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(h){const O=(0,ut.o8)(this.cursorVertex),R=(0,ut.o8)(h),I=R&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(R)??R),J=this._snapToClosingVertex(I),N=this._applyConstraints(J);(0,Z.fk)(O,N)||(this._set("cursorVertex",N),this.segmentLabels?.set("stagedVertex",null!=N?this.coordinateHelper.pointToVector(N):null),null==N||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(N)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(h){if(null==h||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return h;const O=this._mapToScreen(h);if(!O)return h;const R=this._activeComponent;return this._vertexWithinPointerDistance(R.vertices[0].pos,O)?this.firstVertex:this._vertexWithinPointerDistance(R.vertices.at(-1).pos,O)?this.lastVertex:h}_createManipulatorDragPipeline(h){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(h);case"freehand":return this._createManipulatorDragPipelineFreehand(h);case"hybrid":return this._createManipulatorDragPipelineHybrid(h)}}_createManipulatorDragPipelineClick(h){return(0,B.Xt)(h,(O,R,I,J)=>{const N="touch"===J&&this._snappingEnabled;if(this.isCompleted||!N)return;const{snappingStep:st,cancelSnapping:j}=(0,M.L)({predicate:()=>N,snappingManager:this.snappingManager,snappingContext:new G.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:J,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});I=I.next(it=>(N&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),it)).next(j),R.next(this._screenToMapDragEventStep()).next(it=>("start"===it.action&&(this._processCursor(it.mapStart),("segment"===this.geometryType||N&&!this.numCommittedVertices)&&this.commitStagedVertex()),it)).next((0,B.pg)(this.view,this.elevationInfo)).next(...st).next(it=>(N&&(this._processCursor(it.mapEnd),"end"===it.action&&this.commitStagedVertex()),it)).next(it=>("end"===it.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),it))})}_createManipulatorDragPipelineFreehand(h){return(0,B.Xt)(h,(O,R)=>{this.isCompleted||R.next(this._screenToMapDragEventStep()).next(I=>("start"===I.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(I.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),I)).next(I=>{switch(I.action){case"start":case"update":this._processCursor(I.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return I})})}_createManipulatorDragPipelineHybrid(h){return(0,B.Xt)(h,(O,R)=>{this.isCompleted||R.next(this._screenToMapDragEventStep()).next(I=>("start"===I.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),mt),this._processCursor(I.mapStart),this.commitStagedVertex()),I)).next(I=>{switch(I.action){case"start":case"update":this._processCursor(I.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(mt),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return I})})}get _drawAtFixedElevation(){const{constraintsEnabled:h,constraintZ:O,geometryType:R,numCommittedVertices:I}=this;return h?null!=O||"segment"===R&&I>0:("segment"===R||"polygon"===R)&&I>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:h,coordinateHelper:O,drawSurface:R,elevationDrawSurface:I,snapToSceneEnabled:J}=this;if(null==I)return R;if(!this.hasZ)return I.defaultZ=null,I;const N=this.elevationInfo?.mode;let st=this.defaultZ,j=h||"absolute-height"===N;return null!=J&&(j=J),"on-the-ground"===N&&(j=!1),this._drawAtFixedElevation&&(st=(h?this.constraintZ:null)??O.getZ(this._activeComponent.vertices[0].pos),j=!1),j?R:(I.defaultZ=st,I)}_mapToScreen(h){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(h)}_onHold(h){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===h.pointerType&&this._snappingEnabled&&this._processCursor(h.mapPoint),h.stopPropagation()}_onImmediateClick(h){if(!("mouse"===h.pointerType&&2===h.button||this._manipulator.dragging))try{const{drawingMode:O,geometryType:R}=this;this._stagedPointerType=h.pointerType,this._stagedScreenPoint=h.screenPoint;const I=this._screenToMap(h.screenPoint);if(null==I||null==I||"freehand"===O&&"point"!==R&&"multipoint"!==R)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(I),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==h.pointerType&&this._processCursor(null),("freehand"===O&&"multipoint"!==this.geometryType||"point"===R||"segment"===R&&2===this.numCommittedVertices||"segment"===R&&"hybrid"===O&&1===this.numCommittedVertices)&&this.complete()}finally{h.stopPropagation()}}_onImmediateDoubleClick(h){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),h.stopPropagation())}_onPointerMove(h){const O=(0,rt.tc)(h.x,h.y);this._stagedScreenPoint=O,this._stagedPointerType=h.pointerType,this._stagedPointerId=h.pointerId,this._isDragging?this._snappingOperation.abort():(h.stopPropagation(),this._processCursorMovementRelativeToSurface(O,h.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(h,O){const R=this._snappingOperation,I=this._screenToMap(h),J=this._requiresScenePoint?this.drawSurface?.screenToMap(h):null;if(null==I)return this._hideDefaultCursor=!0,this._processCursor(null),void R.abort();this._hideDefaultCursor=!1;const N=this.snappingManager;if(null==N)return this._processCursor(I),void R.abort();const st=this._getSnappingContext(O);this._updatingHandles.addPromise((0,T.QZ)(R.snap({point:I,scenePoint:J},N,st)))}_applyConstraints(h){const{_constraint:O,constraints:R}=this;if(!h||!R||!O)return h;const{context:I}=R,J=(0,nt.dz)(h,I),N=J?O.closestTo(J):void 0;if(!N)return h;const st=(0,nt.tC)(N,h,I);return null!=st&&("2d"===this.view.type||"absolute-height"!==I.elevationInfo.mode)&&null!=this.constraintZ&&this.hasZ&&(st.z=this.constraintZ),st}_screenToMap(h){return h?this._updateAndGetEffectiveDrawSurface()?.screenToMap(h):null}_screenToMapDragEventStep(){let h=null;return O=>{if("start"===O.action&&(h=this._screenToMap(O.screenStart)),null==h)return null;const R=this._screenToMap(O.screenEnd);return null!=R?{...O,mapStart:h,mapEnd:R}:null}}_vertexWithinPointerDistance(h,O){const I=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(h));return null!=I&&function Pt(h,O,R){const I=h.x-O.x,J=h.y-O.y;return I*I+J*J<=R}(I,O,25)}_getSnappingContext(h){const O=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new G.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:h,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=O?{value:O,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};(0,l._)([(0,C.MZ)()],z.prototype,"_hideDefaultCursor",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"_stagedPointerId",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"_isDragging",null),(0,l._)([(0,C.MZ)()],z.prototype,"_snappingOperation",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"_snappingEnabled",null),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"graphic",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"constraintsEnabled",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"constraints",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"_constraint",null),(0,l._)([(0,C.MZ)()],z.prototype,"constraintZ",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"defaultZ",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"isDraped",void 0),(0,l._)([(0,C.MZ)({value:g})],z.prototype,"drawingMode",null),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"elevationDrawSurface",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"elevationInfo",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0,type:lt.A})],z.prototype,"labelOptions",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"geometryType",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"hasM",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"hasZ",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"cursor",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"effectiveCursor",null),(0,l._)([(0,C.MZ)()],z.prototype,"loading",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"manipulators",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"drawSurface",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"segmentLabels",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"snappingManager",void 0),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"snappingVisualizer",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"snapToSceneEnabled",void 0),(0,l._)([(0,C.MZ)({readOnly:!0})],z.prototype,"cursorVertex",null),(0,l._)([(0,C.MZ)({readOnly:!0})],z.prototype,"visualizationCursorVertex",null),(0,l._)([(0,C.MZ)()],z.prototype,"committableVertex",null),(0,l._)([(0,C.MZ)()],z.prototype,"firstVertex",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"lastVertex",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"secondToLastVertex",void 0),(0,l._)([(0,C.MZ)()],z.prototype,"updating",null),(0,l._)([(0,C.MZ)({constructOnly:!0})],z.prototype,"view",void 0),z=(0,l._)([(0,U.$)("esri.views.draw.DrawOperation")],z)},74502:(It,vt,c)=>{c.d(vt,{IX:()=>ft,rT:()=>T,uF:()=>Y});var l=c(67685),$=c(1749),et=c(32034),ut=c(8675),X=c(97669),W=c(73812);class T{constructor(L,A,U,S=null){this._elevationInfo=L,this.defaultZ=A,this._view=U,this._excludeGraphics=S}screenToMap(L){const{defaultZ:A,_view:U}=this,S=U.sceneIntersectionHelper.intersectElevationFromScreen((0,l.gs)(L.x,L.y),this._elevationInfo,A??0,this._excludeGraphics);return null==A&&null!=S&&(S.z=void 0),S}mapToScreen(L){const A=(0,ut.T)(L.x,L.y,(0,W.wS)(this._view,L,this._elevationInfo),L.spatialReference);return this._view.toScreen(A)}constrainZ(L){const{defaultZ:A}=this;return null!=A&&L.z!==A&&((L=(0,X.EL)(L)).z=A),L}}class ft{constructor(L,A,U=[]){this.view=L,this.elevationInfo=A,this.exclude=U}screenToMap(L){const A=this.view.toMap(L,{exclude:this.exclude,excludeLabels:!0});return null!=A&&(A.z=(0,W.id)(A,this.view,this.elevationInfo)),A}mapToScreen(L){let A=L;return null!=this.elevationInfo&&(A=(0,ut.T)(L.x,L.y,(0,W.wS)(this.view,L,this.elevationInfo),L.spatialReference)),this.view.toScreen(A)}constrainZ(L){return L}}class Y{constructor(L,A=!1,U=0){this.view=L,this.hasZ=A,this.defaultZ=U,this.mapToScreen=S=>L.toScreen(S),this.screenToMap=A?S=>{const H=L.toMap(S);return H.z=U,H}:S=>L.toMap(S)}constrainZ(L){const{defaultZ:A}=this;return this.hasZ&&L.z!==A&&((L=(0,X.EL)(L)).z=A),L}}class rt{screenToMap(L){const{x:A,y:U}=L;return new $.A({x:A,y:U,spatialReference:rt.spatialReference})}mapToScreen(L){return(0,l.tc)(L.x,L.y)}constrainZ(L){return L}}rt.spatialReference=new et.A},97167:(It,vt,c)=>{c.d(vt,{g:()=>A});var C,U,l=c(8189),$=c(98877),X=(c(3248),c(35150),c(56492)),W=c(85211),ft=(c(40707),c(76576)),Y=c(29014),rt=c(31178);(U=C||(C={}))[U.WhenToolEditable=0]="WhenToolEditable",U[U.WhenToolNotEditable=1]="WhenToolNotEditable",U[U.Always=2]="Always";class L{constructor(){this._isToolEditable=!0,this._manipulators=new rt.A,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(S){this._isToolEditable=S}get length(){return this._manipulators.length}add(S,H=C.WhenToolEditable){this.addMany([S],H)}addMany(S,H=C.WhenToolEditable){for(const Z of S){const a={manipulator:Z,visibilityPredicate:H,attached:!1};this._manipulators.add(a),this._attached&&this._updateManipulatorAttachment(a)}}remove(S){for(let H=0;H<this._manipulators.length;H++)if(this._manipulators.at(H).manipulator===S){const Z=this._manipulators.splice(H,1)[0];this._detachManipulator(Z);break}}removeAll(){this._manipulators.forEach(S=>{this._detachManipulator(S)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(S=>{this._updateManipulatorAttachment(S)}),this._attached=!0}detach(){this._manipulators.forEach(S=>{this._detachManipulator(S)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:S})=>S.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(S,H){return this._manipulators.on(S,Z=>{H(Z)})}forEach(S){for(const H of this._manipulators.items)S(H)}some(S){return this._manipulators.items.some(S)}toArray(){const S=[];return this.forEach(H=>S.push(H.manipulator)),S}intersect(S,H){let Z=null,a=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:m,attached:u})=>{if(!u||!m.interactive)return;const g=m.intersectionDistance(S,H);null!=g&&g<a&&(a=g,Z=m)}),Z}_updateManipulatorAttachment(S){this._isManipulatorItemVisible(S)?this._attachManipulator(S):this._detachManipulator(S)}_attachManipulator(S){S.attached||(S.manipulator.attach&&S.manipulator.attach(this._resourceContexts),S.attached=!0)}_detachManipulator(S){if(!S.attached)return;const H=S.manipulator;H.grabbing=!1,H.dragging=!1,H.hovering=!1,H.selected=!1,H.detach&&H.detach(this._resourceContexts),S.attached=!1}_isManipulatorItemVisible(S){return S.visibilityPredicate===C.Always||(this._isToolEditable?S.visibilityPredicate===C.WhenToolEditable:S.visibilityPredicate===C.WhenToolNotEditable)}}let A=class extends $.A{constructor(U){super(U),this.manipulators=new L,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Y.PK.MANAGER,!0],[Y.PK.USER,!0]]),this._creationFinishedResolver=(0,X.Tw)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(U){this._get("visible")!==U&&(this._set("visible",U),this._syncVisible())}get editable(){return this.getEditableFlag(Y.PK.USER)}set editable(U){this.setEditableFlag(Y.PK.USER,U)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(U){this.onInputEvent(U)}handleInputEventAfter(U){this.onInputEventAfter(U)}setEditableFlag(U,S){this._editableFlags.set(U,S),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),U===Y.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(U){return this._editableFlags.get(U)??!1}endDrag(){const U=this.view.inputManager.latestPointerLocation;if(!U)return;let S=!1;this.manipulators.forEach(({manipulator:H})=>{H.dragging&&(S=!0,H.events.emit("drag",{action:"end",start:U,screenPoint:U}))}),S&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(U){}onInputEventAfter(U){}get internallyEditable(){return this.getEditableFlag(Y.PK.USER)&&this.getEditableFlag(Y.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,l._)([(0,W.MZ)({constructOnly:!0})],A.prototype,"view",void 0),(0,l._)([(0,W.MZ)({readOnly:!0})],A.prototype,"active",null),(0,l._)([(0,W.MZ)({value:!0})],A.prototype,"visible",null),(0,l._)([(0,W.MZ)({value:!0})],A.prototype,"editable",null),(0,l._)([(0,W.MZ)({readOnly:!0})],A.prototype,"manipulators",void 0),(0,l._)([(0,W.MZ)({readOnly:!0})],A.prototype,"updating",null),(0,l._)([(0,W.MZ)()],A.prototype,"cursor",null),(0,l._)([(0,W.MZ)({readOnly:!0})],A.prototype,"automaticManipulatorSelection",void 0),(0,l._)([(0,W.MZ)()],A.prototype,"hasFocusedManipulators",null),(0,l._)([(0,W.MZ)()],A.prototype,"hasGrabbedManipulators",void 0),(0,l._)([(0,W.MZ)()],A.prototype,"hasHoveredManipulators",void 0),(0,l._)([(0,W.MZ)()],A.prototype,"firstGrabbedManipulator",void 0),(0,l._)([(0,W.MZ)({readOnly:!0})],A.prototype,"created",void 0),(0,l._)([(0,W.MZ)({readOnly:!0})],A.prototype,"removeIncompleteOnCancel",void 0),A=(0,l._)([(0,ft.$)("esri.views.interactive.InteractiveToolBase")],A)},68736:(It,vt,c)=>{c.d(vt,{EX:()=>D,RS:()=>G,Tp:()=>K,Wp:()=>U,Xt:()=>L,an:()=>A,bl:()=>m,dp:()=>g,mc:()=>y,pg:()=>nt,rh:()=>at,sO:()=>B,y$:()=>a});var l=c(89952),ut=(c(3248),c(77806),c(69287)),X=c(67685),W=c(13970),T=c(78559),ft=c(97669),Y=c(73812),rt=c(63938);function L(M,x){return M.events.on("drag",function C(M,x){let d=null,f=null;return v=>{if("cancel"===v.action)return void(null!=f&&(f.execute({action:"cancel"}),d=null,f=null));const w={action:v.action,screenStart:v.start,screenEnd:v.screenPoint};"start"===v.action&&null==d&&(d=new at,f=new at,x(M,d,f,v.pointerType,w)),d?.execute(w),"end"===v.action&&null!=d&&(d=null,f=null)}}(M,x))}function A(M,x){const d=[M.x,M.y,M.z??0],f=x,v=[Math.cos(f),Math.sin(f)],w=Math.sqrt(v[0]*v[0]+v[1]*v[1]);if(0===w)return null;v[0]/=w,v[1]/=w;const V=F=>{const tt=(F.x-d[0])*v[0]+(F.y-d[1])*v[1];F.x=d[0]+tt*v[0],F.y=d[1]+tt*v[1]};return F=>(V(F.mapStart),V(F.mapEnd),{...F,axis:v})}function U(M){let x=null;return d=>{if("start"===d.action&&(x=function H(M,x){const d=M.operations;if(!d)return null;const f=d.data.geometry,v=(0,ft.RS)(x);if(f.spatialReference.equals(v))return Z(M,d,()=>{});if("mesh"!==f.type){const w=S(f,v);if(null==w)return null;const V=f.spatialReference;return Z(M,rt.p.fromGeometry(w,d.viewingMode),()=>{const F=(0,W.project)(f,V);d.trySetGeometry(F)})}if((0,T.CK)(f)){const w=S(f.origin,v);if(!w)return null;const V=f.spatialReference,F=rt.p.fromGeometry(w,d.viewingMode);return Z(M,d,()=>{const tt=(0,W.project)(F.data.geometry,V);d.move(tt.x-f.origin.x,tt.y-f.origin.y,(tt.z??0)-(f.origin.z??0))})}return null}(M,d.mapStart.spatialReference)),null==x)return null;const f=d.mapEnd.x-d.mapStart.x,v=d.mapEnd.y-d.mapStart.y,w=(d.mapEnd.z??0)-(d.mapStart.z??0);return x.move(f,v,w,d.action),{...d,translationX:f,translationY:v,translationZ:w}}}function S(M,x){return null==M?null:M.spatialReference.equals(x)?M.clone():(0,W.project)(M,x)}function Z(M,x,d){let f=0,v=0,w=0;return{move:(V,F,tt,mt)=>{"start"===mt&&(f=0,v=0,w=0);const z=V-f,Pt=F-v,h=tt-w;x.move(z,Pt,h),f+=z,v+=Pt,w+=h,d(),"end"===mt&&M.endInteraction?.()}}}function a(M,x=null,d){let f=null;const v=null==x||M.spatialReference?.equals(x)?V=>V:V=>null!=V?(0,W.project)(V,x):V,w={exclude:[],...d};return V=>{if("start"===V.action&&(f=v(M.toMap(V.screenStart,w))),null==f)return null;const F=v(M.toMap(V.screenEnd,w));return null!=F?{...V,mapStart:f,mapEnd:F}:null}}function m(M){const x=M.map(d=>U(d)).filter(l.Ru);return d=>{const f=d.mapEnd.x-d.mapStart.x,v=d.mapEnd.y-d.mapStart.y,w=d.mapEnd.z-d.mapStart.z;return x.forEach(V=>V(d)),{...d,translationX:f,translationY:v,translationZ:w}}}function g(M){const x=M.operations?.createResetState();return d=>(x?.remove(),d)}function y(M){const x=M.map(d=>g(d)).filter(d=>null!=d);return d=>(x.forEach(f=>f(d)),d)}function D(){let M=0,x=0,d=0;return f=>{"start"===f.action&&(M=f.mapStart.x,x=f.mapStart.y,d=f.mapStart.z);const v=f.mapEnd.x-M,w=f.mapEnd.y-x,V=f.mapEnd.z-d;return M=f.mapEnd.x,x=f.mapEnd.y,d=f.mapEnd.z,{...f,mapDeltaX:v,mapDeltaY:w,mapDeltaZ:V,mapDeltaSpatialReference:f.mapStart.spatialReference}}}function B(){let M=0,x=0;return d=>{"start"===d.action&&(M=d.screenStart.x,x=d.screenStart.y);const f=d.screenEnd.x-M,v=d.screenEnd.y-x;return M=d.screenEnd.x,x=d.screenEnd.y,{...d,screenDeltaX:f,screenDeltaY:v}}}function K(M,x){let d=null,f=0,v=0;return w=>{if("start"===w.action&&(d=M.toScreen?.(x),null!=d&&(d.x<0||d.x>M.width||d.y<0||d.y>M.height?d=null:(f=w.screenStart.x-d.x,v=w.screenStart.y-d.y))),null==d)return null;const V=(0,ut.qE)(w.screenEnd.x-f,0,M.width),F=(0,ut.qE)(w.screenEnd.y-v,0,M.height),tt=(0,X.tc)(V,F);return w.screenStart=d,w.screenEnd=tt,w}}const Q=()=>{};class at{constructor(){this.execute=Q}next(x,d=new at){return null!=x&&(this.execute=f=>{const v=x(f);null!=v&&d.execute(v)}),d}}function nt(M,x,d=[]){if("2d"===M.type)return v=>v;let f=null;return v=>{"start"===v.action&&(f=M.toMap(v.screenStart,{exclude:d}),null!=f&&(f.z=(0,Y.id)(f,M,x)));const w=M.toMap(v.screenEnd,{exclude:d});null!=w&&(w.z=(0,Y.id)(w,M,x));const V=null!=f&&null!=w?{sceneStart:f,sceneEnd:w}:null;return{...v,scenePoints:V}}}function lt(M,x,d){const f=x.elevationProvider.getElevation(M.x,M.y,M.z??0,M.spatialReference,"scene")??0,v=(0,ft.EL)(M);return v.z=f,v.hasZ=!0,v.z=(0,Y.id)(v,x,d),v}function G(M,x){if("2d"===M.type)return f=>f;let d=null;return f=>{"start"===f.action&&(d=lt(f.mapStart,M,x));const v=lt(f.mapEnd,M,x),w=null!=d&&null!=v?{sceneStart:d,sceneEnd:v}:null;return{...f,scenePoints:w}}}},53950:(It,vt,c)=>{c.d(vt,{Bb:()=>rt,G3:()=>H,fJ:()=>C});var l=c(83953),$=c(28714),et=c(25866),ut=c(33096),X=c(19741),W=c(97465),T=c(58059),ft=c(21724),Y=c(39116);function rt(Z,a){return L(Z,a,!1)}function C(Z,a){return L(Z,a,!0)}function L(Z,a,m){if(Z instanceof Y.D){if(Z.operation instanceof W.a)return function A(Z,a,m=!1){const u=m?-1:1,g=(0,et.fA)(u*Z.dx,u*Z.dy,u*Z.dz);(0,$.g)(a.origin,a.origin,g),(0,ut.u)(a)}(Z.operation,a,m),!0;if(Z.operation instanceof T.m)return function U(Z,a,m=!1){const u=m?-Z.angle:Z.angle;(0,$.L)(a.basis1,a.basis1,et.uY,u),(0,$.L)(a.basis2,a.basis2,et.uY,u),(0,ut.u)(a)}(Z.operation,a,m),!0;if(Z.operation instanceof ft.j)return function S(Z,a,m=!1){const u=m?1/Z.factor1:Z.factor1,g=m?1/Z.factor2:Z.factor2;(0,$.h)(a.basis1,a.basis1,u),(0,$.h)(a.basis2,a.basis2,g),(0,l.Vj)(a.origin,a.origin,Z.origin,Z.axis1,u),(0,l.Vj)(a.origin,a.origin,Z.origin,Z.axis2,g),(0,ut.u)(a)}(Z.operation,a,m),!0}return!1}function H(Z,a,m,u,g=!1){u||(u=(0,ut.d)());const y=(0,l.hZ)(X.oG.get(),Z[1],-Z[0]),D=(0,l.hZ)(X.oG.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),B=(0,l.hZ)(X.oG.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),K=X.oG.get(),Q=a.allVertices;Q.forEach(({pos:G})=>{(0,l.hZ)(K,(0,l.Om)(Z,G),(0,l.Om)(y,G)),(0,l.jk)(D,D,K),(0,l.T9)(B,B,K)});const nt=(0,l.hZ)(X.oG.get(),B[0]-D[0]<1e-6?m/2:0,B[1]-D[1]<1e-6?m/2:0);(0,l.Re)(D,D,nt),(0,l.WQ)(B,B,nt);const lt=g?Q.reduce((G,M)=>G+(M.pos[2]??0),0)/Q.length:0;return(0,l.hs)(u.basis1,Z,(B[0]-D[0])/2),(0,l.hs)(u.basis2,y,(B[1]-D[1])/2),(0,$.i)(u.origin,D[0]*Z[0]+D[1]*y[0],D[0]*Z[1]+D[1]*y[1],lt),(0,$.g)(u.origin,u.origin,u.basis1),(0,$.g)(u.origin,u.origin,u.basis2),(0,ut.u)(u),u}},68129:(It,vt,c)=>{c.d(vt,{cx:()=>a,dz:()=>y,hj:()=>L,lJ:()=>m,tC:()=>D});var l=c(81142),$=c(82663),et=c(28714),ut=c(32034),X=c(44929),W=c(79283),T=c(8675),ft=c(73812),Y=c(79765),rt=c(29280),C=c(12724);function L(G,M,x,d,f,v){let w="geodesic",V=(0,W.Xn)(x);const F=(0,rt.Hh)();return(0,rt.vf)(G,M,d,F),F[2]=0,V&&(0,X.F)(F,x,F,V)||(w="euclidean",V=x),{mode:w,view:M,elevationInfo:d,hasZ:f,directionMode:v,spatialReference:G.spatialReference,measurementSR:V,origin:F}}function A(G,M,x){if(null==M||null==G)return;const d=(0,$._H)(x.measurementSR);if(null==d)return;const f=y(G,x);if(null==f)return;const v=(0,l.l3)(M,d);return new Y.ej(f,v)}function U(G,M,x,d){if(null==x||null==G)return;const f=y(G,d);if(null==f)return;const v=(0,C.hF)(x),V=tt=>{if(null==tt)return;const mt=(0,rt.Hh)(),z=(0,l.Wq)(tt,"degrees","geographic");return(0,C.rT)(mt,f,d.measurementSR,10,z,d.mode)?new Y.FX(f,mt):void 0},F=()=>{if(null!=M&&null!=G)return(0,C.hF)((0,C.$h)(M,G))};switch(d.directionMode){case C.rZ.Absolute:return V(v);case C.rZ.Relative:{const tt=F();return null==tt?void 0:V(tt+v)}case C.rZ.RelativeBilateral:{const tt=F();return null==tt?void 0:(0,Y.xW)([V(tt+v),V(tt-v)])}}}function S(G,M){const x=B(G,M);return null!=x?new Y.qR(x):void 0}function H(G,M,x){const{context:d,longitude:f,latitude:v,direction:w,distance:V,elevation:F}=x;if(null!=f||null!=v||null!=V||null!=F||null!=w){if(null!=f||null!=v){const tt=(0,C.hF)(f),mt=(0,C.hF)(v),z=B(F,d);return new Y.QT(tt,mt,z)}return function Z(G,M,{context:x,direction:d,distance:f,elevation:v}){if(null==M)return S(v,x);const{view:w,elevationInfo:V,measurementSR:F}=x,tt=(0,rt.vf)(M,w,V);if(!F||!(0,X.F)(tt,M.spatialReference,Q,F))return;const[mt,z]=Q,Pt=null!=f?(0,l.l3)(f,"meters"):void 0,h=(0,C.hF)(d),O=B(v,x),R=J=>{const N=new Y.jf([mt,z],F,Pt,O,J);return null==Pt||null==J||null==O&&x.hasZ?N:new Y.i7(N.closestTo(tt))};if(null==h)return R(void 0);const I=()=>{if(null!=G&&null!=M)return(0,C.hF)((0,C.$h)(G,M))};switch(x.directionMode){case C.rZ.Absolute:return R(h);case C.rZ.Relative:{const J=I();return null==J?void 0:R(J+h)}case C.rZ.RelativeBilateral:{const J=I();return null==J?void 0:(0,Y.xW)([R(J+h),R(J-h)])}}}(G,M,x)}}function a(G){return"geodesic"===G.context.mode?H(null,null,G):u(G)}function m(G,M,x){const{context:d,x:f,y:v,distance:w,direction:V,elevation:F}=x;return"geodesic"===d.mode?H(M,G,x):null!=f||null!=v?u(x):function g(G){let M;for(const x of G)x&&(M=M?.intersect(x)??x);return M}([A(G,w,d),U(G,M,V,d),S(F,d)])}function u({x:G,y:M,elevation:x,context:d}){lt.x=G?.value??0,lt.y=M?.value??0,lt.spatialReference=d.spatialReference;const f=y(lt,d,at);return new Y.QT(null!=G&&null!=f?f[0]:void 0,null!=M&&null!=f?f[1]:void 0,B(x,d))}function y(G,M,x=(0,rt.Hh)()){const{view:d,elevationInfo:f,measurementSR:v,origin:w,mode:V}=M;if((0,rt.vf)(G,d,f,x),(0,X.F)(x,G.spatialReference,x,v))return"geodesic"!==V&&(0,et.d)(x,x,w),x}function D(G,M,x,d){const{view:f,measurementSR:v,spatialReference:w,origin:V,mode:F}=x;if("geodesic"===F?(0,et.c)(nt,G):(0,et.g)(nt,G,V),(0,X.F)(nt,v,nt,w))return(0,rt.xF)(nt,f,M,x,d)}function B(G,M){return function K(G,{view:M,origin:x,elevationInfo:d,hasZ:f,measurementSR:v}){if(null==G||!f)return;const w=(0,$.mq)(v);if(null==w)return;const[V,F]=x,tt=(0,l.l3)(G,w),mt="3d"===M?.type?(0,ft.Fo)(M,V,F,tt,v,d):tt;return null!=mt?(0,l.d_)(mt,w):void 0}(G,M)?.value??void 0}const Q=(0,rt.Hh)(),at=(0,rt.Hh)(),nt=(0,rt.Hh)(),lt=(0,T.T)(0,0,0,ut.A.WGS84)},21783:(It,vt,c)=>{c.d(vt,{L:()=>C});var l=c(10467),$=c(11432),et=c(56492),ut=c(48900),X=c(94782),W=c(97669),T=c(73812),ft=c(68736),Y=c(86478),rt=c(34150);function C({predicate:g=(()=>!0),snappingManager:y,snappingContext:D,updatingHandles:B,useZ:K=!0}){const Q=new ft.rh;if(null==y)return{snappingStep:[u,Q],cancelSnapping:u};let at,nt=null,lt=null,G=null;const M=()=>{nt=(0,$.DC)(nt),y.doneSnapping(),lt?.frameTask.remove(),lt=null,at=(0,$.xt)(at),G=null},x=function L(g,y,D){return(0,et.sg)(function(){var B=(0,l.A)(function*({frameTask:K,point:Q,scenePoint:at,context:nt,event:lt,delta:G,getLastState:M},x){const d=yield K.schedule(()=>g.snap({point:Q,scenePoint:at,context:nt,signal:x}),x);if(d.valid){let f=yield K.schedule(()=>d.apply(),x);const v=M();null!=v.point&&Q!==v.point&&(f=g.update({point:v.point,scenePoint:v.scenePoint,context:nt})),null!=v.updatePoint&&(0,X.CI)(f,v.updatePoint)||(a(lt.mapEnd,f,G,y),D.execute(lt))}});return function(K,Q){return B.apply(this,arguments)}}())}(y,K,Q);let d=null,f=null,v=null;return{snappingStep:[w=>{if(!g(w))return w;const{action:V}=w;if("start"===V){const{info:F}=w,tt=function A(g){return"3d"===g.type?g.resourceController.scheduler.registerTask(rt.W6.SNAPPING):rt.nu}(y.view);if(lt=function U(g,y,D){return{context:new Y.e({editGeometryOperations:g.editGeometryOperations,elevationInfo:g.elevationInfo,pointer:g.pointer,vertexHandle:null!=y.info?y.info.handle:null,excludeFeature:g.excludeFeature,feature:g.feature,visualizer:g.visualizer}),originalPos:null!=y.snapOrigin?g.coordinateHelper.vectorToDehydratedPoint(y.snapOrigin):y.mapStart,originalScenePos:null!=y.scenePoints?y.scenePoints.sceneStart:null,frameTask:D}}(D,w,tt),lt.context.selfSnappingZ=null,!K&&null!=F){const mt=function m(g,y){if(!g.hasZ())return null;const D=y.vertices;let B=null;for(const K of D){const Q=g.getZ(K.pos);if(null!=B&&null!=Q&&Math.abs(Q-B)>1e-6)return null;null==B&&(B=Q)}return B}(D.coordinateHelper,F.handle.component);null!=mt&&(lt.context.selfSnappingZ={value:mt,elevationInfo:D.elevationInfo??T.qt})}}if(null!=lt){const{context:F,originalScenePos:tt,originalPos:mt}=lt,{mapEnd:z,mapStart:Pt,scenePoints:h}=w,O=S(mt,Z(z,Pt)),R=Z(Pt,mt),I={...w,action:"update"},J=lt.context,N=function H(g,y){return null==g||null==y?null:S(g,Z(y.sceneEnd,y.sceneStart))}(tt,h),st=y.update({point:O,scenePoint:N,context:F});if(v=st,a(z,st,R,K),d=O,f=N,"end"!==V){const{frameTask:j}=lt;null==nt&&(nt=new AbortController),G=it=>{B.addPromise((0,et.QZ)(x({frameTask:j,event:I,context:J,point:O,scenePoint:N,delta:R,getLastState:()=>({point:d,scenePoint:f,updatePoint:it.forceUpdate?null:v})},nt.signal)))},G({forceUpdate:!1}),null==at&&(at=(0,ut.wB)(()=>y.options.effectiveEnabled,()=>G?.({forceUpdate:!0})))}}return"end"===V&&M(),w},Q],cancelSnapping:w=>(M(),w)}}function S(g,[y,D,B]){const K=(0,W.EL)(g);return K.x+=y,K.y+=D,K.hasZ&&(K.z+=B),K}function Z(g,y){return[g.x-y.x,g.y-y.y,g.hasZ&&y.hasZ?g.z-y.z:0]}function a(g,y,[D,B,K],Q){g.x=y.x+D,g.y=y.y+B,Q&&g.hasZ&&y.hasZ&&(g.z=y.z+K)}function u(g){return g}}}]);