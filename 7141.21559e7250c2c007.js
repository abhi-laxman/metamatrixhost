"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[7141],{29430:(Oe,le,_)=>{_.d(le,{$:()=>z,IB:()=>te,Iy:()=>Ze,N2:()=>W,QP:()=>De,RH:()=>Me,Vl:()=>Ue,Ws:()=>ge,ZD:()=>ce,_L:()=>pe,bJ:()=>xe,e$:()=>ue,f6:()=>Je,pW:()=>Ae,pf:()=>$e});var F=_(68677),Z=_(89952),ie=_(77806),oe=(_(69287),_(53781),_(89141));function te(l){return"r"in l&&"g"in l&&"b"in l}function ee(l){return"h"in l&&"s"in l&&"v"in l}function U(l){return"l"in l&&"a"in l&&"b"in l}function N(l){return"l"in l&&"c"in l&&"h"in l}const C=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],x=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function D(l,P){const A=[];let E,O;if(l[0].length!==P.length)throw new Error("dimensions do not match");const K=l.length,H=l[0].length;let he=0;for(E=0;E<K;E++){for(he=0,O=0;O<H;O++)he+=l[E][O]*P[O];A.push(he)}return A}function g(l){const P=[l.r/255,l.g/255,l.b/255].map(E=>E<=.04045?E/12.92:((E+.055)/1.055)**2.4),A=D(C,P);return{x:100*A[0],y:100*A[1],z:100*A[2]}}function M(l){const P=D(x,[l.x/100,l.y/100,l.z/100]).map(A=>Math.min(1,Math.max(A<=.0031308?12.92*A:1.055*A**.4166666666666667-.055,0)));return{r:Math.round(255*P[0]),g:Math.round(255*P[1]),b:Math.round(255*P[2])}}function w(l){const P=[l.x/95.047,l.y/100,l.z/108.883].map(A=>A>.008856451679035631?A**.3333333333333333:7.787037037037035*A+.13793103448275862);return{l:116*P[1]-16,a:500*(P[0]-P[1]),b:200*(P[1]-P[2])}}function re(l){const P=l.l,A=[(P+16)/116+l.a/500,(P+16)/116,(P+16)/116-l.b/200].map(E=>E>6/29?E**3:3*(6/29)**2*(E-4/29));return{x:95.047*A[0],y:100*A[1],z:108.883*A[2]}}function z(l){return te(l)?l:N(l)?function me(l){return M(re(function ye(l){const A=l.c,E=l.h;return{l:l.l,a:A*Math.cos(E),b:A*Math.sin(E)}}(l)))}(l):U(l)?function be(l){return M(re(l))}(l):function I(l){return"x"in l&&"y"in l&&"z"in l}(l)?M(l):ee(l)?function S(l){const P=(l.h+360)%360/60,E=l.v/100*255,O=E*(l.s/100),K=O*(1-Math.abs(P%2-1));let H;switch(Math.floor(P)){case 0:H={r:O,g:K,b:0};break;case 1:H={r:K,g:O,b:0};break;case 2:H={r:0,g:O,b:K};break;case 3:H={r:0,g:K,b:O};break;case 4:H={r:K,g:0,b:O};break;case 5:case 6:H={r:O,g:0,b:K};break;default:H={r:0,g:0,b:0}}return H.r=Math.round(H.r+E-O),H.g=Math.round(H.g+E-O),H.b=Math.round(H.b+E-O),H}(l):l}function W(l){return ee(l)?l:function v(l){const P=l.r,A=l.g,E=l.b,O=Math.max(P,A,E),K=O-Math.min(P,A,E);let H=O,he=0===K?0:O===P?(A-E)/K%6:O===A?(E-P)/K+2:(P-A)/K+4,_e=0===K?0:K/H;return he<0&&(he+=6),he*=60,_e*=100,H*=100/255,{h:he,s:_e,v:H}}(z(l))}function ce(l){return U(l)?l:function Ce(l){return w(g(l))}(z(l))}function Me(l){return N(l)?l:function Pe(l){return function k(l){const P=l.l,A=l.a,E=l.b,O=Math.sqrt(A*A+E*E);let K=Math.atan2(E,A);return K=K>0?K:K+2*Math.PI,{l:P,c:O,h:K}}(w(g(l)))}(z(l))}function ge(l,P){const{r:A,g:E,b:O}=P?.ignoreAlpha?l:function Ie(l){let{r:P,g:A,b:E,a:O}=l;return O<1&&(P=Math.round(O*P+255*(1-O)),A=Math.round(O*A+255*(1-O)),E=Math.round(O*E+255*(1-O))),new F.A({r:P,g:A,b:E})}(l);return.2126*A+.7152*E+.0722*O}var Ae,l;function xe(l,P=Ae.High){return ge(l,{ignoreAlpha:!0})>P?new F.A([0,0,0,l.a]):new F.A([255,255,255,l.a])}function ue(l,P){const A=ce(l);A.l*=1-P;const E=z(A),O=l.clone();return O.setColor(E),O.a=l.a,O}function pe(l,P){const A=l.clone();return A.a*=P,A}function Ue(l,P){const A=W(l);A.s*=P;const E=z(A),O=l.clone();return O.setColor(E),O.a=l.a,O}function De(l){return F.A.toUnitRGBA(l)}function $e(l){return(0,oe.fA)(l[0],l[1],l[2],l.length>3?l[3]:1)}function Je(l,P){const A=F.A.toUnitRGBA(l);return A[3]*=P,A}function Ze(l,P,A={}){if(0===l.length||P<=0)return[];if(1===(l=l.map(E=>"string"==typeof E?new F.A(E):E)).length||1===P){const E=[],O=l[0];for(let K=0;K<P;K++)E.push(O.clone());return E}if(A.shuffle&&(l=(0,Z.k4)((0,ie.o8)(l),A.seed)),l.length>=P){const E=[],O=(l.length-1)/(P-1);for(let K=0;K<P;K++){const H=Math.round(K*O);E.push(l[H].clone())}return E}return function Ne(l,P,A={}){const E=[],O=l.length-1,K=Math.ceil((P-l.length)/O);e:for(let H=0;H<O;H++){const he=l[H],_e=l[H+1];for(let ve=1;ve<=K;ve++)if(E.push(We(he,_e,ve/(K+1),A)),E.length+l.length===P)break e}return[...l.map(H=>H.clone()),...(0,Z.k4)(E,A.seed??1)]}(l,P,A)}(l=Ae||(Ae={}))[l.Low=160]="Low",l[l.High=225]="High";const je=(l,P)=>{const A=Math.floor(10*P())-5;return Math.min(255,Math.max(0,l+A))};function We(l,P,A,E={}){const O=l.r,K=l.g,H=l.b,_e=P.g,ve=P.b,Se=Math.round(O+(P.r-O)*A),Re=Math.round(K+(_e-K)*A),Ge=Math.round(H+(ve-H)*A);if(!E.offset)return new F.A([Se,Re,Ge]);const Le=(0,Z.Mo)(E.seed);return new F.A([je(Se,Le),je(Re,Le),je(Ge,Le)])}},32954:(Oe,le,_)=>{function F(){return[1,0,0,0,1,0,0,0,1]}function ie(te,ee,U,N,I,C,x,D,g){return[te,ee,U,N,I,C,x,D,g]}_.d(le,{fA:()=>ie,vt:()=>F,zK:()=>J});const J=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:J,clone:function Z(te){return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8]]},create:F,createView:function ne(te,ee){return new Float64Array(te,ee,9)},fromValues:ie},Symbol.toStringTag,{value:"Module"}))},94782:(Oe,le,_)=>{_.d(le,{CI:()=>oe,fk:()=>te}),_(3248);var Z=_(69287),ie=_(58701);function oe(g,M){return g===M||null!=g&&null!=M&&(0,ie.aI)(g.spatialReference,M.spatialReference)&&g.x===M.x&&g.y===M.y&&g.z===M.z&&g.m===M.m}function te(g,M,w){return g===M||null!=g&&null!=M&&(0,ie.aI)(g.spatialReference,M.spatialReference)&&(0,Z.Sp)(g.x,M.x,w)&&(0,Z.Sp)(g.y,M.y,w)&&(0,Z.Sp)(g.z??0,M.z??0,w)&&(0,Z.Sp)(g.m??0,M.m??0,w)}},3782:(Oe,le,_)=>{_.d(le,{HP:()=>I,N3:()=>C,RW:()=>Pe,Uz:()=>me,gR:()=>w,iQ:()=>be,jy:()=>x,w9:()=>Ce}),_(3248);var Z=_(11445),ne=(_(32034),_(2296)),J=_(51995),U=(_(721),_(6434),_(29141),_(18622));_(94782);class I{constructor(S,z,W){this.uid=S,this.geometry=z,this.attributes=W,this.visible=!0,this.objectId=null,this.centroid=null}}function C(v){return null!=v.geometry}class x{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function w(v){if(null==v)return 0;switch(v.type){case"point":return Z.qK+10+8+24;case"polyline":case"polygon":{let S=0;const z=2+(v.hasZ?1:0)+(v.hasM?1:0),W="polyline"===v.type?v.paths:v.rings;if(("polyline"===v.type?v.curvePaths:v.curveRings)?.length){const Me=3*(0,U.B1)()*128;S=8*Me*z+128*Me+32*(W.length+1)}else S=(0,Z.Qh)(W);return Z.qK+64+S+34}case"multipoint":{const S=(0,Z.Qh)(v.points);return Z.qK+S+64+34+32}case"extent":return Z.qK+10+64+34;case"mesh":{const S=v.vertexAttributes;return Z.qK+(0,Z.Qf)(S.position,S.normal,S.uv,S.tangent)}default:return Z.qK}}function Ce(v,S){switch((0,ne.Ie)(S),"mesh"===v.type&&(v=v.extent),v.type){case"point":S[0]=S[3]=v.x,S[1]=S[4]=v.y,v.hasZ&&(S[2]=S[5]=v.z);break;case"polyline":for(let z=0;z<v.paths.length;z++)(0,ne.Jf)(S,v.paths[z],!!v.hasZ);break;case"polygon":for(let z=0;z<v.rings.length;z++)(0,ne.Jf)(S,v.rings[z],!!v.hasZ);break;case"multipoint":(0,ne.Jf)(S,v.points,!!v.hasZ);break;case"extent":S[0]=v.xmin,S[1]=v.ymin,S[3]=v.xmax,S[4]=v.ymax,null!=v.zmin&&(S[2]=v.zmin),null!=v.zmax&&(S[5]=v.zmax)}}function be(v,S){switch((0,J.Ie)(S),"mesh"===v.type&&(v=v.extent),v.type){case"point":S[0]=S[2]=v.x,S[1]=S[3]=v.y;break;case"polyline":for(let z=0;z<v.paths.length;z++)(0,J.Jf)(S,v.paths[z]);break;case"polygon":for(let z=0;z<v.rings.length;z++)(0,J.Jf)(S,v.rings[z]);break;case"multipoint":(0,J.Jf)(S,v.points);break;case"extent":S[0]=v.xmin,S[1]=v.ymin,S[2]=v.xmax,S[3]=v.ymax}}function Pe(v,S){return null!=v.objectId?v.objectId:v.attributes&&S?v.attributes[S]:null}function me(v,S,z,W){if(S?.size&&null!=z&&v)for(const ce in v){if(!S.has(ce))continue;const Me=v[ce];"string"==typeof Me&&Me.length>z&&(W(ce),v[ce]="")}}},51298:(Oe,le,_)=>{_.r(le),_.d(le,{OverrideHelper:()=>U});var F=_(10467),Z=_(68677),ie=_(29430),ne=_(77806),J=_(48218),oe=_(32117),te=_(46191);const ee=N=>{if(!N)return[0,0,0,0];const{r:I,g:C,b:x,a:D}=N;return[I,C,x,255*D]};class U{static findApplicableOverrides(I,C,x){if(I&&C){if(I.primitiveName){let D=!1;for(const g of x)if(g.primitiveName===I.primitiveName){D=!0;break}if(!D)for(const g of C)g.primitiveName===I.primitiveName&&x.push(g)}switch(I.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(I.effects)for(const D of I.effects)U.findApplicableOverrides(D,C,x);if(I.symbolLayers)for(const D of I.symbolLayers)U.findApplicableOverrides(D,C,x);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(I.effects)for(const D of I.effects)U.findApplicableOverrides(D,C,x);if(I.markerPlacement&&U.findApplicableOverrides(I.markerPlacement,C,x),"CIMVectorMarker"===I.type){if(I.markerGraphics)for(const D of I.markerGraphics)U.findApplicableOverrides(D,C,x),U.findApplicableOverrides(D.symbol,C,x)}else"CIMCharacterMarker"===I.type?U.findApplicableOverrides(I.symbol,C,x):"CIMHatchFill"===I.type?U.findApplicableOverrides(I.lineSymbol,C,x):"CIMPictureMarker"===I.type&&U.findApplicableOverrides(I.animatedSymbolProperties,C,x)}}}static findEffectOverrides(I,C){if(!I)return null;if("CIMGeometricEffectDashes"===I.type&&(0,oe.FH)(I),!C||!I.primitiveName)return{type:"cim-effect-param",effect:I,overrides:[]};const x=(0,oe.rB)(I),D=I.primitiveName,g=[];for(const M of C)M.primitiveName===D&&g.push((0,oe.rB)(M));return{type:"cim-effect-param",effect:x,overrides:(0,oe.pk)(g)}}static resolveSymbolOverrides(I,C,x,D,g,M,w){return(0,F.A)(function*(){if(!I?.symbol)return null;let{symbol:re,primitiveOverrides:k}=I;const ye=!!k;if(!ye&&!D)return re;re=(0,ne.o8)(re),k=(0,ne.o8)(k);let Ce=!0;if(C||(C={attributes:{}},Ce=!1),ye){if(Ce||(k=k.filter(be=>!be.valueExpressionInfo?.expression.includes("$feature"))),w||(k=k.filter(be=>!be.valueExpressionInfo?.expression.includes("$view"))),k.length>0){const be={spatialReference:x,fields:(0,oe.O2)(C.attributes),geometryType:g};yield U.createRenderExpressions(k,be),U.evaluateOverrides(k,C,g??"esriGeometryPoint",M,w)}U.applyOverrides(re,k)}return D&&U.applyDictionaryTextOverrides(re,C,D,null),re})()}static createRenderExpressions(I,C){return(0,F.A)(function*(){const x=[];for(const D of I){const g=D.valueExpressionInfo;if(!g||U._expressionToRenderExpression.has(g.expression))continue;const M=(0,J.Ad)(g.expression,C.spatialReference,C.fields);x.push(M),M.then(w=>U._expressionToRenderExpression.set(g.expression,w))}x.length>0&&(yield Promise.all(x))})()}static evaluateOverrides(I,C,x,D,g){const M={$view:{scale:g?.scale}};for(const w of I){w.value&&"object"==typeof w.value&&(0,ie.IB)(w.value)&&("Color"===w.propertyName||"StrokeColor"===w.propertyName)&&(w.value=ee(w.value));const re=w.valueExpressionInfo;if(!re)continue;const k=U._expressionToRenderExpression.get(re.expression);k&&(w.value=(0,te.default)(k,C,M,x,D))}}static applyDictionaryTextOverrides(I,C,x,D,g="Normal"){if(I?.type)switch(I.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const M=I.symbolLayers;if(!M)return;for(const w of M)w&&"CIMVectorMarker"===w.type&&U.applyDictionaryTextOverrides(w,C,x,D,"CIMTextSymbol"===I.type?I.textCase:g)}break;case"CIMVectorMarker":{const M=I.markerGraphics;if(!M)return;for(const w of M)w&&U.applyDictionaryTextOverrides(w,C,x,D)}break;case"CIMMarkerGraphic":{const M=I.textString;if(M&&M.includes("[")){const w=(0,oe.gQ)(M,x);I.textString=(0,oe.FM)(C,w,D,g)}}}}static applyOverrides(I,C,x,D){if(I.primitiveName)for(const g of C)if(g.primitiveName===I.primitiveName){const M=(0,oe.YF)(g.propertyName);if(D&&D.push({cim:I,nocapPropertyName:M,value:I[M]}),x){let w=!1;for(const re of x)re.primitiveName===I.primitiveName&&(w=!0);w||x.push(g)}null!=g.value&&(I[M]=g.value)}switch(I.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(I.effects)for(const g of I.effects)U.applyOverrides(g,C,x,D);if(I.symbolLayers)for(const g of I.symbolLayers)U.applyOverrides(g,C,x,D);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(I.effects)for(const g of I.effects)U.applyOverrides(g,C,x,D);if("CIMVectorMarker"===I.type&&I.markerGraphics)for(const g of I.markerGraphics)U.applyOverrides(g,C,x,D),U.applyOverrides(g.symbol,C,x,D)}}static restoreOverrides(I){for(const C of I)C.cim[C.nocapPropertyName]=C.value}static buildOverrideKey(I){let C="";for(const x of I)void 0!==x.value&&(C+=`${x.primitiveName}${x.propertyName}${JSON.stringify(x.value)}`);return C}static toValue(I,C){if("DashTemplate"===I)return C.split(" ").map(x=>Number(x));if("Color"===I){const x=new Z.A(C).toRgba();return x[3]*=255,x}return C}}U._expressionToRenderExpression=new Map},46191:(Oe,le,_)=>{_.r(le),_.d(le,{default:()=>ne});var F=_(5922),Z=_(35150),ie=_(721);function ne(ee,U,N,I,C){if(null==ee)return null;const x=ee.references("geometry")&&C?function oe(ee,U,N){const{transform:I,hasZ:C,hasM:x}=N;J.has(U)||J.set(U,function te(ee){const U={};switch(ee){case"esriGeometryPoint":return(N,I,C,x)=>(0,ie.Tr)(I,U,N,C,x);case"esriGeometryPolygon":return(N,I,C,x)=>(0,ie.$X)(I,U,N,C,x);case"esriGeometryPolyline":return(N,I,C,x)=>(0,ie.P5)(I,U,N,C,x);case"esriGeometryMultipoint":return(N,I,C,x)=>(0,ie.SW)(I,U,N,C,x);default:return Z.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new F.A("mapview-arcade",`Unable to handle geometryType: ${ee}`)),N=>N}}(U));const D=J.get(U)(ee.geometry,I,C,x);return{...ee,geometry:D}}(U,I,C):U,D=ee.repurposeFeature(x);try{return ee.evaluate({...N,$feature:D},ee.services)}catch(g){return Z.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",g),null}}const J=new Map},57141:(Oe,le,_)=>{_.d(le,{A:()=>_t});var F=_(10467),Z=_(8189),ie=_(98877),ne=_(89952),J=_(3248),oe=_(3046),te=_(11432),ee=_(56492),U=_(48900),N=_(85211),C=(_(35150),_(76576)),x=_(51995),D=_(61320),g=_(73258),M=_(26747),w=_(51298),re=_(91644),k=_(47669),ye=_(38093),Ce=_(6690),be=_(86220),Pe=_(13220),me=_(34155);function S(){return(S=(0,F.A)(function*(s,t,o){const d=[],a={scaleInfo:(0,me.TY)(s),scaleExpression:null};for(const b of t)switch(b.type){case"marker":if(b.animationParams){d.push(...(0,me.gF)(o.instances.animatedMarker,b,Pe.Dk,a));break}d.push(...(0,me.Zi)(o.instances.marker,b,Pe.Dk,a));break;case"fill":null==b.spriteRasterizationParam?d.push(...(0,me.Gn)(o.instances.fill,b,a)):d.push(...(0,me.oF)(o.instances.complexFill,b,!1,a));break;case"line":b.spriteRasterizationParam?d.push(...(0,me.EM)(o.instances.texturedLine,b,!1,a)):d.push(...(0,me.NZ)(o.instances.line,b,!1,a));break;case"text":d.push(...(0,me.IQ)(o.instances.text,b,Pe.Dk,a));break;case"gradientFill":d.push(...(0,me.mp)(o.instances.gradientFill,b,a));break;case"gradientStroke":d.push(...(0,me.Dr)(o.instances.gradientStroke,b,a))}return d})).apply(this,arguments)}var z=_(84836),W=_(10903),ce=_(85452),Me=_(34650),we=_(39239),Ie=_(31732),ge=_(13682),Ae=_(27420);class xe extends Ae.Y{static from(t,o,d){return new xe(t,o,d)}constructor(t,o,d){super(d),this._items=t,this._tile=o,this._index=-1,this._cachedGeometry=null;const a=o.lod;a.wrap&&(this._wrappingInfo={worldSizeX:a.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(t){return null!=this._current.attributes[t]}field(t){return this.readAttribute(t)}get geometryType(){const t=(0,D.$B)(this._current.geometry);return"esriGeometryPoint"===t?"esriGeometryMultipoint":t}getCursor(){return this.copy()}copy(){const t=new xe(this._items,this._tile,this.metadata);return this.copyInto(t),t}copyInto(t){super.copyInto(t),t._cachedGeometry=this._cachedGeometry,t._index=this._index}get fields(){throw new Error("Fields reading not supported to graphics.")}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw new Error("InternalError: exceededTransferLimit not implemented for graphics.")}get hasZ(){return!1}get hasM(){return!1}get usedMemory(){return this._current.usedMemory}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let t="";for(const o in this._current.attributes)t+=this._current.attributes[o];return t}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){throw new Error("InternalError: Setting displayId not supported for graphics.")}setIndex(t){this._index=t}getIndex(){return this._index}next(){for(this._cachedGeometry=null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw new Error("InternalError: readGeometryArea not supported for graphics.")}_readGeometry(){if(!this._cachedGeometry){let t=(0,Ie.Ux)(this._current.projectedGeometry,this.hasZ,this.hasM);if("esriGeometryPolyline"===this.geometryType&&(t=(0,Ie.kz)(new ge.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0])),this._cachedGeometry=(0,Ie.Nl)(new ge.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform),!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(t){if(!this._wrappingInfo)return;const{worldSizeX:o}=this._wrappingInfo;if(t.isPoint)return 1===o?(t.coords.push(k.CQ,0),t.coords.push(-1024,0),void t.lengths.push(3)):2===o?(t.coords.push(2*k.CQ,0),t.coords.push(-2048,0),void t.lengths.push(3)):void this._wrapVertex(t.coords,0,2,o);if("esriGeometryMultipoint"===this.geometryType){if(1===o){const d=t.coords.slice();d[0]-=512;const a=t.coords.slice();a[0]+=512,t.coords.push(...d,...a);const b=t.lengths[0];return void t.lengths.push(b,b)}this._wrapVertex(t.coords,0,2,o)}}_wrapVertex(t,o,d,a){const b=o*d,R=t[b];R<-k.CQ*(a-2)?t[b]=R+k.CQ*a:R>k.CQ*(a-1)&&(t[b]=R-k.CQ*a)}_readX(){const t=this._readGeometry();return null!=t?t.coords[0]:0}_readY(){const t=this._readGeometry();return null!=t?t.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case"esriGeometryPolygon":{const t=(0,we.l8)(this._current.projectedGeometry),o=new ge.A([],t);return(0,Ie.Nl)(new ge.A,o,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}case"esriGeometryPolyline":{const o=(0,we.S8)(this._current.projectedGeometry.paths,this.hasZ),d=new ge.A([],o);return(0,Ie.Nl)(new ge.A,d,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}}return null}_readAttribute(t,o){const d=this._current.attributes[t];if(void 0!==d)return d;const a=t.toLowerCase();for(const b in this._current.attributes)if(b.toLowerCase()===a)return this._current.attributes[b]}_readAttributes(){return this._current.attributes}}var ue=_(67685),pe=_(77413),Ue=_(77098),De=_(58701),qe=_(94529),et=_(11445),$e=_(83065),Qe=_(15268);function Fe(s){return"curveRings"in s&&!!s.curveRings?.length||"curvePaths"in s&&!!s.curvePaths?.length}function Ze(s){return"b"in s}function Ne(s){return"c"in s}function We(s){return"a"in s}function A(s){return Ze(s)?s.b[0]:Ne(s)?s.c[0]:We(s)?s.a[0]:s}var E=_(69287),O=_(31610),K=_(32954),H=_(83953);const he={maxSegmentLength:1/0,maxSegmentsPerCurve:12e3,minSegmentsPerCurve:1},_e=1e-6,ve=(0,K.vt)();function Se(s,t){return(0,H.hG)(s,t)}function Re(s,t){const o=Math.atan2(s,t);return o<0?o+2*Math.PI:o}function Ge(s,t,o,{maxSegmentLength:d,maxSegmentsPerCurve:a,minSegmentsPerCurve:b},R){const T=d*d,j=1/a,L=R(0),B=R(1);Se(t,L)>_e&&s.push(L);const G=[1],V=[B],$=1/b;for(let Q=b-1;Q>0;Q--){const q=Q*$;G.push(q),V.push(R(q))}let Y=0,X=L;for(;G.length>0;){const Q=G.pop(),q=V.pop();if(Se(X,q)<T||Y===Q||Q-Y<j)s.push(q),Y=Q,X=q;else{G.push(Q),V.push(q);const se=(Y+Q)/2;G.push(se),V.push(R(se))}}return Se(o,B)>_e&&s.push([...o]),s}function tt(s,t,o,d,a,b,R,T,{maxSegmentLength:j,maxSegmentsPerCurve:L,minSegmentsPerCurve:B}){const G=2*b,V=[d+b*Math.cos(R),a+b*Math.sin(R)],$=[d+b*Math.cos(T),a+b*Math.sin(T)];Se(t,V)>_e&&s.push(V);const Y=T-R,X=j<G?2*Math.asin(j/G):Y,Q=Math.min(L,Math.max(B,Math.ceil(Math.abs(Y/X)))),q=1/Q;for(let se=1;se<Q;se++){const de=se*q,ae=R*(1-de)+T*de;s.push([d+b*Math.cos(ae),a+b*Math.sin(ae)])}return s.push($),Se(o,$)>_e&&s.push([...o]),s}function rt(s,t,o){const[d,a,b,R]=o.a,T=Math.abs(s-t),j=T>Math.PI,L=T<Math.PI,B=(0,E.Sp)(T,Math.PI);return(!B&&(j&&b||L&&!b)||B&&(s>t&&R||s<t&&!R))&&(s+=2*(Math.sign(t-s)||1)*Math.PI),s}function dt(s,t,o,d){return Ze(o)?function at(s,t,o,d){const[a,b,R]=o.b;return Ge(s,t,a,d,T=>function Le(s,t,o,d,a){const b=1-a,R=b*b,T=a*a,j=R*b,L=3*a*R,B=3*T*b,G=T*a;return[s[0]*j+t[0]*L+o[0]*B+d[0]*G,s[1]*j+t[1]*L+o[1]*B+d[1]*G]}(t,b,R,a,T))}(s,t,o,d):Ne(o)?function ct(s,t,o,d){const[a,b]=o.c,R=function lt(s,t,o,d){const[a,b]=t,[R,T]=o,[j,L]=d,B=a*a+b*b,G=R*R+T*T,V=j*j+L*L;(0,O.hZ)(ve,a,R,j,b,T,L,1,1,1);const $=(0,O.a4)(ve);if(0===$)return null;(0,O.hZ)(ve,B,G,V,b,T,L,1,1,1);const Y=(0,O.a4)(ve);(0,O.hZ)(ve,B,G,V,a,R,j,1,1,1);const X=Y/$*.5,Q=(0,O.a4)(ve)/$*-.5;return s[0]=X,s[1]=Q,s}([],t,b,a);if(null==R)return s.push([...a]),s;const[T,j]=t,[L,B]=b,[G,V]=a,[$,Y]=R,X=T-$,Q=j-Y,q=Math.sqrt(X*X+Q*Q),se=Re(j-Y,T-$),de=Re(B-Y,L-$);let ae=Re(V-Y,G-$);return(de-se)*(ae-de)<0&&(ae+=2*Math.sign(se-ae)*Math.PI),tt(s,t,a,$,Y,q,se,ae,d)}(s,t,o,d):We(o)?function l(s){return 4===s.a.length}(o)?function ut(s,t,o,d){const[a,b]=o.a,[R,T]=t,[j,L]=a,[B,G]=b,V=R-B,$=T-G,Y=Math.sqrt(V*V+$*$),X=Re(T-G,R-B);return tt(s,t,a,B,G,Y,X,rt(Re(L-G,j-B),X,o),d)}(s,t,o,d):function ht(s,t,o,d){const[a,b,R,T,j,L,B]=o.a,[G,V]=t,[$,Y]=a,[X,Q]=b,q=L*B,se=Math.cos(j),de=Math.sin(j),ae=Re(1/q*(V-Q)*se-1/q*(G-X)*de,1/L*(V-Q)*de+1/L*(G-X)*se),ze=rt(Re(1/q*(Y-Q)*se-1/q*($-X)*de,1/L*(Y-Q)*de+1/L*($-X)*se),ae,o);return Ge(s,t,a,d,Te=>{const Ve=ae*(1-Te)+ze*Te,ke=Math.cos(Ve),He=Math.sin(Ve);return[L*ke*se-q*He*de+X,L*ke*de+q*He*se+Q]})}(s,t,o,d):(function je(s){return Array.isArray(s)}(o)&&s.push([...o]),s)}function st(s,t){if(!Fe(s))return s;const o=function Je(s){return"curveRings"in s?s.curveRings:s.curvePaths}(s),d=[];for(const a of o){const b=[];for(let R=0,T=1;T<a.length;R=T++){const j=A(a[R]);0===R&&b.push(j),dt(b,j,a[T],{maxSegmentLength:t.maxSegmentLength??he.maxSegmentLength,maxSegmentsPerCurve:t.maxSegmentsPerCurve??he.maxSegmentsPerCurve,minSegmentsPerCurve:Math.max(t.minSegmentsPerCurve??he.minSegmentsPerCurve,1)})}d.push(b)}return"curvePaths"in s?{paths:d,spatialReference:s.spatialReference}:{rings:d,spatialReference:s.spatialReference}}var mt=_(15584),pt=_(3782),it=_(88840),Ke=_(18622),Be=_(36741);class Ye{static fromGraphic(t,o,d,a){return new Ye(t.geometry,o,t.attributes,t.visible,t.uid,t.version,d,a)}constructor(t,o,d,a,b,R,T,j){this.geometry=t,this.symbol=o,this.attributes=d,this.visible=a,this.objectId=b,this._version=R,this.zOrder=T,this.displayId=j,this.symbolBounds=(0,x.Ie)(),this.prevSymbolBounds=(0,x.Ie)(),this.size=[0,0,0,0],this.geometryBounds=(0,x.Ie)(),this._isDensificationDirty=!1,this._densificationSegmentLength=1/0}get projectedGeometry(){return this._projectedGeometry}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}get usedMemory(){return 128+(0,et.lM)(this.attributes)+(0,pt.gR)(this.geometry)}get hasAnimations(){const{linearCIM:t}=this;return!!t&&t.some(o=>"animationParams"in o&&!!o.animationParams)}get hasCurvedGeoemtry(){return null!=this.geometry&&"mesh"!==this.geometry.type&&Fe(this.geometry)}update(t,o,d){return(this._version!==t.version||this.zOrder!==d||this.symbol!==o)&&(this.prevSymbolBounds=this.symbolBounds,this.symbolBounds=(0,x.Ie)(),this.zOrder=d,this.geometry=t.geometry,this.attributes=t.attributes,this.symbol=o,this.visible=t.visible,this._version=t.version,this.symbolResource=null,this._projectedGeometry=null,(0,x.Ie)(this.geometryBounds),this._minDensificationSegmentLength=null,!0)}updateDensificationResolution(t){if(!this.hasCurvedGeoemtry)return!1;const o=Math.max(function ft(s){return 2**Math.round(Math.log2(s))*(0,Ke.ab)()}(t),this._minDensificationSegmentLength??0);return o!==this._densificationSegmentLength&&(this._densificationSegmentLength=o,this._isDensificationDirty=!0,!0)}projectAndNormalize(t){var o=this;return(0,F.A)(function*(){let d,a=o.geometry;if(a&&a.spatialReference&&"mesh"!==a.type&&("extent"===a.type&&(a=(0,Be.DF)(a)),d=Fe(a)?st(a,{maxSegmentLength:1/0,minSegmentsPerCurve:(0,Ke.mK)()}):a.toJSON(),o._projectedGeometry=yield nt(d,a.spatialReference,t),(0,$e.Rg)(o.geometryBounds,o._projectedGeometry),o.hasCurvedGeoemtry&&null!=o._projectedGeometry)){const b=(0,x.VL)(o.geometryBounds),R=(0,x.uJ)(o.geometryBounds);(b||R)&&(o._minDensificationSegmentLength=Math.max(b,R)/(0,Ke.B1)())}})()}densifyCurvedGeometryForDisplay(t){var o=this;return(0,F.A)(function*(){if(!o.hasCurvedGeoemtry||!o._isDensificationDirty)return;o._isDensificationDirty=!1;const d=o.geometry;if(!d||!d.spatialReference||"mesh"===d.type)return;const R=st(d,{maxSegmentLength:o._densificationSegmentLength*(t.metersPerUnit/d.spatialReference.metersPerUnit),minSegmentsPerCurve:(0,Ke.bR)()});o._projectedGeometry=yield nt(R,d.spatialReference,t)})()}}function nt(s,t,o){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,F.A)(function*(s,t,o){yield(0,it.Nk)(s.spatialReference,o);const d=(0,mt.b3)(s);if(!d)return;const a=(0,it.Cv)(d,t,o);return a&&(0,Qe.uC)(a),(0,D.ZC)(a)?(0,Be.DF)(a):a})).apply(this,arguments)}class gt{constructor(t,o,d){this.added=t,this.updated=o,this.removed=d}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}}function yt(s,t){return t.zOrder-s.zOrder}class vt{constructor(t,o,d,a,b){this._items=new Map,this._boundsDirty=!1,this._outSpatialReference=t,this._cimResourceManager=o,this._hittestDrawHelper=new qe.CK(o),this._tileInfoView=d,this._store=b;const R=d.getClosestInfoForScale(a);this._resolution=this._tileInfoView.getTileResolution(R.level)}destroy(){this._hittestDrawHelper.destroy()}items(){return this._items.values()}getItem(t){return this._items.get(t)}update(t,o,d){var a=this;return(0,F.A)(function*(){const b=[],R=[],T=[],j=new Set,L=[];let B=0;for(const G of t.items){B++;const V=G.uid,$=a._items.get(V),Y=o(G);if(j.add(V),$){const q=$.update(G,Y,B),se=$.updateDensificationResolution(a._resolution);q&&L.push(a._updateItem($,d)),(q||se)&&R.push($);continue}const X=a._store.createDisplayIdForObjectId(V),Q=Ye.fromGraphic(G,Y,B,X);Q.updateDensificationResolution(a._resolution),L.push(a._updateItem(Q,d)),a._items.set(Q.objectId,Q),b.push(Q)}for(const[G,V]of a._items.entries())j.has(G)||(a._store.releaseDisplayIdForObjectId(G),a._items.delete(G),T.push(V));return yield Promise.all(L),a._index=null,new gt(b,R,T)})()}updateLevel(t){if(this._resolution===t)return!1;this._index=null,this._boundsDirty=!0,this._resolution=t;for(const o of this.items())if(o.hasCurvedGeoemtry)return!0;return!1}hitTest(t,o,d,a,b){const R=(0,J.A)("esri-mobile"),T=R?k.fy:k.V3,j=T+(R?0:k._M);t=(0,Ue.mT)(t,this._tileInfoView.spatialReference);const L=a*window.devicePixelRatio*j,B=(0,x.vt)();B[0]=t-L,B[1]=o-L,B[2]=t+L,B[3]=o+L;const G=a*window.devicePixelRatio*T,V=(0,x.vt)();V[0]=t-G,V[1]=o-G,V[2]=t+G,V[3]=o+G;const $=.5*a*(j+Be.RA),Y=this._searchIndex(t-$,o-$,t+$,o+$);if(!Y||0===Y.length)return[];const X=[],Q=(0,x.vt)(),q=(0,x.vt)();for(const ae of Y){if(!ae.visible)continue;const{geometryBounds:ze,symbolResource:Te}=ae;this._getSymbolBounds(Q,Te,ze,q,b),q[3]=q[2]=q[1]=q[0]=0,(0,x.HY)(Q,B)&&X.push(ae)}if(0===X.length)return[];const se=this._hittestDrawHelper,de=[];for(const ae of X){const{projectedGeometry:ze,symbolResource:Te}=ae;if(!Te)continue;const{textInfo:Ve,symbolInfo:ke}=Te;se.hitTest(V,ke.cimSymbol.symbol,ze,Ve,b,a)&&de.push(ae)}return de.sort(yt),de.map(ae=>ae.objectId)}queryItems(t){return 0===this._items.size?[]:this._searchForItems(t)}clear(){this._items.clear(),this._index=null}_updateItem(t,o){var d=this;return(0,F.A)(function*(){yield t.projectAndNormalize(d._outSpatialReference),yield o(t);const{size:a}=t;a[0]=a[1]=a[2]=a[3]=0,d._getSymbolBounds(t.symbolBounds,t.symbolResource,t.geometryBounds,t.size,0)})()}_searchIndex(t,o,d,a){return this._boundsDirty&&(this._items.forEach(b=>this._getSymbolBounds(b.symbolBounds,b.symbolResource,b.geometryBounds,b.size,0)),this._boundsDirty=!1),this._index||(this._index=(0,pe.r)(9,b=>({minX:b.symbolBounds[0],minY:b.symbolBounds[1],maxX:b.symbolBounds[2],maxY:b.symbolBounds[3]})),this._index.load(Array.from(this._items.values()))),this._index.search({minX:t,minY:o,maxX:d,maxY:a})}_searchForItems(t){const o=this._tileInfoView.spatialReference,d=t.bounds,a=(0,De.Vp)(o);if(a&&o.isWrappable){const[b,R]=a.valid,T=Math.abs(d[2]-R)<1e-5,j=Math.abs(d[0]-b)<1e-5;if((!T||!j)&&(T||j)){const L=t.resolution;let B;B=(0,x.vt)(T?[b,d[1],b+L*Be.RA,d[3]]:[R-L*Be.RA,d[1],R,d[3]]);const G=this._searchIndex(d[0],d[1],d[2],d[3]),V=this._searchIndex(B[0],B[1],B[2],B[3]);return[...new Set([...G,...V])]}}return this._searchIndex(d[0],d[1],d[2],d[3])}_getSymbolBounds(t,o,d,a,b){if(!o||!o.symbolInfo.linearCIM)return null;if(t||(t=(0,x.vt)()),(0,x.C)(t,d),!a||0===a[0]&&0===a[1]&&0===a[2]&&0===a[3]){const{textInfo:j,symbolInfo:L}=o;a||(a=[0,0,0,0]);const G=M.Sc.getSymbolInflateSize(a,L.cimSymbol.symbol,this._cimResourceManager,b,j);a[0]=(0,ue.Lz)(G[0]),a[1]=(0,ue.Lz)(G[1]),a[2]=(0,ue.Lz)(G[2]),a[3]=(0,ue.Lz)(G[3])}const R=this._resolution,T=M.Sc.safeSize(a);return t[0]-=T*R,t[1]-=T*R,t[2]+=T*R,t[3]+=T*R,t}}var bt=_(31411),Mt=_(35547);class Ee{static getOrCreate(t,o,d){let a=o.get(t.id);return a||(a=new Ee(t,d),o.set(t.id,a)),a}static fromItems(t,o,d){const a=new Ee(t,d);for(const b of o)a.append(b);return a}constructor(t,o){this.tile=t,this.metadata=o,this.addedOrModified=[],this.removed=[],this.objectIdMap=null}get reader(){return this._reader||(this._reader=xe.from(this.addedOrModified,this.tile,this.metadata)),this._reader}append(t){this.addedOrModified.push(t),t.hasAnimations&&(this.objectIdMap=this.objectIdMap||{},this.objectIdMap[t.displayId]=t.objectId)}}let fe=class extends(oe.A.IdentifiableMixin(ie.A)){constructor(s){super(s),this._attached=!1,this._tiles=new Map,this._controller=new AbortController,this._hashToSymbolInfo=new Map,this._lastCleanup=performance.now(),this._cleanupRequired=!0,this.lastUpdateId=-1,this.renderer=null,this._updateTracking=new Mt.F({debugName:"GraphicsView2D"}),this.updateRequested=!1,this.defaultPointSymbolEnabled=!0,this._commandQueue=new bt.j({process:t=>{if("update"===t.type)return this._update();throw new Error("InternalError: Unsupported command")}}),this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy(),this.view=null,this.renderer=null,this._set("graphics",null),this._controller.abort(),this._graphicStore.clear(),this._graphicStore.destroy(),this._attributeStore=null,this._hashToSymbolInfo.clear(),this._updateTracking.destroy(),this._commandQueue.destroy()}_initAttributeStore(){this._storage=new ce.l({spatialReference:this.view.spatialReference,fields:new g.A}),this._attributeStore=new W.K({isLocal:!0,update:t=>{(0,J.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:t}),this.container.attributeView.requestUpdate(t),this.container.requestRender(),(0,J.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:t})}});const s=(0,z.T9)(null,[]);this._attributeStore.update(s,this._storage,null),this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore(),this._metadata=Me.h.createGraphics(this.view.spatialReference),this._resourceProxy=new be.J({fetch:t=>Promise.all(t.map(o=>this.view.stage.textureManager.rasterizeItem(o))),fetchDictionary:t=>{throw new Error("InternalError: Graphics do not support Dictionary requests")}}),this.addHandles([(0,U.wB)(()=>this._effectiveRenderer,()=>this._pushUpdate()),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{this.addHandles([this.graphics.on("change",()=>this._pushUpdate())]),this._graphicStore?.destroy(),this._graphicStore=new vt(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore),this._attached=!0,this.requestUpdate(),this._pushUpdate()})]),this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking),this._onTileUpdate({added:this.view.graphicsTileStore.tiles,removed:[]})}get _effectiveRenderer(){return"function"==typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const s=!this._attached||this._updateTracking.updating;return(0,J.A)("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${s}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`),s}hitTest(s){if(!this.view||this.view.suspended)return[];const{resolution:t,rotation:o}=this.view.state,d=this._graphicStore.hitTest(s.x,s.y,2,t,o),a=new Set(d),b=this.graphics.items.reduce((R,T)=>(a.has(T.uid)&&R.set(T.uid,T),R),new Map);return d.map(R=>b.get(R)).filter(ne.Ru)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback()),this.notifyChange("updating")}processUpdate(s){this.updateRequested&&(this.updateRequested=!1,this.update(s))}viewChange(){this.requestUpdate()}setHighlight(s){const t=[];for(const{objectId:o,highlightFlags:d}of s){const a=this._graphicStore.getItem(o)?.displayId;t.push({objectId:o,highlightFlags:d,displayId:a})}this._attributeStore.setHighlight(t,s),this._pushUpdate()}graphicUpdateHandler(s){this._pushUpdate()}update(s){this.updateRequested=!1,this._attached&&this._graphicStore.updateLevel(s.state.resolution)&&this.pushUpdate()}pushUpdate(){this._pushUpdate()}_pushUpdate(){(0,ee.QZ)(this._commandQueue.push({type:"update"}))}_update(){var s=this;return(0,F.A)(function*(){try{(0,J.A)("esri-2d-update-debug")&&console.debug(`[Id: ${s.layerId}] GraphicsView._update start`);const t=yield s._graphicStore.update(s.graphics,d=>s._getSymbolForGraphic(d),d=>s._ensureSymbolResource(d));for(const d of t.updated)s.container.restartAnimation(d.objectId);if(!t.hasAnyUpdate())return void s._attributeStore.sendUpdates();t.removed.length&&(s._cleanupRequired=!0),(0,J.A)("esri-2d-update-debug")&&console.debug(`[Id: ${s.layerId}] GraphicsView updateMessage`,t);const o=s._createTileMessages(t);yield s._densifyItemsForDisplay(o),yield s._fetchResources(o),s._write(o);for(const d of t.added)s._setFilterState(d);for(const d of t.updated)s._setFilterState(d);(0,J.A)("esri-2d-update-debug")&&console.debug(`[Id: ${s.layerId}] GraphicsView sendUpdate`,t),s._attributeStore.sendUpdates(),(0,J.A)("esri-2d-update-debug")&&console.debug(`[Id: ${s.layerId}] GraphicsView sendUpdate.await`,t)}catch{}s._cleanupSharedResources()})()}_createTileMessages(s){const t=new Map;for(const o of s.added){const d=this.view.graphicsTileStore.getIntersectingTiles(o.symbolBounds);for(const a of d)Ee.getOrCreate(a,t,this._metadata).append(o)}for(const o of s.updated){const d=this.view.graphicsTileStore.getIntersectingTiles(o.prevSymbolBounds),a=this.view.graphicsTileStore.getIntersectingTiles(o.symbolBounds);for(const b of d)Ee.getOrCreate(b,t,this._metadata).removed.push(o.displayId);for(const b of a)Ee.getOrCreate(b,t,this._metadata).append(o)}for(const o of s.removed){const d=this.view.graphicsTileStore.getIntersectingTiles(o.symbolBounds);for(const a of d)Ee.getOrCreate(a,t,this._metadata).removed.push(o.displayId)}return Array.from(t.values())}_densifyItemsForDisplay(s){var t=this;return(0,F.A)(function*(){const o=new Map;for(const d of s)for(const a of d.addedOrModified)o.has(a)||o.set(a,a.densifyCurvedGeometryForDisplay(t.view.spatialReference));yield Promise.all(o.values())})()}_fetchResources(s){var t=this;return(0,F.A)(function*(){const o={timeZone:null,timeExtent:null};for(const{tile:d,reader:a}of s){(0,J.A)("esri-2d-update-debug")&&console.debug(`Id[${t.layerId}] Tile[${d.id}] GraphicsView fetchResources`,s);const b=a.getCursor();for(;b.next();)for(const R of b.getMeshWriters())R.enqueueRequest(t._resourceProxy,b,d.createArcadeEvaluationOptions(o))}yield t._resourceProxy.fetchEnqueuedResources()})()}_write(s){for(const t of s){(0,J.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView write`,t);const o=this._writeMeshes(t);let d=this._tiles.get(t.tile.key);d||(d=this._createFeatureTile(t.tile.key)),(0,J.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView onTileData`,t),this.container.onTileData(d,{type:"update",modify:o,remove:t.removed,end:!1,attributeEpoch:this._attributeStore.epoch,objectIdMap:t.objectIdMap}),this.container.requestRender()}}_writeMeshes(s){const t={timeZone:null,timeExtent:null},o=new Ce.U(s.tile.id),d=s.reader.getCursor();for(;d.next();){o.entityStart(d.getDisplayId(),d.getZOrder());for(const a of d.getMeshWriters())a.write(o,this._resourceProxy,d,s.tile.createArcadeEvaluationOptions(t),s.tile.level);o.entityEnd()}return{...o.serialize().message,tileId:s.tile.id}}_setFilterState(s){const t=s.displayId,o=this._attributeStore.getHighlightFlags(s.objectId);this._attributeStore.setData(t,0,0,o|(s.visible?k.LY:0))}_getSymbolForGraphic(s){return null!=s.symbol?s.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(s):this._getNullSymbol(s)}_ensureSymbolResource(s){var t=this;return(0,F.A)(function*(){if(!s.symbol)return;const o=yield t._getSymbolInfo(s.symbol);if(!o)return;const d=o.linearCIM.filter(a=>"text"===a.type);if(d.length>0){const a=yield t._getTextResources(s,d);s.symbolResource={symbolInfo:o,textInfo:a}}else s.symbolResource={symbolInfo:o}})()}_getSymbolInfo(s){const t=s.hash();return this._hashToSymbolInfo.has(t)||this._hashToSymbolInfo.set(t,this._createSymbolInfo(t,s).catch(o=>null)),this._hashToSymbolInfo.get(t)}_createSymbolInfo(s,t){var o=this;return(0,F.A)(function*(){const d=yield o._convertToCIMSymbol(t),a=yield o._createLinearCIM(d);return{hash:s,cimSymbol:d,linearCIM:a,meshWriters:yield o._createMeshWriters(d,a)}})()}_convertToCIMSymbol(s){return(0,F.A)(function*(){const t=(0,M.Vb)(s);return"web-style"===t.type?(yield t.fetchCIMSymbol()).data:t})()}_createLinearCIM(s){var t=this;return(0,F.A)(function*(){return yield Promise.all(M.wp.fetchResources(s.symbol,t._cimResourceManager,[])),t.view.stage.cimAnalyzer.analyzeSymbolReference(s,!1)})()}_createMeshWriters(s,t){var o=this;return(0,F.A)(function*(){(0,ee.Te)(o._controller.signal);const d=o.container.instanceStore,a=o.view.stage.meshWriterRegistry,b=yield function v(s,t,o){return S.apply(this,arguments)}(s,t,d);return Promise.all(b.map(R=>a.createMeshWriter(o._storage,o._resourceProxy,{tileInfo:o.view.featuresTilingScheme.tileInfo},R)))})()}_onTileUpdate(s){if(s.added&&s.added.length>0)for(const t of s.added)this._updateTracking.addPromise(this._addTile(t));if(s.removed&&s.removed.length>0)for(const t of s.removed)this._removeTile(t.key)}_createFeatureTile(s){const t=this.view.featuresTilingScheme.getTileBounds((0,x.vt)(),s),o=this.view.featuresTilingScheme.getTileResolution(s.level),d=new ye.R(s,o,t[0],t[3]);return this._tiles.set(s,d),this.container.addChild(d),d}_addTile(s){var t=this;return(0,F.A)(function*(){if(!t._attached)return;const o=t._graphicStore.queryItems(s);if(!o.length)return;const d=t._createFeatureTile(s.key),a=Ee.fromItems(s,o,t._metadata);yield t._densifyItemsForDisplay([a]),yield t._fetchResources([a]);const b=t._writeMeshes(a);d.onMessage({type:"append",append:b,clear:!1,end:!0,attributeEpoch:t._attributeStore.epoch,objectIdMap:a.objectIdMap})})()}_removeTile(s){if(!this._tiles.has(s))return;const t=this._tiles.get(s);this.container.removeChild(t),t.destroy(),this._tiles.delete(s)}_getNullSymbol(s){const t=s.geometry;return(0,D.Rg)(t)?re.x3:(0,D.Bi)(t)||(0,D.ZC)(t)?re.JJ:this.defaultPointSymbolEnabled?re.jM:null}_getTextResources(s,t){var o=this;return(0,F.A)(function*(){const d=new Array,a=new Array;for(let j=0;j<t.length;j++){const L=t[j],{resource:B,overrides:G}=L.textRasterizationParam;if(G?.length>0){const V=w.OverrideHelper.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:G,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:B.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:B.symbol,textString:B.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},s,o.view.spatialReference,null,(0,D.$B)(s.projectedGeometry),null,null);V.then($=>{const Y=$.symbolLayers[0],{textString:X}=Y.markerGraphics[0];a.push({type:"cim-rasterization-info",resource:{type:"text",textString:X||"",font:B.font}}),L.text=B.textString=X||""}),d.push(V)}else a.push({type:"cim-rasterization-info",resource:B})}d.length>0&&(yield Promise.all(d));const b=a.map(j=>o.view.stage.textureManager.rasterizeItem(j)),R=yield Promise.all(b);(0,te.Lw)(R);const T=new Map;for(let j=0;j<t.length;j++){const L=t[j];T.set(L.textRasterizationParam.resource.symbol,{text:L.text,glyphMosaicItems:R[j]})}return T})()}_cleanupSharedResources(){if(!this._cleanupRequired)return;const s=performance.now();if(s-this._lastCleanup<5e3)return;this._cleanupRequired=!1,this._lastCleanup=s;const t=new Set;for(const d of this._graphicStore.items()){const a=d.symbolResource?.symbolInfo.hash;t.add(a)}const o=new Set(this._hashToSymbolInfo.keys());for(const d of o.values())t.has(d)||this._hashToSymbolInfo.delete(d)}};(0,Z._)([(0,N.MZ)()],fe.prototype,"_effectiveRenderer",null),(0,Z._)([(0,N.MZ)({constructOnly:!0})],fe.prototype,"layerId",void 0),(0,Z._)([(0,N.MZ)({constructOnly:!0})],fe.prototype,"requestUpdateCallback",void 0),(0,Z._)([(0,N.MZ)()],fe.prototype,"container",void 0),(0,Z._)([(0,N.MZ)({constructOnly:!0})],fe.prototype,"graphics",void 0),(0,Z._)([(0,N.MZ)()],fe.prototype,"renderer",void 0),(0,Z._)([(0,N.MZ)()],fe.prototype,"_updateTracking",void 0),(0,Z._)([(0,N.MZ)()],fe.prototype,"updating",null),(0,Z._)([(0,N.MZ)()],fe.prototype,"view",void 0),(0,Z._)([(0,N.MZ)()],fe.prototype,"updateRequested",void 0),(0,Z._)([(0,N.MZ)()],fe.prototype,"defaultPointSymbolEnabled",void 0),fe=(0,Z._)([(0,C.$)("esri.views.2d.layers.graphics.GraphicsView2D")],fe);const _t=fe},18622:(Oe,le,_)=>{_.d(le,{B1:()=>ie,ab:()=>J,bR:()=>ne,mK:()=>Z});var F=_(3248);function Z(){return(0,F.A)("curve-densification-coarse-segments")}function ie(){return(0,F.A)("curve-densification-max-segments")}function ne(){return(0,F.A)("curve-densification-min-segments")}function J(){return(0,F.A)("curve-densification-pixels-per-segment")}}}]);