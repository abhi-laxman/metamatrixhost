"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[9897],{11170:(_t,ye,F)=>{F.d(ye,{S:()=>ge});var g=F(10467),S=F(68800),C=F(11432),it=F(23743),fe=F(31732);function T(_,f){return f}function L(_,f,v,x){switch(v){case 0:return Y(_,f+x,0);case 1:return"lowerLeft"===_.originPosition?Y(_,f+x,1):function D({translate:_,scale:f},v,x){return _[x]-v*f[x]}(_,f+x,1)}}function q(_,f,v,x){return 2===v?Y(_,f,2):L(_,f,v,x)}function Ee(_,f,v,x){return 2===v?0===f?0:Y(_,f,3):L(_,f,v,x)}function Ce(_,f,v,x){return 3===v?0===f?0:Y(_,f,3):q(_,f,v,x)}function Y({translate:_,scale:f},v,x){return _[x]+v*f[x]}class he{constructor(f){this._options=f,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=T,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(f){if(this._options.applyTransform&&(f.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!f.hasZ)return;const v=(0,it.N)(f.geometryType,this._options.sourceSpatialReference,f.spatialReference);if(null!=v)for(const x of f.features)v(x.geometry)}createSpatialReference(){return{}}addField(f,v){const x=f.fields;(0,C.Lw)(x),x.push(v);const N=x.map(R=>R.name);this._attributesConstructor=function(){for(const R of N)this[R]=null}}addFeature(f,v){f.features.push(v)}prepareFeatures(f){switch(this._transform=f.transform,this._options.applyTransform&&f.transform&&(this._applyTransform=this._deriveApplyTransform(f)),this._mValueOffset=null,this._vertexDimension=2,f.hasZ&&this._vertexDimension++,f.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),f.geometryType){case"esriGeometryPoint":this.addCoordinate=(v,x,N)=>this.addCoordinatePoint(v,x,N),this.createGeometry=v=>this.createPointGeometry(v);break;case"esriGeometryPolygon":this.addCoordinate=(v,x,N)=>this._addCoordinatePolygon(v,x,N),this.createGeometry=v=>this._createPolygonGeometry(v);break;case"esriGeometryPolyline":this.addCoordinate=(v,x,N)=>this._addCoordinatePolyline(v,x,N),this.createGeometry=v=>this._createPolylineGeometry(v);break;case"esriGeometryMultipoint":this.addCoordinate=(v,x,N)=>this._addCoordinateMultipoint(v,x,N),this.createGeometry=v=>this._createMultipointGeometry(v)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(f,v,x){0===this._lengths.length&&(this._toAddInCurrentPath=v),this._lengths.push(v)}addQueryGeometry(f,v){const{queryGeometry:x,queryGeometryType:N}=v,R=this._transform?(0,fe.Ch)(x.clone(),x,!1,!1,this._transform):x.clone(),ae=(0,fe.zv)(R,N,!1,!1);f.queryGeometryType=N,f.queryGeometry={...ae}}createPointGeometry(f){const v={x:0,y:0,spatialReference:f.spatialReference};return f.hasZ&&(v.z=0),f.hasM&&(v.m=0),v}addCoordinatePoint(f,v,x){switch(v=this._applyTransform(this._transform,v,x,0),x){case 0:f.x=v;break;case 1:f.y=v;break;case 2:"z"in f?f.z=v:f.m=v;break;case 3:f.m=v}}_transformPathLikeValue(f,v){let x=0;return v<=1&&(x=this._previousCoordinate[v],this._previousCoordinate[v]+=f),null!==this._mValueOffset&&0===f&&v>0&&!(v%this._mValueOffset)?0:this._applyTransform(this._transform,f,v,x)}_addCoordinatePolyline(f,v,x){this._dehydratedAddPointsCoordinate(f.paths,v,x)}_addCoordinatePolygon(f,v,x){this._dehydratedAddPointsCoordinate(f.rings,v,x)}_addCoordinateMultipoint(f,v,x){0===x&&f.points.push([]);const N=this._transformPathLikeValue(v,x);f.points[f.points.length-1].push(N)}_createPolygonGeometry(f){return{rings:[[]],spatialReference:f.spatialReference,hasZ:!!f.hasZ,hasM:!!f.hasM}}_createPolylineGeometry(f){return{paths:[[]],spatialReference:f.spatialReference,hasZ:!!f.hasZ,hasM:!!f.hasM}}_createMultipointGeometry(f){return{points:[],spatialReference:f.spatialReference,hasZ:!!f.hasZ,hasM:!!f.hasM}}_dehydratedAddPointsCoordinate(f,v,x){0===x&&0==this._toAddInCurrentPath--&&(f.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const N=this._transformPathLikeValue(v,x),R=f[f.length-1];0===x&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),R.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=N}_deriveApplyTransform(f){const{hasZ:v,hasM:x}=f;return v&&x?Ce:v?q:x?Ee:L}}var qe=F(1277),re=(F(93327),F(87086));function ge(_,f,v){return O.apply(this,arguments)}function O(){return(O=(0,g.A)(function*(_,f,v){const x=(0,S.Dl)(_),N={...v},R=re.A.from(f),ae=!R.quantizationParameters,{data:ne}=yield(0,qe.IJ)(x,R,new he({sourceSpatialReference:R.sourceSpatialReference,applyTransform:ae}),N);return ne})).apply(this,arguments)}},89897:(_t,ye,F)=>{F.r(ye),F.d(ye,{default:()=>_r});var g=F(10467),S=F(5922),C=F(19093),T=F(43039),L=F(8189),q=F(85211),Ee=F(3248),Ce=F(35150),D=(F(40707),F(76576)),he=F(54076),qe=F(19284);class j{constructor(){this.connection=null}open(t){var r=this;return(0,g.A)(function*(){r.connection=yield(0,qe.ho)("statsWorker",{strategy:"distributed",signal:t})})()}destroy(){this.connection?.close()}static getInstance(){return j.instance||(j.instance=new j),j.instance}summaryStatistics(t,r){var n=this;return(0,g.A)(function*(){if(!n.connection)throw new S.A("worker-client:summary-statistics","connection is required");return n.connection.invoke("summaryStatistics",{attribute:t,features:r})})()}uniqueValues(t,r){var n=this;return(0,g.A)(function*(){if(!n.connection)throw new S.A("worker-client:unique-values","connection is required");return n.connection.invoke("uniqueValues",{attribute:t,features:r})})()}classBreaks(t,r){var n=this;return(0,g.A)(function*(){if(!n.connection)throw new S.A("worker-client:class-breaks","connection is required");return n.connection.invoke("classBreaks",{attribute:t,features:r})})()}histogram(t,r){var n=this;return(0,g.A)(function*(){if(!n.connection)throw new S.A("worker-client:histogram","connection is required");return n.connection.invoke("histogram",{attribute:t,features:r})})()}heatmapStatistics(t,r){var n=this;return(0,g.A)(function*(){if(!n.connection)throw new S.A("worker-client:heatmap-statistics","connection is required");return n.connection.invoke("heatmapStatistics",{attribute:t,features:r})})()}}var re=F(81098),H=F(89952),b=F(56492),ge=F(68438),O=F(86300),_=F(89563),f=F(85718),v=F(68800),x=F(6829),N=F(93164),R=F(34687),ae=F(11170),ne=F(93327),st=F(87086);function _e(){return _e=(0,g.A)(function*(e,t,r,n){return function Ot(e,t,r,n){return Ne.apply(this,arguments)}(t,yield function Nt(e,t,r,n){return Me.apply(this,arguments)}(e,t,r,n),r,n)}),_e.apply(this,arguments)}function Me(){return(Me=(0,g.A)(function*(e,t,r,n){const i={...n},s=function $t(e,t){let r=st.A.from(e);r.sourceSpatialReference=r.sourceSpatialReference??t?.sourceSpatialReference??null,(t?.gdbVersion||t?.dynamicDataSource)&&(r=r===e?r.clone():r,r.gdbVersion=e.gdbVersion||t.gdbVersion,r.dynamicDataSource=e.dynamicDataSource?N.L.from(e.dynamicDataSource):t.dynamicDataSource);const n=t?.infoFor3D;if(null!=n&&ot(e,n)){r=r===e?r.clone():r,r.formatOf3DObjects=null;const i=(0,x.U9)(n),s=(0,x.CW)(n);for(const l of n.queryFormats){if(l===i){r.formatOf3DObjects=l;break}l!==s||r.formatOf3DObjects||(r.formatOf3DObjects=l)}if(!r.formatOf3DObjects)throw new S.A("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==r.outFields||!r.outFields.includes("*")){r=r===e?r.clone():r,null==r.outFields&&(r.outFields=[]);const{originX:l,originY:m,originZ:u,translationX:d,translationY:c,translationZ:p,scaleX:y,scaleY:h,scaleZ:A,rotationX:V,rotationY:z,rotationZ:M,rotationDeg:E}=n.transformFieldRoles;r.outFields.push(l,m,u,d,c,p,y,h,A,V,z,M,E)}}return r}(t,r),l=null!=t.outStatistics?.[0],m=(0,Ee.A)("featurelayer-pbf-statistics"),u=!l||m;let d;if("pbf"===r?.format&&u)try{d=yield(0,ae.S)(e,s,i)}catch(c){if("query:parsing-pbf"!==c.name)throw c;r.format="json"}return"json"!==r?.format&&u||(d=yield(0,R.e)(e,s,i)),function bt(e,t){if(null!=e&&null!=t)for(const r of t){const n=e.get(r.name);n&&Object.assign(r,n.toJSON())}}(r?.fieldsIndex,d.fields),d})).apply(this,arguments)}function Ne(){return(Ne=(0,g.A)(function*(e,t,r,n){const i=r?.infoFor3D;if(!ot(e,i)||null==i||!t.assetMaps||!t.features?.length)return ne.A.fromJSON(t);const{meshFeatureSetFromJSON:s}=yield(0,b.qr)(Promise.all([F.e(5434),F.e(6456),F.e(6141),F.e(5184),F.e(2076),F.e(3567)]).then(F.bind(F,71698)),n);return s(e,i,t)})).apply(this,arguments)}function ot(e,t){return null!=t&&!0===e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}var ee=F(16842);function be(){return be=(0,g.A)(function*(e,t,r,n){const i=(0,v.Dl)(e),{source:s,checkValueRange:l}=t,{classificationDefinition:m}=r,u={...r.toJSON(),f:"json"};let d=null;if(d="class-breaks-definition"===m?.type?m.classificationField:m?.attributeField,s){const h={source:s?.toJSON()};u.layer=JSON.stringify(h)}u.classificationDef&&(u.classificationDef=JSON.stringify(u.classificationDef));let c={query:u};n&&(c={...n,...c});const p={url:i.path,field:d,checkValueRange:l};return(0,_.A)(i.path+"/generateRenderer",c).then(h=>function Pt(e,t){const{field:r,checkValueRange:n,url:i}=e,s=t?.data;if(!s)return;if(!n){const d=lt(s);return Promise.resolve(d)}const l=new ee.A({statisticType:"min",onStatisticField:r}),m=new ee.A({statisticType:"max",onStatisticField:r});return function Mt(e,t,r,n){return _e.apply(this,arguments)}(i,new st.A({outStatistics:[l,m]})).then(d=>{const c=d.features[0].attributes;let p=null,y=null;for(const h in c)0===h.toLowerCase().indexOf("min")?p=c[h]:y=c[h];return lt(s,p,y)})}(p,h))}),be.apply(this,arguments)}function lt(e,t,r){if("classBreaks"===e.type){const i=(0,f.r)(e);return{classBreaks:i.classBreakInfos.map((s,l)=>(0===l&&null!=t&&(s.minValue=t),l===i.classBreakInfos.length-1&&null!=r&&(s.maxValue=r),{minValue:s.minValue,maxValue:s.maxValue,label:s.label})),normalizationTotal:i.normalizationTotal}}const{uniqueValueInfos:n}=e;return{uniqueValues:n?.map((i,s)=>(0===s&&null!=t&&(i.value=t),s===n.length-1&&null!=r&&(i.value=r),{count:i.count,value:i.value,label:i.label}))??[]}}var ut=F(71065);let ie=class extends ut.A{constructor(e){super(e),this.classificationDefinition=null,this.where=null}};(0,L._)([(0,q.MZ)({json:{name:"classificationDef",write:!0}})],ie.prototype,"classificationDefinition",void 0),(0,L._)([(0,q.MZ)({type:String,json:{write:!0}})],ie.prototype,"where",void 0),ie=(0,L._)([(0,D.$)("esri.rest.support.GenerateRendererParameters")],ie);const Oe=ie;var Bt=F(15463);let k=class extends ut.A{constructor(e){super(e),this.type="unique-value-definition",this.attributeField=null,this.attributeField2=null,this.attributeField3=null,this.fieldDelimiter=null}get uniqueValueFields(){const e=[];return this.attributeField&&e.push(this.attributeField),this.attributeField2&&e.push(this.attributeField2),this.attributeField3&&e.push(this.attributeField3),e}};(0,L._)([(0,Bt.e)({uniqueValueDef:"unique-value-definition"})],k.prototype,"type",void 0),(0,L._)([(0,q.MZ)()],k.prototype,"attributeField",void 0),(0,L._)([(0,q.MZ)()],k.prototype,"attributeField2",void 0),(0,L._)([(0,q.MZ)()],k.prototype,"attributeField3",void 0),(0,L._)([(0,q.MZ)({json:{write:!0}})],k.prototype,"fieldDelimiter",void 0),(0,L._)([(0,q.MZ)({json:{write:!0}})],k.prototype,"uniqueValueFields",null),k=(0,L._)([(0,D.$)("esri.rest.support.UniqueValueDefinition")],k);const Rt=k,dt="no_dominant_category";function ct(e,t){const{returnFieldName:r,defaultValue:n,layer:i}=t,s=[];if(r&&n){const l=e.map(m=>`${m} <= 0`).join(" AND ");s.push(`WHEN ${l} THEN ${n}`)}for(const l of e){const m=e.reduce((c,p)=>(l!==p&&c.push(`${l} > ${p}`),c),[]).join(" AND "),u=i&&(0,T.R3)(i,l),d=r&&`'${l}'`?`'${l}'`:u?(0,T.Ll)(l):l;s.push(`WHEN ${m} THEN ${d}`)}return`CASE ${s.join(" ")} ELSE ${n||"0"} END`}function ve(e){const t=function $e(e,t=!1){const r=e.map(i=>`"${i}"`);return`\n  var fieldNames = [ ${r.join(", ")} ];\n  var numFields = ${r.length};\n  var maxValueField = null;\n  var maxValue = -Infinity;\n  var value, i, totalValue = null;\n\n  for(i = 0; i < numFields; i++) {\n    value = $feature[fieldNames[i]];\n\n    if(value > 0) {\n      if(value > maxValue) {\n        maxValue = value;\n        maxValueField = fieldNames[i];\n      }\n      else if (value == maxValue) {\n        maxValueField = null;\n      }\n    }\n    ${t?"\n  if(value != null && value >= 0) {\n    if (totalValue == null) { totalValue = 0; }\n    totalValue = totalValue + value;\n  }\n  ":""}\n  }\n  `}(e);return`\n  ${function X(e){return e&&e.map(t=>`$feature["${t}"];`).join("\n")+"\n"||""}(e)}\n  ${t}\n  return maxValueField;\n  `}var Ut=F(11432),Ie=F(48900),Zt=F(721),Pe=F(38965),Jt=F(22772),P=F(88113),jt=F(55098);let Q=class extends jt.A{constructor(e){super(e),this.adapterName="layer-adapter"}};(0,L._)([(0,q.MZ)({readOnly:!0})],Q.prototype,"adapterName",void 0),(0,L._)([(0,q.MZ)({constructOnly:!0})],Q.prototype,"layer",void 0),(0,L._)([(0,q.MZ)()],Q.prototype,"geometryType",void 0),(0,L._)([(0,q.MZ)()],Q.prototype,"objectIdField",void 0),(0,L._)([(0,q.MZ)()],Q.prototype,"supportsSQLExpression",void 0),(0,L._)([(0,q.MZ)()],Q.prototype,"hasQueryEngine",void 0),(0,L._)([(0,q.MZ)()],Q.prototype,"minScale",void 0),(0,L._)([(0,q.MZ)()],Q.prototype,"maxScale",void 0),(0,L._)([(0,q.MZ)()],Q.prototype,"fullExtent",void 0),Q=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.LayerAdapter")],Q);const Be=Q;var kt=F(48266),Ht=F(85423),Wt=F(81930),Xt=F(58326),Kt=F(95568),Yt=F(45005),er=F(15421),tr=F(59577),rr=(F(15109),F(59703),F(25436),F(29141)),$=F(59377);const ar=/_value$/i,nr=Math.LOG10E,ir={SECOND:1e3,MINUTE:6e4,HOUR:36e5},se=10;function oe(e){return e.map(t=>t.toJSON())}function yt(e,t){const r=[],n=e.layer,i="featureReduction"in n?n.featureReduction:null,s="binning"===i?.type,l=null!=i&&"fields"in i?i.fields?.map(m=>m.name?.toLowerCase()).filter(Boolean):[];if(!s||!t)return r;for(const m of t)l.includes(m.toLowerCase())||r.push(m);return r}function Fe(e,t,r){const n=[];if(t)for(const i of t){const s=e.getField(i);s&&r&&"availableFields"in r&&!r.availableFields?.includes(s.name)&&n.push(s.name)}return n}function Re(e,t){const r=e&&e.features;if(0===r?.length)return{avg:null,count:0,max:null,median:null,min:null,nullcount:0,stddev:null,sum:null,variance:null};const n=r?.[0]?.attributes,i={};for(const s in n)i[s.replace(ar,"").toLowerCase()]=n[s];return null!=i.totalcount&&i.totalcount>=i.count&&(i.nullcount=i.totalcount-i.count),delete i.totalcount,i.min===i.max&&null!=i.min&&null==i.stddev&&(i.stddev=i.variance=0),t&&(["min","max","avg","stddev","sum","variance"].forEach(s=>{null!=i[s]&&(i[s]=Math.ceil(i[s]))}),i.min===i.max&&null!=i.min&&(i.avg=i.min,i.stddev=i.variance=0)),i}function te(e){const{field:t,normalizationType:r,normalizationField:n,normalizationTotal:i,layer:s}=e,l=(0,T.R3)(s,t);let m=t;return"percent-of-total"===r?m=`((${l?(0,T.Ll)(t):t} / ${i}) * 100)`:"log"===r?m=`(log(${t}) * ${nr})`:"field"===r?m=`(${l?(0,T.Ll)(t):t} / ${n})`:"natural-log"===r?m=`(log(${l?(0,T.Ll)(t):t}))`:"square-root"===r&&(m=`(power(${l?(0,T.Ll)(t):t}, 0.5))`),m}function ft(e,t){let r;if(t=t.toLowerCase(),e)for(const n in e)if(n.toLowerCase()!==t){r=e[n];break}return r}function le(e,t){let r;if(t=t.toLowerCase(),e)for(const n in e)if(n.toLowerCase()===t){r=e[n];break}return r}function ht(e,t,r,n,i){const s={},l="countOFExpr";e&&e.features&&e.features.forEach(u=>{const d=u.attributes,c=ft(d,l),p=le(d,l);null!=c&&null!=p&&0!==c&&(s[c]=p)});const m=[];return(0,$.OR)(t,r,n).forEach((u,d)=>{const c=(d+1).toString();m.push({minValue:u[0],maxValue:u[1],count:s.hasOwnProperty(c)?s[c]:0})}),{bins:m,minValue:t,maxValue:r,normalizationTotal:i}}function Ge(e,t){return De.apply(this,arguments)}function De(){return(De=(0,g.A)(function*(e,t){const r=e&&e.features,{field:n,field2:i,field3:s,fieldDelimiter:l,layer:m,view:u,signal:d,labels:c}=t,p=`countOF${(!n||!i)&&n||"Expr"}`,y={};let h=!1;for(const A of r){const V=A.attributes,z=le(V,p);let M=n?le(V,n):ft(V,p),E=i?le(V,i):null,B=s?le(V,s):null;null===M&&0===z&&(h=!0),(null==M||"string"==typeof M&&""===M.trim())&&(M=null),i&&(null==E||"string"==typeof E&&""===E.trim())&&(E=null),s&&(null==B||"string"==typeof B&&""===B.trim())&&(B=null);let I=M;i&&(I=`${(0,$.gJ)(I)}${l}${(0,$.gJ)(E)}`,s&&(I=`${I}${l}${(0,$.gJ)(B)}`)),null==y[I]?y[I]={count:z,data:I}:y[I].count=y[I].count+z}if(n&&h){const A=n+" is NULL";try{const V=yield m.queryFeatureCount({whereClause:A,view:u,signal:d});return y.null.count=y.null.count+V,Qe(y,c)}catch{return(0,b.Te)(d),Qe(y,c)}}return Qe(y,c)})).apply(this,arguments)}function Qe(e,t){if(t)for(const r in e)e[r].label=t[r];return{count:e}}function Ue(e,t,r){return Ze.apply(this,arguments)}function Ze(){return(Ze=(0,g.A)(function*(e,t,r){const n=e?r.getField(e):null,i=n?r.getFieldDomain(n.name):null;if(i)return i;const{uniqueValueInfos:s}=yield r.uniqueValues({field:e,sqlWhere:t.sqlWhere,features:t.features,useFeaturesInView:t.useFeaturesInView,view:t.view,signal:t.signal}),l=s.map(m=>new er.H({code:m.value}));return new tr.A({codedValues:l})})).apply(this,arguments)}function Se(e,t){return Je.apply(this,arguments)}function Je(){return(Je=(0,g.A)(function*(e,t){if(!e.returnAllCodedValues)return[];const{field:r,field2:n,field3:i}=e;if(r&&!n){const l=r?t.getField(r):null,m=l?t.getFieldDomain(l.name):null;return m?[m]:[]}const s=[];return r&&(s.push(Ue(r,e,t)),n&&(s.push(Ue(n,e,t)),i&&s.push(Ue(i,e,t)))),Promise.all(s)})).apply(this,arguments)}function U(e){return{viewingMode:"2d"===e.type?"map":e.viewingMode,scale:e.scale,spatialReference:e.spatialReference?.toJSON()}}function je(e,t){const r=new Set(e.map(i=>i.value)),n=t.filter(i=>!r.has(i));for(const i of n)e.push({value:i,count:0});e.sort((i,s)=>t.indexOf(i.value)-t.indexOf(s.value));for(const i of e)i.value===dt&&(i.value=null);return{predominantCategoryInfos:e}}function gt(e){const t="featureReduction"in e?e.featureReduction:null;return((null!=t&&"fields"in t?t.fields:null)??[]).map(r=>{const n=function dr(e,t){switch(e.statisticType){case"avg":case"avg_angle":return"double";case"count":return"integer";case"min":case"max":case"sum":return e.onStatisticField?t.get(e.onStatisticField)?.type??null:e.onStatisticExpression?"string"===e.onStatisticExpression.returnType?null:"double":null;case"mode":return e.onStatisticField?t.get(e.onStatisticField)?.type??null:e.onStatisticExpression?"string"===e.onStatisticExpression.returnType?"string":"double":null;default:return null}}(r,e.fieldsIndex);return n?new rr.A({type:n,name:r.name,alias:r.alias}):null}).filter(H.Ru)}function vt(e,t){return(0,T.fs)(t)?function or(e,t){return(0,T.aM)(e,new Date(0),t,"milliseconds").sqlExpression}(e,t?.name):(0,O.OH)(t)?function ur(e){return e?(0,T.Ll)(["HOUR","MINUTE","SECOND"].map(t=>`(${function lr(e,t){return`EXTRACT(${t} FROM ${e}) * ${ir[t]}`}(e,t)})`).join(" + ")):null}(t?.name):null}function ke(e,t,r){const{field:n,normalizationType:i,normalizationField:s,normalizationTotal:l,minValue:m,maxValue:u,filter:d}=t,c=e.supportsSQLExpression?vt(e,r)||t.sqlExpression:null,p=te({field:n,normalizationType:i,normalizationField:s,normalizationTotal:l,layer:e}),y=c||p,h=y?(0,C.lX)(y,m,u):null,A=(0,C.Lc)({field:n,normalizationField:s,normalizationType:i}),V=(0,C.sf)(t.sqlWhere,A),z=(0,C.sf)(V,h),M=(0,$.Vb)({normalizationField:s,normalizationType:i,sqlExpression:c,supportsSQLExpression:e.supportsSQLExpression,minValue:m,maxValue:u}),E=(0,O.yM)(e.getField(n??void 0)),{include:B,exclude:I}=t.outStatisticTypes||{},at=$.wy.filter(J=>(!B||B.includes(J))&&(!I||!I.includes(J))&&("nullcount"===J?M:!E||"count"===J)),W=e.createQuery();return W.where=(0,C.sf)(W.where,z),W.sqlFormat=c?"standard":null,W.outStatistics=at.map(J=>{const K=new ee.A;let ce=null,pe=null,qt=`${J}_value`;if("variance"===J)ce="var",pe=y;else if("nullcount"===J){const nt=e.objectIdField;ce="count",pe=nt&&e.getField(nt)?nt:"1",qt="totalcount_value"}else"median"===J?(ce="percentile-continuous",pe=y,K.statisticParameters={value:.5}):(ce=J,pe=y);return K.statisticType=ce,K.onStatisticField=pe,K.outStatisticFieldName=qt,K}),Z(W,d),W}function Z(e,t){t&&(e.geometry=t.geometry,e.spatialRelationship=t.spatialRelationship)}function Ft(e,t){const{field:r,field2:n,field3:i,sqlExpression:s}=t,l=!(!r||!n),m=e.createQuery();return m.where=(0,C.sf)(m.where,t.sqlWhere),m.sqlFormat=s?"standard":null,m.outStatistics=[mr(l?null:r,l?"1":s)].filter(Boolean),m.groupByFieldsForStatistics=[r||s,n,i].filter(Boolean),Z(m,t.filter),m}function mr(e,t){const r="countOF"+(e||"Expr"),n=new ee.A;return n.statisticType="count",n.onStatisticField=t?"1":e,n.outStatisticFieldName=r,n}function xe(e,t,r,n=se,i,s,l){const{min:m,max:u,normTotal:d,excludeZerosExpr:c}=t,p=t.intervals||(0,$.OR)(m,u,n);return function cr(e,t,r,n,i,s,l){const m=[],u=t.length;for(let d=0;d<u;d++){const c=(0,C.sf)(n,(0,C.sf)(r+" >= "+t[d][0],null!==t[d][1]?r+(d===u-1?" <= ":" < ")+t[d][1]:""));m.push(c)}return Promise.allSettled(m.map(d=>e.queryFeatureCount({whereClause:d,view:i,filter:s,signal:l})))}(e,p,t.sqlExpr||r,c,i,s,l).then(h=>({bins:h.map((A,V)=>({minValue:p[V][0],maxValue:p[V][1],count:"fulfilled"===A.status?A.value:0})),minValue:m,maxValue:u,normalizationTotal:d}))}const St="countOFExpr";function xt(e,t,r){const i=e.signal;if(!e.valueExpression&&!e.sqlExpression){const{field:s,normalizationType:l,normalizationField:m}=e,u=s?t.getField(s):null,d=(0,T.fs)(u)||(0,O.OH)(u);return{sqlExpression:d?vt(t,u):te({field:s,normalizationType:l,normalizationField:m,normalizationTotal:r,layer:t}),sqlWhere:d?null:e.sqlWhere||(0,C.Lc)({field:s,normalizationType:l,normalizationField:m}),filter:e.filter,signal:i}}return{valueExpression:e.valueExpression,sqlExpression:e.sqlExpression,sqlWhere:e.sqlWhere,filter:e.filter,signal:i}}function He(e,t,r){return We.apply(this,arguments)}function We(){return(We=(0,g.A)(function*(e,t,r){const{field:n,normalizationType:i,normalizationField:s,signal:l}=e,m=(0,C.Lc)({field:n,normalizationType:i,normalizationField:s}),u=new Oe({classificationDefinition:(0,$.al)({field:n,normalizationType:i,normalizationField:s,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,definedInterval:e.definedInterval,breakCount:e.numBins||se}),where:(0,C.sf)(m,r)});return t.generateRenderer(u,l).then(d=>{const{normalizationTotal:c,classBreaks:p}=d;return function sr(e){const t=[],r=e.classBreaks,n=r[0].minValue,i=r[r.length-1].maxValue;return r.forEach(l=>{t.push([l.minValue,l.maxValue])}),{min:n,max:i,intervals:t,sqlExpr:te({field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,layer:e.layer}),excludeZerosExpr:e.where,normTotal:e.normalizationTotal}}({field:n,normalizationType:i,normalizationField:s,normalizationTotal:c,classBreaks:p,where:m,layer:t})})})).apply(this,arguments)}function fr(e,t,r,n,i){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,g.A)(function*(e,t,r,n,i){const{field:s,sqlExpression:l,normalizationField:m,classificationMethod:u,normalizationType:d}=e,c=s?t.getField(s):null,p=(0,O.OH)(c),y=(0,O.zD)(c)||p,h=e.numBins||se;if(y){if(d||u)throw new S.A(`${t.adapterName}:not-supported`,"NormalizationType and classificationMethod are not supported for date-only and time-only fields");const A=(n-r)/h/1e3;return new Xt.A({field:s,expression:l,interval:{unit:p?"seconds":"days",value:Math.ceil(p?A:A/86400)},start:r,end:n})}if("defined-interval"===u)return new Yt.A({field:s,expression:l,normalizationField:m,normalizationTotal:i,normalizationType:d,interval:e.definedInterval??Math.ceil((n-r)/h),start:d?null:r,end:d?null:n,normalizationMinValue:d?r:null,normalizationMaxValue:d?n:null});if("manual"===u)throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support manual classificationMethod");if("natural-breaks"===u||"quantile"===u||"standard-deviation"===u){const A=te({field:s,normalizationField:m,normalizationTotal:i,normalizationType:d,layer:t}),V=null!==e.minValue&&null!==e.maxValue?(0,C.lX)(A,e.minValue,e.maxValue):void 0,z=yield He(e,t,V);if(!z.intervals)throw new S.A(`${t.adapterName}:invalid`,"Invalid intervals returned from generate renderer");const M=[r,...z.intervals.map(E=>E[1])];return new Kt.A({field:d?null:s,expression:d?A:l,boundaries:M})}return new Wt.A({field:s,normalizationField:m,normalizationTotal:i,normalizationType:d,expression:l,numBins:h,start:d?null:r,end:d?null:n,normalizationMinValue:d?r:null,normalizationMaxValue:d?n:null})})).apply(this,arguments)}function wt(e,t,r,n){return null!=r&&null!=n?Promise.resolve({min:r,max:n}):t.summaryStatistics({...e,outStatisticTypes:{include:["min","max"]}}).then(i=>({min:i.min,max:i.max}))}function At(e,t,r,n){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,g.A)(function*(e,t,r,n){const{field:i,minValue:s,maxValue:l,filter:m,view:u}=e,d=i?t.getField(i):null,c=(0,O.vE)(d)||(0,O.Ah)(d),p=xt(e,t,r),{min:y,max:h}=yield wt(p,t,s,l);if(null==y||null==h)return{query:null,min:y,max:h};const A=new ee.A({statisticType:"count",outStatisticFieldName:St,onStatisticField:"1"}),V=(0,C.sf)(n,p.sqlWhere),E=new Ht.default({binParameters:yield fr(e,t,y,h,r),outStatistics:[A],binOrder:e.sortOrder,where:V,lowerBoundaryAlias:"lowerBoundary",upperBoundaryAlias:"upperBoundary",outTimeZone:u?.timeZone&&c?(0,kt.wj)(u.timeZone):null});return Z(E,m),{query:E,min:y,max:h}})).apply(this,arguments)}function Vt(e,t=!1){return"string"!=typeof e?e:(t?new Date(`1970-01-01T${e}Z`):new Date(e)).getTime()}function Lt(e,t,r){const n=(0,O.OH)(t);return{...r,bins:e.features.map(i=>({minValue:Vt(i.attributes.lowerBoundary,n),maxValue:Vt(i.attributes.upperBoundary,n),count:i.attributes[St]}))}}function Tt(e,t,r){const{valueExpression:n,view:i}=e,{featuresJSON:s,graphics:l,fieldInfos:m}=t,u={field:e.field,valueExpression:n,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:r,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return n&&i&&(s||l)&&(u.viewInfoParams=U(i),u.timeZone=i.timeZone,u.fieldInfos=m),u}var hr=F(48218);let we=null,ue=class extends Be{constructor(){super(...arguments),this._hasLocalSource=!1,this.adapterName="in-memory-layer-adapter"}destroy(){this.workerClient?.destroy()}_waitForLayerViewUpdate(e){var t=this;return(0,g.A)(function*(){if(!e)throw new S.A(`${t.adapterName}:insufficient-data", "layerView is required to fetch the features`);const r=new AbortController,n=(0,Ie.C_)(()=>!e.updating,r.signal);yield(0,b.wR)(n,5e3,r).catch(i=>{throw Ce.A.getLogger(t).warn("LayerView is taking too long to update. Aborting fetch from layerView."),i})})()}_fetchFeatureSetFromMemory(e,t,r){var n=this;return(0,g.A)(function*(){const i=n.layer;if(n._hasLocalSource&&"queryFeatures"in i)return i.queryFeatures(e);if(!t)throw new S.A(`${n.adapterName}:insufficient-data`,"view is required to fetch the features from layerView");const s=yield t.whenLayerView(n.layer);return yield n._waitForLayerViewUpdate(s),s.queryFeatures(e,{signal:r})})()}_fetchFeaturesFromMemory(e,t,r,n){var i=this;return(0,g.A)(function*(){const s=i.layer,l="json"===n;if(i._hasLocalSource&&"queryFeatures"in s){const u=yield s.queryFeatures(t);return l?oe(u.features):u.features}if(yield i._waitForLayerViewUpdate(e),l&&"queryFeaturesJSON"in e&&e.queryFeaturesJSON){const{features:u}=yield e.queryFeaturesJSON(t,{signal:r});return u}if(!("queryFeatures"in e))throw new S.A(`${i.adapterName}:not-supported`,"'queryFeatures' is not supported on the layerView");const m=yield e.queryFeatures(t,{signal:r});return l?oe(m.features):m.features})()}_fetchFeaturesForStats(e,t){return(0,T.EG)({field:e.field,field2:e.field2,field3:e.field3,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then(r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,filter:e.filter,requiredFields:r,signal:e.signal},t))}_summaryStatsFromClientQuery(e,t){var r=this;return(0,g.A)(function*(){const{view:n,signal:i}=e,s=ke(r,e,t),m=Re(yield r._fetchFeatureSetFromMemory(s,n,i),(0,T.fs)(t)||(0,O.OH)(t));return(0,$.oZ)(m,e.outStatisticTypes)})()}_getNormalizationTotalFromMemory(e,t,r){var n=this;return(0,g.A)(function*(){const{featuresJSON:i,graphics:s,layerView:l,query:m}=t,u={include:["sum"]},d=(!i&&!s&&l&&"querySummaryStatistics"in l?yield l.querySummaryStatistics(m,{field:e},{signal:r}):i?yield n.workerClient.summaryStatistics({field:e,outStatisticTypes:u},i):yield(0,P.summaryStatistics)({attribute:{field:e,outStatisticTypes:u},features:s??[]})).sum;if(null==d)throw new S.A(`${n.adapterName}:invalid`,"invalid normalizationTotal");return d})()}_summaryStatsFromMemory(e,t){var r=this;return(0,g.A)(function*(){const{view:n,field:i,valueExpression:s,normalizationType:l,signal:m}=e,u={field:i,valueExpression:s,normalizationType:l,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes},{featuresJSON:d,graphics:c,layerView:p,query:y,fieldInfos:h}=yield r._processStatsFromMemoryParams({...e,layerViewFunc:"querySummaryStatistics"});return s&&n&&(d||c)&&(u.fieldType=t?.type?Pe.m.toJSON(t.type):null,u.viewInfoParams=U(n),u.timeZone=n.timeZone,u.fieldInfos=h),"percent-of-total"===l&&null==e.normalizationTotal&&(u.normalizationTotal=yield r._getNormalizationTotalFromMemory(i,{featuresJSON:d,graphics:c,layerView:p,query:y},m)),!d&&!c&&p&&"querySummaryStatistics"in p?p.querySummaryStatistics(y,u,{signal:m}):d?r.workerClient.summaryStatistics(u,d):(0,P.summaryStatistics)({attribute:u,features:c})})()}_getFilteredFeatures(e,t){return(0,g.A)(function*(){let r=[];if("intersects"===t?.spatialRelationship){const{intersect:n}=yield F.e(9154).then(F.bind(F,16773)),i=null!=t.geometry?t.geometry:null;for(const s of e){const l=null!=s.geometry?s.geometry:null;l&&i&&(yield n(l,i))&&r.push(s)}}else r=e;return e.length&&"declaredClass"in e[0]&&"esri.Graphic"===e[0].declaredClass?{graphics:r}:{featuresJSON:r}})()}_processStatsFromMemoryParams(e){var t=this;return(0,g.A)(function*(){const{features:r,filter:n}=e;if(r?.length)return t._getFilteredFeatures(r,n);const{view:i,field:s,field2:l,field3:m,normalizationField:u,valueExpression:d,layerViewFunc:c,signal:p}=e;let y=e.returnGeometry;if(null==y&&d){if(!we){const{arcadeUtils:B}=yield(0,hr.lw)();we=B}const E=we.hasGeometryOperations(d);E&&(yield we.enableGeometryOperations()),y=E}let h=null,A=null,V=null,z=null,M=null;if(i)try{const E="subtype-sublayer"===t.layer.type?t.layer.parent:t.layer;h=yield i.whenLayerView(E),A=null!=c&&c in h&&"function"==typeof h[c]}catch{A=!1}if(A)try{yield t._waitForLayerViewUpdate(h);const E=yield(0,T.EG)({field:s,field2:l,field3:m,normalizationField:u,valueExpression:d});Fe(t,E,h).length?A=!1:(V=t.layer.createQuery(),V.outFields=E,V.returnGeometry=!1,Z(V,n)),h.suspended&&(A=!1)}catch{A=!1}return A||(z=yield t._fetchFeaturesForStats({field:s,field2:l,field3:m,valueExpression:d,normalizationField:u,returnGeometry:y,filter:n,view:i,signal:p},"json"),M=(yield(0,T.EG)({valueExpression:d})).map(E=>t.getField(E)?.toJSON()).filter(Boolean)),{layerView:h,query:V,featuresJSON:z,fieldInfos:M}})()}_uvFromClientQuery(e,t){var r=this;return(0,g.A)(function*(){const{view:n,signal:i}=e,s=Ft(r,e),l=yield r._fetchFeatureSetFromMemory(s,n,i),m=yield Ge(l,{layer:r,field:e.field,field2:e.field2,field3:e.field3,fieldDelimiter:T.UH,view:e.view,signal:e.signal});return(0,$.lv)(m,t,e.returnAllCodedValues,T.UH)})()}_uvFromMemory(e,t){var r=this;return(0,g.A)(function*(){const{view:n,field:i,valueExpression:s,returnAllCodedValues:l,signal:m}=e,{featuresJSON:u,graphics:d,layerView:c,query:p,fieldInfos:y}=yield r._processStatsFromMemoryParams({...e,layerViewFunc:"queryUniqueValues"}),h={field:i,field2:e.field2,field3:e.field3,fieldDelimiter:T.UH,valueExpression:s,domains:t,returnAllCodedValues:l};return s&&n&&(u||d)&&(h.viewInfoParams=U(n),h.timeZone=n.timeZone,h.fieldInfos=y),!u&&!d&&c&&"queryUniqueValues"in c?c.queryUniqueValues(p,h,{signal:m}):u?r.workerClient.uniqueValues(h,u):(0,P.uniqueValues)({attribute:h,features:d})})()}_histogramForField(e){let t=null;return t=null!=e.minValue&&null!=e.maxValue?Promise.resolve({min:e.minValue,max:e.maxValue}):this.summaryStatistics({...e,outStatisticTypes:{include:["min","max","count"]}}).then(r=>{if(!r.count)throw new S.A(`${this.adapterName}:insufficient-data`,"Either the layer has no features or none of the features have data for the field");return{min:r.min,max:r.max}}),t.then(r=>xe(this,{min:r.min,max:r.max},e.field,e.numBins??void 0,e.view,e.filter,e.signal))}_histogramFromQueryAttributeBinsFromMemory(e){var t=this;return(0,g.A)(function*(){const{field:r,normalizationType:n,signal:i}=e,s=yield t._processStatsFromMemoryParams({...e,layerViewFunc:"queryAttributeBins"}),{featuresJSON:l,graphics:m,layerView:u,query:d}=s,c="percent-of-total"===n?e.normalizationTotal??(yield t._getNormalizationTotalFromMemory(r,s,i)):void 0;if(!u||!("queryAttributeBins"in u)||l||m){const V=Tt(e,s,c);return l?t.workerClient.histogram(V,l):(0,P.histogram)({attribute:V,features:m})}const{query:p,min:y,max:h}=yield At(e,t,c,d?.where);return p?Lt(yield u.queryAttributeBins(p,{signal:i}),r?t.getField(r):null,{minValue:y,maxValue:h,normalizationTotal:c}):{bins:[],minValue:y,maxValue:h,normalizationTotal:c}})()}_histogramFromMemory(e){var t=this;return(0,g.A)(function*(){const{field:r,signal:n}=e,i=yield t._processStatsFromMemoryParams({...e,layerViewFunc:"queryHistogram"}),{featuresJSON:s,graphics:l,layerView:m,query:u}=i,d="percent-of-total"===e.normalizationType?e.normalizationTotal??(yield t._getNormalizationTotalFromMemory(r,i,n)):void 0,c=Tt(e,i,d);return!s&&!l&&m&&"queryHistogram"in m?m.queryHistogram(u,c,{signal:n}):s?t.workerClient.histogram(c,s):(0,P.histogram)({attribute:c,features:l})})()}_classBreaksFromInterpolation(e){const{minValue:t,maxValue:r}=e,n=e.numClasses||5,i=[],s=(r-t)/n;for(let u=0;u<n;u++){const d=t+u*s;i.push({minValue:d,maxValue:d+s})}i[n-1].maxValue=r;const m=(0,$.jM)({classBreaks:i,normalizationTotal:e.normalizationTotal},e.classificationMethod);return Promise.resolve(m)}_classBreaksFromMemory(e){var t=this;return(0,g.A)(function*(){const{view:r,field:n,valueExpression:i,signal:s}=e,{featuresJSON:l,graphics:m,layerView:u,query:d,fieldInfos:c}=yield t._processStatsFromMemoryParams({...e,layerViewFunc:"queryClassBreaks"}),p={field:n,valueExpression:i,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return i&&r&&(l||m)&&(p.viewInfoParams=U(r),p.timeZone=r.timeZone,p.fieldInfos=c),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(p.normalizationTotal=yield t._getNormalizationTotalFromMemory(n,{featuresJSON:l,graphics:m,layerView:u,query:d},s)),!l&&!m&&u&&"queryClassBreaks"in u?u.queryClassBreaks(d,p,{signal:s}):l?t.workerClient.classBreaks(p,l):(0,P.classBreaks)({attribute:p,features:m})})()}_heatmapStatsFromMemory(e){var t=this;return(0,g.A)(function*(){const{view:r,field:n,radius:i,signal:s}=e;(0,Ut.Lw)(r,"InMemoryLayerAdapter: must have a view");try{const c=yield r.whenLayerView(t.layer);if("queryHeatmapStatistics"in c&&!c.updating&&!e.filter)return yield c.queryHeatmapStatistics({field:e.field,radius:e.radius})}catch{(0,b.Te)(s)}const{featuresJSON:l,graphics:m}=yield t._processStatsFromMemoryParams({...e,returnGeometry:!0}),u=new Jt.A({extent:r.extent,tolerance:"2d"===r.type?r.state.resolution:r.pixelSizeAt?.(r.center)}),d={field:n,radius:i,transform:(0,Zt.VV)(u),spatialReference:r.spatialReference?.toJSON(),size:r.size};return l?.length||m?.length?l?t.workerClient.heatmapStatistics(d,l):(0,P.heatmapStatistics)({attribute:d,features:m}):{min:null,max:null}})()}getField(e=""){return this.layer.getField(e)}getFieldUsageInfo(e){return this.getField(e)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!0,supportsStatistics:!0}:null}getFieldDomain(e,t){return this.layer.getFieldDomain(e,t)}createQuery(){return this.layer.createQuery()}summaryStatistics(e){var t=this;return(0,g.A)(function*(){const{field:r,valueExpression:n,sqlExpression:i,features:s,view:l}=e,m=r?t.getField(r):null,u=!!n,d="3d"===l?.type;if(!n&&i&&!t.supportsSQLExpression)throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return u||s||d?t._summaryStatsFromMemory(e,m):t._summaryStatsFromClientQuery(e,m)})()}uniqueValues(e){var t=this;return(0,g.A)(function*(){const{valueExpression:r,sqlExpression:n,features:i,view:s}=e,l=yield Se(e,t),m=!!r,u="3d"===s?.type;if(!r&&n&&!t.supportsSQLExpression)throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return m||i||u?t._uvFromMemory(e,l):t._uvFromClientQuery(e,l)})()}histogram(e){var t=this;return(0,g.A)(function*(){const{features:r,valueExpression:n,normalizationType:i,sqlExpression:s}=e,l=r||!!n;if(!n&&s&&!t.supportsSQLExpression)throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return l||i?t._histogramFromMemory(e):t._histogramForField(e)})()}classBreaks(e){var t=this;return(0,g.A)(function*(){return!1!==e.analyzeData?t._classBreaksFromMemory(e):t._classBreaksFromInterpolation(e)})()}queryFeatureCount(e){var t=this;return(0,g.A)(function*(){const{whereClause:r,view:n,signal:i}=e;if(!n)throw new S.A(`${t.adapterName}:insufficient-data`,"view is required to fetch the features from layerView");const s=t.layer.createQuery();s.where=(0,C.sf)(s.where,r);const l=yield n.whenLayerView(t.layer);return yield(0,Ie.C_)(()=>!l.updating,i),l.queryFeatureCount(s,{signal:i})})()}generateRenderer(e,t){var r=this;return(0,g.A)(function*(){throw new S.A(`${r.adapterName}:not-supported`,"Layer does not support generateRenderer operation")})()}predominantCategories(e){var t=this;return(0,g.A)(function*(){const{fields:r,view:n,signal:i,filter:s}=e,l=ve(r);return je((yield t._uvFromMemory({valueExpression:l,view:n,signal:i,filter:s})).uniqueValueInfos,r)})()}heatmapStatistics(e){var t=this;return(0,g.A)(function*(){return t._heatmapStatsFromMemory(e)})()}getSampleFeatures(e,t){var r=this;return(0,g.A)(function*(){const{view:n,sampleSize:i,requiredFields:s,returnGeometry:l,filter:m,signal:u}=e,d=r.layer.createQuery();if(d.outSpatialReference=n?.spatialReference,d.returnGeometry=!!l,d.outFields=s,Z(d,m),!n)throw new S.A(`${r.adapterName}:not-supported`,"view is required to get sample features for Layer");const p=yield n.whenLayerView(r.layer);if(Fe(r,s,p).length)throw new S.A(`${r.adapterName}:not-supported`,"Required fields need to be passed in the outFields for Layer");const y=yield r._fetchFeaturesFromMemory(p,d,u,t);return(0,H.BB)(y,null!=i&&i>0&&i<=y.length?i:y.length,1)})()}load(e){var t=this;const r=this.layer.load(e).then(function(){var n=(0,g.A)(function*(i){t.geometryType=i.geometryType,t.objectIdField=i.objectIdField,t.supportsSQLExpression="stream"===i.type||!!i.capabilities?.query?.supportsSqlExpression,t.minScale=i.minScale,t.maxScale=i.maxScale,t.fullExtent="fullExtent"in i?i.fullExtent:i.parent?.fullExtent,t._hasLocalSource=!1,t.hasQueryEngine=!0,t.workerClient=j.getInstance(),yield t.workerClient.open(e.signal)});return function(i){return n.apply(this,arguments)}}());return this.addResolvingPromise(r),Promise.resolve(this)}};(0,L._)([(0,q.MZ)({readOnly:!0})],ue.prototype,"adapterName",void 0),(0,L._)([(0,q.MZ)({constructOnly:!0})],ue.prototype,"layer",void 0),ue=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.InMemoryLayerAdapter")],ue);const Ye=ue;var vr=F(6126);let de=class extends Ye{constructor(){super(...arguments),this.adapterName="feature-layer-adapter"}_isStatsSupportedOnService(){const e=this.layer;if(!e.capabilities?.query?.supportsStatistics||"multipatch"===this.geometryType&&!(0,ge.Wo)(e.url)&&e.version<10.5)throw new S.A(`${this.adapterName}:not-supported`,"Layer does not support statistics query");return Promise.resolve()}_fetchFeaturesFromService(e,t){return this.layer.queryFeatures(e,{signal:t}).then(r=>r.features)}_fetchFeaturesJSONFromService(e,t){return this._fetchFeaturesFromService(e,t).then(oe)}_summaryStatsFromGenRend(e){const t=e.normalizationType;return this.classBreaks({field:e.field,numClasses:5,classificationMethod:"standard-deviation",standardDeviationInterval:.25,normalizationType:t,normalizationField:"field"===t?e.normalizationField:void 0,minValue:e.minValue,maxValue:e.maxValue,filter:e.filter,signal:e.signal}).then(n=>{let i,s,l;if(n.classBreakInfos?.some(u=>(u.hasAvg&&(i=u),!!i)),i){const u=i.maxValue-i.minValue;s=i.minValue+u/2,l=4*u}return(0,$.oZ)({min:n.minValue,max:n.maxValue,avg:s,stddev:l},e.outStatisticTypes)})}_summaryStatsFromServiceQuery(e,t){var r=this;return(0,g.A)(function*(){yield r._isStatsSupportedOnService(),"percent-of-total"===e.normalizationType&&(e.normalizationTotal=yield r._getNormalizationTotal(e.field,e.normalizationType,e.filter));const n=(0,T.fs)(t)||(0,O.OH)(t),i=ke(r,e,t),l=Re(yield r.layer.queryFeatures(i,{signal:e.signal}),n);return(0,$.oZ)(l,e.outStatisticTypes)})()}_uvFromGenRenderer(e,t){const r=e.field??void 0,n=new Rt({attributeField:r}),i=new Oe({classificationDefinition:n});return this.generateRenderer(i,e.signal).then(s=>{const l={},m=this.getField(r);return s.uniqueValues.forEach(u=>{let d=u.value;null!=d&&""!==d&&("string"!=typeof d||""!==d.trim()&&"<null>"!==d.toLowerCase())||(d=null),null==l[d]?l[d]={count:u.count,data:(0,O.WA)(m)&&d?Number(d):d}:l[d].count=l[d].count+u.count}),{count:l}}).then(s=>(0,$.lv)(s,[t],e.returnAllCodedValues))}_uvFromServiceQuery(e,t){var r=this;return(0,g.A)(function*(){return r._isStatsSupportedOnService().then(()=>r.layer.queryFeatures(Ft(r,e),{signal:e.signal})).then(n=>Ge(n,{layer:r,field:e.field,field2:e.field2,field3:e.field3,fieldDelimiter:T.UH,view:e.view,signal:e.signal})).then(n=>(0,$.lv)(n,t,e.returnAllCodedValues,T.UH))})()}_getNormalizationTotal(e,t,r,n){return e&&"percent-of-total"===t?this.summaryStatistics({field:e,outStatisticTypes:{include:["sum"]},filter:r,signal:n}).then(i=>i.sum):Promise.resolve(null)}_histogramForExpr(e){return this._getNormalizationTotal(e.field,e.normalizationType,e.filter,e.signal).then(t=>{const r=xt(e,this,t);return wt(r,this,e.minValue,e.maxValue).then(n=>{const i=n.min,s=n.max;if(null==i||null==s)return{bins:[],minValue:i,maxValue:s,normalizationTotal:t};const l=e.numBins||se,m=(0,$.OR)(i,s,l),u=function Sr(e,t,r){const n=[],i=t.length;return t.forEach((s,l)=>{const[m,u]=s;let d=null;d=0!==l||r?l!==i-1||r?(0,C.sf)(`${e} >= ${m}`,`${e} ${l===i-1?" <= ":" < "} ${u}`):`${e} >= ${m}`:`${e} < ${u}`,n.push("WHEN ("+d+") THEN "+(l+1))}),["CASE",n.join(" "),"ELSE 0","END"].join(" ")}(r.sqlExpression,m,null!=e.minValue&&null!=e.maxValue),d=new ee.A({statisticType:"count",outStatisticFieldName:"countOFExpr",onStatisticField:"1"}),c=this.layer.createQuery();return c.where=(0,C.sf)(c.where,r.sqlWhere),c.sqlFormat="standard",c.outStatistics=[d],c.groupByFieldsForStatistics=[u],c.orderByFields=[u],Z(c,e.filter),this._isStatsSupportedOnService().then(()=>this.layer.queryFeatures(c,{signal:r.signal})).then(p=>ht(p,i,s,l,t))})})}_histogramFromQueryAttributeBins(e){var t=this;return(0,g.A)(function*(){const{field:r,normalizationType:n,filter:i,signal:s}=e,l=yield t._getNormalizationTotal(r,n,i,s),m=t.layer.createQuery(),{query:u,min:d,max:c}=yield At(e,t,l,m?.where);return u?Lt(yield t.layer.queryAttributeBins(u,{signal:s}),r?t.getField(r):null,{minValue:d,maxValue:c,normalizationTotal:l}):{bins:[],minValue:d,maxValue:c,normalizationTotal:l}})()}_classBreaksFromGenRend(e){const{field:t,normalizationType:r,normalizationField:n,normalizationTotal:i,signal:s}=e,l=(0,C.Lc)({field:t,normalizationType:r,normalizationField:n}),m=te({field:t,normalizationType:r,normalizationField:n,normalizationTotal:i,layer:this}),u=(0,C.lX)(m,e.minValue,e.maxValue),d=(0,$.al)({field:t,normalizationType:r,normalizationField:n,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||5}),c=new Oe({classificationDefinition:d});return c.where=(0,C.sf)(l,u),this.generateRenderer(c,s).then(p=>(0,$.jM)(p,e.classificationMethod))}summaryStatistics(e){var t=this;return(0,g.A)(function*(){const{field:r,normalizationType:n,valueExpression:i,sqlExpression:s,view:l,features:m,useFeaturesInView:u}=e,d=r?t.getField(r):null,c=(0,T.fs)(d)||(0,O.OH)(d),p=i&&!(s&&t.supportsSQLExpression);if(t._hasLocalSource||m||u||p)return p||m||u||l&&"3d"===l.type?t._summaryStatsFromMemory(e,d):t._summaryStatsFromClientQuery(e,d);if(!t.supportsSQLExpression&&(c||s||"natural-log"===n||"square-root"===n))throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return(n&&!t.supportsSQLExpression?t._summaryStatsFromGenRend(e):t._summaryStatsFromServiceQuery(e,d)).catch(()=>((0,b.Te)(e.signal),t._summaryStatsFromMemory(e,d)))})()}uniqueValues(e){var t=this;return(0,g.A)(function*(){const{valueExpression:r,sqlExpression:n,features:i,useFeaturesInView:s,signal:l}=e,m=r&&!(n&&t.supportsSQLExpression),u=t._hasLocalSource||i||s||m,d=e.view,c=d&&"3d"===d.type,p=yield Se(e,t);return u?m||i||s||c?t._uvFromMemory(e,p):t._uvFromClientQuery(e,p):t._uvFromServiceQuery(e,p).catch(y=>((0,b.Te)(l),!e.field||e.field2||e.field3||e.filter?y:t._uvFromGenRenderer(e,p[0]))).catch(()=>((0,b.Te)(l),c?t._uvFromMemory(e,p):t._uvFromClientQuery(e,p)))})()}histogram(e){var t=this;return(0,g.A)(function*(){const{field:r,normalizationType:n,normalizationField:i,classificationMethod:s,view:l,filter:m,signal:u}=e,d=r?t.getField(r):null,c=(0,T.fs)(d)||(0,O.OH)(d),p=e.valueExpression||e.sqlExpression,A=t.supportsSQLExpression,V=!s||"equal-interval"===s,z=e.minValue,M=e.maxValue,E=null!=z&&null!=M,B=e.numBins||se;if(t._hasLocalSource||e.features||e.useFeaturesInView||e.valueExpression&&(!e.sqlExpression||!t.supportsSQLExpression))return t._histogramFromMemory(e);if(t.layer.capabilities?.operations?.supportsQueryBins&&e.useQueryAttributeBins)try{return yield t._histogramFromQueryAttributeBins(e)}catch{return(0,b.Te)(u),t._histogramFromQueryAttributeBinsFromMemory(e)}if((p||A)&&V){if(!A&&(p||"natural-log"===n||"square-root"===n))throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support standardized SQL expression for queries");return t._histogramForExpr(e)}if(c&&V)throw new S.A(`${t.adapterName}:not-supported`,"Normalization and date field are not allowed when layer does not support standardized SQL expression for queries");return n||!V?He(e,t).then(I=>{if(!E)return xe(t,I,r,B,l,m,u);if(z>I.max||M<I.min)throw new S.A(`${t.adapterName}:insufficient-data`,"Range defined by 'minValue' and 'maxValue' does not intersect available data range of the field");if(V)return xe(t,{min:z,max:M,sqlExpr:I.sqlExpr,excludeZerosExpr:I.excludeZerosExpr},r,B,l,m,u);{const W=te({field:r,normalizationType:n,normalizationField:i,normalizationTotal:I.normTotal,layer:t}),J=(0,C.lX)(W,z,M);return He(e,t,J).then(K=>xe(t,K,r,B,l,m,u))}}):t._histogramForField(e)})()}classBreaks(e){var t=this;return(0,g.A)(function*(){const r=!1!==e.analyzeData;return r&&(t._hasLocalSource||e.features||e.useFeaturesInView||e.valueExpression||e.filter)?t._classBreaksFromMemory(e):(r?t._classBreaksFromGenRend(e):t._classBreaksFromInterpolation(e)).catch(()=>((0,b.Te)(e.signal),t._classBreaksFromMemory(e)))})()}queryFeatureCount(e){var t=this;return(0,g.A)(function*(){if(t._hasLocalSource)throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support count query");const r=t.layer,n=r.createQuery();return n.where=(0,C.sf)(n.where,e.whereClause),Z(n,e.filter),r.queryFeatureCount(n,{signal:e.signal})})()}generateRenderer(e,t){var r=this;return(0,g.A)(function*(){const n=r.layer;if(r._hasLocalSource||n.version<10.1)throw new S.A(`${r.adapterName}:not-supported`,"Layer does not support generateRenderer operation (requires ArcGIS Server version 10.1+)");const i=n.createQuery();return e.where=(0,C.sf)(e.where,i.where),function It(e,t,r,n){return be.apply(this,arguments)}(n.parsedUrl?.path??"",{source:n.dynamicDataSource??void 0,gdbVersion:n.gdbVersion??void 0},e,{signal:t})})()}predominantCategories(e){var t=this;return(0,g.A)(function*(){if(!t._hasLocalSource&&!t.supportsSQLExpression)throw new S.A(`${t.adapterName}:not-supported`,"Layer does not support advanced SQL expressions and standardized queries");const{fields:r,view:n,signal:i,filter:s}=e,l=ve(r),m=function Gt(e){return{expression:ct(e,{returnFieldName:!0,defaultValue:`'${dt}'`})}}(r);return je((n&&t._hasLocalSource?yield t._uvFromMemory({valueExpression:l,view:n,signal:i,filter:s}):yield t._uvFromServiceQuery({sqlExpression:m.expression,valueExpression:l,signal:i,filter:s})).uniqueValueInfos,r)})()}getSampleFeatures(e,t){var r=this;return(0,g.A)(function*(){const{view:n,requiredFields:i,returnGeometry:s,filter:l,signal:m}=e,u=e.sampleSize;if(null==u||0===u)return[];const d=r.layer.createQuery(),p="json"===t;d.outSpatialReference=n?.spatialReference,d.returnGeometry=!!s,d.outFields=i,Z(d,l);let y=[],h=!1;if(n)try{const A=yield n.whenLayerView(r.layer);if(h=!Fe(r,i,A).length,h){if(u>=1&&!e.filter&&"getSampleFeatures"in A){yield r._waitForLayerViewUpdate(A);const V=yield A.getSampleFeatures({minFeatureCount:u,sampleSize:u});if(null!=V)return p?V:V.map(z=>re.A.fromJSON(z))}if(y=yield r._fetchFeaturesFromMemory(A,d,m,t),y.length>=u&&u>0)return(0,H.BB)(y,u,1)}}catch{(0,b.Te)(m)}try{if(r._hasLocalSource)return h?y:p?yield r._fetchFeaturesJSONFromService(d,m):yield r._fetchFeaturesFromService(d,m);const A=yield r.queryFeatureCount({view:n,filter:l,signal:m}),V=r.layer.capabilities.query.maxRecordCount;let z=-1===u?A:u;if(z=V&&z>V?V:z,A<=y.length||y.length>=V)return y;if(d.maxAllowableOffset=e.resolution||4e5*(n?n.extent.width/n.width/n.scale:(0,vr.ri)(r.layer.spatialReference)),A<=z)return p?yield r._fetchFeaturesJSONFromService(d,m):yield r._fetchFeaturesFromService(d,m);if(A<=2e4){Z(r.layer.createQuery(),l);const E=yield r.layer.queryObjectIds();return d.objectIds=(0,H.BB)(E,z,1),p?yield r._fetchFeaturesJSONFromService(d,m):yield r._fetchFeaturesFromService(d,m)}return r.layer.capabilities?.query?.supportsPagination&&(d.num=Math.min(z,2e4)),p?yield r._fetchFeaturesJSONFromService(d,m):yield r._fetchFeaturesFromService(d,m)}catch{return(0,b.Te)(m),y}})()}load(e){var t=this;const r=this.layer.load(e).then(function(){var n=(0,g.A)(function*(i){t.geometryType=i.geometryType,t.objectIdField=i.objectIdField,t.supportsSQLExpression=i.capabilities?.query?.supportsSqlExpression,t._hasLocalSource=!i.url&&!!i.source,t.hasQueryEngine=t._hasLocalSource,t.minScale=i.minScale,t.maxScale=i.maxScale,t.fullExtent=i.fullExtent,t.workerClient=j.getInstance(),yield t.workerClient.open(e.signal)});return function(i){return n.apply(this,arguments)}}());return this.addResolvingPromise(r),Promise.resolve(this)}};(0,L._)([(0,q.MZ)({readOnly:!0})],de.prototype,"adapterName",void 0),(0,L._)([(0,q.MZ)({constructOnly:!0})],de.prototype,"layer",void 0),de=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.FeatureLayerAdapter")],de);const G=de;let Ae=class extends G{constructor(){super(...arguments),this.adapterName="csv-layer-adapter"}_createGenerateRendererResult(e,t,r,n,i){var s=this;return(0,g.A)(function*(){const l=e?.features;if(!l?.length)throw new S.A("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");const u=oe(l);let d=null;if("percent-of-total"===n&&(d=(yield s.workerClient.summaryStatistics({field:t},u)).sum,null==d))throw new S.A("csv-layer-adapter:invalid","invalid normalizationTotal");if("class-breaks-definition"===i?.type){const p=(yield(0,C.Jc)({field:t,normalizationType:n,normalizationField:r,normalizationTotal:d},u)).filter(y=>Number.isFinite(y));return(0,he.t)({definition:i,values:p,normalizationTotal:d})}const c=(yield(0,C.Jc)({field:t},u)).filter(p=>null!=p&&"string"==typeof p&&""!==p.trim());return(0,he._)(c)})()}generateRenderer(e,t){const r=e.classificationDefinition;let n=null,i=null,s=null;"class-breaks-definition"===r?.type?(n=r.classificationField,i=r.normalizationField,s=r.normalizationType):n=r?.attributeField;const l=this.layer;return(0,T.EG)({field:n,normalizationField:i}).then(m=>{const u=l.createQuery();return u.returnGeometry=!1,u.outFields=m,u.where=(0,C.sf)(u.where,e.where),l.queryFeatures(u,{signal:t}).then(d=>this._createGenerateRendererResult(d,n,i,s,r))})}load(e){var t=this;const r=this.layer.load(e).then(function(){var n=(0,g.A)(function*(i){t.geometryType=i.geometryType,t.objectIdField=i.objectIdField,t.supportsSQLExpression=!0,t._hasLocalSource=!1,t.hasQueryEngine=!0,t.workerClient=j.getInstance(),yield t.workerClient.open(e.signal)});return function(i){return n.apply(this,arguments)}}());return this.addResolvingPromise(r),Promise.resolve(this)}};(0,L._)([(0,q.MZ)({readOnly:!0})],Ae.prototype,"adapterName",void 0),Ae=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.CSVLayerAdapter")],Ae);const xr=Ae;let Ve=class extends G{constructor(){super(...arguments),this.adapterName="feature-layer-binning-adapter"}_getNormalizationTotalFromMemory(e,t,r){var n=this;return(0,g.A)(function*(){const{featuresJSON:i,graphics:s,layerView:l,query:m}=t,u={include:["sum"]},d=(!i&&!s&&l&&"queryAggregateSummaryStatistics"in l?yield l.queryAggregateSummaryStatistics(m,{field:e,outStatisticTypes:u},{signal:r}):i?yield n.workerClient.summaryStatistics({field:e},i):yield(0,P.summaryStatistics)({attribute:{field:e,outStatisticTypes:u},features:s})).sum;if(null==d)throw new S.A(`${n.adapterName}:invalid`,"invalid normalizationTotal");return d})()}_processStatsFromMemoryParams(e){var t=this;return(0,g.A)(function*(){const{features:r,filter:n}=e;if(r?.length)return t._getFilteredFeatures(r,n);const{view:i,field:s,field2:l,field3:m,normalizationField:u,valueExpression:d,returnGeometry:c,layerViewFunc:p,signal:y}=e;let h=null,A=null,V=null,z=null,M=null;if(i)try{if(h=yield i.whenLayerView(t.layer),A=null!=p&&p in h&&"function"==typeof h[p],A){yield t._waitForLayerViewUpdate(h);const E=yield(0,T.EG)({field:s,field2:l,field3:m,normalizationField:u,valueExpression:d});yt(t,E).length?A=!1:(V="createAggregateQuery"in h?h.createAggregateQuery():null,V?(V.outFields=E,V.returnGeometry=!1,Z(V,n)):A=!1),h.suspended&&(A=!1)}}catch{A=!1}if(!A&&(M=gt(t.layer).map(E=>E.toJSON()),z=yield t._fetchFeaturesForStats({field:s,field2:l,field3:m,valueExpression:d,normalizationField:u,returnGeometry:c,filter:n,view:i,signal:y},"json"),!z?.length))throw new S.A(`${t.adapterName}:insufficient-data`,"No features are available to calculate statistics");return{layerView:h,query:V,featuresJSON:z,fieldInfos:M}})()}_summaryStatsFromMemory(e,t){var r=this;return(0,g.A)(function*(){const{view:n,field:i,valueExpression:s,normalizationType:l,signal:m}=e,u={field:i,valueExpression:s,normalizationType:l,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes},{featuresJSON:d,graphics:c,layerView:p,query:y,fieldInfos:h}=yield r._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateSummaryStatistics"});return s&&n&&(d||c)&&(u.fieldType=t?.type?Pe.m.toJSON(t.type):null,u.viewInfoParams=U(n),u.timeZone=n.timeZone,u.fieldInfos=h),"percent-of-total"===l&&null==e.normalizationTotal&&(u.normalizationTotal=yield r._getNormalizationTotalFromMemory(i,{featuresJSON:d,graphics:c,layerView:p,query:y},m)),!d&&!c&&p&&"queryAggregateSummaryStatistics"in p?p.queryAggregateSummaryStatistics(y,u,{signal:m}):d?r.workerClient.summaryStatistics(u,d):(0,P.summaryStatistics)({attribute:u,features:c})})()}_uvFromMemory(e,t){var r=this;return(0,g.A)(function*(){const{view:n,field:i,valueExpression:s,returnAllCodedValues:l,signal:m}=e,{featuresJSON:u,graphics:d,layerView:c,query:p,fieldInfos:y}=yield r._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateUniqueValues"}),h={field:i,field2:e.field2,field3:e.field3,fieldDelimiter:T.UH,valueExpression:s,domains:t,returnAllCodedValues:l};return s&&n&&(u||d)&&(h.viewInfoParams=U(n),h.timeZone=n.timeZone,h.fieldInfos=y),!u&&!d&&c&&"queryAggregateUniqueValues"in c?c.queryAggregateUniqueValues(p,h,{signal:m}):u?r.workerClient.uniqueValues(h,u):(0,P.uniqueValues)({attribute:h,features:d})})()}_histogramFromMemory(e){var t=this;return(0,g.A)(function*(){const{view:r,field:n,valueExpression:i,signal:s}=e,{featuresJSON:l,graphics:m,layerView:u,query:d,fieldInfos:c}=yield t._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateHistogram"}),p={field:n,valueExpression:i,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return i&&r&&(l||m)&&(p.viewInfoParams=U(r),p.timeZone=r.timeZone,p.fieldInfos=c),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(p.normalizationTotal=yield t._getNormalizationTotalFromMemory(n,{featuresJSON:l,graphics:m,layerView:u,query:d},s)),!l&&!m&&u&&"queryAggregateHistogram"in u?u.queryAggregateHistogram(d,p,{signal:s}):l?t.workerClient.histogram(p,l):(0,P.histogram)({attribute:p,features:m})})()}_classBreaksFromMemory(e){var t=this;return(0,g.A)(function*(){const{view:r,field:n,valueExpression:i,signal:s}=e,{featuresJSON:l,graphics:m,layerView:u,query:d,fieldInfos:c}=yield t._processStatsFromMemoryParams({...e,layerViewFunc:"queryAggregateClassBreaks"}),p={field:n,valueExpression:i,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return i&&r&&(l||m)&&(p.viewInfoParams=U(r),p.timeZone=r.timeZone,p.fieldInfos=c),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(p.normalizationTotal=yield t._getNormalizationTotalFromMemory(n,{featuresJSON:l,graphics:m,layerView:u,query:d},s)),!l&&!m&&u&&"queryAggregateClassBreaks"in u?u.queryAggregateClassBreaks(d,p,{signal:s}):l?t.workerClient.classBreaks(p,l):(0,P.classBreaks)({attribute:p,features:m})})()}getField(e=""){return gt(this.layer)?.find(r=>r.name.toLowerCase()===e?.toLowerCase())}getFieldUsageInfo(e){return this.getField(e)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!1,supportsStatistics:!0}:null}getFieldDomain(e,t){return null}summaryStatistics(e){var t=this;return(0,g.A)(function*(){const{field:r}=e,n=r?t.getField(r):null;if((0,T.fs)(n)||(0,O.OH)(n)||e.sqlExpression&&!e.valueExpression&&!r)throw new S.A(`${t.adapterName}:not-supported`,"Date field and sqlExpression are not supported");return t._summaryStatsFromMemory(e,n)})()}uniqueValues(e){var t=this;return(0,g.A)(function*(){const r=yield Se(e,t);return t._uvFromMemory(e,r)})()}histogram(e){var t=this;return(0,g.A)(function*(){const{field:r}=e,n=r?t.getField(r):null;if((0,T.fs)(n)||(0,O.OH)(n)||e.sqlExpression&&!e.valueExpression&&!r)throw new S.A(`${t.adapterName}:not-supported`,"Date field and sqlExpression are not supported");return t._histogramFromMemory(e)})()}classBreaks(e){var t=this;return(0,g.A)(function*(){return(!1!==e.analyzeData?t._classBreaksFromMemory(e):t._classBreaksFromInterpolation(e)).catch(()=>((0,b.Te)(e.signal),t._classBreaksFromMemory(e)))})()}queryFeatureCount(e){var t=this;return(0,g.A)(function*(){const r=yield e.view?.whenLayerView(t.layer);if(!r||!("queryAggregateCount"in r)||!r.queryAggregateCount)throw new S.A(`${t.adapterName}:not-supported`,"LayerView is not supported.");yield t._waitForLayerViewUpdate(r);const n=r.createAggregateQuery();return n.where=(0,C.sf)(n.where,e.whereClause),Z(n,e.filter),r.queryAggregateCount(n,{signal:e.signal})})()}generateRenderer(e,t){throw new S.A(`${this.adapterName}:not-supported`,"'generateRenderer' is not supported.")}heatmapStatistics(e){throw new S.A(`${this.adapterName}:not-supported`,"'heatmapStatistics' is not supported.")}predominantCategories(e){var t=this;return(0,g.A)(function*(){const{fields:r,view:n,signal:i}=e,s=ve(r);return je((yield t._uvFromMemory({valueExpression:s,view:n,signal:i})).uniqueValueInfos,r)})()}getSampleFeatures(e,t){var r=this;return(0,g.A)(function*(){const{view:n,sampleSize:i,requiredFields:s,returnGeometry:l,filter:m,signal:u}=e;if(!n)throw new S.A(`${r.adapterName}:not-supported`,"'view' is required to get sample features for binning.");if("3d"===n.type)throw new S.A(`${r.adapterName}:not-supported`,"3d 'view' is not supported to get sample features for binning.");const d=yield n.whenLayerView(r.layer);if(!("queryAggregateJSON"in d&&d.queryAggregateJSON&&"queryAggregates"in d&&d.queryAggregates))throw new S.A(`${r.adapterName}:not-supported`,"LayerView is not supported.");if(yield r._waitForLayerViewUpdate(d),yt(r,s).length)throw new S.A(`${r.adapterName}:insufficient-data`,"Layer does not have required fields");const p="json"===t,y=d.createAggregateQuery();y.outSpatialReference=n?.spatialReference,y.returnGeometry=!!l,y.outFields=s,Z(y,m);const{features:h}=p?yield d.queryAggregateJSON(y,{signal:u}):yield d.queryAggregates(y,{signal:u});return h.length&&null!=i&&i>0&&i<=h.length?(0,H.BB)(h,i,1):h})()}load(e){var t=this;const r=this.layer.load(e).then(function(){var n=(0,g.A)(function*(i){t.geometryType="polygon",t.objectIdField=null,t.supportsSQLExpression=!1,t._hasLocalSource=!1,t.hasQueryEngine=!0,t.minScale=i.minScale,t.maxScale=i.maxScale,t.fullExtent=i.fullExtent;const s="featureReduction"in i?i.featureReduction:null;if("binning"!==s?.type&&"cluster"!==s?.type)throw new S.A(`${t.adapterName}:invalid-parameters`,`Feature reduction type ${s?.type} is not supported`);t.workerClient=j.getInstance(),yield t.workerClient.open(e.signal)});return function(i){return n.apply(this,arguments)}}());return this.addResolvingPromise(r),Promise.resolve(this)}};(0,L._)([(0,q.MZ)({readOnly:!0})],Ve.prototype,"adapterName",void 0),Ve=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.FeatureLayerBinningAdapter")],Ve);const wr=Ve;let me=class extends Be{constructor(e){super(e),this._featureLayerAdapter=null,this.workerClient=null,this.adapterName="scene-layer-adapter"}destroy(){this.workerClient?.destroy()}_hasCachedStatistics(e){return this.layer.hasCachedStatistics(e)}_updateQuery(e,t=[],r=[]){if(!e||!r.length)return e;const n=this.layer.objectIdField,i=e.clone(),s=t.filter(m=>{const u=this.layer.getField(m);return!r.includes(u.name)}),l=s.some(m=>this.layer.getField(m).name===n);return i.outFields=l?s:[...s,n],i}_fetchFeaturesFromMemory(e,t,r){var n=this;return(0,g.A)(function*(){if(!e)throw new S.A("scene-layer-adapter:insufficient-data","view is required to fetch the features from layerView");const i=yield e.whenLayerView(n.layer),s=new AbortController,l=s.signal,m=(0,Ie.C_)(()=>!i.updating,l);yield(0,b.wR)(m,5e3,s);const u=Fe(n,r,i);(0,b.Te)(l);const d=n._updateQuery(t,r??[],u),c=yield i.queryFeatures(d,{signal:l});(0,b.Te)(l);const p=c.features;return u.length?i.whenGraphicAttributes(p,u):p})()}_fetchFeaturesJSONFromMemory(e,t,r){var n=this;return(0,g.A)(function*(){return n._fetchFeaturesFromMemory(e,t,r).then(oe)})()}_fetchFeaturesForStats(e,t){return(0,T.EG)({field:e.field,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then(r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,requiredFields:r,signal:e.signal},t))}_processStatsFromMemoryParams(e){var t=this;return(0,g.A)(function*(){const r=e.features;if(r?.length)return r.length&&"declaredClass"in r[0]&&"esri.Graphic"===r[0].declaredClass?{graphics:r}:{featuresJSON:r};const{view:n,field:i,normalizationField:s,valueExpression:l,signal:m}=e,u=yield t._fetchFeaturesForStats({field:i,valueExpression:l,normalizationField:s,view:n,signal:m},null);if(!u?.length)throw new S.A("scene-layer-adapter:insufficient-data","No features are available to calculate statistics");return{graphics:u}})()}_getCachedStatistics(e,t){const r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.minValue||e.maxValue?Promise.reject(new S.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression', 'sqlWhere', 'minValue' or 'maxValue' is specified")):r.queryCachedStatistics(t?.name,{signal:e.signal}).then(n=>{const i=n.stats,{min:s,max:l,totalValuesCount:m}=i;let{avg:u,stddev:d,sum:c,variance:p,count:y}=i;return 0===s&&0===l||(u=0===u?null:u,c=0===c?null:c,d=0===d?null:d,p=0===p?null:p,y=0===y?null:y),null==y&&(null!=c&&null!=u?y=Math.round(c/u):null!=m&&(y=m)),{avg:u,count:y,max:l,min:s,stddev:d,sum:c,variance:p}})}_getNormalizationTotal(e,t,r){var n=this;return(0,g.A)(function*(){const i={include:["sum"]},s=(t?yield n.workerClient.summaryStatistics({field:e,outStatisticTypes:i},t):yield(0,P.summaryStatistics)({attribute:{field:e,outStatisticTypes:i},features:r})).sum;if(null==s)throw new S.A("scene-layer-adapter:invalid","invalid normalizationTotal");return s})()}_getSummaryStatisticsFromMemory(e,t){var r=this;return(0,g.A)(function*(){const{view:n,field:i,normalizationField:s,valueExpression:l}=e,{featuresJSON:m,graphics:u}=yield r._processStatsFromMemoryParams(e),d={field:i,valueExpression:l,normalizationType:e.normalizationType,normalizationField:s,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,outStatisticTypes:e.outStatisticTypes};return e.valueExpression&&n&&m&&(d.fieldType=t?.type?Pe.m.toJSON(t.type):null,d.viewInfoParams=U(n),d.timeZone=n.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(d.normalizationTotal=yield r._getNormalizationTotal(i,m,u)),m?r.workerClient.summaryStatistics(d,m):(0,P.summaryStatistics)({attribute:d,features:u})})()}_getCachedStatisticsForUniqueValues(e,t){const r=this.layer,n=t?.name,i=t&&e.field?this.getFieldDomain(e.field):null;return e.valueExpression||e.sqlExpression||e.sqlWhere?Promise.reject(new S.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression' or 'sqlWhere' is specified")):r.queryCachedStatistics(n,{signal:e.signal}).then(s=>{const l=s.stats;if(!l.mostFrequentValues)throw new Error;const m=s.labels?.labels,u={},d=[],c="countOF"+n;return l.mostFrequentValues.forEach(y=>{const h=new re.A({attributes:{}});h.attributes[n]=t&&t.name!==r.objectIdField&&((0,O.WA)(t)||(0,T.fs)(t))?Number(y.value):y.value,h.attributes[c]=y.count,d.push(h)}),m&&m.forEach(y=>{u[y.value]=y.label}),Ge(new ne.A({features:d}),{layer:this,field:e.field,labels:u,view:e.view,signal:e.signal})}).then(s=>(0,$.lv)(s,[i],e.returnAllCodedValues))}_getUniqueValuesFromMemory(e,t){var r=this;return(0,g.A)(function*(){const{view:n,field:i,field2:s,field3:l,valueExpression:m,returnAllCodedValues:u}=e,d={field:i,field2:s,field3:l,fieldDelimiter:T.UH,valueExpression:m,domains:t,returnAllCodedValues:u},{featuresJSON:c,graphics:p}=yield r._processStatsFromMemoryParams(e);return e.valueExpression&&n&&c&&(d.viewInfoParams=U(n),d.timeZone=n.timeZone),c?r.workerClient.uniqueValues(d,c):(0,P.uniqueValues)({attribute:d,features:p})})()}_getCachedStatisticsForHistogram(e,t){const r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.normalizationType?Promise.reject(new S.A("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression' or 'sqlExpression' or 'sqlWhere' or 'normalizationType' is specified")):r.queryCachedStatistics(t&&t.name,{signal:e.signal}).then(n=>{const i=n.stats,{minValue:s,maxValue:l}=e,m=s??i.min,u=l??i.max,d=e.numBins||10,c=function Ar(e,t=e.minimum,r=e.maximum,n){const i=[];for(let d=0;d<n;d++)i[d]=0;const s=e.counts.length,l=e.minimum,m=e.maximum;for(let d=0;d<s;d++){const c=(d+.5)/s,p=((1-c)*l+c*m-t)/(r-t)*n;p>=0&&p<=n&&(i[p===n?n-1:Math.floor(p)]+=e.counts[d])}const u=[];return i.forEach((d,c)=>{const p=new re.A({attributes:{}});p.attributes.EXPR_1=c+1,p.attributes.countOFExpr=d,u.push(p)}),new ne.A({features:u})}(i.histogram,m,u,d);return ht(c,m,u,d)})}_getClassBreaksFromMemory(e){var t=this;return(0,g.A)(function*(){const{view:r,field:n,normalizationField:i,valueExpression:s}=e,{featuresJSON:l,graphics:m}=yield t._processStatsFromMemoryParams(e),u={field:n,valueExpression:s,normalizationType:e.normalizationType,normalizationField:i,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return e.valueExpression&&r&&l&&(u.viewInfoParams=U(r),u.timeZone=r.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(u.normalizationTotal=yield t._getNormalizationTotal(n,l,m)),l?t.workerClient.classBreaks(u,l):(0,P.classBreaks)({attribute:u,features:m})})()}_getHistogramFromMemory(e){var t=this;return(0,g.A)(function*(){const{view:r,field:n}=e,{featuresJSON:i,graphics:s}=yield t._processStatsFromMemoryParams(e),l={field:n,valueExpression:e.valueExpression,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return e.valueExpression&&r&&i&&(l.viewInfoParams=U(r),l.timeZone=r.timeZone),"percent-of-total"===e.normalizationType&&null==e.normalizationTotal&&(l.normalizationTotal=yield t._getNormalizationTotal(n,i,s)),i?t.workerClient.histogram(l,i):(0,P.histogram)({attribute:l,features:s})})()}getField(e){return this.layer.getField(e??"")}getFieldUsageInfo(e){const t=this.getField(e);if(!t)return null;const r=this.layer.getFieldUsageInfo(t.name);return{supportsLabelingInfo:r.supportsLabelingInfo,supportsPopupTemplate:r.supportsPopupTemplate,supportsRenderer:r.supportsRenderer,supportsLayerQuery:r.supportsLayerQuery,supportsStatistics:!0}}getFieldDomain(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.getFieldDomain(e,t):null}createQuery(){return this.layer.createQuery()}summaryStatistics(e){const t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.summaryStatistics(e);if(e.filter)throw new S.A("scene-layer-adapter:not-supported","filter is not supported");return this._hasCachedStatistics(t?.name)?this._getCachedStatistics(e,t).catch(()=>((0,b.Te)(e.signal),this._getSummaryStatisticsFromMemory(e,t))):this._getSummaryStatisticsFromMemory(e,t)}uniqueValues(e){var t=this;return(0,g.A)(function*(){if(t._featureLayerAdapter)return t._featureLayerAdapter.uniqueValues(e);if(e.filter)throw new S.A("scene-layer-adapter:not-supported","filter is not supported");const r=yield Se(e,t),{field:n,field2:i}=e,s=n&&i,l=t.getField(n);return!s&&l&&t._hasCachedStatistics(l.name)?t._getCachedStatisticsForUniqueValues(e,l).catch(()=>((0,b.Te)(e.signal),t._getUniqueValuesFromMemory(e,r))):t._getUniqueValuesFromMemory(e,r)})()}histogram(e){const t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.histogram(e);if(e.filter)throw new S.A("scene-layer-adapter:not-supported","filter is not supported");return t&&this._hasCachedStatistics(t.name)?this._getCachedStatisticsForHistogram(e,t).catch(()=>((0,b.Te)(e.signal),this._getHistogramFromMemory(e))):this._getHistogramFromMemory(e)}classBreaks(e){const t=this.getField(e.field);if(this._featureLayerAdapter)return this._featureLayerAdapter.classBreaks(e);if(e.filter)throw new S.A("scene-layer-adapter:not-supported","filter is not supported");return this._hasCachedStatistics(t?.name)?Promise.reject(new S.A("scene-layer-adapter:not-supported","Cached stats not supported")):this._getClassBreaksFromMemory(e)}queryFeatureCount(e){return this._featureLayerAdapter?this._featureLayerAdapter.queryFeatureCount(e):Promise.reject(new S.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support count query"))}generateRenderer(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.generateRenderer(e,t):Promise.reject(new S.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support generateRenderer operation"))}heatmapStatistics(e){return this._featureLayerAdapter?this._featureLayerAdapter.heatmapStatistics(e):Promise.reject(new S.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support heatmapStatistics operation"))}predominantCategories(e){var t=this;return(0,g.A)(function*(){if(t._featureLayerAdapter)return t._featureLayerAdapter.predominantCategories(e);throw new S.A("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support predominantCategories")})()}getSampleFeatures(e,t){var r=this;return(0,g.A)(function*(){if(e.filter)throw new S.A("scene-layer-adapter:not-supported","filter is not supported");const{view:n,sampleSize:i,requiredFields:s,returnGeometry:l,signal:m}=e,d="json"===t,c=r.createQuery();c.outFields=s,c.returnGeometry=!!l,c.where=null,c.num=i;let p=[];try{if(p=d?yield r._fetchFeaturesJSONFromMemory(n,c,s):yield r._fetchFeaturesFromMemory(n,c,s),p.length&&null!=i&&i>0&&i<=p.length)return(0,H.BB)(p,i,1)}catch{(0,b.Te)(m)}let y=null;if(r._featureLayerAdapter){const h={...e};delete h.view,y=yield r._featureLayerAdapter.getSampleFeatures(h,t)}return y?.length?y:(0,H.BB)(p,p.length,1)})()}load(e){var t=this;const r=this.layer.load(e).then(function(){var n=(0,g.A)(function*(i){t.workerClient=j.getInstance(),yield t.workerClient.open(e.signal);const s=i.associatedLayer;if(t.geometryType=i.geometryType,null!=s)return t._featureLayerAdapter=new G({layer:s}),t._featureLayerAdapter.load(e).then(()=>{t.objectIdField=t._featureLayerAdapter.objectIdField,t.supportsSQLExpression=t._featureLayerAdapter.supportsSQLExpression,t.minScale=t._featureLayerAdapter.minScale,t.maxScale=t._featureLayerAdapter.maxScale,t.fullExtent=t._featureLayerAdapter.fullExtent});t.objectIdField=i.objectIdField,t.supportsSQLExpression=!1,t.hasQueryEngine=!1,t.fullExtent=i.fullExtent});return function(i){return n.apply(this,arguments)}}());return this.addResolvingPromise(r),Promise.resolve(this)}};(0,L._)([(0,q.MZ)({readOnly:!0})],me.prototype,"adapterName",void 0),(0,L._)([(0,q.MZ)({constructOnly:!0})],me.prototype,"layer",void 0),me=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.SceneLayerAdapter")],me);const Ct=me;let Le=class extends Ct{constructor(e){super(e),this.adapterName="point-cloud-layer-adapter"}getField(e){return this.layer.fieldsIndex.get(e??"")}getFieldUsageInfo(e){const t=this.getField(e);if(!t)return null;const r=this._hasCachedStatistics(t.name);return{supportsLabelingInfo:r,supportsPopupTemplate:r,supportsRenderer:r,supportsLayerQuery:!1,supportsStatistics:r}}getFieldDomain(){return null}load(e){const t=this.layer.load(e).then(()=>{this.geometryType="point",this.objectIdField=null,this.supportsSQLExpression=!1,this.hasQueryEngine=!1});return this.addResolvingPromise(t),Promise.resolve(this)}};(0,L._)([(0,q.MZ)({readOnly:!0})],Le.prototype,"adapterName",void 0),Le=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.PointCloudLayerAdapter")],Le);const Vr=Le;let Te=class extends Ye{constructor(){super(...arguments),this.adapterName="stream-layer-adapter"}_summaryStatsFromClientQuery(e,t){var r=this;return(0,g.A)(function*(){const{signal:n,view:i}=e,s=ke(r,e,t);s.outStatistics=s.outStatistics?.filter(u=>"totalcount_value"!==u.outStatisticFieldName);const m=Re(yield r._fetchFeatureSetFromMemory(s,i,n),(0,T.fs)(t)||(0,O.OH)(t));return(0,$.oZ)(m,e.outStatisticTypes)})()}};(0,L._)([(0,q.MZ)({readOnly:!0})],Te.prototype,"adapterName",void 0),Te=(0,L._)([(0,D.$)("esri.smartMapping.support.adapters.StreamLayerAdapter")],Te);const Lr=Te;var w,e;(e=w||(w={}))[e.CatalogLayer=0]="CatalogLayer",e[e.CatalogFootprintLayer=1]="CatalogFootprintLayer",e[e.CSVLayer=2]="CSVLayer",e[e.FeatureLayer=3]="FeatureLayer",e[e.GeoJSONLayer=4]="GeoJSONLayer",e[e.KnowledgeGraphSublayer=5]="KnowledgeGraphSublayer",e[e.OGCFeatureLayer=6]="OGCFeatureLayer",e[e.OrientedImageryLayer=7]="OrientedImageryLayer",e[e.ParquetLayer=8]="ParquetLayer",e[e.PointCloudLayer=9]="PointCloudLayer",e[e.SceneLayer=10]="SceneLayer",e[e.StreamLayer=11]="StreamLayer",e[e.SubtypeGroupLayer=12]="SubtypeGroupLayer",e[e.SubtypeSublayer=13]="SubtypeSublayer",e[e.WFSLayer=14]="WFSLayer";const ze={[w.CatalogLayer]:{adapter:G,type:"catalog",label:"CatalogLayer"},[w.CatalogFootprintLayer]:{adapter:G,type:"catalog-footprint",label:"CatalogFootprintLayer"},[w.CSVLayer]:{adapter:xr,type:"csv",label:"CSVLayer"},[w.FeatureLayer]:{adapter:G,type:"feature",label:"FeatureLayer"},[w.GeoJSONLayer]:{adapter:G,type:"geojson",label:"GeoJSONLayer"},[w.KnowledgeGraphSublayer]:{adapter:G,type:"knowledge-graph-sublayer",label:"KnowledgeGraphSublayer"},[w.OGCFeatureLayer]:{adapter:Ye,type:"ogc-feature",label:"OGCFeatureLayer"},[w.OrientedImageryLayer]:{adapter:G,type:"oriented-imagery",label:"OrientedImageryLayer"},[w.ParquetLayer]:{adapter:G,type:"parquet",label:"ParquetLayer"},[w.PointCloudLayer]:{adapter:Vr,type:"point-cloud",label:"PointCloudLayer"},[w.SceneLayer]:{adapter:Ct,type:"scene",label:"SceneLayer"},[w.StreamLayer]:{adapter:Lr,type:"stream",label:"StreamLayer"},[w.SubtypeGroupLayer]:{adapter:G,type:"subtype-group",label:"SubtypeGroupLayer"},[w.SubtypeSublayer]:{adapter:G,type:"subtype-sublayer",label:"SubtypeSublayer"},[w.WFSLayer]:{adapter:G,type:"wfs",label:"WFSLayer"}},et=[w.CatalogLayer,w.CatalogFootprintLayer,w.CSVLayer,w.FeatureLayer,w.GeoJSONLayer,w.KnowledgeGraphSublayer,w.OGCFeatureLayer,w.OrientedImageryLayer,w.ParquetLayer,w.PointCloudLayer,w.SceneLayer,w.StreamLayer,w.SubtypeGroupLayer,w.SubtypeSublayer,w.WFSLayer],Tr=[w.CSVLayer,w.FeatureLayer,w.GeoJSONLayer,w.OGCFeatureLayer,w.KnowledgeGraphSublayer,w.OrientedImageryLayer,w.ParquetLayer,w.StreamLayer,w.WFSLayer];function tt(){return tt=(0,g.A)(function*(e){if(!e?.layer||!e.field&&!e.valueExpression)throw new S.A("unique-values:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");const t=e.valueExpression||e.sqlExpression;if(t)if(t&&!e.sqlExpression){if(!e.view)throw new S.A("unique-values:missing-parameters","View is required when 'valueExpression' is specified")}else if(!e.valueExpression)throw new S.A("unique-values:missing-parameters","'valueExpression' parameters are required");e.forBinning&&function fe(e,t){if(!e.view)throw new S.A(`${t}:missing-parameters`,"'view' parameter is required for binning");if(e.sqlExpression)throw new S.A(`${t}:invalid-parameters`,"'sqlExpression' parameter is not supported for binning");if("3d"===e.view.type)throw new S.A(`${t}:invalid-parameters`,"3d view is not supported for binning")}(e,"unique-values");const{layer:n,...i}=e,s=e.forBinning?Tr:et,l=function Er(e,t=et,r){if(e instanceof Be)return e;const n=function Cr(e,t=et){let r=null;return t.some(n=>{const i=e.type===ze[n].type;return i&&(r=ze[n].adapter),i}),r}(e,t);return n?r?new wr({layer:e}):new n({layer:e}):null}(n,s,e.forBinning);if(!l)throw new S.A("unique-values:invalid-parameters","'layer' must be one of these types: "+function zr(e){return e.map(t=>ze[t].label)}(s).join(", "));const m={layerAdapter:l,...i},u=null!=m.signal?{signal:m.signal}:null;yield l.load(u);const d=yield(0,T.EG)({field:m.field,field2:m.field2,field3:m.field3,valueExpression:m.valueExpression}),c=(0,C.MH)(l,d,"unique-values:invalid-parameters");if(c)throw c;m.filter&&!m.filter.spatialRelationship&&(m.filter.spatialRelationship="intersects");const p=(0,C.Wk)(m.filter,"summary-statistics:invalid-parameters");if(p)throw p;return m}),tt.apply(this,arguments)}function _r(e){return rt.apply(this,arguments)}function rt(){return rt=(0,g.A)(function*(e){const{layerAdapter:t,...r}=yield function qr(e){return tt.apply(this,arguments)}(e);return t.uniqueValues(r)}),rt.apply(this,arguments)}}}]);