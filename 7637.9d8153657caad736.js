"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[7637],{52593:(ce,Q,f)=>{f.d(Q,{A:()=>U});var x,M=f(8189),j=f(71065),O=f(77806),F=f(85211),C=f(55739),I=f(76576);let b=x=class extends j.A{constructor(z){super(z),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new x({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,O.o8)(this.values),isSlice:this.isSlice})}};(0,M._)([(0,F.MZ)({type:String,json:{write:!0}})],b.prototype,"variableName",void 0),(0,M._)([(0,F.MZ)({type:String,json:{write:!0}})],b.prototype,"dimensionName",void 0),(0,M._)([(0,F.MZ)({type:C.gK.array(C.gK.oneOf([C.gK.native(Number),C.gK.array(C.gK.native(Number))])),json:{write:!0}})],b.prototype,"values",void 0),(0,M._)([(0,F.MZ)({type:Boolean,json:{write:!0}})],b.prototype,"isSlice",void 0),b=x=(0,M._)([(0,I.$)("esri.layers.support.DimensionalDefinition")],b);const U=b},62619:(ce,Q,f)=>{f.d(Q,{jX:()=>z,zo:()=>H,gd:()=>G,ph:()=>I,no:()=>V,kz:()=>x,ht:()=>b,yo:()=>re});var M=f(1749),O=f(40018);const F=new Map,C=new class j{constructor(E=15e3,T=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=E,this._interval=Math.min(E,T)}decreaseRefCount(E,T){const o=E+"/"+T,m=this._cachedBlocks;if(m.has(o)){const d=m.get(o);return d.refCount--,d.refCount<=0&&(m.delete(o),d.controller&&d.controller.abort()),d.refCount}return 0}getBlock(E,T){const o=E+"/"+T,m=this._cachedBlocks;if(m.has(o)){const d=m.get(o);return d.ts=Date.now(),d.refCount++,m.delete(o),m.set(o,d),d.block}return null}putBlock(E,T,o,m){const d=this._cachedBlocks,D=E+"/"+T;if(d.has(D)){const S=d.get(D);S.ts=Date.now(),S.refCount++}else d.set(D,{block:o,ts:Date.now(),refCount:1,controller:m});this._trim(),this._updateTimer()}deleteBlock(E,T){const o=this._cachedBlocks,m=E+"/"+T;o.has(m)&&o.delete(m)}updateMaxSize(E){this._size=E,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const E=this._cachedBlocks;this._timer=setInterval(()=>{const T=Array.from(E),o=Date.now();for(let m=0;m<T.length&&T[m][1].ts<=o-this._duration;m++)E.delete(T[m][0]);0===E.size&&this._clearTimer()},this._interval)}_trim(){const E=this._cachedBlocks;if(-1===this._size||this._size>=E.size)return;const T=Array.from(E);for(let o=0;o<T.length-this._size;o++)E.delete(T[o][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function I(B,E){return null==E?B:`${B}?sliceId=${E}`}function x(B,E){const T={extent:null,rasterInfo:E,cache:new Map},o=F.get(B);return o?(o.push(T),o.length-1):(F.set(B,[T]),0)}function b(B,E){const T=F.get(B);T&&(T[E]=null,T.some(o=>null!=o)||F.delete(B))}function z(B,E,T){const o=F.get(B);if(!o)return null==E?C.decreaseRefCount(B,T):0;if(null==E||null==o[E])return C.decreaseRefCount(B,T);const m=o[E]?.cache,d=m?.get(T);if(m&&d){if(d.refCount--,0===d.refCount){m.delete(T);for(let D=0;D<o.length;D++)o[D]?.cache.delete(T);d.controller&&d.controller.abort()}return d.refCount}return 0}function G(B,E,T){const o=F.get(B);if(!o)return null==E?C.getBlock(B,T):null;if(null==E||null==o[E]){for(let d=0;d<o.length;d++){const D=o[d]?.cache.get(T);if(D)return D.refCount++,D.block}return C.getBlock(B,T)}const m=o[E]?.cache.get(T);if(m)return m.refCount++,m.block;for(let d=0;d<o.length;d++){if(d===E||!o[d])continue;const D=o[d]?.cache,S=D?.get(T);if(D&&S)return S.refCount++,D.set(T,S),S.block}return null}function V(B,E,T,o,m=null){const d=F.get(B);if(!d)return void(null==E&&C.putBlock(B,T,o,m));if(null==E||null==d[E])return void C.putBlock(B,T,o,m);const D={refCount:1,block:o,isResolved:!1,isRejected:!1,controller:m};o.then(()=>D.isResolved=!0).catch(()=>D.isRejected=!0),d[E]?.cache.set(T,D)}function H(B,E,T){const o=F.get(B);o?null!=E&&null!=o[E]?o[E]?.cache.delete(T):C.deleteBlock(B,T):null==E&&C.deleteBlock(B,T)}function re(B,E,T,o,m,d,D=null){const S=function le(B,E){const T=F.get(B);return T?T[E]??null:null}(B,E);if(!S)return;const l=S.extent,{cache:c,rasterInfo:u}=S;if(l&&l.xmin===T.xmin&&l.xmax===T.xmax&&l.ymin===T.ymin&&l.ymax===T.ymax)return;o=o??0;const g=T.clone().normalize(),{spatialReference:p,transform:_}=u,v=new Set;for(let P=0;P<g.length;P++){const A=g[P];if(A.xmax-A.xmin<=o||A.ymax-A.ymin<=o)continue;let w=(0,O._l)(A,p,D);null!=_&&(w=_.inverseTransform(w));const L=new M.A({x:o,y:o,spatialReference:A.spatialReference});if(null==m&&!(m=(0,O.Wo)(L,p,A,D)))return;const{pyramidLevel:se,pyramidResolution:X,excessiveReading:Y}=(0,O.t$)(m,u,d||"closest");if(Y)return;const{storageInfo:Z}=u,{origin:$}=Z,{x:ie,y:ae}=X,de=Math.max(0,Math.floor((w.xmin-$.x)/ie)),pe=Math.max(0,Math.floor(($.y-w.ymax)/ae)),ee=Math.ceil(w.width/ie-.1),fe=Math.ceil(w.height/ae-.1),J=se>0?Z.pyramidBlockWidth:Z.blockWidth,_e=se>0?Z.pyramidBlockHeight:Z.blockHeight,he=Z.blockBoundary[se];if(!he)continue;const me=1,ye=Math.max(he.minCol,Math.floor(de/J)-me),be=Math.max(he.minRow,Math.floor(pe/_e)-me),Re=Math.min(he.maxCol,Math.floor((de+ee-1)/J)+me),Ce=Math.min(he.maxRow,Math.floor((pe+fe-1)/_e)+me);for(let ge=be;ge<=Ce;ge++)for(let Te=ye;Te<=Re;Te++)v.add(`${se}/${ge}/${Te}`)}c.forEach((P,A)=>{if(!v.has(A)){const w=c.get(A);(null==w||w.isResolved||w.isRejected)&&c.delete(A)}}),S.extent={xmin:T.xmin,ymin:T.ymin,xmax:T.xmax,ymax:T.ymax}}},20053:(ce,Q,f)=>{f.d(Q,{$E:()=>S,DY:()=>B,NG:()=>D,QW:()=>F,Rp:()=>G,XU:()=>H,Xg:()=>m,ct:()=>le,fy:()=>re,sx:()=>z,xx:()=>C,z2:()=>E});var M=f(89952),j=f(52593);function O(l,c,u){const g=c.shift();0===u.length&&u.push({sliceId:-1,multidimensionalDefinition:[]});const p=u.length;for(let _=0;_<p;_++){const v=u.shift().multidimensionalDefinition;g.values?.forEach(P=>{u.push({sliceId:-1,multidimensionalDefinition:[...v,{variableName:l,dimensionName:g.name,values:[P]}]})})}c.length&&O(l,c,u)}function F(l,c){const u=[];let g=0;return(c?l.variables.filter(p=>p.name.toLowerCase()===c.toLowerCase()):[...l.variables].sort((p,_)=>p.name>_.name?1:-1)).forEach(p=>{const _=[],v=[...p.dimensions].sort((P,A)=>P.name>A.name?-1:1);O(p.name,v,_),_.forEach(P=>{u.push({...P,sliceId:g++})})}),u}function C(l,c,u){let g=l;if(c&&(c=[...c].sort((p,_)=>p.dimensionName<_.dimensionName?-1:1)).forEach(({dimensionName:p,values:_,isSlice:v})=>{_.length&&(g=g.filter(P=>{const A=P.multidimensionalDefinition.find(L=>L.dimensionName===p);if(null==A)return!1;const w=A.values[0];return"number"==typeof w?"number"==typeof _[0]?_.includes(w):_.some(L=>L[0]<=w&&L[1]>=w):_.some("number"==typeof _[0]?L=>w[0]<=L&&w[1]>=L:v?L=>L[0]===w[0]&&L[0]===w[1]:L=>L[0]>=w[0]&&L[0]<=w[1]||L[1]>=w[0]&&L[1]<=w[1]||L[0]<w[0]&&L[1]>w[1])}))}),g.length&&null!=u?.start&&null!=u.end){const p=u.start.getTime(),_=u.end.getTime(),v=g[0].multidimensionalDefinition.findIndex(P=>"StdTime"===P.dimensionName);v>-1&&(g=g.filter(P=>{const A=P.multidimensionalDefinition[v].values[0];return p<=A&&_>=A}))}return g.map(p=>p.sliceId)}function I(l,c){return Array.isArray(l)?c[0]===c[1]?l[0]===c[0]||l[1]===c[0]:l[0]>=c[0]&&l[0]<=c[1]&&l[1]>=c[0]&&l[1]<=c[1]:l>=c[0]&&l<=c[1]}function x(l,c){return l[0]<=c[0]&&l[1]>=c[0]||l[0]<=c[1]&&l[1]>=c[1]||l[0]>=c[0]&&l[1]<=c[1]}function b(l){return 1===l.length?[l[0],l[0]]:[l[0],l[l.length-1]]}function U(l,c,u){if(!c?.subsetDefinitions?.length)return l;let g;if(u){const{variables:v}=c;if(v.length&&!v.includes(u))return null;const P=c.subsetDefinitions.find(A=>A.dimensionName===l.name&&A.variableName===u);if(!P?.values?.length)return l;g=b(P.values)}else g=c.dimensions.find(({name:P})=>P===l.name)?.extent;const p=g;if(!p?.length)return l;const _=l.values.filter(v=>I(v,p));return{...l,extent:[...p],values:_}}function z(l,c,u){if(!c?.subsetDefinitions?.length)return!1;const{variables:g}=c;if(g.length&&l.some(({variableName:p})=>p&&!g.includes(p)))return!0;for(let p=0;p<l.length;p++){const _=l[p],v=c.subsetDefinitions.find(P=>(""===_.variableName||P.variableName===_.variableName)&&P.dimensionName===_.dimensionName);if(v?.values.length){const P=b(v.values);if(_.isSlice||2!==_.values.length||Array.isArray(_.values[0])||_.values[0]===_.values[1]||!u){if(_.values.some(A=>!I(A,P)))return!0}else if(!x(_.values,P))return!0}}return!1}function G(l,c){if(null==l)return{isOutside:!1};const{geometry:u,timeExtent:g,multidimensionalDefinition:p}=c;let _=null;if(null!=g&&(_=function V(l,c){const u=l.dimensions.find(({name:v})=>"StdTime"===v);if(null==u||null==c.start&&null==c.end)return c;c=c.clone();const{start:g,end:p}=c.toJSON(),_=g===p?[g]:null!=g&&null!=p?[g,p]:[g??p];return 2===_.length&&u?.extent.length&&(_[0]=Math.max(_[0],u.extent[0]),_[1]=Math.min(_[1],u.extent[1]??u.extent[0]),_[1]<_[0])||z([new j.A({variableName:"",dimensionName:"StdTime",isSlice:1===_.length,values:_})],l,!0)?null:(c.start=new Date(_[0]),c.end=new Date(_[1]??_[0]),c)}(l,g),null==_))return{isOutside:!0};const{areaOfInterest:v}=l;if(v&&u){const P="point"===u.type?u:"extent"===u.type?u.center:"polygon"===u.type?u.centroid:null;if(P&&!v.contains(P))return{isOutside:!0}}return null!=p&&p.length&&z(p,l,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:u,timeExtent:_,multidimensionalDefinition:p}}}function H(l){const{rasterInfo:c,multidimensionalSubset:u}=l,{multidimensionalInfo:g}=c;if(null==g)return null;let p=l.multidimensionalDefinition?.length?l.multidimensionalDefinition:re(c,{multidimensionalSubset:u});if(!p?.length)return null;if(p.some(v=>!v.dimensionName)){const{variableName:v}=p[0],P=re(c,{multidimensionalSubset:u,variableName:v});P?.forEach(A=>{const w=p?.find(({dimensionName:L})=>L===A.dimensionName);w?.values?.length&&(A.values=w.values,A.isSlice=w.isSlice)}),p=P}const{timeExtent:_}=l;if(null!=p&&null!=_&&(null!=_.start||null!=_.end)){p=p.map(Z=>Z.clone());const v=g.variables.find(({name:Z})=>Z===p[0].variableName)?.dimensions?.find(({name:Z})=>"StdTime"===Z),P=p.find(({dimensionName:Z})=>"StdTime"===Z);if(!v||!P)return null;const{start:A,end:w}=_,L=null==A?null:A.getTime(),se=null==w?null:w.getTime(),X=L??se,Y=se??L;if(null!=v.values){const Z=v.values.filter($=>Array.isArray($)?X===Y?$[0]<=X&&$[1]>=X:$[0]<=X&&$[1]>X||$[0]<Y&&$[1]>=Y||$[0]>=X&&$[1]<=Y||$[0]<X&&$[1]>Y:X===Y?$===X:$>=X&&$<=Y);if(Z.length){const $=Z.sort((ie,ae)=>{const de=Array.isArray(ie)?ie[0]:ie,pe=Array.isArray(ie)?ie[1]:ie,ee=Array.isArray(ae)?ae[0]:ae,fe=Array.isArray(ae)?ae[1]:ae;return X===Y?de-ee:Math.abs(pe-Y)-Math.abs(fe-Y)})[0];P.values=[$]}else p=null}else if(v.hasRegularIntervals&&v.extent){const[Z,$]=v.extent;X>$||Y<Z?p=null:P.values=X===Y?[X]:[Math.max(Z,X),Math.min($,Y)]}}return null!=p&&z(p,u)?null:p}function le(l,c={}){const{multidimensionalInfo:u,keyProperties:g}=l;if(null==u)return null;const{variableName:p,multidimensionalSubset:_,multidimensionalDefinition:v}=c,A=p||(null!=v?v[0]?.variableName:null)||g?.DefaultVariable;let{variables:w}=u;return _?.variables?.length&&(w=w.filter(({name:L})=>_.variables.includes(L))),A?w.find(({name:L})=>L===A)??w[0]:w[0]}function re(l,c={}){const u=le(l,c);if(!u)return null;const g=[],{dimensions:p,name:_}=u;if(0===p.length)return[new j.A({variableName:_,dimensionName:"",values:[],isSlice:!0})];for(let v=0;v<p.length;v++){const P=U(p[v],c.multidimensionalSubset,_);if(!P)return null;const{values:A,extent:w}=P;let L=A?.[0]??w?.[0];"stdz"===P.name.toLowerCase()&&!P.hasRanges&&w&&Math.abs(w[1])<=Math.abs(w[0])&&(L=A?.length?A[A.length-1]:w[1]),g.push(new j.A({variableName:_,dimensionName:P.name,values:[L],isSlice:!c.useRangeForRangedDimensionInfo||!!P.hasRanges}))}return g}function B(l){return!!l?.length&&l.some(c=>{if(null==c.values)return!0;const u=c.values.length;return 0===u||u>1||!c.isSlice&&Array.isArray(c.values[0])})}function E(l,c){if(null==c||null==l)return null;let u=c.variables.map(g=>({...g}));return l?.variables?.length&&(u=u.filter(({name:g})=>l.variables.includes(g)),u.forEach(g=>{g.dimensions=g.dimensions.map(p=>U(p,l,g.name)).filter(M.Ru)})),u}function T(l,c){const{values:u}=c;if(u?.length){const P=Array.isArray(u[0]),A=Array.isArray(l);return P!==A?-1:P&&A?u.findIndex(w=>w[0]===l[0]&&w[1]===l[1]):u.indexOf(l)}const{extent:g}=c;if(Array.isArray(l)||!g||l<g[0]||l>g[1])return-1;const p=c.interval||1;if("ISO8601"!==c.unit)return Math.round((l-g[0])/p);const _=g[0];let v=-1;switch(c.intervalUnit?.toLowerCase()||"days"){case"seconds":v=Math.round((l-_)/1e3/p);break;case"minutes":v=Math.round((l-_)/6e4/p);break;case"hours":v=Math.round((l-_)/36e5/p);break;case"days":v=Math.round((l-_)/864e5/p);break;case"months":{const P=new Date(l).getUTCFullYear()-new Date(_).getUTCFullYear(),A=new Date(_).getUTCMonth(),w=new Date(l).getUTCMonth();v=0===P?w-A:w+11-A+12*(P-1)}break;case"years":v=Math.round((new Date(l).getUTCFullYear()-new Date(_).getUTCFullYear())/p);break;case"decades":v=Math.round((new Date(l).getUTCFullYear()-new Date(_).getUTCFullYear())/10/p)}return v}function o(l){let c=l.values?.length;if(c)return c;const{extent:u,unit:g}=l,p=l.interval||1,_=u?u[1]-u[0]:0;if("ISO8601"!==g)return Math.round(_/p);switch(l.intervalUnit?.toLowerCase()??"seconds"){case"seconds":c=Math.round(_/1e3/p);break;case"minutes":c=Math.round(_/6e4/p);break;case"hours":c=Math.round(_/36e5/p);break;case"days":c=Math.round(_/864e5/p);break;case"months":if(u){const v=new Date(u[1]).getUTCFullYear()-new Date(u[0]).getUTCFullYear(),P=new Date(u[0]).getUTCMonth(),A=new Date(u[1]).getUTCMonth();c=0===v?A-P+1:A+11-P+12*(v-1)+1}else c=0;break;case"years":c=u?Math.round((new Date(u[1]).getUTCFullYear()-new Date(u[0]).getUTCFullYear())/p):0;break;case"decades":c=u?Math.round((new Date(u[1]).getUTCFullYear()-new Date(u[0]).getUTCFullYear())/10/p):0;break;default:c=0}return c}function m(l){if(2!==l.extent?.length||!l.interval)return[];const{extent:[c,u],interval:g}=l;if("ISO8601"===l.unit){const _=l.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(_)?function d(l,c,u,g){const p=[];let _=l;const v=new Date(l);for(;_<=c;)switch(p.push(_),g){case"decades":v.setUTCFullYear(v.getUTCFullYear()+10*u),_=v.getTime();break;case"years":v.setUTCFullYear(v.getUTCFullYear()+u),_=v.getTime();break;case"months":v.setUTCMonth(v.getUTCMonth()+u),_=v.getTime();break;case"days":_+=864e5*u;break;case"hours":_+=36e5*u;break;case"minutes":_+=6e4*u;break;case"seconds":_+=1e3*u}return 1===p.length?p[1]=c:p[p.length-1]=c,p}(c,u,g,_):[]}const p=Math.round((u-c)/g);return Array.from({length:p},(_,v)=>v===p-1?u:c+v*g)}function D(l,c){let u=0;const g=l[0].variableName,p=[...c.variables].sort((_,v)=>_.name>v.name?1:-1);for(let _=0;_<p.length;_++){const v=p[_],P=[...v.dimensions].sort((L,se)=>L.name>se.name?-1:1);if(v.name!==g){u+=P.map(L=>o(L)).reduce((L,se)=>L*se);continue}const A=P.map(L=>o(L)),w=P.length;for(let L=0;L<w;L++){const se=l.find(Y=>Y.dimensionName===P[L].name);if(null==se)return null;const X=T(se.values[0],P[L]);if(-1===X)return null;A.shift(),u+=L===w-1?X:X*A.reduce((Y,Z)=>Y*Z)}break}return u}function S(l){return Math.round(24*(l-25569)*3600*1e3)}},95373:(ce,Q,f)=>{f.d(Q,{AL:()=>E,DV:()=>le,ER:()=>j,F_:()=>C,Nd:()=>V,Oo:()=>O,dy:()=>G,eS:()=>d,h4:()=>D,jC:()=>B,nq:()=>H,rZ:()=>z,y6:()=>re});var M=f(29141);const j="Raster.",O="Raster.Dim.",F=".Max",C={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},I=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function x(S,l){return new M.A({name:S,alias:l,domain:null,editable:!1,length:50,type:"string"})}function b(S,l){return new M.A({name:S,alias:l,domain:null,editable:!1,type:"double"})}function z(S){return x(C.servicePixelValue,S??"Service Pixel Value")}function G(S){return x(C.rawServicePixelValue,S??"Raw Service Pixel Value")}function V(){return x(C.itemPixelValue,"Item Pixel Value")}function H(S){return x(`${C.servicePixelValue}.${S}`,S)}function le(S){return b(`${C.magnitude}`,"Magnitude"+(S?` (${S})`:""))}function re(){return b(`${C.direction}`,"Direction (\xb0)")}function B(S){return S.fields.filter(l=>"oid"!==l.type&&"value"!==l.name.toLowerCase()).map(l=>{const c=l.clone();return c.name=`${j}${l.name}`,c})}function E(S){const l=new Set,c=new Set,u=new Map;return S.variables.forEach(({dimensions:g})=>{g.forEach(p=>{if(p.recurring)u.set(p.name,p.unit);else{const _="ISO8601"===p.unit?.trim()?l:c;_.add(p.name),p.hasRanges&&_.add(`${p.name}${F}`)}})}),[x(C.variable,"Variable"),...[...l].map(g=>function U(S,l){return new M.A({name:S,alias:l,domain:null,editable:!1,type:"date"})}(`${O}${g}`,o(g))),...[...c].map(g=>b(`${O}${g}`,o(g))),...[...u].map(([g,p])=>b(`${O}${g}`,function T(S,l){return l=l?.toLowerCase(),l&&I.has(l)?I.get(l):o(S)}(g,p)))]}function o(S){const l=S.endsWith(F),c=l?S.slice(0,-4):S,u="StdTime"===c?"Standard Time":"StdZ"===c?"Standard Z":c;return l?`${u} Max`:u}function m(S,l){return l?new Date(S):S}function d(S,l,c){c?.length&&(l[C.variable]=c[0].variableName,c.forEach(({dimensionName:u,values:g})=>{if(u&&g?.length){const p=`${O}${u}`,_=S.find(({name:A})=>A===p);if(!_)return;const v="date"===_.type,P=g[0];if(Array.isArray(P)){if(l[`${O}${u}`]=m(P[0],v),null!=P[1]){const A=`${O}${u}${F}`;if(S.some(({name:w})=>w===A)){const w=m(P[1],v);l[A]=w}}}else l[`${O}${u}`]=m(P,v)}}))}function D(S,l){if(l.pixelType.startsWith("f")&&S.forEach(({format:c,fieldName:u})=>{c&&u&&/^raster\.(item|service)pixelvalue/i.test(u)&&(c.places=2)}),l.multidimensionalInfo){const c=l.multidimensionalInfo.variables.flatMap(({dimensions:u})=>u);S.forEach(({format:u,fieldName:g})=>{if(u&&g?.startsWith(O)){const p=g.slice(O.length),_=`${p}${F}`;c.find(({name:P})=>P===p||P===_)?.values?.every(P=>Number.isInteger(P))&&(u.places=0)}})}}},65374:(ce,Q,f)=>{var M,j,O,F,C,I,x,b,U,z,G,V,H,le,re,B,E,T,o,m,d,D,S,l,c,u,g,p,_,v,P,A,w,L,se,X,Y,Z,$,ie,ae,de,pe,ee,fe,J,_e,he,me,ye,be,Re,Ce,ge,Te,Ae,Be,Ue,De,Le,Ie,Ne,ze,t;f.d(Q,{$2:()=>C,C1:()=>O,Hz:()=>V,JO:()=>j,M1:()=>S,O$:()=>De,OW:()=>Ae,Q1:()=>he,TZ:()=>E,WE:()=>_,Y:()=>x,YI:()=>ye,bj:()=>b,e_:()=>_e,f0:()=>Ue,fu:()=>G,g7:()=>U,ip:()=>me,mU:()=>v,oF:()=>d,uQ:()=>D,uT:()=>Z,vG:()=>Ie,wd:()=>de,xR:()=>M,xn:()=>T,xw:()=>u,yS:()=>$}),(t=M||(M={}))[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN",function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(j||(j={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(O||(O={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(F||(F={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(C||(C={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(I||(I={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(x||(x={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(b||(b={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(U||(U={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(z||(z={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(G||(G={})),function(t){t.Linear="Linear",t.EaseIn="EaseIn",t.EaseOut="EaseOut",t.EaseInOut="EaseInOut"}(V||(V={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(H||(H={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(le||(le={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(re||(re={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(B||(B={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(E||(E={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(T||(T={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(o||(o={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(m||(m={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(d||(d={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",t.ConcentricCircles="ConcentricCircles",t.DoubleJogArrow="DoubleJogArrow",t.LinkedChevrons="LinkedChevrons",t.SegmentThenHalfCircle="SegmentThenHalfCircle",t.LineWithStraightTicks="LineWithStraightTicks",t.DoubleCurve="DoubleCurve",t.ParallelWithTicksByWidth="ParallelWithTicksByWidth",t.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(D||(D={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(S||(S={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(l||(l={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(c||(c={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(u||(u={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(g||(g={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(p||(p={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(_||(_={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(v||(v={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(P||(P={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(A||(A={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(w||(w={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AlongLine=1]="AlongLine"}(L||(L={})),function(t){t[t.Auto=0]="Auto",t[t.Clockwise=1]="Clockwise",t[t.Counterclockwise=2]="Counterclockwise"}(se||(se={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(X||(X={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(Y||(Y={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Z||(Z={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}($||($={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(ie||(ie={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(ae||(ae={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(de||(de={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(pe||(pe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(ee||(ee={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(fe||(fe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(J||(J={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(_e||(_e={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(he||(he={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(me||(me={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(ye||(ye={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(be||(be={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Re||(Re={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Ce||(Ce={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(ge||(ge={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Te||(Te={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Ae||(Ae={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Be||(Be={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Ue||(Ue={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(De||(De={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Le||(Le={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Ie||(Ie={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Ne||(Ne={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(ze||(ze={}))},37188:(ce,Q,f)=>{f.d(Q,{A:()=>x});var M=f(3248),j=f(69473),O=f(54382),F=f(89298),C=f(99065);const I=(b,U)=>b.key.level-U.key.level!=0?b.key.level-U.key.level:b.key.row-U.key.row!=0?b.key.row-U.key.row:b.key.col-U.key.col;class x extends O.A{constructor(U){super(),this.tileInfoView=U,this.sortFunction=I}renderChildren(U){this.setStencilReference(U),super.renderChildren(U)}createRenderParams(U){const{state:z}=U,G=super.createRenderParams(U);return G.requiredLevel=this.tileInfoView.getClosestInfoForScale(z.scale).level,G.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(z.scale),G}prepareRenderPasses(U){const z=super.prepareRenderPasses(U);return z.push(U.registerRenderPass({name:"stencil",brushes:[F.A],drawPhase:j.S5.DEBUG|j.S5.MAP|j.S5.HIGHLIGHT|j.S5.LABEL,target:()=>this.getStencilTarget()})),(0,M.A)("esri-tiles-debug")&&z.push(U.registerRenderPass({name:"tileInfo",brushes:[C.A],drawPhase:j.S5.DEBUG,target:()=>this.children})),z}getStencilTarget(){return this.children}setStencilReference(U){let z=1;for(const G of this.children)G.stencilRef=z++}}},91837:(ce,Q,f)=>{f.d(Q,{A:()=>I});var M=f(1416),j=f(32788),O=f(50915),F=f(45513),C=f(30454);class I{constructor(b,U){this._rctx=b,this._attributes=[{name:"position",offset:0,type:O.pe.SHORT,count:2}],this.layout={hash:(0,M.hU)(this._attributes),attributes:this._attributes,stride:4},this._vertexBuffer=j.g.createVertex(b,O._U.STATIC_DRAW,new Uint16Array(U)),this._vao=new F.Z(b,new Map([["a_position",0]]),new Map([["geometry",[new C._("a_position",2,O.pe.SHORT,0,4)]]]),new Map([["geometry",this._vertexBuffer]])),this._count=U.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao),this._rctx.drawArrays(O.WR.TRIANGLE_STRIP,0,this._count)}}},1416:(ce,Q,f)=>{f.d(Q,{Ph:()=>O,Z0:()=>C,hU:()=>j});var M=f(1119);function j(I){const x=I.map(({name:b,count:U,type:z})=>`${b}.${U}.${z}`).join(",");return(0,M.Wm)(x)}function O(I,x,b,U,z,G,V){if(I.primitiveName===x){let H=U?.readWithDefault(z,G,I[b]&&V);return"text"===I.type&&(H=H.toString()),void(I[b]=H)}if("type"in I&&null!=I.type){if(I.effects)for(const H of I.effects)O(H,x,b,U,z,G,V);switch(I.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(I.symbolLayers)for(const H of I.symbolLayers)O(H,x,b,U,z,G,V);break;case"CIMTextSymbol":I.symbol&&O(I.symbol,x,b,U,z,G,V);break;case"CIMHatchFill":I.lineSymbol&&O(I.lineSymbol,x,b,U,z,G,V);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(I.markerPlacement&&O(I.markerPlacement,x,b,U,z,G,V),"CIMVectorMarker"===I.type&&I.markerGraphics)for(const H of I.markerGraphics)O(H,x,b,U,z,G,V),O(H.symbol,x,b,U,z,G,V)}}}const F=400;function C(I){return null!=I.effects?F:Math.max(1.25*I.width,8)}},98108:(ce,Q,f)=>{f.r(Q),f.d(Q,{default:()=>Lr});var M=f(8189),j=f(35150),O=f(56492),F=f(48900),C=f(85211),b=(f(3248),f(40707),f(76576)),U=f(20053),z=f(89063),G=f(88219),V=f(10467),H=f(51995),le=f(6126),re=f(11432),B=f(31610),E=f(12273),T=f(88532),o=f(63888),m=f(50915),d=f(31071);const D={bandCount:3,minOutput:0,maxOutput:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class S extends o.q{constructor(e=null,r=null,i=null){super(),this._textureInvalidated=!0,this._colormapTextureInvalidated=!0,this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,this._colormapTexture=null,this._colormap=null,this._supportsBilinearTexture=!0,this._processedTexture=null,this.functionTextures=[],this.projected=!1,this.stencilRef=0,this.coordScale=[1,1],this._processed=!1,this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.source=e,this.transformGrid=r,this.interpolation=i}destroy(){this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}get rasterTexture(){return this._rasterTexture}set rasterTexture(e){this._rasterTexture!==e&&(this._rasterTexture?.dispose(),this._rasterTexture=e),null==e&&(this.projected=!1)}get processed(){return this._processed}set processed(e){this._processed=e,e||((0,re.WD)(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||D}set symbolizerParameters(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}get source(){return this._source}set source(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this.commonUniforms=null,this.projected=!1,this.invalidateTexture())}get suspended(){return this._suspended}set suspended(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}get bandIds(){return this._bandIds}set bandIds(e){this._bandIds=e,this._isBandIdsChanged(e)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?m.Cj.LINEAR:m.Cj.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid!==e&&(this._transformGrid=e,this._transformGridTexture=(0,re.WD)(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(e=!1){const r=e||this.projected;return[r?this.width:this.source?.width||this.width,r?this.height:this.source?.height||this.height]}getRasterCellSize(){const e=this.rawPixelData?.srcPixelSize,{projected:r,resolution:i}=this;return e&&!r?[e.x,e.y]:[i,i]}_createTransforms(){return{displayViewScreenMat3:(0,E.vt)()}}setTransform(e){const r=(0,B.D_)(this.transforms.displayViewScreenMat3),[i,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.resolution/this.pixelRatio/e.resolution,h=a*this.width,y=a*this.height,R=Math.PI*this.rotation/180;(0,B.Tl)(r,r,(0,T.fA)(i,n)),(0,B.Tl)(r,r,(0,T.fA)(h/2,y/2)),(0,B.e$)(r,r,-R),(0,B.Tl)(r,r,(0,T.fA)(-h/2,-y/2)),(0,B.Oe)(r,r,(0,T.fA)(h,y)),(0,B.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}getTextures({forProcessing:e=!1,useProcessedTexture:r=!1}={}){const i=r?this._processedTexture??this._rasterTexture:this._rasterTexture,n=[],a=[];return i?(this._transformGridTexture&&!this.projected&&(a.push(this._transformGridTexture),n.push("u_transformGrid")),r?(a.push(i),n.push("u_image"),this._colormapTexture&&(a.push(this._colormapTexture),n.push("u_colormap")),{names:n,textures:a}):(a.push(i),n.push("u_image"),this._colormapTexture&&!e&&(a.push(this._colormapTexture),n.push("u_colormap")),{names:n,textures:a})):{names:n,textures:a}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:e}){if(!this.stage)return void this._disposeTextures();const r=this._isValidSource(this.source);r&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(e)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(e),this._rasterTexture&&(r?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,d.kc)(e,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}updateProcessedTexture(){const{functionTextures:e}=this;0!==e.length&&(this.processedTexture=e.shift(),e.forEach(r=>r?.dispose()),e.length=0)}_createOrDestroyRasterTexture(e){const r=this.source?.extractBands(this.bandIds);if(!this._isValidSource(r))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null));const i=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(i)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}this._supportsBilinearTexture=!!e.capabilities.textureFloatLinear;const n=this._getTextureSamplingMethod(this.interpolation);this._rasterTexture=(0,d.b4)(e,r,n,this.isRendereredSource),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}_isBandIdsChanged(e){const r=this._rasterTextureBandIds;return!(null==r&&null==e||r&&e&&r.join("")===e.join(""))}_isValidSource(e){return null!=e&&e.pixels?.length>0}_getTextureSamplingMethod(e){const{type:r}=this.symbolizerParameters;return!this._supportsBilinearTexture||"lut"===r&&!this.symbolizerParameters.isClassBreaks||"hillshade"===r||"stretch"===r&&1===this.symbolizerParameters.bandCount||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,a)=>n!==r[a])?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=(0,d.hE)(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=(0,d.hE)(e,i),void(this._colormap=i)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}_disposeTextures(e=!1){!this._transformGridTexture||e&&!this.projected||(this._transformGridTexture.dispose(),this._transformGridTexture=null),!e&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null,this._colormap=null,this._colormapTextureInvalidated=!0),!e&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}function u(s){const e=[];return s&&(e.push("applyProjection"),1===s.spacing[0]&&e.push("lookupProjection")),e}function g(s,e,r){const i=!r.capabilities.textureFloatLinear,n=[];return"cubic"===s?n.push("bicubic"):"bilinear"===s&&(e?(n.push("bilinear"),n.push("nnedge")):i&&n.push("bilinear")),n}const p={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])},P={createProgram:function _(s,e,r){const i=r?[]:u(e.transformGrid);return{defines:i,program:s.painter.materialManager.getProgram(p,i)}},bindTextureAndUniforms:function v(s,e,r,i,n=!1){const{names:a,textures:h}=r.getTextures({useProcessedTexture:n});(0,d.hB)(s.context,e,a,h),(0,d.EO)(e,i,r.commonUniforms),e.setUniformMatrix3fv("u_dvsMat3",r.transforms.displayViewScreenMat3);const{colormap:y,colormapOffset:R}=r.symbolizerParameters,N=(0,d.Pp)(y,R);(0,d.EO)(e,i,N)}},A={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])},se={createProgram:function w(s,e,r){const{colormap:i}=e.symbolizerParameters,n=[...r?[]:u(e.transformGrid),...g(e.interpolation,!0,s.context)];return null!=i&&n.push("applyColormap"),{defines:n,program:s.painter.materialManager.getProgram(A,n)}},bindTextureAndUniforms:function L(s,e,r,i,n=!1){const{names:a,textures:h}=r.getTextures({useProcessedTexture:n});(0,d.hB)(s.context,e,a,h),(0,d.EO)(e,i,r.commonUniforms),e.setUniformMatrix3fv("u_dvsMat3",r.transforms.displayViewScreenMat3);const y=r.symbolizerParameters,{colormap:R,colormapOffset:N}=y;if(null!=R){const k=(0,d.Pp)(R,N);(0,d.EO)(e,i,k)}const K=(0,d.OI)(y);(0,d.EO)(e,i,{...K,u_scaling:1})}},X={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])},$={createProgram:function Y(s,e,r){const{colormap:i,bandCount:n}=e.symbolizerParameters,a=[...r?[]:u(e.transformGrid),...g(e.interpolation,1===n,s.context)];return e.isRendereredSource&&!r?a.push("noop"):null!=i&&a.push("applyColormap"),{defines:a,program:s.painter.materialManager.getProgram(X,a)}},bindTextureAndUniforms:function Z(s,e,r,i,n=!1){const{names:a,textures:h}=r.getTextures({useProcessedTexture:n});(0,d.hB)(s.context,e,a,h),(0,d.EO)(e,i,r.commonUniforms),e.setUniformMatrix3fv("u_dvsMat3",r.transforms.displayViewScreenMat3);const y=r.symbolizerParameters,{colormap:R,colormapOffset:N}=y;if(null!=R){const k=(0,d.Pp)(R,N);(0,d.EO)(e,i,k)}const K=(0,d.VC)(y);(0,d.EO)(e,i,K)}},ie=new Map;ie.set("lut",P),ie.set("hillshade",se),ie.set("stretch",$);const de=[1,1],pe=[2,0,0,0,2,0,-1,-1,0];function ee(s,e,r,i){const{context:n,rasterFunction:a,hasBranches:h}=s,{raster:y}=a.parameters,N=[r.functionTextures[h?y?.id??-1:0]??r.rasterTexture],K=["u_image"];if(i){const k=(0,d.hE)(n,i);r.functionTextures[100]=k,N.push(k),K.push("u_colormap")}(0,d.hB)(n,e,K,N)}function fe(s,e,r){const{rasters:i}=s.rasterFunction.parameters;if(!i)return;if(i.length<2)return ee(s,e,r);const n=i.filter(a=>"Constant"!==a.name).map(a=>null!=a.id&&"Identity"!==a.name?r.functionTextures[a.id]:r.rasterTexture);if((0,d.hB)(s.context,e,["u_image","u_image1","u_image2"].slice(0,n.length),n),n.length!==i.length)if(2===i.length){const a=i.findIndex(R=>"Constant"===R.name),h=0===a?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:y}=i[a].parameters;e.setUniform1f("u_image1Const",y),e.setUniformMatrix3fv("u_imageSwap",h)}else if(3===i.length){const a=[];if(i.forEach((h,y)=>"Constant"===h.name&&a.push(y)),1===a.length){const{value:h}=i[a[0]].parameters;e.setUniform1f("u_image1Const",h),e.setUniformMatrix3fv("u_imageSwap",0===a[0]?[0,1,0,0,0,1,1,0,0]:1===a[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1])}else if(2===a.length){const{value:h}=i[a[0]].parameters;e.setUniform1f("u_image1Const",h);const{value:y}=i[a[1]].parameters;e.setUniform1f("u_image2Const",y);const R=i.findIndex(K=>"Constant"!==K.name);e.setUniformMatrix3fv("u_imageSwap",0===R?[1,0,0,0,1,0,0,0,1]:1===R?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0])}}}function J(s){s.setUniform2fv("u_coordScale",de),s.setUniformMatrix3fv("u_dvsMat3",pe)}const _e={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])},ye={createProgram:function he(s,e){return s.painter.materialManager.getProgram(_e,[])},bindTextureAndUniforms:function me(s,e,r){ee(s,e,r),J(e);const i=r.getRasterTextureSize();e.setUniform2fv("u_srcImageSize",i);const n=r.getRasterCellSize();e.setUniform2fv("u_cellSize",n)}},be={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])},ge={createProgram:function Re(s,e){const{painter:r,rasterFunction:i}=s,{indexType:n,isOutputRounded:a}=i.parameters,h=[n];return a&&h.push("roundOutput"),r.materialManager.getProgram(be,h)},bindTextureAndUniforms:function Ce(s,e,r){ee(s,e,r),J(e);const{bandIndexMat3:i,adjustments:n}=s.rasterFunction.parameters;e.setUniformMatrix3fv("u_bandIndexMat3",i),e.setUniform1fv("u_adjustments",n)}},Te={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/colormap2rgb",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ue={createProgram:function Ae(s){const{painter:e}=s;return e.materialManager.getProgram(Te,[])},bindTextureAndUniforms:function Be(s,e,r){const{indexedColormap:i,offset:n}=s.rasterFunction.parameters;ee(s,e,r,i),J(e),e.setUniform1f("u_colormapOffset",n),e.setUniform1f("u_colormapMaxIndex",i.length/4-1)}},De={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ne={createProgram:function Le(s,e){const r=s.rasterFunction.parameters.rasters.filter(n=>"Constant"===n.name),i=[];return r.length&&(i.push("oneConstant"),2===r.length&&i.push("twoConstant")),s.painter.materialManager.getProgram(De,i)},bindTextureAndUniforms:function Ie(s,e,r){fe(s,e,r),J(e)}},ze={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/computechange",attributes:new Map([["a_position",0],["a_texcoord",1]])},tt={createProgram:function t(s){const{painter:e,rasterFunction:r}=s,{method:i,rasters:n,isOutputRounded:a}=r.parameters,h=[i.includes("-")?i.slice(0,i.indexOf("-")):i];return n.filter(y=>"Constant"===y.name).length&&h.push("oneConstant"),a&&h.push("roundOutput"),e.materialManager.getProgram(ze,h)},bindTextureAndUniforms:function et(s,e,r){fe(s,e,r),J(e);const{domainRange:i}=s.rasterFunction.parameters;e.setUniform2fv("u_domainRange",i)}},rt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/contrast",attributes:new Map([["a_position",0],["a_texcoord",1]])},nt={createProgram:function st(s,e){return s.painter.materialManager.getProgram(rt,[])},bindTextureAndUniforms:function it(s,e,r){ee(s,e,r),J(e);const{contrastOffset:i,brightnessOffset:n}=s.rasterFunction.parameters;e.setUniform1f("u_contrastOffset",i),e.setUniform1f("u_brightnessOffset",n)}},at={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])},ut={createProgram:function ot(s,e){const{painter:r,rasterFunction:i}=s,{kernelRows:n,kernelCols:a}=i.parameters;return r.materialManager.getProgram(at,[{name:"rows",value:n},{name:"cols",value:a}])},bindTextureAndUniforms:function lt(s,e,r){ee(s,e,r),J(e),e.setUniform2fv("u_srcImageSize",[r.width,r.height]);const{kernel:i,clampRange:n}=s.rasterFunction.parameters;e.setUniform1fv("u_kernel",i),e.setUniform2fv("u_clampRange",n)}},ct={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",0],["a_texcoord",1]])},ft={createProgram:function ht(s,e){const{painter:r,rasterFunction:i}=s,{curvatureType:n}=i.parameters;return r.materialManager.getProgram(ct,[n])},bindTextureAndUniforms:function dt(s,e,r){ee(s,e,r),J(e);const i=r.getRasterTextureSize();e.setUniform2fv("u_srcImageSize",i);const{zFactor:n}=s.rasterFunction.parameters,a=r.getRasterCellSize();e.setUniform1f("u_zlFactor",200*n/a[0]/a[1])}},mt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])},gt={createProgram:function pt(s,e){return s.painter.materialManager.getProgram(mt,[])},bindTextureAndUniforms:function _t(s,e,r){ee(s,e,r),J(e);const{bandIndexMat3:i}=s.rasterFunction.parameters;e.setUniformMatrix3fv("u_bandIndexMat3",i)}},Tt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/focalstatistics",attributes:new Map([["a_position",0],["a_texcoord",1]])},vt={createProgram:function yt(s,e){const{painter:r,rasterFunction:i}=s,{kernelRows:n,kernelCols:a,fillNoDataOnly:h,statisticsType:y}=i.parameters,R=[{name:"rows",value:n},{name:"cols",value:a},y];return h&&R.push("fill"),r.materialManager.getProgram(Tt,R)},bindTextureAndUniforms:function xt(s,e,r){ee(s,e,r),J(e),e.setUniform2fv("u_srcImageSize",[r.width,r.height]);const{clampRange:i}=s.rasterFunction.parameters;e.setUniform2fv("u_clampRange",i)}},Pt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/grayscale",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ct={createProgram:function bt(s,e){return s.painter.materialManager.getProgram(Pt,[])},bindTextureAndUniforms:function Rt(s,e,r){ee(s,e,r),J(e);const{weights:i}=s.rasterFunction.parameters;e.setUniform3fv("u_weights",i)}},St={vsPath:"raster/rfx/vs",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])},je={createProgram:function Et(s,e){const{indexedColormap:r}=s.rasterFunction.parameters,i=[];return r?.length&&i.push("applyColormap"),s.painter.materialManager.getProgram(St,i)},bindTextureAndUniforms:function Mt(s,e,r){const i=s.rasterFunction.parameters,{indexedColormap:n}=i;ee(s,e,r,n),J(e);const a=r.getRasterTextureSize();e.setUniform2fv("u_srcImageSize",a);const h=r.getRasterCellSize();e.setUniform2fv("u_cellSize",h);const{pixelSizeFactor:y}=i;if(0===y)e.setUniform2fv("u_factor",[i.factor[0]/h[0],i.factor[1]/h[1]]);else{const{zFactor:R,pixelSizePower:N,gcsFactor:K}=i,k=h[0]*K,W=h[1]*K;e.setUniform2fv("u_factor",[(R+k**N*y)/(8*k),(R+W**N*y)/(8*W)])}e.setUniform1i("u_hillshadeType",i.hillshadeType),e.setUniform1fv("u_sinZcosAs",i.sinZcosAs),e.setUniform1fv("u_sinZsinAs",i.sinZsinAs),e.setUniform1fv("u_cosZs",i.cosZs),e.setUniform1fv("u_weights",i.weights),e.setUniform1f("u_opacity",1),e.setUniform1i("u_flipY",0),e.setUniform1f("u_scaling",255),e.setUniform1f("u_minValue",i.minValue),e.setUniform1f("u_maxValue",i.maxValue),n&&(e.setUniform1f("u_colormapOffset",i.offset),e.setUniform1f("u_colormapMaxIndex",n.length/4-1))}},wt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ge={createProgram:function At(s){const{painter:e,rasterFunction:r}=s,{imageCount:i,operationName:n,rasters:a,isOutputRounded:h}=r.parameters,y=[n.toLowerCase()];2===i&&y.push("twoImages");const R=a.filter(N=>"Constant"===N.name);return R.length&&(y.push("oneConstant"),2===R.length&&y.push("twoConstant")),h&&y.push("roundOutput"),e.materialManager.getProgram(wt,y)},bindTextureAndUniforms:function Ut(s,e,r){fe(s,e,r),J(e);const{domainRange:i}=s.rasterFunction.parameters;e.setUniform2fv("u_domainRange",i)}},Dt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])},Ft={createProgram:function It(s,e){const{painter:r,rasterFunction:i}=s;return r.materialManager.getProgram(Dt,i.parameters.bandCount>1?["multiBand"]:[])},bindTextureAndUniforms:function Ot(s,e,r){ee(s,e,r),J(e);const{includedRanges:i,noDataValues:n}=s.rasterFunction.parameters;e.setUniform1fv("u_includedRanges",i),e.setUniform1fv("u_noDataValues",n)}},Bt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])},zt={createProgram:function Lt(s,e){const{painter:r,rasterFunction:i}=s;return r.materialManager.getProgram(Bt,i.parameters.scaled?["scaled"]:[])},bindTextureAndUniforms:function Nt(s,e,r){ee(s,e,r),J(e);const{bandIndexMat3:i}=s.rasterFunction.parameters;e.setUniformMatrix3fv("u_bandIndexMat3",i)}},Vt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])},Gt={createProgram:function Wt(s,e){return s.painter.materialManager.getProgram(Vt,[])},bindTextureAndUniforms:function jt(s,e,r){ee(s,e,r),J(e);const{noDataRanges:i,rangeMaps:n,allowUnmatched:a,clampRange:h}=s.rasterFunction.parameters;e.setUniform1fv("u_noDataRanges",i),e.setUniform1fv("u_rangeMaps",n),e.setUniform1f("u_unmatchMask",a?1:0),e.setUniform2fv("u_clampRange",h)}};var ke=f(45475);const kt={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])},Zt={createProgram:function Ht(s,e){const{painter:r}=s,i=[],{interpolation:n,transformGrid:a}=e,h=s.rasterFunction?.parameters;return"cubic"===n?i.push("bicubic"):"bilinear"===n&&(i.push("bilinear"),h?.requireNNEdge&&i.push("nnedge")),a&&(i.push("applyProjection"),1===a.spacing[0]&&i.push("lookupProjection")),r.materialManager.getProgram(kt,i)},bindTextureAndUniforms:function Kt(s,e,r){const{names:i,textures:n}=r.getTextures({forProcessing:!0});(0,d.hB)(s.context,e,i,n),e.setUniform1f("u_scale",1),e.setUniform2fv("u_offset",[0,0]),e.setUniform2fv("u_coordScale",[1,1]),e.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]),e.setUniform1i("u_flipY",0),e.setUniform1f("u_opacity",1);const{width:a,height:h,source:y,transformGrid:R}=r;e.setUniform2fv("u_srcImageSize",[y.width,y.height]),e.setUniform2fv("u_targetImageSize",[a,h]),e.setUniform2fv("u_transformSpacing",R?R.spacing:ke.uY),e.setUniform2fv("u_transformGridSize",R?R.size:ke.uY)}},$t={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])},Yt={createProgram:function Qt(s,e){const{painter:r,rasterFunction:i}=s,{slopeType:n,isOutputRounded:a}=i.parameters,h=[];return"percent-rise"===n&&h.push("percentRise"),a&&h.push("roundOutput"),r.materialManager.getProgram($t,h)},bindTextureAndUniforms:function Xt(s,e,r){ee(s,e,r),J(e);const i=r.getRasterTextureSize();e.setUniform2fv("u_srcImageSize",i);const n=r.getRasterCellSize();e.setUniform2fv("u_cellSize",n);const{zFactor:a,slopeType:h,pixelSizePower:y,pixelSizeFactor:R}=s.rasterFunction.parameters;e.setUniform1f("u_zFactor",a),e.setUniform1f("u_pixelSizePower","adjusted"===h?y:0),e.setUniform1f("u_pixelSizeFactor","adjusted"===h?R:0)}},Jt={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])},tr={createProgram:function qt(s,e){const{useGamma:r,bandCount:i,isOutputRounded:n}=s.rasterFunction.parameters,a=[];return r&&a.push("useGamma"),i>1&&a.push("multiBand"),n&&a.push("roundOutput"),s.painter.materialManager.getProgram(Jt,a)},bindTextureAndUniforms:function er(s,e,r){ee(s,e,r),J(e);const{width:i,height:n}=r,a=s.rasterFunction.parameters;e.setUniform2fv("u_srcImageSize",[i,n]),e.setUniform1f("u_minOutput",a.minOutput),e.setUniform1f("u_maxOutput",a.maxOutput),e.setUniform1fv("u_factor",a.factor),e.setUniform1fv("u_minCutOff",a.minCutOff),e.setUniform1fv("u_maxCutOff",a.maxCutOff),e.setUniform1fv("u_gamma",a.gamma),e.setUniform1fv("u_gammaCorrection",a.gammaCorrection)}};var rr=f(76169),sr=f(4931);const te=new Map;function He(s,e){const r=new sr.R;return r.width=s,r.height=e,r.internalFormat=m.H0.RGBA32F,r.samplingMode=m.Cj.NEAREST,r.dataType=m.ld.FLOAT,r.isImmutable=!0,r.wrapMode=m.pF.CLAMP_TO_EDGE,r}te.set("arithmetic",Ge),te.set("aspect",ye),te.set("bandarithmetic",ge),te.set("colormaptorgb",Ue),te.set("computechange",tt),te.set("compositeband",Ne),te.set("convolution",ut),te.set("contrastbrightness",nt),te.set("curvature",ft),te.set("extractband",gt),te.set("statistics",vt),te.set("grayscale",Ct),te.set("hillshade",je),te.set("shadedrelief",je),te.set("local",Ge),te.set("mask",Ft),te.set("ndvi",zt),te.set("remap",Gt),te.set("slope",Yt),te.set("stretch",tr);var Oe=f(47669),Ke=f(91837),or=f(67448),lr=f(79061);class ur extends or.A{constructor(){super(...arguments),this.name="raster",this._quad=null,this._rendererUniformInfos=new Map,this._fbo=null}dispose(){(0,re.WD)(this._quad),(0,re.WD)(this._fbo)}prepareState(e){const{context:r,renderPass:i}=e,n="raster"===i;r.setBlendingEnabled(!n),r.setBlendFunctionSeparate(m.dn.ONE,m.dn.ONE_MINUS_SRC_ALPHA,m.dn.ONE,m.dn.ONE_MINUS_SRC_ALPHA),r.setColorMask(!0,!0,!0,!0),r.setStencilWriteMask(0),r.setStencilTestEnabled(!n)}draw(e,r){if(!function c(s){return null!=s.source}(r)||r.suspended)return;const{renderPass:i}=e;if("raster-bitmap"!==i)return"raster"===i?this._process(e,r):void this._drawBitmap(e,r,!0);this._drawBitmap(e,r)}_process(e,r){const{rasterFunction:i}=e,n="Reproject"===i.name;if(!(n?!r.rasterTexture||!r.projected:!r.processed))return;const{timeline:a,context:h}=e;a.begin(this.name);const y=h.getBoundFramebufferObject(),R=h.getViewport();n||(r.processedTexture=(0,re.WD)(r.processedTexture)),h.setStencilFunction(m.MT.EQUAL,r.stencilRef,255),r.updateTexture(e),this._initQuad(h);const[N,K]=r.getRasterTextureSize(n),{isStandardRasterTileSize:k,fbo:W}=this._getRasterFBO(h,N,K);(function ar(s,e,r,i){const n=s.rasterFunction.name.toLowerCase(),a="reproject"===n?Zt:function nr(s){return te.get(s.toLowerCase())}(n);if(null==a)return;const h=function ir(s,e,r,i){const{context:n,requestRender:a,allowDelayedRender:h}=s,y=i.createProgram(s,r);return h&&null!=a&&!y.compiled?(a(),null):(n.bindFramebuffer(e),n.setViewport(0,0,e.width,e.height),n.useProgram(y),y)}(s,r,i,a);if(!h)return;a.bindTextureAndUniforms(s,h,i);const{interpolation:y}=i;"reproject"===n&&(i.interpolation="nearest"),e.draw();const[R,N]=i.getRasterTextureSize("reproject"===n),K=He(R,N),k=new rr.g(s.context,K);r.copyToTexture(0,0,R,N,0,0,k),"reproject"===n?(i.rasterTexture=k,i.projected=!0,i.interpolation=y):i.functionTextures[s.hasBranches?s.rasterFunction.id:0]=k})(e,this._quad,W,r),k||W.dispose(),h.bindFramebuffer(y),h.setViewport(R.x,R.y,R.width,R.height),a.end(this.name)}_drawBitmap(e,r,i=!1){const{timeline:n,context:a}=e;if(n.begin(this.name),a.setStencilFunction(m.MT.EQUAL,r.stencilRef,255),r.updateTexture(e),i&&!r.processedTexture){if(r.updateProcessedTexture(),!r.processedTexture)return void n.end(this.name);r.processed=!0}this._initBitmapCommonUniforms(r);const h=r.symbolizerParameters.type,y=function ae(s){return ie.get(s)}(h),{requestRender:R,allowDelayedRender:N}=e,{defines:K,program:k}=y.createProgram(e,r,r.projected&&i);if(N&&null!=R&&!k.compiled)return void R();a.useProgram(k);const W=this._getUniformInfos(h,a,k,K);this._quad||(this._quad=new Ke.A(a,[0,0,1,0,0,1,1,1])),y.bindTextureAndUniforms(e,k,r,W,i),this._quad.draw(),n.end(this.name)}_initBitmapCommonUniforms(e){if(!e.commonUniforms){const r=(0,d.Qg)(1,[0,0]),{transformGrid:i,width:n,height:a}=e,h=(0,d.xV)(i,[n,a],[e.source.width,e.source.height],1,!1);e.commonUniforms={...r,...h,u_coordScale:e.coordScale}}}_getRasterFBO(e,r,i){const n=r===Oe.CQ&&i===Oe.CQ;return n?(this._fbo||(this._fbo=this._createNewFBO(e,r,i)),{isStandardRasterTileSize:n,fbo:this._fbo}):{isStandardRasterTileSize:n,fbo:this._createNewFBO(e,r,i)}}_createNewFBO(e,r,i){const n=He(r,i);return new lr.H(e,n)}_initQuad(e){this._quad||(this._quad=new Ke.A(e,[0,0,1,0,0,1,1,1]))}_getUniformInfos(e,r,i,n){const a=n.length>0?e+"-"+n.join("-"):e;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);const h=(0,d.z)(r,i);return this._rendererUniformInfos.set(a,h),h}}var Ze=f(15442);class cr extends Ze.Y{constructor(e,r,i,n,a,h,y=null){super(e,r,i,n,a,h),this.bitmap=null,this.bitmap=new S(y,null,null),this.bitmap.coordScale=[a,h],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:(0,E.vt)(),tileMat3:(0,E.vt)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var Ve=f(69473),$e=f(37188);class hr extends $e.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const r=this._getTileBounds(e),[i,n]=this.tileInfoView.tileInfo.size,a=this.tileInfoView.getTileResolution(e.level);return new cr(e,a,r[0],r[3],i,n)}prepareRenderPasses(e){const r=e.registerRenderPass({name:"imagery (tile)",brushes:[ur],target:()=>this.children.map(i=>i.bitmap),drawPhase:Ve.S5.MAP});return[...super.prepareRenderPasses(e),r]}doRender(e){if(!this.visible||e.drawPhase!==Ve.S5.MAP)return;const{rasterFunctionChain:r}=this;if(!r)return e.renderPass="raster-bitmap",void super.doRender(e);if(!r.hasFocalFunction){const[i,n]=this.tileInfoView.tileInfo.size;e.renderPass="raster",e.rasterFunction={name:"Reproject",parameters:{targetImageSize:[i,n],requireNNEdge:r.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1},super.doRender(e)}if(r?.functions.length){const{functions:i,hasBranches:n}=r;for(let a=0;a<i.length;a++){const h=i[a];"Constant"!==h.name&&"Identity"!==h.name&&(e.renderPass="raster",e.rasterFunction=h,e.hasBranches=n,super.doRender(e))}}e.rasterFunction=null,e.renderPass="bitmap",super.doRender(e)}_getTileBounds(e){const r=this.tileInfoView.getTileBounds((0,H.vt)(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this.tileInfoView,n=(0,le.FT)(i.spatialReference);if(n){const a=i.lodAt(e.level);if(!a)return r;const{resolution:h}=a,y=h*i.size[0];r[0]=n*e.world+i.origin.x+e.col*y,r[2]=r[0]+y}}return r}}var dr=f(98877),fr=f(56985),mr=f(28067),pr=f(1749),_r=f(21980),Qe=f(11333),Se=f(62619),Ee=f(40018),gr=f(54290),Tr=(f(74847),f(15215)),Xe=f(77031),yr=f(34150),xr=f(54551);const vr=[0,0];let oe=class extends dr.A{constructor(){var s;super(...arguments),s=this,this._updatingHandles=new fr.U,this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=[],this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._maxIndexedColormapSize=0,this._rasterFunctionState="na",this._globalUpdateRequested=!1,this.attached=!1,this.timeExtent=null,this.redrawOrRefetch=(0,O.sg)((0,V.A)(function*(e={}){const r=s._rasterFunctionState;if(e.reprocess&&(yield s._updatingHandles.addPromise(s.layer.updateRasterFunction()),s.updateRasterFunctionParameters()),!s.previousLOD||s.layerView.suspended)return;const i=s._rasterFunctionState,{type:n}=s;return s._updatingHandles.addPromise(e.refetch||"raster"!==n&&e.reprocess||"cpu"===i||"cpu"===r?s.doRefresh():s._redrawImage(e.signal))}))}destroy(){this._updatingHandles.destroy()}get useWebGLForProcessing(){return this._get("useWebGLForProcessing")??!0}set useWebGLForProcessing(s){this._set("useWebGLForProcessing",s)}get useProgressiveUpdate(){return this._get("useProgressiveUpdate")??!0}set useProgressiveUpdate(s){if(this._tileStrategy&&this.useProgressiveUpdate!==s){this._tileStrategy.destroy(),this.container.removeAllChildren();const e=this._getCacheSize(s);this._tileStrategy=new Xe.A({cachePolicy:"purge",acquireTile:r=>this.acquireTile(r),releaseTile:r=>this.releaseTile(r),cacheSize:e,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",s),this.layerView.requestUpdate()}}update(s){this._fetchQueue.pause(),this._fetchQueue.state=s.state,this._tileStrategy.update(s),this._fetchQueue.resume();const{extent:e,resolution:r,scale:i}=s.state,n=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const a=this._srcResolutions[n.level],h="toJSON"in e?e:mr.A.fromJSON(e);(0,Se.yo)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,h,r,a,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,this.previousLOD?.level!==n.level&&(this.previousLOD=n,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()}));const s=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(s),this.layerView.requestUpdate()}get updating(){return this._globalUpdateRequested||this._updatingHandles?.updating}attach(){const s=(0,xr.C)();this._maxIndexedColormapSize=4*(s.maxTextureSize||4096),this._initializeTileInfo(),this._tileInfoView=new gr.A(this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new Tr.A({tileInfoView:this._tileInfoView,concurrency:e,process:(i,n)=>this._fetchTile(i,n),priority:yr.W6.MAPVIEW_FETCH_QUEUE,scheduler:this.scheduler});const r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new Xe.A({cachePolicy:"purge",acquireTile:i=>this.acquireTile(i),releaseTile:i=>this.releaseTile(i),cacheSize:r,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,Se.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(s){const e=this.container.createTile(s);return this._updatingHandles.addPromise(this._enqueueTileFetch(e)),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,e}releaseTile(s){this._fetchQueue.abort(s.key.id),this.container.removeChild(s),s.once("detach",()=>{s.destroy(),this.layerView.requestUpdate()}),this.layerView.requestUpdate()}createEmptyTilePixelBlock(s=null){const e=null==s||s.join(",")===this._tileInfoView.tileInfo.size.join(",");if(e&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;s=s||this._tileInfoView.tileInfo.size;const[r,i]=s,n=new _r.A({width:r,height:i,pixels:[new Uint8Array(r*i)],mask:new Uint8Array(r*i),pixelType:"u8"});return e&&(this._emptyTilePixelBlock=n),n}_getBandIds(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;const{bandIds:s,raster:e}=this.layer,r="rasterFunction"in e?e.rasterFunction.rawInputBandIds:null;return s?.length&&r?.length&&1!==e.rasterInfo.bandCount?s.map(i=>r[Math.min(i,r.length-1)]):"rasterFunction"in e?r:s}updateRasterFunctionParameters(){}_fetchTile(s,e){const r=this._getFetchOptions(s.level,e.signal);return this.fetchTile(s,r)}_getFetchOptions(s,e){const r=this.canUseWebGLForProcessing(),{layerView:i}=this,{tileInfo:n}=i,a=!n.isWrappable&&null!=(0,Ee.FT)(i.view.spatialReference);return{allowPartialFill:!0,datumTransformation:i.datumTransformation,interpolation:r?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:r&&this.layer.raster.hasUniqueSourceStorageInfo,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:e,srcResolution:this._srcResolutions[s],timeExtent:i.timeExtent,tileInfo:n,disableWrapAround:a}}_getCacheSize(s){return s?40:0}_initializeTileInfo(){const{layerView:s}=this,e=s.view.spatialReference;if(this._canUseLayerLODs()){const{origin:N,lods:K}=this.layer.tileInfo,k=K.map(({scale:q})=>q),W=Qe.A.create({spatialReference:e,size:Oe.CQ,scales:k,origin:N});return s.set("tileInfo",W),void(this._srcResolutions=K.map(({resolution:q})=>({x:q,y:q})))}const{scales:r,srcResolutions:i,isCustomTilingScheme:n}=(0,Ee.dK)(this.layer.serviceRasterInfo,e,{tileSize:Oe.CQ,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1}),a=Qe.A.create({spatialReference:e,size:Oe.CQ,scales:r}),h=0===a.origin.x;(0,re.Lw)(s.fullExtent);const{xmin:y,ymax:R}=s.fullExtent;(h||n&&a.origin.x>y)&&(a.origin=new pr.A({x:y,y:R,spatialReference:e})),this._isCustomTilingScheme=n,s.set("tileInfo",a),this._srcResolutions=i??[]}_canUseLayerLODs(){const{layer:s,layerView:e}=this;if("Map"!==s.raster.tileType)return!1;const{lods:r}=s.tileInfo,i=e.view.constraints?.effectiveLODs;return i?.length===r.length&&i.every(({scale:n},a)=>Math.abs(n-r[a].scale)<.001)}_computeFetchConcurrency(){const{blockBoundary:s}=this.layer.serviceRasterInfo.storageInfo,e=s[s.length-1];return(e.maxCol-e.minCol+1)*(e.maxRow-e.minRow+1)>64?2:10}_enqueueTileFetch(s,e){var r=this;return(0,V.A)(function*(){if(!r._fetchQueue.has(s.key.id)){try{const i=yield r._fetchQueue.push(s.key),n=r._getBandIds();let a=!r.useProgressiveUpdate||r.layerView.hasTilingEffects&&!r._globalSymbolizerParams;if(r._globalUpdateRequested&&!r.layerView.moving&&0===r._fetchQueue.length){a=!1;try{yield r._redrawImage(r._abortController?.signal)}catch(R){(0,O.zf)(R)&&j.A.getLogger(r).error(R)}r._globalUpdateRequested=!1}!r.canUseWebGLForProcessing()&&"rasterVF"!==r.type||r.layerView.hasTilingEffects||null!=r._symbolizerParams||r._updateSymbolizerParams();const h=r._tileInfoView.getTileCoords(vr,s.key),y=r._tileInfoView.getTileResolution(s.key);yield r.updateTileSource(s,{source:i,symbolizerParams:r._symbolizerParams,globalSymbolizerParams:r._globalSymbolizerParams,suspended:a,bandIds:n,coords:h,resolution:y}),s.once("attach",()=>r.layerView.requestUpdate()),r.container.addChild(s)}catch(i){(0,O.zf)(i)||j.A.getLogger(r).error(i)}r.layerView.requestUpdate()}})()}_redrawImage(s){var e=this;return(0,V.A)(function*(){if(0===e.container.children.length)return;yield e.layer.updateRenderer(),e.layerView.hasTilingEffects?yield e._updateGlobalSymbolizerParams(s):(e._updateSymbolizerParams(),e._globalSymbolizerParams=null);const r=e.container.children.map(function(){var i=(0,V.A)(function*(n){return e.updateTileSymbolizerParameters(n,{local:e._symbolizerParams,global:e._globalSymbolizerParams})});return function(n){return i.apply(this,arguments)}}());yield Promise.allSettled(r),e.container.requestRender()})()}_updateGlobalSymbolizerParams(s){var e=this;return(0,V.A)(function*(){const r=e._getFetchOptions(e.previousLOD.level,s),i=yield e.layer.fetchPixels(e.layerView.view.extent,e.layerView.view.width,e.layerView.view.height,{...r,interpolation:"nearest",requestRawData:!1,skipRasterFunction:!1});if(!i?.pixelBlock)return;const{resolution:n}=e.previousLOD,a=e._getBandIds(),h=e.layer.symbolizer.generateWebGLParameters({pixelBlock:i.pixelBlock.extractBands(a),isGCS:e.layerView.view.spatialReference.isGeographic,resolution:{x:n,y:n},bandIds:a});!e.canUseWebGLForProcessing()&&h&&"stretch"===h.type&&e.layer.renderer&&"raster-stretch"===e.layer.renderer.type&&(h.factor=h.factor.map(y=>255*y),h.minOutput=Math.round(255*h.minOutput),h.maxOutput=Math.round(255*h.maxOutput)),e._globalSymbolizerParams=h})()}_updateSymbolizerParams(){const{resolution:s}=this.previousLOD,e=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:s,y:s},bandIds:e})}_updateBlockCacheRegistry(s=!1){const{layer:e,layerView:r}=this,{raster:i}=e,{multidimensionalDefinition:n}=e.normalizeRasterFetchOptions({multidimensionalDefinition:e.multidimensionalDefinition,timeExtent:r.timeExtent}),a=i.rasterInfo.multidimensionalInfo?i.getSliceIndex(n):null,h=(0,Se.ph)(i.rasterId,a);if(h!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,Se.ht)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,Se.kz)(h,i.rasterInfo),s){const{view:y}=r,R=this._tileInfoView.getClosestInfoForScale(y.scale);(0,Se.yo)(h,this._blockCacheRegistryId,y.extent,y.resolution,this._srcResolutions[R.level],i.ioConfig.sampling)}this._blockCacheRegistryUrl=h}}doRefresh(){var s=this;return(0,V.A)(function*(){if(!s.attached||!s.previousLOD||s.layerView.suspended)return;yield s.layer.updateRenderer(),s.layerView.hasTilingEffects||s._updateSymbolizerParams(),s._updateBlockCacheRegistry(!0),s._fetchQueue.reset();const e=[];s._globalUpdateRequested=s.layerView.hasTilingEffects||!s.useProgressiveUpdate,s._tileStrategy.refresh(r=>e.push(s._enqueueTileFetch(r))),yield s._updatingHandles.addPromise(Promise.allSettled(e))})()}};(0,M._)([(0,C.MZ)()],oe.prototype,"_globalUpdateRequested",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"attached",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"container",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"layer",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"layerView",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"scheduler",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"type",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"useWebGLForProcessing",null),(0,M._)([(0,C.MZ)()],oe.prototype,"useProgressiveUpdate",null),(0,M._)([(0,C.MZ)()],oe.prototype,"timeExtent",void 0),(0,M._)([(0,C.MZ)()],oe.prototype,"updating",null),oe=(0,M._)([(0,b.$)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],oe);var Ye=f(62931),Pr=f(75644);let Me=class extends oe{constructor(){super(...arguments),this.type="raster"}attach(){super.attach(),this.container=new hr(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}canUseWebGLForProcessing(){const{symbolizer:s}=this.layer,e=s.lookup?.colormapLut?.indexedColormap;return this.useWebGLForProcessing&&s.canRenderInWebGL&&!(e&&e.length>this._maxIndexedColormapSize)&&!("majority"===this.layer.interpolation&&(0,Ye.H_)(this.layer))}fetchTile(s,e){return this.layer.fetchTile(s.level,s.row,s.col,e)}updateRasterFunctionParameters(){const{clips:s,view:e}=this.layerView;null!=this._geometry&&s.remove(this._geometry);const{raster:r,type:i}=this.layer;if("Function"===r.datasetFormat){const ue=r.getClippingGeometry(e.spatialReference);if(ue){const ne=new Pr.A({geometry:ue});s.add(ne),this._geometry=ne}}const{container:n}=this;if("Function"!==r.datasetFormat||"wcs"===i)return n.rasterFunctionChain=null,n.children.forEach(ue=>{const{bitmap:ne}=ue;ne&&(ne.suspended=!0,ne.processed=!1,ne.projected&&(ne.invalidateTexture(),ne.rasterTexture=null))}),void(this._rasterFunctionState="na");const a=this._rasterFunctionState,{rasterFunction:h,primaryRasters:y}=r,R=h.supportsGPU&&(!y||y.rasters.length<=1),N=R?h.flatWebGLFunctionChain:null,{renderer:K}=this.layer,k=!R||!N?.functions.length||"raster-stretch"===K?.type&&K.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();n.rasterFunctionChain=k?null:N;const W=null==h?"na":n.rasterFunctionChain?"gpu":"cpu",q=a===W||"na"===a&&"cpu"===W&&0===N?.functions?.length;n.children.forEach(ue=>{const{bitmap:ne}=ue;ne&&(ne.suspended=!q,ne.processed=!1,ne.processedTexture=null)}),this._rasterFunctionState=W}updateTileSource(s,e){var r=this;return(0,V.A)(function*(){const i=r._getBandIds(),n=r._getLayerInterpolation(),a=r.canUseWebGLForProcessing(),{source:h,globalSymbolizerParams:y,suspended:R,coords:N,resolution:K}=e,k=r.layerView.hasTilingEffects?y:e.symbolizerParams,{bitmap:W}=s;if([W.x,W.y]=N,W.resolution=K,null!=h?.pixelBlock){const q={extent:h.extent,pixelBlock:h.pixelBlock,srcPixelSize:h.srcTilePixelSize};if(W.rawPixelData=q,a)W.source=h.pixelBlock,W.isRendereredSource=!1;else{const ue=yield r.layer.applyRenderer(q,"stretch"===y?.type?y:void 0);W.source=ue,W.isRendereredSource=!0}W.symbolizerParameters=a?k:null,W.transformGrid=a?h.transformGrid:null}else{const q=r.createEmptyTilePixelBlock();W.source=q,W.symbolizerParameters=a?k:null,W.transformGrid=null}W.bandIds=a?i:null,W.width=r._tileInfoView.tileInfo.size[0],W.height=r._tileInfoView.tileInfo.size[1],W.interpolation=n,W.suspended=R,W.invalidateTexture()})()}updateTileSymbolizerParameters(s,e){var r=this;return(0,V.A)(function*(){const{local:i,global:n}=e,a=r._getBandIds(),h=r._getLayerInterpolation(),y=r.canUseWebGLForProcessing(),{bitmap:R}=s,{rawPixelData:N}=R;y||null==N?(R.isRendereredSource&&null!=N&&(R.source=N.pixelBlock),R.isRendereredSource=!1):(R.source=yield r.layer.applyRenderer(N,"stretch"===n?.type?n:void 0),R.isRendereredSource=!0),R.symbolizerParameters=y?r.layerView.hasTilingEffects?n:i:null,R.bandIds=y?a:null,R.interpolation=h,R.suspended=!1})()}_getLayerInterpolation(){const{interpolation:s,renderer:e}=this.layer;if(!e)return s;const r=e.type;return"raster-colormap"===r||"unique-value"===r?"nearest":"raster-stretch"===e.type&&null!=e.colorRamp?"bilinear"===s||"cubic"===s?"bilinear":"nearest":s}};(0,M._)([(0,C.MZ)()],Me.prototype,"container",void 0),(0,M._)([(0,C.MZ)()],Me.prototype,"layer",void 0),(0,M._)([(0,C.MZ)()],Me.prototype,"type",void 0),Me=(0,M._)([(0,b.$)("esri.views.2d.layers.imagery.ImageryTileView2D")],Me);const br=Me;var Rr=f(50444),Cr=f(21941),Sr=f(74856);class Er extends Ze.Y{constructor(e,r,i,n,a,h,y=null){super(e,r,i,n,a,h),this.tileData=new Sr.X(y),this.tileData.coordScale=[a,h],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:(0,E.vt)(),tileMat3:(0,E.vt)()}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,a]=this.tileData.offset,h=[this.x+n*this.resolution,this.y-a*this.resolution],[y,R]=e.toScreenNoRotation([0,0],h),{symbolTileSize:N}=this.tileData.symbolizerParameters,K=Math.round((this.width-this.tileData.offset[0])/N)*N,k=Math.round((this.height-this.tileData.offset[1])/N)*N;(0,B.hZ)(i,K/this.rangeX*r,0,0,0,k/this.rangeY*r,0,y,R,1),(0,B.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,i),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}class Mr extends $e.A{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const r=this.tileInfoView.getTileBounds((0,H.vt)(),e),[i,n]=this.tileInfoView.tileInfo.size,a=this.tileInfoView.getTileResolution(e.level);return new Er(e,a,r[0],r[3],i,n)}prepareRenderPasses(e){const r=e.registerRenderPass({name:"imagery (vf tile)",brushes:[Cr.A],target:()=>this.children.map(i=>i.tileData),drawPhase:Ve.S5.MAP});return[...super.prepareRenderPasses(e),r]}doRender(e){this.visible&&e.drawPhase===Ve.S5.MAP&&this.symbolTypes.forEach(r=>{e.renderPass=r,super.doRender(e)})}}let we=class extends oe{constructor(){super(...arguments),this._handle=null,this.type="rasterVF"}canUseWebGLForProcessing(){return!1}fetchTile(s,e){var r=this;return(0,V.A)(function*(){e={...e,interpolation:"nearest",requestProjectedLocalDirections:!0};const i=yield r.layer.fetchTile(s.level,s.row,s.col,e);return"vector-magdir"===r.layer.serviceRasterInfo?.dataType&&i?.pixelBlock&&(i.pixelBlock=yield r.layer.convertVectorFieldData(i.pixelBlock,e)),i})()}updateTileSource(s,e){const r=e.symbolizerParams,{tileData:i}=s;i.key=s.key,i.width=this._tileInfoView.tileInfo.size[0],i.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:n}=r,{source:a}=e;if(i.offset=this._getTileSymbolOffset(i.key,n),null!=a?.pixelBlock)i.rawPixelData={extent:a.extent,pixelBlock:a.pixelBlock},i.symbolizerParameters=r,i.source=this._sampleVectorFieldData(a.pixelBlock,r,i.offset);else{const h=[Math.round((this._tileInfoView.tileInfo.size[0]-i.offset[0])/n),Math.round((this._tileInfoView.tileInfo.size[1]-i.offset[1])/n)],y=this.createEmptyTilePixelBlock(h);i.source=y,i.symbolizerParameters=r}return i.invalidateVAO(),Promise.resolve()}updateTileSymbolizerParameters(s,e){const r=e.local,{symbolTileSize:i}=r,{tileData:n}=s;n.offset=this._getTileSymbolOffset(n.key,i);const a=n.symbolizerParameters.symbolTileSize;n.symbolizerParameters=r;const h=n.rawPixelData?.pixelBlock;return null!=h&&a!==i&&(n.source=this._sampleVectorFieldData(h,n.symbolizerParameters,n.offset)),Promise.resolve()}attach(){super.attach(),this.container=new Mr(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,F.wB)(()=>this.layer.renderer,s=>this._updateSymbolType(s))}detach(){super.detach(),this.container.removeAllChildren(),this._handle?.remove(),this._handle=null,this.container=null}_getTileSymbolOffset(s,e){const r=s.col*this._tileInfoView.tileInfo.size[0]%e,i=s.row*this._tileInfoView.tileInfo.size[1]%e;return[r>e/2?e-r:-r,i>e/2?e-i:-i]}_sampleVectorFieldData(s,e,r){const{symbolTileSize:i}=e;return(0,Rr.Wu)(s,"vector-uv",i,r)}_updateSymbolType(s){"vector-field"===s?.type&&(this.container.symbolTypes="wind-barb"===s.style?["scalar","triangle"]:"simple-scalar"===s.style?["scalar"]:["triangle"])}};(0,M._)([(0,C.MZ)()],we.prototype,"container",void 0),(0,M._)([(0,C.MZ)()],we.prototype,"layer",void 0),(0,M._)([(0,C.MZ)()],we.prototype,"type",void 0),we=(0,M._)([(0,b.$)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],we);const wr=we;var Ar=f(81098),Ur=f(5922),xe=f(95373),Dr=f(31876),Ir=f(64935);const Or=s=>{let e=class extends s{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return(0,Dr.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?(0,Ee.vI)(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(r){try{return!this.layer.loaded||!!(0,Ee.eh)(this.layer.serviceRasterInfo,r)}catch{return!1}}fetchPopupFeaturesAtLocation(r,i){var n=this;return(0,V.A)(function*(){const{layer:a}=n;if(!r)throw new Ur.A("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:a});const{popupEnabled:h}=a,y=(0,Ir.D8)(a,i);if(!h||null==y)return[];const R=[],{value:N,magdirValue:K,processedValue:k}=yield a.identify(r,{timeExtent:n.timeExtent,signal:i?.signal});let W="";if(N?.length){W="imagery-tile"===a.type&&a.hasStandardTime()&&null!=N[0]?N.map(Fe=>a.getStandardTimeValue(Fe)).join(", "):N.join(", ");const q={ObjectId:0};q[xe.F_.servicePixelValue]="imagery-tile"===a.type&&"Function"===a.raster.datasetFormat?k?.join(", "):W,q[xe.F_.rawServicePixelValue]=W;const ue=a.raster?.rasterInfo??a.serviceRasterInfo,ne=ue?.attributeTable;if(null!=ne){const{fields:Fe,features:zr}=ne,qe=Fe.find(({name:Pe})=>"value"===Pe.toLowerCase()),Vr=q[xe.F_.servicePixelValue],We=qe?zr.find(Pe=>String(Pe.attributes[qe.name])===Vr):null;if(We)for(const Pe in We.attributes)We.attributes.hasOwnProperty(Pe)&&(q[xe.ER+Pe]=We.attributes[Pe])}const Je=ue?.dataType;if("vector-magdir"!==Je&&"vector-uv"!==Je||(q[xe.F_.magnitude]=K?.[0],q[xe.F_.direction]=K?.[1]),"imagery-tile"===a.type){const{multidimensionalDefinition:Fe}=n.layer.normalizeRasterFetchOptions({timeExtent:n.timeExtent});(0,xe.eS)(a.rasterFields,q,Fe)}const Nr=new Ar.A({geometry:n.fullExtent?.clone(),attributes:q,layer:a,sourceLayer:a});R.push(Nr)}return R})()}getSourceScale(){var r=this;return(0,V.A)(function*(){return yield r.layer.load(),(0,Ee.OO)(r.layer.serviceRasterInfo,r.view.spatialReference)})()}_getFullExtent(){return(0,Ee.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}};return(0,M._)([(0,C.MZ)()],e.prototype,"fullExtent",null),(0,M._)([(0,C.MZ)()],e.prototype,"layer",void 0),(0,M._)([(0,C.MZ)({readOnly:!0})],e.prototype,"timeExtent",null),(0,M._)([(0,C.MZ)()],e.prototype,"tileInfo",void 0),(0,M._)([(0,C.MZ)({readOnly:!0})],e.prototype,"hasTilingEffects",null),(0,M._)([(0,C.MZ)()],e.prototype,"datumTransformation",null),e=(0,M._)([(0,b.$)("esri.views.layers.ImageryTileLayerView")],e),e};var Fr=f(41474),Br=f(96081);let ve=class extends(Or((0,Br.A)((0,G.e)(Fr.A)))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(s){this._useWebGLForProcessing=s,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=s)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(s){this._useProgressiveUpdate=s,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=s)}get displayParameters(){const{layer:s}=this,e=this._get("displayParameters");return s.renderer&&s.visible?{bandIds:s.bandIds,renderer:s.renderer,interpolation:s.interpolation,multidimensionalDefinition:s.multidimensionalDefinition,rasterFunction:"imagery-tile"===s.type?s.rasterFunction:null}:e}update(s){this.subview?.update(s),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,F.wB)(()=>this.displayParameters,(s,e)=>{const r=s.interpolation!==e?.interpolation&&("majority"===s.interpolation||"majority"===e?.interpolation)&&(0,Ye.H_)(this.layer),i=s.renderer!==e?.renderer&&this._getSubviewType(e?.renderer)!==this._getSubviewType(s.renderer);i&&this._updateSubview();const n=s.multidimensionalDefinition!==e?.multidimensionalDefinition,a=s.rasterFunction!==e?.rasterFunction;this.subview.redrawOrRefetch({refetch:n||r||i||a&&!this._useWebGLForProcessing,reprocess:a}).catch(R=>{(0,O.zf)(R)||j.A.getLogger(this).error(R)}),this.notifyChange("updating")}),(0,F.wB)(()=>this.layer.multidimensionalSubset??null,(s,e)=>{const{multidimensionalDefinition:r}=this.layer;null!=r&&(0,U.sx)(r,s)!==(0,U.sx)(r,e)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(i=>{(0,O.zf)(i)||j.A.getLogger(this).error(i)}),this.notifyChange("updating"))},F.OH),(0,F.wB)(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch({refetch:!0}).catch(s=>{(0,O.zf)(s)||j.A.getLogger(this).error(s)})},F.Vh)])}detach(){this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){const{renderer:s}=this.layer;if(!s)return;const e=this._getSubviewType(s);if(this.subview){if(this.subview.type===e)return void this._attachSubview(this.subview);this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}const{layer:r}=this;let i;if(i="rasterVF"===e?new wr({layer:r,layerView:this,scheduler:this.scheduler}):"flow"===e?new z.A({layer:r,layerView:this,scheduler:this.scheduler}):new br({layer:r,layerView:this,scheduler:this.scheduler}),"useWebGLForProcessing"in i&&(i.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in i&&(i.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in i){const{subview:n}=this;i.previousLOD=n&&"previousLOD"in n?n.previousLOD:null}this._attachSubview(i),this.subview=i,this.requestUpdate()}_attachSubview(s){s&&!s.attached&&(s.attach(),s.attached=!0,this.container.addChildAt(s.container,0))}_detachSubview(s){s?.attached&&(this.container.removeChild(s.container),s.detach(),s.attached=!1)}_getSubviewType(s){const e=s?.type;return"vector-field"===e?"rasterVF":"flow"===e?"flow":"raster"}};(0,M._)([(0,C.MZ)()],ve.prototype,"subview",void 0),(0,M._)([(0,C.MZ)()],ve.prototype,"useWebGLForProcessing",null),(0,M._)([(0,C.MZ)()],ve.prototype,"useProgressiveUpdate",null),(0,M._)([(0,C.MZ)({readOnly:!0})],ve.prototype,"displayParameters",null),ve=(0,M._)([(0,b.$)("esri.views.2d.layers.ImageryTileLayerView2D")],ve);const Lr=ve},96081:(ce,Q,f)=>{f.d(Q,{A:()=>U});var M=f(8189),j=f(35150),O=f(56492),F=f(48900),b=(f(3248),f(40707),f(5922),f(76576));const U=z=>{let G=class extends z{initialize(){this.addHandles((0,F.on)(()=>this.layer,"refresh",V=>{this.doRefresh(V.dataChanged).catch(H=>{(0,O.zf)(H)||j.A.getLogger(this).error(H)})}),"RefreshableLayerView")}};return G=(0,M._)([(0,b.$)("esri.views.layers.RefreshableLayerView")],G),G}},79061:(ce,Q,f)=>{f.d(Q,{H:()=>V});var M=f(10467),O=(f(3248),f(35150)),F=f(11432),C=f(32788),I=f(77440),x=f(50915),b=f(68165),U=f(17107),z=f(76169);class V{constructor(o,m,d=null){this._context=o,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,o.instanceCounter.increment(x.vt.FramebufferObject,this);const D=H(m)?m:new z.g(this._context,m);if(this._colorAttachments.set(x.Nm.COLOR_ATTACHMENT0,D),this._validateTextureDescriptor(D.descriptor),this._validateColorAttachmentPoint(x.Nm.COLOR_ATTACHMENT0),null!=d)if(function re(T){return H(T)||null!=T&&"pixelFormat"in T}(d))this._depthStencilTexture=H(d)?d:new z.g(this._context,d),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const S=function le(T){return null!=T&&"type"in T&&T.type===b.p.RenderBuffer}(d)?d:new U.l(this._context,d);this._depthStencilBuffer=S,this._validateRenderBufferDescriptor(S.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const o=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((m,d)=>this.detachColorTexture(d)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(o),this._context.instanceCounter.decrement(x.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(x.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(x.Nm.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(x.Nm.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((o,[m,d])=>o+d.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(o){const m=this._colorAttachments.get(o);return m&&H(m)?m:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(o,m=x.Nm.COLOR_ATTACHMENT0){o&&(this._validateColorAttachmentPoint(m),this._validateTextureDescriptor(o.descriptor),this.detachColorTexture(m)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(o.glName,m)),this._colorAttachments.set(m,o))}detachColorTexture(o=x.Nm.COLOR_ATTACHMENT0){const m=this._colorAttachments.get(o);if(m){if(this._initialized){const d=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,o),this._context.bindFramebuffer(d)}return this._colorAttachments.delete(o),m}}setColorTextureTarget(o,m=x.Nm.COLOR_ATTACHMENT0){const d=this._colorAttachments.get(m);d&&this._framebufferTexture2D(d.glName,m,o)}attachDepthStencil(o){if(o)switch(o.type){case b.p.Texture:return this._attachDepthStencilTexture(o);case b.p.RenderBuffer:return this._attachDepthStencilBuffer(o)}}_attachDepthStencilTexture(o){if(null==o)return;const m=o.descriptor;m.pixelFormat!==x.Ab.DEPTH_STENCIL&&m.pixelFormat!==x.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),m.dataType!==x.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(m),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(o.glName,x.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=o}detachDepthStencilTexture(){const o=this._depthStencilTexture;if(o&&this._initialized){const m=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,x.nI),this._context.bindFramebuffer(m)}return this._depthStencilTexture=null,o}_attachDepthStencilBuffer(o){if(null==o)return;const m=o.descriptor;if(this._validateRenderBufferDescriptor(m),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const d=this._context.gl,D=this._getGLAttachmentPoint(m);d.framebufferRenderbuffer(x.R.FRAMEBUFFER,D,d.RENDERBUFFER,o.glName)}this._depthStencilBuffer=o}detachDepthStencilBuffer(){const o=this._depthStencilBuffer;if(o&&this._initialized){const m=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const d=this._context.gl,D=this._getGLAttachmentPoint(o.descriptor);d.framebufferRenderbuffer(x.R.FRAMEBUFFER,D,d.RENDERBUFFER,null),this._context.bindFramebuffer(m)}return this._depthStencilBuffer=null,o}copyToTexture(o,m,d,D,S,l,c){(o<0||m<0||S<0||l<0)&&console.error("Offsets cannot be negative!"),(d<=0||D<=0)&&console.error("Copy width and height must be greater than zero!");const u=c.descriptor;c.descriptor.target!==x.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==u?.width||null==u?.height||o+d>this.width||m+D>this.height||S+d>u.width||l+D>u.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const g=this._context,p=g.bindTexture(c,z.g.TEXTURE_UNIT_FOR_UPDATES);g.setActiveTexture(z.g.TEXTURE_UNIT_FOR_UPDATES),g.bindFramebuffer(this),g.gl.copyTexSubImage2D(x.Ap.TEXTURE_2D,0,S,l,o,m,d,D),g.bindTexture(p,z.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(o,m,d,D,S,l,c){(d<=0||D<=0)&&console.error("Copy width and height must be greater than zero!"),c||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(o,m,d,D,S,l,c)}readPixelsAsync(o,m,d,D,S,l,c){var u=this;return(0,M.A)(function*(){const{gl:g}=u._context,p=C.g.createPixelPack(u._context,x._U.STREAM_READ,c.byteLength);u._context.bindBuffer(p);const _=u._context.getBoundFramebufferObject();u._context.bindFramebuffer(u),g.readPixels(o,m,d,D,S,l,0),u._context.unbindBuffer(x.NZ.PIXEL_PACK_BUFFER),u._context.bindFramebuffer(_),yield p.getSubDataAsync(c),p.dispose()})()}resize(o,m){if(this.width===o&&this.height===m)return;const d={width:o,height:m};B(d,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(D=>D.resize(d.width,d.height)),this._depthStencilTexture?.resize(d.width,d.height),this._initialized&&(B(d,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(d.width,d.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(o=x.R.FRAMEBUFFER){const m=this._context.gl;if(this._initialized)return void m.bindFramebuffer(o,this.glName);this._glName&&m.deleteFramebuffer(this._glName);const d=m.createFramebuffer();if(m.bindFramebuffer(o,d),this._colorAttachments.forEach((D,S)=>this._framebufferTexture2D(D.glName,S,E(D),o)),this._depthStencilBuffer){const D=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);m.framebufferRenderbuffer(o,D,m.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,m.DEPTH_STENCIL_ATTACHMENT,E(this._depthStencilTexture),o);(0,I.en)()&&m.checkFramebufferStatus(o)!==m.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=d,this._initialized=!0}_framebufferTexture2D(o,m=x.Nm.COLOR_ATTACHMENT0,d=x.Ap.TEXTURE_2D,D=x.R.FRAMEBUFFER,S=0){this._context.gl.framebufferTexture2D(D,m,d,o,S)}_disposeDepthStencilAttachments(){const o=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const m=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);o.framebufferRenderbuffer(x.R.FRAMEBUFFER,m,o.RENDERBUFFER,null)}this._depthStencilBuffer=(0,F.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,o.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,F.WD)(this._depthStencilTexture))}_validateTextureDescriptor(o){o.target!==x.Ap.TEXTURE_2D&&o.target!==x.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),B(o,this._context.parameters.maxTextureSize),this._validateBufferDimensions(o)}_validateRenderBufferDescriptor(o){B(o,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(o)}_validateBufferDimensions(o){o.width<=0&&(o.width=this.width),o.height<=0&&(o.height=this.height),this.width>0&&this.height>0&&(this.width===o.width&&this.height===o.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(o){switch(o.internalFormat){case x.yQ.DEPTH_COMPONENT16:case x.yQ.DEPTH_COMPONENT24:case x.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case x.yQ.DEPTH24_STENCIL8:case x.yQ.DEPTH32F_STENCIL8:case x.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case x.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(o){if(-1===V._MAX_COLOR_ATTACHMENTS){const{gl:d}=this._context;V._MAX_COLOR_ATTACHMENTS=d.getParameter(d.MAX_COLOR_ATTACHMENTS)}const m=o-x.Nm.COLOR_ATTACHMENT0;m+1>V._MAX_COLOR_ATTACHMENTS&&O.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${m+1}. Implementation supports up to ${V._MAX_COLOR_ATTACHMENTS} color attachments`)}}function H(T){return null!=T&&"type"in T&&T.type===b.p.Texture}function B(T,o){const m=Math.max(T.width,T.height);if(m>o){O.A.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${T.width}x${T.height} to device limit ${o}`);const d=o/m;return T.width=Math.round(T.width*d),T.height=Math.round(T.height*d),!1}return!0}function E(T){return T.descriptor.target===x.Ap.TEXTURE_CUBE_MAP?x.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:x.Ap.TEXTURE_2D}V._MAX_COLOR_ATTACHMENTS=-1},17107:(ce,Q,f)=>{f.d(Q,{l:()=>F});var M=f(50915),j=f(68165),O=f(49950);class F{constructor(I,x){this._context=I,this._descriptor=x,this.type=j.p.RenderBuffer,this._context.instanceCounter.increment(M.vt.Renderbuffer,this);const b=this._context.gl;this.glName=b.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:U,height:z,internalFormat:G,multisampled:V}=x;V?b.renderbufferStorageMultisample(b.RENDERBUFFER,this.samples,G,U,z):b.renderbufferStorage(b.RENDERBUFFER,G,U,z),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const I=this._descriptor.samples,x=this._context.parameters.maxSamples;return I?Math.min(I,x):x}get usedMemory(){return(0,O.e)(this._descriptor)}resize(I,x){const b=this._descriptor;if(b.width===I&&b.height===x)return;b.width=I,b.height=x;const U=this._context.gl;this._context.bindRenderbuffer(this),b.multisampled?U.renderbufferStorageMultisample(U.RENDERBUFFER,this.samples,b.internalFormat,b.width,b.height):U.renderbufferStorage(U.RENDERBUFFER,b.internalFormat,b.width,b.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(M.vt.Renderbuffer,this),this._context=null)}}},49950:(ce,Q,f)=>{f.d(Q,{e:()=>O,q:()=>j});var M=f(84757);class j{constructor(C,I,x=I){this.internalFormat=C,this.width=I,this.height=x,this.multisampled=!1,this.samples=1}}function O(F){return F.width<=0||F.height<=0||null==F.internalFormat?0:F.width*F.height*(0,M.IB)(F.internalFormat)}}}]);