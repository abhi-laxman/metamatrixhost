"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[302],{15584:(ee,Q,x)=>{x.d(Q,{b3:()=>R,jZ:()=>F});var z=x(71065),W=x(51995),A=x(83065),I=x(15268),b=x(61320),v=x(20914),E=x(58701);function F(D){return h(D,!0)}function R(D){return h(D,!1)}function h(D,g){if(null==D)return null;const n=D.spatialReference,o=(0,E.Vp)(n),_=z.A.isSerializable(D)?D.toJSON():D;if(!o)return _;const S=(0,E.K8)(n)?102100:4326,M=v.j7[S].maxX,j=v.j7[S].minX;if((0,b.fT)(_))return w(_,M,j);if((0,b.U9)(_))return _.points=_.points.map(L=>w(L,M,j)),_;if((0,b.ZC)(_))return function T(D,g){if(!g)return D;const n=function K(D,g){const n=[],{ymin:o,ymax:_,xmin:S,xmax:M}=D,j=D.xmax-D.xmin,[L,a]=g.valid,{x:c,frameId:i}=Z(D.xmin,g),{x:y,frameId:O}=Z(D.xmax,g),B=c===y&&j>0;if(j>2*a){const V={xmin:S<M?c:y,ymin:o,xmax:a,ymax:_},U={xmin:L,ymin:o,xmax:S<M?y:c,ymax:_},k={xmin:0,ymin:o,xmax:a,ymax:_},N={xmin:L,ymin:o,xmax:0,ymax:_},J=[],$=[];X(V,k)&&J.push(i),X(V,N)&&$.push(i),X(U,k)&&J.push(O),X(U,N)&&$.push(O);for(let te=i+1;te<O;te++)J.push(te),$.push(te);n.push(new G(V,[i]),new G(U,[O]),new G(k,J),new G(N,$))}else c>y||B?n.push(new G({xmin:c,ymin:o,xmax:a,ymax:_},[i]),new G({xmin:L,ymin:o,xmax:y,ymax:_},[O])):n.push(new G({xmin:c,ymin:o,xmax:y,ymax:_},[i]));return n}(D,g).map(o=>o.extent);return n.length<2?n[0]||D:n.length>2?(D.xmin=g.valid[0],D.xmax=g.valid[1],D):{rings:n.map(o=>[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]])}}(_,o);if((0,b.Bi)(_)||(0,b.Rg)(_)){const L=(0,A.Rg)(Y,_),a={xmin:L[0],ymin:L[1],xmax:L[2],ymax:L[3]},c=(0,v.kd)(a.xmin,j)*(2*M),i=0===c?_:(0,v.kS)(_,c);return a.xmin+=c,a.xmax+=c,a.xmax>M?P(i,M,g):a.xmin<j?P(i,j,g):i}return _}function w(D,g,n){if(Array.isArray(D)){const o=D[0];if(o>g){const _=(0,v.kd)(o,g);D[0]=o+_*(-2*g)}else if(o<n){const _=(0,v.kd)(o,n);D[0]=o+_*(-2*n)}}else{const o=D.x;if(o>g){const _=(0,v.kd)(o,g);D.x+=_*(-2*g)}else if(o<n){const _=(0,v.kd)(o,n);D.x+=_*(-2*n)}}return D}function Z(D,g){const[n,o]=g.valid,_=2*o;let S,M=0;return D>o?(S=Math.ceil(Math.abs(D-o)/_),D-=S*_,M=S):D<n&&(S=Math.ceil(Math.abs(D-n)/_),D+=S*_,M=-S),{x:D,frameId:M}}function X(D,g){const{xmin:n,ymin:o,xmax:_,ymax:S}=g;return C(D,n,o)&&C(D,n,S)&&C(D,_,S)&&C(D,_,o)}function C(D,g,n){return g>=D.xmin&&g<=D.xmax&&n>=D.ymin&&n<=D.ymax}function P(D,g,n=!0){const o=!(0,b.Rg)(D);if(o&&(0,I.m3)(D),n)return(new q).cut(D,g);const _=o?D.rings:D.paths,S=o?4:2,M=_.length,j=-2*g;for(let L=0;L<M;L++){const a=_[L];if(a&&a.length>=S){const c=[];for(const i of a)c.push([i[0]+j,i[1]]);_.push(c)}}return o?D.rings=_:D.paths=_,D}class G{constructor(g,n){this.extent=g,this.frameIds=n}}const Y=(0,W.vt)();class q{constructor(){this._linesIn=[],this._linesOut=[]}cut(g,n){let o;if(this._xCut=n,g.rings)this._closed=!0,o=g.rings,this._minPts=4;else{if(!g.paths)return null;this._closed=!1,o=g.paths,this._minPts=2}for(const S of o){if(!S||S.length<this._minPts)continue;let M=!0;for(const j of S)M?(this.moveTo(j),M=!1):this.lineTo(j);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),o=[];for(const S of this._linesIn)S&&S.length>=this._minPts&&o.push(S);const _=-2*this._xCut;for(const S of this._linesOut)if(S&&S.length>=this._minPts){for(const M of S)M[0]+=_;o.push(S)}return this._closed?g.rings=o:g.paths=o,g}moveTo(g){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(g[0]),this._moveTo(g[0],g[1],this._prevSide),this._prevPt=g,this._firstPt=g}lineTo(g){const n=this._side(g[0]);if(n*this._prevSide==-1){const o=this._intersect(this._prevPt,g);this._lineTo(this._xCut,o,0),this._prevSide=0,this._lineTo(g[0],g[1],n)}else this._lineTo(g[0],g[1],n);this._prevSide=n,this._prevPt=g}close(){const g=this._firstPt,n=this._prevPt;g[0]===n[0]&&g[1]===n[1]||this.lineTo(g),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(g,n,o){this._closed?(this._lineIn.push([o<=0?g:this._xCut,n]),this._lineOut.push([o>=0?g:this._xCut,n])):(o<=0&&this._lineIn.push([g,n]),o>=0&&this._lineOut.push([g,n]))}_lineTo(g,n,o){this._closed?(H(this._lineIn,o<=0?g:this._xCut,n),H(this._lineOut,o>=0?g:this._xCut,n)):o<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([g,n])):o>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([g,n])):this._prevSide<0?(this._lineIn.push([g,n]),this._lineOut.push([g,n])):this._prevSide>0&&(this._lineOut.push([g,n]),this._lineIn.push([g,n]))}_checkClosingPt(g){const n=g.length;n>3&&g[0][0]===this._xCut&&g[n-2][0]===this._xCut&&g[1][0]===this._xCut&&(g[0][1]=g[n-2][1],g.pop())}_side(g){return g<this._xCut?-1:g>this._xCut?1:0}_intersect(g,n){return g[1]+(this._xCut-g[0])/(n[0]-g[0])*(n[1]-g[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function H(D,g,n){const o=D.length;o>1&&D[o-1][0]===g&&D[o-2][0]===g?D[o-1][1]=n:D.push([g,n])}},45219:(ee,Q,x)=>{x.d(Q,{OP:()=>b,V4:()=>A,rZ:()=>I}),x(3248);var W=x(35150);function A(v,E,F){if(null==v)return null;const R=E.readArcadeFeature();E.contextTimeZone=F.$view?.timeZone;try{return v.evaluate({...F,$feature:R},v.services)}catch(h){return W.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",h),null}}function I(v){return null==v||v===1/0||v===-1/0||"number"==typeof v&&isNaN(v)}function b(v,E,F,R){if(null==v)return R??null;const h=E.readArcadeFeature();E.contextTimeZone=F.$view?.timeZone;const T=v.evaluate({...F,$feature:h},v.services);return I(T)?R??null:T}},6690:(ee,Q,x)=>{x.d(Q,{U:()=>F});var z=x(88258),W=x(10084);class I{get length(){return this._pos}constructor(h,T){this._pos=0;const w=T?this._roundToNearest(T,h.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(w),this._buffer=new h(this._array),this._ctor=h,this._i16View=new Int16Array(this._array)}_roundToNearest(h,T){const w=Math.round(h);return 1===T?w:w+(T-w%T)}_ensureSize(h){if(this._pos+h>=this._buffer.length){const T=this._roundToNearest(1.25*(this._array.byteLength+h*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),w=new ArrayBuffer(T),K=new this._ctor(w);K.set(this._buffer,0),this._array=w,this._buffer=K,this._i16View=new Int16Array(this._array)}}ensureSize(h){this._ensureSize(h)}writeF32(h){this._ensureSize(1);const T=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=h,this._pos++,T}push(h){this._ensureSize(1);const T=this._pos;return this._buffer[this._pos++]=h,T}writeFixed(h){this._buffer[this._pos++]=h}setValue(h,T){this._buffer[h]=T}i1616Add(h,T,w){this._i16View[2*h]+=T,this._i16View[2*h+1]+=w}getValue(h){return this._buffer[h]}getValueF32(h){return new Float32Array(this._array,4*h,1)[0]}incr(h){if(this._buffer.length<h)throw new Error("Increment index overflows the target buffer");this._buffer[h]++}decr(h){this._buffer[h]--}writeRegion(h){this._ensureSize(h.length);const T=this._pos;return this._buffer.set(h,this._pos),this._pos+=h.length,T}writeManyFrom(h,T,w){this._ensureSize(w-T);for(let K=T;K!==w;K++)this.writeFixed(h._buffer[K])}buffer(){const h=this._array.slice(0,4*this._pos);return this.destroy(),h}toArray(){return[...this._buffer]}seek(h){this._pos=h}destroy(){this._array=null,this._buffer=null}}class E{constructor(h,T,w=0){const K=6*w*Uint32Array.BYTES_PER_ELEMENT,Z=4*w*T.stride,X=T.stride/4,C=T.attributes.find(P=>"pos"===P.name||"position"===P.name);if(!C)throw new Error("InternalError: Unable to find position attribute");this.layout={...T,position:C},this._indices=new I(Uint32Array,K),this._vertices=new I(Uint32Array,Z),this._metrics=new I(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=X,this._instanceId=h}serialize(h){const T=this._indices.buffer(),w=this._vertices.buffer(),K=this._metrics.length?this._metrics.buffer():null;return h.push(T,w),{instanceId:this._instanceId,layout:this.layout,indices:T,vertices:w,metrics:K}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(h){this._vertices.ensureSize(h)}indexEnsureSize(h){this._indices.ensureSize(h)}writeIndex(h){this._indices.push(h)}writeVertex(h){this._vertices.push(h)}writeVertexRegion(h){this._vertices.writeRegion(h)}writeVertexF32(h){this._vertices.writeF32(h)}writeMetric(h){this._metrics.incr(this._metricCountOffset),h.serialize(this._metrics)}}class F{constructor(h,T=0){this._id=h,this._sizeHint=T,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._didEntityStart=!1,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new I(Uint32Array,this._sizeHint*z.A.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const h=new Array,T=[],w=this._entities.buffer();for(const K of this._instanceIdToVertexData.values())T.push(K.serialize(h));return{message:{data:T,entities:w},transferList:h}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(h){this._current.writer.vertexEnsureSize(h)}indexEnsureSize(h){this._current.writer.indexEnsureSize(h)}vertexWrite(h){this._current.writer.writeVertex(h)}vertexWriteRegion(h){this._current.writer.writeVertexRegion(h)}vertexWriteF32(h){this._current.writer.writeVertexF32(h)}recordBounds(h,T,w,K){}indexWrite(h){this._current.writer.writeIndex(h)}metricStart(h){this._current.metric=h}metricEnd(){this._current.metric.bounds.length&&this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(h){this._current.metric.bounds.push(h)}entityStart(h,T=h){this._entityIdIndex=this._entities.push(h),this._entitySortKeyIndex=this._entities.writeF32(T),this._entityRecordCountOffset=this._entities.push(0),this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(h,T,w=0){this._current.writer=this._getVertexWriter(h,T),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=h,this._current.layoutHash=T.hash,this._current.textureKey=w}recordEnd(h=0){const T=this._current.vertexStart,w=this._current.writer.vertexCount-T;if(!w)return!1;const K=this._current.indexStart,Z=this._current.writer.indexCount-K;return this._recordIndexStart=K,this._recordIndexCount=Z,this._recordVertexStart=T,this._recordVertexCount=w,this._entities.incr(this._entityRecordCountOffset),W.A.write(this._entities,this._current.instanceId,this._current.textureKey,K,Z,T,w,h),!0}copyLast(h,T){const w=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),W.A.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,w,this._recordVertexCount,0);const K=this._current.writer.indexWriter,Z=this._current.writer.vertexWriter,X=this._recordIndexStart+this._recordIndexCount,C=this._recordVertexCount;for(let o=this._recordIndexStart;o!==X;o++){const _=K.getValue(o);K.push(_+C)}const P=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,Y=(this._recordVertexStart+this._recordVertexCount)*P;for(let o=this._recordVertexStart*P;o!==Y;o++){const _=Z.getValue(o);Z.push(_)}const q=this._current.writer.layout.position,H=q.packPrecisionFactor??1,D=q.offset/Uint32Array.BYTES_PER_ELEMENT,g=h*H,n=T*H;for(let o=w*P;o<=Z.length;o+=P)Z.i1616Add(o+D,g,n)}copyLastFrom(h,T,w){const K=h._entities.getValue(h._entityIdIndex);if(K!==this._entities.getValue(this._entityIdIndex)){const _=h._entities.getValueF32(h._entitySortKeyIndex);this.entityStart(K,_)}this.recordStart(h._current.instanceId,h._current.writer.layout,h._current.textureKey);const Z=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,X=this._current.vertexStart,C=h._current.vertexStart-X,P=this._current.writer.indexWriter,G=this._current.writer.vertexWriter,Y=h._current.writer.indexWriter,q=h._current.writer.vertexWriter;for(let _=h._current.indexStart;_!==Y.length;_++){const S=Y.getValue(_);P.push(S-C)}for(let _=h._current.vertexStart*Z;_!==q.length;_++){const S=q.getValue(_);G.push(S)}const H=this._current.writer.layout.position,D=H.packPrecisionFactor??1,g=H.offset/Uint32Array.BYTES_PER_ELEMENT,n=T*D,o=w*D;for(let _=X*Z;_<=G.length;_+=Z)G.i1616Add(_+g,n,o);this.recordEnd()}_getVertexWriter(h,T){const w=this._instanceIdToVertexData;return w.has(h)||w.set(h,new E(h,T,this._sizeHint)),w.get(h)}}},86220:(ee,Q,x)=>{x.d(Q,{J:()=>b});var z=x(10467),W=x(1119),A=x(39473);class I{}class b extends I{constructor(E){super(),this._fetcher=E,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(E){const F=(0,A.I)(E.resource),R=(0,W.Wm)(JSON.stringify(F));return this._pendingIds.has(R)||(this._pendingIds.add(R),this._pendingRequests.push({...E,resourceId:R})),R}fetchEnqueuedResources(){var E=this;return(0,z.A)(function*(){const F=E._pendingRequests;if(E._pendingIds.clear(),E._pendingRequests=[],0===F.length)return;const R=yield E._fetcher.fetch(F,E._abortOptions);for(let h=0;h<R.length;h++)E._resourceIdToResource.set(F[h].resourceId,R[h])})()}fetchResourceImmediate(E){var F=this;return(0,z.A)(function*(){const R=yield F._fetcher.fetch([E],F._abortOptions);if(1!==R.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return R[0]})()}fetchDictionaryResourceImmediate(E){var F=this;return(0,z.A)(function*(){const R=yield F._fetcher.fetchDictionary([E],F._abortOptions);if(1!==R.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return R[0]})()}getResource(E){return this._resourceIdToResource.get(E)}}},39473:(ee,Q,x)=>{function z(W){return"url"in W&&"urlHash"in W?{...W,url:""}:W}x.d(Q,{I:()=>z})},54661:(ee,Q,x)=>{x.d(Q,{Z:()=>A});var z=x(42086),W=x(2846);class A{getObjectId(b){return b.getObjectId()}getAttributes(b){return b.readAttributes()}getAttribute(b,v){return b.readAttribute(v)}getAttributeAsTimestamp(b,v){return b.readAttributeAsTimestamp(v)}cloneWithGeometry(b,v){const E=b.readAttributes(),F=new z.Om(v,E,null,b.getObjectId(),b.getDisplayId()),R=W.K.fromOptimizedFeatures([F],b.metadata);return R.setIndex(0),R}getGeometry(b){return b.readGeometryWorldSpace()}getCentroid(b,v){return b.readCentroidForDisplay()}}A.Shared=new A},32197:(ee,Q,x)=>{x.d(Q,{L:()=>z});class z{destroy(){}}},10903:(ee,Q,x)=>{x.d(Q,{K:()=>D});var z=x(10467),W=x(5922),A=x(3248),I=x(35150),b=x(48237),v=x(48218),E=x(47669),F=x(53212),R=x(24370),h=x(90731);class K{constructor(n){this.data=n,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class Z{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(n){let o=this._objectIdToDisplayId.get(n);return o?o.increment():(o=new K((0,F.Ss)(this._getFreeId(),!1)),o.increment(),this._objectIdToDisplayId.set(n,o)),o.data}releaseIdForObjectId(n){const o=this._objectIdToDisplayId.get(n);o&&(o.decrement(),o.empty()&&(this._objectIdToDisplayId.delete(n),this._freeIds.push(o.data)))}getDisplayIdForObjectId(n){const o=this._objectIdToDisplayId.get(n);return null!=o?o.data:null}releaseAll(){for(const n of this._objectIdToDisplayId.values())this._freeIds.push(n.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var X=x(52828),C=x(50915);const G=()=>I.A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),Y=(!1,G(),()=>null),q_sharedArrayBuffer=(0,A.A)("esri-shared-array-buffer");(0,A.A)("esri-atomics");class H{constructor(n,o,_){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:S,layout:M,textureOnly:j}=o;this.textureOnly=j||!1,this.pixelType=S,this.layout=M,this._resetRange(),this.size=n,this.isLocal=_,j||(this.data=this._initData(S,n))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(n,o){const _=this.data;for(let S=0;S<this.size*this.size;S++)_[S*this.texelSize+n]&=~o;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(n,o){const _=this.data;for(let S=0;S<this.size*this.size;S++)_[S*this.texelSize+n]|=255&o;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(n,o,_){const S=this.data;for(const M of _)S[M*this.texelSize+n]|=o,this.dirtyStart=Math.min(this.dirtyStart,M),this.dirtyEnd=Math.max(this.dirtyEnd,M)}setComponentTexel(n,o,_){this.data[_*this.texelSize+n]|=o,this.dirtyStart=Math.min(this.dirtyStart,_),this.dirtyEnd=Math.max(this.dirtyEnd,_)}unsetComponentTexel(n,o,_){this.data[_*this.texelSize+n]&=~o,this.dirtyStart=Math.min(this.dirtyStart,_),this.dirtyEnd=Math.max(this.dirtyEnd,_)}getData(n,o){const _=(0,F.Q4)(n);return this.data[_*this.texelSize+o]}setData(n,o,_){const S=(0,F.Q4)(n);this.layout&1<<o?null!=this.data&&(this.data[S*this.texelSize+o]=_,this.dirtyStart=Math.min(this.dirtyStart,S),this.dirtyEnd=Math.max(this.dirtyEnd,S)):G().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(n){if(this.size=n,!this.textureOnly){const o=this._initData(this.pixelType,n);o.set(this.data),this.data=o}}toMessage(){const n=this.dirtyStart,o=this.dirtyEnd,_=this.texelSize;if(n>o)return null;this._resetRange();const M=this.pixelType,j=this.layout;return{start:n,end:o,data:!this.isLocal&&this.data.slice(n*_,(o+1)*_)||null,pixelType:M,layout:j}}_initData(n,o){const _=ArrayBuffer,S=(0,R.Qz)(n),M=new S(new _(o*o*4*S.BYTES_PER_ELEMENT));for(let j=0;j<M.length;j+=4)M[j+1]=255;return M}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class D{constructor(n){this._client=n,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=E.TB,this._idsToHighlight=new Map,this._arcadeDependencies=new Set,this._initialized=!1,this.version=0,this._idGenerator=new Z,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const n=C.ld.FLOAT;Y(`Creating AttributeStore ${q_sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:C.ld.UNSIGNED_BYTE,layout:1},{pixelType:C.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:C.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:n,layout:15},{pixelType:n,layout:15},{pixelType:n,layout:15},{pixelType:n,layout:15},{pixelType:C.ld.FLOAT,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(n){return this._idGenerator.createIdForObjectId(n)}releaseDisplayIdForObjectId(n){return this._idGenerator.releaseIdForObjectId(n)}getDisplayIdForObjectId(n){return this._idGenerator.getDisplayIdForObjectId(n)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}hasArcadeDependency(n){return this._arcadeDependencies.has(n)}releaseAllIds(){this._idGenerator.releaseAll()}update(n,o,_,S=0){var M=this;return(0,z.A)(function*(){const j=(0,b.Ui)(M._schema,n);if(M.version=S,j&&((0,A.A)("esri-2d-update-debug")&&console.debug(`Version[${S}] AttributeStore.update`,{changed:j}),M._schema=n,M._attributeComputeInfo=null,M._initialize(),null!=n))if(_&&(M._filters=yield Promise.all(n.filters.map(L=>L?X.A.create({geometryType:_.geometryType,hasM:!1,hasZ:!1,timeInfo:_.timeInfo,fieldsIndex:_.fieldsIndex,spatialReference:_.outSpatialReference,filterJSON:L}):null))),"multi"!==n.type)M._attributeComputeInfo={type:"feature",map:new Map},yield Promise.all(n.bindings.map(function(){var L=(0,z.A)(function*(a){const c=yield M._bind(o,a);M._updateReferences(c)});return function(a){return L.apply(this,arguments)}}()));else{M._attributeComputeInfo={type:"multi",keyField:n.keyField,map:new Map};for(const L in n.bindings){const a=n.bindings[L];yield Promise.all(a.map(function(){var c=(0,z.A)(function*(i){const y=yield M._bind(o,i,parseInt(L,10));M._updateReferences(y)});return function(i){return c.apply(this,arguments)}}()))}}})()}setHighlight(n,o){const _=this._getBlock(0);_.unsetComponentAllTexels(0,(1<<E.U5)-1);for(const{displayId:S,highlightFlags:M}of n){if(null==S)continue;const j=(0,F.Q4)(S);_.setComponent(0,M,[j])}this._idsToHighlight.clear();for(const{objectId:S,highlightFlags:M}of n)this._idsToHighlight.set(S,M);for(const{objectId:S,highlightFlags:M}of o)this._idsToHighlight.set(S,M)}setData(n,o,_,S){const M=(0,F.Q4)(n);this._ensureSizeForTexel(M),this._getBlock(o).setData(n,_,S)}getData(n,o,_){return this._getBlock(o).getData(n,_)}getHighlightFlags(n){return this._idsToHighlight.get(n)||0}unsetAttributeData(n){const o=(0,F.Q4)(n);this._getBlock(0).setData(o,0,0)}setAttributeData(n,o,_,S){const M=(0,F.Q4)(n);this._ensureSizeForTexel(M),this._getBlock(0).setData(M,0,this.getFilterFlags(o,S));const j=this._attributeComputeInfo;let c=null;j&&(c="multi"===j.type?j.map.get(o.readAttribute(j.keyField)):j.map,c?.size&&c.forEach((i,y)=>{const O=1*y%4,B=Math.floor(1*y/4),V=this._getBlock(B+E.dV.VV);let U=i.field?.read(o,_);i.valueRepresentation&&(U=function P(g,n){if(!g||!n)return g;switch(n){case"radius":case"distance":return 2*g;case"diameter":case"width":return g;case"area":return Math.sqrt(g)}return g}(U,i.valueRepresentation)),(null===U||isNaN(U)||U===1/0||U===-1/0)&&(U=h.qM),V.setData(M,O,U)}))}get epoch(){return this._epoch}sendUpdates(){const n=this._blocks.map(_=>null!=_?_.toMessage():null),o=this._getInitArgs();(0,A.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),this._client.update({initArgs:o,blockData:n,version:this.version,sendUpdateEpoch:this._epoch}),this._epoch+=1,(0,A.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(n){for(;n>=this._size*this._size;)if(this._expand())return}_bind(n,o,_){var S=this;return(0,z.A)(function*(){const M=yield n.createComputedField(o),{valueRepresentation:j}=o,L=S._attributeComputeInfo;if("multi"===L.type){const a=L.map.get(_)??new Map;a.set(o.binding,{field:M,valueRepresentation:j}),L.map.set(_,a)}else L.map.set(o.binding,{field:M,valueRepresentation:j});return M})()}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(E.dV.Animation),this._getBlock(E.dV.GPGPU),this._getBlock(E.dV.LocalTimeOrigin),{blockSize:this._size,blockDescriptors:this._blocks.map(n=>null!=n?{textureOnly:n.textureOnly,buffer:n.buffer,pixelType:n.pixelType}:null)})}_getBlock(n){const o=this._blocks[n];if(null!=o)return o;Y(`Initializing AttributeBlock at index ${n}`);const _=new H(this._size,this._blockDescriptors[n],this._client.isLocal);return this._blocks[n]=_,this._initialized=!1,_}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const n=this._size<<=1;Y("Expanding block size to",n,this._blocks);for(const o of this._blocks)o?.expand(n);return this._initialized=!1,this._size=n,0}return G().error(new W.A("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateReferences(n){(0,v.QY)(this._arcadeDependencies,n)}isVisible(n){return!!(this._getBlock(0).getData(n,0)&1<<E.U5)}getFilterFlags(n,o){let _=0;for(let M=0;M<this._filters.length;M++){const L=this._filters[M];_|=(1<<M&&null!=L&&!L.check(n,o)?0:1)<<M}let S=0;if(this._idsToHighlight.size){const M=n.getObjectId();S=this.getHighlightFlags(M)}return _<<E.U5|S}}},85452:(ee,Q,x)=>{x.d(Q,{l:()=>a});var z=x(10467),W=x(5922),A=x(35150),I=x(2296),b=x(53212),v=x(32197);class E extends v.L{constructor(i){super(),this._field=i}resize(i){throw new Error("Method not implemented.")}read(i,y){return i.readAttribute(this._field)}readWithDefault(i,y){return i.readAttribute(this._field)}hasArcadeDependency(i){return!1}}var F=x(1119),R=x(48218),h=x(45219);class w extends v.L{static create(i,y){return(0,z.A)(function*(){const O=yield(0,R.Ad)(i,y.spatialReference,y.fields),B=(0,F.Wm)(i);return new w(O,B)})()}constructor(i,y){super(),this._compiled=i,this._cacheKey=y}resize(i){}read(i,y){return this.hasArcadeDependency("scale")||"system"!==y.$view.timeZone?(0,h.V4)(this._compiled,i,y):this._readCached(i,y)}readWithDefault(i,y,O){return this.hasArcadeDependency("scale")||"system"!==y.$view.timeZone?(0,h.OP)(this._compiled,i,y,O):this._readWithDefaultCached(i,y,O)}hasArcadeDependency(i){return this._compiled?.references(i)??!1}_getCacheKey(i){if(!this._compiled?.references("timeProperties"))return this._cacheKey;const{currentStart:y,currentEnd:O}=i.$view.timeProperties;return this._cacheKey+function T(c,i){const y=43758.5453*Math.sin(12.9898*c+78.233*i);return y-Math.floor(y)}(y??1,O??1)}_readCached(i,y){if(i.setCache(this._getCacheKey(y)),i.hasCachedValue())return i.getCachedValue();const O=(0,h.V4)(this._compiled,i,y);return i.setCachedValue(O),O}_readWithDefaultCached(i,y,O){if(i.setCache(this._getCacheKey(y)),i.hasCachedValue())return i.getCachedValue();const B=(0,h.OP)(this._compiled,i,y,O);return i.setCachedValue(B),B}}var K=x(48266),Z=x(68479),X=x(54444),C=x(86300),P=x(4858);class n extends v.L{static create(i,y){return(0,z.A)(function*(){const O=(0,P.lc)(i);return new n(B=>O.replaceAll(/{[^}]*}/g,V=>{const U=V.slice(1,-1),k=B.metadata.fieldsIndex.get(U);if(null==k)return V;const N=B.readAttribute(U);return null==N?"":function g(c,i){if(null==c)return"";const y=i.domain;if(y)if("codedValue"===y.type||"coded-value"===y.type){const B=c;for(const V of y.codedValues)if(V.code===B)return V.name}else if("range"===y.type){const{max:B,min:V}=(0,X.A5)(i),U=+c;if(null!=V&&null!=B&&V<=U&&U<=B)return y.name}let O=c;return(0,C.vE)(i)?O=(0,K.Yq)(O,(0,K.J2)("short-date")):(0,C.WA)(i)&&(O=(0,Z.ZV)(+O)),O||""}(N,k)}))})()}constructor(i){super(),this._evaluator=i}resize(i){}read(i,y){return this._evaluator(i)}readWithDefault(i,y,O){const B=this._evaluator(i);return(0,h.rZ)(B)?O:B}hasArcadeDependency(i){return!1}}class o extends v.L{constructor(i,y){super(),this._field=i,this._normalizationInfo=y}resize(i){throw new Error("Method not implemented.")}read(i,y){return this._readNormalized(i)}readWithDefault(i,y){return this._readNormalized(i)}hasArcadeDependency(i){return!1}_readNormalized(i){const y=i.readAttribute(this._field);if(null==y)return null;const{normalizationField:O,normalizationTotal:B,normalizationType:V}=this._normalizationInfo,U=i.readAttribute(O);switch(V??"esriNormalizeByField"){case"esriNormalizeByField":return U?U?y/U:void 0:null;case"esriNormalizeByLog":return Math.log(y)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return B?y/B*100:null}}}var _=x(42178),S=x(96845);const M=()=>A.A.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),j=4294967295;function L(c,i,y){if(!(c.length>i))for(;c.length<=i;)c.push(y)}class a{constructor(i){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=i}createBitset(){const i=this._bitsets.length;return this._bitsets.push(_.y.create(this._allocatedSize,b.KQ)),i+1}createComputedField(i,y=!1){var O=this;return(0,z.A)(function*(){if(i.expression)try{if(!O.compilationOptions)throw new Error("InternalError: Compilation options not defined");return y?yield n.create(i.expression,O.compilationOptions):yield w.create(i.expression,O.compilationOptions)}catch(V){const U=new W.A("featurelayer","Failed to compile arcade expression",{error:V,expression:i.expression});return M().error(U),null}if(i.normalizationType||i.normalizationField)return new o(i.field,i);if(i.field)return new E(i.field);const B=new W.A("featurelayer","Unable to create computed field. No expression or field found",{info:i});return M().error(B),null})()}createWhereClause(i){var y=this;return(0,z.A)(function*(){return i?(0,S.$)(i,y.compilationOptions.fields):null})()}getBitset(i){return this._bitsets[i-1]}getComputedNumeric(i,y){return this.getComputedNumericAtIndex(i&b.KQ,0)}setComputedNumeric(i,y,O){return this.setComputedNumericAtIndex(i&b.KQ,O,0)}getComputedString(i,y){return this.getComputedStringAtIndex(i&b.KQ,0)}setComputedString(i,y,O){return this.setComputedStringAtIndex(i&b.KQ,0,O)}getComputedNumericAtIndex(i,y){const O=i&b.KQ;return this._ensureNumeric(y,O),this._numerics[y][O]}setComputedNumericAtIndex(i,y,O){const B=i&b.KQ;this._ensureNumeric(y,B),this._numerics[y][B]=O}getPackedChunkId(i){const y=i&b.KQ;return this._ensureInstanceId(y),this._instanceIds[y]}setPackedChunkId(i,y){const O=i&b.KQ;this._ensureInstanceId(O),this._instanceIds[O]=y}getComputedStringAtIndex(i,y){const O=i&b.KQ;return this._ensureString(y,O),this._strings[y][O]}setComputedStringAtIndex(i,y,O){const B=i&b.KQ;this._ensureString(y,B),this._strings[y][B]=O}getXMin(i){return this._bounds[4*(i&b.KQ)]}getYMin(i){return this._bounds[4*(i&b.KQ)+1]}getXMax(i){return this._bounds[4*(i&b.KQ)+2]}getYMax(i){return this._bounds[4*(i&b.KQ)+3]}setBounds(i,y,O=!1){const B=i&b.KQ;if(!O&&!this._dirtyBitset.has(i))return this._bounds[4*B]!==j;this._dirtyBitset.unset(i);const V=y.readGeometryWorldSpace();if(L(this._bounds,4*B+4,0),!V||!V.coords.length)return this._bounds[4*B]=j,this._bounds[4*B+1]=j,this._bounds[4*B+2]=j,this._bounds[4*B+3]=j,!1;let U=1/0,k=1/0,N=-1/0,J=-1/0;return V.forEachVertex(($,te)=>{U=Math.min(U,$),k=Math.min(k,te),N=Math.max(N,$),J=Math.max(J,te)}),this._bounds[4*B]=U,this._bounds[4*B+1]=k,this._bounds[4*B+2]=N,this._bounds[4*B+3]=J,!0}getBounds(i,y){const O=this.getXMin(y),B=this.getYMin(y),V=this.getXMax(y),U=this.getYMax(y);return(0,I.BI)(i,O,B,V,U),O!==j}_ensureNumeric(i,y){this._numerics[i]||(this._numerics[i]=[]),L(this._numerics[i],y,0)}_ensureInstanceId(i){L(this._instanceIds,i,0)}_ensureString(i,y){this._strings[i]||(this._strings[i]=[]),L(this._strings[i],y,null)}}},52828:(ee,Q,x)=>{x.d(Q,{A:()=>Z});var z=x(10467),W=x(5922),A=x(35150),I=x(51995),b=x(83065),v=x(871),E=x(18633),F=x(76980),R=x(87086),h=x(54661),T=x(96845);class Z{constructor(C){this._geometryBounds=(0,I.vt)(),this._idToVisibility=new Map,this._serviceInfo=C}static create(C){return(0,z.A)(function*(){const P=new Z(C);return yield P.update(C.filterJSON,C.spatialReference),P})()}get hash(){return this._hash}check(C,P){return this._applyFilter(C,P)}invalidate(){this._idToVisibility.forEach((C,P)=>{this._idToVisibility.set(P,0)})}setKnownIds(C){for(const P of C)this._idToVisibility.set(P,1)}setTrue(C){const P=[],G=[],Y=new Set(C);return this._idToVisibility.forEach((q,H)=>{const D=!!(1&this._idToVisibility.get(H)),g=Y.has(H);!D&&g?P.push(H):D&&!g&&G.push(H),this._idToVisibility.set(H,g?3:0)}),{show:P,hide:G}}createQuery(){const{geometry:C,spatialRel:P,where:G,timeExtent:Y,objectIds:q}=this;return R.A.fromJSON({geometry:C,spatialRel:P,where:G,timeExtent:Y,objectIds:q})}update(C,P){var G=this;return(0,z.A)(function*(){G._hash=JSON.stringify(C);const Y=yield(0,v.T2)(C,null,P);yield Promise.all([G._setGeometryFilter(Y),G._setIdFilter(Y),G._setAttributeFilter(Y),G._setTimeFilter(Y)])})()}_setAttributeFilter(C){var P=this;return(0,z.A)(function*(){if(!C?.where)return P._clause=null,void(P.where=null);P._clause=yield(0,T.$)(C.where,P._serviceInfo.fieldsIndex),P.where=C.where})()}_setIdFilter(C){this._idsToShow=C?.objectIds&&new Set(C.objectIds),this._idsToHide=C?.hiddenIds&&new Set(C.hiddenIds),this.objectIds=C?.objectIds}_setGeometryFilter(C){var P=this;return(0,z.A)(function*(){if(!C?.geometry)return P._spatialQueryOperator=null,P.geometry=null,void(P.spatialRel=null);const G=C.geometry,Y=C.spatialRel??"esriSpatialRelIntersects",q=yield(0,E.xt)(Y,G,P._serviceInfo.geometryType,P._serviceInfo.hasZ,P._serviceInfo.hasM);(0,b.Rg)(P._geometryBounds,G),P._spatialQueryOperator=q,P.geometry=G,P.spatialRel=Y})()}_setTimeFilter(C){if(this.timeExtent=this._timeOperator=null,C?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=C.timeExtent,this._timeOperator=(0,F.I)(this._serviceInfo.timeInfo,C.timeExtent,h.Z.Shared);else{const P=new W.A("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",C.timeExtent);A.A.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(P)}}_applyFilter(C,P){return this._filterByGeometry(C)&&this._filterById(C)&&this._filterByTime(C)&&this._filterByExpression(C,P)}_filterByExpression(C,P){return!this.where||this._clause(C,P)}_filterById(C){return(!this._idsToHide?.size||!this._idsToHide.has(C.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(C.getObjectId()))}_filterByGeometry(C){if(!this.geometry)return!0;const P=C.readGeometryWorldSpace();return!!P&&this._spatialQueryOperator(P)}_filterByTime(C){return null==this._timeOperator||this._timeOperator(C)}}},34650:(ee,Q,x)=>{x.d(Q,{h:()=>I,i:()=>A});var z=x(32034),W=x(73258);class A{static minimal(v,E,F=[]){return new A({geometryType:v,fieldsIndex:new W.A(F).toJSON(),objectIdField:E,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null})}static createFeature(v){return new A(v)}constructor(v){this._options=v,this._fieldsIndex=W.A.fromJSON(v.fieldsIndex),v.spatialReference&&(this._spatialReference=z.A.fromJSON(v.spatialReference)),v.outSpatialReference&&(this._outSpatialReference=z.A.fromJSON(v.outSpatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0,datesInUnknownTimezone:this._options.timeReferenceUnknownClient??void 0,dateFieldsTimeZone:this._options.dateFieldsTimeZone??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get outSpatialReference(){return this._outSpatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}weakCloneWithAdditionalFields(v){return new A({fieldsIndex:{fields:[...this._fieldsIndex.fields,...v],timeZoneByFieldName:null},geometryType:this.geometryType,globalIdField:this.globalIdField,objectIdField:this.objectIdField,spatialReference:this.spatialReference,outSpatialReference:this.outSpatialReference,subtypeField:this.subtypeField,subtypes:this._options.subtypes,timeInfo:this.timeInfo,timeReferenceUnknownClient:this.timeReferenceUnknownClient,dateFieldsTimeZone:this._options.dateFieldsTimeZone,typeIdField:this._options.typeIdField,types:this._options.types})}}class I extends A{static createGraphics(v){return new I({fieldsIndex:(new W.A).toJSON(),objectIdField:"uid",geometryType:null,spatialReference:v,outSpatialReference:v,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null})}}},54977:(ee,Q,x)=>{x.d(Q,{P:()=>W});var z=x(42178);class W{constructor(I){this._valid=z.y.create(I),this._data=new Array(I)}has(I){return this._valid.has(I)}set(I,b){this._valid.set(I),this._data[I]=b}get(I){return this._data[I]}}},27420:(ee,Q,x)=>{x.d(Q,{Y:()=>j});var z=x(61299),W=x(3248),A=x(87257),I=x(29752),b=x(72137),v=x(2296),E=x(61320),F=x(13259),R=x(721),h=x(27999),T=x(31732),w=x(42086),K=x(13682),Z=x(20543),X=x(54977);const C=(0,W.A)("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],P=C[0],G=C[1],Y=C[2],q=C[3],H=(0,W.A)("featurelayer-simplify-payload-size-factors")??[1,2,4],D=H[0],g=H[1],n=H[2],o=(0,W.A)("featurelayer-simplify-mobile-factor")??2,_=(0,W.A)("esri-mobile"),S=4294967295;class j{constructor(a){this.metadata=a,this.type="FeatureSetReader",this._overrides=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}getAreaSimplificationThreshold(a,c){let i=1;const y=_?o:1;c>4e6?i=n*y:c>1e6?i=g*y:c>5e5?i=D*y:c>1e5&&(i=y);let O=0;return a>4e3?O=q*i:a>2e3?O=Y*i:a>100?O=G:a>15&&(O=P),O}getBounds(a){if(function M(L,a,c){if(!(L.length>a))for(;L.length<=a;)L.push(c)}(this._boundsBuffer,4*this.getIndex()+4,0),this.getBoundsXMin()===S)return!1;if(0===this.getBoundsXMin()){const B=this.readGeometryWorldSpace();if(!B)return this.setBoundsXMin(S),!1;let V=1/0,U=1/0,k=-1/0,N=-1/0;return B.forEachVertex((J,$)=>{V=Math.min(V,J),U=Math.min(U,$),k=Math.max(k,J),N=Math.max(N,$)}),this.setBoundsXMin(V),this.setBoundsYMin(U),this.setBoundsXMax(k),this.setBoundsYMax(N),(0,v.BI)(a,V,U,k,N),!0}const c=this.getBoundsXMin(),i=this.getBoundsYMin(),y=this.getBoundsXMax(),O=this.getBoundsYMax();return(0,v.BI)(a,c,i,y,O),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(a){this._boundsBuffer[4*this.getIndex()]=a}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(a){this._boundsBuffer[4*this.getIndex()+1]=a}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(a){this._boundsBuffer[4*this.getIndex()+2]=a}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(a){this._boundsBuffer[4*this.getIndex()+3]=a}readAttributeAsTimestamp(a){const c=this.readAttribute(a);return"string"==typeof c?new Date(c).getTime():"number"==typeof c||null==c?c:null}readAttribute(a,c=!1){const i=this._readAttribute(a,c);if(void 0!==i)return i;for(const y of this._joined){y.setIndex(this.getIndex());const O=y._readAttribute(a,c);if(void 0!==O)return O}}readAttributes(){const a=this._readAttributes();for(const c of this._joined){c.setIndex(this.getIndex());const i=c._readAttributes();for(const y of Object.keys(i))a[y]=i[y]}return a}joinAttributes(a){this._joined.push(a)}registerOverrides(a){this._overrides=a}withoutOverrides(){const a=this.copy();return a._overrides=null,a}readOptimizedFeatureWorldSpace(){const a=this.readGeometryWorldSpace(),c=this.readAttributes(),i=this.readCentroidWorldSpace();return new w.Om(a,c,i,this.getObjectId(),this.getDisplayId())}readLegacyFeatureForDisplay(){const a=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(a&&{x:a.coords[0],y:a.coords[1]})??null}}readLegacyFeatureWorldSpace(){const a=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(a&&{x:a.coords[0],y:a.coords[1]})??null}}readLegacyGeometryForDisplay(){const a=this.readGeometryForDisplay();return(0,T.zv)(a,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const a=this._readX(),c=this.getInTransform();return null==c?a:a*c.scale[0]+c.translate[0]}readYWorldSpace(){const a=this._readY(),c=this.getInTransform();return null==c?a:c.translate[1]-a*c.scale[1]}readGeometryForDisplay(){const a=this._readGeometryDeltaDecoded(!0);if(!a){const c=this._createDeltaQuantizedGeometryFromServerCentroid();return c?c.deltaDecode():null}return a}readGeometryForDisplayTransformed(a){let c=this.readGeometryForDisplay();if(c&&(c=(0,T.hK)(c,a,this.metadata.geometryType,this.hasZ,this.hasM)),!c){const i=this.readCentroidForDisplay();if(!i)return null;const y=(0,R.IE)(a,i.coords[0]),O=(0,R.B2)(a,i.coords[1]);return this._createDeltaQuantizedExtrudedGeometry(y,O).deltaDecode()}return c}readGeometryWorldSpace(){let a=this._readGeometry();if(a||(a=this._createDeltaQuantizedGeometryFromServerCentroid()),!a)return null;const c=a.clone(),i=this.getInTransform();return null!=i&&(0,T.Ch)(c,c,this.hasZ,this.hasM,i),c}readCentroidForDisplay(){const a=this.readGeometryForDisplay();return a?this._computeDisplayCentroid(a):this._readServerCentroid()}readCentroidWorldSpace(){const a=this.readGeometryForDisplay(),c=a?this._computeDisplayCentroid(a):this._readServerCentroid();if(!c)return null;const i=c.clone(),y=this.getInTransform();return null!=y&&(0,T.Ch)(i,i,this.hasZ,this.hasM,y),i}setCache(a){let c=this._caches.get(a);null==c&&(c=new X.P(this.getSize()),this._caches.set(a,c)),this._activeCache=c}setCachedValue(a){this._activeCache.set(this.getIndex(),a)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(a){const c=this._readGeometry(a);return"esriGeometryPoint"!==this.geometryType&&c&&this.getInTransform()?c.deltaDecode():c}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(a){this._contextTimeZone=a}readArcadeFeature(){return this}hasField(a){return this.fields.has(a)||this._joined.some(c=>c.hasField(a))}geometry(){const a=this.readGeometryWorldSpace(),c=(0,T.zv)(a,this.geometryType,this.hasZ,this.hasM),i=(0,E.rS)(c);if(i){if(!this.metadata.outSpatialReference)throw new Error("InternalError: Expected spatial reference to be defined");i.spatialReference=this.metadata.outSpatialReference}return i}autocastArcadeDate(a,c){return c&&c instanceof Date?this.isUnknownDateTimeField(a)?z.lY.unknownDateJSToArcadeDate(c):z.lY.dateJSAndZoneToArcadeDate(c,this.contextTimeZone??Z.qU):c}isUnknownDateTimeField(a){return this.metadata.fieldsIndex.getTimeZone(a)===Z.L5}field(a){let c=this.fields.get(a);if(c)switch(c.type){case"date-only":case"esriFieldTypeDateOnly":return A.n.fromReader(this.readAttribute(a,!1));case"time-only":case"esriFieldTypeTimeOnly":return I.k.fromReader(this.readAttribute(a,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return z.lY.fromReaderAsTimeStampOffset(this.readAttribute(a,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(a,this.readAttribute(a,!0));default:return this.readAttribute(a,!1)}for(const i of this._joined)if(i.setIndex(this.getIndex()),c=i.fields.get(a),c)switch(c.type){case"date-only":case"esriFieldTypeDateOnly":return A.n.fromReader(i._readAttribute(a,!1));case"time-only":case"esriFieldTypeTimeOnly":return I.k.fromReader(i._readAttribute(a,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return z.lY.fromReaderAsTimeStampOffset(i._readAttribute(a,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(a,i._readAttribute(a,!0));default:return this.readAttribute(a,!1)}throw new Error(`Field ${a} does not exist`)}setField(a,c){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map(a=>a.name)}castToText(a=!1){if(!a)return JSON.stringify(this.readLegacyFeatureForDisplay());const c=this.readLegacyFeatureForDisplay();if(!c)return JSON.stringify(null);const i={geometry:c.geometry,attributes:{...c.attributes??{}}};for(const y in i.attributes){const O=i.attributes[y];O instanceof Date&&(i.attributes[y]=O.getTime())}return JSON.stringify(i)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(a=null){return{attributes:this._readAttributes(),geometry:!0===a?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(a=null,c=null){return Promise.resolve(this.castAsJson(c))}_getExists(){if(this._overrides){const a=this.getObjectId();return!this._overrides.hasOverride(a)}return!0}_computeDisplayCentroid(a){if(null==this.getInTransform())return(0,h.Q)(new K.A,a,this.hasM,this.hasZ);const c=b.z.fromOptimized(a,this.geometryType);c.yFactor*=-1;const i=(0,F.d)(c);return i?(i[1]*=-1,new K.A([],i)):null}copyInto(a){a._joined=this._joined,a._overrides=this._overrides,a._objectIdToIndex=this._objectIdToIndex,a._boundsBuffer=this._boundsBuffer,a._activeCache=this._activeCache,a._caches=this._caches,a._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const a=this.readGeometryWorldSpace();return(0,T.zv)(a,this.geometryType,!1,!1)}_createDeltaQuantizedGeometryFromServerCentroid(){const a=this._readServerCentroid();if(!a)return null;const[c,i]=a.coords;return this._createDeltaQuantizedExtrudedGeometry(c,i)}_createDeltaQuantizedExtrudedGeometry(a,c){return"esriGeometryPolyline"===this.geometryType?this._createDeltaQuantizedExtrudedLine(a,c):this._createDeltaQuantizedExtrudedQuad(a,c)}_createDeltaQuantizedExtrudedQuad(a,c){return new K.A([5],[a-1,c,1,-1,1,1,-1,1,-1,-1])}_createDeltaQuantizedExtrudedLine(a,c){return new K.A([2],[a-1,c+1,1,-1])}}},2846:(ee,Q,x)=>{x.d(Q,{K:()=>b});var z=x(31732),W=x(42086),A=x(73258),I=x(27420);class b extends I.Y{static fromFeatures(E,F){const{objectIdField:R,geometryType:h}=F,T=(0,z.Di)([],E,h,!1,!1,R);for(let w=0;w<T.length;w++)T[w].displayId=E[w].displayId;return b.fromOptimizedFeatures(T,F)}static fromFeatureSet(E,F){const R=(0,z.q3)(E,F.objectIdField);return b.fromOptimizedFeatureSet(R,F)}static fromOptimizedFeatureSet(E,F){const R=b.fromOptimizedFeatures(E.features,F);return R._exceededTransferLimit=E.exceededTransferLimit,R._transform=E.transform,R._fieldsIndex=new A.A(E.fields),R}static fromOptimizedFeatures(E,F,R){const h=new b(E,F);return h._fieldsIndex=F.fieldsIndex,h._transform=R,h}static empty(E){return new b([],E)}constructor(E,F){super(F),this._exceededTransferLimit=!1,this._featureIndex=-1,this._fieldsIndex=null,this._geometryType=F.geometryType,this._features=E}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}get usedMemory(){return this._current.usedMemory}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let E="";for(const F in this._current.attributes)E+=this._current.attributes[F];return E}getIndex(){return this._featureIndex}setIndex(E){this._featureIndex=E}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(E){this._current.displayId=E}copy(){const E=new b(this._features,this.metadata);return this.copyInto(E),E}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return(0,W.N3)(this._current)?(0,z.Rk)(this._current.geometry,2):0}_readX(){return(0,W.N3)(this._current)?this._current.geometry.coords[0]:0}_readY(){return(0,W.N3)(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return(0,W.N3)(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(E,F){if(!this._fieldsIndex){const T=this._current.attributes[E];if(void 0!==T)return T;const w=E.toLowerCase();for(const K in this._current.attributes)if(K.toLowerCase()===w)return this._current.attributes[K];return}const R=this._fieldsIndex.get(E);if(!R)return;const h=this._current.attributes[R.name];return null==h?h:F&&this.fields.isDateField(E)?new Date(h):h}_readAttributes(){return this._current.attributes}copyInto(E){super.copyInto(E),E._featureIndex=this._featureIndex,E._transform=this._transform,E._fieldsIndex=this._fieldsIndex}}},42178:(ee,Q,x)=>{x.d(Q,{y:()=>z});class z{static fromBuffer(A,I){return new z(A,I)}static create(A,I=4294967295){const b=new Uint32Array(Math.ceil(A/32));return new z(b,I)}constructor(A,I){this._mask=0,this._buf=A,this._mask=I}_getIndex(A){return Math.floor(A/32)}has(A){const I=this._mask&A;return!!(this._buf[this._getIndex(I)]&1<<I%32)}hasRange(A,I){let b=A,v=I;for(;b%32&&b!==v;){if(this.has(b))return!0;b++}for(;v%32&&b!==v;){if(this.has(b))return!0;v--}if(b===v)return!1;for(let E=b/32;E!==v/32;E++)if(this._buf[E])return!0;return!1}set(A){const I=this._mask&A,b=this._getIndex(I);this._buf[b]|=1<<I%32}setRange(A,I){let b=A,v=I;for(;b%32&&b!==v;)this.set(b++);for(;v%32&&b!==v;)this.set(v--);if(b!==v)for(let E=b/32;E!==v/32;E++)this._buf[E]=4294967295}unset(A){const I=this._mask&A,b=this._getIndex(I);this._buf[b]&=4294967295^1<<I%32}resize(A){const I=this._buf,b=new Uint32Array(Math.ceil(A/32));b.set(I),this._buf=b}or(A){for(let I=0;I<this._buf.length;I++)this._buf[I]|=A._buf[I];return this}and(A){for(let I=0;I<this._buf.length;I++)this._buf[I]&=A._buf[I];return this}xor(A){for(let I=0;I<this._buf.length;I++)this._buf[I]^=A._buf[I];return this}ior(A){for(let I=0;I<this._buf.length;I++)this._buf[I]|=~A._buf[I];return this}iand(A){for(let I=0;I<this._buf.length;I++)this._buf[I]&=~A._buf[I];return this}ixor(A){for(let I=0;I<this._buf.length;I++)this._buf[I]^=~A._buf[I];return this}any(){for(let A=0;A<this._buf.length;A++)if(this._buf[A])return!0;return!1}copy(A){for(let I=0;I<this._buf.length;I++)this._buf[I]=A._buf[I];return this}clone(){return new z(this._buf.slice(),this._mask)}clear(){for(let A=0;A<this._buf.length;A++)this._buf[A]=0;return this}forEachSet(A){for(let I=0;I<this._buf.length;I++){let b=this._buf[I],v=32*I;if(b)for(;b;)1&b&&A(v),b>>>=1,v++}}countSet(){let A=0;return this.forEachSet(I=>{A++}),A}}},96845:(ee,Q,x)=>{x.d(Q,{$:()=>E});var z=x(10467),W=x(5922),A=x(35150),I=x(63484);const b=()=>A.A.getLogger("esri.views.2d.layers.FeatureLayerView2D"),v={getAttribute:(R,h)=>R.readAttribute(h)};function E(R,h){return F.apply(this,arguments)}function F(){return(F=(0,z.A)(function*(R,h){try{const T=yield(0,I.GP)(R,h);return T.isStandardized||b().error(new W.A("sql-parse-error","expression is not standardized",{where:R})),(w,K)=>{const Z=w.readArcadeFeature();try{return T.testFeatureCompiled(Z,v,K.currentUser)}catch(X){return b().warn(new W.A("sql-runtime-error","Encountered an error when evaluating where clause",{where:R,error:X})),!0}}}catch(T){return b().warn(new W.A("sql-runtime-error","Encountered an error when evaluating where clause",{where:R,error:T})),w=>!0}})).apply(this,arguments)}}}]);