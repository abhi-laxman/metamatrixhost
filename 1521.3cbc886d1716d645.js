"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[1521],{94095:(zt,st,se)=>{se.d(st,{C:()=>oe,a:()=>Te,b:()=>de});var re=se(65152),De=se(85340),Se=se(35955),Oe=se(94804),ge=se(65840),ce=se(24493),Be=se(35089),Ye=se(79595),je=se(70938),Ie=se(43713);class oe extends je.Y{constructor(){super(...arguments),this.opacity=1}}function de(Pe){const xe=new Ie.N5;xe.include(re.c),xe.fragment.uniforms.add(new Be.N("tex",ve=>ve.texture)),Pe.hasOpacityFactor&&xe.fragment.uniforms.add(new ge.m("opacity",ve=>ve.opacity));const He=Pe.blitMode===Ye.d.Depth;return He&&(xe.fragment.uniforms.add(new Oe.E("nearFar",ve=>ve.camera.nearFar)),xe.fragment.include(De.E),xe.fragment.include(Se.W)),xe.fragment.main.add(ce.H`
    ${He?ce.H`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:ce.H`
          fragColor = texture(tex, uv) ${Pe.hasOpacityFactor?"* opacity":""};`}`),xe}const Te=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:oe,build:de},Symbol.toStringTag,{value:"Module"}))},44827:(zt,st,se)=>{se.d(st,{I:()=>ve,a:()=>xe,b:()=>He});var re=se(74567),De=se(29359),Se=se(93877),Oe=se(70094),ge=se(51734),ce=se(71781),Be=se(7741),Ye=se(65840),je=se(24493),Ie=se(35089),oe=se(40972),de=se(18597),Te=se(70938),Pe=se(43713);class xe extends Te.Y{}function He(ye){const he=new Pe.N5,{vertex:pe,fragment:fe}=he,{output:me,perspectiveInterpolation:Me}=ye;return(0,Be.NB)(pe,ye),he.include(Se.d,ye),he.include(ge.Z,ye),he.fragment.include(De.HQ,ye),he.include(Oe.g,ye),he.include(de.z,ye),he.attributes.add(oe.r.POSITION,"vec3"),he.attributes.add(oe.r.UV0,"vec2"),Me&&he.attributes.add(oe.r.PERSPECTIVEDIVIDE,"float"),pe.main.add(je.H`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${(0,je.If)(Me,"gl_Position *= perspectiveDivide;")}`),he.varyings.add("vpos","vec3"),he.varyings.add("vTexCoord","vec2"),fe.include(ce.a),fe.uniforms.add(new Ye.m("opacity",qe=>qe.opacity),new Ie.N("tex",qe=>qe.texture)).main.add(je.H`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${(0,je.If)(me===re.V.ObjectAndLayerIdColor,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos);`),he}const ve=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:xe,build:He},Symbol.toStringTag,{value:"Module"}))},32677:(zt,st,se)=>{se.d(st,{L:()=>ve,b:()=>Pe});var re=se(92771),De=se(62789),Se=se(83953),Oe=se(45475),ge=se(42474),ce=se(94804),Be=se(82374),Ye=se(65840),je=se(24493),Ie=se(50765),oe=se(57887),de=se(40972),Te=se(43713);function Pe(ye){const he=new Te.N5;he.include(ge.K,ye);const{vertex:pe,fragment:fe}=he;pe.uniforms.add(new oe.X("modelView",(Me,{camera:qe})=>(0,re.Tl)(He,qe.viewMatrix,Me.origin)),new Ie.F("proj",({camera:Me})=>Me.projectionMatrix),new Ye.m("glowWidth",(Me,{camera:qe})=>Me.glowWidth*qe.pixelRatio),new ce.E("pixelToNDC",({camera:Me})=>(0,Se.hZ)(xe,2/Me.fullViewport[2],2/Me.fullViewport[3]))),he.attributes.add(de.r.START,"vec3"),he.attributes.add(de.r.END,"vec3"),ye.spherical&&(he.attributes.add(de.r.START_UP,"vec3"),he.attributes.add(de.r.END_UP,"vec3")),he.attributes.add(de.r.EXTRUDE,"vec2"),he.varyings.add("uv","vec2"),he.varyings.add("vViewStart","vec3"),he.varyings.add("vViewEnd","vec3"),he.varyings.add("vViewSegmentNormal","vec3"),he.varyings.add("vViewStartNormal","vec3"),he.varyings.add("vViewEndNormal","vec3");const me=!ye.spherical;return pe.main.add(je.H`
    vec3 pos = mix(start, end, extrude.x);

    vec4 viewPos = modelView * vec4(pos, 1);
    vec4 projPos = proj * viewPos;
    vec2 ndcPos = projPos.xy / projPos.w;

    // in planar we hardcode the up vectors to be Z-up */
    ${(0,je.If)(me,je.H`vec3 startUp = vec3(0, 0, 1);`)}
    ${(0,je.If)(me,je.H`vec3 endUp = vec3(0, 0, 1);`)}

    // up vector corresponding to the location of the vertex, selecting either startUp or endUp */
    vec3 up = extrude.y * mix(startUp, endUp, extrude.x);
    vec3 viewUp = (modelView * vec4(up, 0)).xyz;

    vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
    vec2 projUp = normalize(projPosUp.xy / projPosUp.w - ndcPos);

    // extrude ndcPos along projUp to the edge of the screen
    vec2 lxy = abs(sign(projUp) - ndcPos);
    ndcPos += length(lxy) * projUp;

    vViewStart = (modelView * vec4(start, 1)).xyz;
    vViewEnd = (modelView * vec4(end, 1)).xyz;

    vec3 viewStartEndDir = vViewEnd - vViewStart;

    vec3 viewStartUp = (modelView * vec4(startUp, 0)).xyz;

    // the normal of the plane that aligns with the segment and the up vector
    vViewSegmentNormal = normalize(cross(viewStartUp, viewStartEndDir));

    // the normal orthogonal to the segment normal and the start up vector
    vViewStartNormal = -normalize(cross(vViewSegmentNormal, viewStartUp));

    // the normal orthogonal to the segment normal and the end up vector
    vec3 viewEndUp = (modelView * vec4(endUp, 0)).xyz;
    vViewEndNormal = normalize(cross(vViewSegmentNormal, viewEndUp));

    // Add enough padding in the X screen space direction for "glow"
    float xPaddingPixels = sign(dot(vViewSegmentNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
    ndcPos.x += xPaddingPixels * pixelToNDC.x;

    // uv is used to read back depth to reconstruct the position at the fragment
    uv = ndcPos * 0.5 + 0.5;

    gl_Position = vec4(ndcPos, 0, 1);
  `),fe.uniforms.add(new Be.U("perScreenPixelRatio",Me=>Me.camera.perScreenPixelRatio)),fe.code.add(je.H`float planeDistance(vec3 planeNormal, vec3 planeOrigin, vec3 pos) {
return dot(planeNormal, pos - planeOrigin);
}
float segmentDistancePixels(vec3 segmentNormal, vec3 startNormal, vec3 endNormal, vec3 pos, vec3 start, vec3 end) {
float distSegmentPlane = planeDistance(segmentNormal, start, pos);
float distStartPlane = planeDistance(startNormal, start, pos);
float distEndPlane = planeDistance(endNormal, end, pos);
float dist = max(max(distStartPlane, distEndPlane), abs(distSegmentPlane));
float width = fwidth(distSegmentPlane);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}`),fe.main.add(je.H`fragColor = vec4(0.0);
vec3 dEndStart = vViewEnd - vViewStart;
if (dot(dEndStart, dEndStart) < 1e-5) {
return;
}
vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
return;
}
float distance = segmentDistancePixels(
vViewSegmentNormal,
vViewStartNormal,
vViewEndNormal,
pos,
vViewStart,
vViewEnd
);
vec4 color = laserlineProfile(distance);
float alpha = (1.0 - smoothstep(0.995 - angleCutoffAdjust, 0.999 - angleCutoffAdjust, abs(dot(normal, vViewSegmentNormal))));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);`),he}const xe=(0,Oe.vt)(),He=(0,De.vt)(),ve=Object.freeze(Object.defineProperty({__proto__:null,build:Pe},Symbol.toStringTag,{value:"Module"}))},72254:(zt,st,se)=>{se.d(st,{L:()=>Et,b:()=>me,d:()=>fe});var re=se(69287),De=se(83953),Se=se(45475),Oe=se(28714),ge=se(25866),ce=se(53781),Be=se(89141),Ye=se(71548),je=se(93617),Ie=se(83989),oe=se(42474),de=se(65152),Te=se(99286),Pe=se(58021),xe=se(88791),He=se(18356),ve=se(82374),ye=se(65840),he=se(24493),pe=se(43713);const fe=(0,re.kU)(6);function me($e){const Dt=new pe.N5;Dt.include(de.c),Dt.include(oe.K,$e);const ke=Dt.fragment;if($e.lineVerticalPlaneEnabled||$e.heightManifoldEnabled)if(ke.uniforms.add(new ye.m("maxPixelDistance",(Ze,tt)=>$e.heightManifoldEnabled?2*tt.camera.computeScreenPixelSizeAt(Ze.heightManifoldTarget):2*tt.camera.computeScreenPixelSizeAt(Ze.lineVerticalPlaneSegment.origin))),ke.code.add(he.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),$e.spherical){const Ze=(At,kt,Ht)=>(0,Oe.t)(At,kt.heightManifoldTarget,Ht.camera.viewMatrix),tt=(At,kt)=>(0,Oe.t)(At,[0,0,0],kt.camera.viewMatrix);ke.uniforms.add(new He.E("heightManifoldOrigin",(At,kt)=>(Ze(Ue,At,kt),tt(ft,kt),(0,Oe.d)(ft,ft,Ue),(0,Oe.n)(lt,ft),lt[3]=(0,Oe.l)(ft),lt)),new Pe.d("globalOrigin",At=>tt(Ue,At)),new ye.m("cosSphericalAngleThreshold",(At,kt)=>1-Math.max(2,(0,Oe.j)(kt.camera.eye,At.heightManifoldTarget)*kt.camera.perRenderPixelRatio)/(0,Oe.l)(At.heightManifoldTarget))),ke.code.add(he.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else ke.code.add(he.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if($e.pointDistanceEnabled&&(ke.uniforms.add(new ye.m("maxPixelDistance",(Ze,tt)=>2*tt.camera.computeScreenPixelSizeAt(Ze.pointDistanceTarget))),ke.code.add(he.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),$e.intersectsLineEnabled&&ke.uniforms.add(new ve.U("perScreenPixelRatio",Ze=>Ze.camera.perScreenPixelRatio)).code.add(he.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`),($e.lineVerticalPlaneEnabled||$e.intersectsLineEnabled)&&ke.code.add(he.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),ke.main.add(he.H`vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
fragColor = vec4(0.0);
return;
}
vec4 color = vec4(0.0);`),$e.heightManifoldEnabled){ke.uniforms.add(new Te.G("angleCutoff",tt=>Me(tt)),new He.E("heightPlane",(tt,At)=>Ee(tt.heightManifoldTarget,tt.renderCoordsHelper.worldUpAtPosition(tt.heightManifoldTarget,Ue),At.camera.viewMatrix)));const Ze=$e.spherical?he.H`normalize(globalOrigin - pos)`:he.H`heightPlane.xyz`;ke.main.add(he.H`
      vec2 angleCutoffAdjusted = angleCutoff - angleCutoffAdjust;
      // Fade out laserlines on flat surfaces
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoffAdjusted.x, angleCutoffAdjusted.y, abs(dot(normal, ${Ze})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);`)}return $e.pointDistanceEnabled&&(ke.uniforms.add(new Te.G("angleCutoff",Ze=>Me(Ze)),new He.E("pointDistanceSphere",(Ze,tt)=>function qe($e,Dt){return(0,Oe.t)((0,Ie.a)(mt),$e.pointDistanceOrigin,Dt.camera.viewMatrix),mt[3]=(0,Oe.j)($e.pointDistanceOrigin,$e.pointDistanceTarget),mt}(Ze,tt))),ke.main.add(he.H`float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);`)),$e.lineVerticalPlaneEnabled&&(ke.uniforms.add(new Te.G("angleCutoff",Ze=>Me(Ze)),new He.E("lineVerticalPlane",(Ze,tt)=>function Xe($e,Dt){const ke=(0,Ye.sd)($e.lineVerticalPlaneSegment,.5,Ue),Ze=$e.renderCoordsHelper.worldUpAtPosition(ke,Kt),tt=(0,Oe.n)(ft,$e.lineVerticalPlaneSegment.vector),At=(0,Oe.e)(Ue,Ze,tt);return(0,Oe.n)(At,At),Ee($e.lineVerticalPlaneSegment.origin,At,Dt.camera.viewMatrix)}(Ze,tt)),new xe.t("lineVerticalStart",(Ze,tt)=>function gt($e,Dt){const ke=(0,Oe.c)(Ue,$e.lineVerticalPlaneSegment.origin);return $e.renderCoordsHelper.setAltitude(ke,0),(0,Oe.t)(ke,ke,Dt.camera.viewMatrix)}(Ze,tt)),new xe.t("lineVerticalEnd",(Ze,tt)=>function dt($e,Dt){const ke=(0,Oe.g)(Ue,$e.lineVerticalPlaneSegment.origin,$e.lineVerticalPlaneSegment.vector);return $e.renderCoordsHelper.setAltitude(ke,0),(0,Oe.t)(ke,ke,Dt.camera.viewMatrix)}(Ze,tt))),ke.main.add(he.H`if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}`)),$e.intersectsLineEnabled&&(ke.uniforms.add(new Te.G("angleCutoff",Ze=>Me(Ze)),new xe.t("intersectsLineStart",(Ze,tt)=>(0,Oe.t)(Ue,Ze.lineStartWorld,tt.camera.viewMatrix)),new xe.t("intersectsLineEnd",(Ze,tt)=>(0,Oe.t)(Ue,Ze.lineEndWorld,tt.camera.viewMatrix)),new xe.t("intersectsLineDirection",(Ze,tt)=>((0,Oe.c)(lt,Ze.intersectsLineSegment.vector),lt[3]=0,(0,Oe.n)(Ue,(0,ce.t)(lt,lt,tt.camera.viewMatrix)))),new ye.m("intersectsLineRadius",Ze=>Ze.intersectsLineRadius)),ke.main.add(he.H`if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}`)),ke.main.add(he.H`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);`),Dt}function Me($e){return(0,De.hZ)(ut,Math.cos($e.angleCutoff),Math.cos(Math.max(0,$e.angleCutoff-(0,re.kU)(2))))}function Ee($e,Dt,ke){return(0,Oe.t)(xt,$e,ke),(0,Oe.c)(lt,Dt),lt[3]=0,(0,ce.t)(lt,lt,ke),(0,je.O_)(xt,lt,qi)}const ut=(0,Se.vt)(),Ue=(0,ge.vt)(),lt=(0,Be.vt)(),Kt=(0,ge.vt)(),ft=(0,ge.vt)(),xt=(0,ge.vt)(),qi=(0,je.vt)(),mt=(0,Ie.c)(),Et=Object.freeze(Object.defineProperty({__proto__:null,build:me,defaultAngleCutoff:fe},Symbol.toStringTag,{value:"Module"}))},62938:(zt,st,se)=>{se.d(st,{S:()=>ve,b:()=>Pe});var re=se(89141),De=se(74687),Se=se(29359),Oe=se(93877),ge=se(51734),ce=se(71781),Be=se(7741),Ye=se(88791),je=se(18356),Ie=se(24493),oe=se(40972),de=se(18597),Te=se(43713);function Pe(ye){const he=new Te.N5;he.include(Oe.d,ye),he.include(De.L,ye),he.fragment.include(Se.HQ,ye),he.include(de.z,ye),he.include(ge.Z,ye);const{vertex:pe,fragment:fe}=he;return fe.include(ce.a),(0,Be.NB)(pe,ye),fe.uniforms.add(new je.E("uColor",me=>me.color)),he.attributes.add(oe.r.POSITION,"vec3"),he.varyings.add("vWorldPosition","vec3"),ye.screenSizeEnabled&&he.attributes.add(oe.r.OFFSET,"vec3"),ye.shadingEnabled&&((0,Be.S7)(pe),he.attributes.add(oe.r.NORMAL,"vec3"),he.varyings.add("vViewNormal","vec3"),fe.uniforms.add(new Ye.t("shadingDirection",me=>me.shadingDirection)),fe.uniforms.add(new je.E("shadedColor",me=>function xe(ye,he){const pe=1-ye[3],fe=ye[3]+he[3]*pe;return 0===fe?(He[3]=fe,He):(He[0]=(ye[0]*ye[3]+he[0]*he[3]*pe)/fe,He[1]=(ye[1]*ye[3]+he[1]*he[3]*pe)/fe,He[2]=(ye[2]*ye[3]+he[2]*he[3]*pe)/fe,He[3]=he[3],He)}(me.shadingTint,me.color)))),pe.main.add(Ie.H`
      vWorldPosition = ${ye.screenSizeEnabled?Ie.H`screenSizeScaling(offset, position)`:Ie.H`position`};
      ${ye.shadingEnabled?Ie.H`vec3 worldNormal = normal;
                 vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`:""}
      forwardViewPosDepth((view * vec4(vWorldPosition, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vWorldPosition);
  `),fe.main.add(Ie.H`
      discardBySlice(vWorldPosition);
      discardByTerrainDepth();
      ${ye.shadingEnabled?Ie.H`vec3 viewNormalNorm = normalize(vViewNormal);
             float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
             vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`:Ie.H`vec4 finalColor = uColor;`}
      outputColorHighlightOID(finalColor, vWorldPosition);`),he}const He=(0,re.vt)(),ve=Object.freeze(Object.defineProperty({__proto__:null,build:Pe},Symbol.toStringTag,{value:"Module"}))},53868:(zt,st,se)=>{se.d(st,{S:()=>Ye,b:()=>Be});var re=se(7741),De=se(18356),Se=se(65840),Oe=se(24493),ge=se(40972),ce=se(43713);function Be(je){const Ie=new ce.N5,{vertex:oe,fragment:de,attributes:Te,varyings:Pe}=Ie;return(0,re.NB)(oe,je),Te.add(ge.r.POSITION,"vec3"),Te.add(ge.r.UV0,"vec2"),Pe.add("vUV","vec2"),oe.main.add(Oe.H`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),de.uniforms.add(new De.E("backgroundColor",xe=>xe.backgroundColor),new De.E("gridColor",xe=>xe.gridColor),new Se.m("gridWidth",xe=>xe.gridWidth)).main.add(Oe.H`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),Ie}const Ye=Object.freeze(Object.defineProperty({__proto__:null,build:Be},Symbol.toStringTag,{value:"Module"}))},55144:(zt,st,se)=>{se.d(st,{T:()=>re,d:()=>He});const re={Base64:0,Hex:1,String:2,Raw:3},De=8,Se=(1<<De)-1;function Oe(ve,ye){const he=(65535&ve)+(65535&ye);return(ve>>16)+(ye>>16)+(he>>16)<<16|65535&he}function Ie(ve,ye,he,pe,fe,me){return Oe(function je(ve,ye){return ve<<ye|ve>>>32-ye}(Oe(Oe(ye,ve),Oe(pe,me)),fe),he)}function oe(ve,ye,he,pe,fe,me,Me){return Ie(ye&he|~ye&pe,ve,ye,fe,me,Me)}function de(ve,ye,he,pe,fe,me,Me){return Ie(ye&pe|he&~pe,ve,ye,fe,me,Me)}function Te(ve,ye,he,pe,fe,me,Me){return Ie(ye^he^pe,ve,ye,fe,me,Me)}function Pe(ve,ye,he,pe,fe,me,Me){return Ie(he^(ye|~pe),ve,ye,fe,me,Me)}function He(ve,ye=re.Hex){const he=ye||re.Base64,pe=function xe(ve,ye){ve[ye>>5]|=128<<ye%32,ve[14+(ye+64>>>9<<4)]=ye;let he=1732584193,pe=-271733879,fe=-1732584194,me=271733878;for(let Me=0;Me<ve.length;Me+=16){const qe=he,Xe=pe,gt=fe,dt=me;he=oe(he,pe,fe,me,ve[Me],7,-680876936),me=oe(me,he,pe,fe,ve[Me+1],12,-389564586),fe=oe(fe,me,he,pe,ve[Me+2],17,606105819),pe=oe(pe,fe,me,he,ve[Me+3],22,-1044525330),he=oe(he,pe,fe,me,ve[Me+4],7,-176418897),me=oe(me,he,pe,fe,ve[Me+5],12,1200080426),fe=oe(fe,me,he,pe,ve[Me+6],17,-1473231341),pe=oe(pe,fe,me,he,ve[Me+7],22,-45705983),he=oe(he,pe,fe,me,ve[Me+8],7,1770035416),me=oe(me,he,pe,fe,ve[Me+9],12,-1958414417),fe=oe(fe,me,he,pe,ve[Me+10],17,-42063),pe=oe(pe,fe,me,he,ve[Me+11],22,-1990404162),he=oe(he,pe,fe,me,ve[Me+12],7,1804603682),me=oe(me,he,pe,fe,ve[Me+13],12,-40341101),fe=oe(fe,me,he,pe,ve[Me+14],17,-1502002290),pe=oe(pe,fe,me,he,ve[Me+15],22,1236535329),he=de(he,pe,fe,me,ve[Me+1],5,-165796510),me=de(me,he,pe,fe,ve[Me+6],9,-1069501632),fe=de(fe,me,he,pe,ve[Me+11],14,643717713),pe=de(pe,fe,me,he,ve[Me],20,-373897302),he=de(he,pe,fe,me,ve[Me+5],5,-701558691),me=de(me,he,pe,fe,ve[Me+10],9,38016083),fe=de(fe,me,he,pe,ve[Me+15],14,-660478335),pe=de(pe,fe,me,he,ve[Me+4],20,-405537848),he=de(he,pe,fe,me,ve[Me+9],5,568446438),me=de(me,he,pe,fe,ve[Me+14],9,-1019803690),fe=de(fe,me,he,pe,ve[Me+3],14,-187363961),pe=de(pe,fe,me,he,ve[Me+8],20,1163531501),he=de(he,pe,fe,me,ve[Me+13],5,-1444681467),me=de(me,he,pe,fe,ve[Me+2],9,-51403784),fe=de(fe,me,he,pe,ve[Me+7],14,1735328473),pe=de(pe,fe,me,he,ve[Me+12],20,-1926607734),he=Te(he,pe,fe,me,ve[Me+5],4,-378558),me=Te(me,he,pe,fe,ve[Me+8],11,-2022574463),fe=Te(fe,me,he,pe,ve[Me+11],16,1839030562),pe=Te(pe,fe,me,he,ve[Me+14],23,-35309556),he=Te(he,pe,fe,me,ve[Me+1],4,-1530992060),me=Te(me,he,pe,fe,ve[Me+4],11,1272893353),fe=Te(fe,me,he,pe,ve[Me+7],16,-155497632),pe=Te(pe,fe,me,he,ve[Me+10],23,-1094730640),he=Te(he,pe,fe,me,ve[Me+13],4,681279174),me=Te(me,he,pe,fe,ve[Me],11,-358537222),fe=Te(fe,me,he,pe,ve[Me+3],16,-722521979),pe=Te(pe,fe,me,he,ve[Me+6],23,76029189),he=Te(he,pe,fe,me,ve[Me+9],4,-640364487),me=Te(me,he,pe,fe,ve[Me+12],11,-421815835),fe=Te(fe,me,he,pe,ve[Me+15],16,530742520),pe=Te(pe,fe,me,he,ve[Me+2],23,-995338651),he=Pe(he,pe,fe,me,ve[Me],6,-198630844),me=Pe(me,he,pe,fe,ve[Me+7],10,1126891415),fe=Pe(fe,me,he,pe,ve[Me+14],15,-1416354905),pe=Pe(pe,fe,me,he,ve[Me+5],21,-57434055),he=Pe(he,pe,fe,me,ve[Me+12],6,1700485571),me=Pe(me,he,pe,fe,ve[Me+3],10,-1894986606),fe=Pe(fe,me,he,pe,ve[Me+10],15,-1051523),pe=Pe(pe,fe,me,he,ve[Me+1],21,-2054922799),he=Pe(he,pe,fe,me,ve[Me+8],6,1873313359),me=Pe(me,he,pe,fe,ve[Me+15],10,-30611744),fe=Pe(fe,me,he,pe,ve[Me+6],15,-1560198380),pe=Pe(pe,fe,me,he,ve[Me+13],21,1309151649),he=Pe(he,pe,fe,me,ve[Me+4],6,-145523070),me=Pe(me,he,pe,fe,ve[Me+11],10,-1120210379),fe=Pe(fe,me,he,pe,ve[Me+2],15,718787259),pe=Pe(pe,fe,me,he,ve[Me+9],21,-343485551),he=Oe(he,qe),pe=Oe(pe,Xe),fe=Oe(fe,gt),me=Oe(me,dt)}return[he,pe,fe,me]}(function ge(ve){const ye=[];for(let he=0,pe=ve.length*De;he<pe;he+=De)ye[he>>5]|=(ve.charCodeAt(he/De)&Se)<<he%32;return ye}(ve),ve.length*De);switch(he){case re.Raw:return pe;case re.Hex:return function Be(ve){const ye="0123456789abcdef",he=[];for(let pe=0,fe=4*ve.length;pe<fe;pe++)he.push(ye.charAt(ve[pe>>2]>>pe%4*8+4&15)+ye.charAt(ve[pe>>2]>>pe%4*8&15));return he.join("")}(pe);case re.String:return function ce(ve){const ye=[];for(let he=0,pe=32*ve.length;he<pe;he+=De)ye.push(String.fromCharCode(ve[he>>5]>>>he%32&Se));return ye.join("")}(pe);case re.Base64:return function Ye(ve){const pe=[];for(let fe=0,me=4*ve.length;fe<me;fe+=3){const Me=(ve[fe>>2]>>fe%4*8&255)<<16|(ve[fe+1>>2]>>(fe+1)%4*8&255)<<8|ve[fe+2>>2]>>(fe+2)%4*8&255;for(let qe=0;qe<4;qe++)pe.push(8*fe+6*qe>32*ve.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Me>>6*(3-qe)&63))}return pe.join("")}(pe)}}},99305:(zt,st,se)=>{function re(De){return De&&"getAtOrigin"in De&&"originOf"in De}se.d(st,{H:()=>re})},38118:(zt,st,se)=>{se.d(st,{b:()=>Se});var re=se(69287),De=se(83034);function Se(Ye,je,Ie){const oe=Array.isArray(Ye),de=oe?Ye.length/je:Ye.byteLength/(4*je),Te=oe?Ye:new Uint32Array(Ye,0,de*je),Pe=Ie?.minReduction??0,xe=Ie?.originalIndices||null,He=xe?xe.length:0,ve=Ie?.componentOffsets||null;let ye=0;if(ve)for(let Ue=0;Ue<ve.length-1;Ue++){const lt=ve[Ue+1]-ve[Ue];lt>ye&&(ye=lt)}else ye=de;const he=Math.floor(1.1*ye)+1;(null==Be||Be.length<2*he)&&(Be=new Uint32Array((0,re.cU)(2*he)));for(let Ue=0;Ue<2*he;Ue++)Be[Ue]=0;let pe=0;const fe=!!ve&&!!xe,me=fe?He:de;let Me=(0,De.my)(de);const qe=new Uint32Array(He);let gt=0!==Pe?Math.ceil(7.84*1.96/(Pe*Pe)*Pe*(1-Pe)):me,dt=1,Ee=ve?ve[1]:me;for(let Ue=0;Ue<me;Ue++){if(Ue===gt){const mt=1-pe/Ue;if(mt+1.96*Math.sqrt(mt*(1-mt)/Ue)<Pe)return null;gt*=2}if(Ue===Ee){for(let mt=0;mt<2*he;mt++)Be[mt]=0;if(xe)for(let mt=ve[dt-1];mt<ve[dt];mt++)qe[mt]=Me[xe[mt]];Ee=ve[++dt]}const lt=fe?xe[Ue]:Ue,Kt=lt*je,ft=ce(Te,Kt,je);let xt=ft%he,qi=pe;for(;0!==Be[2*xt+1];){if(Be[2*xt]===ft){const mt=Be[2*xt+1]-1;if(Oe(Te,Kt,mt*je,je)){qi=Me[mt];break}}xt++,xt>=he&&(xt-=he)}qi===pe&&(Be[2*xt]=ft,Be[2*xt+1]=lt+1,pe++),Me[lt]=qi}if(0!==Pe&&1-pe/de<Pe)return null;if(fe){for(let Ue=ve[dt-1];Ue<qe.length;Ue++)qe[Ue]=Me[xe[Ue]];Me=(0,De.Dg)(qe)}const ut=oe?new Array(pe):new Uint32Array(pe*je);pe=0;for(let Ue=0;Ue<me;Ue++)Me[Ue]===pe&&(ge(Te,(fe?xe[Ue]:Ue)*je,ut,pe*je,je),pe++);if(xe&&!fe){const Ue=new Uint32Array(He);for(let lt=0;lt<Ue.length;lt++)Ue[lt]=Me[xe[lt]];Me=(0,De.Dg)(Ue)}return{buffer:Array.isArray(ut)?ut:ut.buffer,indices:Me,uniqueCount:pe}}function Oe(Ye,je,Ie,oe){for(let de=0;de<oe;de++)if(Ye[je+de]!==Ye[Ie+de])return!1;return!0}function ge(Ye,je,Ie,oe,de){for(let Te=0;Te<de;Te++)Ie[oe+Te]=Ye[je+Te]}function ce(Ye,je,Ie){let oe=0;for(let de=0;de<Ie;de++)oe=Ye[je+de]+oe|0,oe=oe+(oe<<11)+(oe>>>2)|0;return oe>>>0}let Be=null},56548:(zt,st,se)=>{se.d(st,{S:()=>ce});var re=se(69287),De=se(82663),Se=se(28714),Oe=se(41510),ge=se(93617);function ce(je,Ie,oe){const de=function Be(je,Ie,oe,de){const Te=Array.isArray(Ie[0])?(xe,He)=>Ie[xe][He]:(xe,He)=>Ie[3*xe+He],Pe=de?(0,De.GA)(de)/(0,De.G9)(de):1;return(0,ge.lU)(je,(xe,He)=>(0,Se.i)(xe,Te(He,0)*Pe,Te(He,1)*Pe,Te(He,2)),oe)}(Ye,je,Ie,oe)?(0,ge.Qj)(Ye):[0,0,1];return Math.abs(de[2])>Math.cos((0,re.kU)(80))?Oe._.Z:Math.abs(de[1])>Math.abs(de[0])?Oe._.Y:Oe._.X}const Ye=(0,ge.vt)()},37723:(zt,st,se)=>{se.d(st,{Wq:()=>Te,lO:()=>Ye,oR:()=>Ie});var Te,Pe,re=se(92405),De=se(41510),Se=se(15268),Oe=se(23653),ge=se(83034),ce=se(56548),Be=se(38118);function Ye(Pe){const xe=Ie(Pe.rings,Pe.hasZ,Te.CCW_IS_HOLE,Pe.spatialReference),He=new Array;let ve=0,ye=0;for(const fe of xe.polygons){const Me=fe.index,qe=(0,Oe.l5)(xe.position,3*Me,3*fe.count),Xe=fe.holeIndices.map(dt=>dt-Me),gt=(0,ge.Dg)((0,re.e)(qe,Xe,3));He.push({position:qe,faces:gt}),ve+=qe.length,ye+=gt.length}const he=function je(Pe,xe,He){if(1===Pe.length)return Pe[0];const ve=(0,Oe.jh)(xe),ye=new Array(He);let he=0,pe=0,fe=0;for(const me of Pe){for(let Me=0;Me<me.position.length;Me++)ve[he++]=me.position[Me];for(const Me of me.faces)ye[pe++]=Me+fe;fe=he/3}return{position:ve,faces:(0,ge.Dg)(ye)}}(He,ve,ye),pe=Array.isArray(he.position)?(0,Be.b)(he.position,3,{originalIndices:he.faces}):(0,Be.b)(he.position.buffer,6,{originalIndices:he.faces});return he.position=(0,Oe.xm)(new Float64Array(pe.buffer)),he.faces=pe.indices,he}function Ie(Pe,xe,He,ve){const ye=Pe.length,he=new Array(ye),pe=new Array(ye),fe=new Array(ye);let me=0;for(let Ee=0;Ee<ye;++Ee)me+=Pe[Ee].length;let Me=0,qe=0,Xe=0;const gt=(0,Oe.jh)(3*me);let dt=0;for(let Ee=ye-1;Ee>=0;Ee--){const ut=Pe[Ee],Ue=He===Te.CCW_IS_HOLE&&de(ut,xe,ve);if(Ue&&1!==ye)he[Me++]=ut;else{let lt=ut.length;for(let ft=0;ft<Me;++ft)lt+=he[ft].length;const Kt={index:dt,pathLengths:new Array(Me+1),count:lt,holeIndices:new Array(Me)};Kt.pathLengths[0]=ut.length,ut.length>0&&(fe[Xe++]={index:dt,count:ut.length}),dt=Ue?oe(ut,ut.length-1,-1,gt,dt,ut.length,xe):oe(ut,0,1,gt,dt,ut.length,xe);for(let ft=0;ft<Me;++ft){const xt=he[ft];Kt.holeIndices[ft]=dt,Kt.pathLengths[ft+1]=xt.length,xt.length>0&&(fe[Xe++]={index:dt,count:xt.length}),dt=oe(xt,0,1,gt,dt,xt.length,xe)}Me=0,Kt.count>0&&(pe[qe++]=Kt)}}for(let Ee=0;Ee<Me;++Ee){const ut=he[Ee];ut.length>0&&(fe[Xe++]={index:dt,count:ut.length}),dt=oe(ut,0,1,gt,dt,ut.length,xe)}return pe.length=qe,fe.length=Xe,{position:gt,polygons:pe,outlines:fe}}function oe(Pe,xe,He,ve,ye,he,pe){ye*=3;for(let fe=0;fe<he;++fe){const me=Pe[xe];ve[ye++]=me[0],ve[ye++]=me[1],ve[ye++]=pe&&me[2]?me[2]:0,xe+=He}return ye/3}function de(Pe,xe,He){if(!xe)return!(0,Se.$3)(Pe);switch((0,ce.S)(Pe,Pe.length-1,He)){case De._.X:return!(0,Se.$3)(Pe,De._.Y,De._.Z);case De._.Y:return!(0,Se.$3)(Pe,De._.X,De._.Z);case De._.Z:return!(0,Se.$3)(Pe,De._.X,De._.Y)}}(Pe=Te||(Te={}))[Pe.NONE=0]="NONE",Pe[Pe.CCW_IS_HOLE=1]="CCW_IS_HOLE"},61156:(zt,st,se)=>{se.r(st),se.d(st,{DrawGraphicTool3D:()=>Wi,ExtentTransformTool:()=>Lt,ManipulatedObject3DGraphic:()=>ji,MoveTool3D:()=>Xt,ReshapeTool3D:()=>Ot,TransformTool3D:()=>Zt});var re=se(8189),De=se(29430),Se=se(17715),Oe=se(11432),ge=se(48900),ce=se(85211),Be=se(3248),Ie=(se(35150),se(40707),se(76576)),oe=se(28714),de=se(25866),Te=se(73812),Pe=se(88485),xe=se(67685),ve=(se(5922),se(74794)),ye=se(68677),pe=(se(13242),se(98877)),fe=se(89447),me=se(69287),Me=se(54795),qe=se(82663),Xe=se(83953),gt=se(45475),dt=se(15268),Ee=se(19741),ut=se(45846),Ue=se(82317);se(92129);let Kt=h=>({vnodeSelector:"",properties:void 0,children:void 0,text:h.toString(),domNode:null}),ft=(h,a,y)=>{for(let F=0,$=a.length;F<$;F++){let ee=a[F];Array.isArray(ee)?ft(h,ee,y):null!=ee&&!1!==ee&&("string"==typeof ee&&(ee=Kt(ee)),y.push(ee))}};se(76062);const mt={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let Et=class extends pe.A{get position(){return[this.x,this.y]}set position(h){this._set("x",h[0]),this._set("y",h[1])}get _textShadowColor(){const{textColor:h,backgroundColor:a}=this,y=a.clone();return y.a*=h.a,y}get _textShadow(){const h=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${h}`}get padding(){return.5*this.fontSize}get borderRadius(){return this.padding}set borderRadius(h){this._overrideIfSome("borderRadius",h)}constructor(h){super(h),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new ye.A([0,0,0,.6]),this.textColor=new ye.A([255,255,255]),this._textShadowSize=1}render(){return function xt(h,a,y){if(Array.isArray(a))y=a,a=void 0;else if(a&&("string"==typeof a||a.hasOwnProperty("vnodeSelector"))||y&&("string"==typeof y||y.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let F,$;return y&&1===y.length&&"string"==typeof y[0]?F=y[0]:y&&($=[],ft(h,y,$),0===$.length&&($=void 0)),{vnodeSelector:h,properties:a,children:$,text:""===F?void 0:F,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this.borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(h){if(!this.visible)return;const a=h.font.replace(/^(.*?)px/,"");h.font=`${this.fontSize}px ${a}`;const{padding:y,borderRadius:F}=this,$=h.measureText(this.text).width,ee=""!==this.text?this.fontSize:0,te=$e[this.anchor];h.textAlign="center",h.textBaseline="middle";const ie=$+2*y,ne=ee+2*y;this._roundedRect(h,this.x+te.x*ie,this.y+te.y*ne,ie,ne,F),h.fillStyle=this.backgroundColor.toCss(!0),h.fill();const ue=this.x+(te.x+.5)*ie,_e=this.y+(te.y+.5)*ne;this._renderTextShadow(h,this.text,ue,_e),h.fillStyle=this.textColor.toCss(!0),h.fillText(this.text,ue,_e)}_renderTextShadow(h,a,y,F){h.lineJoin="miter",h.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/Dt.length})`;const $=this._textShadowSize;for(const[ee,te]of Dt)h.fillText(a,y+$*ee,F+$*te)}_roundedRect(h,a,y,F,$,ee){ee=Math.min(ee,$/2,F/2),h.beginPath(),h.moveTo(a,y+ee),h.arcTo(a,y,a+ee,y,ee),h.lineTo(a+F-ee,y),h.arcTo(a+F,y,a+F,y+ee,ee),h.lineTo(a+F,y+$-ee),h.arcTo(a+F,y+$,a+F-ee,y+$,ee),h.lineTo(a+ee,y+$),h.arcTo(a,y+$,a,y+$-ee,ee),h.closePath()}_cssClasses(){const h={"esri-text-overlay-item":!0};let a;for(a in mt)h[mt[a]]=this.anchor===a;return h}};(0,re._)([(0,ce.MZ)()],Et.prototype,"x",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"y",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"position",null),(0,re._)([(0,ce.MZ)()],Et.prototype,"text",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"fontSize",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"anchor",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"visible",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"isDecoration",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"backgroundColor",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"textColor",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"_textShadowSize",void 0),(0,re._)([(0,ce.MZ)()],Et.prototype,"_textShadowColor",null),(0,re._)([(0,ce.MZ)()],Et.prototype,"_textShadow",null),(0,re._)([(0,ce.MZ)()],Et.prototype,"padding",null),(0,re._)([(0,ce.MZ)()],Et.prototype,"borderRadius",null),Et=(0,re._)([(0,Ie.$)("esri.views.overlay.TextOverlayItem")],Et);const $e={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},Dt=[];for(let a=0;a<360;a+=22.5)Dt.push([Math.cos(Math.PI*a/180),Math.sin(Math.PI*a/180)]);const ke=Et;var Ze=se(69441),tt=se(88996);const kt={default:15,far:25};let Ht=class extends pe.A{constructor(h){super(h),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messageUnitsTask=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){this.addHandles([(0,ge.wB)(()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(h=>(0,ge.on)(()=>this.context?.editGeometryOperations,h,()=>this._update())),(0,ge.wB)(()=>this._colors,h=>this._updateStyle(h)),(0,tt.oQ)(()=>this._refreshMessages()),(0,Se.hA)(()=>this._messageUnitsTask?.abort())]),this._refreshMessages()}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){}get _messagesUnits(){return this._messageUnitsTask?.value}get _edgeDistancePixels(){return kt[this.edgeDistance]}get _colors(){const h=this.context?.view.effectiveTheme.textColor??ye.A.fromArray([255,255,255]);return{textColor:h,backgroundColor:(0,De._L)((0,De.bJ)(h,De.pW.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:h,stagedVertex:a}=this;if(!h)return this._destroyUnusedLabels();const{editGeometryOperations:y}=h,{components:F,geometry:$,coordinateHelper:ee}=y.data;if(!$)return this._destroyUnusedLabels();const te=F.length;for(let ie=0;ie<te;++ie){const ne=Rr($,y,a,ee,ie);if(ne.length<2||!Cr(ne,h.view,h.elevationInfo,ee.spatialReference))continue;const ae=1===te&&!(0,dt.$3)(ne);let le=Lr,ue=jr;this.toScreenPointArray(h,ne[0],le);for(let _e=1;_e<ne.length;++_e){const be=ne[_e-1],we=ne[_e];this.toScreenPointArray(h,we,ue),this._addLabel(h,be,le,we,ue,ae),[le,ue]=[ue,le]}}this._destroyUnusedLabels()}_updateStyle({textColor:h,backgroundColor:a}){const y=this._nextLabelIndex,F=this._labelInfos;for(let $=0;$<y;++$){const{label:ee}=F[$];ee.textColor=h,ee.backgroundColor=a}}_addLabel(h,a,y,F,$,ee){const{label:te}=this._getOrCreateLabel(h);if(!this.visible||(0,Xe.hG)(y,$)<3025)return void(te.visible=!1);const{spatialReference:ie}=h.editGeometryOperations.data,ne=(0,Ze.Do)(a,F,ie),ae=this._messagesUnits,le=(0,Ue.c)(h.view);te.text=null!=ae&&null!=ne?(0,Me.ix)(ae,ne,le):"",te.visible=!0;const ue=$[0]-y[0],_e=$[1]-y[1];ee?(0,Xe.hZ)(Jt,-_e,ue):(0,Xe.hZ)(Jt,_e,-ue),(0,Xe.S8)(Jt,Jt),(0,Xe.hs)(Jt,Jt,this._edgeDistancePixels),(0,Xe.Cc)(vn,y,$,.5),(0,Xe.WQ)(vn,vn,Jt),te.position=[vn[0],vn[1]],te.anchor=Math.abs(Jt[0])>Math.abs(Jt[1])?Jt[0]>0?"left":"right":-Jt[1]<0?"top":"bottom"}_getOrCreateLabel(h){const a=this._labelInfos.length>this._nextLabelIndex,{textColor:y,backgroundColor:F}=this._colors;if(a){const te=this._labelInfos[this._nextLabelIndex++],{label:ie}=te;return ie.textColor=y,ie.backgroundColor=F,te}const $=new ke({anchor:"center",fontSize:8,textColor:y,backgroundColor:F});h.view.overlay?.items.add($);const ee={label:$};return this._labelInfos.push(ee),this._nextLabelIndex=this._labelInfos.length,ee}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:h}){this.context?.view.overlay?.items.remove(h),h.destroy()}_refreshMessages(){this._messageUnitsTask?.abort(),this._messageUnitsTask=(0,fe.UT)(()=>(0,ut.ud)("esri/core/t9n/Units"))}};function Rr(h,a,y,F,$){const ee=[];if(a.data.components[$].iterateVertices(ne=>{ee.push(F.toXYZ(ne.pos,Ee.rq.get()))}),0===$&&null!=y&&ee.push(F.toXYZ(y,Ee.rq.get())),ee.length<2)return ee;const te=ee[0];return"polygon"===h.type&&ee.length>2&&!(0,oe.I)(te,ee[ee.length-1])&&ee.push(te),ee}function Cr(h,a,y,F){if("2d"===a.type)return!0;const $=(0,qe.Ao)(F)??1,ee=(0,qe.G9)(F),te=ie=>(0,Te.xS)(a,ie,F,y,Te.qt)??0;for(let ie=1;ie<h.length;++ie){const ne=h[ie-1],ae=h[ie],le=(ae[0]-ne[0])*$,ue=(ae[1]-ne[1])*$,_e=(te(ae)-te(ne))*ee;if(Math.abs(_e)/Math.sqrt(le*le+ue*ue)>Ir)return!1}return!0}(0,re._)([(0,ce.MZ)()],Ht.prototype,"context",void 0),(0,re._)([(0,ce.MZ)()],Ht.prototype,"stagedVertex",void 0),(0,re._)([(0,ce.MZ)()],Ht.prototype,"visible",void 0),(0,re._)([(0,ce.MZ)()],Ht.prototype,"edgeDistance",void 0),(0,re._)([(0,ce.MZ)()],Ht.prototype,"updating",null),(0,re._)([(0,ce.MZ)()],Ht.prototype,"_messageUnitsTask",void 0),(0,re._)([(0,ce.MZ)()],Ht.prototype,"_messagesUnits",null),(0,re._)([(0,ce.MZ)()],Ht.prototype,"_edgeDistancePixels",null),(0,re._)([(0,ce.MZ)()],Ht.prototype,"_colors",null),Ht=(0,re._)([(0,Ie.$)("esri.views.interactive.SegmentLabels")],Ht);const Ir=(0,me.kU)(5),Jt=(0,gt.vt)(),vn=(0,gt.vt)(),Lr=(0,xe.gs)(),jr=(0,xe.gs)();let Zn=class extends Ht{getCameraOrExtent({view:h}){return h.state.camera}toScreenPointArray({view:h,elevationInfo:a,editGeometryOperations:y},F,$=(0,xe.gs)()){const{spatialReference:ee}=y.data.coordinateHelper;return(0,ve.X)(F,ee,a,h,Ea),h.state.camera.projectToScreen(Ea,$),$}};Zn=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.SegmentLabels3D")],Zn);const Ea=(0,de.vt)();var yi=se(44929),_t=se(53781),Mt=se(89141),Mi=se(65225),Oa=se(91421),vt=se(71548),Ft=se(55703),Ur=se(3046),en=se(88372),Sa=se(35386),Fn=se(19451);class Vr{constructor(a){this._resourceFactory=a,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=en.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(a){a!==this._visible&&(this._visible=a,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(a){a!==this._attached&&(this._attached=a,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(a){this._renderGroup=a;const y=this._resources?.layerView;y&&(y.renderGroup=a)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const a=this._resourceFactory.createResources(),y=new zi({view:this._resourceFactory.view,renderGroup:this._renderGroup}),F=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new zi({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:a,geometriesAdded:!1},F&&(this._resources.drapeSourceRenderer=F.registerGeometryDrapeSource(y)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const a=this._resourceFactory.view.basemapTerrain?.overlayManager;a&&a.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,Sa.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,Sa.q.UPDATE),this._resources.geometriesAdded=!0))}}let zi=class extends(Ur.A.IdentifiableMixin(pe.A)){constructor(h){super(h),this.drapeSourceType=en.Om.Features,this.updatePolicy=Fn.q.SYNC,this.renderGroup=en.O7.Outline}};(0,re._)([(0,ce.MZ)({constructOnly:!0})],zi.prototype,"view",void 0),(0,re._)([(0,ce.MZ)({readOnly:!0})],zi.prototype,"drapeSourceType",void 0),(0,re._)([(0,ce.MZ)()],zi.prototype,"renderGroup",void 0),zi=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],zi);class As{get isDecoration(){return this._isDecoration}set isDecoration(a){this._isDecoration=a}constructor(a){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=a.view,this._handle=(0,ge.wB)(()=>a.view.ready,y=>{this._resourcesCreated&&(y?this._createResources():this._destroyResources())})}applyProperties(a){let y=!1;for(const F in a)F in this&&("attached"===F?y=!!a[F]:this[F]=a[F]);this.attached=y}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(a){a!==this._attached&&this.view._stage&&(this._attached=a,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(a))}onAttachedChange(a){}get visible(){return this._visible}set visible(a){a!==this._visible&&(this._visible=a,this.attached&&this.updateVisibility(a))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var bi=se(98176),Ts=se(47756),Ps=se(44323);class zr{constructor(a){this._resourceFactory=a,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(a){a!==this._visible&&(this._visible=a,this._syncVisible())}get attached(){return this._attached}set attached(a){a!==this._attached&&(this._attached=a,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const a=this._resourceFactory.view._stage;if(null==this._resources||!a)return;const y=this._resources.object;this._resources.external.forEach(F=>{F.type!==bi.X.Mesh&&F.type!==bi.X.Line&&F.type!==bi.X.Point||a.remove(F)}),y.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,y,this._resources.layer),this._resources.external.forEach(F=>{F.type!==bi.X.Mesh&&F.type!==bi.X.Line&&F.type!==bi.X.Point||a.add(F)})}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const a=this._resourceFactory,y=a.view,F=y._stage;if(!F)return;const $=new Ps.x(F,{pickable:!1,updatePolicy:Fn.q.SYNC}),ee=new Ts.B({castShadow:!1}),te=a.createResources(ee,$);te.forEach(ae=>{F.add(ae),ae.type===bi.X.Texture&&ae.load(F.renderView.renderingContext)}),F.add(ee),$.add(ee);const ie=a.cameraChanged,ne=ie?(0,ge.wB)(()=>y.state.camera,ae=>ie(ae),ge.Vh):null;this._resources={layer:$,object:ee,external:te,cameraHandle:ne},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const a=this._resourceFactory.view._stage;a&&(a.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach(y=>{a.remove(y),y.type===bi.X.Texture&&y.unload()})),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class Bn extends As{constructor(a){super(a),this._isDraped=!1,this.object3dResources=new zr(this.createObject3DResourceFactory(a.view)),this.drapedResources=new Vr(this.createDrapedResourceFactory(a.view)),this.isDraped=a.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(a){a!==this._isDraped&&(this._isDraped=a,this.object3dResources.attached=this.attached&&!a,this.drapedResources.attached=this.attached&&a)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(a){this.drapedResources.renderGroup=a}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(a){this.object3dResources.visible=a,this.drapedResources.visible=a}}var yn=se(23191),xa=se(10294),Hr=se(22057),wa=se(94095),Da=se(69690),tn=se(11556),nn=se(18110),Ei=se(79595),Tt=se(41396);class Rs extends nn.w{constructor(a,y){super(a,y,new tn.$(wa.a,()=>se.e(7409).then(se.bind(se,37409))))}initializePipeline(a){switch(a.blitMode){case Ei.d.None:case Ei.d.Depth:return(0,Tt.Ey)({colorWrite:Tt.kn});case Ei.d.Alpha:return(0,Tt.Ey)({blending:Tt.Ky,colorWrite:Tt.kn});default:(0,Da.Xb)(a.blitMode);case Ei.d.PremultipliedAlpha:case Ei.d.COUNT:return(0,Tt.Ey)({blending:Tt.Os,colorWrite:Tt.kn})}}}var di=se(50915);class Gr{constructor(a,y=Ei.d.None){this._techniques=a,this._parameters=new wa.C,this._configuration=new Ei.N,this._configuration.blitMode=y,a.precompile(Rs,this._configuration)}blit(a,y,F,$){a.bindFramebuffer(F.fbo),a.setClearColor(0,0,0,1),a.clear(di.NV.COLOR),this._parameters.texture=y.getTexture();const ee=this._techniques.get(Rs,this._configuration);a.bindTechnique(ee,$,this._parameters),a.screen.draw()}blend(a,y,F,$,ee=1){this._configuration.hasOpacityFactor=ee<1;const te=this._techniques.get(Rs,this._configuration);return!!te.compiled&&(a.bindFramebuffer(F.fbo),this._parameters.texture=y.getTexture(),this._parameters.opacity=ee,a.bindTechnique(te,$,this._parameters),a.screen.draw(),!0)}}var Wn=se(23653),Nr=se(79439),Cs=se(48499),Aa=se(72254),Ta=se(70938);class Zr extends Ta.Y{constructor(){super(...arguments),this.innerColor=(0,de.fA)(1,1,1),this.innerWidth=1,this.glowColor=(0,de.fA)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,me.kU)(6),this.pointDistanceOrigin=(0,de.vt)(),this.pointDistanceTarget=(0,de.vt)(),this.lineVerticalPlaneSegment=(0,vt.vt)(),this.intersectsLineSegment=(0,vt.vt)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,de.vt)(),this.lineStartWorld=(0,de.vt)(),this.lineEndWorld=(0,de.vt)()}}class Fr extends nn.w{constructor(a,y){super(a,y,new tn.$(Aa.L,()=>se.e(423).then(se.bind(se,80423))))}}var Fe=se(40972),Br=se(32677);class Wr extends Zr{constructor(){super(...arguments),this.origin=(0,de.vt)()}}class Is extends nn.w{constructor(a,y){super(a,y,new tn.$(Br.L,()=>se.e(9595).then(se.bind(se,49595))),Pa)}}const Pa=new Map([[Fe.r.START,0],[Fe.r.END,1],[Fe.r.EXTRUDE,2],[Fe.r.START_UP,3],[Fe.r.END_UP,4]]);var Xr=se(30614),Yr=se(32788);class Ra{constructor(a){this._renderCoordsHelper=a,this._buffers=null,this._origin=(0,de.vt)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(a){const y=(0,Wn.jh)(3*a.length);let F=0;for(const $ of a)y[F++]=$[0],y[F++]=$[1],y[F++]=$[2];this.buffers=[y]}set buffers(a){if(this._buffers=a,this._buffers.length>0){const y=this._buffers[0],F=3*Math.floor(y.length/3/2);(0,oe.i)(this._origin,y[F],y[F+1],y[F+2])}else(0,oe.i)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(a){const y=this._ensureVAO(a);null!=y&&(a.bindVAO(y),a.drawArrays(di.WR.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===yn.RT.Global?Kr:Qr}_ensureVAO(a){return null==this._buffers?null:(this._vao??=this._createVAO(a,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(a,y){const F=this._createDataBuffer(y);return this._dirty=!1,new Xr.Z(a,Pa,new Map([["data",(0,Nr.U)(this._layout)]]),new Map([["data",Yr.g.createVertex(a,di._U.STATIC_DRAW,F)]]))}_ensureVertexData(a,y){if(!this._dirty)return;const F=this._createDataBuffer(y);a.vertexBuffers.get("data")?.setData(F),this._dirty=!1}_createDataBuffer(a){const y=a.reduce((ne,ae)=>ne+Ca(ae),0);this._count=y;const F=this._layout.createBuffer(y),$=this._origin;let ee=0,te=0;const ie="startUp"in F?this._setUpVectors.bind(this,F):void 0;for(const ne of a){for(let ae=0;ae<ne.length;ae+=3){const le=(0,oe.i)(Ia,ne[ae],ne[ae+1],ne[ae+2]);0===ae?te=this._renderCoordsHelper.getAltitude(le):this._renderCoordsHelper.setAltitude(le,te);const ue=ee+2*ae;ie?.(ae,ue,ne,le);const _e=(0,oe.d)(Ia,le,$);if(ae<ne.length-3){for(let be=0;be<6;be++)F.start.setVec(ue+be,_e);F.extrude.setValues(ue,0,-1),F.extrude.setValues(ue+1,1,-1),F.extrude.setValues(ue+2,1,1),F.extrude.setValues(ue+3,0,-1),F.extrude.setValues(ue+4,1,1),F.extrude.setValues(ue+5,0,1)}if(ae>0)for(let be=-6;be<0;be++)F.end.setVec(ue+be,_e)}ee+=Ca(ne)}return F.buffer}_setUpVectors(a,y,F,$,ee){const te=this._renderCoordsHelper.worldUpAtPosition(ee,$r);if(y<$.length-3)for(let ie=0;ie<6;ie++)a.startUp.setVec(F+ie,te);if(y>0)for(let ie=-6;ie<0;ie++)a.endUp.setVec(F+ie,te)}}function Ca(h){return 2*(h.length/3-1)*3}const $r=(0,de.vt)(),Ia=(0,de.vt)(),Kr=(0,Cs.BP)().vec3f(Fe.r.START).vec3f(Fe.r.END).vec2f(Fe.r.EXTRUDE).vec3f(Fe.r.START_UP).vec3f(Fe.r.END_UP),Qr=(0,Cs.BP)().vec3f(Fe.r.START).vec3f(Fe.r.END).vec2f(Fe.r.EXTRUDE);var yt=se(55062);class Mn extends yt.K{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}}(0,re._)([(0,yt.W)()],Mn.prototype,"contrastControlEnabled",void 0),(0,re._)([(0,yt.W)()],Mn.prototype,"spherical",void 0);class bn extends Mn{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}}(0,re._)([(0,yt.W)()],bn.prototype,"heightManifoldEnabled",void 0),(0,re._)([(0,yt.W)()],bn.prototype,"pointDistanceEnabled",void 0),(0,re._)([(0,yt.W)()],bn.prototype,"lineVerticalPlaneEnabled",void 0),(0,re._)([(0,yt.W)()],bn.prototype,"intersectsLineEnabled",void 0);var Qe=se(67496),kr=se(3264);let Hi=class extends Hr.A{constructor(h){super(h),this.produces=xa.OG.LASERLINES,this.consumes={required:[xa.OG.LASERLINES,"normals"]},this.requireGeometryDepth=!0,this._configuration=new bn,this._pathTechniqueConfiguration=new Mn,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new Wr;const a=h.view._stage.renderView.techniques,y=new Mn;y.contrastControlEnabled=h.contrastControlEnabled,a.precompile(Is,y)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===yn.RT.Global,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(Is,this._pathTechniqueConfiguration),this._blit=new Gr(this._techniques,Ei.d.PremultipliedAlpha)}destroy(){this._pathVerticalPlaneData=(0,Oe.WD)(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view._stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(h){this._heightManifoldEnabled!==h&&(this._heightManifoldEnabled=h,this.requestRender(Qe.C7.UPDATE))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(h){(0,oe.c)(this._passParameters.heightManifoldTarget,h),this.requestRender(Qe.C7.UPDATE)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(h){h!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=h,this.requestRender(Qe.C7.UPDATE))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(h){(0,oe.c)(this._passParameters.pointDistanceTarget,h),this.requestRender(Qe.C7.UPDATE)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(h){(0,oe.c)(this._passParameters.pointDistanceOrigin,h),this.requestRender(Qe.C7.UPDATE)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(h){h!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=h,this.requestRender(Qe.C7.UPDATE))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(h){(0,vt.C)(h,this._passParameters.lineVerticalPlaneSegment),this.requestRender(Qe.C7.UPDATE)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(h){h!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=h,this.requestRender(Qe.C7.UPDATE))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(h){(0,vt.C)(h,this._passParameters.intersectsLineSegment),this.requestRender(Qe.C7.UPDATE)}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(h){h!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=h,this.requestRender(Qe.C7.UPDATE))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(h){h!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=h,null!=this._pathVerticalPlaneData&&this.requestRender(Qe.C7.UPDATE))}set pathVerticalPlaneVertices(h){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Ra(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=h,this.pathVerticalPlaneEnabled&&this.requestRender(Qe.C7.UPDATE)}set pathVerticalPlaneBuffers(h){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Ra(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=h,this.pathVerticalPlaneEnabled&&this.requestRender(Qe.C7.UPDATE)}setParameters(h){(0,kr.MB)(this._passParameters,h)&&this.requestRender(Qe.C7.UPDATE)}precompile(){this._acquireTechnique()}render(h){const a=h.find(({name:te})=>te===this.produces);if(!this.bindParameters.decorations||null==this._blit)return a;const y=this.renderingContext,F=h.find(({name:te})=>"normals"===te);this._passParameters.normals=F?.getTexture();const $=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return y.bindFramebuffer(a.fbo),$(),a;this._passParameters.colors=a.getTexture();const ee=this.fboCache.acquire(a.fbo.width,a.fbo.height,"laser lines");return y.bindFramebuffer(ee.fbo),y.setClearColor(0,0,0,0),y.clear(di.NV.COLOR|di.NV.DEPTH),$(),y.unbindTexture(a.getTexture()),this._blit.blend(y,ee,a,this.bindParameters)||this.requestRender(Qe.C7.UPDATE),ee.release(),a}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===yn.RT.Global,this._techniques.get(Fr,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;const h=this._acquireTechnique();if(h.compiled){const a=this.renderingContext;a.bindTechnique(h,this.bindParameters,this._passParameters),a.screen.draw()}else this.requestRender(Qe.C7.UPDATE)}_renderPath(){if(null==this._pathVerticalPlaneData)return;const h=this._techniques.get(Is,this._pathTechniqueConfiguration);if(h.compiled){const a=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,a.bindTechnique(h,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(a)}else this.requestRender(Qe.C7.UPDATE)}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;const h=this.bindParameters.camera,a=this._passParameters;if(this._intersectsLineInfinite){if((0,Mi.$e)((0,Ft.LV)(a.intersectsLineSegment.origin,a.intersectsLineSegment.vector),En),En.c0=-Number.MAX_VALUE,!(0,Oa.ig)(h.frustum,En))return!1;(0,Mi.j1)(En,a.lineStartWorld),(0,Mi.mO)(En,a.lineEndWorld)}else(0,oe.c)(a.lineStartWorld,a.intersectsLineSegment.origin),(0,oe.g)(a.lineEndWorld,a.intersectsLineSegment.origin,a.intersectsLineSegment.vector);return!0}get test(){}};(0,re._)([(0,ce.MZ)({constructOnly:!0})],Hi.prototype,"contrastControlEnabled",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],Hi.prototype,"isDecoration",void 0),(0,re._)([(0,ce.MZ)()],Hi.prototype,"produces",void 0),(0,re._)([(0,ce.MZ)()],Hi.prototype,"consumes",void 0),Hi=(0,re._)([(0,Ie.$)("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],Hi);const En=(0,Mi.vt)();class On extends As{constructor(a){super(a),this._angleCutoff=Aa.d,this._style={},this._heightManifoldTarget=(0,de.vt)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,vt.vt)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(a)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(a){this._angleCutoff!==a&&(this._angleCutoff=a,this._syncAngleCutoff())}get style(){return this._style}set style(a){this._style=a,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(a){null!=a?((0,oe.c)(this._heightManifoldTarget,a),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(a){if(null==a)return void(this.intersectsLine=null);const y=this.view.renderCoordsHelper.worldUpAtPosition(a,Jr);this.intersectsLine=(0,vt.fA)(a,y),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(a){null!=a?((0,vt.C)(a,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(a){this._intersectsLineInfinite=a,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(a){this._lineVerticalPlaneSegment=null!=a?(0,vt.C)(a):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(a){this._pathVerticalPlaneBuffers=a,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(a){this._pointDistanceLine=null!=a?{origin:(0,de.o8)(a.origin),target:a.target?(0,de.o8)(a.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new Hi({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){null!=this._renderer&&this._renderer.setParameters(this._style)}_syncAngleCutoff(){this._renderer?.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const a=this._pointDistanceLine,y=null!=a;this._renderer.pointDistanceEnabled=y&&null!=a.target&&this.visible,y&&(this._renderer.pointDistanceOrigin=a.origin,null!=a.target&&(this._renderer.pointDistanceTarget=a.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this._renderer.destroy(),this._renderer=null)}}const Jr=(0,de.vt)();var Xn=se(24425),it=se(36947),Ve=se(50957),Yn=se(25612),Gt=se(51612);class $n extends Bn{constructor(a){super(a),this._ray=(0,Ft.vt)(),this._isWorldDown=!1,this._start=(0,de.vt)(),this._end=(0,de.fA)(1,0,0),this._width=1,this._color=(0,Mt.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,Mt.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Bt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ve.m$.OccludeAndTransparent,this._fadedExtensions=Va,this._laserline=new On({view:this.view,isDecoration:a.isDecoration}),this.applyProperties(a)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(a){return{view:a,createResources:y=>this._createObject3DResources(y),destroyResources:La,recreateGeometry:(y,F)=>this._recreateObject3DGeometry(y,F),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(a){return{view:a,createResources:()=>this._createDrapedResources(),destroyResources:La,recreateGeometry:y=>this._recreateDrapedGeometry(y)}}updateVisibility(a){super.updateVisibility(a),this._laserline.visible=a}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(a){this._isWorldDown=!0,(0,oe.c)(this._start,a),this.view.renderCoordsHelper.worldUpAtPosition(a,this._end),(0,oe.d)(this._end,a,this._end),(0,Ft.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(a){this._isWorldDown=!1,(0,oe.p)(this._start,a)||((0,oe.c)(this._start,a),(0,Ft.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(a){this._isWorldDown=!1,(0,oe.p)(this._end,a)||((0,oe.c)(this._end,a),(0,Ft.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(a){a!==this._width&&(this._width=a,this._updateMaterial())}get color(){return this._color}set color(a){(0,_t.a)(a,this._color)||((0,_t.c)(this._color,a),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(a){a!==this._polygonOffset&&(this._polygonOffset=a,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(a){this._writeDepthEnabled!==a&&(this._writeDepthEnabled=a,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(a){a!==this._innerWidth&&(this._innerWidth=a,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(a){(0,_t.a)(a,this._innerColor)||((0,_t.c)(this._innerColor,a),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(a){const y=null!=a!=(null!=this._stipplePattern);this._stipplePattern=a,y?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(a){null!=a&&null!=this._stippleOffColor&&(0,_t.a)(a,this._stippleOffColor)||(this._stippleOffColor=null!=a?(0,Mt.o8)(a):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(a){a!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=a,this._updateMaterial())}get falloff(){return this._falloff}set falloff(a){a!==this._falloff&&(this._falloff=a,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(a){a!==this._extensionType&&(this._extensionType=a,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(a){this._laserlineStyle=a,this._laserline.attached=this._laserlineAttached,null!=a&&(this._laserline.style=a)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=a,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ve.m$.OccludeAndTransparentStencil?Ve.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(a){this._fadedExtensions=a??Va,this.recreateGeometry()}_updateMaterial(){const{materialParameters:a}=this;this.object3dResources.resources?.material.setParameters(a),this.drapedResources.resources?.material.setParameters(a)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(a){const y=new Gt.W(this.materialParameters),F=new Array;return this._createObject3DGeometry(y,a,F),{material:y,geometries:F,forEach:$=>{$(y),F.forEach($)}}}_recreateObject3DGeometry(a,y){a.geometries.length=0,this._createObject3DGeometry(a.material,y,a.geometries)}_createObject3DGeometry(a,y,F){const $=this._createGeometry(a);F.push($),y.addGeometry($),this._updateVerticesObject3D(y)}_createDrapedResources(){const a=new Gt.W(this.materialParameters);return{material:a,geometries:[this._createDrapedGeometry(a)]}}_recreateDrapedGeometry(a){a.geometries=[this._createDrapedGeometry(a.material)]}_createDrapedGeometry(a){const y=this._createGeometry(a);return this._updateVerticesDraped(y),new Yn.$(y)}_createGeometry(a){const y=this.extensionType===Bt.FADED,F=y?[(0,de.vt)(),(0,de.vt)(),(0,de.vt)(),(0,de.vt)()]:[(0,de.vt)(),(0,de.vt)()];return(0,it.Z8)(a,F,null,y?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const a=this.object3dResources.object;a&&this._updateVerticesObject3D(a)}}_updateVerticesObject3D(a){const y=this._lineSegment;this._updateVertexAttributesObject3D(a,y),this._laserline.intersectsLine=y}_updateVerticesDraped(a){this._updateVertexAttributesDraped(a,this._lineSegment)}get _lineSegment(){return this._extensionType===Bt.FADED?this._updateLineSegmentFinite(ja):this._updateLineSegmentInfinite(this._extensionType,ja)}_updateLineSegmentFinite(a){return(0,vt.Cr)(this._start,this._end,a)}_updateLineSegmentInfinite(a,y){const F=this.view.state.camera;switch((0,Mi.$e)(this._ray,Oi),a){case Bt.LINE:Oi.c0=-Number.MAX_VALUE;break;case Bt.RAY:case Bt.GROUND_RAY:{const te=this._ray.origin,ie=this.view.elevationProvider.getElevation(te[0],te[1],te[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,ne=this.view.renderCoordsHelper.getAltitude(te);this._isWorldDown&&ne<ie&&(0,oe.v)(Oi.ray.direction,Oi.ray.direction),this._extensionType===Bt.GROUND_RAY&&null!=ie&&(Oi.c1=Math.abs(ne-ie));break}}if(!(0,Oa.ig)(F.frustum,Oi))return this._updateLineSegmentFinite(y);const $=(0,Mi.j1)(Oi,Gi),ee=(0,Mi.mO)(Oi,qr);return(0,vt.Cr)($,ee,y)}_updateVertexAttributesObject3D(a,y){const F=a.geometries[0].getMutableAttribute(Fe.r.POSITION)?.data;if(!F)return;let $=0;for(const ee of this._lineVertices(y))F[$++]=ee[0],F[$++]=ee[1],F[$++]=ee[2];a.geometryVertexAttributeUpdated(a.geometries[0],Fe.r.POSITION)}_updateVertexAttributesDraped(a,y){const F=a.getMutableAttribute(Fe.r.POSITION)?.data;if(!F)return;let $=0;for(const ee of this._lineVertices(y))F[$++]=ee[0],F[$++]=ee[1],F[$++]=Xn.bi;a.invalidateBoundingInfo()}*_lineVertices(a){this.extensionType===Bt.FADED?(yield(0,vt.sd)(a,-this.fadedExtensions.start,Gi),yield(0,vt.sd)(a,0,Gi),yield(0,vt.sd)(a,1,Gi),yield(0,vt.sd)(a,1+this.fadedExtensions.end,Gi)):(yield(0,vt.sd)(a,0,Gi),yield(0,vt.sd)(a,1,Gi))}}function La(h){h.geometries=[]}const Oi=(0,Mi.vt)(),Gi=(0,de.vt)(),qr=(0,de.vt)(),ja=(0,vt.vt)();var Bt,h;(h=Bt||(Bt={}))[h.LINE=0]="LINE",h[h.RAY=1]="RAY",h[h.GROUND_RAY=2]="GROUND_RAY",h[h.FADED=3]="FADED";const Ua=1/3,Va={start:Ua,end:Ua};var Ni=se(8675);class el extends Bn{constructor(a){super(a),this._location=(0,de.vt)(),this._direction=(0,de.fA)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,Mt.fA)(1,0,1,1),this._renderOccluded=Ve.m$.OccludeAndTransparent,this.applyProperties(a)}createObject3DResourceFactory(a){return{view:a,createResources:y=>this._createObject3DResources(y),destroyResources:tl,recreateGeometry:(y,F)=>this._recreateObject3DGeometry(y,F),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(a){return{view:a,createResources:()=>this._createDrapedResources(),destroyResources:il,recreateGeometry:y=>this._recreateDrapedGeometry(y)}}get location(){return this._location}set location(a){(0,oe.p)(this._location,a)||((0,oe.c)(this._location,a),this._updateGeometry())}get direction(){return this._direction}set direction(a){(0,oe.p)(this._direction,a)||((0,oe.c)(this._direction,a),this._updateGeometry())}setDirectionFromPoints(a,y){(0,oe.n)(this._direction,(0,oe.d)(this._direction,y,a)),this._updateGeometry()}get width(){return this._width}set width(a){a!==this._width&&(this._width=a,this._updateMaterial())}get offset(){return this._offset}set offset(a){a!==this._offset&&(this._offset=a,this._updateGeometry())}get length(){return this._length}set length(a){a!==this._length&&(this._length=a,this._updateGeometry())}get color(){return this._color}set color(a){(0,_t.a)(a,this._color)||((0,_t.c)(this._color,a),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateMaterial())}_createObject3DResources(a){const y=new Gt.W(this.materialParameters),F=new Array;return this._createObject3DGeometry(y,a,F),{material:y,geometries:F,forEach:$=>{$(y),F.forEach($)}}}_recreateObject3DGeometry(a,y){a.geometries.length=0,this._createObject3DGeometry(a.material,y,a.geometries)}_createObject3DGeometry(a,y,F){const[$,ee]=za(a);y.addGeometry($),y.addGeometry(ee),F.push($),F.push(ee),this._updateVerticesObject3D(y)}_createDrapedResources(){const a=new Gt.W(this.materialParameters),y=(0,ge.wB)(()=>this.view.state.contentPixelRatio,()=>this.drapedResources.recreateGeometry());return{material:a,geometries:this._createDrapedGeometry(a),pixelRatioHandle:y}}_recreateDrapedGeometry(a){a.geometries=this._createDrapedGeometry(a.material)}_createDrapedGeometry(a){const y=za(a);return this._updateVerticesDraped(y),y.map(F=>new Yn.$(F))}_updateMaterial(){const{materialParameters:a}=this;this.object3dResources.resources?.material.setParameters(a),this.drapedResources.resources?.material.setParameters(a)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const a=this.object3dResources.object;a&&this._updateVerticesObject3D(a)}}_updateVerticesObject3D(a){const y=this.view.state.camera;y.projectToScreen(this.location,Qn),(0,oe.g)(oi,this.location,this.direction),y.projectToScreen(oi,sn),(0,Xe.S8)(sn,(0,Xe.Re)(sn,sn,Qn)),this._updateVertexAttributesObject3D(y,a,0,Qn,sn,1),this._updateVertexAttributesObject3D(y,a,1,Qn,sn,-1)}_updateVertexAttributesObject3D(a,y,F,$,ee,te){const ie=y.geometries[F],ne=ie.getMutableAttribute(Fe.r.POSITION)?.data;if(!ne)return;const{start:ae,end:le}=Ha(ee,$,te,this.offset,this.width,this.length);a.unprojectFromScreen((0,xe.PR)(ae),oi),ne[0]=oi[0],ne[1]=oi[1],ne[2]=oi[2],a.unprojectFromScreen((0,xe.PR)(le),oi),ne[3]=oi[0],ne[4]=oi[1],ne[5]=oi[2],y.geometryVertexAttributeUpdated(ie,Fe.r.POSITION)}_updateVerticesDraped(a){const{view:{basemapTerrain:{overlayManager:y},state:{contentPixelRatio:F}}}=this,{location:$,width:ee,length:te,offset:ie}=this,ne=nl;ne.spatialReference=y.renderer.spatialReference,ne.x=$[0],ne.y=$[1];const ae=this.view.overlayPixelSizeInMapUnits(ne)*F,le=ee*ae,ue=te*ae,_e=ie*ae;this._updateVertexAttributesDraped(a[0],le,ue,_e,-1),this._updateVertexAttributesDraped(a[1],le,ue,_e,1)}_updateVertexAttributesDraped(a,y,F,$,ee){const te=a.getMutableAttribute(Fe.r.POSITION)?.data;if(!te)return;const{location:ie,direction:ne}=this,{start:ae,end:le}=Ha(ne,ie,ee,$,y,F);te[0]=ae[0],te[1]=ae[1],te[2]=Xn.bi,te[3]=le[0],te[4]=le[1],te[5]=Xn.bi,a.invalidateBoundingInfo()}}function za(h){return[(0,it.Z8)(h,[(0,de.vt)(),(0,de.vt)()]),(0,it.Z8)(h,[(0,de.vt)(),(0,de.vt)()])]}function Ha(h,a,y,F,$,ee){const te=(0,Xe.hs)(Ga,(0,Xe.hZ)(Ga,h[1]*y,h[0]*-y),F+$/2),ie=(0,Xe.WQ)(Kn,(0,Xe.WQ)(Kn,(0,Xe.WQ)(Kn,a,(0,Xe.hs)(Kn,h,ee/2)),te),te);return{start:ie,end:(0,Xe.WQ)(Na,ie,(0,Xe.hs)(Na,h,-ee))}}function tl(h){h.geometries.length=0}function il(h){h.pixelRatioHandle.remove(),h.geometries=[]}const oi=(0,de.vt)(),Ga=(0,gt.vt)(),Kn=(0,gt.vt)(),Na=(0,gt.vt)(),Qn=(0,xe.gs)(),sn=(0,xe.gs)(),nl=(0,Ni.T)(0,0,void 0,null);var Zi=se(2296),Ge=se(92771),Ct=se(62789);class kn extends As{constructor(a){super(a),this._resources=null,this._transform=(0,Ct.vt)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(a){(0,Ge.C)(this._transform,a),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const a=this._resources.object,y=this.view._stage;y.removeMany(a.geometries),a.removeAllGeometries(),this.createGeometries(a),a.visible=this.visible,y.addMany(a.geometries)}createResources(){this.destroyResources();const a=this.view._stage;if(!a)return;const y=new Ps.x(a,{pickable:!1,updatePolicy:Fn.q.SYNC}),F=new Ts.B({castShadow:!1});F.transformation=this._transform,this.createExternalResources(),this.createGeometries(F),a.addMany(F.geometries),this.forEachExternalMaterial($=>a.add($)),a.add(F),y.add(F),F.visible=this.visible,this._resources={layer:y,object:F}}destroyResources(){const a=this.view._stage;null!=this._resources&&a&&(a.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial(y=>{a.remove(y)}),a.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(a){null!=this._resources&&(this._resources.object.visible=a)}}var Sn=se(69307),an=se(89082),Jn=se(94302),sl=se(14064);class Ls extends kn{constructor(a){super(a),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,Mt.fA)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,Mt.fA)(1,1,1,1),this._elevationInfo=null,this.applyProperties(a)}get geometry(){return this._geometry}set geometry(a){this._geometry=a,this.recreateGeometry()}get size(){return this._size}set size(a){if(a!==this._size){const y=this._preferredTextureSize;this._size=a,y<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(a){(0,_t.a)(a,this._color)||((0,_t.c)(this._color,a),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(a){this._pixelSnappingEnabled!==a&&(this._pixelSnappingEnabled=a,this._updateMaterial())}get primitive(){return this._primitive}set primitive(a){this._primitive!==a&&(this._primitive=a,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(a){a!==this._outlineSize&&(this._outlineSize=a,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(a){(0,_t.a)(a,this._outlineColor)||((0,_t.c)(this._outlineColor,a),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(a){this._elevationInfo=a,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){const a=this.object;if(null==a)return;const y=a.geometries[0];if(null==y)return;const F=y.getMutableAttribute(Fe.r.SIZE).data,$=this._geometrySize;F[0]=$,F[1]=$,a.geometryVertexAttributeUpdated(a.geometries[0],Fe.r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,Jn.ny)(this._primitive),distanceFieldBoundingBox:Jn.PY,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/Jn.CN}createExternalResources(){this._texture=(0,Jn.sZ)(this._primitive,this._preferredTextureSize),this._material=new sl.R(this._materialParameters,this.view.state.viewingMode===yn.RT.Global);const a=this.view._stage;this._texture.load(a.renderView.renderingContext),a.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(a){const y=this._createRenderGeometry();null!=y&&a.addGeometry(y)}forEachExternalMaterial(a){this._material&&a(this._material)}get _preferredTextureSize(){return(0,me.qE)(2*this._geometrySize,16,128)}calculateMapBounds(a){const y=this.object?.geometries[0];if(!y)return!1;const F=y.attributes.get(Fe.r.POSITION).data;return(0,yi.F)(F,this.view.renderCoordsHelper.spatialReference,Za,this.view.spatialReference),(0,Zi.Hq)(a,Za),!0}_createRenderGeometry(){const{geometry:a,_material:y}=this;if(null==a||null==y)return null;const{renderCoordsHelper:F,elevationProvider:$}=this.view,ee=(0,Sn.nG)(a,$,an.F.fromElevationInfo(this.elevationInfo),F),te=(0,oe.i)(Ee.rq.get(),a.x,a.y,ee),ie=Ee.rq.get();(0,yi.F)(te,a.spatialReference,ie,F.spatialReference);const ne=this._geometrySize;return(0,it.DJ)(y,{position:ie,size:[ne,ne],centerOffsetAndDistance:[0,0,0,1]})}}const Za=(0,de.vt)();var js=se(83346),Fa=se(36884),qt=se(25079);class al extends Bn{constructor(a){super(a),this._maxSize=0,this._position=(0,de.vt)(),this._up=(0,de.vt)(),this._right=(0,de.vt)(),this._renderOccluded=Ve.m$.OccludeAndTransparent,this._color=(0,Mt.fA)(1,0,0,1),this._outlineColor=(0,Mt.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=Ve.m$.Opaque,this.applyProperties(a)}createObject3DResourceFactory(a){return{view:a,createResources:y=>this._createObject3DResources(y),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(a){return{view:a,createResources:()=>this._createDrapedResources(),destroyResources:ol}}get renderOccluded(){return this._renderOccluded}set renderOccluded(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateQuadMaterial())}get color(){return this._color}set color(a){(0,_t.c)(this._color,a),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(a){(0,_t.c)(this._outlineColor,a),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(a){const y=0===this._outlineSize!=(0===a);this._outlineSize=a,y?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(a){a!==this._size&&(this._size=a,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(a){this._outlineRenderOccluded=a,this._updateOutlineMaterial()}set geometry({previous:a,center:y,next:F}){this._maxSize=Math.min((0,oe.j)(y,a),(0,oe.j)(y,F))/3,(0,oe.n)(this._up,(0,oe.d)(this._up,a,y)),(0,oe.n)(this._right,(0,oe.d)(this._right,F,y)),(0,oe.c)(this._position,y),this.recreateGeometry()}_createObject3DResources(a){const y=new qt.v(this._quadMaterialParameters),F=0===this._outlineSize?void 0:new Gt.W(this._outlineMaterialParameters);return this._createObject3DGeometries(a,y,F),{quadMaterial:y,outlineMaterial:F,forEach:$=>{$(y),F&&$(F)}}}_createObject3DGeometries(a,y,F){if((0,oe.p)(this._up,de.uY)&&(0,oe.p)(this._right,de.uY))return;const $=this._createGeometries(y,F);for(const ee of $)a.addGeometry(ee);this._updateTransformObject3D(a)}_createDrapedResources(){const a=new qt.v(this._quadMaterialParameters),y=0===this._outlineSize?void 0:new Gt.W(this._outlineMaterialParameters),F=this._createGeometries(a,y).map($=>new Yn.$($));return this._setTransformDraped(F),{quadMaterial:a,outlineMaterial:y,geometries:F,pixelRatioHandle:(0,ge.wB)(()=>this.view.state.contentPixelRatio,()=>this.drapedResources.recreateGeometry())}}_createGeometries(a,y){const{up:F,right:$,corner:ee}=this._getVertices(),te=function rl(h,a,y,F){return new Fa.V(F,[[Fe.r.POSITION,new js.n([0,0,0,...a,...h,...y],[0,1,2,1,2,3],3,!0)]])}(F,$,ee,a);return y?[te,(0,it.Z8)(y,[F,ee,$])]:[te]}_getVertices(){let a=this._up,y=this._right;const F=(0,oe.g)(Ee.rq.get(),a,y);return this.isDraped&&(a=(0,oe.c)(Ee.rq.get(),a),y=(0,oe.c)(Ee.rq.get(),y),a[2]=0,y[2]=0,F[2]=0),{up:a,right:y,corner:F}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(a=this.object3dResources.object){if(!a)return;const F=this._size*this.view.state.camera.computeScreenPixelSizeAt(this._position),$=Math.min(this._maxSize,F);(0,Ge.kN)(Si,this._position),(0,Ge.hs)(Si,Si,[$,$,$]),a.transformation=Si}_setTransformDraped(a){if(0===a.length)return;const{view:{basemapTerrain:{overlayManager:y},state:{contentPixelRatio:F}}}=this,{_position:$,_size:ee}=this,te=(0,oe.c)(Ee.rq.get(),$);te[2]=Xn.bi;const ie=ll;ie.spatialReference=y.renderer.spatialReference,ie.x=te[0],ie.y=te[1];const ne=ee*(this.view.overlayPixelSizeInMapUnits(ie)*F),ae=Math.min(this._maxSize,ne);(0,Ge.kN)(Si,te),(0,Ge.hs)(Si,Si,[ae,ae,1]);for(const le of a)le.transformation=Si}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}function ol(h){h.pixelRatioHandle.remove(),h.geometries=[]}const Si=(0,Ct.vt)(),ll=(0,Ni.T)(0,0,void 0,null);var qn=se(29280),ei=se(56083),cl=se(26161),Us=se(3548),hl=se(94041),Ba=se(49973);class xn extends hl.b{sortUniqueHints(a){return a.sort((y,F)=>(F instanceof Ba.c?F.length:0)-(y instanceof Ba.c?y.length:0))}visualizeIntersectionPoint(a,y){const{spatialReference:F,view:$}=y,ee=wn(y);return(0,Se.DQ)(new Ls({view:$,primitive:"circle",geometry:(0,qn.io)(a.intersectionPoint,F),elevationInfo:a.isDraped?Te.Tq:Te.qt,size:20,outlineSize:2,color:ee.intersectionPointColor,outlineColor:ee.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(a,y){const{view:F,spatialReference:$}=y,ee=wn(y),te=xi(a.point,a.domain,y);return(0,Se.DQ)(new Ls({view:F,primitive:"circle",geometry:(0,qn.io)(te,$),elevationInfo:es(a),size:20,outlineSize:2,color:ee.pointColor,outlineColor:ee.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(a,y){const{view:F,spatialReference:$}=y,ee=wn(y),te=xi(a.lineStart,a.domain,y),ie=xi(a.lineEnd,a.domain,y);return(0,Se.DQ)(function dl(h,a,y,F,$,ee,te,ie=!1,ne=!0,ae=!0){const le=Fi(a,F,$,ee,ie),ue=Fi(y,F,$,ee,ie),_e=new $n({view:ee,extensionType:Bt.FADED,start:le,end:ue,isDraped:ie,color:te.lineColor,renderOccluded:ie?Ve.m$.OccludeAndTransparent:Ve.m$.Opaque,renderGroup:en.O7.SnappingHint,isDecoration:!0});switch(h){case Us.H3.TARGET:_e.width=ei.N.lineHintWidthTarget,_e.fadedExtensions={start:0,end:ei.N.lineHintFadedExtensions};break;case Us.H3.REFERENCE_EXTENSION:_e.width=ei.N.lineHintWidthReference,_e.fadedExtensions={start:0,end:0};break;case Us.H3.REFERENCE:_e.width=ei.N.lineHintWidthReference,_e.fadedExtensions={start:ne?ei.N.lineHintFadedExtensions:0,end:ae?ei.N.lineHintFadedExtensions:0}}return _e.attached=!0,_e}(a.type,te,ie,$,es(a),F,ee,a.isDraped,a.fadeLeft,a.fadeRight))}visualizeParallelSign(a,y){const{view:F,spatialReference:$}=y,ee=wn(y),{isDraped:te}=a,ie=es(a),ne=xi(a.lineStart,a.domain,y),ae=xi(a.lineEnd,a.domain,y),le=Fi(ne,$,ie,F,te),ue=Fi(ae,$,ie,F,te),_e=(0,oe.m)(ue,le,ue,.5),be=new el({view:F,attached:!1,offset:ei.N.parallelLineHintOffset,length:ei.N.parallelLineHintLength,width:ei.N.parallelLineHintWidth,color:ee.parallelSignColor,location:_e,renderOccluded:te?Ve.m$.OccludeAndTransparent:Ve.m$.Opaque,isDraped:te,renderGroup:en.O7.SnappingHint,isDecoration:!0});return be.setDirectionFromPoints(le,_e),be.attached=!0,(0,Se.DQ)(be)}visualizeRightAngleQuad(a,y){const{view:F,spatialReference:$}=y,ee=wn(y),te=es(a),{isDraped:ie}=a,ne=xi(a.previousVertex,a.domain,y),ae=xi(a.centerVertex,a.domain,y),le=xi(a.nextVertex,a.domain,y),ue=Fi(ne,$,te,F,ie),_e=Fi(ae,$,te,F,ie),be=Fi(le,$,te,F,ie);return(0,Se.DQ)(new al({view:F,attached:!0,color:ie?ee.rightAngleColorDraped:ee.rightAngleColor,renderOccluded:ie?Ve.m$.OccludeAndTransparent:Ve.m$.Transparent,outlineRenderOccluded:ie?Ve.m$.OccludeAndTransparent:Ve.m$.Opaque,outlineColor:ee.rightAngleOutlineColor,outlineSize:ei.N.rightAngleHintOutlineSize,size:ei.N.rightAngleHintSize,isDraped:ie,geometry:{previous:ue,center:_e,next:be},renderGroup:en.O7.SnappingHint,isDecoration:!0}))}}function wn(h){const{effectiveTheme:a}=h.view,y=ye.A.toUnitRGBA(a.accentColor),F=[0,0,0,0];return{intersectionPointColor:F,intersectionPointOutlineColor:y,pointColor:F,pointOutlineColor:y,lineColor:y,lineOutlineColor:void 0,parallelSignColor:y,rightAngleColor:y,rightAngleColorDraped:ye.A.toUnitRGBA((0,De._L)(a.accentColor,.5)),rightAngleOutlineColor:y}}function xi(h,a,{selfSnappingZ:y,view:F,spatialReference:$}){return a&cl.n.SELF&&(0,qn.Ex)(h)&&null!=y?(0,qn.FH)(h,y,F,$):h}function es(h){return h.isDraped?Te.Tq:Te.qt}function Fi(h,a,y,F,$){const ee=(0,de.vt)();return $?(0,yi.F)(h,a,ee,F.basemapTerrain.overlayManager.renderer.spatialReference):(0,ve.X)(h,a,y,F,ee),ee}var Vs=se(14624);function zs(h){const a=h.graphic;return a?[(0,ge.wB)(()=>"visible"in h?h.visible:h.displaying,y=>{y&&a.notifyMeshTransformChanged({action:Vs.$.EnableFastUpdates})},{...ge.pc}),(0,Se.hA)(()=>a.notifyMeshTransformChanged({action:Vs.$.DisableFastUpdates}))]:[]}var ul=se(24639);function rn(h,a){a&&Object.assign(h,a)}class pl{constructor(a){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=Ve.m$.Opaque,this.color=a.accent}}class Hs{constructor({colors:a,...y}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=a.accent,this.outlineColor=a.outline,this.renderOccluded=Ve.m$.Opaque,this.hoverOutlineColor=a.selectedOutline,rn(this,y)}applyColor(a){this._apply(this.color,a)}applyOutline(a){this._apply(this.outlineColor,a)}applyHoverOutline(a){this._apply(this.hoverOutlineColor,a)}_apply(a,y){y.setParameters({color:(0,De.QP)(a),renderOccluded:this.renderOccluded})}}class gl{constructor({colors:a,...y}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=Ve.m$.Transparent,this.minSquaredEdgeLength=900,this.color=(0,De._L)(a.accent,.5),this.hoverColor=a.accent,rn(this,y)}applyColor(a){this._apply(this.color,a)}applyHover(a){this._apply(this.hoverColor,a)}_apply(a,y){y.setParameters({color:(0,De.QP)(a),renderOccluded:this.renderOccluded})}}class _l{constructor(a){this.vertex=new Hs({colors:a,color:a.accent,outlineColor:a.outline}),this.edge=new Hs({colors:a,color:(0,De.Vl)((0,De._L)(a.accent,2/3),.5),outlineColor:(0,De._L)(a.outline,.5),size:8,collisionPadding:8}),this.selected=new Hs({colors:a,color:a.selected,outlineColor:a.outline}),this.edgeOffset=new gl({colors:a})}}class Gs{constructor({colors:a,...y}){this.width=1.5,this.stipplePattern=(0,ul.wk)(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=Ve.m$.OccludeAndTransparent,this.color=a.selected,this.stippleOffColor=a.outline,this.innerColor=a.selected,rn(this,y)}apply(a){a.color=(0,De.QP)(this.color),a.width=this.width,a.stipplePattern=this.stipplePattern,a.stippleOffColor=(0,De.QP)(this.stippleOffColor),a.falloff=this.falloff,a.innerWidth=this.innerWidth,a.innerColor=(0,De.QP)(this.innerColor),a.renderOccluded=this.renderOccluded}}class fl{constructor({colors:a,...y}){this.size=4,this.outlineSize=1,this.shape="square",this.color=a.selected,this.outlineColor=a.outline,rn(this,y)}apply(a){a.color=(0,De.QP)(this.color),a.size=this.size,a.outlineSize=this.outlineSize,a.outlineColor=(0,De.QP)(this.outlineColor),a.primitive=this.shape}}class ts{constructor({colors:a,...y}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=a.selected,this.glowColor=a.accent,this.heightFillColor=a.accent,rn(this,y)}apply(a,y=1){const F={glowColor:ye.A.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:ye.A.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*y*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in a?a.style=F:a.laserlineStyle=F}}class ml{constructor(a){this.outline=new Gs({colors:a,color:a.stippleOff,renderOccluded:Ve.m$.OccludeAndTransparentStencil,stippleOffColor:a.stippleOn,innerWidth:0}),this.staged=new Gs({colors:a,color:a.stippleOn,renderOccluded:Ve.m$.OccludeAndTransparentStencil,innerColor:a.stagedSolid,stippleOffColor:a.stippleOff}),this.shadowStyle=new ts({colors:a,globalAlpha:.3,glowColor:a.accent,glowFalloff:8,glowWidth:8,innerColor:a.selected,innerWidth:1})}}class vl{constructor(a){this.outline=new fl({colors:a,color:a.selected,outlineColor:a.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ts({colors:a,globalAlpha:.3,glowColor:a.accent,glowFalloff:1.5,glowWidth:6,innerColor:a.selected,innerWidth:1,radius:2})}}class yl extends Gs{constructor({colors:a,...y}){super({colors:a}),this.extensionType=Bt.GROUND_RAY,rn(this,y)}}class Ml{constructor(a){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new ml(a),this.pointObjects=new vl(a),this.heightPlane=new ts({colors:a,globalAlpha:.3,glowColor:a.accent,glowFalloff:8,glowWidth:8,innerColor:a.selected,innerWidth:1}),this.heightBox=new ts({colors:a,globalAlpha:.3,glowColor:a.accent,glowFalloff:8,glowWidth:8,innerColor:a.selected,innerWidth:0,heightFillColor:a.accent}),this.zVerticalLine=new yl({colors:a,color:(0,De._L)(a.accent,.5),falloff:2,innerColor:(0,De._L)(a.selected,0),renderOccluded:Ve.m$.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:Bt.GROUND_RAY})}}let Nt=class extends pe.A{constructor(h){super(h)}get colors(){const h=this.getTheme().accentColor,a=h.a;return{accent:h,contrast:(0,De.bJ)(h),selected:ye.A.fromArray([255,255,255,a]),selectedOutline:ye.A.fromArray([255,255,255,a]),staged:ye.A.fromArray([12,207,255,a]),stagedSolid:ye.A.fromArray([12,207,255,1]),outline:ye.A.fromArray([0,0,0,.5*a]),stippleOn:ye.A.fromArray([255,255,255,1]),stippleOff:ye.A.fromArray([0,0,0,.5])}}get visualElements(){return new Ml(this.colors)}get manipulators(){return new _l(this.colors)}get zManipulator(){return new pl(this.colors)}};(0,re._)([(0,ce.MZ)()],Nt.prototype,"colors",null),(0,re._)([(0,ce.MZ)()],Nt.prototype,"visualElements",null),(0,re._)([(0,ce.MZ)()],Nt.prototype,"manipulators",null),(0,re._)([(0,ce.MZ)()],Nt.prototype,"zManipulator",null),(0,re._)([(0,ce.MZ)()],Nt.prototype,"getTheme",void 0),Nt=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.settings")],Nt);var Qt=se(42425),bl=se(23234),is=se(81897),Wa=se(21031);class Bi extends Bn{constructor(a){super(a),this._attachmentOrigin=(0,Ni.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new Qt.A,this._geometry=null,this._width=1,this._color=(0,Mt.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,Mt.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ve.m$.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=a.view.spatialReference,this._laserline=new On({view:a.view,isDecoration:a.isDecoration}),this.applyProperties(a),this.attached=a.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(a){return{view:a,createResources:y=>this._createObject3DResources(y),destroyResources:Xa,recreateGeometry:(y,F)=>{y.geometries.length=0,this._recreateGeometry(F,y.material,y.geometries)}}}createDrapedResourceFactory(a){return{view:a,createResources:()=>this._createDrapedResources(),destroyResources:Xa,recreateGeometry:y=>{y.geometries=this._createRenderGeometriesDraped(y.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(a){this._laserline.attached=this._laserlineAttached,a&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(a){this._geometry=a,this.recreateGeometry()}get width(){return this._width}set width(a){a!==this._width&&(this._width=a,this._updateMaterial())}get color(){return this._color}set color(a){(0,_t.a)(a,this._color)||((0,_t.c)(this._color,a),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(a){a!==this._innerWidth&&(this._innerWidth=a,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(a){(0,_t.a)(a,this._innerColor)||((0,_t.c)(this._innerColor,a),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(a){const y=null!=a!=(null!=this._stipplePattern);this._stipplePattern=a,y?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(a){a&&this._stippleOffColor&&(0,_t.a)(a,this._stippleOffColor)||(this._stippleOffColor=a?(0,Mt.o8)(a):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(a){a!==this._falloff&&(this._falloff=a,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(a){this._elevationInfo=a,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(a){this._laserlineStyle=a,this._laserline.attached=this._laserlineAttached,null!=a&&(this._laserline.style=a)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=a,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const a=this.object3dResources.resources?.geometries;if(!a||0===a.length)return null;(0,oe.i)(ln,0,0,0);let y=0;for(const F of a)F.computeAttachmentOrigin(Ya)&&((0,oe.g)(ln,ln,Ya),y++);return 0===y?null:((0,oe.h)(ln,ln,1/y),this.view.renderCoordsHelper.fromRenderCoords(ln,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ve.m$.OccludeAndTransparentStencil?Ve.m$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(a,y,F){this._createRenderGeometries(y,F);for(const $ of F)a.addGeometry($);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(a){const y=new Gt.W(this._materialParameters),F=new Array;return this._recreateGeometry(a,y,F),{material:y,geometries:F,forEach:$=>{$(y),F.forEach($)}}}_createDrapedResources(){const a=new Gt.W(this._materialParameters);return{material:a,geometries:this._createRenderGeometriesDraped(a)}}_createRenderGeometriesDraped(a){const{geometry:y,view:F}=this,$=F.basemapTerrain.spatialReference;return null==y||null==$?[]:(0,Wa.A)(y,$).lines.map(({position:ee})=>new Yn.$((0,is.t)(a,{overlayInfo:{spatialReference:$,renderCoordsHelper:F.renderCoordsHelper},attributeData:{position:ee},removeDuplicateStartEnd:this._isClosed})))}calculateMapBounds(a){if(null==this.object3dResources.resources)return!1;const y=this.view.renderCoordsHelper;for(const F of this.object3dResources.resources.geometries){const $=F.attributes.get(Fe.r.POSITION),ee=(0,Wn.jh)($.data.length);(0,bl.projectBuffer)($.data,y.spatialReference,0,ee,this.view.spatialReference,0),(0,Zi.Hq)(a,ee)}return!0}_createRenderGeometries(a,y){const F=this.geometry;if(null==F)return;const $=(0,Wa.C)(F,this.view.elevationProvider,this.view.renderCoordsHelper,an.F.fromElevationInfo(this.elevationInfo??new Pe.A({mode:(0,Te.w7)(F,null)}))),ee=new Array;for(const{position:te,mapPositions:ie}of $.lines)y.push((0,is.t)(a,{mapPositions:ie,attributeData:{position:te},removeDuplicateStartEnd:this._isClosed})),ee.push(te);this._laserline.pathVerticalPlane=ee}}function Xa(h){h.geometries=[]}const Ya=(0,de.vt)(),ln=(0,de.vt)();var $a=se(45434),Wt=se(74567),Ka=se(91074),Qa=se(49178),wi=se(55128),ka=se(65388),ns=se(38499),ss=se(96443),ri=se(14356),Ol=se(62938);class Sl extends nn.w{constructor(a,y){super(a,y,new tn.$(Ol.S,()=>se.e(9052).then(se.bind(se,89052))),Ja)}initializePipeline(a){const{oitPass:y,output:F,transparent:$,cullFace:ee,shadingEnabled:te}=a,ie=y===ss.Y.NONE,ne=y===ss.Y.FrontFace;return(0,Tt.Ey)({blending:(0,Wt.RN)(F)&&$?(0,ri.Yf)(y):null,culling:(0,Tt.Xt)(ee),depthTest:{func:ne?di.MT.LESS:te?di.MT.LEQUAL:di.MT.LESS},depthWrite:(0,ri.z5)(a),drawBuffers:(0,ri.m6)(y,F),colorWrite:Tt.kn,polygonOffset:ie||ne?null:ri.SE})}}const Ja=new Map([[Fe.r.POSITION,0],[Fe.r.NORMAL,1],[Fe.r.OFFSET,2]]);var qa=se(66874),eo=se(43167),to=se(35094);class Di extends to.E{constructor(){super(...arguments),this.cullFace=Qe.s2.None,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=qa.I.None,this.emissionSource=eo.ZX.None,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}get discardInvisibleFragments(){return this.transparent}}(0,re._)([(0,yt.W)({count:Qe.s2.COUNT})],Di.prototype,"cullFace",void 0),(0,re._)([(0,yt.W)()],Di.prototype,"transparent",void 0),(0,re._)([(0,yt.W)()],Di.prototype,"writeDepth",void 0),(0,re._)([(0,yt.W)()],Di.prototype,"screenSizeEnabled",void 0),(0,re._)([(0,yt.W)()],Di.prototype,"shadingEnabled",void 0),(0,re._)([(0,yt.W)()],Di.prototype,"terrainDepthTest",void 0),(0,re._)([(0,yt.W)()],Di.prototype,"cullAboveTerrain",void 0);var xl=se(28700);class Ns extends Ve.im{constructor(a){super(a,Dl),this._configuration=new Di,this.vertexAttributeLocations=Ja,this.supportsEdges=!0,this.produces=new Map([[wi.N.OPAQUE_MATERIAL,y=>y===Wt.V.Highlight||(0,Wt.zW)(y)&&!this.parameters.transparent],[wi.N.TRANSPARENT_MATERIAL,y=>(0,Wt.zW)(y)&&this.parameters.transparent&&this.parameters.writeDepth],[wi.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,y=>(0,Wt.zW)(y)&&this.parameters.transparent&&!this.parameters.writeDepth]])}getConfiguration(a,y){return this._configuration.output=a,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.oitPass=y.oitPass,this._configuration.terrainDepthTest=y.terrainDepthTest&&(0,Wt.RN)(a),this._configuration.cullAboveTerrain=y.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=xl.Q}intersect(a,y,F,$,ee,te){if(this.parameters.screenSizeEnabled){const ie=a.attributes.get(Fe.r.OFFSET),ne={applyToVertex:(ae,le,ue,_e)=>{const be=(0,oe.i)(io,ie.data[3*_e],ie.data[3*_e+1],ie.data[3*_e+2]),we=(0,oe.i)(Tl,ae,le,ue);return(0,oe.h)(be,be,this.parameters.screenSizeScale*F.camera.computeScreenPixelSizeAt(be)),(0,oe.g)(we,we,be),[we[0],we[1],we[2]]},applyToAabb:ae=>{const le=(0,Zi.gX)(ae,io);return(0,Zi.hs)(ae,this.parameters.screenSizeScale*F.camera.computeScreenPixelSizeAt(le))}};(0,Qa.Uy)(a,F,$,ee,ne,te)}else(0,Qa.Uy)(a,F,$,ee,void 0,te)}createGLMaterial(a){return new wl(a)}createBufferWriter(){return new Al(this.parameters.screenSizeEnabled)}}class wl extends Ka.A{beginSlot(a){return this.getTechnique(Sl,a)}}class Dl extends Ve.qA{constructor(){super(...arguments),this.color=(0,Mt.fA)(1,1,1,1),this.shadingTint=(0,Mt.fA)(0,0,0,.25),this.shadingDirection=(0,oe.n)((0,de.vt)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Qe.s2.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}get transparent(){return this.color[3]<1||this.forceTransparentMode}}class Al{constructor(a){this.screenSizeEnabled=a;const y=(0,Cs.BP)().vec3f(Fe.r.POSITION).vec3f(Fe.r.NORMAL);this.screenSizeEnabled&&y.vec3f(Fe.r.OFFSET),this.vertexBufferLayout=y}elementCount(a){return a.get(Fe.r.POSITION).indices.length}write(a,y,F,$,ee,te){if((0,ns.SA)(F,$,this.vertexBufferLayout,a,y,ee,te),this.screenSizeEnabled){if(!F.has(Fe.r.OFFSET))throw new Error(`${Fe.r.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const ie=F.get(Fe.r.OFFSET);(0,ka.vA)(3===ie.size);const ne=ee.getField(Fe.r.OFFSET,$a.xs);if(!ne)throw new Error("unable to acquire view for "+Fe.r.OFFSET);(0,ns.Hk)(ie,y,ne,te)}}}}const io=(0,de.vt)(),Tl=(0,de.vt)();class no extends kn{constructor(a){super(a),this.view=null,this._renderOccluded=Ve.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,Mt.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,Mt.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(a)}get renderOccluded(){return this._renderOccluded}set renderOccluded(a){a!==this._renderOccluded&&(this._renderOccluded=a,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(a){this._vertices=a,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(a){this._spatialReference=a,this.recreateGeometry()}get color(){return this._color}set color(a){(0,_t.a)(a,this._color)||((0,_t.c)(this._color,a),this._updateMaterial())}get size(){return this._size}set size(a){a!==this._size&&(this._size=a,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(a){(0,_t.a)(a,this._outlineColor)||((0,_t.c)(this._outlineColor,a),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(a){a!==this._outlineSize&&(this._outlineSize=a,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(a){this._elevationInfo=a,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const a=this.vertices;if(null==a||0===a.length)return[];const $=function El(h,a,y,F,$){const ee=(0,Wn.jh)(3*h.length),te=(0,Wn.jh)(ee.length);h.forEach((ae,le)=>{ee[3*le]=ae[0],ee[3*le+1]=ae[1],ee[3*le+2]=ae.length>2?ae[2]:0});const ie=(0,Sn.au)(ee,a,0,te,0,ee,0,ee.length/3,y,F,$);return{numVertices:h.length,position:ee,mapPositions:te,projectionSuccess:null!=ie,sampledElevation:ie}}(a,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,an.F.fromElevationInfo(this.elevationInfo)),ee=[],te=$.numVertices,ie=$.position;for(let ne=0;ne<te;++ne){const ae=(0,oe.i)(Pl,ie[3*ne],ie[3*ne+1],ie[3*ne+2]),le=so(this._vertexMaterial,.5,ae),ue=so(this._vertexOutlineMaterial,.5,ae);ee.push({vertexGeometry:le,vertexOutlineGeometry:ue})}return ee}createGeometries(a){const y=this._createRenderGeometries();for(const{vertexGeometry:F,vertexOutlineGeometry:$}of y)a.addGeometry(F),a.addGeometry($)}createExternalResources(){this._vertexMaterial=new Ns({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Qe.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Ns({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:Qe.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(a){a(this._vertexMaterial),a(this._vertexOutlineMaterial)}}const Pl=(0,de.vt)();function so(h,a,y){return(0,it.CM)(h,a,16,16,{offset:y})}let ui=class extends Qt.A.EventedAccessor{constructor(h){super(h),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}};(0,re._)([(0,ce.MZ)({constructOnly:!0})],ui.prototype,"graphic",void 0),(0,re._)([(0,ce.MZ)()],ui.prototype,"tracking",void 0),(0,re._)([(0,ce.MZ)()],ui.prototype,"displaying",void 0),(0,re._)([(0,ce.MZ)()],ui.prototype,"error",void 0),(0,re._)([(0,ce.MZ)()],ui.prototype,"isDraped",void 0),ui=(0,re._)([(0,Ie.$)("esri.views.3d.layers.graphics.GraphicState")],ui);var ao=se(34098),Rl=se(68104),oo=se(74502),It=se(64015),Cl=se(34703);let Wi=class extends ao.N{constructor(h){super(h),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new Nt({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:h,offset:a,unit:y}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Pe.A({mode:h,offset:a,unit:y})}normalizeCtorArgs(h){if(!h.elevationInfo){const a=h.hasZ??!0;return{...h,elevationInfo:(0,Te.bK)(a)}}return h}initializeGraphic(h){const{view:a}=this,y=this._createGraphicState=new ui({graphic:h});return(0,Se.vE)([a.maskOccludee(h),a.trackGraphicState(y),(0,ge.wB)(()=>({element:this._outlineVisualElement,isDraped:y.isDraped}),({element:F,isDraped:$})=>{F&&(F.isDraped=$)},ge.pc),(0,Cl.fm)(()=>{(0,It.IA)(this.tooltipInfos.mesh,this.geometryToPlace)}),this._setupLoadingIndicator(y),...zs(y)])}makeDrawOperation(){const{geometryType:h}=this,a="circle"!==h&&"rectangle"!==h;return new Rl.O0({view:this.view,manipulators:this.manipulators,geometryType:(0,ao.l)(h),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new oo.IX(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new oo.rT(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new xn,segmentLabels:a?new Zn:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,Te.wF)(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(h){const{view:a}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[h],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(h),(0,Se.hA)();const y=this._settings,F=y.manipulators.vertex,$=new no({view:a,spatialReference:a.spatialReference,vertices:[h],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:F.size,outlineSize:F.outlineSize,renderOccluded:F.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=$;const te=new $n({view:a,extensionType:y.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ve.m$.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=te;const ie=(0,Se.vE)([(0,ge.wB)(()=>y.visualElements.zVerticalLine,ne=>ne.apply(te),ge.Vh),(0,ge.wB)(()=>({selectedColor:(0,De.QP)(y.colors.selected),outlineColor:(0,De.QP)(y.manipulators.vertex.outlineColor)}),({selectedColor:ne,outlineColor:ae})=>{$.color=ne,$.outlineColor=ae},ge.Vh),(0,Se.hA)(()=>{this._activeVertexVisualElement=(0,Oe.pR)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,Oe.pR)(this._verticalLineVisualElement)})]);return $.attached=!0,this._updateVerticalLineVisualElement(h),ie}_updateVerticalLineVisualElement(h){const a=this._verticalLineVisualElement;if(!a)return;const{renderCoordsHelper:y,elevationProvider:F}=this.view;(0,oe.i)(cn,h[0],h[1],h[2]),ro.setFromElevationInfo(this.elevationInfo),cn[2]=(0,Sn.nG)(cn,F,ro,y),y.toRenderCoords(cn,this.view.spatialReference,cn)?(a.setStartEndFromWorldDownAtLocation(cn),a.attached=!0):a.attached=!1}onOutlineChanged(h){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=h,(0,Se.hA)();const a=this.internalGraphicsLayer.elevationInfo,{view:y}=this,F=this._settings,$=new Bi({view:y,geometry:h,elevationInfo:a,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,Te.wF)(this.hasZ,a),attached:!1,isDecoration:!0});this._outlineVisualElement=$;const ee=(0,Se.vE)([(0,ge.wB)(()=>F.visualElements.lineObjects.outline,te=>te.apply($),ge.Vh),(0,ge.wB)(()=>F.visualElements.lineObjects.shadowStyle,te=>te.apply($),ge.Vh),(0,Se.hA)(()=>{this._outlineVisualElement=(0,Oe.pR)(this._outlineVisualElement)})]);return $.attached=!0,$.laserlineEnabled=!0,ee}onRegularVerticesChanged(h){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=h,(0,Se.hA)();const{view:a}=this,y=this._settings,F=y.manipulators.vertex,$=new no({view:a,spatialReference:a.spatialReference,vertices:h,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:F.size,outlineSize:F.outlineSize,renderOccluded:F.renderOccluded,attached:!1,isDecoration:!0}),ee=(0,Se.vE)([(0,ge.wB)(()=>({color:(0,De.QP)(y.manipulators.vertex.color),outlineColor:(0,De.QP)(y.manipulators.vertex.outlineColor)}),({color:te,outlineColor:ie})=>{$.color=te,$.outlineColor=ie},ge.Vh),(0,Se.hA)(()=>{this._verticesVisualElement=(0,Oe.pR)(this._verticesVisualElement)})]);return $.attached=!0,this._verticesVisualElement=$,ee}updateGraphicGeometry(h){if("mesh"!==this.geometryType||"point"!==h?.type)super.updateGraphicGeometry(h);else{const a=this.geometryToPlace;a?.centerAt(h),(0,It.IA)(this.tooltipInfos.mesh,a);const y=this._graphic;a&&y.geometry===a||(y.geometry=a)}}_setupLoadingIndicator(h){const{drawOperation:a}=this;if(!this.geometryToPlace)return a.loading=!1,null;a.loading=!0;const y=(0,Se.hA)(()=>{a.loading=!1});let F;const $=()=>F&&cancelAnimationFrame(F);return(0,Se.vE)([(0,ge.z7)(()=>h.displaying,()=>{$(),F=requestAnimationFrame(()=>y.remove())},{...ge.pc,once:!0}),(0,Se.hA)($),y])}};(0,re._)([(0,ce.MZ)({constructOnly:!0})],Wi.prototype,"elevationInfo",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],Wi.prototype,"geometryType",void 0),(0,re._)([(0,ce.MZ)()],Wi.prototype,"type",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],Wi.prototype,"view",void 0),Wi=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Wi);const ro=new an.F,cn=(0,de.vt)();var Zs=se(89952),Il=se(31178),Pt=se(81142),as=se(56985),Ll=se(85952);function Fs(h){if(null==h||"polyline"!==h.type&&"polygon"!==h.type)return 0;const a="polyline"===h.type?h.paths:h.rings,y=(0,Ll.FD)();for(const F of a)for(let $=0;$<F.length-1;$++){const ee=F[$],te=F[$+1],ie=ee[0]-te[0],ne=ee[1]-te[1];if(ie*ie+ne*ne>y)return Math.atan2(te[1]-ee[1],te[0]-ee[0])}return 0}var Ul=se(66298);function bt(h){return h?.operations?.data.geometry}function Xi(h,a){return function Vl(h,a){return!!h&&"on-the-ground"!==a.mode&&!(0,Te.v9)(a)}(h?.data.coordinateHelper.hasZ(),a)}var ti=se(3969),os=se(25566);function lo(h,a,y){function F(){const ie=y(),ne=ie.sketchOptions.tooltips.effectiveEnabled?ie.activeTooltipInfo:null;return{...ie,activeTooltipInfo:ne}}let $=!1;function ee(ie){$||($=!0,ie(),$=!1)}function te({activeTooltipInfo:ie,sketchOptions:ne,scaleRotateTransform:ae}){ee(()=>{ie&&(ie.sketchOptions=ne,ho(ie,a),function zl(h,a){if("transform-point"!==h?.type)return;if(!a)return h.orientation.actual=void 0,h.size.actual=void 0,h.orientation.visible=!1,void(h.size.visible=!1);const y=a.mode,{size:F,orientationClockwise:$}=a.adapter,{visualVariables:ee}=h.sketchOptions.tooltips,te=ee?.rotation,ie=null!=$&&(null==y||"rotate"===y);h.orientation.actual=ie?(0,Pt.Wq)($,"radians",te?.rotationType??"geographic"):void 0,h.orientation.precision=po(te?.valueType),h.orientation.visible=ie;const ae=ee?.size,le=null!=F&&(null==y||"scale"===y);h.size.actual=le?(0,Pt.d_)(F,ae?.unit??"meters"):void 0,h.size.precision=po(ae?.valueType),h.size.visible=le}(ie,ae)),h.info=ie})}return(0,Se.vE)([(0,ge.wB)(F,te,ge.pc),(0,ge.wB)(()=>{const ie=F(),{activeTooltipInfo:ne}=ie;if(ne)return{context:ie,activeTooltipInfo:ne,key:ne.key,geometry:bt(a)}},(ie,ne)=>{ie&&ne&&ne.key!==ie.key&&ee(()=>co(a,ie.context))},ge.OH),a.on("committed",()=>{queueMicrotask(()=>te(F()))}),(0,It.sZ)(h,{onBeforePaste:()=>{$=!0},onAfterPaste:()=>{co(a,F()),$=!1}})])}function co(h,{activeTooltipInfo:a,callbacks:y}){if(!a)return;y.onBeforeUpdate();const F=bt(h);switch(F?.type){case"mesh":rs(a,F.origin,h,y),"orientation"in a&&"scale"in a&&(0,It.IA)(a,F,y);break;case"point":rs(a,F,h,y)}}function rs(h,a,y,F){const{dx:$,dy:ee,dz:te}=(0,It.mu)(h,a);0===$&&0===ee&&0===te||(F.onMoveStart(),y.operations?.move($,ee,te,ti.Y.NEW_STEP),F.onMove($,ee,te),F.onMoveStop())}function ho(h,a){const y=bt(a),F=y?.type;if(!h||!y||"mesh"!==F&&"point"!==F)return;const $="mesh"===F,ee=$?y.origin:y;h.setLocationFromPoint(ee),uo(h,ee,a),"transform-mesh"===h.type&&$&&(0,It.Ue)(h,y),h.clearInputValues()}function uo(h,a,y){h.elevation.actual=(0,os.Of)(a),h.elevation.visible=!!y.operations?.data.coordinateHelper.hasZ(),h.elevation.readOnly=!1,h.elevation.showAsZ=!0}function po(h){switch(h){case"integer":case"long":return 0;default:return null}}var ls=se(54029),go=se(31610),Hl=se(32954),Gl=se(87477),pi=se(1749),Dn=se(13970),Nl=se(44339),Zl=se(70744),Bs=se(51995),ct=se(93617),cs=se(97669),Ws=se(28377);function _o(h,a,y=(0,Ft.vt)()){return hn(h,(0,xe.WA)(a),y),(0,oe.n)(y.direction,y.direction),y}function hn(h,a,y){return function Fl(h,a,y){const F=(0,xe.sc)((0,Xe.C)(Ee.rq.get(),a));if(F[2]=0,!h.unprojectFromRenderScreen(F,y.origin))return null;const $=(0,xe.sc)((0,Xe.C)(Ee.rq.get(),a));$[2]=1;const ee=h.unprojectFromRenderScreen($,Ee.rq.get());return null==ee?null:((0,oe.d)(y.direction,ee,y.origin),y)}(h,h.screenToRender(a,(0,xe.sc)(Ee.rq.get())),y)}var Wl=se(80009),Re=se(29014);class Ut{constructor(a){this.metadata=void 0,this._camera=new Wl.A,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,Ct.vt)(),this._worldFrame=null,this._renderLocation=(0,de.vt)(),this._renderLocationDirty=!0,this._location=new pi.A({x:0,y:0,z:0}),this._elevationAlignedLocation=new pi.A,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=Re.SJ.None,this._focused=!1,this.events=new Qt.A.EventEmitter,this._screenLocation={screenPointArray:(0,xe.gs)(),renderScreenPointArray:(0,xe.r_)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=a.view.spatialReference,Object.assign(this,a);const y=this.view.state?.camera;y&&this._camera.copyFrom(y)}destroy(){this._applyObjectTransform=Ql,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(a){this._elevationInfo=a,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(a){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=a.slice(),this._updateEngineObject()}set available(a){a!==this._available&&(this._available=a,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,Se.hA)(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}set radius(a){a!==this._radius&&(this._radius=a,this._updateEngineObject())}get radius(){return this._radius}set worldSized(a){a!==this._worldSized&&(this._worldSized=a,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(a){fo(a)&&(this._screenLocationDirty=!0),(0,Ge.C)(this._modelTransform,a),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,Ct.vt)()),function Xl(h,a,y){switch(h.viewingMode){case"local":return(0,Ge.D_)(y),!0;case"global":{const F=(0,Gl.tO)(h.renderCoordsHelper.spatialReference);(0,Zl.n4)(a,0,An,0,F.radius),(0,Nl.z)((0,me.kU)(An[0]),(0,me.kU)(An[1]),y)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(a){this.view.renderCoordsHelper.fromRenderCoords(a,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(a){(0,cs.EL)(a,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(a){(0,cs.EL)(a,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const a=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=a+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,cs.RS)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(a){a!==this._grabbing&&(this._grabbing=a,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(a){a!==this._hovering&&(this._hovering=a,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(a){a!==this._selected&&(this._selected=a,this._updateEngineObject(),this.events.emit("select-changed",{action:a?"select":"deselect"}))}get state(){return this._state}set state(a){a!==this._state&&(this._state=a,this._updateEngineObject())}updateStateEnabled(a,y){y?this.state|=a:this.state&=~a}_setFocused(a){a!==this._focused&&(this._focused=a,this.events.emit("focus-changed",{action:!0===a?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let a;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,fo(this._modelTransform)){const y=this._calculateModelTransformOffset(Kl);a=(0,oe.g)(y,y,this.renderLocation)}else a=this.renderLocation;this._camera.projectToRenderScreen(a,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(a){this._applyObjectTransform=a,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(a,y){if(!this.available)return null;const F=(0,xe.WA)(a,Yl),$=this._getCollisionRadius(y),ee=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,Xe.hG)(this.screenLocation.screenPointArray,F)<$*$)return this.screenLocation.renderScreenPointArray[2]+ee;break;case"line":{const te=this.collisionType.paths,ie=this._getWorldToScreenObjectScale(),ne=this._calculateObjectTransform(ie,hs),ae=$*this.screenLocation.pixelSize,le=hn(this._camera,F,Xs);if(null==le)return null;for(const ue of te){if(0===ue.length)continue;const _e=(0,oe.t)(An,ue[0],ne);for(let be=1;be<ue.length;be++){const we=(0,oe.t)(yo,ue[be],ne),Ae=(0,vt.dz)((0,vt.Cr)(_e,we,mo),le);if(null!=Ae&&Ae<ae*ae){const Le=(0,oe.g)(Ee.rq.get(),_e,we);(0,oe.h)(Le,Le,.5);const Ce=(0,xe.rX)(Ee.rq.get());return this._camera.projectToRenderScreen(Le,Ce),Ce[2]+ee}(0,oe.c)(_e,we)}}break}case"disc":{const te=this.collisionType.direction,ie=this.collisionType.offset??de.uY,ne=this._getWorldToScreenObjectScale(),ae=this._calculateObjectTransform(ne,hs),le=$*this.screenLocation.pixelSize,ue=hn(this._camera,F,Xs);if(null==ue)return null;const _e=(0,go.z0)(vo,ae),be=(0,oe.q)(bo,te,_e),we=(0,oe.t)(Eo,ie,ae);(0,ct.O_)(we,be,ds);const Ae=Mo;if((0,ct.Ui)(ds,ue,Ae)&&(0,oe.s)(Ae,we)<le*le)return this.screenLocation.renderScreenPointArray[2]+ee;break}case"ribbon":{const{paths:te,direction:ie}=this.collisionType,ne=this._getWorldToScreenObjectScale(),ae=this._calculateObjectTransform(ne,hs),le=$*this._camera.computeScreenPixelSizeAt(this.renderLocation),ue=hn(this._camera,F,Xs);if(null==ue)return null;const _e=(0,go.z0)(vo,ae),be=(0,oe.q)(bo,ie,_e),we=this._calculateModelTransformPosition(Eo);(0,ct.O_)(we,be,ds);const Ae=Mo;if(!(0,ct.Ui)(ds,ue,Ae))break;for(const Le of te){if(0===Le.length)continue;const Ce=(0,oe.t)(An,Le[0],ae);for(let Ne=1;Ne<Le.length;Ne++){const nt=(0,oe.t)(yo,Le[Ne],ae),ot=(0,vt.kb)((0,vt.Cr)(Ce,nt,mo),Ae);if(null!=ot&&ot<le*le){const et=(0,oe.g)(Ee.rq.get(),Ce,nt);(0,oe.h)(et,et,.5);const Rt=(0,xe.rX)(Ee.rq.get());return this._camera.projectToRenderScreen(et,Rt),Rt[2]+ee}(0,oe.c)(Ce,nt)}}break}default:(0,Da.Xb)(this.collisionType)}return null}attach(a={manipulator3D:{}}){const y=this._stage;if(!y)return;const F=a.manipulator3D;null==F.engineLayerId?(this._engineLayer=new Ps.x(y,{pickable:!1,updatePolicy:Fn.q.SYNC}),F.engineLayerId=this._engineLayer.id):y?.getObject&&(this._engineLayer=y.getObject(F.engineLayerId)),F.engineLayerReferences=(F.engineLayerReferences||0)+1,this._materialIdReferences=F.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,F.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,Dn.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new pi.A({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(a={manipulator3D:{}}){const y=a.manipulator3D;y.engineLayerReferences--;const F=0===y.engineLayerReferences;this._removeResourcesFromStage(),F&&(y.engineLayerId=null,(0,Oe.pR)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(a){(0,Dn.projectPoint)(this.location,Oo,a.spatialReference)&&(0,Bs.vR)(a.extent,Oo)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(null==this.elevationInfo)return;let a=null,y=0;const F=(0,Te.Ze)(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":a=(0,Ws.R1)(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":y=((0,Ws.R1)(this.view.elevationProvider,this.location,"ground")??0)+F;break;case"relative-to-scene":y=((0,Ws.R1)(this.view.elevationProvider,this.location,"scene")??0)+F;break;case"absolute-height":y=F}return y!==this._elevation.offset||a!==this._elevation.override?(this._elevation.offset=y,void(this._elevation.override=a)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const a=this._getWorldToScreenObjectScale(),y=hs;if(!0===this.autoScaleRenderObjects){const te=this._getFocusedSize(this._radius,this.focused)*a;this._calculateObjectTransform(te,y)}else this._calculateObjectTransform(a,y);const{objectsByState:F}=this._ensureEngineResources(),$=(this.focused?Re.p7.Focused:Re.p7.Unfocused)|(this.selected?Re.p7.Selected:Re.p7.Unselected),ee=this._noDisplayCount>0;for(const{stateMask:te,objects:ie}of F)if(ee)for(const _e of ie)_e.visible=!1;else if((te&Re.p7.All)!==Re.p7.None&&($&te)!=(te&Re.p7.All)||(te&Re.SJ.All)!==Re.SJ.None&&(this.state&te)!=(te&Re.SJ.All))for(const _e of ie)_e.visible=!1;else for(const _e of ie)_e.visible=!0,_e.transformation=y}_ensureEngineResources(){if(null==this._engineResources){const a=this._engineLayer,y=[],F=new Set;this.renderObjects.forEach(({geometry:{material:te}})=>{F.has(te)||(y.push(te),F.add(te))});const $=new Map;this._renderObjects.forEach(te=>{const ie=new Ts.B({castShadow:!1,geometries:[te.geometry]}),ne=$.get(te.stateMask)||[];ne.push(ie),$.set(te.stateMask,ne)});const ee=[];$.forEach((te,ie)=>ee.push({stateMask:ie,objects:te})),this._engineResources={objectsByState:ee,layer:a,materials:y}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const a=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!a)return;const{objectsByState:y,layer:F,materials:$}=this._engineResources;$.forEach(ee=>{const te=this._materialIdReferences,ie=te.get(ee.id)||0;0===ie&&a.add(ee),te.set(ee.id,ie+1)}),y.forEach(({objects:ee})=>{F.addMany(ee),a.addMany(ee)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const a=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!a)return;const{objectsByState:y,layer:F,materials:$}=this._engineResources;y.forEach(({objects:ee})=>{F.removeMany(ee),a.removeMany(ee)}),$.forEach(ee=>{const te=this._materialIdReferences,ie=te.get(ee.id);1===ie?(a.remove(ee),te.delete(ee.id)):te.set(ee.id,ie-1)}),this._engineResourcesAddedToStage=!1}_getCollisionRadius(a){return this._getFocusedSize(this.radius,!0)*("touch"===a?this.touchMultiplier:1)}_getFocusedSize(a,y){return a*(y?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(a){const y=this._getWorldToScreenObjectScale(),F=this._calculateObjectTransform(y,$l);return(0,oe.i)(a,F[12],F[13],F[14])}_calculateModelTransformOffset(a){const y=this._calculateModelTransformPosition(a);return(0,oe.d)(a,y,this.renderLocation)}_calculateObjectTransform(a,y){return(0,Ge.hZ)(y,a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1),this._worldFrame&&(0,Ge.lw)(y,y,this._worldFrame),(0,Ge.lw)(y,y,this._modelTransform),y[12]+=this.renderLocation[0],y[13]+=this.renderLocation[1],y[14]+=this.renderLocation[2],y[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(y),y}get test(){}}function fo(h){return 0!==h[12]||0!==h[13]||0!==h[14]}const Yl=(0,xe.gs)(),mo=(0,vt.vt)(),Xs=(0,Ft.vt)(),vo=(0,Hl.vt)(),$l=(0,Ct.vt)(),hs=(0,Ct.vt)(),ds=(0,ct.vt)(),An=(0,de.vt)(),yo=(0,de.vt)(),Mo=(0,de.vt)(),bo=(0,de.vt)(),Eo=(0,de.vt)(),Kl=(0,de.vt)(),Oo=new pi.A({x:0,y:0,z:0,spatialReference:null}),Ql=()=>{};var ni,at;!function(h){h[h.NONE=0]="NONE",h[h.ANY=1]="ANY",h[h.Z=2]="Z",h[h.XY=4]="XY"}(ni||(ni={})),function(h){h[h.TRANSLATE_Z=0]="TRANSLATE_Z",h[h.TRANSLATE_XY=1]="TRANSLATE_XY",h[h.SCALE=2]="SCALE",h[h.ROTATE=3]="ROTATE",h[h.SCALE_ROTATE=4]="SCALE_ROTATE"}(at||(at={}));class So{constructor(){this.grabbingState=ni.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(a){this.grabbingState=ni.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,a.forEachManipulator((y,F)=>{if(F===at.TRANSLATE_Z&&(this.zManipulator=y),y instanceof Ut&&(y.selected&&(0===this.numSelected&&(this.firstSelected=y),this.numSelected++),null==this.firstGrabbedXY&&y.grabbing&&F===at.TRANSLATE_XY&&(this.firstGrabbedXY=y)),y.grabbing)switch(this.grabbingState|=ni.ANY,F){case at.TRANSLATE_Z:this.grabbingState|=ni.Z;break;case at.TRANSLATE_XY:this.grabbingState|=ni.XY}})}}function ql(h,a){const{object:y,view:F}=h,$=[],ee=y.elevationInfo,te="on-the-ground"===ee.mode||!ee.offset&&"absolute-height"!==ee.mode,ie=new So,ne=new Nt({getTheme:()=>F.effectiveTheme}),ae=ne.visualElements,le=new $n({view:F,extensionType:ae.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ve.m$.OccludeAndTransparent,isDecoration:!0}),ue=(0,me.kU)(ae.heightPlaneAngleCutoff),_e=new On({view:F,attached:!1,angleCutoff:ue,isDecoration:!0}),be=(0,ls.v)(1);$.push((0,ge.wB)(()=>({lineShadowStyle:ne.visualElements.lineObjects.shadowStyle,pointShadowStyle:ne.visualElements.pointObjects.shadowStyle,alpha:be.value}),({lineShadowStyle:Ne,pointShadowStyle:nt,alpha:ot})=>{Ne.apply(a,ot),nt.apply(le,ot)},ge.Vh));const we=(0,ls.v)(1);$.push((0,ge.wB)(()=>({heightPlane:ne.visualElements.heightPlane,alpha:we.value}),({heightPlane:Ne,alpha:nt})=>Ne.apply(_e,nt),ge.Vh));const Ae=()=>{ie.update(h);const Ne=bt(y);if(!y.visible||te&&(y.isDraped||!Ys(Ne)||!Ne.hasZ))return a.laserlineEnabled=!1,le.attached=!1,void(_e.attached=!1);a.laserlineEnabled=!0,be.value=ie.grabbingState&ni.XY?ae.laserlineAlphaMultiplier:1,we.value=ie.grabbingState&ni.Z?ae.laserlineAlphaMultiplier:1,function ec(h,a){const y=1===a.numSelected?a.firstSelected:a.numSelected>1&&null!=a.firstGrabbedXY?a.firstGrabbedXY:null;null!=y?(h.setStartEndFromWorldDownAtLocation(y.renderLocation),h.attached=!0):h.attached=!1}(le,ie),function tc(h,a,y,F){if(F.numSelected>0){(0,oe.i)(Yi,0,0,0);let $=0;h.forEachManipulator((ee,te)=>{te===at.TRANSLATE_XY&&ee.selected&&ee instanceof Ut&&((0,oe.g)(Yi,Yi,ee.renderLocation),$++)}),$>0?(y.heightManifoldTarget=(0,oe.h)(Yi,Yi,1/$),y.attached=!0):y.attached=!1}else{const $=a.attachmentOrigin;null!=$&&h.view.renderCoordsHelper.toRenderCoords($,Yi)?(y.heightManifoldTarget=Yi,y.attached=!0):y.attached=!1}}(h,a,_e,ie)};$.push((0,ge.wB)(()=>ne.visualElements.zVerticalLine,Ne=>Ne.apply(le),ge.Vh)),$.push(y.on("committed",Ae),(0,ge.wB)(()=>y.visible,Ae),a.events.on("attachment-origin-changed",Ae),(0,Se.DQ)(le),(0,Se.DQ)(_e));const Le=[],Ce=()=>{(0,Se.a0)(Le),Le.length=0,h.forEachManipulator(Ne=>Le.push(Ne.events.on("grab-changed",Ae))),h.forEachManipulator(Ne=>Le.push(Ne.events.on("select-changed",Ae))),Ae()};return Ce(),$.push(h.onManipulatorsChanged(Ce),(0,Se.a2)(()=>(0,Se.vE)(Le))),(0,Se.vE)($)}function Ys(h){return null!=h&&("polygon"===h.type||"polyline"===h.type)}const Yi=(0,de.vt)();var ic=se(16590);function nc(h){const a=[],y=function ac(h,a){const{view:y,object:F}=h,$=new Ls({view:y,geometry:$s(bt(F)),elevationInfo:F.elevationInfo,isDecoration:!0});return function oc(h,a,y){const{view:F,object:$}=h,te=new Nt({getTheme:()=>F.effectiveTheme});(function rc(h,a,y){const{view:F,object:$}=h;let ee=null;const ie=()=>{const ne=$s(bt($));null!=ne&&(0,Te.x)($.elevationInfo)&&(ne.z=0),(ne=>{null!=ee&&(ee.remove(),ee=null),$.isDraped&&null!=ne&&(ee=function lc(h,a,y){(0,ic.g)(a,si,h.elevationProvider.spatialReference);const $=si[0],ee=si[1];return h.elevationProvider.on("elevation-change",te=>{(0,Bs.Rj)(te.extent,$,ee)&&y()})}(F,ne,()=>{a.geometry=ne}))})(ne),a.geometry=ne};y.push($.on("committed",ie),(0,Se.a2)(()=>ee)),ie()})(h,a,y),te.visualElements.pointObjects.outline.apply(a),y.push((0,ge.wB)(()=>$.visible,()=>{a.attached=$.visible},ge.Vh))}(h,$,a),a.push((0,Se.DQ)($)),$}(h,a);return function sc(h,a,y){const{view:F,object:$}=h,ee=new Nt({getTheme:()=>F.effectiveTheme}),te=new $n({view:F,extensionType:ee.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ve.m$.OccludeAndTransparent,isDecoration:!0});a.push((0,ge.wB)(()=>ee.visualElements.zVerticalLine,Ce=>Ce.apply(te),ge.Vh));const ie=new On({view:F,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),ne=(0,me.kU)(ee.visualElements.heightPlaneAngleCutoff),ae=new On({view:F,attached:!1,angleCutoff:ne,isDecoration:!0}),le=$.elevationInfo,ue=an.F.fromElevationInfo(le),_e="on-the-ground"===le.mode||!le.offset&&"absolute-height"!==le.mode,be=new So,we=(0,ls.v)(1);a.push((0,ge.wB)(()=>({heightPlane:ee.visualElements.heightPlane,alpha:we.value}),({heightPlane:Ce,alpha:Ne})=>Ce.apply(ae,Ne),ge.Vh));const Ae=(0,ls.v)(1);a.push((0,ge.wB)(()=>({shadowStyle:ee.visualElements.pointObjects.shadowStyle,alpha:Ae.value}),({shadowStyle:Ce,alpha:Ne})=>Ce.apply(ie,Ne),ge.Vh));const Le=()=>{be.update(h);let Ce=$s(bt($));const Ne=_e&&($.isDraped||null==Ce||!Ce.hasZ);let nt=!0;if(Ne||null==Ce)nt=!1;else{(0,Te.x)($.elevationInfo)&&(Ce=Ce.clone(),Ce.z=0);const wt=(0,Sn.nG)(Ce,F.elevationProvider,ue,F.renderCoordsHelper);(0,oe.i)(si,Ce.x,Ce.y,wt),(0,yi.F)(si,Ce.spatialReference,si,F.renderCoordsHelper.spatialReference),te.setStartEndFromWorldDownAtLocation(si),ie.intersectsWorldUpAtLocation=si}we.value=be.grabbingState&ni.Z?ee.visualElements.laserlineAlphaMultiplier:1;const et=(0,Zi.Ie)(cc);!Ne&&$.visible&&y.calculateMapBounds(et)&&(0,yi.F)((0,Zi.pg)(et,si),F.spatialReference,si,F.renderCoordsHelper.spatialReference)?(ae.heightManifoldTarget=si,ae.attached=!0):ae.attached=!1,Ae.value=be.grabbingState&ni.XY?ee.visualElements.laserlineAlphaMultiplier:1;const Ke=nt&&$.visible&&!Ne;ie.attached=Ke,te.attached=Ke};a.push((0,ge.wB)(()=>[$.visible,$.isDraped],Le),$.on("committed",Le)),h.forEachManipulator(Ce=>{a.push(Ce.events.on("grab-changed",Le))}),a.push((0,Se.DQ)(ie)),a.push((0,Se.DQ)(te)),a.push((0,Se.DQ)(ae)),Le()}(h,a,y),{visualElement:y,remove:()=>(0,Se.a0)(a)}}function $s(h){return null==h?null:"point"===h.type?h:"mesh"===h.type?h.origin.clone():null}const si=(0,de.vt)(),cc=(0,Zi.vt)();function us(h){switch(bt(h.object)?.type){case"point":case"mesh":return nc(h);case"polygon":case"polyline":return function kl(h){const{object:a}=h,y=function Jl(h){const{view:a,object:y}=h,F=bt(y),$=new Bi({view:a,geometry:Ys(F)?F:null,elevationInfo:y.elevationInfo,attached:!1,isDecoration:!0}),ee=new Nt({getTheme:()=>a.effectiveTheme}),te=()=>{$.attached=y.visible},ie=(0,Se.vE)([(0,ge.wB)(()=>ee.visualElements.lineObjects.outline,ne=>ne.apply($),ge.Vh),(0,ge.wB)(()=>ee.visualElements.lineObjects.shadowStyle,ne=>ne.apply($),ge.Vh),(0,ge.wB)(()=>y.visible,te),(0,ge.wB)(()=>y.isDraped,ne=>{$.isDraped=ne},ge.Vh),y.on("committed",()=>{const ne=bt(y);$.geometry=Ys(ne)?ne:null}),(0,Se.DQ)($)]);return te(),{visualElement:$,remove:()=>ie.remove()}}(h),F=[y,ql(h,y.visualElement)];return a.maskOccludee&&F.push(a.maskOccludee()),{visualElement:y.visualElement,remove:()=>(0,Se.a0)(F)}}(h);default:return null}}const Do=Math.ceil(70/3*2),fc=5*Math.PI/12,mc=1*Math.PI/3;var ps=se(86807);class Tn{constructor(){this._available=!0}set location(a){this._forEachManipulator3D(y=>y.location=a)}set elevationAlignedLocation(a){this._forEachManipulator3D(y=>y.elevationAlignedLocation=a)}set elevationInfo(a){this._forEachManipulator3D(y=>y.elevationInfo=a)}get renderLocation(){let a;return this._forEachManipulator3D(y=>{a||(a=y.renderLocation)}),a}set renderLocation(a){this._forEachManipulator3D(y=>y.renderLocation=a)}get available(){return this._available}set available(a){this._available=a,this._forEachManipulator3D(y=>y.available=a)}get hovering(){return this.someManipulator(a=>a.hovering)}get grabbing(){return this.someManipulator(a=>a.grabbing)}get dragging(){return this.someManipulator(a=>a.dragging)}get selected(){return this.someManipulator(a=>a.selected)}hasManipulator(a){return this.someManipulator(y=>y===a)}someManipulator(a){let y=!1;return this.forEachManipulator(F=>{!y&&a(F)&&(y=!0)}),y}_forEachManipulator3D(a){this.forEachManipulator((y,F)=>{y instanceof Ut&&a(y,F)})}}class Oc extends Tn{constructor(){super(...arguments),this._interactive=!0}get interactive(){return this._interactive}set interactive(a){this._interactive!==a&&(this._interactive=a),this._updateManipulatorInteractivity()}_updateManipulatorInteractivity(){const a=!this.grabbing&&this._interactive;this.forEachManipulator(y=>{y.interactive=a||y.grabbing})}}class ze{constructor(a,y=Re.p7.None){this.geometry=a,this.stateMask=y}}var Rn,Sc=se(99608),We=(se(16126),se(8978),se(29452),se(68736));function gs(h,a){return Io(h,()=>a)}function Io(h,a){const y=(0,de.vt)(),F=(0,de.vt)();let $=!1;return ee=>{const te=a(ee);if("start"===ee.action){const ae=(0,xe.WA)(ee.screenStart,(0,xe.PR)(Ee.oG.get())),le=hn(h.state.camera,ae,ks);null!=le&&($=(0,ct.Ui)(te,le,y))}if(!$)return null;const ie=(0,xe.WA)(ee.screenEnd,(0,xe.PR)(Ee.oG.get())),ne=hn(h.state.camera,ie,ks);return null==ne?null:(0,ct.Ui)(te,ne,F)?{...ee,renderStart:y,renderEnd:F,plane:te,ray:ne}:null}}function Pn(h,a,y,F=null,$=null){return function wc(h,a,y=0,F=null,$=null){let ee=null;return te=>{if("start"===te.action&&(ee=h.sceneIntersectionHelper.intersectElevationFromScreen((0,xe.gs)(te.screenStart.x,te.screenStart.y),a,y,$),null!=ee&&null!=F&&!(0,Dn.projectPoint)(ee,ee,F))||null==ee)return null;const ie=h.sceneIntersectionHelper.intersectElevationFromScreen((0,xe.gs)(te.screenEnd.x,te.screenEnd.y),a,y,$);return null==ie||null!=F&&!(0,Dn.projectPoint)(ie,ie,F)?null:{...te,mapStart:ee,mapEnd:ie}}}(h,y,(0,Te.id)(a,h,y),F,$)}function Lo(h,a,y){let F=null;const $=new We.rh;return $.next(gs(h,function Ac(h,a){const y=Uo,F=Vo,$=(0,ct.vt)();h.renderCoordsHelper.worldUpAtPosition(a,y);const ee=(0,oe.e)((0,ct.Qj)($),y,(0,oe.d)(F,a,h.state.camera.eye));return(0,oe.e)(ee,ee,y),(0,ct.O_)(a,ee,$)}(h,a))).next(function Tc(h,a){const y=(0,de.vt)(),F=(0,oe.l)(a);h.renderCoordsHelper.worldUpAtPosition(a,y);const $=(0,de.vt)(),ee=(0,de.vt)(),te=ie=>((0,oe.d)(ie,ie,a),(0,Sc._I)(y,ie,ie),"global"===h.viewingMode&&(0,oe.l)(ie)*Math.sign((0,oe.f)(y,ie))<.001-F&&(0,oe.d)(ie,(0,oe.h)(ie,y,.001),a),(0,oe.g)(ie,ie,a),ie);return ie=>(ie.renderStart=te((0,oe.c)($,ie.renderStart)),ie.renderEnd=te((0,oe.c)(ee,ie.renderEnd)),ie)}(h,a)).next(jo(h,y)).next(ee=>{ee.mapEnd.x=ee.mapStart.x,ee.mapEnd.y=ee.mapStart.y,F=ee}),ee=>(F=null,$.execute(ee),F)}function jo(h,a){const y=h.renderCoordsHelper;return F=>{const $=y.fromRenderCoords(F.renderStart,new pi.A({spatialReference:a})),ee=y.fromRenderCoords(F.renderEnd,new pi.A({spatialReference:a}));return null!=$&&null!=ee?{...F,mapStart:$,mapEnd:ee}:null}}!function(h){h[h.GROUND=0]="GROUND",h[h.OTHER=1]="OTHER"}(Rn||(Rn={})),(0,gt.vt)();const Uo=(0,de.vt)(),Vo=(0,de.vt)(),ks=(0,Ft.vt)();function _s(h,a,y){const F=($,ee)=>{a({action:$,object:h,dxScreen:ee.screenDeltaX,dyScreen:ee.screenDeltaY})};return y(($,ee,te)=>(ee.next(ie=>("start"===ie.action&&F("start",ie),ie)).next((0,We.Wp)(h)).next(ie=>{switch(ie.action){case"start":case"update":(ie.translationX||ie.translationY||ie.translationZ)&&F("update",ie);break;case"end":F("end",ie)}return ie}),{steps:ee,cancel:te=te.next((0,We.dp)(h)).next(ie=>(F("end",{screenDeltaX:0,screenDeltaY:0}),ie))}))}function zo(h){if(null==h?.axis)return 1;const{mapStart:a,mapEnd:y,axis:F}=h,$=[y.x-a.x,y.y-a.y];return $[0]*F[0]+$[1]*F[1]>0?1:-1}class Rc extends Tn{constructor(a){super(),this._handles=new ps.A,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new Qt.A,this._tool=a.tool,this._view=a.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=a.radius&&(this._radius=a.radius),this._createManipulators(),this.forEachManipulator(y=>this._tool.manipulators.add(y))}set orthogonalAvailable(a){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=a,this._arrowManipulatorInfos[3].manipulator.available=a)}destroy(){this._handles=(0,Oe.pR)(this._handles),this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(a){for(const{manipulator:y}of this._arrowManipulatorInfos)a(y,at.TRANSLATE_XY)}createManipulatedObjectDragPipeline(a,y,F){if(!y.operations)return(0,Se.hA)();const $=y.operations.data.spatialReference,ee=y.graphic;return _s(y,F,te=>this.createDragPipeline((ie,ne,ae,le,ue)=>(({steps:ne,cancel:ae}=a(ie,ne,ae,le,ue)),te(ie,ne,ae)),y.elevationInfo,$,ee))}createDragPipeline(a,y,F,$){return(0,Se.vE)(this._arrowManipulatorInfos.map(({manipulator:ee},te)=>(0,We.Xt)(ee,(ie,ne,ae,le,ue)=>{const _e=ne.next(be=>({...be,manipulatorType:at.TRANSLATE_XY})).next((0,We.Tp)(this._view,ie.elevationAlignedLocation)).next(Pn(this._view,ie.elevationAlignedLocation,y,F,$)).next((0,We.an)(ie.location,this.angle+(te+1)*Math.PI*.5)).next((0,We.sO)());a(ie,_e,ae,le,ue)})))}get angle(){return this._angle}set angle(a){this._angle=a,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(a){this._scale=a,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(a){this._radius!==a&&(this._radius=a,this._updateManipulators())}_updateManipulators(){for(let a=0;a<this._arrowManipulatorInfos.length;a++)this._updateArrowManipulator(this._arrowManipulatorInfos[a],a);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:a,transform:y},F){const $=this._radius/70,ee=54*$,te=ee*Math.sqrt(3)/2,ie=(0,it._B)(this._opaqueMaterial,te,ee/2,ee/2,.02);(0,it.xh)(ie,(0,Ge.kN)(Ee.Rc.get(),(0,oe.i)(Ee.rq.get(),0,-te/3,0))),a.renderObjects=[new ze(ie,Re.p7.Focused),new ze(ie.instantiate({material:this._transparentMaterial}),Re.p7.Unfocused)],a.radius=te/3*2*1.2;const ne=(0,Ge.N9)(Ee.Rc.get(),F*Math.PI/2),ae=(0,Ge.kN)(Ee.Rc.get(),(0,oe.i)(Ee.rq.get(),0,100*$,0));(0,Ge.lw)(y,ne,ae)}_createManipulators(){for(let a=0;a<4;a++){const y=this._createArrowManipulator(a);this._arrowManipulatorInfos.push(y)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const a=this.angle,y=(0,Ge.$0)(Ee.Rc.get(),a,(0,de.fA)(0,0,1));if(null==y)return;const F=(0,Ge.CV)(Ee.Rc.get(),(0,oe.i)(Ee.rq.get(),this.displayScale,this.displayScale,this.displayScale)),$=(0,Ge.lw)(Ee.Rc.get(),F,y);for(const ee of this._arrowManipulatorInfos){const te=(0,Ge.lw)(Ee.Rc.get(),$,ee.transform);ee.manipulator.modelTransform=te}}_createArrowManipulator(a){const y=new Ut({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,de.fA)(0,0,1)}}),F={manipulator:y,transform:(0,Ct.vt)()};return this._updateArrowManipulator(F,a),this._handles.add(y.events.on("drag",$=>{this._updateAfterDrag&&"end"===$.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),F}_createMaterial(a=1){const y=new qt.v({cullFace:Qe.s2.Back,renderOccluded:Ve.m$.Transparent,isDecoration:!0});return this._handles.add((0,ge.wB)(()=>ye.A.toUnitRGBA(this._view.effectiveTheme.accentColor),F=>{F[3]*=a,y.setParameters({color:F})},ge.Vh)),y}get test(){}}class Cc{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(a){if(this._enabled!==a&&null!=this._lastDragEvent&&null!=this._next){const y=this._lastDragEvent.mapEnd,F=this._snap(this._lastDragEvent.screenEnd);null!=F&&this._next.execute({action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===a?F:y,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd})}this._enabled=a}_snap(a){const y=null!=this._view?this._view.toMap(a,{exclude:[]}):null;return null!=y&&null!=this._view&&(y.z=(0,Te.id)(y,this._view,this._elevationInfo)),y}createDragEventPipelineStep(a,y){this._view=a,this._elevationInfo=y,this._lastDragEvent=null;const F=new We.rh;return this._next=F,[$=>{if(this._lastDragEvent="end"!==$.action?{...$}:null,this._enabled){const ee=this._snap($.screenEnd);return null!=ee?{action:$.action,mapStart:$.mapStart,mapEnd:ee,screenStart:$.screenStart,screenEnd:$.screenEnd}:null}return{action:$.action,mapStart:$.mapStart,mapEnd:$.mapEnd,screenStart:$.screenStart,screenEnd:$.screenEnd}},F]}}class Ic extends Tn{constructor(a){super(),this._handles=new ps.A,this._snapToScene=new Cc,this._scale=1,this._radius=70,this._view=a.view,this._tool=a.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=a.snapToScene&&(this.snapToScene=a.snapToScene),null!=a.radius&&(this._radius=a.radius),this._createManipulator(),this.forEachManipulator(y=>this._tool.manipulators.add(y))}destroy(){this._handles=(0,Oe.pR)(this._handles),this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(a){a(this._manipulator,at.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(a){this._scale=a,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(a){this._snapToScene.enabled=a}get radius(){return this._radius}set radius(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(a,y,F){if(!y.operations)return(0,Se.hA)();const $=y.graphic,ee=y.elevationInfo,te=y.operations.data.spatialReference;return _s(y,F,ie=>this.createDragPipeline((ne,ae,le,ue,_e)=>(({steps:ae,cancel:le}=a(ne,ae,le,ue,_e)),ie(ne,ae,le)),ee,te,$))}createDragPipeline(a,y,F,$){const ee=this._view;return(0,We.Xt)(this._manipulator,(te,ie,ne,ae,le)=>{const ue=ie.next((0,We.Tp)(ee,te.elevationAlignedLocation)).next(Pn(ee,te.elevationAlignedLocation,y,F,$)).next(...this._snapToScene.createDragEventPipelineStep(ee,y)).next(_e=>({..._e,manipulatorType:at.TRANSLATE_XY})).next((0,We.sO)());a(te,ue,ne,ae,le)})}_updateManipulatorTransform(){const a=(0,Ge.CV)(Ee.Rc.get(),(0,oe.i)(Ee.rq.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=a}_createManipulator(){this._manipulator=new Ut({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,de.fA)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const a=(0,it.nW)(this._discMaterial,.02,1,128,(0,de.fA)(0,0,1),(0,de.fA)(0,0,0));a.transformation=(0,Ge.CV)((0,Ct.vt)(),(0,de.fA)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new ze(a,Re.p7.Focused),new ze(a.instantiate({material:this._discMaterialTransparent}),Re.p7.Unfocused)],this._manipulator.radius=this._radius/70*80}_createMaterial(a=1){const y=new qt.v({cullFace:Qe.s2.Back,renderOccluded:Ve.m$.Transparent,isDecoration:!0});return this._handles.add((0,ge.wB)(()=>ye.A.toUnitRGBA(this._view.effectiveTheme.accentColor),F=>{F[3]*=a,y.setParameters({color:F})},ge.Vh)),y}get test(){}}var Lc=se(90673);function gi(h,a=Ve.m$.OccludeAndTransparent,y=!0){const F=(0,De.pf)(h),$=!(h[3]<1);return y?new Ns({color:F,writeDepth:$,cullFace:Qe.s2.Back,renderOccluded:a,isDecoration:!0}):new qt.v({color:F,writeDepth:$,cullFace:Qe.s2.Back,renderOccluded:a,isDecoration:!0})}function Cn(h,a=Ve.m$.OccludeAndTransparent){const y=(0,De.pf)(h);return new qt.v({color:y,writeDepth:!0,cullFace:Qe.s2.Front,renderOccluded:a,isDecoration:!0})}const Ho=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),jc=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Go(h,a,y,F){const $=(0,oe.d)(Ee.rq.get(),h,y),ee=No($,(0,oe.e)(Ee.rq.get(),F,$),y,Ee.Rc.get());(0,Ge.B8)(ee,ee);const te=(0,oe.t)(Ee.rq.get(),a,ee);return Math.atan2(te[1],te[0])}function No(h,a,y,F){const $=(0,oe.n)(Ee.rq.get(),h),ee=(0,oe.n)(Ee.rq.get(),a),te=(0,oe.e)(Ee.rq.get(),$,ee);return F[0]=$[0],F[1]=$[1],F[2]=$[2],F[3]=0,F[4]=ee[0],F[5]=ee[1],F[6]=ee[2],F[7]=0,F[8]=te[0],F[9]=te[1],F[10]=te[2],F[11]=0,F[12]=y[0],F[13]=y[1],F[14]=y[2],F[15]=1,F}function Zo(h,a){const y=a.origin;null==y?function Vc(h,a){if(null==a)return;const y="mesh"===a.type?a.origin:(0,Lc.W$)(a);null!=y&&(h.location=(0,cs.wZ)(y))}(h,bt(a)):h.elevationAlignedLocation=y}class zc extends Tn{constructor(a){super(),this._radius=70,this.events=new Qt.A,this._tool=a.tool,this._view=a.view;const y=new Nt({getTheme:()=>this._view.effectiveTheme});this._settings=y,null!=a.radius&&(this._radius=a.radius);const F=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:gi(Ai(F,1,.25),Ve.m$.Occlude),materialFocused:gi(Ai(F,1,0),Ve.m$.Occlude),materialOccludedUnfocused:gi(Ai(F,.7,0),y.zManipulator.renderOccluded),materialOccludedFocused:gi(Ai(F,.85,0),y.zManipulator.renderOccluded)},this._themeHandle=(0,ge.wB)(()=>this._view.effectiveTheme.accentColor,$=>{const ee=Ai($,1,.25),te=Ai($,1,0),ie=Ai($,.7,0),ne=Ai($,.85,0),{materialUnfocused:ae,materialFocused:le,materialOccludedUnfocused:ue,materialOccludedFocused:_e}=this._materials;ae.setParameters({color:ee}),le.setParameters({color:te}),ue.setParameters({color:ie}),_e.setParameters({color:ne})}),this._createManipulator(),this.forEachManipulator($=>this._tool.manipulators.add($))}destroy(){this._themeHandle=(0,Oe.xt)(this._themeHandle),this._manipulator.applyObjectTransform=Gc,this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()})}forEachManipulator(a){a(this._manipulator,at.TRANSLATE_Z)}createManipulatedObjectDragPipeline(a,y,F){if(!y.operations)return(0,Se.hA)();const $=y.operations.data.spatialReference;return _s(y,F,ee=>this.createDragPipeline((te,ie,ne,ae,le)=>(({steps:ie,cancel:ne}=a(te,ie,ne,ae,le)),ee(te,ie,ne)),$))}createDragPipeline(a,y){const F=this._view;return(0,We.Xt)(this._manipulator,($,ee,te,ie,ne)=>{const ae=ee.next(le=>({...le,manipulatorType:at.TRANSLATE_Z})).next(Lo(F,$.renderLocation,y)).next((0,We.sO)());a($,ae,te,ie,ne)})}get radius(){return this._radius}set radius(a){a!==this._radius&&(this._radius=a,this._updateManipulator())}_updateManipulator(){const a=this._settings,y=this._radius/70,F=a.zManipulator.height*y,$=a.zManipulator.coneHeight*y,ee=a.zManipulator.coneWidth*y,te=a.zManipulator.width*y,ie=[(0,de.fA)(0,0,0),(0,de.fA)(0,0,F)],ne=[(0,de.fA)(0,0,0),(0,de.fA)(0,0,F+$)],ae=(()=>{const Le=(0,Ct.vt)();return(0,Ge.Tl)(Le,Le,[0,0,F]),(0,Ge.eL)(Le,Le,Math.PI/2),Le})(),{materialUnfocused:le,materialFocused:ue,materialOccludedUnfocused:_e,materialOccludedFocused:be}=this._materials,we=(0,it.Nb)(le,ie,te/2,16,!1),Ae=(0,it.EE)(le,$,ee/2,16,!1);Ae.transformation=ae,this._manipulator.renderObjects=[new ze(Ae,Re.p7.Unfocused),new ze(we,Re.p7.Unfocused),new ze(Ae.instantiate({material:ue}),Re.p7.Focused),new ze(we.instantiate({material:ue}),Re.p7.Focused),new ze(Ae.instantiate({material:_e}),Re.p7.Unfocused),new ze(we.instantiate({material:_e}),Re.p7.Unfocused),new ze(Ae.instantiate({material:be}),Re.p7.Focused),new ze(we.instantiate({material:be}),Re.p7.Focused)],this._manipulator.radius=te/2+2,this._manipulator.collisionType={type:"line",paths:[ne]}}_createManipulator(){const a=this._view,y=new Ut({view:a,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});y.applyObjectTransform=F=>{const $=a.state.camera,ee=Fo;a.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,ee);const te=(0,oe.G)($.eye,ee),ie=$.computeRenderPixelSizeAtDist(te),ne=(0,oe.d)(un,ee,$.eye);(0,oe.n)(ne,ne);const ae=Hc;a.renderCoordsHelper.worldUpAtPosition(Fo,ae);const le=Math.abs((0,oe.f)(ne,ae)),ue=(0,oe.e)(un,ne,ae),_e=(0,oe.e)(un,ue,ae),be=(0,me.qE)(le,.01,1),we=1-Math.sqrt(1-be*be)/be/$.fullWidth,Ce=this._settings.zManipulator.width*(this._radius/70);(0,oe.h)(_e,(0,oe.n)(_e,_e),(1/we-1)*te+ie*Ce),F[12]-=un[0],F[13]-=un[1],F[14]-=un[2]},this._manipulator=y,this._updateManipulator()}get test(){}}function Ai(h,a,y){const F=(0,De.e$)(h,y);return F.a*=a,ye.A.toUnitRGBA(F)}const Fo=(0,de.vt)(),un=(0,de.vt)(),Hc=(0,de.vt)(),Gc=()=>{};class Ki extends Oc{constructor(a){super(),this._handles=new ps.A;const{tool:y,view:F,snapToScene:$,radius:ee}=a;this._view=F,this.xyManipulation=new Ic({tool:y,view:F,snapToScene:$,radius:ee}),this.xyAxisManipulation=new Rc({tool:y,view:F,radius:ee}),this.zManipulation=new zc({tool:y,view:F,radius:ee}),this.xyManipulation.available=a.xyAvailable,this.xyAxisManipulation.available=a.xyAxisAvailable,this.zManipulation.available=a.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(te=>this._handles.add(te.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(a,y,F){return(0,Se.vE)([this.xyManipulation.createManipulatedObjectDragPipeline(($,ee,te,ie,ne)=>a(ht.XY,$,ee,te,ie,ne),y,F),this.xyAxisManipulation.createManipulatedObjectDragPipeline(($,ee,te,ie,ne)=>a(ht.XY_AXIS,$,ee,te,ie,ne),y,F),this.zManipulation.createManipulatedObjectDragPipeline(($,ee,te,ie,ne)=>a(ht.Z,$,ee,te,ie,ne),y,F)])}createDragPipeline(a,y,F,$){return(0,Se.vE)([this.xyManipulation.createDragPipeline((ee,te,ie,ne,ae)=>a(ht.XY,ee,te,ie,ne,ae),y,F,$),this.xyAxisManipulation.createDragPipeline((ee,te,ie,ne,ae)=>a(ht.XY_AXIS,ee,te,ie,ne,ae),y,F,$),this.zManipulation.createDragPipeline((ee,te,ie,ne,ae)=>a(ht.Z,ee,te,ie,ne,ae),F)])}set snapToScene(a){this.xyManipulation.snapToScene=a}set angle(a){this.xyAxisManipulation.angle=a}set radius(a){this.xyAxisManipulation.radius=a,this.xyManipulation.radius=a,this.zManipulation.radius=a}set displayScale(a){this.xyManipulation.displayScale=a,this.xyAxisManipulation.displayScale=a}forEachManipulator(a){this.xyManipulation.forEachManipulator(y=>a(y,at.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(y=>a(y,at.TRANSLATE_XY)),this.zManipulation.forEachManipulator(y=>a(y,at.TRANSLATE_Z))}get _xyAxisVisible(){const a=this.xyManipulation.someManipulator(y=>y.focused)||this.xyAxisManipulation.someManipulator(y=>y.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||a}_autoHideXYAxis(){const a=this.xyAxisManipulation,y=this.xyManipulation;if((0,Be.A)("esri-mobile"))return;const F=[];y.forEachManipulator(ee=>F.push(ee)),a.forEachManipulator(ee=>F.push(ee));const $=()=>{const ee=[];this._xyAxisVisible||a.forEachManipulator(te=>ee.push(te.disableDisplay())),this._handles.remove(Bo),this._handles.add(ee,Bo)};for(const ee of F)this._handles.add(ee.events.on("focus-changed",$));this._view.inputManager&&this._handles.add((0,ge.z7)(()=>this._view.inputManager?.latestPointerType,$)),$()}static radiusForSymbol(a){const y=null!=a&&"point-3d"===a.type&&a.symbolLayers;return y&&y.some(F=>"icon"===F.type)?Do:70}}const Bo="disable-xy-axis-display";var ht;!function(h){h[h.XY=0]="XY",h[h.XY_AXIS=1]="XY_AXIS",h[h.Z=2]="Z"}(ht||(ht={}));class Js extends Tn{constructor(a){super(),this._view=a.view,this._tool=a.tool,this._object=a.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:"move"}),this.forEachManipulator(y=>this._tool.manipulators.add(y))}destroy(){this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(a){this._manipulator&&a(this._manipulator,at.TRANSLATE_XY)}createManipulatedObjectDragPipeline(a){return _s(this._object,a,y=>this.createDragPipeline(y))}createDragPipeline(a){if(!this._manipulator)return(0,Se.hA)();const y=this._view;return(0,We.Xt)(this._manipulator,(F,$,ee,te,ie)=>{const ne=this._object.operations?.data.spatialReference,ae=$.next(le=>ne?le:null).next(function Dc(h,a,y,F){const $=y.toMap(h.screenStart);return null!=$?Pn(a,$,y.elevationInfo,F):null}(ie,y,this._object,ne)).next((0,We.EX)()).next((0,We.sO)());a(F,ae,ee,te,ie)})}}var Nc=se(70903),fs=se(97167),qs=se(63938),Ti=se(56023),ms=se(86478),vs=se(21783),Wo=se(16552),ea=se(90941),In=se(89381);let pn=class extends In.w{constructor(h){super(h),this.type="translate-xy",this.distance=Pt.r7}};(0,re._)([(0,ce.MZ)()],pn.prototype,"type",void 0),(0,re._)([(0,ce.MZ)()],pn.prototype,"distance",void 0),pn=(0,re._)([(0,Ie.$)("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],pn);let Qi=class extends In.w{constructor(h){super(h),this.type="translate-z",this.distance=Pt.r7}clear(){this.distance=Pt.r7}};(0,re._)([(0,ce.MZ)()],Qi.prototype,"type",void 0),(0,re._)([(0,ce.MZ)()],Qi.prototype,"distance",void 0),Qi=(0,re._)([(0,Ie.$)("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],Qi);class Xo{constructor(a){this.objects=a,this.type="move-start"}}class Yo{constructor(a,y,F){this.dx=a,this.dy=y,this.objects=F,this.type="move"}}class ta{constructor(a){this.objects=a,this.type="move-stop"}}const ci=Symbol("manipulators"),$o=Symbol("tooltips");let Xt=class extends fs.g{constructor(h){super(h),this._infos=new Map,this.events=new Qt.A,this.objects=new Il.A,this.enableZ=!0,this.sketchOptions=new Ti.A,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new as.U,this._moveManipulation=null}initialize(){const{view:h}=this;this.tooltip=(0,It.A)(()=>({view:h,options:this.sketchOptions.tooltips})),this.addHandles([this.objects.on("change",y=>{y.removed.forEach(F=>this.removeHandles(F)),this._updateObjectInfos(y),this._setupFastTransformUpdates(y.added),this._refreshManipulators()}),this.objects.on("change",()=>this._connectTooltips())]);const a=this.objects.toArray();this._updateObjectInfos({added:a,removed:[]}),this._setupFastTransformUpdates(a),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=(0,Oe.pR)(this.tooltip),this._moveManipulation=(0,Oe.pR)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(h){if(!this.destroyed&&!(0,It.wG)(h,this.tooltip))return super.onInputEvent(h)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){const{objects:h}=this;if(1!==h.length)return!1;const a=bt(h.at(0))?.type;return"point"===a||"mesh"===a}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:h,removed:a}){for(const y of h){if((0,Nc.Y)(y)!==Ul.d.SUPPORTED)continue;const F=new Zc(y);this._infos.set(y,F)}for(const y of a)this._infos.delete(y)}_setupFastTransformUpdates(h){for(const a of h){const y=this._infos.get(a);this.addHandles(zs(y.object),a)}}_refreshManipulators(){if(this.removeHandles(ci),this._moveManipulation=(0,Oe.pR)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const h=Array.from(this._infos.values());this._createManipulators(h),this._createVisualElements(h),this._updateMoveManipulation(h)}_createManipulators(h){for(const a of h){const y=a.object;a.manipulationXY=new Js({tool:this,view:this.view,object:y}),a.manipulationXY.forEachManipulator(F=>{this.addHandles([F.events.on("immediate-click",$=>{this.events.emit("immediate-click",{...$,object:y}),$.stopPropagation()}),F.events.on("grab-changed",({action:$})=>{"start"===$?this._showTooltip(ht.XY):this._hideTooltip()})],ci)}),this.addHandles(a.manipulationXY.createDragPipeline((F,$,ee,te)=>this._buildDragEventPipeline(h,ht.XY,F,$,ee,te)),ci)}this._createMoveManipulation(h)}_createMoveManipulation(h){const a=new Ki({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===h.length?Ki.radiusForSymbol(h[0].object.graphic?.symbol):70});this._moveManipulation=a,a.elevationInfo={mode:"absolute-height",offset:0},a.forEachManipulator(ie=>{this.addHandles(ie.events.on("immediate-click",ne=>{const ae=this.objects.at(0);!a.zManipulation.hasManipulator(ie)&&1===this.objects.length&&ae&&this.events.emit("immediate-click",{...ne,object:ae}),ne.stopPropagation()}),ci)});const y=ie=>ne=>{this.addHandles([ne.events.on("focus-changed",({action:ae})=>{"focus"===ae?this._showTooltip(ie):this._hideTooltip()}),ne.events.on("grab-changed",()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=Pt.r7)})],ci)};this._moveManipulation.xyManipulation.forEachManipulator(y(ht.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(y(ht.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(y(ht.Z));const F=()=>this._updateMoveManipulation(h);for(const ie of h)this.addHandles([ie.object.on("committed",F),(0,ge.wB)(()=>ie.object.visible,F)],ci);const $=h[h.length-1];this.addHandles($.object.on("committed",()=>this._updateMoveManipulationAngle($)),ci);const{object:ee}=$,{operations:te}=ee;te&&this.addHandles(a.createDragPipeline((ne,ae,le,ue,_e)=>this._buildDragEventPipeline(h,ne,ae,le,ue,_e),ee.elevationInfo,te.data.spatialReference,ee.graphic),ci),this._updateMoveManipulationAngle($)}_createVisualElements(h){for(const a of h){const F=us({view:this.view,object:a.object,forEachManipulator:$=>{a.manipulationXY?.forEachManipulator($),this._moveManipulation?.forEachManipulator($)},onManipulatorsChanged:()=>(0,Se.hA)()});null!=F&&(a.geometryRepresentation=F.visualElement,a.geometryRepresentation instanceof Bi&&this.addHandles([a.geometryRepresentation.events.on("attachment-origin-changed",()=>{a.object.isDraped||this._updateMoveManipulation(h)}),(0,ge.wB)(()=>a.object.isDraped,()=>this._updateMoveManipulation(h))],ci),this.addHandles(F,ci))}}_updateMoveManipulationAngle(h){this._moveManipulation&&(this._moveManipulation.angle=Fs(bt(h.object)))}_updateMoveManipulation(h){const a=(0,Ni.T)(0,0,0,this.view.spatialReference);let y=0,F=!1;const $=this._moveManipulation;if($){for(const ee of h){if(!ee.object.visible)continue;this.enableZ&&Xi(ee.object.operations,ee.object.elevationInfo)&&(F=!0);const te=ee.geometryRepresentation instanceof Bi&&!ee.object.isDraped?ee.geometryRepresentation.attachmentOrigin:ee.object.origin;if(null!=te){const{x:ie,y:ne,z:ae}=te;a.x+=ie,a.y+=ne,ae&&(a.z??=0,a.z+=ae),y++}}y>0?(a.x/=y,a.y/=y,a.z??=0,a.z/=y,$.location=a,$.xyManipulation.available=!0,$.xyAxisManipulation.available=!0,$.zManipulation.available=F):$.available=!1}}_buildDragEventPipeline(h,a,y,F,$,ee){const te=[],ie=[];let ne=null,ae=null;const le=()=>{for(const ue of te)ue.dragging=!1;te.length=0,ie.length=0,ne=null,ae=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===h.length&&a===ht.XY){const ue=h[0].object;({steps:F,cancel:$}=this._buildSnappingPipelineSteps(ue,ue.elevationInfo,F,$,ee))}return $=$.next(ue=>ae?.(ue)).next(()=>(ie.length&&this.events.emit("move-stop",new ta(ie)),this.destroyed||le(),null)),{steps:F=F.next(ue=>{if("start"===ue.action){te.length=0,ie.length=0;for(const _e of h)_e.dragging||!_e.manipulationXY?.hasManipulator(y)&&_e.manipulationXY?.grabbing||(te.push(_e),ie.push(_e.object),_e.dragging=!0);if(0!==ie.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),ne=(0,We.bl)(ie),ae=(0,We.mc)(ie),this._emitRecordUndo(),this.events.emit("move-start",new Xo(ie)),this.destroyed))return null}return 0!==ie.length?ue:null}).next(ue=>ne?.(ue)).next(ue=>(this._updateMoveTooltip(a,ue),ue)).next(ue=>{switch(ue.action){case"start":case"update":if(ue.translationX||ue.translationY||ue.translationZ){const _e=this.view.toScreen(ue.mapStart),be=this.view.toScreen(ue.mapEnd);if(!_e||!be)return null;if(this.events.emit("move",new Yo(be.x-_e.x,be.y-_e.y,ie)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new ta(ie)),this.destroyed)return null;le()}return null}),cancel:$}}_connectTooltips(){let h;if(this.removeHandles($o),this._shouldShowMovePointTooltip){const a=this.objects.at(0),{events:y}=this;this._movePointTooltipInfo??=new Wo.F({viewType:this.view.type,sketchOptions:this.sketchOptions});const F={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),y.emit("move-start",new Xo([a]))},onMove:()=>y.emit("move",new Yo(0,0,[a])),onMoveStop:()=>y.emit("move-stop",new ta([a])),onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},onScaleStart:()=>{},onScale:()=>{},onScaleStop:()=>{}};h=lo(this.tooltip,a,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:F}))}else h=(0,ge.wB)(()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null,a=>{this.tooltip.info=a},ge.pc);this.addHandles(h,$o)}_showTooltip(h){this._shouldShowMovePointTooltip||this._updateMoveTooltip(h)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(h,a){if(this._shouldShowMovePointTooltip)return;const{sketchOptions:y}=this;switch(h){case ht.XY:this._latestTooltipInfo=this._translateTooltipInfo??=new ea.M({sketchOptions:y}),ia(this._latestTooltipInfo,a,(F,$)=>(0,Ze.Kt)(F,$));break;case ht.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??=new pn({sketchOptions:y}),ia(this._latestTooltipInfo,a,(F,$)=>(0,Pt.hs)((0,Ze.Kt)(F,$),zo(a)));break;case ht.Z:this._latestTooltipInfo=this._translateZTooltipInfo??=new Qi({sketchOptions:y}),ia(this._latestTooltipInfo,a,os.e5)}this._latestTooltipInfo.sketchOptions=y}_emitRecordUndo(){const h=this.objects.toArray().map(a=>a.createUndoRecord?.()).filter(Zs.Ru);h.length>0&&this.events.emit("record-undo",{updates:h})}_buildSnappingPipelineSteps(h,a,y,F,$){const ee=bt(h);if(null==ee||"point"!==ee.type&&"mesh"!==ee.type)return{steps:y,cancel:F};const te=("point"===ee.type?ee:ee.origin).clone(),ie=new ms.e({elevationInfo:a,pointer:$,editGeometryOperations:qs.p.fromGeometry(te,this.view.state.viewingMode),visualizer:new xn,excludeFeature:h.graphic}),ne=this.snappingManager,{snappingStep:ae,cancelSnapping:le}=(0,vs.L)({snappingContext:ie,snappingManager:ne,updatingHandles:this._updatingHandles});return F=F.next(le),{steps:y=y.next(ue=>(te.z=(0,Te.wS)(this.view,te,h.elevationInfo,{mode:"absolute-height",offset:0}),{...ue,snapOrigin:ie.coordinateHelper.pointToVector(te)})).next(...ae),cancel:F}}};(0,re._)([(0,ce.MZ)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"view",void 0),(0,re._)([(0,ce.MZ)()],Xt.prototype,"objects",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"enableZ",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0,type:Ti.A})],Xt.prototype,"sketchOptions",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],Xt.prototype,"snappingManager",void 0),(0,re._)([(0,ce.MZ)()],Xt.prototype,"type",void 0),(0,re._)([(0,ce.MZ)()],Xt.prototype,"updating",null),(0,re._)([(0,ce.MZ)()],Xt.prototype,"_latestTooltipInfo",void 0),(0,re._)([(0,ce.MZ)()],Xt.prototype,"_shouldShowMovePointTooltip",null),(0,re._)([(0,ce.MZ)()],Xt.prototype,"activeTooltipInfo",null),Xt=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.move.MoveTool3D")],Xt);class Zc{constructor(a){this.object=a,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}}function ia(h,a,y){if(null==a||"end"===a.action)return void(h.distance=Pt.r7);const{mapStart:F,mapEnd:$}=a,ee=y(F,$);h.distance=ee??Pt.r7}var Fc=se(93615),Bc=se(32034),Ko=se(83393),ys=se(79283),na=se(43354);function sa(h,a,y){return new na.L(h,"on-the-ground"===y.mode?na.B.XY:na.B.XYZ,a,0)}function Qo(h,a,y){const F=(0,de.vt)();if(!h.renderCoordsHelper.toRenderCoords(a,F))return null;const $=ko(h,a,(0,ct.Qj)(y.plane)),ee=ko(h,a,y.edgeDirection);if(null==$||null==ee)return null;const te=(0,oe.e)((0,de.vt)(),$,ee);return(0,ct.O_)(F,te,(0,ct.vt)())}function ko(h,a,y){const F=(0,Ni.T)(a.x+y[0],a.y+y[1],a.z+y[2],a.spatialReference),$=(0,de.vt)(),ee=(0,de.vt)();return h.renderCoordsHelper.toRenderCoords(a,$)&&h.renderCoordsHelper.toRenderCoords(F,ee)?(0,oe.o)(ee,$,ee):null}function Jo(h,a,y,F){const{elevationInfo:$,operations:ee}=y;if(!ee||!h)return null;const ie=(0,Te.id)(F.manipulator.elevationAlignedLocation,a,$),ne=a.sceneIntersectionHelper.intersectElevationFromScreen((0,xe.gs)(h.x,h.y),$,ie);return ne&&(0,Dn.projectPoint)(ne,ne,ee.data.spatialReference)?ne:null}var ki=se(33983);let Pi=class extends In.w{constructor(h){super(h),this.type="reshape-edge-offset",this.distance=(0,ki.Y3)({lockable:!1}),this.area=(0,ki.Am)({visible:!1}),this.totalLength=(0,ki.fr)({visible:!1})}get allFields(){return[this.distance,this.area,this.totalLength]}};(0,re._)([(0,ce.MZ)()],Pi.prototype,"type",void 0),(0,re._)([(0,ce.MZ)()],Pi.prototype,"distance",void 0),(0,re._)([(0,ce.MZ)()],Pi.prototype,"area",void 0),(0,re._)([(0,ce.MZ)()],Pi.prototype,"totalLength",void 0),(0,re._)([(0,ce.MZ)()],Pi.prototype,"allFields",null),Pi=(0,re._)([(0,Ie.$)("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],Pi);var Kc=se(41980),qo=se(84177);function kc(h,a,y){function F(){const ie=y(),ne=ie.sketchOptions.tooltips.effectiveEnabled?ie.activeTooltipInfo:null;return{...ie,activeTooltipInfo:ne}}let $=!1;function ee(ie){$||($=!0,ie(),$=!1)}function te(ie){ee(()=>{(function qc(h,{activeTooltipInfo:a,selectedVertexManipulatorInfo:y,sketchOptions:F}){if(a)switch(a.sketchOptions=F,a?.type){case"move-point":ho(a,h);break;case"selected-vertex":!function eh(h,a,y){if(!h||"selected-vertex"!==h.type)return;const F=a?.manipulator.location;h.setLocationFromPoint(F),uo(h,F,y);const $=y.operations?.data.geometry;switch($?.type){case"polygon":h.geometryType="polygon",h.totalLength.visible=!1,h.area.actual=(0,qo.n)($);break;case"polyline":h.geometryType="polyline",h.totalLength.actual=(0,Ze.ob)($),h.area.visible=!1}}(a,y,h)}})(a,ie),h.info=ie.activeTooltipInfo})}return(0,Se.vE)([(0,ge.wB)(F,te,ge.pc),(0,ge.wB)(()=>{const ie=F(),{activeTooltipInfo:ne}=ie;if(ne&&"key"in ne)return{context:ie,activeTooltipInfo:ne,key:ne.key,geometry:bt(a)}},(ie,ne)=>{ie&&ne&&ne.key!==ie.key&&ee(()=>er(a,ie.context))},ge.OH),a.on("committed",()=>te(F())),(0,It.sZ)(h,{onBeforePaste:()=>{$=!0},onAfterPaste:()=>{er(a,F()),$=!1}})])}function er(h,{activeTooltipInfo:a,selectedVertexManipulatorInfo:y,callbacks:F}){if(!a)return;F.onBeforeReshape();const $=bt(h);switch($?.type){case"mesh":"move-point"===a.type&&rs(a,$.origin,h,F);break;case"point":"move-point"===a.type&&rs(a,$,h,F);break;case"polyline":case"polygon":"selected-vertex"===a.type&&function Jc(h,a,y,F){if(!a)return;const{dx:$,dy:ee,dz:te}=(0,It.mu)(h,a.manipulator.location);0===$&&0===ee&&0===te||(F.onReshapeStart(),y.operations?.moveVertices([a.handle],$,ee,te,ti.Y.NEW_STEP),F.onReshape(),F.onReshapeStop())}(a,y,h,F)}}function aa(h,a,y){if(null!=a&&"end"!==a.action){const{mapStart:F,mapEnd:$}=a,ee=y(F,$);h.distance=ee??Pt.r7}else h.distance=Pt.r7}function tr({operations:h},a,{sketchOptions:y,tooltipInfos:F}){const $=F.edgeOffset;if($.distance.committed=null,null!=a&&null!=a.signedDistance&&"end"!==a.action&&null!=h){const te=h.data.coordinateHelper,{start:ie,end:ne}=a.operation.clampedStartAndEnd(a.mapEnd),ae=(0,Ze.Do)(ie,ne,te.spatialReference),le=Math.sign(a.signedDistance*a.operation.selectedArrow);$.distance.actual=null!=ae?(0,Pt.hs)(ae,le):null}else $.distance.actual=Pt.r7;const ee=h?.data.geometry;switch($.area.actual=null,$.area.visible=!1,$.totalLength.actual=null,$.totalLength.visible=!1,ee?.type){case"polygon":$.area.actual=(0,qo.n)(ee),$.area.visible=!0;break;case"polyline":$.totalLength.actual=(0,Ze.ob)(ee),$.totalLength.visible=!0}return $.sketchOptions=y,$}var ir=se(27111),nr=se(46153);const sr=Symbol();let pt=class extends pe.A{get _operations(){return this.object.operations}constructor(h){super(h),this._selectedIndex=0,this._manipulatorHandles=new ps.A,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=rt.NONE,this._pendingEdgeOffsetInfo=null,this._updatingHandles=new as.U,this._recreatingManipulators=!1,this._settings=new Nt({getTheme:()=>this.view.effectiveTheme}),this.events=new Qt.A,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null,this._tooltipCallbacks={onBeforeReshape:()=>this.tool.endDrag(),onReshapeStart:()=>this._updateEventState(rt.RESHAPING),onReshape:()=>this.events.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>this._updateEventState(rt.NONE,{forceEnd:!0}),onMoveStart:()=>this._updateEventState(rt.MOVING),onMove:()=>this.events.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>this._updateEventState(rt.NONE,{forceEnd:!0})}}initialize(){const{view:h}=this,a=this._settings.manipulators,y=a.vertex;this.tooltipInfos=function Qc(h,a){const y=a?.type;return{edgeOffset:new Pi({sketchOptions:h,viewType:y}),movePoint:new Wo.F({sketchOptions:h,viewType:y}),selectedVertex:new Kc.d({sketchOptions:h,viewType:y}),translate:new ea.M({sketchOptions:h,viewType:y}),translateXY:new pn({sketchOptions:h,viewType:y}),translateZ:new Qi({sketchOptions:h,viewType:y})}}(this._sketchOptions,h),this._vertexManipulatorMaterial=gi((0,De.QP)(y.color),y.renderOccluded),this._vertexManipulatorOutlineMaterial=Cn((0,De.QP)(y.outlineColor),y.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Cn((0,De.QP)(y.hoverOutlineColor),y.renderOccluded);const F=a.edge;this._edgeManipulatorMaterial=gi((0,De.QP)(F.color),F.renderOccluded),this._edgeManipulatorOutlineMaterial=Cn((0,De.QP)(F.outlineColor),F.renderOccluded);const $=a.edgeOffset;this._edgeOffsetManipulatorMaterial=gi((0,De.QP)($.color),$.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=gi((0,De.QP)($.hoverColor),$.renderOccluded,!1);const ee=a.selected;this._selectedManipulatorMaterial=gi((0,De.QP)(ee.color),ee.renderOccluded),this._selectedManipulatorOutlineMaterial=Cn((0,De.QP)(ee.outlineColor),ee.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Cn((0,De.QP)(ee.hoverOutlineColor),ee.renderOccluded),this.tooltip=(0,It.A)(()=>({view:h,options:this._sketchOptions.tooltips})),this.addHandles([(0,ge.wB)(()=>{const te=this._settings.manipulators;return{vertexSettings:te.vertex,edgeSettings:te.edge,edgeOffsetSettings:te.edgeOffset,selectedSettings:te.selected}},({vertexSettings:te,edgeSettings:ie,edgeOffsetSettings:ne,selectedSettings:ae})=>{te.applyColor(this._vertexManipulatorMaterial),te.applyOutline(this._vertexManipulatorOutlineMaterial),te.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),ie.applyColor(this._edgeManipulatorMaterial),ie.applyOutline(this._edgeManipulatorOutlineMaterial),ne.applyColor(this._edgeOffsetManipulatorMaterial),ne.applyHover(this._edgeOffsetManipulatorHoverMaterial),ae.applyColor(this._selectedManipulatorMaterial),ae.applyOutline(this._selectedManipulatorOutlineMaterial),ae.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),(0,ge.wB)(()=>this.object.visible,te=>{for(const ie of this._manipulatorInfos)ie.manipulator.available=te,ra(ie)&&(ie.edgeManipulator.available=te)}),(0,ge.wB)(()=>this._numGrabbing+this._numDragging===0,te=>this._toggleAutoHideManipulators(te)),(0,ge.wB)(()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:te,enabled:ie,edgeOffsetEnabled:ne})=>{null!=te&&(te.visible=ie,te.edgeDistance=ne?"far":"default")},ge.Vh),kc(this.tooltip,this.object,()=>this._tooltipsContext),(0,ge.wB)(()=>this.tooltip.mode,(te,ie)=>{"input"===ie&&"input"!==te&&this._resetTooltip()}),(0,ge.on)(()=>this._operations,"vertex-update",te=>this._updateManipulatorPositions(te.vertices),{onListenerAdd:()=>this._recreateManipulators()}),(0,ge.on)(()=>this._operations?.data,"change",te=>{"undo"!==te.operation&&"redo"!==te.operation||this._recreateManipulators()})])}destroy(){this._removeManipulators(),this._updatingHandles.destroy(),this._segmentLabels=(0,Oe.pR)(this._segmentLabels),this.tooltip=(0,Oe.pR)(this.tooltip)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}enterInputModeIfAvailable(h){return"key-down"===h.type&&h.key===nr.ac.enterInputMode&&("reshape-edge-offset"===this.activeTooltipInfo?.type?this._enterInputModeDuringEdgeOffset(h):!!(0,It.wG)(h,this.tooltip)&&(this.tool.endDrag(),!0))}removeSelectedVertices(){const h=this._manipulatorInfos.filter(a=>a.manipulator.selected&&"vertex"===a.type);return this._removeVertices(h),h.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,Oe.pR)(this._moveManipulation),this._objectMoveManipulation=(0,Oe.pR)(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(h){if(null==this._operations)return;const a=this.object.elevationInfo;for(const y of this._operations.data.components){const F=h?.byComponentIndex.get(y.index);for(const $ of y.vertices){const ee=F?.has($.index);this._createVertexOrEdgeManipulator($,a,ee)}for(const $ of y.edges)this._createVertexOrEdgeManipulator($,a)}this._createObjectMoveManipulation(),this._createMoveManipulation(a),this._createVisualElements()}get canRedo(){return null!=this._operations&&this._operations.canRedo}get canUndo(){return null!=this._operations&&this._operations.canUndo}redo(){return this._operations?.redo()}undo(){return this.events.emit("undo"),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=(0,Oe.pR)(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){const h=this._sketchOptions.labels;this._segmentLabels=new Zn({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:h},visible:h.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(h,a){if("end"===a.action)return a;let y=0;const F=[],$=this._manipulatorInfos.some(te=>"vertex"===te.type&&te.manipulator.selected),ee=h===gn.SELECTED_OR_ALL&&$;for(const te of this._manipulatorInfos)"vertex"===te.type&&(te.manipulator.grabbing||ee&&!te.manipulator.selected||F.push(te),y++);if(this._moveVertices(F,a),F.length===y){if(this._updateEventState(rt.MOVING),this.destroyed)return a;this.events.emit("move",{type:"move",dx:a.screenDeltaX,dy:a.screenDeltaY,object:this.object})}else{if(this._updateEventState(rt.RESHAPING),this.destroyed)return a;this.events.emit("reshape",{type:"reshape",object:this.object})}return a}_toggleAutoHideManipulators(h){this.autoHideManipulators&&(h?this.removeHandles(sr):this.tool.manipulators.forEach(({manipulator:a})=>{const y=a.disableDisplay?.();y&&this.addHandles(y,sr)}))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((h,a)=>"vertex"===a.type&&a.manipulator.selected?h+1:h,0)>1}_perVertexManipulatorDragAction(h){if(this._updateEventState(rt.RESHAPING),this.destroyed)return;const{mapDeltaX:a,mapDeltaY:y,mapDeltaZ:F}=h;if(!a&&!y&&!F)return;const $=[];for(const ee of this._manipulatorInfos)"vertex"===ee.type&&(ee.manipulator.selected&&!ee.manipulator.grabbing||ee===h.info)&&$.push(ee);this._moveVertices($,h,ti.Y.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(h,a={}){if(h===this._reshapeEventState)return!1;switch(h){case rt.NONE:if(!a.forceEnd&&(0!==this._numGrabbing||0!==this._numDragging))return!1;switch(this._reshapeEventState){case rt.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case rt.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case rt.MOVING:switch(this._reshapeEventState){case rt.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case rt.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case rt.RESHAPING:switch(this._reshapeEventState){case rt.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case rt.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;const y=this._reshapeEventState!==h;return this._reshapeEventState=h,y}_createObjectMoveManipulation(){const{tool:h,view:a,object:y,_operations:F}=this;if(F){if(this._objectMoveManipulation=new Js({tool:h,view:a,object:y}),this.enableMoveObject){let $=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((ee,te,ie)=>{te.next(ne=>this._trackNumDragging(ne)).next(ne=>("start"===ne.action&&($=F.createUndoGroup()),ne)).next(ne=>this._perObjectManipulatorDragAction(gn.ALL,ne)).next(ne=>(this._updateTranslateObjectTooltip(ht.XY,ne),ne)).next(ne=>{"end"===ne.action&&(this._resetTooltip(),$=(0,Oe.xt)($))}),ie.next(()=>this._onDragCancel(!0,()=>$=(0,Oe.xt)($)))})),this._objectMoveManipulation.forEachManipulator(ee=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(ee,!1)))}else this._objectMoveManipulation.forEachManipulator($=>{$.grabbable=!1,$.cursor=null});this._objectMoveManipulation.forEachManipulator($=>this._manipulatorHandles.add($.events.on("immediate-click",ee=>{this._manipulatorInfos.some(te=>te.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",{...ee,object:this.object}),ee.stopPropagation()})))}}_createMoveManipulation(h){const{object:a,tool:y,view:F,_operations:$}=this;if(!$)return;this._moveManipulation=new Ki({tool:y,view:F,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Xi(a.operations,a.elevationInfo),snapToScene:!1,radius:Ki.radiusForSymbol(a.graphic?.symbol)}),this._moveManipulation.forEachManipulator(ie=>this.addHandles([ie.events.on("immediate-click",ne=>{this._moveManipulation.zManipulation.hasManipulator(ie)||this._manipulatorInfos.some(ae=>ae.manipulator.selected)||this.events.emit("immediate-click",{...ne,object:this.object}),ne.stopPropagation()}),this._watchAndUpdateGrabState(ie,!1)]));const ee=ie=>ne=>{this.addHandles([ne.events.on("focus-changed",({action:ae})=>{"focus"===ae?this._updateTranslateTooltip(ie):this._resetTooltip()})])};this._moveManipulation.xyManipulation.forEachManipulator(ee(ht.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(ee(ht.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(ee(ht.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0},this.addHandles([this._moveManipulation.createDragPipeline((ie,ne,ae,le,ue)=>{const{snappingStep:_e,cancelSnapping:be}=(0,vs.L)({predicate:we=>!!we.info,snappingManager:y.snappingManager,snappingContext:new ms.e({editGeometryOperations:$,elevationInfo:h,pointer:ue,excludeFeature:a.graphic,visualizer:new xn}),updatingHandles:this._updatingHandles,useZ:!1});return le=le.next(we=>(this._onDragCancel(),we)).next(be),{steps:ae=ae.next(we=>this._trackNumDragging(we)).next(we=>{const Ae=this._manipulatorInfos.filter(Le=>"vertex"===Le.type&&Le.manipulator.selected);return we.manipulatorType===at.TRANSLATE_XY&&1===Ae.length?{...we,info:Ae[0],snapOrigin:Ae[0].handle.pos}:we}).next((0,We.pg)(this.view,h,a.graphic??void 0)).next(..._e).next((0,We.EX)()).next(we=>this._perObjectManipulatorDragAction(gn.SELECTED_OR_ALL,we)).next(we=>(this._updateTranslateTooltip(ie,we),we)),cancel:le}},h,$.data.spatialReference,a.graphic),(0,ge.wB)(()=>a.visible,()=>this._updateMoveManipulationPosition(),ge.Vh),a.on("committed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),(0,ge.wB)(()=>a.isDraped,ie=>{this._updateMoveManipulationPosition();const ne="align-move-manipulation";ie?this.addHandles(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),ne):this.removeHandles(ne)},ge.Vh)])}_createVisualElements(){const{object:h,view:a}=this,y=us({view:a,object:h,forEachManipulator:$=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator($),this._moveManipulation.forEachManipulator($);for(const ee of this._manipulatorInfos)$(ee.manipulator,at.TRANSLATE_XY)}},onManipulatorsChanged:$=>this.events.on("manipulators-changed",$)});null!=y&&(this._outlineVisualElement=y.visualElement instanceof Bi?y.visualElement:null);const F=this._outlineVisualElement;if(null!=F){const $=()=>{h.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add((0,ge.on)(()=>F.events,"attachment-origin-changed",$,{onListenerAdd:$}))}this._manipulatorHandles.add(y)}_createEdgeOffsetManipulator(h,a=this.object.elevationInfo){const y=this.view,F=this._operations;if(h.component.vertices.length<=2||!F)return null;const $=F.data.spatialReference,ee=this._settings.manipulators.edgeOffset,te=ee.size/2,ie=te+ee.collisionPadding,ne=te/ie,ae=ne/2,le=ne*Math.sqrt(3)/2,{height:ue,offset:_e}=ee,be=this._edgeOffsetManipulatorMaterial;if(!this._edgeOffsetManipulatorGeometryInside){const ot=(0,it._B)(be,le,ae,ae,ue,_e);this._edgeOffsetManipulatorGeometryInside=ot}if(!this._edgeOffsetManipulatorGeometryOutside){const ot=(0,it._B)(be,-le,ae,ae,ue,-_e);this._edgeOffsetManipulatorGeometryOutside=ot}const we=[new ze(this._edgeOffsetManipulatorGeometryInside.instantiate(),Re.p7.Unfocused),new ze(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Re.p7.Focused),new ze(this._edgeOffsetManipulatorGeometryOutside.instantiate(),Re.p7.Unfocused),new ze(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Re.p7.Focused)],Ae=new Ut({view:y,renderObjects:we,elevationInfo:"on-the-ground"!==a.mode||(0,Ko.$d)(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:a,worldOriented:!1,focusMultiplier:1,radius:ie,available:this.object.visible,collisionType:{type:"disc",direction:(0,de.fA)(0,0,1)},collisionPriority:1,metadata:{deleting:!1},location:oa($)}),Le=new Ut({view:y,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1},location:oa($)}),Ce={manipulator:Ae,handle:h,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:Le,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(Ce,ee.minSquaredEdgeLength);const Ne=()=>this._updateEdgeOffsetManipulator(Ce);Ne(),Ce.locationUpdateHandle=(0,Se.vE)([h.leftVertex,h.rightVertex].map(ot=>this._getManipulatorInfoFromHandle(ot)?.manipulator.events.on("location-update",Ne)));const nt=ot=>{this._manipulatorInfos.some(et=>et.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",{...ot,object:this.object}),ot.stopPropagation()};return this._manipulatorHandles.add([Ce.locationUpdateHandle,this._watchAndUpdateGrabState(Ae,!0),this._watchAndUpdateGrabState(Le,!0),(0,We.Xt)(Ae,this._createEdgeOffsetPipeline(Ce,a,F)),(0,We.Xt)(Le,this._createEdgePipeline(Ce,a,F)),Le.events.on("immediate-click",nt),Ae.events.on("immediate-click",nt),Ae.events.on("focus-changed",()=>this._resetTooltip()),Ae.events.on("grab-changed",({screenPoint:ot,action:et})=>{Ce.grabMapPoint="start"===et?Jo(ot,this.view,this.object,Ce):null})],Ae),this._manipulatorInfos.push(Ce),this.manipulators.addMany([Ae,Le]),this.events.emit("manipulators-changed"),Ce}_autoHideEdgeOffsetManipulator(h,a){const y=h.manipulator,F=h.edgeManipulator,$=()=>{h.visibilityHandle=(0,Oe.xt)(h.visibilityHandle);const ee=this._getManipulatorInfoFromHandle(h.handle.leftVertex),te=this._getManipulatorInfoFromHandle(h.handle.rightVertex),ie=null!=ee&&null!=te&&function Xc(h,a,y){const F=y.projectToRenderScreen(h,(0,xe.r_)()),$=y.projectToRenderScreen(a,(0,xe.r_)());return null!=F&&null!=$?(0,oe.k)((0,oe.d)(F,F,$)):0}(ee.manipulator.renderLocation,te.manipulator.renderLocation,this.view.state.camera)<a;(!y.focused&&!F.focused||ie)&&(y.grabbable=!ie,F.grabbable=!ie,h.visibilityHandle=(0,Se.vE)([y.disableDisplay(),(0,Se.hA)(()=>{y.grabbable=!0,F.grabbable=this.enableMoveObject})]))};this._manipulatorHandles.add([y.events.on("focus-changed",$),F.events.on("focus-changed",$),(0,Se.hA)(()=>{(0,Oe.xt)(h.visibilityHandle),F.metadata.deleting=!0,this.manipulators.remove(F)})],y),$()}_updateEdgeOffsetManipulator(h){if(!this._operations)return;this._updateManipulatorPosition(h);const{coordinateHelper:a}=this._operations.data,y=Qo(this.view,h.manipulator.elevationAlignedLocation,sa(a,h.handle,h.manipulator.elevationInfo)),F=this._getManipulatorInfoFromHandle(h.handle.leftVertex),$=this._getManipulatorInfoFromHandle(h.handle.rightVertex);if(null==F||null==$)return;const ee=F.manipulator.renderLocation,te=$.manipulator.renderLocation,ie=null!=y?function Wc(h,a,y){const F=(0,ct.Qj)(h),$=(0,oe.o)((0,de.vt)(),a,y),ee=(0,oe.e)((0,de.vt)(),$,F),te=(0,oe.e)((0,de.vt)(),$,ee);return(0,Ct.fA)($[0],$[1],$[2],0,ee[0],ee[1],ee[2],0,te[0],te[1],te[2],0,0,0,0,1)}(y,ee,te):Ct.zK;h.manipulator.modelTransform=ie,h.edgeManipulator.elevationAlignedLocation=h.manipulator.elevationAlignedLocation,h.edgeManipulator.modelTransform=ie;const ne=(0,oe.l)((0,oe.d)(Ms,ee,te))/2;h.edgeManipulator.collisionType={type:"line",paths:[[[-ne,0,0],[ne,0,0]]]}}_createEdgePipeline(h,a,y){return(F,$,ee,te)=>{if("touch"===te)this._createEdgeOffsetPipeline(h,a,y)(F,$,ee);else if(this.enableMoveObject){const ie=this.object.graphic,ne=y.data.spatialReference,{elevationAlignedLocation:ae}=F;$.next(le=>this._trackNumDragging(le)).next((0,We.Tp)(this.view,ae)).next(Pn(this.view,ae,a,ne,ie)).next((0,We.sO)()).next((0,We.EX)()).next(le=>this._perObjectManipulatorDragAction(gn.ALL,le)).next(le=>(this._updateTranslateObjectTooltip(ht.XY,le),le)).next(le=>{"end"===le.action&&this._resetTooltip()}),ee.next(()=>this._onDragCancel(!F.metadata.deleting))}}}_createEdgeOffsetPipeline(h,a,y){return(F,$,ee)=>{const te=this._pendingEdgeOffsetInfo;if(te?.manipulatorInfo===h&&"drag"!==te.mode)return void ee.execute({action:"cancel"});this._clearSelection();const{initializeStep:ie,cleanup:ne}=this._initializeEdgeOffset(h,a,y,ee),ae=this._applyEdgeOffsetStep(h);$.next(le=>this._trackNumDragging(le)).next((0,We.Tp)(this.view,F.elevationAlignedLocation)).next(ie).next(function xc(h){return Io(h,a=>a.plane)}(this.view)).next(jo(this.view,y.data.spatialReference)).next((0,We.EX)()).next(h=>{const{operation:a,mapEnd:y}=h;return null==a||null==y?h:{...h,signedDistance:a.signedDistanceToPoint(y)}}).next(le=>this._pendingEdgeOffsetInfo?le:ae(le)).next(le=>{"end"!==le.action||this._pendingEdgeOffsetInfo||ne()}),ee.next(()=>{this._exitEdgeOffsetInputMode(),F.metadata.deleting||(ne(),this._onDragCancel())})}}_initializeEdgeOffset(h,a,y,F){const{view:$,object:ee}=this,te=sa(y.data.coordinateHelper,h.handle,a),ie=y.createUndoGroup(),ne=Qo($,h.manipulator.elevationAlignedLocation,te);let ae;this._splitEdgesBeforeEdgeOffset(h,te),this._selectEdgeOffsetArrow(h,te);const le=()=>{this._cleanEdgeOffsetCollapsedEdges(h,y),ae=(0,Oe.xt)(ae)},ue=this.events.on("undo",le);return ae=(0,Se.vE)([this._initializeEdgeOffsetVisualElement(h,ee,a,y),ie,ue,this._connectEdgeOffsetTooltip(h,te,y,()=>{F.execute({action:"cancel"})})]),{initializeStep:_e=>null==te||null==ne?(le(),null):{..._e,operation:te,plane:ne},cleanup:le}}_initializeEdgeOffsetVisualElement(h,a,y,F){const $=()=>new Fc.A({paths:[[h.handle.leftVertex.pos,h.handle.rightVertex.pos]],spatialReference:F.data.spatialReference}),ee=new Bi({view:this.view,isDraped:a.isDraped,geometry:$(),elevationInfo:y,width:this._settings.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),te=(0,Se.vE)([(0,ge.wB)(()=>({color:this._accentColor,draped:a.isDraped}),({color:ie,draped:ne})=>{ee.color=(0,De.QP)(ie),ee.isDraped=ne},ge.pc),a.on("committed",()=>{ee.geometry=$()}),(0,Se.DQ)(ee)]);return ee.attached=!0,te}_applyEdgeOffsetStep(h){return a=>(this.destroyed||null==a.operation||!this._operations||(this._updateEventState(rt.RESHAPING),null==a.signedDistance?this._resetTooltip():((a.mapDeltaX||a.mapDeltaY||a.mapDeltaZ)&&(this._offsetEdge(h,a.operation,a.signedDistance),this.events.emit("reshape",{type:"reshape",object:this.object})),this._updateEdgeOffsetTooltip(a))),a)}_cleanEdgeOffsetCollapsedEdges(h,a){const y=h.handle.leftVertex.leftEdge?.leftVertex,F=h.handle.leftVertex,$=h.handle.rightVertex.rightEdge?.rightVertex,ee=h.handle.rightVertex,te=a.data.coordinateHelper,ie=this.view.pixelSizeAt(te.vectorToDehydratedPoint(F.pos),te.spatialReference),ne=[];if(y&&te.distance(y.pos,F.pos)<rr){const ae=this._getManipulatorInfoFromHandle(F);null!=ae&&ne.push(ae)}if(te.distance(F.pos,ee.pos)<ie||$&&te.distance($.pos,ee.pos)<rr){const ae=this._getManipulatorInfoFromHandle(ee);null!=ae&&ne.push(ae)}ne.length&&this._removeVertices(ne)}_enterInputModeDuringEdgeOffset(h){const a=this._findActiveEdgeOffsetManipulatorInfo();return!(!a||!(0,It.wG)(h,this.tooltip)||(a.manipulator.dragging?(this._pendingEdgeOffsetInfo={manipulatorInfo:a,mode:"drag"},0):(this._clearSelection(),this._pendingEdgeOffsetInfo={manipulatorInfo:a,mode:"hover"},this._connectEdgeOffsetTooltipOnHover(a),0)))}_exitEdgeOffsetInputMode(){this.tooltip&&(this._pendingEdgeOffsetInfo=null,this._resetTooltip(),this.tooltip.exitInputMode())}_findActiveEdgeOffsetManipulatorInfo(){return this._manipulatorInfos.filter(ra).find(({manipulator:h})=>h.hovering||h.grabbing||h.dragging)}_connectEdgeOffsetTooltipOnHover(h){const{_operations:a,object:y}=this;if(!a)return;const{elevationInfo:F}=y,$=sa(a.data.coordinateHelper,h.handle,F);this._selectEdgeOffsetArrow(h,$),this.addHandles([this._initializeEdgeOffsetVisualElement(h,y,F,a),this._connectEdgeOffsetTooltip(h,$,a,()=>{this.removeHandles($),this._exitEdgeOffsetInputMode()})],$)}_splitEdgesBeforeEdgeOffset(h,a){if(a.requiresSplitEdgeLeft){const y=this._getManipulatorInfoFromHandle(h.handle.leftVertex.leftEdge);null!=y&&this._splitEdgeManipulator(y,1)}if(a.requiresSplitEdgeRight){const y=this._getManipulatorInfoFromHandle(h.handle.rightVertex.rightEdge);null!=y&&this._splitEdgeManipulator(y,0)}}_selectEdgeOffsetArrow(h,a){const y=h.grabMapPoint??Jo(this.view.inputManager?.latestPointerLocation,this.view,this.object,h);y&&a.selectArrowFromStartPoint(y)}_connectEdgeOffsetTooltip(h,a,y,F){const $=()=>this.tooltipInfos.edgeOffset.distance.actual,ee=ie=>{F(),queueMicrotask(()=>{this.view.focus();const ne=y.createUndoGroup();this._tooltipCallbacks.onReshapeStart?.(),this._splitEdgesBeforeEdgeOffset(h,a),this._offsetEdge(h,a,function Yc(h,a,y,{data:{coordinateHelper:F,spatialReference:$}}){const ee=(0,Pt.l3)(h,"meters"),te=(0,qe.GA)($),ie=Math.sign(ee*y.selectedArrow),ne=(0,ys.Xn)($),ae=(0,ct.Qj)(y.plane),le=F.pointToXYZ(a),ue=(0,de.vt)();(0,oe.b)(ue,le,ae,ie*(10/te));const _e=ee*y.selectedArrow/te;if(!ne||!(0,yi.F)(le,$,le,ne)||!(0,yi.F)(ue,$,ue,ne))return _e;const be=new ys.Zj;if((0,ys._3)(be,le,ue,ne),(0,ys.vN)(ue,le,be.azimuth,ee,ne),!(0,yi.F)(ue,ne,ue,$))return _e;const we=ue[0]-a.x,Ae=ue[1]-a.y,Le=Math.sqrt(we*we+Ae*Ae)*ie,[Ce,Ne]=ae,nt=Math.sqrt(Ce*Ce+Ne*Ne);return 0===nt?0:Le/nt}(ie,h.manipulator.location,a,y)),this._tooltipCallbacks.onReshape?.(),this._tooltipCallbacks.onReshapeStop?.(),this._cleanEdgeOffsetCollapsedEdges(h,y),ne.remove()})},te=()=>{const ie=$();null!=ie?ee(ie):F()};return(0,Se.vE)([(0,ge.z7)(()=>this.tooltip&&!this.tooltip.focused,()=>te(),ge.OH),this.tooltip.on("discard",F),this.tooltip.on("commit",ie=>{"commit-and-exit"===ie.type&&te()})])}_createVertexOrEdgeManipulator(h,a=this.object.elevationInfo,y=!1){const F=this.view,$=this._operations,ee=this._settings;if(!$)return null;const te=$.data.type,ie=$.data.spatialReference;if("edge"===h.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(h,a);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:_e,outlineSize:be}=ar(ee.manipulators.vertex);this._vertexManipulatorGeometry=(0,it.CM)(this._vertexManipulatorMaterial,_e,16,16),this._vertexManipulatorOutlineGeometry=(0,it.CM)(this._vertexManipulatorOutlineMaterial,be,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:_e,outlineSize:be}=ar(ee.manipulators.edge);this._edgeManipulatorGeometry=(0,it.CM)(this._edgeManipulatorMaterial,_e,16,16),this._edgeManipulatorOutlineGeometry=(0,it.CM)(this._edgeManipulatorOutlineMaterial,be,16,16)}const ne="point"===te||"mesh"===te?[]:[new ze(this._vertexManipulatorGeometry.instantiate(),ai.Vertex|Re.p7.Unselected),new ze(this._vertexManipulatorOutlineGeometry.instantiate(),ai.Vertex|Re.p7.Unfocused|Re.p7.Unselected),new ze(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ai.Vertex|Re.p7.Focused|Re.p7.Unselected),new ze(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),Re.p7.Selected),new ze(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),Re.p7.Selected|Re.p7.Unfocused),new ze(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),Re.p7.Selected|Re.p7.Focused)];this.enableMidpoints&&ne.push(new ze(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),ai.Edge|Re.p7.Focused|Re.p7.Unselected),new ze(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ai.Edge|Re.p7.Focused|Re.p7.Unselected),new ze(this._edgeManipulatorGeometry.instantiate(),ai.Edge|Re.p7.Unfocused|Re.p7.Unselected),new ze(this._edgeManipulatorOutlineGeometry.instantiate(),ai.Edge|Re.p7.Unfocused|Re.p7.Unselected));const ae=new Ut({view:F,renderObjects:ne,elevationInfo:a,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1},location:oa(ie)});ae.selected=y,this._setTypeSpecificManipulatorSettings(ae,h,a);const le="edge"===h.type?{manipulator:ae,handle:h,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:ae,handle:h,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(le),this.manipulators.add(ae),this._updateManipulatorPosition(le),"edge"===le.type){const _e=[];for(const be of[le.handle.leftVertex,le.handle.rightVertex]){const we=this._getManipulatorInfoFromHandle(be);null!=we&&_e.push(we.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(le)))}le.locationUpdateHandle=(0,Se.vE)(_e),this._manipulatorHandles.add(le.locationUpdateHandle,ae)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(ae,!0),ae);const ue=(0,We.Xt)(ae,(_e,be,we,Ae)=>{let Le=null;const{snappingStep:Ce,cancelSnapping:Ne}=(0,vs.L)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new ms.e({editGeometryOperations:$,elevationInfo:a,pointer:Ae,excludeFeature:this.object.graphic,visualizer:new xn}),updatingHandles:this._updatingHandles,useZ:!1});we=we.next(et=>(this._onDragCancel(!_e.metadata.deleting,()=>Le=(0,Oe.xt)(Le)),et)).next(Ne);const{elevationAlignedLocation:nt}=_e,ot=this.object.graphic??void 0;be.next(et=>this._trackNumDragging(et)).next(et=>{if("start"===et.action&&$&&(Le=$.createUndoGroup()),"edge"===le.type){const Rt=this._splitEdgeManipulator(le);return{...et,info:Rt,snapOrigin:Rt.handle.pos}}return{...et,info:le,snapOrigin:le.handle.pos}}).next((0,We.Tp)(F,nt)).next(Pn(F,nt,a,ie,ot)).next((0,We.pg)(F,a,ot)).next(...Ce).next((0,We.EX)()).next(et=>{this._perVertexManipulatorDragAction(et),"end"===et.action&&(Le=(0,Oe.xt)(Le)),this._resetTooltip()})});return this._manipulatorHandles.add([ue,ae.events.on("immediate-click",_e=>this._manipulatorClickCallback(_e,le)),ae.events.on("select-changed",()=>{le.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()}),ae.events.on("focus-changed",()=>{this._resetTooltip()})],ae),this.events.emit("manipulators-changed"),le}_trackNumDragging(h){switch(h.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return h}_onDragCancel(h=!0,a){switch(this._numDragging--,h&&this.undo(),this.tool.snappingManager?.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case rt.NONE:break;case rt.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case rt.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}a?.(),this.destroyed||this._updateEventState(rt.NONE)}_setTypeSpecificManipulatorSettings(h,a,y){const F=this._settings;switch(a.type){case"vertex":{h.state=ai.Vertex,h.selectable=!0,h.cursor="move",h.collisionPriority=2;const{size:$,collisionPadding:ee}=F.manipulators.vertex;h.radius=$/2+ee,h.elevationInfo=y;const te=this._operations?.data.type;h.interactive=null!=te&&"point"!==te&&"mesh"!==te;break}case"edge":{h.state=ai.Edge,h.selectable=!1,h.cursor="copy",h.collisionPriority=-1;const{size:$,collisionPadding:ee}=F.manipulators.edge;h.radius=$/2+ee,h.elevationInfo="on-the-ground"!==y.mode||(0,Ko.$d)(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:y;break}}}_watchAndUpdateGrabState(h,a){return h.events.on("grab-changed",y=>{this._onGrabStateChanged(h,a,y.action,y.pointerType)})}_onGrabStateChanged(h,a,y,F="mouse"){if(!this._recreatingManipulators){if("start"===y)a&&this._updateSelection(h),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(rt.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==F||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach($=>{const{manipulator:ee}=$,te=this._operations?.data.type;ee.interactive=ee.grabbing||!this._numGrabbing&&null!=te&&"point"!==te&&"mesh"!==te,ra($)&&($.edgeManipulator.interactive=$.edgeManipulator.grabbing||!this._numGrabbing)}),this._objectMoveManipulation.forEachManipulator($=>{$.interactive=$.grabbing||!this._numGrabbing}))}}_clearSelection(){for(const h of this._manipulatorInfos)h.manipulator.grabbing||(h.manipulator.selected=!1);this._pendingEdgeOffsetInfo=null}_updateSelection(h){h.grabbing&&!h.selected&&h.selectable&&(this._clearSelection(),h.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(h){null!=h&&(h.manipulator.metadata.deleting=!0,this.manipulators.remove(h.manipulator),this._manipulatorHandles.remove(h.manipulator),(0,Zs.Xy)(this._manipulatorInfos,h),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(h){if(h)for(const a of this._manipulatorInfos)if(h===a.handle)return a;return null}_updateManipulatorPositions(h){for(const a of h)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a))}_updateManipulatorPosition(h){const a=this._operations;if(null!=h&&a)if("vertex"===h.type)h.manipulator.location=a.data.coordinateHelper.vectorToDehydratedPoint(h.handle.pos,Ln),h.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=h.manipulator.renderLocation);else if("edge"===h.type){const y=this._getManipulatorInfoFromHandle(h.handle.leftVertex),F=this._getManipulatorInfoFromHandle(h.handle.rightVertex);if(null==y||null==F)return;const $=y.manipulator,ee=F.manipulator;if("on-the-ground"===h.manipulator.elevationInfo?.mode){const te=$.location,ie=ee.location,ne=.5;h.manipulator.location=(0,Ni.T)(te.x+ne*(ie.x-te.x),te.y+ne*(ie.y-te.y),te.hasZ&&ie.hasZ?0:void 0,a.data.spatialReference)}else(0,oe.m)(Ms,$.renderLocation,ee.renderLocation,.5),h.manipulator.renderLocation=Ms}}_splitEdgeManipulator(h,a=.5){const y=this._operations,F=y.splitEdge(h.handle,a).createdVertex;h.locationUpdateHandle=(0,Oe.xt)(h.locationUpdateHandle);const $=this.object.elevationInfo;let ee;this.enableEdgeOffset?(this._removeManipulator(h),ee=this._createVertexOrEdgeManipulator(F)):(ee=h,ee.handle=F,ee.type="vertex",this._setTypeSpecificManipulatorSettings(h.manipulator,h.handle,$)),F.leftEdge&&this._createVertexOrEdgeManipulator(F.leftEdge),F.rightEdge&&this._createVertexOrEdgeManipulator(F.rightEdge),this._updateManipulatorPosition(ee),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(h.manipulator);const te=this._updateEventState(rt.RESHAPING),ie=y.data.coordinateHelper.vectorToArray(ee.handle.pos),ne=y.data.components.indexOf(F.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:ie,componentIndex:ne,vertexIndex:F.index}],added:ie}),te&&this._updateEventState(rt.NONE),ee}_updateMoveManipulationPosition(){const h=(0,oe.i)(Ms,0,0,0);let a=0,y=!1,F=null,$=null;for(const ie of this._manipulatorInfos)"vertex"===ie.type&&(ie.manipulator.selected?(a++,(0,oe.g)(h,h,ie.manipulator.renderLocation),null==F||ie.selectedIndex>F.selectedIndex?($=F,F=ie):(null==$||ie.selectedIndex>$.selectedIndex)&&($=ie)):y=!0);const ee=this.object,te=this._operations?.data.geometry;if(0===a){const ie=ee.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=ie,this._moveManipulation.xyAxisManipulation.available=ie,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=ie,this._moveManipulation.zManipulation.available=ie&&this.enableZShape&&Xi(this._operations,ee.elevationInfo),this._moveManipulation.angle=Fs(te),this._moveManipulation.radius=Ki.radiusForSymbol(ee.graphic?.symbol)}else{const ie=ee.visible;this._moveManipulation.xyManipulation.available=ie,this._moveManipulation.xyAxisManipulation.available=ie,this._moveManipulation.zManipulation.available=ie&&this.enableZVertex&&Xi(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=ie&&1!==a;let ne=0;if(null!=F){const ae=F.handle.pos,le=null!=$?$.handle.pos:F.handle.leftEdge?.leftVertex?F.handle.leftEdge.leftVertex.pos:null,ue=null==$&&F.handle.rightEdge?.rightVertex?F.handle.rightEdge.rightVertex.pos:null;le&&ue?this._moveManipulation.xyAxisManipulation.available=!1:le?ne=or(le,ae):ue&&(ne=or(ae,ue))}this._moveManipulation.angle=ne,this._moveManipulation.radius=Do}0!==a&&y?((0,oe.h)(h,h,1/a),Ln.spatialReference=this._operations.data.spatialReference,Ln.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(h,Ln),this._moveManipulation.elevationAlignedLocation=Ln):null==this._outlineVisualElement||this.object.isDraped||null==this._outlineVisualElement.attachmentOrigin?Zo(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(h){const a=new Array,y=this._operations;if(y){for(const F of h){const $=F.handle.component;if("vertex"===F.type&&y.canRemoveVertex($)){a.push(F.handle),this._removeManipulator(F),this._removeManipulator(this._getManipulatorInfoFromHandle(F.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(F.handle.rightEdge));const ee=y.removeVertices([F.handle]),te=ee.removedVertices?.[0].createdEdge;te?this._createVertexOrEdgeManipulator(te):this.enableEdgeOffset&&$.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle($.edges[0]))}}if(a.length>0){const F=a.map(ee=>{const te=y.data.components.indexOf(ee.component);return{coordinates:y.data.coordinateHelper.vectorToArray(ee.pos),componentIndex:te,vertexIndex:ee.index}}),$=this._updateEventState(rt.RESHAPING);if(this.destroyed||(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:F.map(ee=>ee.coordinates),vertices:F}),this.destroyed)||$&&(this._updateEventState(rt.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(h,a,y=("start"===a.action?ti.Y.NEW_STEP:ti.Y.ACCUMULATE_STEPS)){const F=this._operations;if(F){h.length>0&&F.moveVertices(h.map($=>$.handle),a.mapDeltaX,a.mapDeltaY,a.mapDeltaZ,y);for(const $ of h)this._updateManipulatorPosition($)}}_offsetEdge(h,a,y){if(!this._operations)return;const F=a.clone();F.distance=y,this._operations.updateVertices([h.handle.leftVertex,h.handle.rightVertex],F),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(h.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(h.handle.rightVertex))}_manipulatorClickCallback(h,a){h.shiftKey||this._clearSelection(),"vertex"===a.type&&(a.manipulator.selected=!a.manipulator.selected,this.enableDeleteVertices&&h.button===ir.w.Right&&this._removeVertices([a])),"edge"===a.type&&h.button===ir.w.Left&&this._splitEdgeManipulator(a),h.stopPropagation()}_updateTranslateTooltip(h,a){null!=this._defaultTooltipInfo?this._resetTooltip():this._updateTranslateObjectTooltip(h,a)}_updateTranslateObjectTooltip(h,a){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=function th(h,a,{sketchOptions:y,tooltipInfos:F}){let $=null;switch(h){case ht.XY:$=F.translate,aa($,a,(ee,te)=>(0,Ze.Kt)(ee,te));break;case ht.XY_AXIS:$=F.translateXY,aa($,a,(ee,te)=>(0,Pt.hs)((0,Ze.Kt)(ee,te),zo(a)));break;case ht.Z:$=F.translateZ,aa($,a,os.e5)}return $.sketchOptions=y,$}(h,a,this._tooltipsContext))}_updateEdgeOffsetTooltip(h){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=tr(this.object,h,this._tooltipsContext))}_resetTooltip(){const h=this.activeTooltipInfo;if(this._pendingEdgeOffsetInfo&&"reshape-edge-offset"===h?.type)return;let a=null;a=this._pendingEdgeOffsetInfo||null!=this._findActiveEdgeOffsetManipulatorInfo()?tr(this.object,null,this._tooltipsContext):this._defaultTooltipInfo,a!==h&&(null!=h&&null!=a&&"input"===this.tooltip.mode||(this.activeTooltipInfo=a))}get _defaultTooltipInfo(){switch(this._operations?.data.type){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){const h=this._manipulatorInfos.filter(a=>"vertex"===a.type&&a.manipulator.selected);return 1===h.length?h[0]:null}get _tooltipsContext(){return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:this._tooltipCallbacks}}get test(){}};function ar(h){const a=h.size/2,y=a+h.collisionPadding;return{size:a/y,outlineSize:(a+h.outlineSize)/y}}function or(h,a){return Math.atan2(a[1]-h[1],a[0]-h[0])+Math.PI/2}function oa(h){return new pi.A({x:0,y:0,z:0,spatialReference:h})}function ra(h){return"edge"===h.type&&"edgeManipulator"in h}(0,re._)([(0,ce.MZ)()],pt.prototype,"_numGrabbing",void 0),(0,re._)([(0,ce.MZ)()],pt.prototype,"_numDragging",void 0),(0,re._)([(0,ce.MZ)()],pt.prototype,"_pendingEdgeOffsetInfo",void 0),(0,re._)([(0,ce.MZ)()],pt.prototype,"_operations",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"_segmentLabels",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],pt.prototype,"tool",void 0),(0,re._)([(0,ce.MZ)()],pt.prototype,"tooltip",void 0),(0,re._)([(0,ce.MZ)()],pt.prototype,"activeTooltipInfo",void 0),(0,re._)([(0,ce.MZ)({readOnly:!0})],pt.prototype,"updating",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"manipulators",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"view",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"object",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"enableZShape",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"enableDeleteVertices",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"enableZVertex",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"autoHideManipulators",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"enableMoveObject",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"enableMidpoints",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"enableEdgeOffset",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"_sketchOptions",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"_accentColor",null),(0,re._)([(0,ce.MZ)()],pt.prototype,"_tooltipsContext",null),pt=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],pt);const Ln=(0,Ni.T)(0,0,void 0,Bc.A.WGS84),Ms=(0,de.vt)(),rr=1e-6;var ai,rt,gn;(function(h){h.Vertex=Re.SJ.Custom1,h.Edge=Re.SJ.Custom2})(ai||(ai={})),function(h){h[h.NONE=0]="NONE",h[h.MOVING=1]="MOVING",h[h.RESHAPING=2]="RESHAPING"}(rt||(rt={})),function(h){h[h.ALL=0]="ALL",h[h.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(gn||(gn={}));let Ot=class extends fs.g{constructor(h){super(h),this._reshapeOperation=null,this.events=new Qt.A,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new Ti.A,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const h=this._reshapeOperation=new pt({tool:this});this.addHandles([h.events.on("reshape",a=>this.events.emit("reshape",a)),h.events.on("move",a=>this.events.emit("move",a)),h.events.on("vertex-add",a=>this.events.emit("vertex-add",a)),h.events.on("vertex-remove",a=>this.events.emit("vertex-remove",a)),h.events.on("immediate-click",a=>this.events.emit("immediate-click",{...a,object:this.object})),this.view.on("pointer-down",["Shift"],a=>a.stopPropagation())]),this.finishToolCreation()}destroy(){this._reshapeOperation=(0,Oe.pR)(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation?.onManipulatorSelectionChanged()}get canUndo(){return this._reshapeOperation?.canUndo??!1}undo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.undo()}get canRedo(){return this._reshapeOperation?.canRedo??!1}redo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.redo()}onInputEvent(h){const a=this._reshapeOperation;a&&!a.enterInputModeIfAvailable(h)&&this.enableDeleteVertices&&"key-down"===h.type&&nr.NE.delete.includes(h.key)&&a.removeSelectedVertices()>0&&h.stopPropagation()}reset(){}};(0,re._)([(0,ce.MZ)()],Ot.prototype,"_reshapeOperation",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"view",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],Ot.prototype,"object",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"enableZShape",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"enableZVertex",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"enableMoveObject",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"enableDeleteVertices",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"autoHideManipulators",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"enableMidpoints",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"enableEdgeOffset",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"type",void 0),(0,re._)([(0,ce.MZ)({type:Ti.A})],Ot.prototype,"sketchOptions",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"snappingManager",void 0),(0,re._)([(0,ce.MZ)()],Ot.prototype,"updating",null),(0,re._)([(0,ce.MZ)()],Ot.prototype,"activeTooltipInfo",null),(0,re._)([(0,ce.MZ)()],Ot.prototype,"tooltip",null),(0,re._)([(0,ce.MZ)()],Ot.prototype,"automaticManipulatorSelection",void 0),Ot=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],Ot);var lr=se(63842);let Yt=class extends pe.A{constructor(h){super(h),this._interactionState=null}initialize(){this.addHandles([(0,ge.z7)(()=>{const h=this._interactionState;return h&&h.angle!==h.previousAngle?{interactionState:h,angle:h.state.angle}:null},({interactionState:h})=>{this._updateMeshRotation(h)},ge.OH),(0,ge.z7)(()=>{const h=this._interactionState;return h&&h.scale!==h.previousScale?{interactionState:h,scale:h.state.scale}:null},({interactionState:h})=>{this._updateMeshSize(h)},ge.OH)])}get geometry(){const h=bt(this.object);return"mesh"===h?.type?h:null}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const h=this.geometry?.transform;if(null==h)return this._interactionState?.angle??0;const a=(0,lr.yo)(h.rotation)[2];return Math.abs(a)>.999999?(0,me.kU)((0,lr.g7)(h.rotation))*Math.sign(a):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const h=new _i({angle:this.angle});this._interactionState=h;const a=()=>{this._interactionState=null};return{state:h,done:a,cancel:()=>{h.cancel(),a()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(h){const{geometry:a}=this;if(null==a)return;const{angle:y,previousAngle:F}=h;h.previousAngle=y;const $=(0,me.KJ)(y-F);a.rotate(0,0,$)}_updateMeshSize(h){const{geometry:a}=this;if(null==a)return;const{scale:y,previousScale:F}=h;h.previousScale=y,a.scale(y/F)}};(0,re._)([(0,ce.MZ)({constructOnly:!0})],Yt.prototype,"object",void 0),(0,re._)([(0,ce.MZ)()],Yt.prototype,"geometry",null),(0,re._)([(0,ce.MZ)({constructOnly:!0})],Yt.prototype,"viewingMode",void 0),(0,re._)([(0,ce.MZ)()],Yt.prototype,"initialAngle",null),(0,re._)([(0,ce.MZ)()],Yt.prototype,"angle",null),(0,re._)([(0,ce.MZ)()],Yt.prototype,"angleClockwise",null),(0,re._)([(0,ce.MZ)()],Yt.prototype,"relativeAngle",null),(0,re._)([(0,ce.MZ)()],Yt.prototype,"relativeAngleClockwise",null),(0,re._)([(0,ce.MZ)()],Yt.prototype,"scale",null),(0,re._)([(0,ce.MZ)()],Yt.prototype,"_interactionState",void 0),Yt=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],Yt);let _i=class extends pe.A{get state(){const{angle:h,scale:a}=this;return{angle:h,scale:a}}constructor(h){super(h),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=h.angle,this.previousAngle=h.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,re._)([(0,ce.MZ)()],_i.prototype,"angle",void 0),(0,re._)([(0,ce.MZ)()],_i.prototype,"initialAngle",void 0),(0,re._)([(0,ce.MZ)()],_i.prototype,"previousAngle",void 0),(0,re._)([(0,ce.MZ)()],_i.prototype,"previousScale",void 0),(0,re._)([(0,ce.MZ)()],_i.prototype,"scale",void 0),(0,re._)([(0,ce.MZ)()],_i.prototype,"state",null),_i=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],_i);let St=class extends pe.A{constructor(h){super(h),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,ge.z7)(()=>null!=this._interactionState?this._interactionState.state:null,h=>{this._updateSymbol(h)},ge.OH))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?function nh(h){return-(0,me.kU)(h)}(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const h=this._sizeReferenceSymbolLayer;if(null==h)return null;const a=this.findLayerView(),y=this._graphicSymbol;if(null==a||null==y||"point-3d"!==y.type)return null;const F=a.getSymbolLayerSize(y,h);if("size"in F&&null!=F.size)return F.size;const $=this.sizeAxis;return!("width"in F)||null==F.width||null!=$&&"width"!==$&&"all"!==$&&"width-and-depth"!==$?!("depth"in F)||null==h.depth||null!=$&&"depth"!==$&&"all"!==$&&"width-and-depth"!==$?!("height"in F)||null==h.height||null!=$&&"height"!==$&&"all"!==$?null:F.height:F.depth:F.width}get _sizeReferenceSymbolLayer(){const h=this._graphicSymbol;return null==h||0===h.symbolLayers.length?null:h.symbolLayers.find(a=>"object"===a.type)}get _orientationReferenceSymbolLayer(){const h=this._graphicSymbol;return null==h||0===h.symbolLayers.length?null:h.symbolLayers.find(a=>"object"===a.type&&null!=a.heading)}get _graphicSymbol(){return null!=this.graphic?.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(h){this.graphic.symbol=h}startInteraction(){const h=this._graphicSymbol,a=this.findLayerView();if(null!=this._interactionState||null==h||null==a)return sh;const y=h.symbolLayers.map(ie=>"object"===ie.type?a.getSymbolLayerSize(h,ie):null).toArray(),F=h.clone(),ee=new fi({originalSymbol:F,angle:this.angle,initialSizes:y});this._interactionState=ee;const te=()=>{this._interactionState=null};return{state:ee,done:te,cancel:()=>{this._graphicSymbol=F,te()}}}createUndoRecord(){let h=this.graphic.symbol,a=null;return{undo:y=>{a=y.symbol,y.symbol=h},redo:y=>{h=y.symbol,y.symbol=a}}}_updateSymbol({scale:h,angle:a,originalSymbol:y,initialSizes:F}){const $=this._graphicSymbol;if(null==$||"point-3d"!==$.type)return;const ee=$.clone(),te=-(0,me.KJ)(a-this.initialAngle);let ie=!1;this._forEachObjectSymbolLayerPair(y,ee,(ne,ae,le)=>{const ue=(ne.heading??0)+te;ae.heading!==ue&&(ae.heading=ue,ie=!0);const _e=F[le];if(null!=_e&&"width"in _e){_e.width=this.sizeFilter(_e.width),_e.height=this.sizeFilter(_e.height),_e.depth=this.sizeFilter(_e.depth);const be=_e.width*h;ae.width!==be&&(ae.width=be,ie=!0);const we=_e.depth*h;ae.depth!==we&&(ae.depth=we,ie=!0);const Ae=_e.height*h;ae.height!==Ae&&(ae.height=Ae,ie=!0)}}),ie&&(this._graphicSymbol=ee)}_forEachObjectSymbolLayerPair(h,a,y){h.symbolLayers.forEach((F,$)=>{const ee=a.symbolLayers.at($);"object"===F.type&&"object"===ee.type&&y(F,ee,$)})}};(0,re._)([(0,ce.MZ)()],St.prototype,"initialAngle",null),(0,re._)([(0,ce.MZ)()],St.prototype,"angle",null),(0,re._)([(0,ce.MZ)()],St.prototype,"angleClockwise",null),(0,re._)([(0,ce.MZ)()],St.prototype,"orientation",null),(0,re._)([(0,ce.MZ)()],St.prototype,"orientationClockwise",null),(0,re._)([(0,ce.MZ)()],St.prototype,"relativeAngle",null),(0,re._)([(0,ce.MZ)()],St.prototype,"relativeAngleClockwise",null),(0,re._)([(0,ce.MZ)()],St.prototype,"scale",null),(0,re._)([(0,ce.MZ)()],St.prototype,"size",null),(0,re._)([(0,ce.MZ)()],St.prototype,"sizeAxis",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],St.prototype,"graphic",void 0),(0,re._)([(0,ce.MZ)()],St.prototype,"_interactionState",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],St.prototype,"findLayerView",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],St.prototype,"sizeFilter",void 0),(0,re._)([(0,ce.MZ)()],St.prototype,"_sizeReferenceSymbolLayer",null),(0,re._)([(0,ce.MZ)()],St.prototype,"_orientationReferenceSymbolLayer",null),(0,re._)([(0,ce.MZ)()],St.prototype,"_graphicSymbol",null),St=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],St);const sh={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let fi=class extends pe.A{get state(){const{originalSymbol:h,angle:a,initialAngle:y,scale:F,initialSizes:$}=this;return{originalSymbol:h,angle:a,initialAngle:y,scale:F,initialSizes:$}}constructor(h){super(h),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=h.angle}};(0,re._)([(0,ce.MZ)()],fi.prototype,"originalSymbol",void 0),(0,re._)([(0,ce.MZ)()],fi.prototype,"angle",void 0),(0,re._)([(0,ce.MZ)()],fi.prototype,"initialAngle",void 0),(0,re._)([(0,ce.MZ)()],fi.prototype,"initialSizes",void 0),(0,re._)([(0,ce.MZ)()],fi.prototype,"scale",void 0),(0,re._)([(0,ce.MZ)()],fi.prototype,"state",null),fi=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],fi);var Je,la=se(73596),ah=se(3804);!function(h){h.ScaleIn=Re.SJ.Custom2,h.ScaleOut=Re.SJ.Custom3,h.RotateLeft=Re.SJ.Custom4,h.RotateRight=Re.SJ.Custom5,h.Unlocked=Re.SJ.Custom7,h.DelayedFocused=Re.SJ.Custom8,h.TouchInput=Re.SJ.Custom12}(Je||(Je={}));let mi=class extends pe.A{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(h){this._ringManipulator.location=h}set elevationAlignedLocation(h){this._ringManipulator.elevationAlignedLocation=h}get grabbing(){return this._ringManipulator.grabbing}set interactive(h){this._ringManipulator.interactive=h}get updating(){return!!this._activeAnimation}constructor(h){super(h),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new Qt.A,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>"scale"===this._scaleRotateDragData?.mode?this.adapter.scale:1}initialize(){this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,ge.wB)(()=>{const{adapter:h}=this;return[h.angle,h.scale]},()=>this._updateManipulatorTransform())])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null}startAnimation(h){this.cancelActiveAnimation(),h.start();const a=(0,ah.mg)({update:({deltaTime:y})=>{h.update(y)&&this.cancelActiveAnimation()}});this._activeAnimation={...h,frameTask:a}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=(0,Oe.pR)(this._activeAnimation)}forEachManipulator(h){h(this._ringManipulator,at.SCALE_ROTATE)}_createManipulator(){const h=this._createRingManipulator();this._ringManipulator=h,this.tool.manipulators.add(h);const a=this.tool.object,y=(0,We.Xt)(h,(F,$,ee)=>{this._scaleRotateDragData=null;const te=this.adapter.startInteraction(),ie={mode:"none",origin:(0,de.o8)(F.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=ie,this._updateDragState();const ne=Ee.rq.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(F.renderLocation,ne),$.next(gs(this.tool.view,(0,ct.O_)(F.renderLocation,ne,(0,ct.vt)()))).next(ae=>{const le=(0,ct.Qj)(ae.plane),ue=Go(ae.renderStart,ae.renderEnd,ie.origin,le),_e=la.wf.shortestSignedDiff(ie.angle,ue);ie.angleDir=(0,me.qE)(ie.angleDir+_e,-.3,.3),ie.angle=ue;const be=function oh(h,a){const y=(0,oe.d)(Ee.rq.get(),a.renderStart,h.origin),F=(0,oe.d)(Ee.rq.get(),a.renderEnd,h.origin),$=(0,oe.l)(y),ee=(0,oe.l)(F);return 0===$?0:ee/$}(ie,ae);if(ie.scaleDir=(0,me.qE)(ie.scaleDir+(be-this.adapter.scale),-.2,.2),this._onScaleChanged(),"none"===ie.mode){const Ae=this.mode||function rh(h,a,y,F){const{renderStart:$,renderEnd:ee}=h,te=bs($,F,Ee.rq.get()),ie=bs(ee,F,Ee.rq.get());if((0,oe.s)(te,ie)<100)return null;const ne=(0,oe.d)(Ee.rq.get(),$,y),ae=(0,oe.e)(Ee.rq.get(),ne,(0,ct.Qj)(a)),le=$,ue=(0,oe.g)(Ee.rq.get(),le,ae),_e=bs(y,F,Ee.rq.get()),be=te,we=bs(ue,F,Ee.rq.get()),Ae=(0,oe.d)(Ee.rq.get(),we,be),Le=(0,oe.d)(Ee.rq.get(),te,_e),Ce=(0,Ft.LV)(be,Ae),Ne=(0,Ft.LV)(_e,Le);return(0,Ft.kb)(Ce,ie)<(0,Ft.kb)(Ne,ie)?"rotate":"scale"}(ae,ae.plane,ie.origin,this.tool.view.state.camera);if(null!=Ae){switch(Ae){case"rotate":this.tool.events.emit("rotate-start",{object:a,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:a,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}ie.mode=Ae}}switch(ie.mode){case"rotate":te.state.angle=ie.initialAngle+ue;break;case"scale":te.state.scale=be,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),ae.action){case"start":case"update":switch(ie.mode){case"rotate":this.tool.events.emit("rotate",{object:a,angle:(0,me.KJ)(ie.angle)});break;case"scale":this.tool.events.emit("scale",{object:a,xScale:be,yScale:be})}break;case"end":switch(ie.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:a,angle:(0,me.KJ)(ie.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:a,xScale:be,yScale:be})}}return"end"===ae.action&&(this.startAnimation(cr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),te.done()),ae}),ee.next(()=>{if(te.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:a,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:a,xScale:1,yScale:1})}this.startAnimation(cr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}})});this.addHandles([y,h.events.on("focus-changed",F=>{"focus"===F.action?this.startAnimation(function lh(h,a,y){let F=0,$=null;const ee=()=>!1;return{start:()=>{$=h.getFocused,h.getFocused=ee,F=0,a()},update:te=>(F+=te,!$?.()||F>=y.delayMs?_n.STOP:_n.CONTINUE),destroy:()=>{$&&(h.getFocused=$),a()}}}(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),h.events.on("immediate-click",F=>{F.stopPropagation()}),(0,ge.wB)(()=>this.tool.object.visible,F=>this._ringManipulator.available=F,ge.Vh)])}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Je.DelayedFocused,this.getFocused())}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Je.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==this._scaleRotateDragData?.mode)),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Je.ScaleIn|Je.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Je.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Je.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Je.RotateLeft|Je.RotateRight,!1),this._ringManipulator.updateStateEnabled(Je.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Je.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Je.ScaleIn|Je.ScaleOut|Je.RotateLeft|Je.RotateRight,!1)}_updateManipulatorTransform(){const h=(0,Ge.$0)(Ee.Rc.get(),this.adapter.angle,(0,de.fA)(0,0,1));if(null==h)return;const a=this.getScale(),y=(0,Ge.CV)(Ee.Rc.get(),(0,oe.i)(Ee.rq.get(),a,a,a));this._ringManipulator.modelTransform=(0,Ge.lw)(Ee.Rc.get(),y,h)}_createRingManipulator(){const h=(Ke,wt,Vt)=>{const Ui=[],Vi=Math.ceil(128*(wt-Ke)/(2*Math.PI));for(let jt=0;jt<Vi+1;jt++){const Nn=Ke+jt*(wt-Ke)/Vi;Ui.push((0,de.fA)(Vt*Math.cos(Nn),Vt*Math.sin(Nn),0))}return Ui},a=Ke=>h(0,2*Math.PI,Ke),F=this._createMaterial(1),$=(Ke,wt,Vt=F)=>(0,it.Nq)(Vt,(Ke=>[[-Ke/2,0],[Ke/2,0],[Ke/2,.25],[-Ke/2,.25]])(wt),Ke,[],[],!1),ee=a(160),te=$(ee,24),ie={left:new Array,right:new Array},ne=[];for(let Ke=0;Ke<2;Ke++){const wt=Ke*Math.PI-Math.PI/4,Vt=Math.PI/2-fc,Ui=wt+Vt,Vi=wt+Math.PI/2-Vt,jt=h(Ui,Vi,190),Nn=$(jt,9);ne.push(jt),ne.push(h(Ui,Vi,201)),ie.left.push(Nn),ie.right.push(Nn.instantiate());for(let ba=0;ba<2;ba++){const Tr=0===ba,$t=(0,Ct.vt)();if(Tr){(0,Ge.hs)($t,$t,[1,-1,1]),(0,Ge.e$)($t,$t,-Ui,[0,0,1]);const Ji=Math.round(.2*(jt.length-1));$t[12]=jt[Ji][0],$t[13]=jt[Ji][1],$t[14]=jt[Ji][2]}else{(0,Ge.e$)($t,$t,Vi,[0,0,1]);const Ji=Math.round(.8*(jt.length-1));$t[12]=jt[Ji][0],$t[13]=jt[Ji][1],$t[14]=jt[Ji][2]}const Pr=(0,it._B)(F,60,0,23,.5);(0,it.xh)(Pr,$t),(Tr?ie.left:ie.right).push(Pr)}}const ae=[];for(let Ke=0;Ke<2;Ke++){const wt=Ke*Math.PI-Math.PI/4,Vt=Math.PI/2-mc,Vi=wt+Math.PI/2-Vt,jt=h(wt+Vt,Vi,213);ae.push($(jt,9))}const le=this._createMaterial(.66),ue=this._createMaterial(.5),_e=this._createMaterial(.33),be=a(190),we=a(213),Ae=$(be,9,le),Le=$(we,9,_e),Ce=a(130),Ne=a(107),nt=$(Ce,9,le),ot=$(Ne,9,_e);let et=[new ze(te,Je.DelayedFocused),new ze(te.instantiate({material:ue}),Re.p7.None)];this.mode&&"scale"!==this.mode||(et=et.concat([...ae.map(Ke=>new ze(Ke,Je.DelayedFocused|Je.Unlocked)),new ze(Ae,Je.DelayedFocused|Je.ScaleIn),new ze(Le,Je.DelayedFocused|Je.ScaleIn),new ze(nt,Je.DelayedFocused|Je.ScaleOut),new ze(ot,Je.DelayedFocused|Je.ScaleOut)])),this.mode&&"rotate"!==this.mode||(et=et.concat([...ie.right.map(Ke=>new ze(Ke.instantiate(),Je.DelayedFocused|Je.Unlocked)),...ie.left.map(Ke=>new ze(Ke,Je.DelayedFocused|Je.RotateLeft)),...ie.right.map(Ke=>new ze(Ke,Je.DelayedFocused|Je.RotateRight))]));const Rt=[ee,...ne];return new Ut({view:this.tool.view,renderObjects:et,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:Rt,direction:(0,de.fA)(0,0,1)}})}_createMaterial(h){const a=new qt.v({cullFace:Qe.s2.Back,renderOccluded:Ve.m$.Transparent,isDecoration:!0});return this.addHandles((0,ge.wB)(()=>(0,De.f6)(this.tool.view.effectiveTheme.accentColor,h),y=>a.setParameters({color:y}),ge.Vh)),a}get test(){}};function bs(h,a,y){return a.projectToScreen(h,ca),(0,oe.i)(y,ca[0],ca[1],0)}var _n;function cr(h,a){let y=null,F=1;const $=()=>F;return{start:()=>{F=h.getScale(),y=h.getScale,h.getScale=$,a()},update:ee=>(F+=((F+1)/2-F)*Math.min(3*ee,1),a(),Math.abs(F-1)<.01?_n.STOP:_n.CONTINUE),destroy:()=>{y&&(h.getScale=y),a()}}}(0,re._)([(0,ce.MZ)({constructOnly:!0})],mi.prototype,"tool",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],mi.prototype,"adapter",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],mi.prototype,"sketchOptions",void 0),(0,re._)([(0,ce.MZ)()],mi.prototype,"mode",void 0),(0,re._)([(0,ce.MZ)()],mi.prototype,"_activeAnimation",void 0),(0,re._)([(0,ce.MZ)()],mi.prototype,"updating",null),mi=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],mi),function(h){h[h.CONTINUE=0]="CONTINUE",h[h.STOP=1]="STOP"}(_n||(_n={}));const ca=(0,xe.gs)();var hr=se(26530);let jn=class extends((0,hr.B)(In.w)){constructor(h){super(h),this.type="transform-mesh",this.orientation=(0,ki.LJ)(),this.scale=(0,ki.dy)(),this.allFields.forEach(a=>{a.lockable=!1,a.setActual(null)})}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,re._)([(0,ce.MZ)()],jn.prototype,"key",null),(0,re._)([(0,ce.MZ)()],jn.prototype,"allFields",null),jn=(0,re._)([(0,Ie.$)("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],jn);let Es=class extends((0,hr.B)(In.w)){constructor(h){super(h),this.type="transform-point",this.orientation=(0,ki.LJ)({readOnly:!0}),this.size=(0,ki.qP)({readOnly:!0}),this.allFields.forEach(a=>{a.lockable=!1,a.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.size]}};(0,re._)([(0,ce.MZ)()],Es.prototype,"allFields",null),Es=(0,re._)([(0,Ie.$)("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],Es);let Zt=class extends fs.g{constructor(h){super(h),this.events=new Qt.A,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new Ti.A,this.type="transform-3d",this._updatingHandles=new as.U,this._scaleRotate=null}initialize(){const{events:h,object:a,view:y}=this;this.tooltip=(0,It.A)(()=>({view:y,options:this.sketchOptions.tooltips})),this._moveManipulation=new Ki({tool:this,view:y,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Xi(a.operations,a.elevationInfo),radius:Ki.radiusForSymbol(a.graphic?.symbol)}),this._moveManipulation.forEachManipulator(ne=>this.addHandles(ne.events.on("immediate-click",ae=>{h.emit("immediate-click",{...ae,object:this.object}),ae.stopPropagation()})));const F=a.elevationInfo;this._moveManipulation.elevationInfo=F,this.addHandles(zs(a)),this._moveManipulation.createManipulatedObjectDragPipeline((ne,ae,le,ue,_e)=>{if(ne===ht.XY){const{snappingStep:be,cancelSnapping:we}=(0,vs.L)({snappingContext:new ms.e({elevationInfo:F,pointer:_e,editGeometryOperations:qs.p.fromGeometry(new pi.A({spatialReference:a.operations?.data.spatialReference}),y.state.viewingMode),visualizer:new xn,excludeFeature:a.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});ue=ue.next(we),le=le.next((0,We.RS)(this.view,F)).next(...be)}return{steps:le,cancel:ue}},a,ne=>{const{action:ae,object:le,dxScreen:ue,dyScreen:_e}=ne,be={object:le,dxScreen:ue,dyScreen:_e};switch(ae){case"start":this._emitRecordUndo(),h.emit("translate-start",be);break;case"update":h.emit("translate",be);break;case"end":h.emit("translate-stop",be)}}),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,ge.wB)(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),(this.enableScaling||this.enableRotation)&&(this._scaleRotate=new mi({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate",adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))),this.addHandles([us({view:this.view,object:a,forEachManipulator:ne=>this._forEachManipulator(ne),onManipulatorsChanged:()=>(0,Se.hA)()}),a.on("committed",()=>this._onGeometryChanged()),this._hideManipulatorsForObjectState(),(0,ge.wB)(()=>y.scale,()=>this._updateMoveAngle())].filter(Zs.Ru)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(ne=>{ne instanceof Ut&&this.addHandles(ne.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))});const $=y?.type,{sketchOptions:ee}=this;this._meshTooltipInfo=new jn({viewType:$,sketchOptions:ee}),this._pointTooltipInfo=new Es({viewType:$,sketchOptions:ee});const te={object:a,dxScreen:0,dyScreen:0},ie={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),h.emit("translate-start",{...te})},onMove:()=>h.emit("translate",{...te}),onMoveStop:()=>h.emit("translate-stop",{...te}),onRotateStart:ne=>{this._emitRecordUndo(),h.emit("rotate-start",{object:a,angle:ne})},onRotate:ne=>h.emit("rotate",{object:a,angle:ne}),onRotateStop:ne=>h.emit("rotate-stop",{object:a,angle:ne}),onScaleStart:(ne,ae)=>{this._emitRecordUndo(),h.emit("scale-start",{object:a,xScale:ne,yScale:ae})},onScale:(ne,ae)=>h.emit("scale",{object:a,xScale:ne,yScale:ae}),onScaleStop:(ne,ae)=>h.emit("scale-stop",{object:a,xScale:ne,yScale:ae})};this.addHandles(lo(this.tooltip,this.object,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:ie,scaleRotateTransform:this._scaleRotate}))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=(0,Oe.pR)(this._scaleRotate),this._scaleRotateAdapter=(0,Oe.pR)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(h){if(!this.destroyed&&!(0,It.wG)(h,this.tooltip))return super.onInputEvent(h)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return"mesh"===bt(this.object)?.type?new Yt({object:this.object,viewingMode:this.view.state.viewingMode}):new St({graphic:this.object.graphic,sizeFilter:a=>this._enforceNonZeroSize(a),findLayerView:()=>this.view.allLayerViews.find(a=>a.layer===this.object.graphic?.layer),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(h){this._moveManipulation?.forEachManipulator(h),this._scaleRotate?.forEachManipulator(h)}_hideManipulatorsForObjectState(){return(0,ge.wB)(()=>this.object.visible,h=>{this._forEachManipulator(a=>a.available=h),this._moveManipulation.zManipulation.available=h&&this.enableZ&&Xi(this.object.operations,this.object.elevationInfo)})}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(h){this._moveManipulation&&(this._moveManipulation.snapToScene=h),this._set("snapToScene",h)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return"mesh"===bt(this.object)?.type?this._meshTooltipInfo:this._pointTooltipInfo}set location(h){this._moveManipulation.location=h,this._scaleRotate&&(this._scaleRotate.location=h)}set elevationAlignedLocation(h){this._moveManipulation.elevationAlignedLocation=h,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=h)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){const{view:h}=this;this._moveManipulation.angle=h.state.viewingMode===yn.RT.Local||h.scale<1e6?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){Zo(this,this.object)}_enforceNonZeroSize(h){return h||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};(0,re._)([(0,ce.MZ)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"view",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"object",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"enableZ",void 0),(0,re._)([(0,ce.MZ)()],Zt.prototype,"enableRotation",void 0),(0,re._)([(0,ce.MZ)()],Zt.prototype,"enableScaling",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0,type:Ti.A})],Zt.prototype,"sketchOptions",void 0),(0,re._)([(0,ce.MZ)({value:!1})],Zt.prototype,"snapToScene",null),(0,re._)([(0,ce.MZ)({constructOnly:!0})],Zt.prototype,"snappingManager",void 0),(0,re._)([(0,ce.MZ)({readOnly:!0})],Zt.prototype,"type",void 0),(0,re._)([(0,ce.MZ)({readOnly:!0})],Zt.prototype,"updating",null),(0,re._)([(0,ce.MZ)()],Zt.prototype,"activeTooltipInfo",null),Zt=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],Zt);var ch=se(90660),hh=se(71065),dr=se(48669),ur=se(55739),Un=se(25968);let Ri=class extends(ch.A.ClonableMixin(hh.A)){constructor(h){super(h),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(h){return this.heading===h.heading&&this.tilt===h.tilt&&(0,Oe.CM)(this.position,h.position)&&this.width===h.width&&this.height===h.height}};(0,re._)([(0,ce.MZ)({readOnly:!0,json:{read:!1,write:!0}})],Ri.prototype,"type",void 0),(0,re._)([(0,ce.MZ)({type:pi.A}),(0,Un.P)()],Ri.prototype,"position",void 0),(0,re._)([(0,ce.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Un.P)(),(0,dr.w)(h=>la.ie.normalize((0,ur.GB)(h),0,!0))],Ri.prototype,"heading",void 0),(0,re._)([(0,ce.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Un.P)(),(0,dr.w)(h=>la.ie.normalize((0,ur.GB)(h),0,!0))],Ri.prototype,"tilt",void 0),(0,re._)([(0,ce.MZ)({type:Number,nonNullable:!0}),(0,Un.P)()],Ri.prototype,"width",void 0),(0,re._)([(0,ce.MZ)({type:Number,nonNullable:!0}),(0,Un.P)()],Ri.prototype,"height",void 0),Ri=(0,re._)([(0,Ie.$)("esri.analysis.SlicePlane")],Ri),se(28067),se(41510);var hi=se(33096);(0,Mt.fA)(0,0,0,.04),(0,Be.A)("mac");const uh=1.15,ph=1.15,gh=(Math.cos((0,me.kU)(45)),Math.cos((0,me.kU)(5)),3),pr=11,ha=22.5,vh=.3;(0,Ct.vt)(),new yt.K;var vi,fr=se(61427),mr=se(6771),vr=se(53670);function Mr(h){const a=(0,oe.l)(h.basis1),y=(0,oe.l)(h.basis2);return vh*Math.min(a,y)}function Vn(h){return Mr(h)}function zn(h){return 0!==h.direction[0]&&0!==h.direction[1]}se(53868),se(10132),function(h){h[h.POSITIVE_X=0]="POSITIVE_X",h[h.POSITIVE_Y=1]="POSITIVE_Y",h[h.NEGATIVE_X=2]="NEGATIVE_X",h[h.NEGATIVE_Y=3]="NEGATIVE_Y"}(vi||(vi={}));const Ci=Re.SJ.Custom1;var Hn,Ii;(function(h){h[h.HEADING=1]="HEADING",h[h.TILT=2]="TILT"})(Hn||(Hn={})),function(h){h[h.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",h[h.HORIZONTAL=1]="HORIZONTAL",h[h.VERTICAL=2]="VERTICAL",h[h.TILTED=3]="TILTED"}(Ii||(Ii={}));const Gn=Re.SJ.Custom2,fn=((0,Ft.vt)(),Math.PI/2),Ss=Re.SJ.Custom1,br=Re.SJ.Custom2;var xs,Er=se(19890);!function(h){h[h.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",h[h.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(xs||(xs={}));class Vh extends Ut{constructor(a,y){const F=new Gt.W({width:1,renderOccluded:Ve.m$.OccludeAndTransparent,isDecoration:!0}),$=new qt.v({cullFace:Qe.s2.Back,renderOccluded:Ve.m$.Opaque,isDecoration:!0}),ee=new qt.v({cullFace:Qe.s2.Back,renderOccluded:Ve.m$.Opaque,isDecoration:!0}),te=new qt.v({cullFace:Qe.s2.Back,renderOccluded:Ve.m$.Opaque,isDecoration:!0}),ie=new qt.v({writeDepth:!1,cullFace:Qe.s2.Front,renderOccluded:Ve.m$.Transparent,isDecoration:!0});super({view:a,...zh({offsetMode:y,tubeMaterial:$,tipMaterial:ee,capMaterial:te,outlineMaterial:ie,calloutMaterial:F})}),this._themeHandle=(0,ge.wB)(()=>a.effectiveTheme.accentColor,ne=>{const ae=(0,De.bJ)(ne),le=ye.A.toUnitRGBA(ne),ue=ye.A.toUnitRGBA(ae),_e=ye.A.toUnitRGBA(ye.A.blendColors(ae,ne,.4)),be=ye.A.toUnitRGBA(ye.A.blendColors(ae,ne,.14));F.setParameters({color:le}),$.setParameters({color:be}),ee.setParameters({color:ue}),te.setParameters({color:_e}),ie.setParameters({color:le})},ge.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function zh({offsetMode:h,tubeMaterial:a,tipMaterial:y,capMaterial:F,outlineMaterial:$,calloutMaterial:ee}){const te=h===xs.CENTER_ON_CALLOUT?40:0,ie=[(0,de.fA)(te,0,-24),(0,de.fA)(te,0,24)],ne=function Gh(h,a){const y=(0,oe.d)((0,de.vt)(),h[h.length-1],h[h.length-2]);(0,oe.n)(y,y),(0,oe.h)(y,y,ha),(0,oe.g)(y,y,h[h.length-1]);{const F=(0,oe.d)((0,de.vt)(),h[0],h[1]);return(0,oe.n)(F,F),(0,oe.h)(F,F,ha),(0,oe.g)(F,F,h[0]),[F,...h,y]}}(ie),ae=Or({vertices:ie,padding:0,materials:{tube:a,tip:y,cap:F}}),le=Or({vertices:ie,padding:2.25,materials:{tube:$,tip:$,cap:$}}),ue=(0,it.Z8)(ee,[[te,0,0],[te-40,0,0]]),_e=(0,it.Z8)(ee,[[te,0,0],[te-40,0,0]]);return{renderObjects:[...ae.normal.map(be=>new ze(be,Re.p7.Unfocused|Ci)),...le.normal.map(be=>new ze(be,Re.p7.Unfocused|Ci)),new ze(ue,Re.p7.Unfocused|Ci|Gn),...ae.focused.map(be=>new ze(be,Re.p7.Focused|Ci)),...le.focused.map(be=>new ze(be,Re.p7.Focused|Ci)),new ze(_e,Re.p7.Focused|Ci|Gn)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[ne]},collisionPriority:1,radius:pr,state:Ci}}function Or({vertices:h,padding:a,materials:y}){const F=$=>{const ee=h.slice(),te=(0,oe.d)(Ee.rq.get(),ee[0],ee[1]);(0,oe.n)(te,te);const ie=(0,oe.d)(Ee.rq.get(),ee[ee.length-1],ee[ee.length-2]);if((0,oe.n)(ie,ie),a>0){const Ke=(0,oe.h)((0,de.vt)(),ie,-a);ee[ee.length-1]=(0,oe.g)(Ke,Ke,ee[ee.length-1]);const wt=(0,oe.h)((0,de.vt)(),te,-a);ee[0]=(0,oe.g)(wt,wt,ee[0])}const ne=$?ph:1,ae=ha*ne,le=pr*ne,ue=(0,Ge.D_)(Ee.Rc.get());if(a>0){const Ke=ae/4,wt=(0,oe.i)(Ee.rq.get(),0,Ke,0),Vt=1+a/Ke;(0,Ge.Tl)(ue,ue,wt),(0,Ge.hs)(ue,ue,(0,oe.i)(Ee.rq.get(),Vt,Vt,Vt)),(0,Ge.Tl)(ue,ue,(0,oe.h)(wt,wt,-1/Vt))}const _e=(0,Ge.D_)((0,Ct.vt)()),be=(0,de.fA)(0,1,0),we=(0,Ge.I0)((0,Ct.vt)(),(0,Er.Yc)(Ee.J8.get(),be,ie));we[12]=ee[ee.length-1][0],we[13]=ee[ee.length-1][1],we[14]=ee[ee.length-1][2],(0,Ge.lw)(we,we,ue);const Le=function Hh(h,a,y){const F=[];for(let ee=0;ee<12;ee++){const te=ee/12*2*Math.PI;F.push([Math.cos(te)*h,Math.sin(te)*h])}return(0,it.Nq)(y,F,a,[],[],!1)}(gh*($?uh:1)+a,ee,y.tube);Le.transformation=_e;const Ce=[Le],nt=(0,it.EE)(y.tip,ae,le,24,!1,!1,!0);nt.transformation=we,Ce.push(nt);const et=(0,it.EE)(y.cap,ae,le,24,!1,!0,!1);et.transformation=we,Ce.push(et);const Rt=(0,Ge.I0)((0,Ct.vt)(),(0,Er.Yc)(Ee.J8.get(),be,te));return Rt[12]=ee[0][0],Rt[13]=ee[0][1],Rt[14]=ee[0][2],(0,Ge.lw)(Rt,Rt,ue),Ce.push(nt.instantiate({transformation:Rt})),Ce.push(et.instantiate({transformation:Rt})),Ce};return{normal:F(!1),focused:F(!0)}}class Nh{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(a,y){this._tool=a,this._bounds=y,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const F=this._tool,$=F.view;this.moveXYObjectManipulation=new Js({view:$,tool:F,object:this._object}),F.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new Vh($,xs.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Gn,F.manipulators.add(this.moveZManipulator),F.addHandles(this._createMoveZDragPipeline()),F.addHandles(F.events.on("translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(a){this.moveXYObjectManipulation.forEachManipulator(a),a(this.moveZManipulator,at.TRANSLATE_Z)}updateManipulators(a,y){const F=this.moveZManipulator,$=(0,Ge.Qr)(Ee.Rc.get(),a,Math.PI);$[12]=0,$[13]=0,$[14]=0,F.modelTransform=$,F.renderLocation=(0,oe.d)(Ee.rq.get(),y.origin,y.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const a=this._tool,y=this._moveXYTooltipInfo??=new ea.M({sketchOptions:a.sketchOptions});if(this.moveXYObjectManipulation.dragging){const F=this._bounds,$=F.mapBoundsStart.origin,ee=F.mapBounds.origin,{renderSpatialReference:te}=a.view;if(!te)return null;const ie=(0,Ze.Do)($,ee,te);if(null==ie)return null;y.distance=ie}else y.distance=Pt.r7;return y}_computeMoveZTooltipInfo(){const a=this._tool,y=this._moveZTooltipInfo??=new Qi({sketchOptions:a.sketchOptions});if(this.moveZManipulator.dragging){const F=this._bounds,$=F.mapBoundsStart.origin,ee=F.mapBounds.origin,{renderSpatialReference:te}=a.view;if(!te)return null;const ie=(0,os.cL)($,ee,te);if(null==ie)return null;y.distance=ie}else y.distance=Pt.r7;return y}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline((a,y,F)=>this._buildMoveDragPipeline(y,F))}_createMoveZDragPipeline(){if(!this._operations)return(0,Se.hA)();const a=this._operations.data.spatialReference;return(0,We.Xt)(this.moveZManipulator,(y,F,$)=>{const ee=(0,de.o8)(y.renderLocation),te=F.next(Lo(this._tool.view,ee,a)).next((0,We.sO)());this._buildMoveDragPipeline(te,$)})}_buildMoveDragPipeline(a,y){const{_tool:F,_object:$}=this;a.next(ee=>("start"===ee.action&&(F.inputState={type:"move"},this._bounds.backupMapBounds(),F.events.emit("translate-start",{object:$,dxScreen:ee.screenDeltaX,dyScreen:ee.screenDeltaY})),ee)).next((0,We.EX)()).next(this._updateGeometry()).next(ee=>{const te={object:$,dxScreen:ee.screenDeltaX,dyScreen:ee.screenDeltaY};switch(ee.action){case"start":case"update":(ee.mapEnd.x-ee.mapStart.x||ee.mapEnd.y-ee.mapStart.y||(ee.mapEnd.z??0)-(ee.mapStart.z??0))&&F.events.emit("translate",te);break;case"end":F.inputState=null,F.events.emit("translate-stop",te)}return ee}),y.next(()=>{null!=F.inputState&&F.events.emit("translate-stop",{object:$,dxScreen:0,dyScreen:0}),F.cancel()})}_updateGeometry(){const a=this._tool;return y=>{if(null==a.inputState||"move"!==a.inputState.type)return y;if(this._operations){const $=this._operations.move(y.mapDeltaX,y.mapDeltaY,y.mapDeltaZ,"start"===y.action?ti.Y.NEW_STEP:ti.Y.ACCUMULATE_STEPS);this._bounds.updateMapBoundsFromOperation($)}return y}}}var Kh=se(20706),kh=se(19589),fa=se(54501),Jh=se(44827);class qh extends nn.w{constructor(a,y){super(a,y,new tn.$(Jh.I,()=>se.e(9029).then(se.bind(se,9029))),Sr)}_getPipelineState(a,y){const{oitPass:F,output:$,hasOccludees:ee,enableOffset:te,cullFace:ie}=a,ne=F===ss.Y.NONE,ae=F===ss.Y.FrontFace;return(0,Tt.Ey)({blending:(0,Wt.RN)($)?ne?Tt.Os:(0,ri.ez)(F):null,culling:(0,Tt.Xt)(ie),depthTest:{func:(0,ri.K_)(F)},depthWrite:(0,ri.z5)(a),drawBuffers:(0,ri.m6)(F,$),colorWrite:Tt.kn,stencilWrite:ee?fa.v0:null,stencilTest:ee?y?fa.a9:fa.qh:null,polygonOffset:ne||ae?null:(0,ri.aB)(te)})}initializePipeline(a){return this._occludeePipeline=this._getPipelineState(a,!0),this._getPipelineState(a,!1)}getPipeline(a){return a?this._occludeePipeline:super.getPipeline()}}const Sr=new Map([[Fe.r.POSITION,0],[Fe.r.UV0,2],[Fe.r.PERSPECTIVEDIVIDE,3]]);class Li extends to.E{constructor(){super(...arguments),this.cullFace=Qe.s2.None,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=qa.I.None,this.emissionSource=eo.ZX.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,re._)([(0,yt.W)({count:Qe.s2.COUNT})],Li.prototype,"cullFace",void 0),(0,re._)([(0,yt.W)()],Li.prototype,"enableOffset",void 0),(0,re._)([(0,yt.W)()],Li.prototype,"writeDepth",void 0),(0,re._)([(0,yt.W)()],Li.prototype,"hasOccludees",void 0),(0,re._)([(0,yt.W)()],Li.prototype,"terrainDepthTest",void 0),(0,re._)([(0,yt.W)()],Li.prototype,"cullAboveTerrain",void 0),(0,re._)([(0,yt.W)()],Li.prototype,"perspectiveInterpolation",void 0);class ed extends vr.W{constructor(a){super(a,nd),this._configuration=new Li,this.vertexAttributeLocations=Sr,this.supportsEdges=!0,this.produces=new Map([[wi.N.OPAQUE_MATERIAL,y=>(0,Wt.CL)(y)],[wi.N.TRANSPARENT_MATERIAL,y=>(0,Wt._o)(y)&&this.parameters.writeDepth],[wi.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,y=>(0,Wt._o)(y)&&!this.parameters.writeDepth],[wi.N.DRAPED_MATERIAL,y=>(0,Wt._o)(y)||(0,Wt.CL)(y)]])}getConfiguration(a,y){return this._configuration.output=a,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=y.hasOccludees,this._configuration.oitPass=y.oitPass,this._configuration.enableOffset=y.camera.relativeElevation<ri.xt,this._configuration.terrainDepthTest=y.terrainDepthTest,this._configuration.cullAboveTerrain=y.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(a){return new td(a)}createBufferWriter(){const a=mr.zK.clone();return this.parameters.perspectiveInterpolation&&a.f32(Fe.r.PERSPECTIVEDIVIDE),new id(a)}}class td extends kh.m8{constructor(a){super({...a,...a.material.parameters})}beginSlot(a){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(qh,a)}}class id extends fr.Z{write(a,y,F,$,ee,te){for(const ie of this.vertexBufferLayout.fields.keys()){const ne=F.get(ie);if(ne)if(ie===Fe.r.PERSPECTIVEDIVIDE){(0,ka.vA)(1===ne.size);const ae=ee.getField(ie,$a.Y$);ae&&(0,ns.uO)(ne,ae,te)}else(0,ns.zC)(ie,ne,a,y,ee,te)}}}class nd extends Ve.qA{constructor(a){super(),this.textureId=a,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Qe.s2.None,this.opacity=1,this.perspectiveInterpolation=!1}}class sd extends Ut{constructor(a,y){const F=new ed({writeDepth:!1,renderOccluded:Ve.m$.Opaque,isDecoration:!0}),ee=new Gt.W({width:Ho.calloutWidth,renderOccluded:Ve.m$.OccludeAndTransparent,isDecoration:!0});super({view:a,...ad({imageMaterial:F,calloutMaterial:ee})}),this._currentTexture=null,this._themeHandle=(0,ge.wB)(()=>a.effectiveTheme.accentColor,te=>{const ie=(0,De._L)(te,.5),ne=(0,De.bJ)(te),ae=this._currentTexture,le=y(ie,ne);F.setParameters({textureId:le.texture.id}),ee.setParameters({color:ye.A.toUnitRGBA(te)}),this._currentTexture=le,ae?.release()},ge.Vh)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function ad({imageMaterial:h,calloutMaterial:a}){const{focusMultiplier:y,calloutLength:F,discRadius:$}=Ho,ee=$*y,te=(le,ue)=>{const _e=[0,1,2,2,3,0];return new Fa.V(ue,[[Fe.r.POSITION,new js.n([F-le,-le,0,F+le,-le,0,F+le,le,0,F-le,le,0],_e,3,!0)],[Fe.r.UV0,new js.n([0,0,1,0,1,1,0,1],_e,2,!0)]])},ie=(0,it.Z8)(a,[[0,0,0],[F-$,0,0]]),ne=(0,it.Z8)(a,[[0,0,0],[F-ee,0,0]]),ae=Ci;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[F,0,0]},focusMultiplier:y,radius:$,renderObjects:[new ze(te($,h),Re.p7.Unfocused|ae),new ze(ie,Re.p7.Unfocused|ae),new ze(te(ee,h),Re.p7.Focused|ae),new ze(ne,Re.p7.Focused|ae)],state:ae}}var xr=se(39116),od=se(41740);class rd{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(a,y,F){this._tool=a,this._bounds=y,this._snapRotation=F,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const $=this._tool,ee=$.view,te=!ee._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new sd(ee,(ie,ne)=>function Qh(h,a){const{accentColor:y,contrastColor:F,preMultiplyAlpha:$}=a;return h.fromData(`heading-rotate:[accent:${y},contrast:${F},size:64]`,()=>new Kh.g(function Fh(h,a){return function Yh(h,a){const y=new Image(a,a);return y.src=h,y}(function Xh(h){const a=(new XMLSerializer).serializeToString(h);return`data:image/svg+xml;base64,${btoa(a)}`}(function Bh(h,{accentColor:a,contrastColor:y}){const F=a.toHex(),$=a.a,ee=y.toHex(),te=y.a,ie=h.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem("theme-style");return ie&&(ie.innerHTML=`\n      .contrast-fill { fill: ${ee}; fill-opacity: ${te}; }\n      .contrast-stroke { stroke: ${ee}; stroke-opacity: ${te};  }\n      .accent-fill { fill: ${F}; fill-opacity: ${$}; }\n      .accent-stroke { stroke: ${F}; stroke-opacity:  ${$}; }`),h}(function Wh(h){const a=h.split(",")[1],y=atob(a);return(new DOMParser).parseFromString(y,"image/svg+xml")}(h),a)),a.size)}("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",{accentColor:y,contrastColor:F,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:$}))}(ee.textures,{accentColor:ie,contrastColor:ne,preMultiplyAlpha:te})),$.addHandles([this.rotateManipulator.events.on("grab-changed",ie=>this._onGrabChanged(ie)),this._createRotateDragPipeline(this.rotateManipulator)]),$.manipulators.add(this.rotateManipulator),$.addHandles([$.events.on("rotate-start",ie=>this._startAngle=ie.angle),$.events.on("rotate",ie=>this._endAngle=ie.angle),$.events.on("rotate-stop",()=>{this._startAngle=0,this._endAngle=0})])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(a){a(this.rotateManipulator,at.ROTATE)}updateManipulators(a,y){const F=this._bounds.mapBounds.plane[2]<0?Math.PI:0,$=(0,Ge.eL)(Ee.Rc.get(),a,F);$[12]=0,$[13]=0,$[14]=0,this.rotateManipulator.modelTransform=$,this.rotateManipulator.renderLocation=(0,oe.g)(Ee.rq.get(),y.origin,y.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const a=this._rotateTooltipInfo??=new od.d({sketchOptions:this._tool.sketchOptions});return a.angle=this._startAngle-this._endAngle,a}_onGrabChanged({action:a,screenPoint:y}){const F=this._tool,$=this._bounds;if("start"!==a||!y)return;const ee=function Rh(h,a,y,F){const $=a.worldUpAtPosition(h.origin,Ee.rq.get()),ee=Ee.rq.get();switch(y){case Hn.HEADING:(0,oe.c)(ee,$);break;case Hn.TILT:(0,oe.c)(ee,h.basis1)}return(0,ct.O_)(h.origin,ee,F)}($.displayBounds,F.view.renderCoordsHelper,Hn.HEADING,(0,ct.vt)()),te=_o(F.view.state.camera,y);(0,ct.Ui)(ee,te,Ee.rq.get())&&($.backupMapBounds(),F.inputState={type:"rotate",rotatePlane:ee})}_createRotateDragPipeline(a){const{_tool:y,_object:F}=this;return(0,We.Xt)(a,($,ee,te)=>{const ie=y.inputState;null!=ie&&(ee.next(ne=>("start"===ne.action&&y.events.emit("rotate-start",{object:F,angle:0}),ne)).next(gs(y.view,ie.rotatePlane)).next(this._renderPlaneToAngle()).next(...this._snapRotation()).next(this._updateGeometry()).next(ne=>{const ae={object:F,angle:(0,me.KJ)(ne.rotateAngle)};switch(ne.action){case"start":case"update":y.events.emit("rotate",ae);break;case"end":y.inputState=null,y.events.emit("rotate-stop",ae)}return ne}),te.next(()=>{null!=y.inputState&&y.events.emit("rotate-stop",{object:F,angle:0}),y.cancel()}))})}_renderPlaneToAngle(){return a=>{const y=Go(a.renderStart,a.renderEnd,this._bounds.displayBounds.origin,(0,ct.Qj)(a.plane));return{...a,rotateAngle:y}}}_updateGeometry(){const a=this._bounds;return y=>{const F=(0,oe.c)((0,de.vt)(),a.mapBoundsStart.origin);if(this._operations){const ee=this._operations.rotate(F,y.rotateAngle,"start"===y.action?ti.Y.NEW_STEP:ti.Y.ACCUMULATE_STEPS,xr.K.REPLACE);(0,hi.a)(a.mapBoundsStart,a.mapBounds),a.updateMapBoundsFromOperation(ee)}return y}}}class ld extends Ut{constructor(a,y){const F=zn(y),$=F?4:1,ee=2*$,ie={renderOccluded:Ve.m$.OccludeAndTransparent,isDecoration:!0},ne=new Gt.W({...ie,width:$}),ae=new Gt.W({...ie,width:ee}),le=new Gt.W({...ie,width:1});super({view:a,...jc,...cd({isCorner:F,unfocusedMaterial:ne,focusedMaterial:ae,outlineMaterial:le})}),this._themeHandle=(0,ge.wB)(()=>a.effectiveTheme.accentColor,ue=>{const _e=ye.A.toUnitRGBA(ue);ne.setParameters({color:_e}),ae.setParameters({color:_e}),le.setParameters({color:_e})},ge.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function cd({isCorner:h,unfocusedMaterial:a,focusedMaterial:y,outlineMaterial:F}){const $=h?[(0,de.fA)(1,0,0),(0,de.fA)(0,0,0),(0,de.fA)(0,1,0)]:[(0,de.fA)(1,0,0),(0,de.fA)(-1,0,0)];return{renderObjects:[new ze((0,it.Z8)(a,$),Re.p7.Unfocused|Ss),new ze((0,it.Z8)(y,$),Re.p7.Focused|Ss),new ze((0,it.Z8)(F,$),br)],collisionType:{type:"line",paths:[$]},radius:h?6:4,state:Ss}}var ma=se(53950),hd=se(70830);class dd{constructor(a,y){this._tool=a,this.mapBounds=(0,hi.d)(),this.mapBoundsStart=(0,hi.d)(),this.displayBounds=(0,hi.d)(),a.addHandles((0,ge.on)(()=>a.object,"modified-externally",()=>this._resetMapBounds(),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=y}get displayBoundsMargin(){const{view:a,object:y}=this._tool,F=bt(y),$=a.pointsOfInterest?.centerOnSurfaceFrequent.location??F?.extent?.center;return $?ud*a.pixelSizeAt($):0}backupMapBounds(){(0,hi.a)(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(a){(0,ma.Bb)(a,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(a){(0,ma.fJ)(a,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){const{view:a,attachmentOrigin:y,object:F}=this._tool,$=F.operations?.data;if(!$)return;const ee=$.geometry;this.spatialReference=ee.spatialReference;const te=function jl(h){const a=Fs(h);return(0,gt.fA)(Math.cos(a),Math.sin(a))}(ee);(0,Xe.hs)(te,te,-1);const ie=y?a.pixelSizeAt(y,ee.spatialReference):0,ne=pd*ie,ae=$.coordinateHelper.hasZ()&&"on-the-ground"!==F.elevationInfo.mode;(0,ma.G3)(te,$,ne,this.mapBounds,ae)}_calculateDisplayBounds(){const{view:a,attachmentOrigin:y}=this._tool,F=y?.z??(0,Sn.nG)(this.mapBounds.origin,a.elevationProvider,an.F.fromElevationInfo(this._tool.object.elevationInfo),a.renderCoordsHelper);!function gd(h,a,y,F,$=0,ee){ee||(ee=(0,hi.d)());const te=Ee.rq.get();(0,oe.g)(te,h.origin,h.basis1),(0,oe.g)(te,te,h.basis2),y.toRenderCoords(te,F,te);const ie=Ee.rq.get();(0,oe.g)(ie,h.origin,h.basis1),(0,oe.d)(ie,ie,h.basis2),y.toRenderCoords(ie,F,ie);const ne=Ee.rq.get();(0,oe.d)(ne,h.origin,h.basis1),(0,oe.d)(ne,ne,h.basis2),y.toRenderCoords(ne,F,ne);const ae=Ee.rq.get();(0,oe.d)(ae,h.origin,h.basis1),(0,oe.g)(ae,ae,h.basis2),y.toRenderCoords(ae,F,ae),(0,oe.g)(ee.origin,te,ie),(0,oe.g)(ee.origin,ee.origin,ne),(0,oe.g)(ee.origin,ee.origin,ae),(0,oe.h)(ee.origin,ee.origin,.25),(0,oe.d)(te,te,ee.origin),(0,oe.d)(ie,ie,ee.origin),(0,oe.d)(ne,ne,ee.origin),(0,oe.d)(ae,ae,ee.origin);const le=(0,oe.m)(Ee.rq.get(),te,ie,.5),ue=(0,oe.m)(Ee.rq.get(),ne,ae,.5);(0,oe.h)(ue,ue,-1),(0,oe.m)(ee.basis1,le,ue,.5);const _e=(0,oe.m)(Ee.rq.get(),te,ae,.5),be=(0,oe.m)(Ee.rq.get(),ie,ne,.5);(0,oe.h)(be,be,-1),(0,oe.m)(ee.basis2,_e,be,.5);const we=(0,oe.e)(Ee.rq.get(),ee.basis1,ee.basis2);(0,oe.e)(ee.basis2,we,ee.basis1),(0,oe.n)(ee.basis1,ee.basis1);const Ae=Math.max(Math.abs((0,oe.f)(ee.basis1,te)),Math.abs((0,oe.f)(ee.basis1,ie)),Math.abs((0,oe.f)(ee.basis1,ne)),Math.abs((0,oe.f)(ee.basis1,ae)));(0,oe.n)(ee.basis2,ee.basis2);const Le=Math.max(Math.abs((0,oe.f)(ee.basis2,te)),Math.abs((0,oe.f)(ee.basis2,ie)),Math.abs((0,oe.f)(ee.basis2,ne)),Math.abs((0,oe.f)(ee.basis2,ae)));(0,oe.h)(ee.basis1,ee.basis1,Ae+$),(0,oe.h)(ee.basis2,ee.basis2,Le+$);const Ce=(0,oe.c)(Ee.rq.get(),h.origin);Ce[2]=a,y.toRenderCoords(Ce,F,Ce),(0,ct.O_)(Ce,we,ee.plane),(0,ct._I)(ee.plane,ee.origin,ee.origin),(0,hi.u)(ee)}(this.mapBounds,F??0,a.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const ud=10,pd=80,va=(0,de.vt)(),ya=(0,de.vt)(),Ds=(0,de.vt)(),mn=(0,de.vt)();var fd=se(20029);class md{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;const a=this._operations.data;if(a.geometry.hasZ){const y=a.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const F of a.components)for(const $ of F.vertices){const ee=y.getZ($.pos)??0;this._zMax=Math.max(ee,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(a,y,F){this._tool=a,this._bounds=y,this._preserveAspectRatioStep=F,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._displayBoundsStart=(0,hi.d)(),this._displayBoundsMarginStart=0,this._zMax=0,this._zMaxDirty=!0;const $=this._tool,ee=$.view;this.resizeManipulators=this._resizeHandles.map(te=>{const ie=new ld(ee,te);return $.addHandles([ie.events.on("grab-changed",ne=>this._onGrabChanged(ne)),this._createResizeDragPipeline(ie,te)]),ie}),$.manipulators.addMany(this.resizeManipulators),this._operations&&$.addHandles(this._operations.data.on("change",()=>{"resize"!==$.inputState?.type&&(this._zMaxDirty=!0)}))}destroy(){this.forEachManipulator(a=>{this._tool.manipulators.remove(a),a.destroy()})}forEachManipulator(a){this.resizeManipulators.forEach(y=>a(y,at.SCALE))}updateManipulators(a,y){this.resizeManipulators.forEach((F,$)=>{!function Ih(h,a,y,F){const $=(0,oe.l)(F.basis1),ee=(0,oe.l)(F.basis2),te=Mr(F),ie=Vn(F),ne=(0,oe.i)(Ee.rq.get(),0,0,0);(0,oe.g)(ne,(0,oe.h)(Ee.rq.get(),F.basis1,a.direction[0]),(0,oe.h)(Ee.rq.get(),F.basis2,a.direction[1])),(0,oe.g)(ne,F.origin,ne);let ae=0,le=1;if(zn(a))1===a.direction[0]&&-1===a.direction[1]?ae=fn:1===a.direction[0]&&1===a.direction[1]?ae=Math.PI:-1===a.direction[0]&&1===a.direction[1]&&(ae=3*Math.PI/2),le=ie;else{const _e=0!==a.direction[0]?1:2;ae=1===_e?fn:0,le=(1===_e?ee:$)-te}const ue=(0,Ge.N9)(Ee.Rc.get(),ae);(0,Ge.hs)(ue,ue,(0,oe.i)(Ee.rq.get(),le,le,le)),(0,Ge.lw)(ue,y,ue),ue[12]=0,ue[13]=0,ue[14]=0,h.modelTransform=ue,h.renderLocation=ne}(F,this._resizeHandles[$],a,y)})}getUpdatedTooltipInfo(){if(!this.resizeManipulators.some(F=>F.focused))return null;const a=this._tooltipInfo??=new fd.c({sketchOptions:this._tool.sketchOptions}),y=function _d(h,a,y){return(0,oe.d)(mn,(0,oe.d)(mn,h.origin,h.basis1),h.basis2),(0,oe.b)(Ds,mn,h.basis1,2),(0,oe.b)(ya,Ds,h.basis2,2),(0,oe.b)(va,mn,h.basis2,2),mn[2]=Ds[2]=ya[2]=va[2]=a,(0,hd.b)({topLeft:va,topRight:ya,bottomRight:Ds,bottomLeft:mn,spatialReference:y})}(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return y&&(a.xSize=y.xSize,a.ySize=y.ySize),this.resizeManipulators.some(F=>F.dragging)||(a.xScale=1,a.yScale=1),a}_onGrabChanged({action:a,screenPoint:y}){const F=this._tool,$=this._bounds;if("start"!==a||!y)return;const ee=_o(F.view.state.camera,y);(0,ct.Ui)($.displayBounds.plane,ee,Ee.rq.get())&&($.backupMapBounds(),(0,hi.a)($.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=$.displayBoundsMargin,F.inputState={type:"resize"})}_createResizeDragPipeline(a,y){const{_tool:F,_object:$}=this;return(0,We.Xt)(a,(ee,te,ie)=>{null!=F.inputState&&(te.next(ne=>("start"===ne.action&&F.events.emit("scale-start",{object:$,xScale:1,yScale:1}),{...ne,handle:y})).next(gs(F.view,this._displayBoundsStart.plane)).next(this._renderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._updateGeometry()).next(ne=>{const ae=this._tooltipInfo;ae&&(ae.xScale=ne.factor1,ae.yScale=ne.factor2);const le={object:$,xScale:ne.factor1,yScale:ne.factor2};switch(ne.action){case"start":case"update":F.events.emit("scale",le);break;case"end":F.inputState=null,F.events.emit("scale-stop",le)}return ne}),ie.next(()=>{null!=F.inputState&&F.events.emit("scale-stop",{object:$,xScale:1,yScale:1}),F.cancel()}))})}_renderPlaneToFactors(){const a=this._bounds;return y=>{const F=this._displayBoundsStart,$=y.handle.direction,ee=a.displayBoundsMargin,te=this._displayBoundsMarginStart,ie=(0,oe.c)(Ee.rq.get(),F.origin);(0,oe.b)(ie,ie,F.basis1,-$[0]),(0,oe.b)(ie,ie,F.basis2,-$[1]);const ne=(0,oe.d)(Ee.rq.get(),y.renderEnd,ie),ae=(0,oe.d)(Ee.rq.get(),y.renderStart,ie),le=zn(y.handle),ue=Vn(F),_e=Vn(a.displayBounds)/ue,be=(we,Ae)=>{if(0===we)return 1;let Le=(0,oe.l)(Ae),Ce=.5*we*(0,oe.f)(Ae,ne)/Le;const Ne=Ce<0?-1:1;le&&(Ce+=(Le-.5*we*(0,oe.f)(Ae,ae)/Le)*Ne*_e);const nt=Le<1.5*te?1:wr;return Le=Math.max(Le-te,wr),Ne>0&&(Ce-=ee),Ne*Math.max(Ne*(Ce/Le),nt)};return{...y,factor1:be($[0],F.basis1),factor2:be($[1],F.basis2)}}}_updateGeometry(){const a=this._bounds;return y=>{const F=(0,oe.c)((0,de.vt)(),a.mapBoundsStart.origin);(0,oe.b)(F,F,a.mapBoundsStart.basis1,-y.handle.direction[0]),(0,oe.b)(F,F,a.mapBoundsStart.basis2,-y.handle.direction[1]);const $=(0,Xe.hZ)((0,gt.vt)(),a.mapBoundsStart.basis1[0],a.mapBoundsStart.basis1[1]);if((0,Xe.S8)($,$),this._operations){const te=this._operations.scale(F,$,y.factor1,y.factor2,"start"===y.action?ti.Y.NEW_STEP:ti.Y.ACCUMULATE_STEPS,xr.K.REPLACE);(0,hi.a)(a.mapBoundsStart,a.mapBounds),a.updateMapBoundsFromOperation(te)}return y}}}const wr=1e-6;class vd{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(a){if(this._enabled!==a&&null!=this._lastDragEvent&&null!=this._next){const y={...this._lastDragEvent,action:"update"};a&&Dr(y),this._next.execute(y)}this._enabled=a}createDragEventPipelineStep(){this._lastDragEvent=null;const a=new We.rh;return this._next=a,[y=>(this._lastDragEvent="end"!==y.action?{...y}:null,this._enabled&&Dr(y),y),a]}get test(){}}function Dr(h){const a=zn(h.handle)?Math.max(Math.abs(h.factor1),Math.abs(h.factor2)):0===h.handle.direction[0]?Math.abs(h.factor2):Math.abs(h.factor1);h.factor1=h.factor1<0?-a:a,h.factor2=h.factor2<0?-a:a}class yd{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=(0,me.kU)(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(a){if(this._enabled!==a&&null!=this._lastDragEvent&&null!=this._next){const y={...this._lastDragEvent,action:"update"};a&&this._adjustRotation(y),this._next.execute(y)}this._enabled=a}createDragEventPipelineStep(){this._lastDragEvent=null;const a=new We.rh;return this._next=a,[y=>(this._lastDragEvent="end"!==y.action?{...y}:null,this._enabled&&this._adjustRotation(y),y),a]}_adjustRotation(a){a.rotateAngle=Math.round(a.rotateAngle/this.incrementRadians)*this.incrementRadians}}let Lt=class extends fs.g{get updating(){return!!this.object.updating}constructor(h){super(h),this.events=new Qt.A,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new Ti.A,this._preserveAspectRatio=new vd,this._snapRotation=new yd,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:h,object:a}=this,y=this._bounds=new dd(this,()=>this._updateManipulators());this._extentMove=new Nh(this,y),this._extentScale=new md(this,y,()=>this._preserveAspectRatio.createDragEventPipelineStep()),this._extentRotate=new rd(this,y,()=>this._snapRotation.createDragEventPipelineStep()),this.addHandles([(0,ge.wB)(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,at.TRANSLATE_Z)),(0,ge.wB)(()=>this.enableScaling,()=>this._extentScale.forEachManipulator(te=>this._updateManipulatorAvailability(te,at.SCALE))),(0,ge.wB)(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,at.ROTATE))]),this._updateManipulators(),this._updateAllManipulatorAvailability();const F=us({view:h,object:a,forEachManipulator:te=>this._forEachManipulator(te),onManipulatorsChanged:()=>(0,Se.hA)()});if(null!=F){const{visualElement:te}=F;te instanceof Bi&&(this._outlineVisualElement=te,this.addHandles(te.events.on("attachment-origin-changed",()=>this._bounds.updateDisplayBounds()))),this.addHandles(F)}this.addHandles([a.on("committed",()=>this._onGeometryChanged()),(0,ge.wB)(()=>this.object.visible,()=>this._updateAllManipulatorAvailability()),(0,ge.wB)(()=>this.object.isDraped,()=>this._graphicDrapedChanged(),ge.Vh),(0,ge.wB)(()=>h.pointsOfInterest?.centerOnSurfaceFrequent.location,()=>y.updateDisplayBounds())]),this._forEachManipulator(te=>{this.addHandles(te.events.on("grab-changed",()=>{this.grabbing=te.grabbing,this._updateAllManipulatorAvailability()}))}),this._forEachManipulator((te,ie)=>{this.addHandles(te.events.on("immediate-click",ne=>{ie===at.TRANSLATE_XY&&this.events.emit("immediate-click",{...ne,object:a}),ne.stopPropagation()}))}),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){const{view:h}=this;this.tooltip=(0,It.A)(()=>({view:h,options:this.sketchOptions.tooltips}));const a=()=>{this.tooltip.info=this._getUpdatedTooltipInfo()};this.addHandles([(0,ge.wB)(()=>this.sketchOptions.tooltips.effectiveEnabled,a),(0,ge.wB)(()=>this.preserveAspectRatio,a)]),this._forEachManipulator(y=>{this.addHandles([y.events.on(["focus-changed","grab-changed"],a),y.events.on("drag",F=>{"cancel"===F.action?this.tooltip.clear():a()})])})}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(Ar),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",h=>{null!=this._attachmentOrigin&&(0,Bs.Rj)(h.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()}),Ar)}_updateManipulators(){if(!this.visible)return;const h=this._bounds.displayBounds,a=function Ph(h,a){return No(h.basis1,h.basis2,h.origin,a)}(h,Ee.Rc.get());this._extentMove.updateManipulators(a,h),this._extentScale.updateManipulators(a,h),this._extentRotate.updateManipulators(a,h)}_updateAllManipulatorAvailability(){this._forEachManipulator((h,a)=>this._updateManipulatorAvailability(h,a))}_updateManipulatorAvailability(h,a){const y=this.grabbing&&!h.grabbing;if(h.interactive=!y,h instanceof Ut){const F=this.object.visible,$=this.enableZ&&Xi(this.object.operations,this.object.elevationInfo);switch(a){case at.ROTATE:h.available=F&&this.enableRotation;break;case at.SCALE:h.available=F&&(this.enableScaling||this.enableRotation||$),h.interactive=!y&&this.enableScaling,h.state=this.enableScaling?Ss:br;break;case at.TRANSLATE_Z:h.available=F&&$;break;default:h.available=F}}}_forEachManipulator(h){this._extentMove.forEachManipulator(h),this._extentScale.forEachManipulator(h),this._extentRotate.forEachManipulator(h)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(h){this._preserveAspectRatio.enabled=h,this._set("preserveAspectRatio",h)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(h){this._snapRotation.enabled=h,this._set("snapRotation",h)}get attachmentOrigin(){return this._attachmentOrigin=(this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin)??this.object.origin??bt(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){const h=this.object.operations?.undo();h&&this._bounds.updateMapBoundsFromOperationInverse(h)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const h=this.object.operations?.undo();h&&this._bounds.updateMapBoundsFromOperationInverse(h)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){const h=this.object.operations?.redo();h&&this._bounds.updateMapBoundsFromOperation(h)}}get test(){}};(0,re._)([(0,ce.MZ)()],Lt.prototype,"updating",null),(0,re._)([(0,ce.MZ)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"view",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"object",void 0),(0,re._)([(0,ce.MZ)()],Lt.prototype,"enableZ",void 0),(0,re._)([(0,ce.MZ)()],Lt.prototype,"enableScaling",void 0),(0,re._)([(0,ce.MZ)()],Lt.prototype,"enableRotation",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0,type:Ti.A})],Lt.prototype,"sketchOptions",void 0),(0,re._)([(0,ce.MZ)()],Lt.prototype,"preserveAspectRatio",null),(0,re._)([(0,ce.MZ)()],Lt.prototype,"snapRotation",null),(0,re._)([(0,ce.MZ)()],Lt.prototype,"grabbing",void 0),(0,re._)([(0,ce.MZ)()],Lt.prototype,"inputState",void 0),(0,re._)([(0,ce.MZ)({readOnly:!0})],Lt.prototype,"type",void 0),(0,re._)([(0,ce.MZ)()],Lt.prototype,"tooltip",void 0),Lt=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],Lt);const Ar="draped-elevation-changes";var Md=se(78559);var wd=se(79338);const Ma=Symbol();let ji=class extends Qt.A.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return(0,Te.bh)(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return function Uc(h,a){const y=h.getViewForGraphic(a);return null!=y&&"computeAttachmentOrigin"in y?y.computeAttachmentOrigin(a,h.spatialReference):null}(this.view,this.graphic)}constructor(h){super(h),this._updatingHandles=new as.U}destroy(){this._operations=(0,Oe.pR)(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new ui({graphic:this.graphic}),this._graphicState.on("changed",()=>this.emit("committed")),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add(()=>this.graphic.geometry,h=>{const a=this._operations?.data.geometry;if(h!==a){if(!h||"multipoint"===h?.type||"extent"===h?.type)return(0,Oe.pR)(this._operations),this.removeHandles(Ma),void(this._operations=null);if(this._operations?.trySetGeometry(h))this.emit("modified-externally");else{(0,Oe.pR)(this._operations),this.removeHandles(Ma);const y=qs.p.fromGeometry(h,this.view.state.viewingMode);this._operations=y,this.addHandles(y.data.on("change",()=>this.graphic.geometry=y.data.geometry),Ma)}}},ge.pc))}createManipulator(h){return new wd.l({view:this.view,graphic:this.graphic,...h})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){"mesh"===this.graphic.geometry?.type&&this.graphic.notifyMeshTransformChanged({action:Vs.$.UpdateFastLocalOrigin})}toMap(h){return this.view.toMap(h,{include:[this.graphic]})}createUndoRecord(){const{graphic:{geometry:h}}=this;return function bd(h){return null!=h&&"mesh"===h.type?function Ed(h){return(0,Md.Hq)(h.vertexSpace)?function Sd(h,a,y){let F=a?.clone(),$=(0,de.o8)(y.origin),ee=null,te=null;return{undo:()=>{ee=h.transform?.clone(),te=(0,de.o8)(y.origin),h.transform=F,h.vertexSpace.origin=$},redo:()=>{F=h.transform?.clone(),$=(0,de.o8)(y.origin),h.transform=ee,h.vertexSpace.origin=te}}}(h,h.transform,h.vertexSpace):function xd(h){let a,y=h.vertexAttributes.clonePositional();return{undo:()=>{a=h.vertexAttributes.clonePositional(),h.vertexAttributes=y},redo:()=>{y=h.vertexAttributes.clonePositional(),h.vertexAttributes=a}}}(h)}(h):function Od(h){let a=h,y=null;return{undo(F){y=F.geometry,F.geometry=a},redo(F){a=F.geometry,F.geometry=y}}}(h)}(h)}};(0,re._)([(0,ce.MZ)({constructOnly:!0})],ji.prototype,"view",void 0),(0,re._)([(0,ce.MZ)({constructOnly:!0})],ji.prototype,"graphic",void 0),(0,re._)([(0,ce.MZ)()],ji.prototype,"_operations",void 0),(0,re._)([(0,ce.MZ)()],ji.prototype,"operations",null),(0,re._)([(0,ce.MZ)()],ji.prototype,"updating",null),ji=(0,re._)([(0,Ie.$)("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],ji)},42474:(zt,st,se)=>{se.d(st,{K:()=>Ye});var re=se(85340),De=se(8733),Se=se(88791),Oe=se(65840),ge=se(24493),ce=se(18679),Be=se(35089);function Ye(je,Ie){const oe=je.fragment;oe.include(re.E),je.include(De.Ir),oe.uniforms.add(new Oe.m("globalAlpha",de=>de.globalAlpha),new Se.t("glowColor",de=>de.glowColor),new Oe.m("glowWidth",(de,Te)=>de.glowWidth*Te.camera.pixelRatio),new Oe.m("glowFalloff",de=>de.glowFalloff),new Se.t("innerColor",de=>de.innerColor),new Oe.m("innerWidth",(de,Te)=>de.innerWidth*Te.camera.pixelRatio),new ce.x("depthMap",de=>de.depth?.attachment),new Be.N("normalMap",de=>de.normals)),oe.code.add(ge.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),oe.code.add(ge.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),oe.code.add(ge.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),oe.code.add(ge.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float angleCutoffAdjust, out float depthDiscontinuityAlpha) {
float depth = depthFromTexture(depthMap, uv);
if (depth == 1.0) {
return false;
}
float linearDepth = linearizeDepth(depth);
pos = reconstructPosition(gl_FragCoord.xy, linearDepth);
float minStep = 6e-8;
float depthStep = clamp(depth + minStep, 0.0, 1.0);
float linearDepthStep = linearizeDepth(depthStep);
float depthError = abs(linearDepthStep - linearDepth);
if (depthError > 0.2) {
normal = texture(normalMap, uv).xyz * 2.0 - 1.0;
angleCutoffAdjust = 0.004;
} else {
normal = normalize(cross(dFdx(pos), dFdy(pos)));
angleCutoffAdjust = 0.0;
}
float ddepth = fwidth(linearDepth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / linearDepth);
return true;
}`),Ie.contrastControlEnabled?oe.uniforms.add(new Be.N("frameColor",(de,Te)=>de.colors),new Oe.m("globalAlphaContrastBoost",de=>de.globalAlphaContrastBoost)).code.add(ge.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`):oe.code.add(ge.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},74687:(zt,st,se)=>{se.d(st,{L:()=>ge});var re=se(7741),De=se(82374),Se=se(65840),Oe=se(24493);function ge(ce,Be){if(!Be.screenSizeEnabled)return;const Ye=ce.vertex;(0,re.yu)(Ye,Be),Ye.uniforms.add(new De.U("perScreenPixelRatio",je=>je.camera.perScreenPixelRatio),new Se.m("screenSizeScale",je=>je.screenSizeScale)).code.add(Oe.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},79595:(zt,st,se)=>{se.d(st,{N:()=>Oe,d:()=>Se});var Se,ge,re=se(8189),De=se(55062);(ge=Se||(Se={}))[ge.None=0]="None",ge[ge.Alpha=1]="Alpha",ge[ge.PremultipliedAlpha=2]="PremultipliedAlpha",ge[ge.Depth=3]="Depth",ge[ge.COUNT=4]="COUNT";class Oe extends De.K{constructor(){super(...arguments),this.blitMode=Se.None,this.hasOpacityFactor=!1}}(0,re._)([(0,De.W)({count:Se.COUNT})],Oe.prototype,"blitMode",void 0),(0,re._)([(0,De.W)()],Oe.prototype,"hasOpacityFactor",void 0)}}]);