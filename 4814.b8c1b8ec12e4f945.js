"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[4814,7340],{23506:(W,M,o)=>{o.d(M,{v:()=>P});var _=o(99305);function P(x){x?.writtenProperties&&x.writtenProperties.forEach(({target:d,propName:A,newOrigin:f})=>{(0,_.H)(d)&&f&&d.originOf(A)!==f&&d.updateOrigin(A,f)})}},99305:(W,M,o)=>{function _(P){return P&&"getAtOrigin"in P&&"originOf"in P}o.d(M,{H:()=>_})},54814:(W,M,o)=>{o.r(M),o.d(M,{save:()=>y,saveAs:()=>D});var _=o(10467),P=o(17994),x=o(15764),d=o(69927),A=o(3458);const f="Group Layer",I="group-layer-save",b="group-layer-save-as",R=d.mm.GROUP_LAYER_MAP;function C(e){return{isValid:"group"===e.type,errorMessage:"Layer.type should be 'group'"}}function K(e){return{isValid:(0,d.Y)(e,R),errorMessage:`Layer.portalItem.typeKeywords should have '${R}'`}}function j(e,r){return{...(0,x.m)(e,"web-map",!0),initiator:r}}function L(e){const r=e.layerJSON;return Promise.resolve(r&&Object.keys(r).length?r:null)}function p(e,r){return l.apply(this,arguments)}function l(){return(l=(0,_.A)(function*(e,r){r.title||=e.title,(0,d.OM)(r,d.mm.METADATA),(0,d.LG)(r,R)})).apply(this,arguments)}function y(e,r){return c.apply(this,arguments)}function c(){return c=(0,_.A)(function*(e,r){return(0,P.UN)({layer:e,itemType:f,validateLayer:C,validateItem:K,createJSONContext:u=>j(u,e),createItemData:L,errorNamePrefix:I,saveResources:(u=(0,_.A)(function*(m,g){return e.sourceIsPortalItem||(yield m.removeAllResources().catch(()=>{})),(0,A.r)(e.resourceReferences,g)}),function(g,i){return u.apply(this,arguments)})},r);var u}),c.apply(this,arguments)}function D(e,r,u){return O.apply(this,arguments)}function O(){return(O=(0,_.A)(function*(e,r,u){return(0,P.Uh)({layer:e,itemType:f,validateLayer:C,createJSONContext:m=>j(m,e),createItemData:L,errorNamePrefix:b,newItem:r,setItemProperties:p,saveResources:(m,g)=>(0,A.r)(e.resourceReferences,g)},u)})).apply(this,arguments)}},17994:(W,M,o)=>{o.d(M,{B5:()=>r,CJ:()=>D,Gy:()=>j,UN:()=>m,Uh:()=>i,Y:()=>R,Y0:()=>y,Y9:()=>e,eP:()=>l});var _=o(10467),P=o(5922),x=o(23506),d=o(73874),A=o(46577),f=o(15764),I=o(69927),b=o(95945);function R(t,n,s){const a=s(t);if(!a.isValid)throw new P.A(`${n}:invalid-parameters`,a.errorMessage,{layer:t})}function C(t){return K.apply(this,arguments)}function K(){return(K=(0,_.A)(function*(t){const{layer:n,errorNamePrefix:s,validateLayer:a}=t;yield n.load(),R(n,s,a)})).apply(this,arguments)}function j(t,n){return`Layer (title: ${t.title}, id: ${t.id}) of type '${t.declaredClass}' ${n}`}function L(t){const{item:n,errorNamePrefix:s,layer:a,validateItem:v}=t;if(function p(t){const{item:n,itemType:s,additionalItemType:a,errorNamePrefix:v,layer:U}=t,T=[s];if(a&&T.push(a),!T.includes(n.type)){const w=T.map(h=>`'${h}'`).join(", ");throw new P.A(`${v}:portal-item-wrong-type`,`Portal item type should be one of: "${w}"`,{item:n,layer:U})}}(t),v){const U=v(n);if(!U.isValid)throw new P.A(`${s}:invalid-parameters`,U.errorMessage,{layer:a})}}function l(t){const{layer:n,errorNamePrefix:s}=t,{portalItem:a}=n;if(!a)throw new P.A(`${s}:portal-item-not-set`,j(n,"requires the portalItem property to be set"));if(!a.loaded)throw new P.A(`${s}:portal-item-not-loaded`,j(n,"cannot be saved to a portal item that does not exist or is inaccessible"));L({...t,item:a})}function y(t){const{newItem:n,itemType:s}=t;let a=A.default.from(n);return a.id&&(a=a.clone(),a.id=null),a.type??=s,a.portal??=d.A.getDefault(),L({...t,item:a}),a}function c(t){return(0,f.m)(t,"portal-item")}function D(t,n,s){return O.apply(this,arguments)}function O(){return(O=(0,_.A)(function*(t,n,s){"beforeSave"in t&&"function"==typeof t.beforeSave&&(yield t.beforeSave());const a=t.write({},n);return yield Promise.all(n.resources?.pendingOperations??[]),(0,b.c)(n,{errorName:"layer-write:unsupported"},s),a})).apply(this,arguments)}function e(t){(0,I.LG)(t,I.mm.JSAPI),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((n,s,a)=>a.indexOf(n)===s))}function r(t,n,s){return u.apply(this,arguments)}function u(){return(u=(0,_.A)(function*(t,n,s){const a=t.portal;yield a.signIn(),yield a.user.addItem({item:t,data:n,folder:s?.folder})})).apply(this,arguments)}function m(t,n){return g.apply(this,arguments)}function g(){return(g=(0,_.A)(function*(t,n){const{layer:s,createItemData:a,createJSONContext:v,setItemProperties:U,saveResources:T,supplementalUnsupportedErrors:w}=t;yield C(t),l(t);const h=s.portalItem,B=v?v(h):c(h),N=yield D(s,B,{...n,supplementalUnsupportedErrors:w}),S=yield a({layer:s,layerJSON:N},h);return yield U?.(s,h,S),e(h),yield h.update({data:S}),(0,x.v)(B),yield T?.(h,B),h})).apply(this,arguments)}function i(t,n){return E.apply(this,arguments)}function E(){return(E=(0,_.A)(function*(t,n){const{layer:s,createItemData:a,createJSONContext:v,setItemProperties:U,saveResources:T,supplementalUnsupportedErrors:w}=t;yield C(t);const h=y(t),B=v?v(h):c(h),N=yield D(s,B,{...n,supplementalUnsupportedErrors:w}),S=yield a({layer:s,layerJSON:N},h);return yield U(s,h,S),e(h),yield r(h,S,n),s.portalItem=h,(0,x.v)(B),yield T?.(h,B),h})).apply(this,arguments)}},15764:(W,M,o)=>{o.d(M,{m:()=>d,v:()=>x});var _=o(45272),P=o(73874);function x(f,I){return{...A(f,I),readResourcePaths:[]}}function d(f,I,b){const R=(0,_.An)(f.itemUrl);return{...A(f,I),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:R?{rootPath:R.path,writtenUrls:[]}:null,resources:b?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function A(f,I){return{origin:I,url:(0,_.An)(f.itemUrl),portal:f.portal||P.A.getDefault(),portalItem:f}}},57340:(W,M,o)=>{o.r(M),o.d(M,{addOrUpdateResources:()=>I,contentToBlob:()=>y,fetchResources:()=>A,getSiblingOfSameType:()=>D,getSiblingOfSameTypeI:()=>O,removeAllResources:()=>K,removeResource:()=>R,splitPrefixFileNameAndExtension:()=>p});var _=o(10467),P=o(89563),x=o(5922),d=o(45272);function A(e){return f.apply(this,arguments)}function f(){return(f=(0,_.A)(function*(e,r={},u){yield e.load(u);const m=(0,d.fj)(e.itemUrl,"resources"),{start:g=1,num:i=10,sortOrder:E="asc",sortField:t="resource"}=r,n={query:{start:g,num:i,sortOrder:E,sortField:t,token:e.apiKey},signal:u?.signal},s=yield e.portal.request(m,n);return{total:s.total,nextStart:s.nextStart,resources:s.resources.map(({created:a,size:v,resource:U})=>({created:new Date(a),size:v,resource:e.resourceFromPath(U)}))}})).apply(this,arguments)}function I(e,r,u,m){return b.apply(this,arguments)}function b(){return(b=(0,_.A)(function*(e,r,u,m){const g=new Map;for(const{resource:E,content:t,compress:n,access:s}of r){if(!E.hasPath())throw new x.A(`portal-item-resource-${u}:invalid-path`,"Resource does not have a valid path");const[a,v]=L(E.path),U=`${a}/${n??""}/${s??""}`;g.has(U)||g.set(U,{prefix:a,compress:n,access:s,files:[]}),g.get(U).files.push({fileName:v,content:t})}yield e.load(m);const i=(0,d.fj)(e.userItemUrl,"add"===u?"addResources":"updateResources");for(const{prefix:E,compress:t,access:n,files:s}of g.values())for(let v=0;v<s.length;v+=25){const U=s.slice(v,v+25),T=new FormData;E&&"."!==E&&T.append("resourcesPrefix",E),t&&T.append("compress","true"),n&&T.append("access",n);let w=0;for(const{fileName:h,content:B}of U)T.append("file"+ ++w,B,h);T.append("f","json"),yield e.portal.request(i,{method:"post",body:T,signal:m?.signal})}})).apply(this,arguments)}function R(e,r,u){return C.apply(this,arguments)}function C(){return(C=(0,_.A)(function*(e,r,u){if(!r.hasPath())throw new x.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield e.load(u);const m=(0,d.fj)(e.userItemUrl,"removeResources");yield e.portal.request(m,{method:"post",query:{resource:r.path},signal:u?.signal}),r.portalItem=null})).apply(this,arguments)}function K(e,r){return j.apply(this,arguments)}function j(){return(j=(0,_.A)(function*(e,r){yield e.load(r);const u=(0,d.fj)(e.userItemUrl,"removeResources");return e.portal.request(u,{method:"post",query:{deleteAll:!0},signal:r?.signal})})).apply(this,arguments)}function L(e){const r=e.lastIndexOf("/");return-1===r?[".",e]:[e.slice(0,r),e.slice(r+1)]}function p(e){const[r,u]=function l(e){const r=(0,d.Zo)(e);return null==r?[e,""]:[e.slice(0,e.length-r.length-1),`.${r}`]}(e),[m,g]=L(r);return[m,g,u]}function y(e){return c.apply(this,arguments)}function c(){return(c=(0,_.A)(function*(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(yield(0,P.A)(e.url,{responseType:"blob"})).data})).apply(this,arguments)}function D(e,r){if(!e.hasPath())return null;const[u,,m]=p(e.path);return e.portalItem.resourceFromPath((0,d.fj)(u,r+m))}function O(e,r){if(!e.hasPath())return null;const[u,,m]=p(e.path);return e.portalItem.resourceFromPath((0,d.fj)(u,r+m))}},3458:(W,M,o)=>{o.d(M,{S:()=>b,r:()=>f});var _=o(10467),P=o(5922),x=o(56492),d=o(43085),A=o(57340);function f(p,l,y){return I.apply(this,arguments)}function I(){return(I=(0,_.A)(function*(p,l,y){const c=yield C(p,l,y);yield j(c,l,y)})).apply(this,arguments)}function b(p,l,y,c,D){return R.apply(this,arguments)}function R(){return(R=(0,_.A)(function*(p,l,y,c,D){const O=yield C(y,c,D);yield p.update({data:l}),yield j(O,c,D)})).apply(this,arguments)}function C(p,l,y){return K.apply(this,arguments)}function K(){return(K=(0,_.A)(function*(p,l,y){if(!l?.resources)return;const c=l.portalItem===p.portalItem?new Set(p.paths):new Set;p.paths.length=0,p.portalItem=l.portalItem;const D=new Set(l.resources.toKeep.map(i=>i.resource.path)),O=new Set,e=[];D.forEach(i=>{c.delete(i),p.paths.push(i)});const r=[],u=[],m=[];for(const i of l.resources.toUpdate)if(c.delete(i.resource.path),D.has(i.resource.path)||O.has(i.resource.path)){const{resource:E,content:t,finish:n}=i,s=(0,A.getSiblingOfSameTypeI)(E,(0,d.lk)());p.paths.push(s.path),r.push({resource:s,content:yield(0,A.contentToBlob)(t),compress:i.compress}),n&&m.push(()=>n(s))}else{p.paths.push(i.resource.path),u.push({resource:i.resource,content:yield(0,A.contentToBlob)(i.content),compress:i.compress});const E=i.finish;E&&m.push(()=>E(i.resource)),O.add(i.resource.path)}for(const i of l.resources.toAdd)if(p.paths.push(i.resource.path),c.has(i.resource.path))c.delete(i.resource.path);else{r.push({resource:i.resource,content:yield(0,A.contentToBlob)(i.content),compress:i.compress});const E=i.finish;E&&m.push(()=>E(i.resource))}if(r.length||u.length){const{addOrUpdateResources:i}=yield Promise.resolve().then(o.bind(o,57340));yield i(l.portalItem,r,"add",y),yield i(l.portalItem,u,"update",y)}if(m.forEach(i=>i()),0===e.length)return c;const g=yield(0,x.Ol)(e);if((0,x.Te)(y),g.length>0)throw new P.A("save:resources","Failed to save one or more resources",{errors:g});return c})).apply(this,arguments)}function j(p,l,y){return L.apply(this,arguments)}function L(){return(L=(0,_.A)(function*(p,l,y){if(!p||!l.portalItem)return;const c=[];for(const D of p){const O=l.portalItem.resourceFromPath(D);c.push(O.portalItem.removeResource(O,y))}yield(0,x.Lx)(c)})).apply(this,arguments)}}}]);