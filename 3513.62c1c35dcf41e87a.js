"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[3513],{33096:(pe,W,a)=>{a.d(W,{a:()=>_,b:()=>Ae,d:()=>k,f:()=>P,g:()=>E,h:()=>R,u:()=>D}),a(3248);var d=a(35150),h=a(69287),H=a(84149),v=a(92771),Z=a(62789),s=a(28714),f=a(25866),N=a(51995),u=a(41510),ee=a(71548),S=a(93617),fe=a(55703),U=a(99608),O=a(19741);const te=()=>d.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function k(n=x){return{plane:(0,S.vt)(n.plane),origin:(0,f.o8)(n.origin),basis1:(0,f.o8)(n.basis1),basis2:(0,f.o8)(n.basis2)}}function _(n,e=k()){return P(n.origin,n.basis1,n.basis2,e)}function P(n,e,t,i=k()){return(0,s.c)(i.origin,n),(0,s.c)(i.basis1,e),(0,s.c)(i.basis2,t),D(i),function Ie(n,e){Math.abs((0,s.f)(n.basis1,n.basis2)/((0,s.l)(n.basis1)*(0,s.l)(n.basis2)))>1e-6&&te().warn(e,"Provided basis vectors are not perpendicular"),Math.abs((0,s.f)(n.basis1,V(n)))>1e-6&&te().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,s.f)(V(n),n.origin)-n.plane[3])>1e-6&&te().warn(e,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function D(n){(0,S.mR)(n.basis2,n.basis1,n.origin,n.plane)}function A(n,e,t){n!==t&&_(n,t);const i=(0,s.h)(O.rq.get(),V(n),e);return(0,s.g)(t.origin,t.origin,i),t.plane[3]-=e,t}function E(n,e=k()){const t=(n[2]-n[0])/2,i=(n[3]-n[1])/2;return(0,s.i)(e.origin,n[0]+t,n[1]+i,0),(0,s.i)(e.basis1,t,0,0),(0,s.i)(e.basis2,0,i,0),(0,S.fA)(0,0,1,0,e.plane),e}function F(n,e,t){return!!(0,S.Ui)(n.plane,e,t)&&re(n,t)}function M(n,e,t){const i=oe.get();ve(n,e,i,oe.get());let o=Number.POSITIVE_INFINITY;for(const r of ce){const l=ue(n,r,ae.get()),c=O.rq.get();if((0,S.T7)(i,l,c)){const g=(0,s.o)(O.rq.get(),e.origin,c),I=Math.abs((0,h.XM)((0,s.f)(e.direction,g)));I<o&&(o=I,(0,s.c)(t,c))}}return o===Number.POSITIVE_INFINITY?$(n,e,t):t}function $(n,e,t){if(F(n,e,t))return t;const i=oe.get(),o=oe.get();ve(n,e,i,o);let r=Number.POSITIVE_INFINITY;for(const l of ce){const c=ue(n,l,ae.get()),g=O.rq.get();if((0,S.gv)(i,c,g)){const I=(0,fe.kb)(e,g);if(!(0,S.Tj)(o,g))continue;I<r&&(r=I,(0,s.c)(t,g))}}return Q(n,e.origin)<r&&ie(n,e.origin,t),t}function ie(n,e,t){const i=(0,S._I)(n.plane,e,O.rq.get()),o=(0,ee.H6)(ye(n,n.basis1),i,-1,1,O.rq.get()),r=(0,ee.H6)(ye(n,n.basis2),i,-1,1,O.rq.get());return(0,s.d)(t,(0,s.g)(O.rq.get(),o,r),n.origin),t}function K(n,e,t){const{origin:i,basis1:o,basis2:r}=n,l=(0,s.d)(O.rq.get(),e,i),c=(0,U.gr)(o,l),g=(0,U.gr)(r,l),I=(0,U.gr)(V(n),l);return(0,s.i)(t,c,g,I)}function Q(n,e){const t=K(n,e,O.rq.get()),{basis1:i,basis2:o}=n,r=(0,s.l)(i),l=(0,s.l)(o),c=Math.max(Math.abs(t[0])-r,0),g=Math.max(Math.abs(t[1])-l,0),I=t[2];return c*c+g*g+I*I}function R(n,e){return Math.sqrt(Q(n,e))}function de(n,e){const t=-n.plane[3];return(0,U.gr)(V(n),e)-t}function V(n){return(0,S.Qj)(n.plane)}function re(n,e){const t=(0,s.d)(O.rq.get(),e,n.origin),i=(0,s.k)(n.basis1),o=(0,s.k)(n.basis2),r=(0,s.f)(n.basis1,t),l=(0,s.f)(n.basis2,t);return-r-i<0&&r-i<0&&-l-o<0&&l-o<0}function ye(n,e){const t=ae.get();return(0,s.c)(t.origin,n.origin),(0,s.c)(t.vector,e),t}function ue(n,e,t){const{basis1:i,basis2:o,origin:r}=n,l=(0,s.h)(O.rq.get(),i,e.origin[0]),c=(0,s.h)(O.rq.get(),o,e.origin[1]);(0,s.g)(t.origin,l,c),(0,s.g)(t.origin,t.origin,r);const g=(0,s.h)(O.rq.get(),i,e.direction[0]),I=(0,s.h)(O.rq.get(),o,e.direction[1]);return(0,s.h)(t.vector,(0,s.g)(g,g,I),2),t}function ve(n,e,t,i){const o=V(n);(0,S.mR)(o,e.direction,e.origin,t),(0,S.mR)((0,S.Qj)(t),o,e.origin,i)}const x={plane:(0,S.vt)(),origin:(0,f.fA)(0,0,0),basis1:(0,f.fA)(1,0,0),basis2:(0,f.fA)(0,1,0)},oe=new H.I(S.vt),ae=new H.I(ee.vt),Oe=(0,f.vt)(),we=new H.I(()=>k()),ce=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],X=(0,Z.vt)(),B=(0,Z.vt)(),Ae=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class se{constructor(){this.plane=(0,S.vt)(),this.origin=(0,f.vt)(),this.basis1=(0,f.vt)(),this.basis2=(0,f.vt)()}},altitudeAt:de,axisAt:function G(n,e,t,i){return function Y(n,e,t){switch(e){case u._.X:(0,s.c)(t,n.basis1),(0,s.n)(t,t);break;case u._.Y:(0,s.c)(t,n.basis2),(0,s.n)(t,t);break;case u._.Z:(0,s.c)(t,V(n))}return t}(n,t,i)},cameraFrustumCoverage:function ne(n,e){return(e-n)/e},closestPoint:$,closestPointOnSilhouette:M,copy:_,copyWithoutVerify:function y(n,e){(0,s.c)(e.origin,n.origin),(0,s.c)(e.basis1,n.basis1),(0,s.c)(e.basis2,n.basis2),(0,S.C)(e.plane,n.plane)},create:k,distance:R,distance2:Q,distanceToSilhouette:function L(n,e){let t=Number.NEGATIVE_INFINITY;for(const i of ce){const o=ue(n,i,ae.get()),r=(0,ee.kb)(o,e);r>t&&(t=r)}return Math.sqrt(t)},elevate:A,equals:function be(n,e){return(0,s.p)(n.basis1,e.basis1)&&(0,s.p)(n.basis2,e.basis2)&&(0,s.p)(n.origin,e.origin)},extrusionContainsPoint:function J(n,e){return(0,S.Tj)(n.plane,e)&&re(n,e)},fromAABoundingRect:E,fromValues:P,getExtent:function C(n,e){const t=n.basis1[0],i=n.basis2[1],[o,r]=n.origin;return(0,N.fA)(o-t,r-i,o+t,r+i,e)},intersectRay:F,intersectRayClosestSilhouette:function b(n,e,t){if(F(n,e,t))return t;const i=M(n,e,O.rq.get());return(0,s.g)(t,e.origin,(0,s.h)(O.rq.get(),e.direction,(0,s.j)(e.origin,i)/(0,s.l)(e.direction))),t},normal:V,projectPoint:ie,projectPointLocal:K,rotate:function Se(n,e,t,i){return n!==i&&_(n,i),(0,v.$0)(B,e,t),(0,s.t)(i.basis1,n.basis1,B),(0,s.t)(i.basis2,n.basis2,B),D(i),i},setAltitudeAt:function me(n,e,t,i){const o=de(n,e),r=(0,s.h)(Oe,V(n),t-o);return(0,s.g)(i,e,r),i},setExtent:function w(n,e,t){return E(e,t),A(t,de(n,n.origin),t),t},transform:function Me(n,e,t){return n!==t&&_(n,t),(0,v.B8)(X,e),(0,v.mg)(X,X),(0,s.t)(t.basis1,n.basis1,X),(0,s.t)(t.basis2,n.basis2,X),(0,s.t)((0,S.Qj)(t.plane),(0,S.Qj)(n.plane),X),(0,s.t)(t.origin,n.origin,e),(0,S.mP)(t.plane,t.plane,t.origin),t},up:x,updateUnboundedPlane:D,wrap:function p(n,e,t){const i=we.get();return i.origin=n,i.basis1=e,i.basis2=t,i.plane=(0,S.LV)(0,0,0,0),D(i),i}},Symbol.toStringTag,{value:"Module"}))},14784:(pe,W,a)=>{function m(h){let H,v,Z=[],s=!1;return function f(...N){return s&&H===this&&function d(h,H){if(h.length!==H.length)return!1;for(let v=0;v<h.length;++v)if(h[v]!==H[v])return!1;return!0}(N,Z)||(v=h.apply(this,N),H=this,Z=N,s=!0),v}}a.d(W,{B:()=>m})},71548:(pe,W,a)=>{a.d(W,{C:()=>f,Cr:()=>u,H6:()=>U,_I:()=>S,dz:()=>O,fA:()=>N,kb:()=>ee,ld:()=>te,sd:()=>fe,vt:()=>Z});var m=a(69287),d=a(84149),h=a(28714),H=a(25866),v=a(19741);function Z(p){return p?{origin:(0,H.o8)(p.origin),vector:(0,H.o8)(p.vector)}:{origin:(0,H.vt)(),vector:(0,H.vt)()}}function f(p,_=Z()){return N(p.origin,p.vector,_)}function N(p,_,y=Z()){return(0,h.c)(y.origin,p),(0,h.c)(y.vector,_),y}function u(p,_,y=Z()){return(0,h.c)(y.origin,p),(0,h.d)(y.vector,_,p),y}function ee(p,_){const y=(0,h.d)(v.rq.get(),_,p.origin),P=(0,h.f)(p.vector,y),D=(0,h.f)(p.vector,p.vector),A=(0,m.qE)(P/D,0,1),w=(0,h.d)(v.rq.get(),(0,h.h)(v.rq.get(),p.vector,A),y);return(0,h.f)(w,w)}function S(p,_,y){return U(p,_,0,1,y)}function fe(p,_,y){return(0,h.g)(y,p.origin,(0,h.h)(y,p.vector,_))}function U(p,_,y,P,D){const{vector:A,origin:w}=p,C=(0,h.d)(v.rq.get(),_,w),E=(0,h.f)(A,C)/(0,h.k)(A);return(0,h.h)(D,A,(0,m.qE)(E,y,P)),(0,h.g)(D,D,p.origin)}function O(p,_){if(se(p,function s(p,_){const y=k.get();return y.origin=p,y.vector=_,y}(_.origin,_.direction),!1,z)){const{tA:y,pB:P,distance2:D}=z;if(y>=0&&y<=1)return D;if(y<0)return(0,h.s)(p.origin,P);if(y>1)return(0,h.s)((0,h.g)(v.rq.get(),p.origin,p.vector),P)}return null}function te(p,_,y){return!!se(p,_,!0,z)&&((0,h.c)(y,z.pA),!0)}function se(p,_,y,P){const A=p.origin,w=(0,h.g)(v.rq.get(),A,p.vector),C=_.origin,E=(0,h.g)(v.rq.get(),C,_.vector),F=v.rq.get(),b=v.rq.get();if(F[0]=A[0]-C[0],F[1]=A[1]-C[1],F[2]=A[2]-C[2],b[0]=E[0]-C[0],b[1]=E[1]-C[1],b[2]=E[2]-C[2],Math.abs(b[0])<1e-6&&Math.abs(b[1])<1e-6&&Math.abs(b[2])<1e-6)return!1;const M=v.rq.get();if(M[0]=w[0]-A[0],M[1]=w[1]-A[1],M[2]=w[2]-A[2],Math.abs(M[0])<1e-6&&Math.abs(M[1])<1e-6&&Math.abs(M[2])<1e-6)return!1;const ne=F[0]*b[0]+F[1]*b[1]+F[2]*b[2],$=b[0]*M[0]+b[1]*M[1]+b[2]*M[2],ie=F[0]*M[0]+F[1]*M[1]+F[2]*M[2],K=b[0]*b[0]+b[1]*b[1]+b[2]*b[2],Q=(M[0]*M[0]+M[1]*M[1]+M[2]*M[2])*K-$*$;if(Math.abs(Q)<1e-6)return!1;let R=(ne*$-ie*K)/Q,L=(ne+$*R)/K;y&&(R=(0,m.qE)(R,0,1),L=(0,m.qE)(L,0,1));const J=v.rq.get(),G=v.rq.get();return J[0]=A[0]+R*M[0],J[1]=A[1]+R*M[1],J[2]=A[2]+R*M[2],G[0]=C[0]+L*b[0],G[1]=C[1]+L*b[1],G[2]=C[2]+L*b[2],P.tA=R,P.tB=L,P.pA=J,P.pB=G,P.distance2=(0,h.s)(J,G),!0}const z={tA:0,tB:0,pA:(0,H.vt)(),pB:(0,H.vt)(),distance2:0},k=new d.I(()=>Z())},33583:(pe,W,a)=>{a.r(W),a.d(W,{FeatureServiceSnappingSource:()=>n});var m=a(10467),d=a(8189),h=a(98877),H=a(89447),v=a(17715),Z=a(14784),s=a(56492),f=a(48900),N=a(63484),u=a(85211),U=(a(3248),a(35150),a(40707),a(76576)),O=a(56985),te=a(58443),se=a(73812),z=a(25858),k=a(28714),p=a(25866),_=a(33096);function y(e,t){return(0,_.g)(t.extent,P),(0,_.h)(P,(0,k.i)(D,e.x,e.y,0))}const P=(0,_.d)(),D=(0,p.vt)();var A=a(6558);let w=class extends h.A{get tiles(){const e=this.tilesCoveringView,t=null!=this.pointOfInterest?this.pointOfInterest:this.view.center;return e.sort((i,o)=>y(t,i)-y(t,o)),e}_scaleEnabled(){return(0,A.JU)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||null==this.tileInfo)return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:i}=t,o=[];for(const{row:r,colFrom:l,colTo:c}of e)for(let g=l;g<=c;g++){const I=t.normalizeCol(g),j=new z.U(null,i,r,I);this.tileInfo.updateTileInfo(j),o.push(j)}return o}get tileInfo(){return this.view.featuresTilingScheme?.tileInfo??null}get tileSize(){return null!=this.tileInfo?this.tileInfo.size[0]:256}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.addHandles((0,f.wB)(()=>this.view?.state?.viewpoint,()=>this.notifyChange("tilesCoveringView"),f.OH))}};(0,d._)([(0,u.MZ)({readOnly:!0})],w.prototype,"tiles",null),(0,d._)([(0,u.MZ)({readOnly:!0})],w.prototype,"_scaleEnabled",null),(0,d._)([(0,u.MZ)({readOnly:!0})],w.prototype,"tilesCoveringView",null),(0,d._)([(0,u.MZ)({readOnly:!0})],w.prototype,"tileInfo",null),(0,d._)([(0,u.MZ)({readOnly:!0})],w.prototype,"tileSize",null),(0,d._)([(0,u.MZ)({constructOnly:!0})],w.prototype,"view",void 0),(0,d._)([(0,u.MZ)({constructOnly:!0})],w.prototype,"layer",void 0),(0,d._)([(0,u.MZ)()],w.prototype,"pointOfInterest",void 0),w=(0,d._)([(0,U.$)("esri.views.2d.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],w);var C=a(89952);let E=class extends h.A{get _sortedTilesCoveringView(){const e=(this.view.featureTiles?.tiles?.toArray()??[]).map(F),t=this._effectivePointOfInterest;return null!=t&&e.sort((i,o)=>y(t,i)-y(t,o)),e}get tileInfo(){return this.view.featureTiles?.tilingScheme?.toTileInfo()??null}get tileSize(){return this.view.featureTiles?.tileSize??256}get _effectivePointOfInterest(){return this.pointOfInterest??this.view.pointsOfInterest?.focus.location}constructor(e){super(e),this.tiles=[],this.pointOfInterest=null}initialize(){this.addHandles([(0,f.wB)(()=>this.view.featureTiles,e=>{this.removeHandles(b),e&&this.addHandles(e.addClient(),b)},f.Vh),(0,f.wB)(()=>this._sortedTilesCoveringView,e=>this._set("tiles",e),{initial:!0,equals:(e,t)=>(0,C.aI)(e,t,(i,o)=>i.id===o.id)})])}};function F({lij:[e,t,i],extent:o}){return new z.U(`${e}/${t}/${i}`,e,t,i,o)}(0,d._)([(0,u.MZ)({readOnly:!0})],E.prototype,"tiles",void 0),(0,d._)([(0,u.MZ)({readOnly:!0})],E.prototype,"_sortedTilesCoveringView",null),(0,d._)([(0,u.MZ)({readOnly:!0})],E.prototype,"tileInfo",null),(0,d._)([(0,u.MZ)({readOnly:!0})],E.prototype,"tileSize",null),(0,d._)([(0,u.MZ)({constructOnly:!0})],E.prototype,"view",void 0),(0,d._)([(0,u.MZ)()],E.prototype,"pointOfInterest",void 0),(0,d._)([(0,u.MZ)()],E.prototype,"_effectivePointOfInterest",null),E=(0,d._)([(0,U.$)("esri.views.3d.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],E);const b="feature-tiles";var M=a(3548),ne=a(8763),$=a(55861),ie=a(51995),K=a(68677),Q=a(81098),R=a(31178),L=a(69287),J=a(25613),G=a(88521),de=a(47705),me=a(2329),be=a(53313),Me=a(16707),Se=a(39908);const V=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let Y=class extends h.A{constructor(e){super(e),this.updating=!1,this.enablePolygons=!0,this.enableLabels=!0,this._polygons=new Map,this._labels=new Map,this._enabled=!0}initialize(){this._symbols=V.map(e=>new G.A({color:[e[0],e[1],e[2],.6],outline:{color:"black",width:1}})),this.update()}destroy(){this._enabled=!1,this.clear()}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this.update())}update(){if(!this._enabled)return void this.clear();const t=this.getTiles(),i=new Array,o=new Set(this._labels.keys());t.forEach((l,c)=>{const g=l.lij.toString();o.delete(g);const I=l.measures?.lodLevel??l.level,j=l.geometry;if(this.enablePolygons&&!this._polygons.has(g)){const T=new Q.A({geometry:j,symbol:this._symbols[I%this._symbols.length]});this._polygons.set(g,T),i.push(T)}if(this.enableLabels){const T=(l=>{if(null!=l.label)return l.label;let c=l.lij.toString();return null!=l.loadPriority&&(c+=` (${l.loadPriority})`),l.measures&&(c+=`[${l.measures.lodLevel}]`),c})(l),q=c/(t.length-1),le=(0,L.Cc)(0,200,q),he=(0,L.Cc)(20,6,q)/.75,Ee=null!=l.loadPriority&&l.loadPriority>=t.length,Pe=new K.A([le,Ee?0:le,Ee?0:le]),Te="3d"===this.view.type?()=>new J.A({verticalOffset:new Se.A({screenLength:40/.75}),callout:new be.A({color:new K.A("white"),border:new Me.A({color:new K.A("black")})}),symbolLayers:new R.A([new me.A({text:T,halo:{color:"white",size:1/.75},material:{color:Pe},size:he})])}):()=>new de.A({text:T,haloColor:"white",haloSize:1/.75,color:Pe,size:he}),_e=this._labels.get(g);if(_e){const ge=Te();null!=_e.symbol&&JSON.stringify(ge)===JSON.stringify(_e.symbol)||(_e.symbol=ge)}else{const ge=new Q.A({geometry:j.extent.center,symbol:Te()});this._labels.set(g,ge),i.push(ge)}}});const r=new Array;o.forEach(l=>{const c=this._polygons.get(l);null!=c&&(r.push(c),this._polygons.delete(l));const g=this._labels.get(l);null!=g&&(r.push(g),this._labels.delete(l))}),this.view.graphics.removeMany(r),this.view.graphics.addMany(i)}clear(){this.view.graphics.removeMany(Array.from(this._polygons.values())),this.view.graphics.removeMany(Array.from(this._labels.values())),this._polygons.clear(),this._labels.clear()}};(0,d._)([(0,u.MZ)({constructOnly:!0})],Y.prototype,"view",void 0),(0,d._)([(0,u.MZ)({readOnly:!0})],Y.prototype,"updating",void 0),(0,d._)([(0,u.MZ)()],Y.prototype,"enabled",null),Y=(0,d._)([(0,U.$)("esri.views.support.TileTreeDebugger")],Y);let re=class extends Y{constructor(e){super(e)}initialize(){const e=setInterval(()=>this._fetchDebugInfo(),2e3);this.addHandles((0,v.hA)(()=>clearInterval(e)))}getTiles(){if(!this._debugInfo)return[];const e=new Map,t=new Map;this._debugInfo.storedTiles.forEach(r=>{e.set(r.data.id,r.featureCount)}),this._debugInfo.pendingTiles.forEach(r=>{e.set(r.data.id,r.featureCount),t.set(r.data.id,r.state)});const i=r=>{const l=t.get(r),c=e.get(r)??"?";return l?`${l}:${c}\n${r}`:`store:${c}\n${r}`},o=new Map;return this._debugInfo.storedTiles.forEach(r=>{o.set(r.data.id,r.data)}),this._debugInfo.pendingTiles.forEach(r=>{o.set(r.data.id,r.data)}),Array.from(o.values()).map(r=>({lij:[r.level,r.row,r.col],level:r.level,geometry:$.A.fromExtent((0,ie.w1)(r.extent,this.view.spatialReference)),label:i(r.id)}))}_fetchDebugInfo(){this.handle.getDebugInfo(null).then(e=>{this._debugInfo=e,this.update()})}};(0,d._)([(0,u.MZ)({constructOnly:!0})],re.prototype,"handle",void 0),re=(0,d._)([(0,U.$)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],re);var ye=a(11432),ue=a(94542),Ie=a(6434),ve=a(8675);let x=class extends h.A{get updating(){return this._updatingHandles.updating||this._workerHandleUpdating}constructor(e){var t;super(e),t=this,this._updatingHandles=new O.U,this._suspendController=null,this.schedule=null,this.hasZ=!1,this.elevationAlignPointsInFeatures=function(){var i=(0,m.A)(function*(o){const r=[];for(const{points:l}of o.pointsInFeatures)for(const{z:c}of l)r.push(c);return{elevations:r,drapedObjectIds:new Set,failedObjectIds:new Set}});return function(o){return i.apply(this,arguments)}}(),this.queryForSymbologySnapping=(0,m.A)(function*(){return{candidates:[],sourceCandidateIndices:[]}}),this.availability=0,this._workerHandleUpdating=!0,this.updateOutFields=(0,s.sg)(function(){var i=(0,m.A)(function*(o,r){yield t._updatingHandles.addPromise(t._workerHandle.invokeMethod("updateOutFields",[...o],r)),t._updatingHandles.addPromise(t._workerHandle.invokeMethod("whenNotUpdating",{},r))});return function(o,r){return i.apply(this,arguments)}}())}destroy(){this._suspendController=(0,ye.DC)(this._suspendController),this._workerHandle.destroy(),this._updatingHandles.destroy()}initialize(){var t,e=this;this._workerHandle=new Oe(this.schedule,{alignElevation:(t=(0,m.A)(function*(i,{signal:o}){return{result:yield e.elevationAlignPointsInFeatures(i.query,o)}}),function(o,r){return t.apply(this,arguments)}),getSymbologyCandidates:function(){var t=(0,m.A)(function*(i,{signal:o}){return{result:yield e.queryForSymbologySnapping(i,o)}});return function(o,r){return t.apply(this,arguments)}}()}),this.addHandles([this._workerHandle.on("notify-updating",({updating:t})=>this._workerHandleUpdating=t),this._workerHandle.on("notify-availability",({availability:t})=>this._set("availability",t))])}setup(e,t){var i=this;return(0,m.A)(function*(){const o=function ae(e){return"multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:e.parsedUrl?.path??"",fieldsIndex:e.fieldsIndex.toJSON(),geometryType:Ie.gy.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:e.timeInfo?.toJSON()}}(e.layer);if(null==o)return;const r={configuration:oe(e.configuration),serviceInfo:o,spatialReference:e.spatialReference.toJSON(),hasZ:i.hasZ,elevationInfo:e.layer.elevationInfo?.toJSON()};yield i._updatingHandles.addPromise(i._workerHandle.invokeMethod("setup",r,t)),i._updatingHandles.addPromise(i._workerHandle.invokeMethod("whenNotUpdating",{},t))})()}configure(e,t){var i=this;return(0,m.A)(function*(){const o=oe(e);yield i._updatingHandles.addPromise(i._workerHandle.invokeMethod("configure",o,t)),i._updatingHandles.addPromise(i._workerHandle.invokeMethod("whenNotUpdating",{},t))})()}refresh(e){var t=this;return(0,m.A)(function*(){yield t._updatingHandles.addPromise(t._workerHandle.invokeMethod("refresh",{},e)),t._updatingHandles.addPromise(t._workerHandle.invokeMethod("whenNotUpdating",{},e))})()}fetchCandidates(e,t){var i=this;return(0,m.A)(function*(){const{point:o,filter:r,coordinateHelper:l}=e,c={...e,point:(0,ve.T)(o[0],o[1],o[2],l.spatialReference.toJSON()),filter:r?.toJSON()};return i._workerHandle.invoke(c,t)})()}updateTiles(e,t){var i=this;return(0,m.A)(function*(){const o={tiles:e.tiles,tileInfo:null!=e.tileInfo?e.tileInfo.toJSON():null,tileSize:e.tileSize};yield i._updatingHandles.addPromise(i._workerHandle.invokeMethod("updateTiles",o,t)),i._updatingHandles.addPromise(i._workerHandle.invokeMethod("whenNotUpdating",{},t))})()}handleEdits({historicMoment:e,addedFeatures:t,deletedFeatures:i,updatedFeatures:o},r){var l=this;return(0,m.A)(function*(){const c={historicMoment:e,addedFeatures:t?.map(({objectId:g})=>g).filter(C.Ru)??[],deletedFeatures:i?.map(({objectId:g,globalId:I})=>({objectId:g,globalId:I}))??[],updatedFeatures:o?.map(({objectId:g})=>g).filter(C.Ru)??[]};yield l._updatingHandles.addPromise(l._workerHandle.invokeMethod("handleEdits",c,r)),l._updatingHandles.addPromise(l._workerHandle.invokeMethod("whenNotUpdating",{},r))})()}setHistoricMoment(e,t){var i=this;return(0,m.A)(function*(){yield i._updatingHandles.addPromise(i._workerHandle.invokeMethod("setHistoricMoment",{moment:e},t))})()}getDebugInfo(e){return this._workerHandle.invokeMethod("getDebugInfo",{},e)}notifyElevationSourceChange(){var e=this;return(0,m.A)(function*(){yield e._workerHandle.invokeMethod("notifyElevationSourceChange",{})})()}notifySymbologyChange(){var e=this;return(0,m.A)(function*(){yield e._workerHandle.invokeMethod("notifySymbologyChange",{})})()}setSymbologySnappingSupported(e){var t=this;return(0,m.A)(function*(){yield t._workerHandle.invokeMethod("setSymbologySnappingSupported",e)})()}setSuspended(e){var t=this;return(0,m.A)(function*(){t._suspendController?.abort(),t._suspendController=new AbortController,yield t._workerHandle.invokeMethod("setSuspended",e,t._suspendController.signal)})()}};function oe(e){return{filter:null!=e.filter?e.filter.toJSON():null,customParameters:e.customParameters,viewType:e.viewType}}(0,d._)([(0,u.MZ)({constructOnly:!0})],x.prototype,"schedule",void 0),(0,d._)([(0,u.MZ)({constructOnly:!0})],x.prototype,"hasZ",void 0),(0,d._)([(0,u.MZ)({constructOnly:!0})],x.prototype,"elevationAlignPointsInFeatures",void 0),(0,d._)([(0,u.MZ)({constructOnly:!0})],x.prototype,"queryForSymbologySnapping",void 0),(0,d._)([(0,u.MZ)({readOnly:!0})],x.prototype,"updating",null),(0,d._)([(0,u.MZ)({readOnly:!0})],x.prototype,"availability",void 0),(0,d._)([(0,u.MZ)()],x.prototype,"_workerHandleUpdating",void 0),x=(0,d._)([(0,U.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],x);class Oe extends ue.B{constructor(t,i){super("FeatureServiceSnappingSourceWorker","fetchCandidates",{},t,{strategy:"dedicated",client:i})}}var we=a(1749),ce=a(29598),X=a(11333);let B=class extends h.A{get tiles(){return[new z.U("0/0/0",0,0,0,(0,ie.fA)(-1e8,-1e8,1e8,1e8))]}get tileInfo(){return new X.A({origin:new we.A({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new ce.A({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}constructor(e){super(e),this.pointOfInterest=null}};(0,d._)([(0,u.MZ)({readOnly:!0})],B.prototype,"tiles",null),(0,d._)([(0,u.MZ)({readOnly:!0})],B.prototype,"tileInfo",null),(0,d._)([(0,u.MZ)({readOnly:!0})],B.prototype,"tileSize",null),(0,d._)([(0,u.MZ)({constructOnly:!0})],B.prototype,"layer",void 0),(0,d._)([(0,u.MZ)()],B.prototype,"pointOfInterest",void 0),B=(0,d._)([(0,U.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],B);var Ae=a(96745);let n=class extends h.A{get _updateTilesParameters(){return{tiles:this._tilesOfInterest.tiles,tileInfo:this._tilesOfInterest.tileInfo,tileSize:this._tilesOfInterest.tileSize}}get _layerView(){return this.view?.allLayerViews.find(e=>e.layer===this._layer)}get _isSuspended(){return!(!(0,te.F2)(this._layer)||this.layerSource.sublayerSources.some(e=>e.enabled&&e.layer.visible))||!(!this.view||!1===this._layerView?.suspended&&this.layerSource.enabled)}get updating(){return this._workerHandle?.updating||this._updatingHandles.updating}get _outFields(){const{view:e,_layerView:t,layerSource:i}=this,{layer:o}=i,{fieldsIndex:r,timeInfo:l,floorInfo:c,subtypeField:g}=o,I=t&&"filter"in t?t.filter:null,j=I?.where&&"1=1"!==I.where?this._getOrLoadWhereFields(I.where,r):[];if(I?.timeExtent&&l){const{startField:T,endField:q}=l,le=r.get(T)?.name??T,he=r.get(q)?.name??q;le&&j.push(le),he&&j.push(he)}if(e?.map&&(0,M.Tu)(e.map)&&e.map.utilityNetworks?.find(T=>T.isUtilityLayer(o))){const T=o.fieldsIndex.get("assetGroup")?.name,q=o.fieldsIndex.get("assetType")?.name;T&&q&&(j.push(T),j.push(q))}if(o&&c?.floorField&&e?.floors?.length){const T=r.get(c.floorField)?.name??c.floorField;T&&j.push(T)}if(g){const T=r.get(g)?.name??g;T&&j.push(T)}return new Set(j)}get configuration(){const{view:e}=this,{apiKey:t,customParameters:i}=this._layer,o=null!=e?e.type:"2d",r=this._layer.createQuery();return this._layerView&&"effectiveDisplayFilter"in this._layerView&&(r.where=(0,N.mA)(r.where,this._layerView.effectiveDisplayFilter?.where)),{filter:r,customParameters:t?{...i,token:t}:i,viewType:o}}get availability(){return this._workerHandle?.availability??0}get _layer(){return this.layerSource.layer}constructor(e){super(e),this._updatingHandles=new O.U,this._workerHandle=null,this._debug=null,this._memoizedMakeGetGroundElevation=(0,Z.B)(ne.p)}initialize(){let e;const t=this.view;if(null==t||t.destroyed)this._tilesOfInterest=new B({layer:this._layer}),e=this._workerHandle=new x;else switch(t.type){case"2d":this._tilesOfInterest=new w({view:t,layer:this._layer}),e=this._workerHandle=new x;break;case"3d":{const{resourceController:i}=t,o=this._layer;this._tilesOfInterest=new E({view:t}),e=this._workerHandle=new x({schedule:r=>i.immediate.schedule(r),hasZ:this._layer.hasZ&&(this._layer.returnZ??!0),elevationAlignPointsInFeatures:(r=(0,m.A)(function*(l,c){const g=yield t.whenLayerView(o);return(0,s.Te)(c),g.elevationAlignPointsInFeatures(l,c)}),function(c,g){return r.apply(this,arguments)}),queryForSymbologySnapping:function(){var r=(0,m.A)(function*(l,c){const g=yield t.whenLayerView(o);return(0,s.Te)(c),g.queryForSymbologySnapping(l,c)});return function(c,g){return r.apply(this,arguments)}}()}),this.addHandles([t.elevationProvider.on("elevation-change",({context:r})=>{const{elevationInfo:l}=o;(0,se.Up)(r,l)&&(0,s.QZ)(e.notifyElevationSourceChange())}),(0,f.wB)(()=>o.elevationInfo,()=>(0,s.QZ)(e.notifyElevationSourceChange()),f.Vh),(0,f.wB)(()=>this._layerView?.layer?.renderer,()=>(0,s.QZ)(e.notifySymbologyChange()),f.Vh),(0,f.wB)(()=>this._layerView?.symbologySnappingSupported??!1,r=>(0,s.QZ)(e.setSymbologySnappingSupported(r)),f.Vh),(0,f.on)(()=>this._layerView?.layer,["edits","apply-edits","graphic-update"],()=>e.notifySymbologyChange())]);break}}var r;this.addHandles([(0,v.DQ)(e)]),(0,s.QZ)(e.setup({layer:this._layer,spatialReference:this.spatialReference,configuration:this.configuration},null)),this._updatingHandles.add(()=>this._updateTilesParameters,()=>(0,s.QZ)(e.updateTiles(this._updateTilesParameters,null)),f.Vh),this.addHandles([(0,f.wB)(()=>this.configuration,i=>(0,s.QZ)(e.configure(i,null)),f.OH),(0,f.wB)(()=>this._layer.historicMoment,i=>(0,s.QZ)(e.setHistoricMoment(i)),f.pc),(0,f.wB)(()=>this._outFields,i=>(0,s.QZ)(e.updateOutFields(i)),f.Vh),(0,f.wB)(()=>this._isSuspended,i=>(0,s.QZ)(e.setSuspended(i)),f.pc)]),null!=t&&this.addHandles((0,f.wB)(()=>Ae.A.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES,i=>{i&&!this._debug?(this._debug=new re({view:t,handle:e}),this.addHandles((0,v.DQ)(this._debug),"debug")):!i&&this._debug&&this.removeHandles("debug")},f.Vh)),this.addHandles([this.layerSource.layer.on("edits",i=>(0,s.QZ)(e.handleEdits(i,null))),this.layerSource.layer.on("apply-edits",i=>this._updatingHandles.addPromise(i.result))])}destroy(){this._updatingHandles.destroy(),this._tilesOfInterest.destroy()}refresh(){this._workerHandle?.refresh(null)}fetchCandidates(e,t){var i=this;return(0,m.A)(function*(){const{coordinateHelper:o,point:r}=e;i._tilesOfInterest.pointOfInterest=o.arrayToPoint(r);const l=i._memoizedMakeGetGroundElevation(i.view,o.spatialReference);return(yield i._workerHandle.fetchCandidates({...e},t)).candidates.map(c=>(0,ne.$)(c,l))})()}getDebugInfo(e){return this._workerHandle.getDebugInfo(e)}_getOrLoadWhereFields(e,t){var i=this;const{_whereModule:o}=this;if(!this._loadWhereModuleTask&&!o){const r=(0,H.UT)((0,m.A)(function*(){const l=yield a.e(1329).then(a.bind(a,1329));return i._whereModule=l.default,i._whereModule}));return this._loadWhereModuleTask=r,this._updatingHandles.addPromise(r.promise),[]}if(!o)return[];try{return o.create(e,{fieldsIndex:t}).fieldNames}catch{return[]}}};(0,d._)([(0,u.MZ)({constructOnly:!0})],n.prototype,"spatialReference",void 0),(0,d._)([(0,u.MZ)({constructOnly:!0})],n.prototype,"layerSource",void 0),(0,d._)([(0,u.MZ)({constructOnly:!0})],n.prototype,"view",void 0),(0,d._)([(0,u.MZ)()],n.prototype,"_tilesOfInterest",void 0),(0,d._)([(0,u.MZ)({readOnly:!0})],n.prototype,"_updateTilesParameters",null),(0,d._)([(0,u.MZ)()],n.prototype,"_layerView",null),(0,d._)([(0,u.MZ)()],n.prototype,"_isSuspended",null),(0,d._)([(0,u.MZ)({readOnly:!0})],n.prototype,"updating",null),(0,d._)([(0,u.MZ)()],n.prototype,"_outFields",null),(0,d._)([(0,u.MZ)({readOnly:!0})],n.prototype,"configuration",null),(0,d._)([(0,u.MZ)({readOnly:!0})],n.prototype,"availability",null),(0,d._)([(0,u.MZ)()],n.prototype,"_loadWhereModuleTask",void 0),(0,d._)([(0,u.MZ)()],n.prototype,"_whereModule",void 0),n=(0,d._)([(0,U.$)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],n)},93151:(pe,W,a)=>{a.d(W,{_:()=>h});var m=a(28714),d=a(77171);class h extends d.m{constructor(v,Z,s){super(Z,s),this.point=v}equals(v){return v instanceof h&&(0,m.p)(this.point,v.point)}}}}]);