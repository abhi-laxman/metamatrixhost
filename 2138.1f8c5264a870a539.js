"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[2138],{40856:(q,C,n)=>{n.d(C,{X_:()=>S,i1:()=>G,oW:()=>T,zx:()=>L});var m=n(69287),a=n(82663);const F=96;function S(d,u){const p=u||d.extent,o=d.width,_=(0,a.GA)(p?.spatialReference);return p&&o?p.width/o*_*a.dy*F:0}function G(d,u){return d/((0,a.GA)(u)*a.dy*F)}function L(d,u,p){return function I(d,u){return 0===u||(0,m.Sp)(d,u)||d<u}(d,u)&&function O(d,u){return 0===u||(0,m.Sp)(d,u)||d>u}(d,p)}function T(d,u){return(0,m.Sp)(d,u)?0:(d||Number.POSITIVE_INFINITY)>(u||Number.POSITIVE_INFINITY)?1:-1}},52138:(q,C,n)=>{n.r(C),n.d(C,{default:()=>dt});var ve,m=n(10467),a=n(8189),F=n(23098),S=n(81098),G=n(92165),W=n(89563),j=n(31178),D=n(2993),L=n(5922),I=n(49976),O=n(77806),T=n(39693),d=n(56492),u=n(48900),p=n(45272),o=n(85211),_=n(55739),E=n(17221),H=n(76576),J=n(50305),Q=n(56558),X=n(28067),U=n(32034),R=n(40856),b=n(58701),w=n(95478),f=n(93410),y=n(17049),v=n(85551),M=n(1151),se=n(33036),ee=n(84311),te=n(32282),le=n(68438),ae=n(22329),de=n(2277),_e=n(63014),ie=n(3046),ke=n(48669);n(3248),n(40707);let qe=0,V=ve=class extends(ie.A.IdentifiableMixin(T.L)){constructor(e){super(e),this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.legendUrl=null,this.legendEnabled=!0,this.layer=null,this.maxScale=0,this.minScale=0,this.name=null,this.parent=null,this.popupEnabled=!1,this.queryable=!1,this.sublayers=null,this.spatialReferences=null,this.title=null,this.addHandles([(0,u.on)(()=>this.sublayers,"after-add",({item:s})=>{s.parent=this,s.layer=this.layer},u.OH),(0,u.on)(()=>this.sublayers,"after-remove",({item:s})=>{s.layer=s.parent=null},u.OH),(0,u.wB)(()=>this.sublayers,(s,i)=>{if(i)for(const l of i)l.layer=l.parent=null;if(s)for(const l of s)l.parent=this,l.layer=this.layer},u.OH),(0,u.wB)(()=>this.layer,s=>{if(this.sublayers)for(const i of this.sublayers)i.layer=s},u.OH)])}get id(){return this._get("id")??qe++}set id(e){this._set("id",e)}readLegendUrl(e,s){return s.legendUrl??s.legendURL??null}get effectiveScaleRange(){const{minScale:e,maxScale:s}=this;return{minScale:e,maxScale:s}}castSublayers(e){return(0,_.dp)(j.A.ofType(ve),e)}set visible(e){this._setAndNotifyLayer("visible",e)}clone(){const e=new ve;return this.hasOwnProperty("description")&&(e.description=this.description),this.hasOwnProperty("fullExtent")&&(e.fullExtent=this.fullExtent.clone()),this.hasOwnProperty("fullExtents")&&(e.fullExtents=this.fullExtents?.map(s=>s.clone())??null),this.hasOwnProperty("legendUrl")&&(e.legendUrl=this.legendUrl),this.hasOwnProperty("legendEnabled")&&(e.legendEnabled=this.legendEnabled),this.hasOwnProperty("layer")&&(e.layer=this.layer),this.hasOwnProperty("name")&&(e.name=this.name),this.hasOwnProperty("parent")&&(e.parent=this.parent),this.hasOwnProperty("queryable")&&(e.queryable=this.queryable),this.hasOwnProperty("sublayers")&&(e.sublayers=this.sublayers?.map(s=>s.clone())),this.hasOwnProperty("spatialReferences")&&(e.spatialReferences=this.spatialReferences?.map(s=>s)),this.hasOwnProperty("visible")&&(e.visible=this.visible),this.hasOwnProperty("title")&&(e.title=this.title),e}_setAndNotifyLayer(e,s){const i=this.layer;this._get(e)!==s&&(this._set(e,s),i&&i.emit("wms-sublayer-update",{propertyName:e,id:this.id}))}};(0,a._)([(0,o.MZ)()],V.prototype,"description",void 0),(0,a._)([(0,o.MZ)({readOnly:!0})],V.prototype,"dimensions",void 0),(0,a._)([(0,o.MZ)({type:X.A,json:{name:"extent"}})],V.prototype,"fullExtent",void 0),(0,a._)([(0,o.MZ)()],V.prototype,"fullExtents",void 0),(0,a._)([(0,o.MZ)({type:Number,json:{write:{enabled:!1,overridePolicy:()=>({ignoreOrigin:!0,enabled:!0})}}})],V.prototype,"id",null),(0,a._)([(0,o.MZ)({type:String,json:{name:"legendUrl",write:{ignoreOrigin:!0}}})],V.prototype,"legendUrl",void 0),(0,a._)([(0,E.w)("legendUrl",["legendUrl","legendURL"])],V.prototype,"readLegendUrl",null),(0,a._)([(0,o.MZ)({type:Boolean,json:{name:"showLegend",origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],V.prototype,"legendEnabled",void 0),(0,a._)([(0,o.MZ)()],V.prototype,"layer",void 0),(0,a._)([(0,o.MZ)()],V.prototype,"maxScale",void 0),(0,a._)([(0,o.MZ)()],V.prototype,"minScale",void 0),(0,a._)([(0,o.MZ)({readOnly:!0})],V.prototype,"effectiveScaleRange",null),(0,a._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],V.prototype,"name",void 0),(0,a._)([(0,o.MZ)()],V.prototype,"parent",void 0),(0,a._)([(0,o.MZ)({type:Boolean,json:{read:{source:"showPopup"},write:{ignoreOrigin:!0,target:"showPopup"}}})],V.prototype,"popupEnabled",void 0),(0,a._)([(0,o.MZ)({type:Boolean,json:{write:{ignoreOrigin:!0}}})],V.prototype,"queryable",void 0),(0,a._)([(0,o.MZ)()],V.prototype,"sublayers",void 0),(0,a._)([(0,ke.w)("sublayers")],V.prototype,"castSublayers",null),(0,a._)([(0,o.MZ)({type:[Number],json:{read:{source:"spatialReferences"}}})],V.prototype,"spatialReferences",void 0),(0,a._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],V.prototype,"title",void 0),(0,a._)([(0,o.MZ)({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"}}})],V.prototype,"visible",null),V=ve=(0,a._)([(0,H.$)("esri.layers.support.WMSSublayer")],V);const Oe=V;var pe=n(89952),De=n(44549);const Ue={84:4326,83:4269,27:4267};function et(e){if(!e)return null;const s={idCounter:-1};"string"==typeof e&&(e=(new DOMParser).parseFromString(e,"text/xml"));const i=e.documentElement;if("ServiceExceptionReport"===i.nodeName){const k=Array.prototype.slice.call(i.childNodes).map(he=>he.textContent).join("\r\n");throw new L.A("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",k)}const l=z("Capability",i),c=z("Service",i),g=l&&z("Request",l);if(!l||!c||!g)return null;const h=z("Layer",l);if(!h)return null;const A="WMS_Capabilities"===i.nodeName||"WMT_MS_Capabilities"===i.nodeName?i.getAttribute("version"):"1.3.0",K=ne("Title",c,"")||ne("Name",c,""),Z=ne("AccessConstraints",c,""),P=/^none$/i.test(Z)?"":Z,N=ne("Abstract",c,""),$=parseInt(ne("MaxWidth",c,"5000"),10),B=parseInt(ne("MaxHeight",c,"5000"),10),re=je(g,"GetMap"),oe=Ce(g,"GetMap"),Y=ye(h,A,s);if(!Y)return null;let ce,fe=0;const pt=Array.prototype.slice.call(l.childNodes),mt=Y.sublayers??[],Te=k=>{null!=k&&mt.push(k)};pt.forEach(k=>{"Layer"===k.nodeName&&(0===fe?ce=k:(1===fe&&Y.name&&(Y.name="",Te(ye(ce,A,s))),Te(ye(k,A,s))),fe++)});const Me=Y.sublayers??[],yt=Y.fullExtents??[];0===Me.length&&Me.push(Y),Y.extent??=Me[0].extent;const ft=Y.spatialReferences.length>0?Y.spatialReferences:Re(Y),Je=Ce(g,"GetFeatureInfo"),ht=Je?je(g,"GetFeatureInfo"):null,Xe=be(Me),_t=Y.minScale||0,vt=Y.maxScale||0,Ye=Y.dimensions??[],gt=Xe.reduce((k,he)=>k.concat(he.dimensions??[]),[]),Qe=Ye.concat(gt).filter(Pe);let ze=null;if(Qe.length){const k=Qe.map(he=>{const{extent:xe}=he;return function nt(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}(xe)?xe.map(Ie=>Ie.getTime()):xe?.map(Ie=>[Ie.min.getTime(),Ie.max.getTime()])}).flat(2).filter(pe.Ru);ze={startTimeField:null,endTimeField:null,trackIdField:void 0,timeExtent:[Math.min(...k),Math.max(...k)]}}return{copyright:P,description:N,dimensions:Ye,extent:Y.extent,fullExtents:yt,featureInfoFormats:ht,featureInfoUrl:Je,mapUrl:oe,maxWidth:$,maxHeight:B,maxScale:vt,minScale:_t,layers:Xe,spatialReferences:ft,supportedImageFormatTypes:re,timeInfo:ze,title:K,version:A}}function Re(e){if(e.spatialReferences.length>0)return e.spatialReferences;if(e.sublayers)for(const s of e.sublayers){const i=Re(s);if(i.length>0)return i}return[]}function be(e){let s=[];for(const i of e)s.push(i),i.sublayers?.length&&(s=s.concat(be(i.sublayers)),delete i.sublayers);return s}function ge(e,s,i){return s.getAttribute(e)??i}function z(e,s){for(let i=0;i<s.childNodes.length;i++){const l=s.childNodes[i];if(Be(l)&&l.nodeName===e)return l}return null}function Ee(e,s){if(null==s)return[];const i=[];for(let l=0;l<s.childNodes.length;l++){const c=s.childNodes[l];Be(c)&&c.nodeName===e&&i.push(c)}return i}function ne(e,s,i){return z(e,s)?.textContent??i}function me(e,s,i){if(!e)return null;const l=parseFloat(e.getAttribute("minx")),c=parseFloat(e.getAttribute("miny")),g=parseFloat(e.getAttribute("maxx")),h=parseFloat(e.getAttribute("maxy"));let A,K,Z,P;return i?(A=isNaN(c)?-Number.MAX_VALUE:c,K=isNaN(l)?-Number.MAX_VALUE:l,Z=isNaN(h)?Number.MAX_VALUE:h,P=isNaN(g)?Number.MAX_VALUE:g):(A=isNaN(l)?-Number.MAX_VALUE:l,K=isNaN(c)?-Number.MAX_VALUE:c,Z=isNaN(g)?Number.MAX_VALUE:g,P=isNaN(h)?Number.MAX_VALUE:h),{xmin:A,ymin:K,xmax:Z,ymax:P,spatialReference:{wkid:s}}}function Ce(e,s){const i=z(s,e);if(i){const l=z("DCPType",i);if(l){const c=z("HTTP",l);if(c){const g=z("Get",c);if(g){let h=function rt(e,s,i,l){const c=z(e,i);return c?ge(s,c,l):l}("OnlineResource","xlink:href",g,null);if(h){const A=h.indexOf("&");return-1!==A&&A===h.length-1&&(h=h.slice(0,-1)),function st(e,s){const i=[],l=(0,p.An)(e);for(const c in l.query)l.query.hasOwnProperty(c)&&(s.includes(c.toLowerCase())||i.push(c+"="+l.query[c]));return l.path+(i.length?"?"+i.join("&"):"")}(h,["service","request"])}}}}}return null}function je(e,s){const i=Ee("Operation",e);if(!i.length)return Ee("Format",z(s,e)).map(({textContent:c})=>c).filter(pe.Ru);const l=[];for(const c of i)if(c.getAttribute("name")===s){const g=Ee("Format",c);for(const{textContent:h}of g)null!=h&&l.push(h)}return l}function we(e,s,i){const l=z(s,e);if(!l)return i;const{textContent:c}=l;if(null==c||""===c)return i;const g=Number(c);return isNaN(g)?i:g}function ye(e,s,i){if(!e)return null;const l=e.getAttribute("queryable")?.toLowerCase(),c="1"===l||"true"===l,g={id:i.idCounter++,fullExtents:[],parentLayerId:null,queryable:c,spatialReferences:[],sublayers:null},h=z("LatLonBoundingBox",e),A=z("EX_GeographicBoundingBox",e);let K=null;h&&(K=me(h,4326)),A&&(K=new X.A(0,0,0,0,new U.A({wkid:4326})),K.xmin=parseFloat(ne("westBoundLongitude",A,"0")),K.ymin=parseFloat(ne("southBoundLatitude",A,"0")),K.xmax=parseFloat(ne("eastBoundLongitude",A,"0")),K.ymax=parseFloat(ne("northBoundLatitude",A,"0"))),h||A||(K=new X.A(-180,-90,180,90,new U.A({wkid:4326}))),g.minScale=we(e,"MaxScaleDenominator",0),g.maxScale=we(e,"MinScaleDenominator",0);const Z=["1.0.0","1.1.0","1.1.1"].includes(s)?"SRS":"CRS";return Array.prototype.slice.call(e.childNodes).forEach(P=>{if("Name"===P.nodeName)g.name=P.textContent||"";else if("Title"===P.nodeName)g.title=P.textContent||"";else if("Abstract"===P.nodeName)g.description=P.textContent||"";else if("BoundingBox"===P.nodeName){const N=P.getAttribute(Z);if(N&&0===N.indexOf("EPSG:")){const B=parseInt(N.slice(5),10);0===B||isNaN(B)||K||(K="1.3.0"===s?me(P,B,(0,te.m)(B)):me(P,B))}const $=N?.indexOf(":");if($&&$>-1){let B=parseInt(N.slice($+1),10);0===B||isNaN(B)||(B=Ue[B]??B);const re="1.3.0"===s?me(P,B,(0,te.m)(B)):me(P,B);re&&g.fullExtents&&g.fullExtents.push(re)}}else if(P.nodeName===Z)(P.textContent?.split(" ")??[]).forEach(N=>{let $=NaN;if(N.includes(":")){const[B,re]=N.toUpperCase().split(":");"CRS"!==B&&"EPSG"!==B||($=parseInt(re,10))}else $=parseInt(N,10);if(0!==$&&!isNaN($)){const B=Ue[$]??$;g.spatialReferences.includes(B)||g.spatialReferences.push(B)}});else if("Style"!==P.nodeName||g.legendUrl){if("Layer"===P.nodeName){const N=ye(P,s,i);N&&(N.parentLayerId=g.id,g.sublayers||(g.sublayers=[]),g.sublayers.push(N))}}else{const N=z("LegendURL",P);if(N){const $=z("OnlineResource",N);$&&(g.legendUrl=$.getAttribute("xlink:href"))}}}),g.extent=K,g.dimensions=Ee("Dimension",e).filter(P=>P.getAttribute("name")&&P.getAttribute("units")&&P.textContent).map(P=>{const N=P.getAttribute("name"),$=P.getAttribute("units"),B=P.textContent,re=P.getAttribute("unitSymbol")??void 0,oe=P.getAttribute("default")??void 0,Y="0"!==ge("default",P,"0"),ce="0"!==ge("nearestValue",P,"0"),fe="0"!==ge("current",P,"0");return Pe({name:N,units:$})?{name:"time",units:"ISO8601",extent:Fe(B),default:Fe(oe),multipleValues:Y,nearestValue:ce,current:fe}:function We(e){return/^elevation$/i.test(e.name)&&/^(epsg|crs):\d+$/i.test(e.units)}({name:N,units:$})?{name:"elevation",units:$,extent:Ke(B),unitSymbol:re,default:Ke(oe),multipleValues:Y,nearestValue:ce}:{name:N,units:$,extent:Ne(B),unitSymbol:re,default:Ne(oe),multipleValues:Y,nearestValue:ce}}),g}function Be(e){return e.nodeType===Node.ELEMENT_NODE}function Pe(e){return/^time$/i.test(e.name)&&/^iso8601$/i.test(e.units)}function Ke(e){if(!e)return;const s=e.includes("/"),i=e.split(",");return s?i.map(l=>{const c=l.split("/");return c.length<2?null:{min:parseFloat(c[0]),max:parseFloat(c[1]),resolution:c.length>=3&&"0"!==c[2]?parseFloat(c[2]):void 0}}).filter(pe.Ru):i.map(l=>parseFloat(l))}function Ne(e){if(!e)return;const s=e.includes("/"),i=e.split(",");return s?i.map(l=>{const c=l.split("/");return c.length<2?null:{min:c[0],max:c[1],resolution:c.length>=3&&"0"!==c[2]?c[2]:void 0}}).filter(pe.Ru):i}function Fe(e){if(!e)return;const s=e.includes("/"),i=e.split(",");return s?i.map(l=>{const c=l.split("/");return c.length<2?null:{min:Le(c[0]),max:Le(c[1]),resolution:c.length>=3&&"0"!==c[2]?it(c[2]):void 0}}).filter(pe.Ru):i.map(l=>Le(l))}function Le(e){return De.c9.fromISO(e,{zone:De.mQ.utcInstance}).toJSDate()}function it(e){const i=e.match(/(?:p(\d+y|\d+(?:\.|,)\d+y)?(\d+m|\d+(?:\.|,)\d+m)?(\d+d|\d+(?:\.|,)\d+d)?)?(?:t(\d+h|\d+(?:\.|,)\d+h)?(\d+m|\d+(?:\.|,)\d+m)?(\d+s|\d+(?:\.|,)\d+s)?)?/i);return i?{years:ue(i[1]),months:ue(i[2]),days:ue(i[3]),hours:ue(i[4]),minutes:ue(i[5]),seconds:ue(i[6])}:null}function ue(e){if(!e)return 0;const i=e.match(/(?:\d+(?:\.|,)\d+|\d+)/);if(!i)return 0;const l=i[0].replace(",",".");return Number(l)}function Ae(e){return e.toISOString().replace(/\.[0-9]{3}/,"")}function Ge(e){if(!e||e.isAllTime||e.isEmpty)return;const{start:s,end:i}=e;return s&&i&&s.getTime()===i.getTime()?`${Ae(s)}`:`${s?Ae(s):"0000-01-01T00:00:00Z"}/${i?Ae(i):"9999-12-31T23:59:59Z"}`}const Ze=new Set([102100,3857,102113,900913]),lt=new Set([3395,54004]),Se=new I.J({bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},{ignoreUnknown:!1});function $e(e){return"text/html"===e}function Ve(e){return"text/plain"===e}let x=class extends((0,f.dM)((0,ee.e)((0,M.J)((0,se.j)((0,y.q)((0,v.A)((0,T.P)(w.A)))))))){constructor(...e){super(...e),this.allSublayers=new D.A({getCollections:()=>[this.sublayers],getChildrenFunction:s=>s.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormats=null,this.featureInfoUrl=null,this.fetchFeatureInfoFunction=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType="WMS",this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type="wms",this.version=null,this.addHandles([(0,u.on)(()=>this.sublayers,"after-add",({item:s})=>{s.parent=s.layer=this},u.OH),(0,u.on)(()=>this.sublayers,"after-remove",({item:s})=>{s.layer=s.parent=null},u.OH),(0,u.wB)(()=>this.sublayers,(s,i)=>{if(i)for(const l of i)l.layer=l.parent=null;if(s)for(const l of s)l.parent=l.layer=this},u.OH)])}normalizeCtorArgs(e,s){return"string"==typeof e?{url:e,...s}:e}destroy(){this.allSublayers.destroy()}load(e){const s=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]},e).catch(d.QP).then(()=>this._fetchService(s)).then(()=>this._checkLayerValidity())),Promise.resolve(this)}readFullExtentFromItemOrMap(e,s){const i=s.extent;return i?new X.A({xmin:i[0][0],ymin:i[0][1],xmax:i[1][0],ymax:i[1][1]}):null}writeFullExtent(e,s){s.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}get featureInfoFormat(){return null==this.featureInfoFormats?null:this.featureInfoFormats.find($e)??this.featureInfoFormats.find(Ve)??null}set featureInfoFormat(e){null==e?(this.revert("featureInfoFormat","service"),this._clearOverride("featureInfoFormat")):($e(e)||Ve(e))&&this._override("featureInfoFormat",e)}readImageFormat(e,s){const i=s.supportedImageFormatTypes;return i&&i.includes("image/png")?"image/png":i&&i[0]}readSpatialReferenceFromItemOrDocument(e,s){return new U.A(s.spatialReferences[0])}writeSpatialReferences(e,s){const i=this.spatialReference?.wkid;e&&i?(s.spatialReferences=e.filter(l=>l!==i),s.spatialReferences.unshift(i)):s.spatialReferences=e}readSublayersFromItemOrMap(e,s,i){return He(s.layers,i,s.visibleLayers)}readSublayers(e,s,i){return He(s.layers,i)}writeSublayers(e,s,i,l){s.layers=[];const c=new Map,g=e.flatten(({sublayers:h})=>h??[]);for(const h of g)if("number"==typeof h.parent?.id){const A=c.get(h.parent.id);null!=A?A.push(h.id):c.set(h.parent.id,[h.id])}for(const h of g){const A={sublayer:h,...l},K=h.write({parentLayerId:"number"==typeof h.parent?.id?h.parent.id:-1},A);if(c.has(h.id)&&(K.sublayerIds=c.get(h.id)),!h.sublayers&&h.name){const Z=h.write({},A);delete Z.id,s.layers.push(Z)}}s.visibleLayers=g.filter(({visible:h,sublayers:A})=>h&&!A).map(({name:h})=>h).toArray()}set url(e){if(!e)return void this._set("url",e);const{path:s,query:i}=(0,p.An)(e);for(const c in i)/^(request|service)$/i.test(c)&&delete i[c];const l=(0,p.a6)(s,i??{});this._set("url",l)}createExportImageParameters(e,s,i,l){const c=l?.pixelRatio??1,g=(0,R.X_)({extent:e,width:s})*c,h=new de.r({layer:this,scale:g}),{xmin:A,ymin:K,xmax:Z,ymax:P,spatialReference:N}=e,$=function ut(e,s){let i=e.wkid;return null==s?i:(null!=i&&s.includes(i)||!e.latestWkid||(i=e.latestWkid),null!=i&&Ze.has(i)?s.find(l=>Ze.has(l))||s.find(l=>lt.has(l))||102100:i)}(N,this.spatialReferences),B="1.3.0"===this.version&&(0,te.m)($)?`${K},${A},${P},${Z}`:`${A},${K},${Z},${P}`,re=h.toJSON();return{bbox:B,["1.3.0"===this.version?"crs":"srs"]:null==$||isNaN($)?void 0:"EPSG:"+$,...re}}fetchImage(e,s,i,l){var c=this;return(0,m.A)(function*(){const g=c.mapUrl,h=c.createExportImageParameters(e,s,i,l);if(!h.layers){const Z=document.createElement("canvas");return Z.width=s,Z.height=i,Z}const A=Ge(l?.timeExtent),K={responseType:"image",query:c._mixCustomParameters({width:s,height:i,...h,time:A,...c.refreshParameters}),signal:l?.signal};return(0,W.A)(g??"",K).then(Z=>Z.data)})()}fetchImageBitmap(e,s,i,l){var c=this;return(0,m.A)(function*(){const g=c.mapUrl??"",h=c.createExportImageParameters(e,s,i,l);if(!h.layers){const P=document.createElement("canvas");return P.width=s,P.height=i,P}const A=Ge(l?.timeExtent),K={responseType:"blob",query:c._mixCustomParameters({width:s,height:i,...h,time:A,...c.refreshParameters}),signal:l?.signal},{data:Z}=yield(0,W.A)(g,K);return(0,_e.m)(Z,g,l?.signal)})()}fetchFeatureInfo(e,s,i,l,c){const g=(0,R.X_)({extent:e,width:s}),A=function tt(e){const s=e.filter(i=>i.popupEnabled&&i.name&&i.queryable);return s.length?s.map(({name:i})=>i).join():null}(new de.r({layer:this,scale:g}).visibleSublayers);if(null==this.featureInfoUrl||null==A)return Promise.resolve([]);if(null==this.fetchFeatureInfoFunction&&null==this.featureInfoFormat)return Promise.resolve([]);const Z={query_layers:A,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:s,height:i,..."1.3.0"===this.version?{I:l,J:c}:{x:l,y:c}},P={...this.createExportImageParameters(e,s,i),...Z},N=this._mixCustomParameters(P);return null!=this.fetchFeatureInfoFunction?this.fetchFeatureInfoFunction(N):this._defaultFetchFeatureInfoFunction((0,p.a6)(this.featureInfoUrl,N))}findSublayerById(e){return this.allSublayers.find(s=>s.id===e)}findSublayerByName(e){return this.allSublayers.find(s=>s.name===e)}serviceSupportsSpatialReference(e){return(0,le.bd)(this.url)||null!=this.spatialReferences&&this.spatialReferences.some(s=>{const i=900913===s?U.A.WebMercator:new U.A({wkid:s});return(0,b.aI)(i,e)})}_defaultFetchFeatureInfoFunction(e){const s=document.createElement("iframe");s.src=(0,p.yM)(e),s.style.border="none",s.style.margin="0",s.style.width="100%",s.setAttribute("sandbox","");const i=new G.A({title:this.title,content:s}),l=new S.A({sourceLayer:this,popupTemplate:i});return Promise.resolve([l])}_fetchService(e){var s=this;return(0,m.A)(function*(){if(!s.resourceInfo&&s.parsedUrl?.path){const{path:i,query:l}=s.parsedUrl,{data:c}=yield(0,W.A)(i,{query:{SERVICE:"WMS",REQUEST:"GetCapabilities",...l,...s.customParameters},responseType:"xml",signal:e});s.resourceInfo=et(c)}if(s.parsedUrl){const i=new p.s0(s.parsedUrl.path),{httpsDomains:l}=F.A.request;"https"!==i.scheme||i.port&&"443"!==i.port||!i.host||l.includes(i.host)||l.push(i.host)}s.read(s.resourceInfo,{origin:"service"})})()}_checkLayerValidity(){if(!this.allSublayers.length)throw new L.A("wmslayer:empty-layer","The layer doesn't have any sublayer")}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;const s={...this.customParameters,...this.customLayerParameters};for(const i in s)e[i.toLowerCase()]=s[i];return e}};function He(e,s,i){e=e??[];const l=new Map;e.every(g=>null==g.id)&&(e=(0,O.o8)(e)).forEach((g,h)=>g.id=h);for(const g of e){const h=new Oe;h.read(g,s),i&&!i.includes(h.name)&&(h.visible=!1),l.set(h.id,h)}const c=[];for(const g of e){const h=null!=g.id?l.get(g.id):null;if(h)if(null!=g.parentLayerId&&g.parentLayerId>=0){const A=l.get(g.parentLayerId);if(!A)continue;A.sublayers||(A.sublayers=new j.A),A.sublayers.push(h)}else c.push(h)}return c}(0,a._)([(0,o.MZ)({readOnly:!0})],x.prototype,"allSublayers",void 0),(0,a._)([(0,o.MZ)({json:{type:Object,write:!0}})],x.prototype,"customParameters",void 0),(0,a._)([(0,o.MZ)({json:{type:Object,write:!0}})],x.prototype,"customLayerParameters",void 0),(0,a._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"copyright",void 0),(0,a._)([(0,o.MZ)()],x.prototype,"description",void 0),(0,a._)([(0,o.MZ)({readOnly:!0})],x.prototype,"dimensions",void 0),(0,a._)([(0,o.MZ)({json:{type:[[Number]],read:{source:"extent"},write:{target:"extent"},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],x.prototype,"fullExtent",void 0),(0,a._)([(0,E.w)(["web-document","portal-item"],"fullExtent",["extent"])],x.prototype,"readFullExtentFromItemOrMap",null),(0,a._)([(0,J.K)(["web-document","portal-item"],"fullExtent",{extent:{type:[[Number]]}})],x.prototype,"writeFullExtent",null),(0,a._)([(0,o.MZ)({type:[X.A]})],x.prototype,"fullExtents",void 0),(0,a._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],x.prototype,"featureInfoFormat",null),(0,a._)([(0,o.MZ)({type:[String],readOnly:!0})],x.prototype,"featureInfoFormats",void 0),(0,a._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],x.prototype,"featureInfoUrl",void 0),(0,a._)([(0,o.MZ)()],x.prototype,"fetchFeatureInfoFunction",void 0),(0,a._)([(0,o.MZ)({type:String,json:{origins:{"web-document":{default:"image/png",type:Se.jsonValues,read:{reader:Se.read,source:"format"},write:{writer:Se.write,target:"format"}}}}})],x.prototype,"imageFormat",void 0),(0,a._)([(0,E.w)("imageFormat",["supportedImageFormatTypes"])],x.prototype,"readImageFormat",null),(0,a._)([(0,o.MZ)({type:Number,json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],x.prototype,"imageMaxHeight",void 0),(0,a._)([(0,o.MZ)({type:Number,json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],x.prototype,"imageMaxWidth",void 0),(0,a._)([(0,o.MZ)()],x.prototype,"imageTransparency",void 0),(0,a._)([(0,o.MZ)(ae.fV)],x.prototype,"legendEnabled",void 0),(0,a._)([(0,o.MZ)({type:["show","hide","hide-children"]})],x.prototype,"listMode",void 0),(0,a._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],x.prototype,"mapUrl",void 0),(0,a._)([(0,o.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],x.prototype,"isReference",void 0),(0,a._)([(0,o.MZ)({type:["WMS"]})],x.prototype,"operationalLayerType",void 0),(0,a._)([(0,o.MZ)()],x.prototype,"resourceInfo",void 0),(0,a._)([(0,o.MZ)({type:U.A,json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],x.prototype,"spatialReference",void 0),(0,a._)([(0,E.w)(["web-document","portal-item"],"spatialReference",["spatialReferences"])],x.prototype,"readSpatialReferenceFromItemOrDocument",null),(0,a._)([(0,o.MZ)({type:[_.jz],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],x.prototype,"spatialReferences",void 0),(0,a._)([(0,J.K)(["web-document","portal-item"],"spatialReferences")],x.prototype,"writeSpatialReferences",null),(0,a._)([(0,o.MZ)({type:j.A.ofType(Oe),json:{write:{target:"layers",overridePolicy(e,s,i){if(function ct(e,s){return e.some(i=>{for(const l in i)if((0,Q.R)(i,l,null,s))return!0;return!1})}(this.allSublayers,i))return{ignoreOrigin:!0}}}}})],x.prototype,"sublayers",void 0),(0,a._)([(0,E.w)(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],x.prototype,"readSublayersFromItemOrMap",null),(0,a._)([(0,E.w)("service","sublayers",["layers"])],x.prototype,"readSublayers",null),(0,a._)([(0,J.K)("sublayers",{layers:{type:[Oe]},visibleLayers:{type:[String]}})],x.prototype,"writeSublayers",null),(0,a._)([(0,o.MZ)({json:{read:!1},readOnly:!0,value:"wms"})],x.prototype,"type",void 0),(0,a._)([(0,o.MZ)(ae.OZ)],x.prototype,"url",null),(0,a._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0}}})],x.prototype,"version",void 0),x=(0,a._)([(0,H.$)("esri.layers.WMSLayer")],x);const dt=x},72211:(q,C,n)=>{n.d(C,{LF:()=>G,M9:()=>W,zu:()=>I});var m=n(5922),a=n(89221),F=n(79845),S=n(26073);function G(d,u,p){try{return function D(d){if(!d||0===d.length)return null;if(function L(d){const u=d[0];return!!u&&"scale"in u}(d)){const u=[];for(const p of d)u.push({scale:p.scale,value:I(p.value)});return u}return I(d)}(d)}catch(o){p?.messages?.push(o)}return null}function W(d,u,p,o){try{const _=function j(d){const u=(0,F.q)(d);return u?(0,S.dw)(u)?u.map(p=>p.toJSON()):u.map(({scale:p,effects:o})=>({scale:p,value:o.map(_=>_.toJSON())})):null}(d);(0,a.sM)(p,_,u)}catch(_){o.messages&&o.messages.push(_)}}function I(d){if(!d?.length)return"";const u=[];for(const p of d){let o=[];switch(p.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":o=[O(p,"amount")];break;case"blur":o=[O(p,"radius","pt")];break;case"hue-rotate":o=[O(p,"angle","deg")];break;case"drop-shadow":o=[O(p,"xoffset","pt"),O(p,"yoffset","pt"),O(p,"blurRadius","pt"),T(p,"color")];break;case"bloom":o=[O(p,"strength"),O(p,"radius","pt"),O(p,"threshold")]}const _=`${p.type}(${o.filter(Boolean).join(" ")})`;(0,F.q)(_),u.push(_)}return u.join(" ")}function O(d,u,p){if(null==d[u])throw new m.A("effect:missing-parameter",`Missing parameter '${u}' in ${d.type} effect`,{effect:d});return p?d[u]+p:""+d[u]}function T(d,u){if(null==d[u])throw new m.A("effect:missing-parameter",`Missing parameter '${u}' in ${d.type} effect`,{effect:d});const p=d[u];return`rgba(${p[0]||0}, ${p[1]||0}, ${p[2]||0}, ${p[3]/255||0})`}},93410:(q,C,n)=>{n.d(C,{LF:()=>O,dM:()=>T,sU:()=>L});var m=n(8189),a=n(85211),W=(n(3248),n(35150),n(40707),n(76576)),j=n(50501),D=n(72211);const L={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:{layerContainerTypes:j.K}},"portal-item":{read:!0,write:{layerContainerTypes:j.K}}}}},I={read:{reader:D.LF},write:{allowNull:!0,writer:D.M9,layerContainerTypes:j.K}},O={json:{read:!1,write:!1,origins:{"web-map":I,"portal-item":I}}},T=d=>{let u=class extends d{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,m._)([(0,a.MZ)(L)],u.prototype,"blendMode",void 0),(0,m._)([(0,a.MZ)(O)],u.prototype,"effect",void 0),u=(0,m._)([(0,W.$)("esri.layers.mixins.BlendLayer")],u),u}},17049:(q,C,n)=>{n.d(C,{q:()=>J});var m=n(8189),a=n(5922),F=n(45272),S=n(85211),G=n(55739),D=(n(3248),n(40707),n(17221)),L=n(76576),I=n(50305),O=n(50501),T=n(34813),d=n(56558);const u={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},p={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},o={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},_={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,Object3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WCS:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WCS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":u,"web-map/basemap":p,"web-map/tables":o,"link-chart/operational-layers":{...u,LinkChartLayer:!0},"link-chart/basemap":p,"link-chart/tables":o,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0,WCS:!0},"portal-item/tables":{ArcGISFeatureLayer:!0,SubtypeGroupTable:!0}};var E=n(22329),H=n(17181);const J=X=>{let U=class extends X{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(R,b,w){return"Group Layer"===w?.portalItem?.type?void 0:R}writeListMode(R,b,w,f){(f&&"ground"===f.layerContainerType||R&&(0,d.R)(this,w,{},f))&&(b[w]=R)}writeOperationalLayerType(R,b,w){R&&(b[w]=R)}writeTitle(R,b){b.title=R??"Layer"}readVisibilityTimeExtent(R){return R?H.A.fromArray(R):null}writeVisibilityTimeExtent(R,b,w,f){R&&"tables"!==f.layerContainerType&&(R.isEmpty?f?.messages&&f.messages.push(new a.A("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):b[w]=R.toArray())}read(R,b){b&&(b.layer=this),(0,T.t)(this,R,w=>super.read(R,w),b)}write(R,b){if(!this.persistenceEnabled&&!b?.ignorePersistenceEnabled)return null;if(b?.origin){const y=`${b.origin}/${b.layerContainerType||"operational-layers"}`;let M=!!_[y]?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===y&&(M=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===y&&(M=!1),!M)return b.messages?.push(new a.A("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${y}'`,{layer:this})),null}const w=super.write(R,{...b,layer:this}),f=!!b&&!!b.messages&&!!b.messages.filter(y=>y instanceof a.A&&"web-document-write:property-required"===y.name).length;return(0,F.w8)(w?.url)?(b?.messages?.push(new a.A("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&f?null:w}beforeSave(){}};return(0,m._)([(0,S.MZ)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],U.prototype,"id",void 0),(0,m._)([(0,D.w)("id",["id"])],U.prototype,"readId",null),(0,m._)([(0,S.MZ)(E.C1)],U.prototype,"listMode",void 0),(0,m._)([(0,I.K)("listMode")],U.prototype,"writeListMode",null),(0,m._)([(0,S.MZ)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:O.K,isRequired:!0}}}}})],U.prototype,"operationalLayerType",void 0),(0,m._)([(0,I.K)("operationalLayerType")],U.prototype,"writeOperationalLayerType",null),(0,m._)([(0,S.MZ)(E.ke)],U.prototype,"opacity",void 0),(0,m._)([(0,S.MZ)({type:Boolean,readOnly:!1})],U.prototype,"persistenceEnabled",void 0),(0,m._)([(0,S.MZ)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],U.prototype,"title",void 0),(0,m._)([(0,I.K)("title"),(0,I.K)(["web-scene"],"title")],U.prototype,"writeTitle",null),(0,m._)([(0,S.MZ)({type:H.A,json:{origins:{"web-scene":{write:{layerContainerTypes:O.K}}}}})],U.prototype,"visibilityTimeExtent",void 0),(0,m._)([(0,D.w)("visibilityTimeExtent")],U.prototype,"readVisibilityTimeExtent",null),(0,m._)([(0,I.K)(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[G.jz,G.Uv]]}})],U.prototype,"writeVisibilityTimeExtent",null),(0,m._)([(0,S.MZ)({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:O.K}}})],U.prototype,"visible",void 0),U=(0,m._)([(0,L.$)("esri.layers.mixins.OperationalLayer")],U),U}},85551:(q,C,n)=>{n.d(C,{A:()=>U});var m=n(10467),a=n(8189),F=n(23098),S=n(77469),G=n(89563),W=n(89447),j=n(5922),D=n(35150),L=n(11432),I=n(56492),O=n(45272),T=n(85211),p=(n(3248),n(40707),n(17221)),o=n(76576),_=n(50305),E=n(58443),H=n(73874),J=n(46577),Q=n(52606),X=n(69927);const U=b=>{let w=class extends b{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,L.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(f){f!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",f))}readPortalItem(f,y,v){if(y.itemId)return new J.default({id:y.itemId,portal:v?.portal})}writePortalItem(f,y){f?.id&&(y.itemId=f.id)}loadFromPortal(f,y){var v=this;return(0,m.A)(function*(){if(v.portalItem?.id)try{const{load:M}=yield Promise.all([n.e(2076),n.e(6180)]).then(n.bind(n,56180));return(0,I.Te)(y),yield M({instance:v,supportedTypes:f.supportedTypes,validateItem:f.validateItem,supportsData:f.supportsData,layerModuleTypeMap:f.layerModuleTypeMap,populateGroupLayer:f.populateGroupLayer},y)}catch(M){throw(0,I.zf)(M)||D.A.getLogger(v).warn(`Failed to load layer (${v.title}, ${v.id}) portal item (${v.portalItem.id})\n  ${M}`),M}})()}finishLoadEditablePortalLayer(f){var y=this;return(0,m.A)(function*(){y._set("userHasEditingPrivileges",yield y._fetchUserHasEditingPrivileges(f).catch(v=>((0,I.QP)(v),!0)))})()}setUserPrivileges(f,y){var v=this;return(0,m.A)(function*(){if(!F.A.userPrivilegesApplied)return v.finishLoadEditablePortalLayer(y);if(v.url)try{const{features:{edit:M,fullEdit:se},content:{updateItem:ee}}=yield v._fetchUserPrivileges(f,y);v._set("userHasEditingPrivileges",M),v._set("userHasFullEditingPrivileges",se),v._set("userHasUpdateItemPrivileges",ee)}catch(M){(0,I.QP)(M)}})()}_fetchUserPrivileges(f,y){var v=this;return(0,m.A)(function*(){let M=v.portalItem;if(!f||!M||!M.loaded||M.sourceUrl)return v._fetchFallbackUserPrivileges(y);const se=!S.id?.findCredential(v.url),ee=f===M.id;if(ee&&M.portal.user)return v._getUserPrivileges(M,se);let te,le;if(ee)te=M.portal.url;else try{te=yield(0,E.wI)(v.url,y)}catch(ie){(0,I.QP)(ie)}if(!te||!(0,O.b8)(te,M.portal.url))return v._fetchFallbackUserPrivileges(y);try{const ie=null!=y?y.signal:null;le=yield S.id?.getCredential(`${te}/sharing`,{prompt:!1,signal:ie})}catch(ie){(0,I.QP)(ie)}if(!le)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(ee?yield M.reload():(M=new J.default({id:f,portal:{url:te}}),yield M.load(y)),M.portal.user)return v._getUserPrivileges(M,se)}catch(ie){(0,I.QP)(ie)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_getUserPrivileges(f,y){const v=(0,X.It)(f);return y&&(v.features.edit=!0),v}_fetchFallbackUserPrivileges(f){var y=this;return(0,m.A)(function*(){let v=!0;try{v=yield y._fetchUserHasEditingPrivileges(f)}catch(M){(0,I.QP)(M)}return{features:{edit:v,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(f){var y=this;return(0,m.A)(function*(){const v=y.url?S.id?.findCredential(y.url):null;if(!v)return!0;const M=R.credential===v?R.user:yield y._fetchEditingUser(f);return R.credential=v,R.user=M,null==M?.privileges||M.privileges.includes("features:user:edit")})()}_fetchEditingUser(f){var y=this;return(0,m.A)(function*(){const v=y.portalItem?.portal?.user;if(v)return v;const M=S.id?.findServerInfo(y.url??"");if(!M?.owningSystemUrl)return null;const se=`${M.owningSystemUrl}/sharing/rest`,ee=H.A.getDefault();if(ee&&ee.loaded&&(0,O.S8)(ee.restUrl)===(0,O.S8)(se))return ee.user;const te=`${se}/community/self`,le=null!=f?f.signal:null,ae=yield(0,W.Ke)((0,G.A)(te,{authMode:"no-prompt",query:{f:"json"},signal:le}));return ae.ok?Q.A.fromJSON(ae.value.data):null})()}read(f,y){y&&(y.layer=this),super.read(f,y)}write(f,y){const v=y?.portal,M=this.portalItem?.id&&(this.portalItem.portal||H.A.getDefault());return v&&M&&!(0,O.ut)(M.restUrl,v.restUrl)?(y.messages&&y.messages.push(new j.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(f,{...y,layer:this})}};return(0,a._)([(0,T.MZ)({type:J.default})],w.prototype,"portalItem",null),(0,a._)([(0,p.w)("web-document","portalItem",["itemId"])],w.prototype,"readPortalItem",null),(0,a._)([(0,_.K)("web-document","portalItem",{itemId:{type:String}})],w.prototype,"writePortalItem",null),(0,a._)([(0,T.MZ)({clonable:!1})],w.prototype,"resourceReferences",void 0),(0,a._)([(0,T.MZ)({type:Boolean,readOnly:!0})],w.prototype,"userHasEditingPrivileges",void 0),(0,a._)([(0,T.MZ)({type:Boolean,readOnly:!0})],w.prototype,"userHasFullEditingPrivileges",void 0),(0,a._)([(0,T.MZ)({type:Boolean,readOnly:!0})],w.prototype,"userHasUpdateItemPrivileges",void 0),w=(0,a._)([(0,o.$)("esri.layers.mixins.PortalLayer")],w),w},R={credential:null,user:null}},1151:(q,C,n)=>{n.d(C,{J:()=>w});var m=n(10467),a=n(8189),S=(n(3248),n(35150)),G=n(56492),W=n(85211),j=n(48669),L=(n(40707),n(76576)),I=n(50501),O=n(31178),T=n(48900),d=n(34703);const u=new O.A,p=new WeakMap;function H(f,y){return Number.isFinite(f)&&Number.isFinite(y)?y<=0?f:H(y,f%y):0}let J=0,Q=0;function X(){const f=Date.now();let y=!1;for(const v of u){const M=v.deref();M?M.refreshInterval&&f-(p.get(M)??0)+5>=6e4*M.refreshInterval&&(p.set(M,f),M.refresh(f)):y=!0}if(y)for(let v=u.length-1;v>=0;v--)u.at(v).deref()||u.removeAt(v)}(0,d.fm)(()=>{const f=Date.now();let y=0;for(const v of u){const M=v.deref();M&&(y=H(Math.round(6e4*M.refreshInterval),y),M.refreshInterval?p.get(M)||p.set(M,f):p.delete(M))}if(y!==Q){if(Q=y,clearInterval(J),0===Q)return void(J=0);J=setInterval(X,Q)}},T.OH);const w=f=>{let y=class extends f{constructor(...v){super(...v),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,G.sg)(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||function o(f){(function E(f){return null!=f&&"object"==typeof f&&"refreshInterval"in f&&"refresh"in f})(f)&&u.push(new WeakRef(f))}(this)},()=>{})}destroy(){!function _(f){const y=u.find(v=>v.deref()===f);y&&u.remove(y)}(this)}castRefreshInterval(v){return v>=.1?v:v<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(v=Date.now()){(0,G.QZ)(this._debounceHasDataChanged()).then(M=>{M&&this._set("refreshTimestamp",v),this.emit("refresh",{dataChanged:M})},M=>{S.A.getLogger(this).error(M),this.emit("refresh",{dataChanged:!1,error:M})})}hasDataChanged(){return(0,m.A)(function*(){return!0})()}get test(){}};return(0,a._)([(0,W.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:I.K}}}}})],y.prototype,"refreshInterval",void 0),(0,a._)([(0,j.w)("refreshInterval")],y.prototype,"castRefreshInterval",null),(0,a._)([(0,W.MZ)({readOnly:!0})],y.prototype,"refreshTimestamp",void 0),(0,a._)([(0,W.MZ)({readOnly:!0})],y.prototype,"refreshParameters",null),y=(0,a._)([(0,L.$)("esri.layers.mixins.RefreshableLayer")],y),y}},33036:(q,C,n)=>{n.d(C,{j:()=>j});var m=n(8189),a=n(85211),W=(n(3248),n(35150),n(40707),n(76576));const j=L=>{let I=class extends L{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const O={minScale:this.minScale,maxScale:this.maxScale},T=this.parent;T&&"effectiveScaleRange"in T&&function D(L,I){L.minScale=L.minScale>0?I.minScale>0?Math.min(L.minScale,I.minScale):L.minScale:I.minScale,L.maxScale=L.maxScale>0?I.maxScale>0?Math.max(L.maxScale,I.maxScale):L.maxScale:I.maxScale}(O,T.effectiveScaleRange);const d=this._get("effectiveScaleRange");return d&&d.minScale===O.minScale&&d.maxScale===O.maxScale?d:O}};return(0,m._)([(0,a.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],I.prototype,"minScale",void 0),(0,m._)([(0,a.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],I.prototype,"maxScale",void 0),(0,m._)([(0,a.MZ)({readOnly:!0})],I.prototype,"effectiveScaleRange",null),I=(0,m._)([(0,W.$)("esri.layers.mixins.ScaleRangeLayer")],I),I}},84311:(q,C,n)=>{n.d(C,{B:()=>u,e:()=>p});var m=n(8189),a=n(85211),W=(n(3248),n(35150),n(40707),n(17221)),j=n(76576),D=n(50501),L=n(86300),I=n(38488),O=n(26957),T=n(17181),d=n(89352);const u={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:D.K}}},p=o=>{let _=class extends o{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(E,H){const J=H.timeInfo.exportOptions;if(!J)return null;const Q=J.timeOffset,X=O.j.fromJSON(J.timeOffsetUnits);return Q&&X?new d.A({value:Q,unit:X}):null}set timeInfo(E){(0,L.sv)(E,this.fieldsIndex),this._set("timeInfo",E)}};return(0,m._)([(0,a.MZ)({type:T.A,json:{write:!1}})],_.prototype,"timeExtent",void 0),(0,m._)([(0,a.MZ)({type:d.A})],_.prototype,"timeOffset",void 0),(0,m._)([(0,W.w)("service","timeOffset",["timeInfo.exportOptions"])],_.prototype,"readOffset",null),(0,m._)([(0,a.MZ)({value:null,type:I.A,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],_.prototype,"timeInfo",null),(0,m._)([(0,a.MZ)(u)],_.prototype,"useViewTime",void 0),_=(0,m._)([(0,j.$)("esri.layers.mixins.TemporalLayer")],_),_}},38488:(q,C,n)=>{n.d(C,{A:()=>o});var m=n(8189),a=n(90660),F=n(71065),S=n(85211),D=(n(3248),n(35150),n(40707),n(17221)),L=n(76576),I=n(50305),O=n(17181),T=n(89352),d=n(22639);function u(_,E){return T.A.fromJSON({value:_,unit:E})}let p=class extends(a.A.ClonableMixin(F.A)){constructor(_){super(_),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(_,E){return E.timeExtent&&Array.isArray(E.timeExtent)&&2===E.timeExtent.length?O.A.fromArray(E.timeExtent):null}writeFullTimeExtent(_,E){E.timeExtent=null!=_?.start&&null!=_.end?_.toArray():null}readInterval(_,E){return E.timeInterval&&E.timeIntervalUnits?u(E.timeInterval,E.timeIntervalUnits):E.defaultTimeInterval&&E.defaultTimeIntervalUnits?u(E.defaultTimeInterval,E.defaultTimeIntervalUnits):null}writeInterval(_,E){E.timeInterval=_?.toJSON().value??null,E.timeIntervalUnits=_?.toJSON().unit??null}};(0,m._)([(0,S.MZ)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],p.prototype,"cumulative",void 0),(0,m._)([(0,S.MZ)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],p.prototype,"endField",void 0),(0,m._)([(0,S.MZ)({type:O.A,json:{write:{enabled:!0,allowNull:!0}}})],p.prototype,"fullTimeExtent",void 0),(0,m._)([(0,D.w)("fullTimeExtent",["timeExtent"])],p.prototype,"readFullTimeExtent",null),(0,m._)([(0,I.K)("fullTimeExtent")],p.prototype,"writeFullTimeExtent",null),(0,m._)([(0,S.MZ)({type:Boolean,json:{write:!0}})],p.prototype,"hasLiveData",void 0),(0,m._)([(0,S.MZ)({type:T.A,json:{write:{enabled:!0,allowNull:!0}}})],p.prototype,"interval",void 0),(0,m._)([(0,D.w)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],p.prototype,"readInterval",null),(0,m._)([(0,I.K)("interval")],p.prototype,"writeInterval",null),(0,m._)([(0,S.MZ)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],p.prototype,"startField",void 0),(0,m._)([(0,S.MZ)((0,d.P6)("timeReference",!0))],p.prototype,"timeZone",void 0),(0,m._)([(0,S.MZ)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],p.prototype,"trackIdField",void 0),(0,m._)([(0,S.MZ)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],p.prototype,"useTime",void 0),(0,m._)([(0,S.MZ)({type:[Date],json:{read:!1}})],p.prototype,"stops",void 0),p=(0,m._)([(0,L.$)("esri.layers.support.TimeInfo")],p);const o=p},63014:(q,C,n)=>{n.d(C,{C:()=>W,m:()=>S});var m=n(10467),a=n(5922),F=n(56492);function S(D,L,I){return G.apply(this,arguments)}function G(){return(G=(0,m.A)(function*(D,L,I){let O;try{O=yield createImageBitmap(D)}catch(T){throw new a.A("request:server",`Unable to load ${L}`,{url:L,error:T})}return(0,F.Te)(I),O})).apply(this,arguments)}function W(D,L,I,O,T){return j.apply(this,arguments)}function j(){return(j=(0,m.A)(function*(D,L,I,O,T){let d;try{d=yield createImageBitmap(D)}catch(u){throw new a.A("request:server",`Unable to load tile ${L}/${I}/${O}`,{error:u,level:L,row:I,col:O})}return(0,F.Te)(T),d})).apply(this,arguments)}},69927:(q,C,n)=>{n.d(C,{It:()=>p,LG:()=>j,OM:()=>I,Sm:()=>O,Y:()=>D,bK:()=>L,mm:()=>u,sQ:()=>T});var m=n(10467),a=n(13970),F=n(32034),S=n(55039);function W(){return(W=(0,m.A)(function*(o){const _=o.spatialReference;if(_.isWGS84)return o.clone();if(_.isWebMercator)return(0,S.ci)(o);const E=F.A.WGS84;return yield(0,a.initializeProjection)(_,E),(0,a.project)(o,E)})).apply(this,arguments)}function j(o,_){if(!D(o,_)){const E=o.typeKeywords;E?E.push(_):o.typeKeywords=[_]}}function D(o,_){return!!o.typeKeywords?.includes(_)}function L(o){return D(o,u.HOSTED_SERVICE)}function I(o,_){const E=o.typeKeywords;if(E){const H=E.indexOf(_);H>-1&&E.splice(H,1)}}function O(o,_,E){E?j(o,_):I(o,_)}function T(o){return d.apply(this,arguments)}function d(){return d=(0,m.A)(function*(o){const _=o.clone().normalize();let E;if(_.length>1)for(const H of _)E?H.width>E.width&&(E=H):E=H;else E=_[0];return function G(o){return W.apply(this,arguments)}(E)}),d.apply(this,arguments)}const u={DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function p(o){const{portal:_,isOrgItem:E,itemControl:H}=o,J=_.user?.privileges;let Q=!J||J.includes("features:user:edit"),X=!!E&&!!J?.includes("features:user:fullEdit");const U="update"===H||"admin"===H;return U?X=Q=!0:X&&(Q=!0),{features:{edit:Q,fullEdit:X},content:{updateItem:U}}}},26957:(q,C,n)=>{n.d(C,{j:()=>a});const a=(0,n(49976).O)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},89352:(q,C,n)=>{n.d(C,{A:()=>d});var m=n(8189),a=n(90660),F=n(71065),S=n(97442),G=n(85211),L=(n(3248),n(35150),n(40707),n(15463)),I=n(76576),O=n(26957);let T=class extends(a.A.ClonableMixin(F.A)){constructor(u){super(u),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,S.t)(this.value,this.unit,"milliseconds")}};(0,m._)([(0,L.e)(O.j,{nonNullable:!0})],T.prototype,"unit",void 0),(0,m._)([(0,G.MZ)({type:Number,json:{write:!0},nonNullable:!0})],T.prototype,"value",void 0),T=(0,m._)([(0,I.$)("esri.time.TimeInterval")],T);const d=T}}]);