"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[788],{78698:(ye,O,p)=>{p.d(O,{A:()=>D,J:()=>A});var T=p(1119);function A(R,Y){let B;if("string"==typeof R)B=(0,T.Wm)(R+`-seed(${Y})`);else{let Q=12;B=R^Y;do{B=107*(B>>8^B)+Q|0}while(0!=--Q)}return(1+B/(1<<31))/2}function D(R){return Math.floor(A(R,L)*E)}const L=53290320,E=10},80788:(ye,O,p)=>{p.d(O,{o:()=>ut});var T=p(10467),A=p(8137),D=p(67685),L=p(47669),E=p(98522),R=p(93300),Y=p(9368);class B extends Y.r{}function Q(o){const{sprite:e,isMapAligned:t,colorLocked:i,scaleSymbolsProportionally:s,isStroke:n}=o;let r=0;return t&&(r|=(0,E.mR)(R.c.bitset.isMapAligned)),i&&(r|=(0,E.mR)(R.c.bitset.colorLocked)),e.sdf&&(r|=(0,E.mR)(R.c.bitset.isSDF)),s&&(r|=(0,E.mR)(R.c.bitset.scaleSymbolsProportionally)),n&&(r|=(0,E.mR)(R.c.bitset.isStroke)),r}var De=p(90731),k=p(50915);class Ee extends B{get vertexSpec(){return{createComputedParams:e=>{let{pixelDimensions:t,texelDimensions:i,baseSize:s,referenceSize:n,strokeWidth:r,sizeRatio:a}=e;t||(t=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),i||(i=e.sprite.sdf?[0,0]:t),s=(0,D.Lz)(s),n=(0,D.Lz)(n),r=(0,D.Lz)(r);const c=(e.sprite.sdfDecodeCoeff??1)*a;return{...e,pixelDimensions:t,texelDimensions:i,baseSize:s,referenceSize:n,strokeWidth:r,sdfDecodeCoeff:c}},optionalAttributes:{zoomRange:{type:k.pe.SHORT,count:2,packPrecisionFactor:L.fq,pack:({scaleInfo:e},{tileInfo:t})=>(0,E.My)(e,t)}},attributes:{id:{type:k.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:k.pe.UNSIGNED_BYTE,count:1,pack:Q},pos:{type:k.pe.SHORT,count:2,pack:"position",packPrecisionFactor:1},offset:{type:k.pe.FLOAT,count:2,packAlternating:{count:4,pack:e=>{const t=e.texelDimensions;return[[-.5*t[0],-.5*t[1]],[.5*t[0],-.5*t[1]],[-.5*t[0],.5*t[1]],[.5*t[0],.5*t[1]]]}}},uv:{type:k.pe.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:e,texXmin:t,texYmax:i,texYmin:s})=>[[t,s],[e,s],[t,i],[e,i]]}},animationPointerAndBaseSizeAndReferenceSize:{type:k.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:1,pack:({animations:e,baseSize:t,referenceSize:i})=>[e.dataColumn,e.dataRow,t,i]},sizing:{type:k.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:e,pixelDimensions:t,baseSize:i,sprite:s,sizeRatio:n})=>{const r=Math.max(i*s.width/s.height,i);return[t[0],t[1],e,s.sdfDecodeCoeff*r*n]}},angle:{type:k.pe.BYTE,count:1,packTessellation:({angle:e})=>e}}}}_write(e,t){const i=this.evaluatedMeshParams.sprite,{textureBinding:s}=i;e.recordStart(this.instanceId,this.attributeLayout,s);const n=t.getDisplayId();if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[a,c]=r.coords;this._writeQuad(e,n,a,c)}else if("esriGeometryPoint"===t.geometryType){const r=t.readXForDisplay(),a=t.readYForDisplay();this._writeQuad(e,n,r,a)}else{const r=t.readGeometryForDisplay();if(r){const{angleToLine:a}=this.evaluatedMeshParams;if(a){let c=!0,u=null,d=null;r.forEachVertex((l,h)=>{if(null!=u&&null!=d){const y=Math.atan2(h-d,l-u)/De.rp;c&&(this._writeQuad(e,n,u,d,y),c=!1),this._writeQuad(e,n,l,h,y)}u=l,d=h})}else r.forEachVertex((c,u)=>{this._writeQuad(e,n,c,u)})}}e.recordEnd()}_writeQuad(e,t,i,s,n=0){const r=this.evaluatedMeshParams.sprite,{rect:a}=r,c=a.x+L.hM,u=a.y+L.hM,d=a.x+a.width-L.hM,l=a.y+a.height-L.hM,h=e.vertexCount();e.recordBounds(i,s,64,64);const y={texXmin:c,texYmin:u,texXmax:d,texYmax:l,angle:n};for(let g=0;g<4;g++)this._writeVertex(e,t,i,s,y);e.indexEnsureSize(6),e.indexWrite(h),e.indexWrite(h+1),e.indexWrite(h+2),e.indexWrite(h+1),e.indexWrite(h+3),e.indexWrite(h+2)}}var Re=p(16006),Te=p(13494),ke=p(58096),Be=p(82870),We=p(88636),Ge=p(79184),Fe=p(76740),Ce=p(7610),Oe=p(99046),Ne=p(60797),N=p(76329),j=p(3672),I=p(83953),$=p(88532),G=p(45475),ne=p(31732),oe=p(13682),ge=p(30365),ve=p(53212),xe=p(21260),Me=p(23855),X=p(84289);function Pe(o,e,t){return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o}function Ae(o,e){return Math.sqrt(o*o+e*e)}function be(o){const e=Ae(o[0],o[1]);o[0]/=e,o[1]/=e}function je(o,e){return Ae(o[0]-e[0],o[1]-e[1])}function _e(o){return o.length-1}function Ve(o,e,t=1){let[i,s]=function Ze(o,e){return o[e+1]}(o,e);return[i,s]=[Math.round(i),Math.round(s)],Math.sqrt(i*i+s*s)*t}class Z{constructor(e,t,i,s,n){this._segments=e,this._index=t,this._distance=i,this._xStart=s,this._yStart=n,this._done=!1}static create(e){return new Z(e,0,0,e[0][0],e[0][1])}clone(){return new Z(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){const e=this.dy;let i=Math.acos((0*e+-1*-this.dx)/(1*this.length));return e>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<_e(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){const i=this.backwardLength;if(e<=i)return this._distance=(i-e)/this.length,this;let s=this.backwardLength;for(;this.prev();){if(s+this.length>e)return this._seekBackwards(e-s);s+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>e)return this.seek(e-i,t);i+=this.length}return this._distance=1,t?this:null}}function ae(o,e,t,i=!0){const s=function Ie(o){let e=0;for(let t=0;t<_e(o);t++)e+=Ve(o,t);return e}(o),n=Z.create(o),r=s/2;if(!i)return n.seek(r),void(Math.abs(n.x)<X.$u&&Math.abs(n.y)<X.$u&&t(n.clone(),0,r+0*e,s));const a=Math.max((s-e)/2,0),c=Math.floor(a/e);n.seek(r-c*e);for(let d=-c;d<=c;d++)Math.abs(n.x)<X.$u&&Math.abs(n.y)<X.$u&&t(n.clone(),d,r+d*e,s),n.seek(e)}function le(o,e){const t=e;for(let i=0;i<o.length;i++){let s=o[i];Ue(s,t);const n=[];n.push(s[0]);for(let r=1;r<s.length;r++){const[a,c]=s[r-1],[u,d]=s[r];n.push([u-a,d-c])}o[i]=n,s=n}return o}function Ue(o,e){if(e<=0)return;const i=o.length;if(i<3)return;const s=[];let n=0;s.push(0);for(let l=1;l<i;l++)n+=je(o[l],o[l-1]),s.push(n);e=Math.min(e,.2*n);const r=[];r.push(o[0][0]),r.push(o[0][1]);const a=o[i-1][0],c=o[i-1][1],u=Pe([0,0],o[0],o[1]);be(u),o[0][0]+=e*u[0],o[0][1]+=e*u[1],Pe(u,o[i-1],o[i-2]),be(u),o[i-1][0]+=e*u[0],o[i-1][1]+=e*u[1];for(let l=1;l<i;l++)s[l]+=e;s[i-1]+=e;const d=.5*e;for(let l=1;l<i-1;l++){let h=0,y=0,g=0;for(let f=l-1;f>=0&&!(s[f+1]<s[l]-d);f--){const m=d+s[f+1]-s[l],x=s[f+1]-s[f],v=s[l]-s[f]<d?1:m/x;if(Math.abs(v)<1e-6)break;const P=v*v,M=v*m-.5*P*x,b=v*x/e,_=o[f+1],z=o[f][0]-_[0],W=o[f][1]-_[1];h+=b/M*(_[0]*v*m+.5*P*(m*z-x*_[0])-P*v*x*z/3),y+=b/M*(_[1]*v*m+.5*P*(m*W-x*_[1])-P*v*x*W/3),g+=b}for(let f=l+1;f<i&&!(s[f-1]>s[l]+d);f++){const m=d-s[f-1]+s[l],x=s[f]-s[f-1],v=s[f]-s[l]<d?1:m/x;if(Math.abs(v)<1e-6)break;const P=v*v,M=v*m-.5*P*x,b=v*x/e,_=o[f-1],z=o[f][0]-_[0],W=o[f][1]-_[1];h+=b/M*(_[0]*v*m+.5*P*(m*z-x*_[0])-P*v*x*z/3),y+=b/M*(_[1]*v*m+.5*P*(m*W-x*_[1])-P*v*x*W/3),g+=b}r.push(h/g),r.push(y/g)}r.push(a),r.push(c);for(let l=0,h=0;l<i;l++)o[l][0]=r[h++],o[l][1]=r[h++]}var V=p(3991);const Qe=(0,Ne.Bj)(o=>{let e=0;if(0===o)return 1/0;for(;!(o%2);)e++,o/=2;return e});class $e extends V.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,i,s){if(this._zoomLevel=s||0,null!=i)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const n=t.readXForDisplay(),r=t.readYForDisplay();this._writePoint(e,n,r,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const n=t.readCentroidForDisplay();if(!n)return;const[r,a]=n.coords;this._writePoint(e,r,a,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_getMetricDir(){const{horizontalAlignment:e,verticalAlignment:t}=this.evaluatedMeshParams;return["center"===e?0:"right"===e?-1:1,"middle"===t?0:"bottom"===t?-1:1]}_createLineLabelMetric(e,t,i,s){const n=(0,ve.Q4)(e),[r,a]=this._getMetricDir();return new Me.f(n,t,i,r,a,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,s??null)}_writePoint(e,t,i,s){const n=this._getShaping();if(!n)return;const r=s.getDisplayId(),a=(0,ge.xy)(this.evaluatedMeshParams.horizontalAlignment),c=(0,ge.UD)(this.evaluatedMeshParams.verticalAlignment),u=this.evaluatedMeshParams.scaleInfo?.maxScale??0,d=this.evaluatedMeshParams.scaleInfo?.minScale??0,l=(0,ve.Q4)(s.getDisplayId()),h=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new Me.f(l,t,i,a,c,u,d,h)),this._writeGlyphs(e,r,t,i,n,0,h),e.metricBoxWrite(n.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:i,verticalAlignment:s}=this.evaluatedMeshParams,n=this.evaluatedMeshParams.repeatLabelDistance||128,r=this._getShaping("middle");if(!r)return;const a=(u,d,l,h)=>this._placeSubdivGlyphs(u,d,l,h),c=(r.bounds.width+n)/2;this._current={out:e,id:t.getDisplayId(),shaping:r,zoomRange:(0,E.My)(i,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null},this._verticalPlacement="bottom"===s?"above":"top"===s?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,a,c):this._writeCenterAlong(t,a,c)}_writeAboveAndBelowAlong(e,t,i){const{repeatLabel:s}=this.evaluatedMeshParams,{shaping:n}=this._current,r=n.bounds.halfHeight,a=e.readGeometryForDisplay();if(!a)return;const c=new oe.A;(0,ne.kz)(c,a,!1,!1,"esriGeometryPolyline",1);const u=Se(new oe.A,c,r),d=Se(new oe.A,c,-r),l=(0,ne.zv)(d,"esriGeometryPolyline",!1,!1),y=le((0,ne.zv)(u,"esriGeometryPolyline",!1,!1).paths,n.bounds.width),g=le(l.paths,n.bounds.width);this._current.offsetDirection="above";for(const f of y)ae(f,i,t,!!s);this._current.offsetDirection="below";for(const f of g)ae(f,i,t,!!s)}_writeCenterAlong(e,t,i){const{repeatLabel:s}=this.evaluatedMeshParams,{shaping:n}=this._current,r=le(e.readLegacyGeometryForDisplay().paths,n.bounds.width);for(const a of r)ae(a,i,t,!!s)}_placeSubdivGlyphs(e,t,i,s){const{allowOverrun:n,labelPosition:r,repeatLabelDistance:a}=this.evaluatedMeshParams,c=this._current.zoomRange[0],u=Qe(t),d=this._current.shaping.bounds.width/2,l=Math.sqrt(a||128)/2,h=Math.min(i,s-i),y=this._current.shaping.isMultiline?V.GJ:Math.log2(h/(l+d/2)),g=0===t?y:Math.min(u,y),f=Math.max(c,this._zoomLevel+1-g),m=this._zoomLevel-f,x=this._current.shaping.bounds.width/2*2**m;this._current.shaping.isMultiline?0===t&&this._placeStraight(e,f):n&&m<0?this._placeStraightAlong(e,c):"parallel"===r?this._placeStraightAlong(e,f):"curved"===r&&this._placeCurved(e,f,x)}_placeStraight(e,t){const{out:i,id:s,shaping:n,referenceBounds:r}=this._current,{x:a,y:c}=e;i.metricStart(this._createLineLabelMetric(s,a,c)),i.metricBoxWrite(n.boundsT);const u=e.angle*(180/Math.PI)%360,d=(e.angle*(180/Math.PI)+180)%360;this._writeGlyphs(i,s,a,c,n,0,r,{clipAngle:u,mapAligned:!0,isLineLabel:!0,minZoom:t}),this._writeGlyphs(i,s,a,c,n,0,r,{clipAngle:d,mapAligned:!0,isLineLabel:!0,minZoom:t}),i.metricEnd()}_placeCurved(e,t,i){const{out:s,id:n}=this._current;s.metricStart(this._createLineLabelMetric(n,e.x,e.y));const r=e.clone(),a=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(r,t,1,a),this._placeBack(e,r,t,i,1,a),this._placeForward(e,r,t,i,1,a)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(r,t,0,c),this._placeBack(e,r,t,i,0,c),this._placeForward(e,r,t,i,0,c)),s.metricEnd()}_placeStraightAlong(e,t){const{out:i,id:s,shaping:n,zoomRange:r,referenceBounds:a}=this._current,{boxBorderLineColor:c,boxBackgroundColor:u}=this.evaluatedMeshParams,d=e.clone(),l=e.angle*(180/Math.PI)%360,h=(e.angle*(180/Math.PI)+180)%360,y=n.glyphs.length>0&&!(!c&&!u);if(i.metricStart(this._createLineLabelMetric(s,e.x,e.y)),y){const g=Math.max(t,r[0],0),f=Math.min(V.GJ,r[1]),m=(0,N.$0)((0,j.vt)(),-e.angle),x={minZoom:g,maxZoom:f,clipAngle:l,mapAligned:!0,isLineLabel:!0},v=(0,D.Lz)(this.evaluatedMeshParams.offsetX),P=(0,D.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const M=(0,$.fA)(v,-1*P),[b,_]=n.shapeBackground((0,N.Tl)((0,j.vt)(),m,M));i.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding);const z=2*Math.max(b.width,b.height);i.recordBounds(e.x+b.x,e.y+b.y,z,z),this._writeTextBox(i,s,e.x,e.y,_,a,x),i.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const M=(0,$.fA)(v,P),[b,_]=n.shapeBackground((0,N.Tl)((0,j.vt)(),m,M));x.clipAngle=h,i.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding);const z=2*Math.max(b.width,b.height);i.recordBounds(e.x+b.x,e.y+b.y,z,z),this._writeTextBox(i,s,e.x,e.y,_,a,x),i.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(d,t,1,l,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(d,t,0,h,!0),i.metricEnd()}_placeBack(e,t,i,s,n,r){const a=e.clone();let c=e.backwardLength+0;for(;a.prev()&&!(c>=s);)this._placeOnSegment(a,t,c,i,-1,n,r),c+=a.length+0}_placeForward(e,t,i,s,n,r){const a=e.clone();let c=e.remainingLength+0;for(;a.next()&&!(c>=s);)this._placeOnSegment(a,t,c,i,1,n,r),c+=a.length+0}_placeFirst(e,t,i,s,n=!1){const{out:r,id:a,shaping:c,zoomRange:u,referenceBounds:d}=this._current,l=c.glyphs,h=(0,D.Lz)(this.evaluatedMeshParams.offsetX),y=(0,D.Lz)(this.evaluatedMeshParams.offsetY),g=(0,$.fA)(h,y),f=(0,N.$0)((0,j.vt)(),-e.angle);(0,I.l0)(g,g,f);for(const m of l){const x=m.x>c.bounds.x?i:1-i,v=x*e.remainingLength+(1-x)*e.backwardLength,P=Math.abs(m.x+m.width/2-c.bounds.x),M=Math.max(0,this._zoomLevel+Math.log2(P/(v+0))),b=Math.max(t,n?0:M);if(m.maxZoom=Math.min(u[1],V.GJ),m.angle=e.angle+(1-i)*Math.PI,m.minZoom=Math.max(u[0],b),this._writeLineGlyph(r,a,e.x,e.y,c.bounds,m,s,d,!0),(i||this._current.offsetDirection)&&this._isVisible(m.minZoom,m.maxZoom)){const _=new xe.A(m.bounds.x+g[0],m.bounds.y+g[1],m.bounds.width,m.bounds.height);r.metricBoxWrite(_)}}}_placeOnSegment(e,t,i,s,n,r,a){const{out:c,id:u,shaping:d,referenceBounds:l}=this._current,h=d.glyphs,f={x:e.x+i*-n*(e.dx/e.length),y:e.y+i*-n*(e.dy/e.length)},m=(0,D.Lz)(this.evaluatedMeshParams.offsetX),x=(0,D.Lz)(this.evaluatedMeshParams.offsetY),v=(0,$.fA)(m,x),P=(0,N.$0)((0,j.vt)(),-e.angle);(0,I.l0)(v,v,P);for(const M of h){const b=M.x>d.bounds.x?r:1-r;if(!(b&&1===n||!b&&-1===n))continue;const _=Math.abs(M.x+M.width/2-d.bounds.x),z=Math.max(0,this._zoomLevel+Math.log2(_/i)-.1),W=Math.max(s,this._zoomLevel+Math.log2(_/(i+e.length+0)));if(0!==z&&(M.angle=e.angle+(1-r)*Math.PI,M.minZoom=W,M.maxZoom=z,this._writeLineGlyph(c,u,f.x,f.y,d.bounds,M,a,l,!0),(r||this._current.offsetDirection)&&this._isVisible(M.minZoom,M.maxZoom))){const dt=new xe.A(M.bounds.x+v[0],M.bounds.y+v[1],M.bounds.width,M.bounds.height);c.metricBoxWrite(dt)}}}_writeLineGlyph(e,t,i,s,n,r,a,c,u){const d=i+n.x,l=s+n.y,h=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),y=Math.max(n.width,n.height)*h;e.recordStart(this.instanceId,this.attributeLayout,r.textureBinding),e.recordBounds(d,l,y,y);const{texcoords:g,offsets:f}=r,{fontSize:m,haloSize:x,outlineSize:v}=this._textMeshTransformProps;this._writeQuad(e,t,i,s,{texcoords:g,offsets:f,fontSize:m,haloSize:x,outlineSize:v,color:(0,E.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:c,minZoom:Math.max(this._current.zoomRange[0],r.minZoom),maxZoom:Math.min(this._current.zoomRange[1],r.maxZoom),clipAngle:a,mapAligned:u,isLineLabel:!0}),e.recordEnd()}_isVisible(e,t){const i=Math.floor(this._zoomLevel*L.fq)/L.fq;return e<=i&&i<=t}}function Se(o,e,t){const{coords:i,lengths:s}=e,n=(0,G.vt)(),r=(0,G.vt)(),a=(0,G.vt)(),c=(0,G.vt)(),u=(0,G.vt)(),d=(0,G.vt)();let h=0;for(let y=0;y<s.length;y++){const g=s[y];for(let f=0;f<g;f++){const m=2*(f+h-1),x=2*(f+h),v=2*(f+h+1);f>0?(0,I.hZ)(n,i[m],i[m+1]):(0,I.hZ)(n,0,0),(0,I.hZ)(r,i[x],i[x+1]),f<g-1?(0,I.hZ)(a,i[v],i[v+1]):(0,I.hZ)(a,0,0),0===f?(0,I.hZ)(c,0,0):((0,I.jb)(c,r,n),(0,I.S8)(c,c),(0,I.hZ)(c,c[1],-c[0])),f===g-1?(0,I.hZ)(u,0,0):((0,I.jb)(u,a,r),(0,I.S8)(u,u),(0,I.hZ)(u,u[1],-u[0])),(0,I.WQ)(d,c,u),(0,I.S8)(d,d);const P=d[0]*u[0]+d[1]*u[1];0!==P&&(0,I.hs)(d,d,P),(0,I.hs)(d,d,t),o.coords.push(r[0]+d[0],r[1]+d[1])}o.lengths.push(g),h+=g}return o}var Xe=p(19922),He=p(26248),Je=p(26689),Ke=p(37121),J=p(89952),qe=p(5922),et=p(77806),tt=p(35150),st=p(48218),he=p(78698),C=p(80862);function K(o){return o instanceof q?o:"object"==typeof o&&"type"in o?it[o.type].hydrate(o):new U(o)}class q{constructor(e){this.inputs=e}encode(){const e=[];for(const t of this.inputs)e.push(...t.encode());return e.push(...this.instructions),e}}class U extends q{constructor(e){super([]),this.value=e}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const[e,t,i,s]=this.value;return null!=s?C.GA.vector4.encode([e,t||0,i||0,s]):C.GA.vector3.encode([e,t||0,i||0])}return C.GA.scalar.encode(this.value)}}class ee extends q{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new ee(e,K(e.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;const e=this._parent.simplify();if(!(e instanceof U))return this;const[t,i,s,n]=e.value,r=this._config.translation.from[0],a=this._config.translation.from[1],c=this._config.rotation.from,u=this._config.scale.from;if(r===this._config.translation.to[0]&&a===this._config.translation.to[1]&&c===this._config.rotation.to&&u===this._config.scale.to){const d=s+c,l=n*u,h=Math.sin(s),y=Math.cos(s);return new U([y*n*r-h*n*a+t,h*n*r+y*n*a+i,d,l])}return new ee(this._config,e)}get instructions(){return C.GA.animatedTransform.encode(this._config)}}class te extends q{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new te(e,K(e.parent))}simplify(){const e=this._parent.simplify();if(!(e instanceof U))return this;const[t,i,s,n]=e.value,r=this._config.color.from[0],a=this._config.color.from[1],c=this._config.color.from[2];let u=this._config.color.from[3];const d=this._config.opacity.from;return r===this._config.color.to[0]&&a===this._config.color.to[1]&&c===this._config.color.to[2]&&u===this._config.color.to[3]&&d===this._config.opacity.to?(u*=d,new U([t*r,i*a,s*c,n*u])):new te(this._config,e)}get instructions(){return C.GA.animatedColor.encode(this._config)}}const it={AnimatedTransform:ee,AnimatedColor:te};var rt=p(68677);function ot(o){const e=[];return e.push(o.transform),e.push(o.fromColor),e.push(o.toColor),e.push(o.colorMix),e.push(o.toOpacity),e.push(o.opacityMix),e}function Le(o){const e=[],t=[];let i=0;for(const s of o){const n=[...s.encode(),...C.GA.ret.encode()];e.push([i+o.length,0,0,0]),t.push(...n),i+=n.length}return[...e,...t]}function ue(o,e){return de.apply(this,arguments)}function de(){return(de=(0,T.A)(function*(o,e){const t=o;let i;if("number"==typeof t||"string"==typeof t||"boolean"==typeof t)i=t;else if(Array.isArray(t))i=yield Promise.all(t.map(s=>ue(s,e)));else if("object"==typeof t)if("valueExpressionInfo"in t){const{valueExpressionInfo:s}=t,{expression:n}=s;i={...t,computed:yield e.createComputedField({expression:n})}}else{i={};for(const s in t)i[s]=yield ue(t[s],e)}return i})).apply(this,arguments)}function S(o,e,t){const s=o;let n;if("number"==typeof s||"string"==typeof s||"boolean"==typeof s)n=s;else if(Array.isArray(s))n=s.map(r=>S(r,e,t));else if("object"==typeof s)if("type"in s&&null!=s.type&&"Process"===s.type)switch(s.op){case"ArcadeColor":{const r=S(s.value,e,t);se(Array.isArray(r)&&4===r.length),n=[r[0]/255,r[1]/255,r[2]/255,r[3]]}break;case"Transparency":{const r=S(s.value,e,t);se("number"==typeof r),n=1-r/100}break;case"Divide":case"Add":{const r=S(s.left,e,t);se("number"==typeof r);const a=S(s.right,e,t);switch(se("number"==typeof a),s.op){case"Divide":n=r/a;break;case"Add":n=r+a}}break;case"Random":{const r=S(s.seed,e,t),a=S(s.min,e,t),c=S(s.max,e,t),u=e.getObjectId(),d=(0,he.A)(u||0);n=a+(0,he.J)(d,r)*(c-a)}break;case"Cond":{const r=S(s.condition,e,t),a=S(s.ifTrue,e,t),c=S(s.ifFalse,e,t);n=r?a:c}break;case"MatchWinding":{const r=S(s.sign,e,t);let a=S(s.angle,e,t);if(r>0)for(;a<0;)a+=2*Math.PI;else for(;a>0;)a-=2*Math.PI;n=a}}else if("computed"in s)n=function i(r){if(!("computed"in r))return r;let a=r.computed.readWithDefault(e,t,[255*r.defaultValue[0],255*r.defaultValue[1],255*r.defaultValue[2],r.defaultValue[3]]);if("string"==typeof a){const c=rt.A.fromString(a);c&&(a=[c.r,c.g,c.b,c.a])}return a}(s);else{n={};for(const r in s)n[r]=S(s[r],e,t)}return n}function*w(o){const e=o;if(Array.isArray(e))for(const t of e)yield*w(t);else if("object"==typeof e)if("type"in e&&null!=e.type&&"Process"===e.type)switch(e.op){case"ArcadeColor":case"Transparency":yield*w(e.value);break;case"Divide":case"Add":yield*w(e.left),yield*w(e.right);break;case"Random":yield*w(e.seed),yield*w(e.min),yield*w(e.max);break;case"Cond":yield*w(e.condition),yield*w(e.ifTrue),yield*w(e.ifFalse);break;case"MatchWinding":yield*w(e.sign),yield*w(e.angle)}else if("computed"in e)yield e.computed;else for(const t in e)yield*w(e[t])}function se(o){if(!o)throw new Error("Assertion failed.")}var at=p(1416),ct=p(9908);function ie(o,e){return fe.apply(this,arguments)}function fe(){return(fe=(0,T.A)(function*(o,e,t=!1){const{defaultValue:i,valueExpressionInfo:s,value:n}=e;if(s){const{expression:r}=s,a=yield o.createComputedField({expression:r},t);return a?{...e,computed:a,defaultValue:i}:null}return{...e,computed:new ct.G(n),defaultValue:i}})).apply(this,arguments)}function we(o,e){return me.apply(this,arguments)}function me(){return(me=(0,T.A)(function*(o,e){const{valueExpressionInfo:t}=e,{expression:i}=t,s=yield o.createComputedField({expression:i});return s?{...e,computed:s}:null})).apply(this,arguments)}function ze(o){return"object"==typeof o&&null!=o&&(!(!("valueExpressionInfo"in o)||!o.valueExpressionInfo)||"type"in o&&"Process"===o.type&&"op"in o&&"Random"===o.op)}function re(o){if(Array.isArray(o))for(const e of o)if(re(e))return!0;if("object"==typeof o){if(ze(o))return!0;for(const e in o)if(re(o[e]))return!0}return!1}class pe{static create(e,t,i){return(0,T.A)(function*(){const s={},n=new Map,r=new Map,a=new Map,c=new Map,u=new Map,d=new Map;for(const l in i){const h=i[l];if(null!=h&&"object"==typeof h)if(Array.isArray(h)){if("object"==typeof h[0])throw new Error(`InternalError: Cannot handle ${l}. Nested array params are not supported`);s[l]=h}else if("valueExpressionInfo"in h){if(h.value){s[l]=h.value;continue}const y=yield we(e,h);if(!y){s[l]=h.defaultValue;continue}n.set(l,y),s[l]=null}else switch(h.type){case"cim-effect-infos":if(h.effectInfos.some(y=>y.overrides.length)){r.set(l,{effects:yield Promise.all(h.effectInfos.map(function(){var y=(0,T.A)(function*(g){const f=g.overrides.map(m=>ie(e,m));return{effect:g.effect,compiledOverrides:(yield Promise.all(f)).filter(J.Ru)}});return function(g){return y.apply(this,arguments)}}()))});break}s[l]=h.effectInfos.map(y=>y.effect);break;case"cim-marker-placement-param":h.overrides.length&&a.set(l,{placementInfo:h,compiledOverrides:(yield Promise.all(h.overrides.map(y=>ie(e,y)))).filter(J.Ru)}),s[l]=h.placement;break;case"text-rasterization-param":{if(h.overrides.length){const g=h.overrides.map(f=>ie(e,f,h.useLegacyLabelEvaluationRules));c.set(l,{compiledOverrides:(yield Promise.all(g)).filter(J.Ru),rasterizationParam:h,objectIdToResourceId:new Map});continue}const y={type:"cim-rasterization-info",resource:h.resource};s[l]=(yield t.fetchResourceImmediate(y))??null;break}case"sprite-rasterization-param":{if(h.overrides.length){const g=h.overrides.map(f=>ie(e,f));c.set(l,{compiledOverrides:(yield Promise.all(g)).filter(J.Ru),rasterizationParam:h,objectIdToResourceId:new Map});continue}if("animated"===h.resource.type){c.set(l,{compiledOverrides:[],rasterizationParam:h,objectIdToResourceId:new Map});continue}const y={type:"cim-rasterization-info",resource:h.resource};s[l]=(yield t.fetchResourceImmediate(y))??null;break}case"cim-marker-transform-param":{const{params:y}=h;if(re(y)){const g={compiledMarkerInfos:[]};yield Promise.all(y.map(function(){var f=(0,T.A)(function*(m){const x={props:{}};for(const v in m)if(ze(m[v])){const P=yield we(e,m[v]);x.compiledExpressionMap||(x.compiledExpressionMap=new Map),P&&x.compiledExpressionMap.set(v,P)}else x.props[v]=m[v];g.compiledMarkerInfos.push(x)});return function(m){return f.apply(this,arguments)}}())),u.set(l,g)}else s[l]={type:"cim-marker-transform-info",infos:y};break}case"animation-params":{const{params:y}=h,g=ot(y);if(re(g)){const f=yield Promise.all(g.map(m=>ue(m,e)));d.set(l,{params:f,propertyIdToResourceId:new Map,key:l})}else{const f=Le(g.map(e=>S(e)).map(e=>K(e).simplify())),m=yield t.fetchResourceImmediate({type:"animation-info",resource:f});null!=m&&"sprite"===m.type&&(s[l]={dataRow:m.rect.y,dataColumn:m.rect.x})}break}default:s[l]=h}else s[l]=h}return new pe(i,s,n,r,a,c,u,d)})()}constructor(e,t,i,s,n,r,a,c){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=i,this._dynamicEffectProperties=s,this._dynamicPlacementProperties=n,this._dynamicAsyncProperties=r,this._dynamicTransformProperties=a,this._dynamicAsyncAnimations=c,this.evaluator=u=>u,this._arcadeDependencies=new Set;for(const u of this._expressions())(0,st.QY)(this._arcadeDependencies,u)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,i){for(const s of this._dynamicAsyncProperties.values()){const n=(0,et.o8)(s.rasterizationParam.resource);"animated"===s.rasterizationParam.resource.type&&s.rasterizationParam.resource.randomizeStartTime&&(n.primitiveName="__RESERVED__PRIMITIVE__NAME__",n.startGroup=(0,he.A)(t.getObjectId()||0));for(const{primitiveName:a,propertyName:c,computed:u,defaultValue:d,valueExpressionInfo:l}of s.compiledOverrides)try{(0,at.Ph)(n,"animated"===s.rasterizationParam.resource.type?n.primitiveName:a,c,u,t,i,d)}catch(h){tt.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new qe.A("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${l?.expression}' (primitive: '${a}', property: '${c}')`,h))}const r=e.enqueueRequest({type:"cim-rasterization-info",resource:n});s.objectIdToResourceId.set(t.getObjectId(),r)}for(const s of this._dynamicAsyncAnimations.values()){const r=Le(s.params.map(c=>S(c,t,i)).map(K).map(c=>c.simplify())),a=e.enqueueRequest({type:"animation-info",resource:r});s.propertyIdToResourceId.set(t.getObjectId()+"."+s.key,a)}}evaluateMeshParams(e,t,i){for(const[s,n]of this._dynamicProperties.entries())this._resolvedMeshParams[s]=n.computed.readWithDefault(t,i,n.defaultValue);for(const[s,n]of this._dynamicPlacementProperties.entries())for(const{computed:r,defaultValue:a,propertyName:c}of n.compiledOverrides){const u=r.readWithDefault(t,i,a);n.placementInfo.placement[c]=u,this._resolvedMeshParams[s]=n.placementInfo.placement}for(const[s,n]of this._dynamicEffectProperties.entries())for(const r of n.effects){for(const{computed:a,defaultValue:c,propertyName:u}of r.compiledOverrides){const d=a.readWithDefault(t,i,c);r.effect[u]=d}this._resolvedMeshParams[s]=n.effects.map(a=>a.effect)}for(const[s,n]of this._dynamicTransformProperties.entries()){const r={type:"cim-marker-transform-info",infos:[]};for(const a of n.compiledMarkerInfos){const c={...a.props};if(a.compiledExpressionMap)for(const[u,d]of a.compiledExpressionMap){const l=d.computed.readWithDefault(t,i,d.defaultValue);c[u]="number"==typeof l||"boolean"==typeof l?l:d.defaultValue}r.infos.push(c)}this._resolvedMeshParams[s]=r}for(const[s,n]of this._dynamicAsyncProperties.entries()){const r=n.objectIdToResourceId.get(t.getObjectId());if(null==r)continue;const a=e.getResource(r);this._resolvedMeshParams[s]=a}for(const[s,n]of this._dynamicAsyncAnimations.entries()){const r=n.propertyIdToResourceId.get(t.getObjectId()+"."+s);if(null==r)continue;const a=e.getResource(r);this._resolvedMeshParams[s]={dataRow:a.rect.y,dataColumn:a.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}*_expressions(){for(const e of this._dynamicProperties.values())yield e.computed;for(const e of this._dynamicEffectProperties.values())for(const t of e.effects)for(const i of t.compiledOverrides)yield i.computed;for(const e of this._dynamicPlacementProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicAsyncProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicTransformProperties.values())for(const t of e.compiledMarkerInfos)if(null!=t.compiledExpressionMap)for(const i of t.compiledExpressionMap.values())yield i.computed;for(const e of this._dynamicAsyncAnimations.values())for(const t of e.params)yield*w(t)}}var ht=p(8052);class ut{createMeshWriter(e,t,i,s){var n=this;return(0,T.A)(function*(){const r=n._getMeshWriter(s.techniqueType),a=yield pe.create(e,t,s.inputParams),c=new r(s.id,a,s.optionalAttributes,i);return yield c.loadDependencies(),c})()}_getMeshWriter(e){switch(e){case A.N.Fill:return Be.Y;case A.N.DotDensity:return Re.k;case A.N.ComplexFill:return Te.KE;case A.N.PatternFill:return Fe.m;case A.N.GradientFill:return We.S;case A.N.OutlineFill:return Ge.w0;case A.N.PatternOutlineFill:return Ce.Q;case A.N.ComplexOutlineFill:return ke.O;case A.N.Marker:return Ke.H;case A.N.PieChart:return ht.v;case A.N.Text:return V.G8;case A.N.Line:return He.Bw;case A.N.TexturedLine:return Je.K;case A.N.GradientStroke:return Xe.F;case A.N.Heatmap:return Oe.h;case A.N.Label:return $e;case A.N.AnimatedMarker:return Ee;default:throw new Error("Internal Error: Mesh writer not in the registry")}}}},9908:(ye,O,p)=>{p.d(O,{G:()=>A});var T=p(32197);class A extends T.L{constructor(L){super(),this._value=L}resize(L){}read(L,E){return this._value}readWithDefault(L,E,R){return this._value}hasArcadeDependency(L){return!1}}}}]);