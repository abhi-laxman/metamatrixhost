"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[3909,9728,6773,6598,2117],{99893:(ie,H,o)=>{o.r(H),o.d(H,{constructAssociationMetaDataFeatureSetFromUrl:()=>me,constructFeatureSet:()=>V,constructFeatureSetFromPortalItem:()=>Oe,constructFeatureSetFromRelationship:()=>he,constructFeatureSetFromUrl:()=>W,convertToFeatureSet:()=>Te,createFeatureSetCollectionFromMap:()=>Ee,createFeatureSetCollectionFromService:()=>De,initialiseMetaDataCache:()=>Ke});var h=o(10467),G=o(89563);class ${constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(e,s,t){this._layerById[s]=t,this._layerByName[e]=t}featureSetByName(e,s=!0,t=["*"]){var r=this;return(0,h.A)(function*(){return void 0===r._layerByName[e]?null:r._layerByName[e]})()}featureSetById(e,s=!0,t=["*"]){var r=this;return(0,h.A)(function*(){return void 0===r._layerById[e]?null:r._layerById[e]})()}castToText(e=!1){return"object, FeatureSetCollection"}}var S=o(42686),U=o(888),N=o(81098),K=o(36455),O=o(93571),D=o(31033),I=o(85922),f=o(71505),p=o(58314),a=o(7981),A=o(97089),n=o(89998),M=o(1329);class P{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new P;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,s,t,r){const u=new P;u.field=e;const i=M.default.create(s,{fieldsIndex:t,timeZone:r}),v=function F(x){if("function"===x.parseTree.type){if(0===x.parseTree.args.value.length)return{name:x.parseTree.name,expr:null};if(x.parseTree.args.value.length>1)throw new n.L8(n.Z7.MissingStatisticParameters);const e=M.default.create((0,A.Mi)(x.parseTree.args.value[0],a.zl.Standardised,x.parameters),{fieldsIndex:x.fieldsIndex,timeZone:x.timeZone,currentUser:x.currentUser});return{name:x.parseTree.name,expr:e}}return null}(i);if(null===v)throw new n.L8(n.Z7.UnsupportedSqlFunction,{function:""});const _=v.name.toUpperCase().trim();if("MIN"===_){if(u.typeofstat="MIN",u.workingexpr=v.expr,null===i)throw new n.L8(n.Z7.InvalidFunctionParameters,{function:"min"})}else if("MAX"===_){if(u.typeofstat="MAX",u.workingexpr=v.expr,null===i)throw new n.L8(n.Z7.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===_)u.typeofstat="COUNT",u.workingexpr=v.expr;else if("STDEV"===_){if(u.typeofstat="STDDEV",u.workingexpr=v.expr,null===i)throw new n.L8(n.Z7.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===_){if(u.typeofstat="SUM",u.workingexpr=v.expr,null===i)throw new n.L8(n.Z7.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===_){if(u.typeofstat="AVG",u.workingexpr=v.expr,null===i)throw new n.L8(n.Z7.InvalidFunctionParameters,{function:_})}else if("AVG"===_){if(u.typeofstat="AVG",u.workingexpr=v.expr,null===i)throw new n.L8(n.Z7.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==_)throw new n.L8(n.Z7.UnsupportedSqlFunction,{function:_});if(u.typeofstat="VAR",u.workingexpr=v.expr,null===i)throw new n.L8(n.Z7.InvalidFunctionParameters,{function:"var"})}return u}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var w=o(55144),m=o(21327),d=o(87257),E=o(16924),g=o(29752),l=o(32034),c=o(29141),C=o(73258);function j(x){if(!x)return"COUNT";switch(x.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class B extends I.A{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var s=this;return(0,h.A)(function*(){if(null===s._wset){const t=yield s._getFilteredSet("",null,null,null,e);return s._wset=t,s._wset}return s._wset})()}_isInFeatureSet(){return a.J6.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const s="T"+this._uniqueIds.toString();return e[s]=1,s}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let s=!1,t=1;const r=this._parent?this._parent.getFieldsIndex():new C.A([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===s;){let i=!1;for(let v=0;v<this._config.groupbyfields.length;v++)if(this._config.groupbyfields[v].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(let v=0;v<this._config.statsfields.length;v++)if(this._config.statsfields[v].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?s=!0:(this.objectIdField="ROW__ID"+t.toString(),t++)}for(const i of this._config.statsfields){const v=new P;v.field=i.name,v.tofieldname=i.name,v.workingexpr=i.expression instanceof M.default?i.expression:M.default.create(i.expression,{fieldsIndex:r,timeZone:this.dateFieldsTimeZoneDefaultUTC}),v.typeofstat=j(i.statistic),this._decodedStatsfield.push(v)}this._decodedGroupbyfield=[];for(const i of this._config.groupbyfields){const v={name:i.name,singlefield:null,tofieldname:i.name,expression:i.expression instanceof M.default?i.expression:M.default.create(i.expression,{fieldsIndex:r,timeZone:this.dateFieldsTimeZoneDefaultUTC}),sqlType:null};this._decodedGroupbyfield.push(v)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const i of this._parent.fields)e[i.name.toUpperCase()]=1;this.types=null,this.subtypes=null,this.subtypeField=""}else this.geometryType=a.ik.point,this.typeIdField="",this.types=null,this.subtypes=null,this.subtypeField="",this.spatialReference=new l.A({wkid:4326});this.fields=[];const u=new P;u.field=this._nextUniqueName(e),u.tofieldname=this.objectIdField,u.workingexpr=M.default.create(this._parent.objectIdField,{fieldsIndex:this._parent.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC}),u.typeofstat="MIN",this._decodedStatsfield.push(u);for(const i of this._decodedGroupbyfield){const v=new c.A;if(i.name=this._nextUniqueName(e),v.name=i.tofieldname,v.alias=v.name,(0,A.DA)(i.expression)){const _=this._parent.getField((0,A.YY)(i.expression,a.zl.Standardised));if(!_)throw new D.dr(D.D_.AggregationFieldNotFound);i.name=_.name,i.singlefield=_.name,this.phsyicalgroupbyfields.push(_.name),v.type=_.type,i.sqlType=_.type}else{v.type=this._convertToEsriFieldType((0,A.IY)(i.expression,this._parent.fields));const _=new c.A;_.name=i.name,_.alias=_.name,this.phsyicalgroupbyfields.push(i.name),this._adaptedFields.push(new K.Gr(_,i.expression)),this._candosimplegroupby=!1,i.sqlType=v.type}this.fields.push(v)}if(this._adaptedFields.length>0)for(const i of this._parent.fields)this._adaptedFields.push(new K.IO(i));for(let i=0;i<this._decodedStatsfield.length;i++){const v=new c.A;let _=null;const T=this._decodedStatsfield[i];T.field=this._nextUniqueName(e),T.tofieldname===this.objectIdField&&(this._internalObjectIdField=T.field),v.name=T.tofieldname,v.alias=v.name;const L=null!==T.workingexpr&&(0,A.DA)(T.workingexpr)?(0,A.YY)(T.workingexpr,a.zl.Standardised):"";switch(this._decodedStatsfield[i].typeofstat){case"SUM":if(""!==L){if(_=this._parent.getField(L),!_)throw new D.dr(D.D_.AggregationFieldNotFound);v.type=_.type}else v.type="double";break;case"MIN":case"MAX":if(""!==L){if(_=this._parent.getField(L),!_)throw new D.dr(D.D_.AggregationFieldNotFound);v.type=_.type}else v.type="double";break;case"COUNT":v.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==L&&(_=this._parent.getField(L),!_))throw new D.dr(D.D_.AggregationFieldNotFound);v.type="double"}this.fields.push(v)}}_canDoAggregates(){return(0,h.A)(function*(){return!1})()}_getFeatures(e,s,t,r){var u=this;return(0,h.A)(function*(){const i=u._maxQuery;return!0===u._checkIfNeedToExpandKnownPage(e,i)?(yield u._expandPagedSet(e,i,0,0,r),u._getFeatures(e,s,t,r)):"success"})()}_getFilteredSet(e,s,t,r,u){var i=this;return(0,h.A)(function*(){if(""!==e)return new f.A([],[],!0,null);let v=null;const _={ordered:!1,nowhereclause:!1};if(yield i._ensureLoaded(),null!==t)for(let L=0;L<i._decodedStatsfield.length;L++)if(!0===(0,A.Ju)(t,i._decodedStatsfield[L].tofieldname)){_.nowhereclause=!0,t=null;break}if(null!==r){_.ordered=!0;for(let L=0;L<i._decodedStatsfield.length;L++)if(!0===r.scanForField(i._decodedStatsfield[L].tofieldname)){r=null,_.ordered=!1;break}if(null!==r)for(const L of i._decodedGroupbyfield)if(null===L.singlefield&&!0===r.scanForField(L.tofieldname)){r=null,_.ordered=!1;break}}if(!1!==i._candosimplegroupby&&(yield i._parent._canDoAggregates(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,null))){let L=null;t&&(L=i._reformulateWhereClauseWithoutGroupByFields(t));let Q=null;r&&(Q=i._reformulateOrderClauseWithoutGroupByFields(r));const Y=yield i._parent._getAggregatePagesDataSourceDefinition(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,L,Q,i._internalObjectIdField);return i._checkCancelled(u),v=!0===_.nowhereclause?new f.A(Y._candidates.slice().concat(Y._known.slice()),[],!0===_.ordered&&Y._ordered,i._clonePageDefinition(Y.pagesDefinition)):new f.A(Y._candidates.slice(),Y._known.slice(),!0===_.ordered&&Y._ordered,i._clonePageDefinition(Y.pagesDefinition)),v}let T=i._parent;if(i._adaptedFields.length>0&&(T=new K.a({parentfeatureset:i._parent,adaptedFields:i._adaptedFields,extraFilter:null})),!0===_.nowhereclause)v=new f.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new O.A({parentfeatureset:T,orderbyclause:new p.A(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}});else{let L=T;if(null!==t){let Q=null;t&&(Q=i._reformulateWhereClauseWithoutGroupByFields(t)),L=new U.A({parentfeatureset:L,whereclause:Q})}v=new f.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new O.A({parentfeatureset:L,orderbyclause:new p.A(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}})}return v})()}_reformulateWhereClauseWithoutStatsFields(e){for(const s of this._decodedStatsfield)e=(0,A.bD)(e,s.tofieldname,(0,A.YY)(s.workingexpr,a.zl.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const s of this._decodedGroupbyfield)s.tofieldname!==s.name&&(e=(0,A.bD)(e,s.tofieldname,(0,A.YY)(s.expression,a.zl.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const s=[];for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&s.push({field:t.tofieldname,newfield:t.name});return s.length>0?e.replaceFields(s):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,s,t){var r=this;return(0,h.A)(function*(){return!0===r._checkIfNeedToExpandCandidatePage(e,r._maxQuery)?(yield r._expandPagedSet(e,r._maxQuery,0,0,t),r._refineSetBlock(e,s,t)):(r._checkCancelled(t),r._refineKnowns(e,s),e)})()}_expandPagedSet(e,s,t,r,u){return this._expandPagedSetFeatureSet(e,s,t,r,u)}_getPhysicalPage(e,s,t){var r=this;return(0,h.A)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return r._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,t,[]);const u=yield r._getAgregagtePhysicalPage(e,s,t);for(const i of u){const v={geometry:i.geometry,attributes:{}},_={};for(const T in i.attributes)_[T.toLowerCase()]=i.attributes[T];for(const T of r._decodedGroupbyfield)v.attributes[T.tofieldname]=_[T.name.toLowerCase()];for(const T of r._decodedStatsfield)v.attributes[T.tofieldname]=_[T.field.toLowerCase()];r._featureCache[v.attributes[r.objectIdField]]=new N.A(v)}return u.length})()}_sequentialGetPhysicalItem(e,s,t,r){return new Promise((u,i)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(t)),!0===e.pagesDefinition.internal.fullyResolved||0===s?u(r.length):this._nextAggregateItem(e,s,t,r,v=>{u(null===v?r.length:this._sequentialGetPhysicalItem(e,s-=1,t,r))},i)})}_nextAggregateItem(e,s,t,r,u,i){try{(0,S._)(e.pagesDefinition.internal.iterator.next()).then(v=>{if(null===v)if(null!==e.pagesDefinition.internal.workingItem){const _=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);r.push(_),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(_.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,u(null)}else e.pagesDefinition.internal.fullyResolved=!0,u(null);else{const _=this._generateAggregateHash(v);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[v],id:_};else{if(_!==e.pagesDefinition.internal.workingItem.id){const T=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return r.push(T),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(T.attributes[this.objectIdField]),s-=1,e.pagesDefinition.internal.workingItem={features:[v],id:_},void u(T)}e.pagesDefinition.internal.workingItem.features.push(v)}this._nextAggregateItem(e,s,t,r,u,i)}},i)}catch(v){i(v)}}_calculateFieldStat(e,s,t){const r=[];for(const u of e.features)if(null!==s.workingexpr){const i=s.workingexpr.calculateValue(u);null!==i&&r.push(i instanceof d.n||i instanceof g.k?i.toNumber():i instanceof E.g?i.toMilliseconds():i)}else r.push(null);t.attributes[s.tofieldname]=(0,m.s)(s.typeofstat,[r])}_calculateAndAppendAggregateItem(e){const s={attributes:{},geometry:null};for(const r of this._decodedGroupbyfield){const u=r.singlefield?e.features[0].attributes[r.singlefield]:M.default.convertValueToStorageFormat(r.expression.calculateValue(e.features[0]),r.sqlType);s.attributes[r.tofieldname]=u}for(const r of this._decodedStatsfield)this._calculateFieldStat(e,r,s);const t=[];for(let r=0;r<this._decodedStatsfield.length;r++)t.push(this._calculateFieldStat(e,this._decodedStatsfield[r],s));return this._featureCache[s.attributes[this.objectIdField]]=new N.A({attributes:s.attributes,geometry:s.geometry}),s}_generateAggregateHash(e){let s="";for(const t of this._decodedGroupbyfield){const r=t.singlefield?e.attributes[t.singlefield]:t.expression.calculateValue(e);s+=null==r?":":":"+r.toString()}return(0,w.d)(s,w.T.String)}_stat(){return(0,h.A)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,h.A)(function*(){return null})()}static registerAction(){I.A._featuresetFunctions.groupby=function(e,s){return new B({parentfeatureset:this,groupbyfields:e,statsfields:s})}}}var b=o(57120),R=o(53437),k=o(77469),z=o(84462),X=o(53787),re=o(7425),ue=o(63484),Re=o(61320),xe=o(58701),ve=o(35940),ke=o(52466),je=o(87086),Ue=o(16842);class Ce extends I.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a.gO}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const s=this.urlQueryPath+","+(0,a.JB)(e.toJSON());return(0,w.d)(s,w.T.String)}loadImpl(){var e=this;return(0,h.A)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType??"",this.fields=this._layer.fields.slice(),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],s=[];for(const t of this.fields)if("oid"===t.type)e.push(t),s.push(t.name);else for(const r of this._overrideFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t),s.push(t.name);break}this.fields=e,this._overrideFields=s}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=a.zl.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=a.zl.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=a.zl.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=a.zl.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.typeIdField=("typeIdField"in this._layer?this._layer.typeIdField:null)??"",this.types="types"in this._layer?this._layer.types:null}_isInFeatureSet(){return a.J6.InFeatureSet}_refineSetBlock(e){return(0,h.A)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var s=this;return(0,h.A)(function*(){if(null===s._wset){yield s._ensureLoaded();const t=yield s._getFilteredSet("",null,null,null,e);return s._wset=t,t}return s._wset})()}_runDatabaseProbe(e){var s=this;return(0,h.A)(function*(){yield s._ensureLoaded();const t=new je.A;s.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t.where=e.replace("OBJECTID",s._layer.objectIdField);try{return yield s._layer.queryObjectIds(t),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}_createQuery(){const e=this._layer.createQuery();return e.returnZ=this.hasZ,e.returnM=this.hasM,this.datesInUnknownTimezone&&(e.timeReferenceUnknownClient=!0),this._requestStandardised&&(e.sqlFormat="standard"),this._useDefinitionExpression?"subtype-group"===this._layer.type&&(e.where=this._layer.definitionExpression):e.where=null,e}executeQuery(e,s){const t="execute"===s?this._layer.queryFeatures.bind(this._layer):"executeForCount"===s?this._layer.queryFeatureCount.bind(this._layer):this._layer.queryObjectIds.bind(this._layer);let r=null;if(this.recentlyUsedQueries){const u=this.convertQueryToLruCacheKey(e);r=this.recentlyUsedQueries.getFromCache(u),null===r&&(r=t(e),this.recentlyUsedQueries.addToCache(u,r),r=r.catch(i=>{throw this.recentlyUsedQueries?.removeFromCache(u),i}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:s}),null===r&&(r=t(e)),r}_getFilteredSet(e,s,t,r,u){var i=this;return(0,h.A)(function*(){const v=yield i.databaseType();if(i.isTable()&&s&&null!==e&&""!==e)return new f.A([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,s,t,r,u);let _="",T=!1;null!==r&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(_=r.constructClause(),T=!0);const L=i._createQuery();L.where=(0,ue.mA)(L.where,null===t?null===s?"1=1":"":(0,A.YY)(t,v)),L.spatialRelationship=i._makeRelationshipEnum(e),L.outSpatialReference=i.spatialReference,L.orderByFields=""!==_?_.split(","):null,L.geometry=null===s?null:s,L.relationParameter=i._makeRelationshipParam(e);let Q=yield i.executeQuery(L,"executeForIds");return null===Q&&(Q=[]),i._checkCancelled(u),new f.A([],Q,T,null)})()}_expandPagedSet(e,s,t,r,u){return this._expandPagedSetFeatureSet(e,s,t,r,u)}_getFilteredSetUsingPaging(e,s,t,r,u){var i=this;return(0,h.A)(function*(){let v="",_=!1;null!==r&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(v=r.constructClause(),_=!0);const T=yield i.databaseType(),L=null===t?null===s?"1=1":"":(0,A.YY)(t,T);let Q=i._maxQueryRate();const Y=i._layer.capabilities?.query.maxRecordCount;null!=Y&&Y<Q&&(Q=Y);let ee=null;if(!0===i._pageJustIds)ee=new f.A([],["GETPAGES"],_,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:Q,resultOffset:0,geometry:null===s?null:s,where:L,orderByFields:v,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let q=!0;!0===i._removeGeometry&&(q=!1);const ae=i._overrideFields??i._fieldsIncludingObjectId(["*"]);ee=new f.A([],["GETPAGES"],_,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:ae.join(","),resultRecordCount:Q,resultOffset:0,geometry:null===s?null:s,where:L,orderByFields:v,returnGeometry:q,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield i._expandPagedSet(ee,Q,0,1,u),ee})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,s,t){var r=this;return(0,h.A)(function*(){const u=e.pagesDefinition.internal.lastRetrieved,i=u,v=e.pagesDefinition.internal.lastPage,_=r._createQuery();_.spatialRelationship=e.pagesDefinition.spatialRel,_.relationParameter=e.pagesDefinition.relationParam,_.outFields=e.pagesDefinition.outFields.split(","),_.num=e.pagesDefinition.resultRecordCount,_.start=e.pagesDefinition.internal.lastPage,_.geometry=e.pagesDefinition.geometry,_.where=(0,ue.mA)(_.where,e.pagesDefinition.where),_.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,_.returnGeometry=e.pagesDefinition.returnGeometry,_.outSpatialReference=r.spatialReference;const T=yield r.executeQuery(_,"execute");if(r._checkCancelled(t),e.pagesDefinition.internal.lastPage!==v)return"done";const L=r._layer.objectIdField;for(let Q=0;Q<T.features.length;Q++)e.pagesDefinition.internal.set[i+Q]=T.features[Q].attributes[L];if(!1===r._pageJustIds)for(let Q=0;Q<T.features.length;Q++)r._featureCache[T.features[Q].attributes[L]]=T.features[Q];return(void 0===T.exceededTransferLimit&&T.features.length!==e.pagesDefinition.resultRecordCount||!1===T.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=u+T.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const s=e.slice();if(s.includes("*"))return s;let t=!1;for(const r of s)if(r.toUpperCase()===this.objectIdField.toUpperCase()){t=!0;break}return!1===t&&s.push(this.objectIdField),s}_getFeatures(e,s,t,r){var u=this;return(0,h.A)(function*(){const i=[];if(-1!==s&&void 0===u._featureCache[s]&&i.push(s),!0===u._checkIfNeedToExpandKnownPage(e,u._maxProcessingRate()))return yield u._expandPagedSet(e,u._maxProcessingRate(),0,0,r),u._getFeatures(e,s,t,r);let v=0;for(let Q=e._lastFetchedIndex;Q<e._known.length;Q++){if(e._lastFetchedIndex+=1,v++,void 0===u._featureCache[e._known[Q]]){let Y=!1;if(null!=u._layer._mode){const ee=u._layer._mode;if(void 0!==ee._featureMap[e._known[Q]]){const q=ee._featureMap[e._known[Q]];null!==q&&(Y=!0,u._featureCache[e._known[Q]]=q)}}if(!1===Y&&(e._known[Q]!==s&&i.push(e._known[Q]),i.length>=u._maxProcessingRate()-1))break}if(v>=t&&0===i.length)break}if(0===i.length)return"success";const _=u._createQuery();_.objectIds=i,_.outFields=u._overrideFields??u._fieldsIncludingObjectId(["*"]),_.returnGeometry=!0,!0===u._removeGeometry&&(_.returnGeometry=!1),_.outSpatialReference=u.spatialReference;const T=yield u.executeQuery(_,"execute");if(u._checkCancelled(r),void 0!==T.error)throw new D.dr(D.D_.RequestFailed,{reason:T.error});const L=u._layer.objectIdField;for(let Q=0;Q<T.features.length;Q++)u._featureCache[T.features[Q].attributes[L]]=T.features[Q];return"success"})()}_getDistinctPages(e,s,t,r,u,i,v,_,T){var L=this;return(0,h.A)(function*(){yield L._ensureLoaded();const Q=yield L.databaseType();let Y=t.parseTree.column;const ee=L._layer.fields??[];for(let se=0;se<ee.length;se++)if(ee[se].name.toLowerCase()===Y.toLowerCase()){Y=ee[se].name;break}const q=L._createQuery();q.where=(0,ue.mA)(q.where,null===i?null===u?"1=1":"":(0,A.YY)(i,Q)),q.spatialRelationship=L._makeRelationshipEnum(r),q.relationParameter=L._makeRelationshipParam(r),q.geometry=null===u?null:u,q.returnDistinctValues=!0,q.returnGeometry=!1,q.outFields=[Y];const ae=yield L.executeQuery(q,"execute");if(L._checkCancelled(T),!ae.hasOwnProperty("features"))throw new D.dr(D.D_.InvalidStatResponse);let pe=!1;for(let se=0;se<ee.length;se++)if(ee[se].name===Y){"date"===ee[se].type&&(pe=!0);break}for(let se=0;se<ae.features.length;se++){if(pe){const le=ae.features[se].attributes[Y];_.push(null!==le?new Date(le):le)}else _.push(ae.features[se].attributes[Y]);if(_.length>=v)break}return 0===ae.features.length?_:ae.features.length===L._layer.capabilities?.query.maxRecordCount&&_.length<v?{calculated:!0,result:yield L._getDistinctPages(e+ae.features.length,s,t,r,u,i,v,_,T)}:_})()}_distinctStat(e,s,t,r,u,i,v){var _=this;return(0,h.A)(function*(){return{calculated:!0,result:yield _._getDistinctPages(0,e,s,t,r,u,i,[],v)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,s,t,r){var u=this;return(0,h.A)(function*(){const i=yield u.databaseType();if(u.isTable()&&t&&null!==s&&""!==s)return{calculated:!0,result:0};const v=u._createQuery();return v.where=(0,ue.mA)(v.where,null===r?null===t?"1=1":"":(0,A.YY)(r,i)),v.spatialRelationship=u._makeRelationshipEnum(s),v.relationParameter=u._makeRelationshipParam(s),v.geometry=null===t?null:t,v.returnGeometry=!1,{calculated:!0,result:yield u.executeQuery(v,"executeForCount")}})()}_stats(e,s,t,r,u,i,v){var _=this;return(0,h.A)(function*(){yield _._ensureLoaded();const T=_._layer.capabilities?.query,L=!!T?.supportsSqlExpression,Q=!!T?.supportsStatistics,Y=!!T?.supportsDistinct;if("count"===e)return Y?_._countstat(e,t,r,u):{calculated:!1};if(!1===Q||!1===(0,A.DA)(s)&&!1===L||!1===s.isStandardized)return""!==t||null!==u?{calculated:!1}:_._manualStat(e,s,i,v);if("distinct"===e)return!1===Y?""!==t||null!==u?{calculated:!1}:_._manualStat(e,s,i,v):_._distinctStat(e,s,t,r,u,i,v);const ee=yield _.databaseType();if(_.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:null};const q=_._createQuery();q.where=(0,ue.mA)(q.where,null===u?null===r?"1=1":"":(0,A.YY)(u,ee)),q.spatialRelationship=_._makeRelationshipEnum(t),q.relationParameter=_._makeRelationshipParam(t),q.geometry=null===r?null:r;const ae=new Ue.A;ae.statisticType=(0,re.Dp)(e),ae.onStatisticField=(0,A.YY)(s,ee),ae.outStatisticFieldName="ARCADE_STAT_RESULT",q.returnGeometry=!1;let pe="ARCADE_STAT_RESULT";q.outStatistics=[ae];const se=yield _.executeQuery(q,"execute");if(!se.hasOwnProperty("features")||0===se.features.length)throw new D.dr(D.D_.InvalidStatResponse);let le=!1;const We=se.fields??[];for(let Fe=0;Fe<We.length;Fe++)if("ARCADE_STAT_RESULT"===We[Fe].name.toUpperCase()){pe=We[Fe].name,"date"===We[Fe].type&&(le=!0);break}if(le){let Fe=se.features[0].attributes[pe];return null!==Fe&&(Fe=new Date(se.features[0].attributes[pe])),{calculated:!0,result:Fe}}return{calculated:!0,result:se.features[0].attributes[pe]}})()}_stat(e,s,t,r,u,i,v){return this._stats(e,s,t,r,u,i,v)}_canDoAggregates(e,s){var t=this;return(0,h.A)(function*(){yield t._ensureLoaded();let r=!1;const u=t._layer.capabilities?.query,i=!0===u?.supportsSqlExpression;if(null!=u&&!0===u.supportsStatistics&&!0===u.supportsOrderBy&&(r=!0),r)for(let v=0;v<s.length-1;v++)(!1===s[v].workingexpr?.isStandardized||!1===(0,A.DA)(s[v].workingexpr)&&!1===i)&&(r=!1);return!1!==r})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,s,t,r,u,i,v){var _=this;return(0,h.A)(function*(){yield _._ensureLoaded();const T=yield _.databaseType();let L="",Q=!1,Y=!1;null!==i&&_._layer.capabilities&&_._layer.capabilities.query&&!0===_._layer.capabilities.query.supportsOrderBy&&(L=i.constructClause(),Y=!0),_._layer.capabilities&&_._layer.capabilities.query&&!1===_._layer.capabilities.query.supportsPagination&&(Y=!1,Q=!0,L=_._layer.objectIdField);const ee=[];for(let se=0;se<s.length;se++){const le=new Ue.A;le.onStatisticField=null!==s[se].workingexpr?(0,A.YY)(s[se].workingexpr,T):"",le.outStatisticFieldName=s[se].field,le.statisticType=s[se].toStatisticsName(),ee.push(le)}""===L&&(L=e.join(","));let q=_._maxQueryRate();const ae=_._layer.capabilities?.query.maxRecordCount;null!=ae&&ae<q&&(q=ae);const pe=null===u?null===r?"1=1":"":(0,A.YY)(u,T);return new f.A([],["GETPAGES"],Y,{groupbypage:!0,spatialRel:_._makeRelationshipEnum(t),relationParam:_._makeRelationshipParam(t),outFields:["*"],useOIDpagination:Q,generatedOid:v,resultRecordCount:q,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:ee,geometry:null===r?null:r,where:pe,orderByFields:L,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,s,t){var r=this;return(0,h.A)(function*(){let u=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(u=(0,ue.mA)(u,e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()));const i=e.pagesDefinition.internal.lastRetrieved,v=i,_=e.pagesDefinition.internal.lastPage,T=r._createQuery();if(T.where=(0,ue.mA)(T.where,u),T.spatialRelationship=e.pagesDefinition.spatialRel,T.relationParameter=e.pagesDefinition.relationParam,T.outFields=e.pagesDefinition.outFields,T.outStatistics=e.pagesDefinition.outStatistics,T.geometry=e.pagesDefinition.geometry,T.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,T.num=e.pagesDefinition.resultRecordCount,T.start=e.pagesDefinition.internal.lastPage,T.returnGeometry=e.pagesDefinition.returnGeometry,T.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,r.isTable()&&T.geometry&&T.spatialRelationship)return[];const L=yield r.executeQuery(T,"execute");if(r._checkCancelled(t),!L.hasOwnProperty("features"))throw new D.dr(D.D_.InvalidStatResponse);const Q=[];if(e.pagesDefinition.internal.lastPage!==_)return[];L.features.length>0&&void 0===L.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let Y=0;Y<L.features.length;Y++)e.pagesDefinition.internal.set[v+Y]=L.features[Y].attributes[e.pagesDefinition.generatedOid];for(let Y=0;Y<L.features.length;Y++)Q.push(new N.A({attributes:L.features[Y].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===L.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=L.features[L.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===L.exceededTransferLimit&&L.features.length!==e.pagesDefinition.resultRecordCount||!1===L.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+L.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,Q})()}static create(e,s,t,r,u){const i=new ve.default({url:e,outFields:null===s?["*"]:s});return new Ce({layer:i,spatialReference:t,lrucache:r,interceptor:u})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,a.Qi)(this._layer.parsedUrl.path)}queryAttachments(e,s,t,r,u){var i=this;return(0,h.A)(function*(){const _=i._layer;if(function v(T){const L=T.capabilities;return L?.data.supportsAttachment&&L?.operations.supportsQueryAttachments}(_)){const T={objectIds:[e],returnMetadata:u};(s&&s>0||t&&t>0)&&(T.size=[s&&s>0?s:0,t&&t>0?t:s+1]),r&&r.length>0&&(T.attachmentTypes=r),i.featureSetQueryInterceptor&&i.featureSetQueryInterceptor.preLayerQueryCallback({layer:_,query:T,method:"attachments"});const L=yield _.queryAttachments(new ke.A(T)),Q=[];return L&&L[e]&&L[e].forEach(Y=>{const ee=i._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+Y.id.toString();let q=null;u&&Y.exifInfo&&(q=X.A.convertJsonToArcade(Y.exifInfo,"system",!0)),Q.push(new z.A(Y.id,Y.name,Y.contentType,Y.size,ee,q,Y.keywords??null))}),Q}return[]})()}queryRelatedFeatures(e){var s=this;return(0,h.A)(function*(){const t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=(0,xe.YX)(e.outSpatialReference)),s.featureSetQueryInterceptor&&s.featureSetQueryInterceptor.preRequestCallback({layer:s._layer,queryPayload:t,method:"relatedrecords",url:s._layer.parsedUrl.path+"/queryRelatedRecords"});const r=yield(0,G.A)(s._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t});if(r.data){const u={},i=r.data;if(i?.relatedRecordGroups){const v=i.spatialReference;for(const _ of i.relatedRecordGroups){const T=_.objectId,L=[];for(const Q of _.relatedRecords){Q.geometry&&(Q.geometry.spatialReference=v);const Y=new N.A({geometry:Q.geometry?(0,Re.rS)(Q.geometry):null,attributes:Q.attributes});L.push(Y)}u[T]={features:L,exceededTransferLimit:!0===i.exceededTransferLimit}}}return u}throw new D.dr(D.D_.InvalidRequest)})()}getFeatureByObjectId(e,s){var t=this;return(0,h.A)(function*(){const r=t._createQuery();r.outFields=s,r.returnGeometry=!1,r.outSpatialReference=t.spatialReference,r.where=(0,ue.mA)(r.where,t.objectIdField+"="+e.toString()),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preLayerQueryCallback({layer:t._layer,query:r,method:"execute"});const u=yield t._layer.queryFeatures(r);return 1===u.features.length?u.features[0]:null})()}getIdentityUser(){var e=this;return(0,h.A)(function*(){yield e.load();const s=k.id?.findCredential(e._layer.url);return s?s.userId:null})()}getOwningSystemUrl(){var e=this;return(0,h.A)(function*(){yield e.load();const s=k.id?.findServerInfo(e._layer.url);if(s)return s.owningSystemUrl;let t=e._layer.url;const r=t.toLowerCase().indexOf("/rest/services");if(t=r>-1?t.slice(0,r):t,t){t+="/rest/info";try{const u=yield(0,G.A)(t,{query:{f:"json"}});let i="";return u.data?.owningSystemUrl&&(i=u.data.owningSystemUrl),i}catch{return""}}return""})()}getDataSourceFeatureSet(){const e=new Ce({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone??!1}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,h.A)(function*(){if(e.fsetInfo)return e.fsetInfo;let s=null,t="serviceItemId"in e._layer?e._layer.serviceItemId:null;const r=e._layer.parsedUrl.path;if(r){const i=yield(0,G.A)(r,{responseType:"json",query:{f:"json"}});s=i?.data?.name??null,t=i?.data?.serviceItemId??null}const u=e._layer.title&&null!==(e._layer.parent??null);return e.featureSetInfo={layerId:e._layer.layerId,layerName:""===s?null:s,itemId:""===t?null:t,serviceLayerUrl:""===r?null:r,webMapLayerId:u?e._layer.id??null:null,webMapLayerTitle:u?e._layer.title??null:null,className:null,objectClassId:null},e.fsetInfo})()}}var Ne=o(6491),be=o(59487);class Ge extends I.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a.gO}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,h.A)(function*(){return yield Promise.all([e._layer.load(),e._relatedLayer?.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const s=[],t=[];for(const r of this.fields)if("oid"===r.type)s.push(r),t.push(r.name);else for(const u of this._overrideFields)if(u.toLowerCase()===r.name.toLowerCase()){s.push(r),t.push(r.name);break}this.fields=s,this._overrideFields=t}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types,this.subtypeField=this._relatedLayer.subtypeField,this.subtypes=this._relatedLayer.subtypes}databaseType(){var e=this;return(0,h.A)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return a.J6.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var s=this;return(0,h.A)(function*(){if(null===s._wset){yield s._ensureLoaded();const t=yield s._getFilteredSet("",null,null,null,e);return s._wset=t,t}return s._wset})()}_changeFeature(e){const s={};for(const t of this.fields)s[t.name]=e.attributes[t.name];return new N.A({geometry:!0===this._removeGeometry?null:e.geometry,attributes:s})}_getFilteredSet(e,s,t,r,u){var i=this;return(0,h.A)(function*(){if(yield i.databaseType(),i.isTable()&&s&&null!==e&&""!==e)return new f.A([],[],!0,null);const v=i._layer.nativeCapabilities();if(!1===v.canQueryRelated)return new f.A([],[],!0,null);if(v.capabilities?.queryRelated.supportsPagination)return i._getFilteredSetUsingPaging(e,s,t,r,u);let _="",T=!1;null!==r&&!0===v.capabilities?.queryRelated.supportsOrderBy&&(_=r.constructClause(),T=!0);const L=new be.default;L.objectIds=[i._findObjectId];const Q=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._relatedLayer.fields?i._relatedLayer.fields.map(le=>le.name):["*"]);L.outFields=Q,L.relationshipId=i.relationship.id,L.where="1=1";let Y=!0;!0===i._removeGeometry&&(Y=!1),L.returnGeometry=Y,i._requestStandardised&&(L.sqlFormat="standard"),L.outSpatialReference=i.spatialReference,L.orderByFields=""!==_?_.split(","):null;const ee=yield v.source.queryRelatedFeatures(L);i._checkCancelled(u);const q=ee[i._findObjectId]?ee[i._findObjectId].features:[],ae=[];for(let le=0;le<q.length;le++)i._featureCache[q[le].attributes[i._relatedLayer.objectIdField]]=q[le],ae.push(q[le].attributes[i._relatedLayer.objectIdField]);const pe=s&&null!==e&&""!==e,se=null!=t;return new f.A(pe||se?ae:[],pe||se?[]:ae,T,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const s=e.slice();if(s.includes("*"))return s;let t=!1;for(const r of s)if(r.toUpperCase()===this.objectIdField.toUpperCase()){t=!0;break}return!1===t&&s.push(this.objectIdField),s}_getFilteredSetUsingPaging(e,s,t,r,u){var i=this;return(0,h.A)(function*(){let v="",_=!1;const T=i._layer.nativeCapabilities();null!==r&&!0===T.capabilities?.queryRelated.supportsOrderBy&&(v=r.constructClause(),_=!0),yield i.databaseType();let Q=i._maxQueryRate();const Y=T.capabilities?.query.maxRecordCount;null!=Y&&Y<Q&&(Q=Y);const ee=s&&null!==e&&""!==e,q=null!=t;let ae=null,pe=!0;!0===i._removeGeometry&&(pe=!1);const se=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._relatedLayer.fields?i._relatedLayer.fields.map(le=>le.name):["*"]);return ae=new f.A(ee||q?["GETPAGES"]:[],ee||q?[]:["GETPAGES"],_,{outFields:se.join(","),resultRecordCount:Q,resultOffset:0,objectIds:[i._findObjectId],where:"1=1",orderByFields:v,returnGeometry:pe,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield i._expandPagedSet(ae,Q,0,0,u),ae})()}_expandPagedSet(e,s,t,r,u){return this._expandPagedSetFeatureSet(e,s,t,r,u)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,s,t){var r=this;return(0,h.A)(function*(){const u=e.pagesDefinition.internal.lastRetrieved,i=u,v=e.pagesDefinition.internal.lastPage,_=r._layer.nativeCapabilities(),T=new be.default;!0===r._requestStandardised&&(T.sqlFormat="standard"),T.relationshipId=r.relationship.id,T.objectIds=e.pagesDefinition.objectIds,T.resultOffset=e.pagesDefinition.internal.lastPage,T.resultRecordCount=e.pagesDefinition.resultRecordCount,T.outFields=e.pagesDefinition.outFields.split(","),T.where=e.pagesDefinition.where,T.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,T.returnGeometry=e.pagesDefinition.returnGeometry,T.outSpatialReference=r.spatialReference;const L=yield _.source.queryRelatedFeatures(T);if(r._checkCancelled(t),e.pagesDefinition.internal.lastPage!==v)return 0;const Q=L[r._findObjectId]?L[r._findObjectId].features:[];for(let ee=0;ee<Q.length;ee++)e.pagesDefinition.internal.set[i+ee]=Q[ee].attributes[r._relatedLayer.objectIdField];for(let ee=0;ee<Q.length;ee++)r._featureCache[Q[ee].attributes[r._relatedLayer.objectIdField]]=Q[ee];return Q.length!==e.pagesDefinition.resultRecordCount&&(!L[r._findObjectId]||!1===L[r._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=u+Q.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,Q.length})()}_getFeatures(e,s,t,r){var u=this;return(0,h.A)(function*(){const i=[];-1!==s&&void 0===u._featureCache[s]&&i.push(s);const v=u._maxQueryRate();if(!0===u._checkIfNeedToExpandKnownPage(e,v))return yield u._expandPagedSet(e,v,0,0,r),u._getFeatures(e,s,t,r);let _=0;for(let T=e._lastFetchedIndex;T<e._known.length&&(_++,_<=t&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[T]&&void 0===u._featureCache[e._known[T]]&&(e._known[T]!==s&&i.push(e._known[T]),i.length>t)))&&!(_>=t&&0===i.length);T++);if(0===i.length)return"success";throw new D.dr(D.D_.MissingFeatures)})()}_refineSetBlock(e,s,t){return(0,h.A)(function*(){return e})()}_stat(e,s,t,r,u,i,v){return(0,h.A)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,s,t,r,u){return(0,h.A)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,s,t,r,u){return this._relatedLayer.queryAttachments(e,s,t,r,u)}getFeatureByObjectId(e,s){return this._relatedLayer.getFeatureByObjectId(e,s)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,h.A)(function*(){return e.fsetInfo??e._layer.featureSetInfo})()}}var ne=o(89812),Le=o(55098),Pe=o(95478),Be=o(46577);function Ke(){null===ne.A.applicationCache&&(ne.A.applicationCache=new ne.A)}function we(x,e,s){return y.apply(this,arguments)}function y(){return(y=(0,h.A)(function*(x,e,s){if(ne.A.applicationCache){const t=ne.A.applicationCache.getLayerInfo(x);if(t){const i=yield t;return new ve.default({url:x,outFields:e,sourceJSON:i})}const r=new ve.default({url:x,outFields:e}),u=(0,h.A)(function*(){return yield r.load(),r.sourceJSON})();if(ne.A.applicationCache){ne.A.applicationCache.setLayerInfo(x,u);try{return yield u,r}catch(i){throw ne.A.applicationCache.clearLayerInfo(x),i}}return yield u,r}if(null!=s){const t=s.getCachedLayerMetadata(x);if(t){const i=yield t;return new ve.default({url:x,outFields:e,sourceJSON:i})}const r=new ve.default({url:x,outFields:e}),u=(0,h.A)(function*(){return yield r.load(),r.sourceJSON})();s.setCachedLayerMetadata(x,u);try{return yield u,r}catch(i){throw s.removeCachedLayerMetadata(x,u),i}}return new ve.default({url:x,outFields:e})})).apply(this,arguments)}function W(x,e,s,t,r){return Z.apply(this,arguments)}function Z(){return(Z=(0,h.A)(function*(x,e,s,t,r,u=null){return V(yield we(x,["*"],r),e,s,t,r,u)})).apply(this,arguments)}function V(x,e=null,s=null,t=!0,r=null,u=null){switch(x.type){case"catalog-footprint":return V(x.parent,e,s,t,r,u);case"subtype-sublayer":{const i=V(x.parent,e,s,t,r,u);return i.filter(M.default.create(x.parent.subtypeField+"="+x.subtypeCode.toString(),{fieldsIndex:x.parent.fieldsIndex,timeZone:i.dateFieldsTimeZoneDefaultUTC}))}case"csv":case"geojson":case"knowledge-graph-sublayer":case"wfs":return new Ne.A({layer:x,spatialReference:e,outFields:s,includeGeometry:t,lrucache:r,interceptor:u});case"catalog":case"feature":case"oriented-imagery":case"subtype-group":{const i={layer:x,spatialReference:e,outFields:s,includeGeometry:t,lrucache:r,interceptor:u};return!x.url&&x.source?new Ne.A(i):new Ce(i)}default:throw new Error(`Unsupported layer type: ${x.type}`)}}function J(){return(J=(0,h.A)(function*(x){if(null!==ne.A.applicationCache){const s=ne.A.applicationCache.getLayerInfo(x);if(null!==s)return s}const e=(0,h.A)(function*(){const s=yield(0,G.A)(x,{responseType:"json",query:{f:"json"}});return s.data?s.data:null})();if(null!==ne.A.applicationCache){ne.A.applicationCache.setLayerInfo(x,e);try{return yield e}catch(s){throw ne.A.applicationCache.clearLayerInfo(x),s}}return e})).apply(this,arguments)}function oe(){return(oe=(0,h.A)(function*(x,e){const s="QUERYDATAELEMTS:"+e.toString()+":"+x;if(null!==ne.A.applicationCache){const r=ne.A.applicationCache.getLayerInfo(s);if(null!==r)return r}const t=(0,h.A)(function*(){const r=yield(0,G.A)(x+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(r.data){const u=r.data;if(u.layerDataElements?.[0])return u.layerDataElements[0]}throw new D.dr(D.D_.DataElementsNotFound)})();if(null!==ne.A.applicationCache){ne.A.applicationCache.setLayerInfo(s,t);try{return yield t}catch(r){throw ne.A.applicationCache.clearLayerInfo(s),r}}return t})).apply(this,arguments)}function _e(x,e){return ce.apply(this,arguments)}function ce(){return(ce=(0,h.A)(function*(x,e){if(null!==ne.A.applicationCache){const t=ne.A.applicationCache.getLayerInfo(x);if(null!==t)return t}if(null!=e){const t=e.getCachedServiceMetadata(x);if(null!=t)return t}const s=(0,h.A)(function*(){const t=yield(0,G.A)(x,{responseType:"json",query:{f:"json"}});if(t.data){const r=t.data;return r.layers||(r.layers=[]),r.tables||(r.tables=[]),r}return{layers:[],tables:[]}})();if(null!==ne.A.applicationCache){ne.A.applicationCache.setLayerInfo(x,s);try{return yield s}catch(t){throw ne.A.applicationCache.clearLayerInfo(x),t}}if(null!=e){e.setCachedServiceMetadata(x,s);try{return yield s}catch(t){throw e.removeCachedServiceMetadata(x,s),t}}return s})).apply(this,arguments)}function me(x,e,s){return de.apply(this,arguments)}function de(){return de=(0,h.A)(function*(x,e,s){const t={metadata:null,networkId:-1,unVersion:3,terminals:[],layerIdLookup:new Map,sourceIdLookup:new Map,queryelem:null,layerNameLkp:{},lkp:null},r=yield _e(x,null);if(t.metadata=r,void 0!==r.controllerDatasetLayers?.utilityNetworkLayerId&&null!==r.controllerDatasetLayers.utilityNetworkLayerId){if(r.layers)for(const v of r.layers)t.layerNameLkp[v.id]=v.name;if(r.tables)for(const v of r.tables)t.layerNameLkp[v.id]=v.name;const u=r.controllerDatasetLayers.utilityNetworkLayerId;t.networkId=u;const i=yield function ye(x,e){return oe.apply(this,arguments)}(x,u);if(i){t.queryelem=i,t.queryelem?.dataElement&&void 0!==t.queryelem.dataElement.schemaGeneration&&(t.unVersion=t.queryelem.dataElement.schemaGeneration),t.lkp={},t.queryelem.dataElement.domainNetworks||(t.queryelem.dataElement.domainNetworks=[]);for(const _ of t.queryelem.dataElement.domainNetworks){for(const T of _.edgeSources??[]){const L={layerId:T.layerId,sourceId:T.sourceId,className:t.layerNameLkp[T.layerId]??null};t.layerIdLookup.set(L.layerId,L),t.sourceIdLookup.set(L.sourceId,L),L.className&&(t.lkp[L.className]=L)}for(const T of _.junctionSources??[]){const L={layerId:T.layerId,sourceId:T.sourceId,className:t.layerNameLkp[T.layerId]??null};t.layerIdLookup.set(L.layerId,L),t.sourceIdLookup.set(L.sourceId,L),L.className&&(t.lkp[L.className]=L)}}if(t.queryelem.dataElement.terminalConfigurations)for(const _ of t.queryelem.dataElement.terminalConfigurations)for(const T of _.terminals)t.terminals.push({terminalId:T.terminalId,terminalName:T.terminalName});const v=yield function te(x){return J.apply(this,arguments)}(x+"/"+u);if(void 0!==v.systemLayers?.associationsTableId&&null!==v.systemLayers.associationsTableId){let _=null;if(s&&t.unVersion<8){const T=[];t.unVersion>=4&&(T.push("STATUS"),T.push("PERCENTALONG")),_=yield W(x+"/"+v.systemLayers.associationsTableId,e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...T],!1,null,null),yield _.load(),t.unVersion>=4&&(_=_.filter(M.default.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",{fieldsIndex:_.getFieldsIndex(),timeZone:_.dateFieldsTimeZoneDefaultUTC})),yield _.load())}return{lkp:t.lkp,associations:_,unVersion:t.unVersion,terminals:t.terminals,layerIdLookup:t.layerIdLookup,sourceIdLookup:t.sourceIdLookup}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[],layerIdLookup:new Map,sourceIdLookup:new Map}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[],layerIdLookup:new Map,sourceIdLookup:new Map}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[],layerIdLookup:new Map,sourceIdLookup:new Map}}),de.apply(this,arguments)}function he(x,e,s){return ge.apply(this,arguments)}function ge(){return(ge=(0,h.A)(function*(x,e,s,t=null,r=null,u=!0,i=null,v=null){let _=x.serviceUrl();if(!_)return null;_="/"===_.charAt(_.length-1)?_+e.relatedTableId.toString():_+"/"+e.relatedTableId.toString();const T=yield W(_,t,r,u,i,v);return new Ge({layer:x,relatedLayer:T,relationship:e,objectId:s,spatialReference:t,outFields:r,includeGeometry:u,lrucache:i,interceptor:v})})).apply(this,arguments)}U.A.registerAction(),B.registerAction(),O.A.registerAction(),b.A.registerAction(),R.A.registerAction();class fe extends ${constructor(e,s=null,t=null,r=null){super(),this._map=e,this._overrideSpatialReference=s,this._lrucache=t,this._interceptor=r,this._instantLayers=[]}_makeAndAddFeatureSet(e,s=!0,t=null){const r=V(e,this._overrideSpatialReference,null===t?["*"]:t,s,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:r,opitem:e,includeGeometry:s,outFields:JSON.stringify(t)}),r}featureSetByName(e,s=!0,t=null){var r=this;return(0,h.A)(function*(){if(Le.A.isLoadable(r._map)&&!r._map.loaded)return yield r._map.load(),r.featureSetByName(e,s,t);null===t&&(t=["*"]),t=(t=t.slice()).sort();const u=JSON.stringify(t);for(let v=0;v<r._instantLayers.length;v++){const _=r._instantLayers[v];if(_.opitem.title===e&&_.includeGeometry===s&&_.outFields===u)return r._instantLayers[v].featureset}const i=r._map.allLayers.find(v=>(0,a.eB)(v)&&v.title===e);if(null!=i)return r._makeAndAddFeatureSet(i,s,t);if(r._map.tables){const v=r._map.tables.find(_=>(0,a.eB)(_)&&_.title===e);if(null!=v)return r._makeAndAddFeatureSet(v,s,t)}return null})()}featureSetById(e,s=!0,t=["*"]){var r=this;return(0,h.A)(function*(){if(Le.A.isLoadable(r._map)&&!r._map.loaded)return yield r._map.load(),r.featureSetById(e,s,t);null===t&&(t=["*"]),t=(t=t.slice()).sort();const u=JSON.stringify(t);for(let v=0;v<r._instantLayers.length;v++){const _=r._instantLayers[v];if(_.opitem.id===e&&_.includeGeometry===s&&_.outFields===u)return r._instantLayers[v].featureset}const i=r._map.allLayers.find(v=>(0,a.eB)(v)&&v.id===e);if(i)return r._makeAndAddFeatureSet(i,s,t);if(r._map.tables){const v=r._map.tables.find(_=>(0,a.eB)(_)&&_.id===e);if(null!=v)return r._makeAndAddFeatureSet(v,s,t)}return null})()}}class Ie extends ${constructor(e,s=null,t=null,r=null){super(),this._url=e,this._overrideSpatialReference=s,this._lrucache=t,this._interceptor=r,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,s=!0,t=null){const r=V(e,this._overrideSpatialReference,null===t?["*"]:t,s,this._lrucache);return this._instantLayers.push({featureset:r,opitem:e,includeGeometry:s,outFields:JSON.stringify(t)}),r}_loadMetaData(){var e=this;return(0,h.A)(function*(){const s=yield _e(e._url,e._lrucache);return e.metadata=s,s})()}load(){return this._loadMetaData()}clone(){return new Ie(this._url,this._overrideSpatialReference,this._lrucache,this._interceptor)}featureSetByName(e,s=!0,t=null){var r=this;return(0,h.A)(function*(){null===t&&(t=["*"]),t=(t=t.slice()).sort();const u=JSON.stringify(t);for(let _=0;_<r._instantLayers.length;_++){const T=r._instantLayers[_];if(T.opitem.title===e&&T.includeGeometry===s&&T.outFields===u)return r._instantLayers[_].featureset}const i=yield r._loadMetaData();let v=null;for(const _ of i.layers??[])_.name===e&&(v=_);if(!v)for(const _ of i.tables??[])_.name===e&&(v=_);if(v){const _=yield we(r._url+"/"+v.id,["*"],r._lrucache);return r._makeAndAddFeatureSet(_,s,t)}return null})()}featureSetById(e,s=!0,t=["*"]){var r=this;return(0,h.A)(function*(){null===t&&(t=["*"]),t=(t=t.slice()).sort();const u=JSON.stringify(t);e=null!=e?e.toString():"";for(let _=0;_<r._instantLayers.length;_++){const T=r._instantLayers[_];if(T.opitem.id===e&&T.includeGeometry===s&&T.outFields===u)return r._instantLayers[_].featureset}const i=yield r._loadMetaData();let v=null;for(const _ of i.layers??[])null!=_.id&&_.id.toString()===e&&(v=_);if(!v)for(const _ of i.tables??[])null!=_.id&&_.id.toString()===e&&(v=_);if(v){const _=yield we(r._url+"/"+v.id,["*"],r._lrucache);return r._makeAndAddFeatureSet(_,s,t)}return null})()}}function Ee(x,e,s=null,t=null){return new fe(x,e,s,t)}function De(x,e,s=null,t=null){return new Ie(x,e,s,t)}function Te(x,e,s,t,r){if(null===x)return null;if((0,S.p)(x)){switch(e){case"datasource":return x.getDataSourceFeatureSet();case"parent":return x;case"root":return x.getRootFeatureSet()}return null}if(x instanceof Pe.A&&(0,a.NI)(x)){const u=x;switch(e){case"datasource":return V(u,r,"outFields"in u?u.outFields:null,!0,s,t).getDataSourceFeatureSet();case"parent":case"root":return V(u,r,"outFields"in u?u.outFields:null,!0,s,t)}return null}if((0,S.Z)(x)){switch(e){case"datasource":return V(x.parent,r,x.parent.outFields,!0,s,t).getDataSourceFeatureSet();case"parent":case"root":return V(x,r,x.parent.outFields,!0,s,t)}return null}return null}function Oe(x,e,s,t,r,u,i){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,h.A)(function*(x,e,s,t,r,u,i,v=null){if(ne.A.applicationCache){const T=ne.A.applicationCache.getLayerInfo(x+":"+u.url);if(T)return Me(yield T,e,s,t,r,i,v)}if(null!=i){const T=i.getCachedPortalItem(u.url,x);if(null!=T)return yield Me(yield T,e,s,t,r,i,v)}const _=new Be.default({id:x,portal:u}).load();ne.A.applicationCache?ne.A.applicationCache.setLayerInfo(x+":"+u.url,_):i?.setCachedPortalItem(u.url,x,_);try{return yield Me(yield _,e,s,t,r,i,v)}catch(T){throw ne.A.applicationCache&&ne.A.applicationCache.clearLayerInfo(x+":"+u.url),i?.removeCachedPortalItem(u.url,x,_),T}})).apply(this,arguments)}function Me(x,e,s,t,r,u,i){return Se.apply(this,arguments)}function Se(){return(Se=(0,h.A)(function*(x,e,s,t,r,u,i){let v;if("Feature Service"===x.type||"Map Service"===x.type)v=yield we((0,a.Qi)(x.url??"")+"/"+e,["*"],u);else{if(e)throw new Error(`layerId=${e} provided for ${x.type} item`);if(null!=u){const _=u.getCachedPortalItemLayer(x.portal.url,x.id);if(null!=_)v=yield _;else{const T=Pe.A.fromPortalItem(x);u.setCachedPortalItemLayer(x.portal.url,x.id,T);try{v=yield T}catch(L){throw u.removeCachedPortalItemLayer(x.portal.url,x.id,T),L}}}else v=yield Pe.A.fromPortalItem(x)}return V(v,s,t,r,u,i)})).apply(this,arguments)}},36455:(ie,H,o)=>{o.d(H,{Gr:()=>F,IO:()=>A,a:()=>P,bV:()=>M,p8:()=>n});var h=o(10467),G=o(81098),$=o(73446),S=o(31033),U=o(85922),N=o(71505),K=o(7981),O=o(97089),D=o(11432),I=o(89998),f=o(1329),p=o(32034);class a{constructor(m){this.field=m,this.sqlRewritable=!1}postInitialization(m,d){}}class A extends a{constructor(m){super(m),this.sqlRewritable=!0}extractValue(m){return m.attributes[this.field.name]}rewriteSql(m){return{rewritten:this.sqlRewritable,where:m}}}class n extends a{constructor(m,d,E){super((0,K.ke)(m)),this.originalField=m,this.sqlRewritable=!0,this.field.name=d,this.field.alias=E}rewriteSql(m,d){return{rewritten:this.sqlRewritable,where:(0,O.bD)(m,this.field.name,this.originalField.name,d.getFieldsIndex())}}extractValue(m){return m.attributes[this.originalField.name]}}let M=(()=>{class w extends a{constructor(d,E,g){super(d),this.codefield=E,this.lkp=g,this.reverseLkp={};for(const l in g)this.reverseLkp[g[l]]=l;this.sqlRewritable=!0}rewriteSql(d,E){const g=this.evaluateNodeToWhereClause(d.parseTree,K.zl.Standardised,this.field.name,this.codefield instanceof f.default?(0,O.YY)(this.codefield,K.zl.Standardised):this.codefield,d.parameters);return g.includes(w.BADNESS)?{rewritten:!1,where:d}:{rewritten:this.sqlRewritable,where:f.default.create(g,{fieldsIndex:E._parent.getFieldsIndex(),timeZone:E.dateFieldsTimeZoneDefaultUTC})}}evaluateNodeToWhereClause(d,E,g=null,l=null,c){let C,j,B,b;switch(d.type){case"interval":return(0,O.oj)(this.evaluateNodeToWhereClause(d.value,E,g,l,c),d.qualifier,d.op);case"case-expression":{let R=" CASE ";"simple"===d.format&&(R+=this.evaluateNodeToWhereClause(d.operand,E,g,w.BADNESS,c));for(let k=0;k<d.clauses.length;k++)R+=" WHEN "+this.evaluateNodeToWhereClause(d.clauses[k].operand,E,g,w.BADNESS,c)+" THEN "+this.evaluateNodeToWhereClause(d.clauses[k].value,E,g,w.BADNESS,c);return null!==d.else&&(R+=" ELSE "+this.evaluateNodeToWhereClause(d.else,E,g,w.BADNESS,c)),R+=" END ",R}case"parameter":{const R=c[d.value.toLowerCase()];if("string"==typeof R)return"'"+R.toString().replaceAll("'","''")+"'";if((0,K.$P)(R)||(0,K.Lk)(R))return(0,O.bm)(R,E);if((0,K.eg)(R))return(0,O.F1)(R,E);if((0,K.rX)(R))return(0,O.R8)(R,E);if((0,K.f0)(R))return(0,O.Nf)(R,E);if(Array.isArray(R)){const k=[];for(let z=0;z<R.length;z++)"string"==typeof R[z]?k.push("'"+R[z].toString().replaceAll("'","''")+"'"):(0,K.$P)(R[z])||(0,K.Lk)(R[z])?k.push((0,O.bm)(R[z],E)):(0,K.eg)(R[z])?k.push((0,O.F1)(R[z],E)):(0,K.rX)(R[z])?k.push((0,O.R8)(R[z],E)):(0,K.f0)(R[z])?k.push((0,O.Nf)(R[z],E)):k.push(R[z].toString());return k}return R.toString()}case"expression-list":j=[];for(const R of d.value)j.push(this.evaluateNodeToWhereClause(R,E,g,l,c));return j;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(d.expr,E,g,w.BADNESS,c)+" ) ";case"binary-expression":switch(d.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" AND "+this.evaluateNodeToWhereClause(d.right,E,g,l,c)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" OR "+this.evaluateNodeToWhereClause(d.right,E,g,l,c)+") ";case"IS":if("null"!==d.right.type)throw new I.L8(I.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" IS NULL )";case"ISNOT":if("null"!==d.right.type)throw new I.L8(I.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" IS NOT NULL )";case"IN":if(C=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const R=[];let k=!0;for(const z of d.right.value){if("string"!==z.type){k=!1;break}if(void 0===this.lkp[z.value]){k=!1;break}R.push(this.lkp[z.value].toString())}if(k)return" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" IN ("+R.join(",")+")) "}return C=this.evaluateNodeToWhereClause(d.right,E,g,l,c)," ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" IN ("+C.join(",")+")) "}return b=this.evaluateNodeToWhereClause(d.right,E,g,l,c),Array.isArray(b)?" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" IN ("+b.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" IN ("+b+")) ";case"NOT IN":if(C=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const R=[];let k=!0;for(const z of d.right.value){if("string"!==z.type){k=!1;break}if(void 0===this.lkp[z.value]){k=!1;break}R.push(this.lkp[z.value].toString())}if(k)return" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" NOT IN ("+R.join(",")+")) "}return C=this.evaluateNodeToWhereClause(d.right,E,g,l,c)," ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" NOT IN ("+C.join(",")+")) "}return b=this.evaluateNodeToWhereClause(d.right,E,g,l,c),Array.isArray(b)?" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" NOT IN ("+b.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,E,g,l,c)+" NOT IN ("+b+")) ";case"BETWEEN":return B=this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)," ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" BETWEEN "+B[0]+" AND "+B[1]+" ) ";case"NOTBETWEEN":return B=this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)," ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" NOT BETWEEN "+B[0]+" AND "+B[1]+" ) ";case"LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)+") ";case"NOT LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)+") ";case"<>":case"=":if("column-reference"===d.left.type&&"string"===d.right.type){if(d.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[d.right.value.toString()])return" ("+l+" "+d.operator+" "+this.lkp[d.right.value.toString()].toString()+") "}else if("column-reference"===d.right.type&&"string"===d.left.type&&d.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[d.right.value.toString()].toString()+" "+d.operator+" "+l+") ";return" ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(d.left,E,g,w.BADNESS,c)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,E,g,w.BADNESS,c)+") "}case"null":return"null";case"boolean":return!0===d.value?"1":"0";case"string":return"'"+d.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${d.value}'`;case"date":return`date '${d.value}'`;case"time":return`time '${d.value}'`;case"number":return d.value.toString();case"current-time":return(0,O.C6)(d.mode,E);case"current-user":return"CURRENT_USER";case"column-reference":return g&&g.toLowerCase()===d.column.toLowerCase()?"("+l+")":(0,O.Kb)(d.column);case"data-type":return d.value;case"function":{const R=this.evaluateNodeToWhereClause(d.args,E,g,w.BADNESS,c);return(0,O.F6)(d.name,R,E)}}throw new I.L8(I.Z7.UnsupportedSyntax,{node:d.type})}extractValue(d){return this.codefield instanceof f.default?this.reverseLkp[f.default.convertValueToStorageFormat(this.codefield.calculateValueCompiled(d))]:this.reverseLkp[d.attributes[this.codefield]]}}return w.BADNESS="_!!!_BAD_LKP_!!!!",w})();class F extends a{constructor(m,d){super(m),this._sql=d}rewriteSql(m,d){return{rewritten:!0,where:(0,O.bD)(m,this.field.name,(0,O.YY)(this._sql,K.zl.Standardised),d.getFieldsIndex())}}extractValue(m){return f.default.convertValueToStorageFormat(this._sql.calculateValueCompiled(m),this.field.type)}}class P extends U.A{static findField(m,d){for(const E of m)if(E.name.toLowerCase()===d.toString().toLowerCase())return E;return null}constructor(m){super(m),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=m.extraFilter,this._parent=m.parentfeatureset,this._maxProcessing=30,this.adaptedFields=m.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new p.A({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=K.ik.point,this.typeIdField="",this.types=null,this.subtypeField=null,this.subtypes=null),this.fields=[];for(const m of this.adaptedFields)m.postInitialization(this,this._parent),this.fields.push(m.field)}_getSet(m){var d=this;return(0,h.A)(function*(){if(null===d._wset){yield d._ensureLoaded();let E=null;return E=d._extraFilter?yield d._getFilteredSet("",null,null,null,m):yield d._parent?._getSet(m),d._checkCancelled(m),(0,D.Lw)(E),d._wset=new N.A(E._candidates.slice(),E._known.slice(),E._ordered,d._clonePageDefinition(E.pagesDefinition)),d._wset}return d._wset})()}_isInFeatureSet(m){return this._parent._isInFeatureSet(m)}_getFeatures(m,d,E,g){var l=this;return(0,h.A)(function*(){const c=[];-1!==d&&void 0===l._featureCache[d]&&c.push(d);const C=l._maxQueryRate();if(!0===l._checkIfNeedToExpandKnownPage(m,C))return yield l._expandPagedSet(m,C,0,0,g),l._getFeatures(m,d,E,g);let j=0;for(let R=m._lastFetchedIndex;R<m._known.length&&(j++,j<=E&&(m._lastFetchedIndex+=1),!(void 0===l._featureCache[m._known[R]]&&(m._known[R]!==d&&c.push(m._known[R]),c.length>=C)));R++);if(0===c.length)return"success";m=new N.A([],c,m._ordered,null);const B=Math.min(c.length,E);yield l._parent?._getFeatures(m,-1,B,g),l._checkCancelled(g);const b=[];for(let R=0;R<B;R++){const k=l._parent?._featureFromCache(c[R]);void 0!==k&&b.push({geometry:k.geometry,attributes:k.attributes,id:c[R]})}for(const R of b){const k=[];for(const z of l.adaptedFields)k[z.field.name]=z.extractValue(R);l._featureCache[R.id]=new G.A({attributes:k,geometry:(0,$.Yq)(R.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,h.A)(function*(){throw new S.dr(S.D_.NeverReach)})()}_getFilteredSet(m,d,E,g,l){var c=this;return(0,h.A)(function*(){let C=!1;const j=c._reformulateWithoutAdaptions(E);C=j.cannot,E=j.where;let B=!1;if(null!==g){B=!0;const k=[];for(const z of c.adaptedFields)if(!(z instanceof A)&&!0===g.scanForField(z.field.name)){if(!(z instanceof n)){g=null,B=!1;break}k.push({field:z.field.name,newfield:z.originalField.name})}g&&k.length>0&&(g=g.replaceFields(k))}null!==E?null!==c._extraFilter&&(E=(0,O.kg)(c._extraFilter,E)):E=c._extraFilter,yield c._ensureLoaded();const b=yield c._parent._getFilteredSet(m,d,E,g,l);let R;return c._checkCancelled(l),R=!0===C?new N.A(b._candidates.slice().concat(b._known.slice()),[],!0===B&&b._ordered,c._clonePageDefinition(b.pagesDefinition)):new N.A(b._candidates.slice(),b._known.slice(),!0===B&&b._ordered,c._clonePageDefinition(b.pagesDefinition)),R})()}_reformulateWithoutAdaptions(m){const d={cannot:!1,where:m};if(null!==m)for(const E of this.adaptedFields)if(!0===(0,O.Ju)(m,E.field.name)){const g=E.rewriteSql(m,this);if(!0!==g.rewritten){d.cannot=!0,d.where=null;break}d.where=g.where}return d}_stat(m,d,E,g,l,c,C){var j=this;return(0,h.A)(function*(){let B=!1,b=j._reformulateWithoutAdaptions(d);if(B=b.cannot,d=b.where,b=j._reformulateWithoutAdaptions(l),B=B||b.cannot,null!==(l=b.where)?null!==j._extraFilter&&(l=(0,O.kg)(j._extraFilter,l)):l=j._extraFilter,!0===B)return null===l&&""===E&&null===g?j._manualStat(m,d,c,C):{calculated:!1};const R=yield j._parent._stat(m,d,E,g,l,c,C);return!1===R.calculated?null===l&&""===E&&null===g?j._manualStat(m,d,c,C):{calculated:!1}:R})()}_canDoAggregates(m,d,E,g,l){var c=this;return(0,h.A)(function*(){if(null===c._parent)return!1;for(let B=0;B<m.length;B++)for(const b of c.adaptedFields)if(m[B].toLowerCase()===b.field.name.toLowerCase()&&!(b instanceof A))return!1;const C=[];for(let B=0;B<d.length;B++){const b=d[B];if(null!==b.workingexpr){const R=c._reformulateWithoutAdaptions(b.workingexpr);if(R.cannot)return!1;const k=b.clone();k.workingexpr=R.where,C.push(k)}else C.push(b)}const j=c._reformulateWithoutAdaptions(l);return!j.cannot&&(null!==(l=j.where)?null!==c._extraFilter&&(l=(0,O.kg)(c._extraFilter,l)):l=c._extraFilter,c._parent._canDoAggregates(m,C,E,g,l))})()}_getAggregatePagesDataSourceDefinition(m,d,E,g,l,c,C){var j=this;return(0,h.A)(function*(){if(null===j._parent)throw new S.dr(S.D_.NeverReach);const B=[];for(let R=0;R<d.length;R++){const k=d[R];if(null!==k.workingexpr){const z=j._reformulateWithoutAdaptions(k.workingexpr);if(z.cannot)throw new S.dr(S.D_.NeverReach);const X=k.clone();X.workingexpr=z.where,B.push(X)}else B.push(k)}const b=j._reformulateWithoutAdaptions(l);if(b.cannot)throw new S.dr(S.D_.NeverReach);return null!==(l=b.where)?null!==j._extraFilter&&(l=(0,O.kg)(j._extraFilter,l)):l=j._extraFilter,j._parent._getAggregatePagesDataSourceDefinition(m,B,E,g,l,c,C)})()}}},888:(ie,H,o)=>{o.d(H,{A:()=>I});var h=o(10467),G=o(31033),$=o(85922),S=o(71505),U=o(7981),N=o(97089),K=o(56492),O=o(1329),D=o(32034);class I extends $.A{constructor(p){super(p),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=p.parentfeatureset,p.whereclause instanceof O.default?(this._whereclause=p.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=p.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new D.A({wkid:4326}),this.geometryType=U.ik.point)}_getSet(p){var a=this;return(0,h.A)(function*(){if(null===a._wset){yield a._ensureLoaded();const A=yield a._parent._getFilteredSet("",null,a._whereclause,null,p);return a._checkCancelled(p),a._wset=null!==a._whereClauseFunction?new S.A(A._candidates.slice().concat(A._known.slice()),[],A._ordered,a._clonePageDefinition(A.pagesDefinition)):new S.A(A._candidates.slice(),A._known.slice(),A._ordered,a._clonePageDefinition(A.pagesDefinition)),a._wset}return a._wset})()}_isInFeatureSet(p){let a=this._parent?._isInFeatureSet(p);return a===U.J6.NotInFeatureSet?a:(a=this._idstates[p],void 0===a?U.J6.Unknown:a)}_getFeature(p,a,A){return this._parent._getFeature(p,a,A)}_getFeatures(p,a,A,n){return this._parent._getFeatures(p,a,A,n)}_featureFromCache(p){return this._parent._featureFromCache(p)}executeWhereClause(p){return this._whereclause?.testFeature(p)??!1}executeWhereClauseDeferred(p){var a=this;return(0,h.A)(function*(){if(null!==a._whereClauseFunction){const A=a._whereClauseFunction(p);return(0,K.$X)(A),A}return a.executeWhereClause(p)})()}_fetchAndRefineFeatures(p,a,A){var n=this;return(0,h.A)(function*(){const M=new S.A([],p,!1,null),F=Math.min(a,p.length);if(yield n._parent?._getFeatures(M,-1,F,A),n._checkCancelled(A),null==n._whereClauseFunction){for(let w=0;w<F;w++){const m=n._parent?._featureFromCache(p[w]);n._idstates[p[w]]=!0===n.executeWhereClause(m)?U.J6.InFeatureSet:U.J6.NotInFeatureSet}return"success"}const P=[];for(let w=0;w<F;w++){const m=n._parent?._featureFromCache(p[w]);P.push(yield n.executeWhereClauseDeferred(m))}for(let w=0;w<a;w++)n._idstates[p[w]]=!0===P[w]?U.J6.InFeatureSet:U.J6.NotInFeatureSet;return"success"})()}_getFilteredSet(p,a,A,n,M){var F=this;return(0,h.A)(function*(){null!==F._whereClauseFunction||(null!==A?null!==F._whereclause&&(A=(0,N.kg)(F._whereclause,A)):A=F._whereclause),yield F._ensureLoaded();const P=yield F._parent._getFilteredSet(p,a,A,n,M);let w;return F._checkCancelled(M),w=null!==F._whereClauseFunction?new S.A(P._candidates.slice().concat(P._known.slice()),[],P._ordered,F._clonePageDefinition(P.pagesDefinition)):new S.A(P._candidates.slice(),P._known.slice(),P._ordered,F._clonePageDefinition(P.pagesDefinition)),w})()}_stat(p,a,A,n,M,F,P){var w=this;return(0,h.A)(function*(){if(null!==w._whereClauseFunction)return null===M&&""===A&&null===n?w._manualStat(p,a,F,P):{calculated:!1};let m=w._whereclause;null!==M&&null!==w._whereclause&&(m=(0,N.kg)(w._whereclause,M));const d=yield w._parent._stat(p,a,A,n,m,F,P);return!1===d.calculated?null===M&&""===A&&null===n?w._manualStat(p,a,F,P):{calculated:!1}:d})()}_canDoAggregates(p,a,A,n,M){var F=this;return(0,h.A)(function*(){return null===F._whereClauseFunction&&(null!==M?null!==F._whereclause&&(M=(0,N.kg)(F._whereclause,M)):M=F._whereclause,null!==F._parent&&F._parent._canDoAggregates(p,a,A,n,M))})()}_getAggregatePagesDataSourceDefinition(p,a,A,n,M,F,P){var w=this;return(0,h.A)(function*(){if(null===w._parent)throw new G.dr(G.D_.NeverReach);return null!==M?null!==w._whereclause&&(M=(0,N.kg)(w._whereclause,M)):M=w._whereclause,w._parent._getAggregatePagesDataSourceDefinition(p,a,A,n,M,F,P)})()}static registerAction(){$.A._featuresetFunctions.filter=function(p){if("function"==typeof p)return new I({parentfeatureset:this,whereclause:p});let a=null;return p instanceof O.default&&(a=p),new I({parentfeatureset:this,whereclause:a})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},93571:(ie,H,o)=>{o.d(H,{A:()=>K});var h=o(10467),G=o(42686),$=o(31033),S=o(85922),U=o(71505),N=o(58314);class K extends S.A{constructor(D){super(D),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=D.orderbyclause,this._parent=D.parentfeatureset}_getSet(D){var I=this;return(0,h.A)(function*(){if(null===I._wset){yield I._ensureLoaded();const f=yield I._getFilteredSet("",null,null,I._orderbyclause,D);return I._checkCancelled(D),I._wset=f,I._wset}return I._wset})()}manualOrderSet(D,I){var f=this;return(0,h.A)(function*(){const p=yield f.getIdColumnDictionary(D,[],-1,I);f._orderbyclause?.order(p);const a=new U.A([],[],!0,null);for(let A=0;A<p.length;A++)a._known.push(p[A].id);return a})()}getIdColumnDictionary(D,I,f,p){var a=this;return(0,h.A)(function*(){if(f<D._known.length-1){const A=a._maxQueryRate();if("GETPAGES"===D._known[f+1])return yield(0,G._)(a._parent._expandPagedSet(D,A,0,0,p)),a.getIdColumnDictionary(D,I,f,p);let n=f+1;const M=[];for(;n<D._known.length&&"GETPAGES"!==D._known[n];)M.push(D._known[n]),n++;f+=M.length;const F=yield(0,G._)(a._parent._getFeatureBatch(M,p));a._checkCancelled(p);for(const P of F)I.push({id:P.attributes[a.objectIdField],feature:P});return a.getIdColumnDictionary(D,I,f,p)}return D._candidates.length>0?(yield(0,G._)(a._refineSetBlock(D,a._maxProcessingRate(),p)),a._checkCancelled(p),a.getIdColumnDictionary(D,I,f,p)):I})()}_isInFeatureSet(D){return this._parent._isInFeatureSet(D)}_getFeatures(D,I,f,p){return this._parent._getFeatures(D,I,f,p)}_featureFromCache(D){if(void 0===this._featureCache[D]){const I=this._parent._featureFromCache(D);return void 0===I?void 0:null===I?null:(this._featureCache[D]=I,I)}return this._featureCache[D]}_fetchAndRefineFeatures(){return(0,h.A)(function*(){throw new $.dr($.D_.NeverReach)})()}_getFilteredSet(D,I,f,p,a){var A=this;return(0,h.A)(function*(){yield A._ensureLoaded();const n=yield A._parent._getFilteredSet(D,I,f,null===p?A._orderbyclause:p,a);A._checkCancelled(a);const M=new U.A(n._candidates.slice(),n._known.slice(),n._ordered,A._clonePageDefinition(n.pagesDefinition));let F=!0;if(n._candidates.length>0&&(F=!1),!1===M._ordered){let P=yield A.manualOrderSet(M,a);return!1===F&&(null===I&&null===f||(P=new U.A(P._candidates.slice().concat(P._known.slice()),[],P._ordered,A._clonePageDefinition(P.pagesDefinition)))),P}return M})()}static registerAction(){S.A._featuresetFunctions.orderBy=function(D){return""===D?this:new K({parentfeatureset:this,orderbyclause:new N.A(D)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},53437:(ie,H,o)=>{o.d(H,{A:()=>N});var h=o(10467),G=o(31033),$=o(85922),S=o(71505),U=o(7981);class N extends $.A{constructor(O){super(O),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=O.topnum,this._parent=O.parentfeatureset}_getSet(O){var D=this;return(0,h.A)(function*(){if(null===D._wset){yield D._ensureLoaded();const I=yield D._parent._getSet(O);return D._wset=new S.A(I._candidates.slice(),I._known.slice(),!1,D._clonePageDefinition(I.pagesDefinition)),D._setKnownLength(D._wset)>D._topnum&&(D._wset._known=D._wset._known.slice(0,D._topnum)),D._setKnownLength(D._wset)>=D._topnum&&(D._wset._candidates=[]),D._wset}return D._wset})()}_setKnownLength(O){return O._known.length>0&&"GETPAGES"===O._known[O._known.length-1]?O._known.length-1:O._known.length}_isInFeatureSet(O){const D=this._parent._isInFeatureSet(O);if(D===U.J6.NotInFeatureSet)return D;const I=this._idstates[O];return I===U.J6.InFeatureSet||I===U.J6.NotInFeatureSet?I:D===U.J6.InFeatureSet&&void 0===I?this._countedin<this._topnum?(this._idstates[O]=U.J6.InFeatureSet,this._countedin++,U.J6.InFeatureSet):(this._idstates[O]=U.J6.NotInFeatureSet,U.J6.NotInFeatureSet):U.J6.Unknown}_expandPagedSet(O,D,I,f,p){var a=this;return(0,h.A)(function*(){if(null===a._parent)throw new G.dr(G.D_.NotImplemented);if(D>a._topnum&&(D=a._topnum),a._countedin>=a._topnum&&O.pagesDefinition.internal.set.length<=O.pagesDefinition.resultOffset){let n=O._known.length;return n>0&&"GETPAGES"===O._known[n-1]&&(O._known.length=n-1),n=O._candidates.length,n>0&&"GETPAGES"===O._candidates[n-1]&&(O._candidates.length=n-1),"success"}const A=yield a._parent._expandPagedSet(O,D,I,f,p);return a._setKnownLength(O)>a._topnum&&(O._known.length=a._topnum),a._setKnownLength(O)>=a._topnum&&(O._candidates.length=0),A})()}_getFeatures(O,D,I,f){var p=this;return(0,h.A)(function*(){const a=[],A=p._maxQueryRate();if(!0===p._checkIfNeedToExpandKnownPage(O,A))return yield p._expandPagedSet(O,A,0,0,f),p._getFeatures(O,D,I,f);-1!==D&&void 0===p._featureCache[D]&&a.push(D);let n=0;for(let P=O._lastFetchedIndex;P<O._known.length&&(n++,n<=I&&(O._lastFetchedIndex+=1),!(void 0===p._featureCache[O._known[P]]&&(O._known[P]!==D&&a.push(O._known[P]),a.length>A)));P++);if(0===a.length)return"success";const M=new S.A([],a,!1,null),F=Math.min(a.length,I);yield p._parent._getFeatures(M,-1,F,f);for(let P=0;P<F;P++){const w=p._parent._featureFromCache(a[P]);void 0!==w&&(p._featureCache[a[P]]=w)}return"success"})()}_getFilteredSet(O,D,I,f,p){var a=this;return(0,h.A)(function*(){yield a._ensureLoaded();const A=yield a._getSet(p);return new S.A(A._candidates.slice().concat(A._known.slice()),[],!1,a._clonePageDefinition(A.pagesDefinition))})()}_refineKnowns(O,D){let I=0,f=null;const p=[];for(let a=0;a<O._candidates.length;a++){const A=this._isInFeatureSet(O._candidates[a]);if(A===U.J6.InFeatureSet){if(O._known.push(O._candidates[a]),I+=1,null===f?f={start:a,end:a}:f.end===a-1?f.end=a:(p.push(f),f={start:a,end:a}),O._known.length>=this._topnum)break}else if(A===U.J6.NotInFeatureSet)null===f?f={start:a,end:a}:f.end===a-1?f.end=a:(p.push(f),f={start:a,end:a}),I+=1;else if(A===U.J6.Unknown)break;if(I>=D)break}null!==f&&p.push(f);for(let a=p.length-1;a>=0;a--)O._candidates.splice(p[a].start,p[a].end-p[a].start+1);this._setKnownLength(O)>this._topnum&&(O._known=O._known.slice(0,this._topnum)),this._setKnownLength(O)>=this._topnum&&(O._candidates=[])}_stat(){return(0,h.A)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,h.A)(function*(){return!1})()}static registerAction(){$.A._featuresetFunctions.top=function(O){return new N({parentfeatureset:this,topnum:O})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},6491:(ie,H,o)=>{o.d(H,{A:()=>a});var h=o(10467),G=o(81098),$=o(31033),S=o(85922),U=o(71505),N=o(7981),K=o(97089),O=o(63484),D=o(68643),I=o(35940),f=o(47063),p=o(29141);class a extends S.A{constructor(n){super(n),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,n.spatialReference&&(this.spatialReference=n.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=n.layer,this._wset=null,!0===n.isTable&&(this._forceIsTable=!0),void 0!==n.outFields&&(this._overrideFields=n.outFields),void 0!==n.includeGeometry&&(this._removeGeometry=!1===n.includeGeometry)}_maxQueryRate(){return N.gO}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var n=this;return(0,h.A)(function*(){return!0===n._layer.loaded?(n._initialiseFeatureSet(),n):(yield n._layer.load(),n._initialiseFeatureSet(),n)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType??"",this.fields=this._layer.fields.slice(),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const n=[],M=[];for(const F of this.fields)if("oid"===F.type||this._layer.objectIdField===F.name)n.push(F),M.push(F.name);else for(const P of this._overrideFields)if(P.toLowerCase()===F.name.toLowerCase()){n.push(F),M.push(F.name);break}this.fields=n,this._overrideFields=M}this.objectIdField=this._layer.objectIdField;for(const n of this.fields)"global-id"===n.type&&(this.globalIdField=n.name);this._databaseType=N.zl.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,this.subtypeField=("subtypeField"in this._layer?this._layer.subtypeField:null)??"",this.subtypes="subtypes"in this._layer?this._layer.subtypes:null,this.typeIdField=("typeIdField"in this._layer?this._layer.typeIdField:null)??"",this.types="types"in this._layer?this._layer.types:null}isTable(){return this._forceIsTable||"isTable"in this._layer&&this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return N.J6.InFeatureSet}_candidateIdTransform(n){return n}_getSet(n){var M=this;return(0,h.A)(function*(){if(null===M._wset){yield M._ensureLoaded();const F=yield M._getFilteredSet("",null,null,null,n);return M._wset=F,F}return M._wset})()}_createQuery(){const n=this._layer.createQuery();return n.returnZ=this.hasZ,n.returnM=this.hasM,n.outFields=this._overrideFields??["*"],n.returnGeometry=!this._removeGeometry,n}_changeFeature(n){const M={};for(const F of this.fields)M[F.name]=n.attributes[F.name];return new G.A({geometry:!0===this._removeGeometry?null:n.geometry,attributes:M})}_getFilteredSet(n,M,F,P,w){var m=this;return(0,h.A)(function*(){let d="",E=!1;if(null!==P&&(d=P.constructClause(),E=!0),m.isTable()&&M&&null!==n&&""!==n)return new U.A([],[],!0,null);const g=m._createQuery();g.where=(0,O.mA)(g.where,null===F?null===M?"1=1":"":(0,K.YY)(F,N.zl.Standardised)),g.spatialRelationship=m._makeRelationshipEnum(n),g.outSpatialReference=m.spatialReference,g.orderByFields=""!==d?d.split(","):null,g.geometry=null===M?null:M,g.relationParameter=m._makeRelationshipParam(n);const l=yield m._layer.queryFeatures(g);if(null===l)return new U.A([],[],E,null);m._checkCancelled(w);const c=[];return l.features.forEach(C=>{const j=C.attributes[m._layer.objectIdField];c.push(j),m._featureCache[j]=m._changeFeature(C)}),new U.A([],c,E,null)})()}_makeRelationshipEnum(n){if(n.includes("esriSpatialRelRelation"))return"relation";switch(n){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return n}_makeRelationshipParam(n){return n.includes("esriSpatialRelRelation")?n.split(":")[1]:""}_queryAllFeatures(){var n=this;return(0,h.A)(function*(){if(n._wset)return n._wset;if(yield n._ensureLoaded(),n._layer.source&&n._layer.source.items){const w=[];return n._layer.source.items.forEach(m=>{const d=m.attributes[n._layer.objectIdField];w.push(d),n._featureCache[d]=n._changeFeature(m)}),n._wset=new U.A([],w,!1,null),n._wset}const M=n._createQuery();M.where="1=1";const F=yield n._layer.queryFeatures(M),P=[];return F.features.forEach(w=>{const m=w.attributes[n._layer.objectIdField];P.push(m),n._featureCache[m]=n._changeFeature(w)}),n._wset=new U.A([],P,!1,null),n._wset})()}_getFeatures(n,M,F){var P=this;return(0,h.A)(function*(){const w=[];-1!==M&&void 0===P._featureCache[M]&&w.push(M);for(let m=n._lastFetchedIndex;m<n._known.length&&(n._lastFetchedIndex+=1,!(void 0===P._featureCache[n._known[m]]&&(n._known[m]!==M&&w.push(n._known[m]),w.length>F)));m++);if(0===w.length)return"success";throw new $.dr($.D_.MissingFeatures)})()}_refineSetBlock(n){return(0,h.A)(function*(){return n})()}_stat(){return(0,h.A)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,h.A)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(n){const M={};for(const F in n)M[F]=n[F];return M}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(n,M){let F=n.layerDefinition.objectIdField;const P=n.layerDefinition.typeIdField??"",w=[];if(n.layerDefinition.types)for(const B of n.layerDefinition.types)w.push(f.A.fromJSON(B));let m=n.layerDefinition.geometryType;void 0===m&&(m=n.featureSet.geometryType||"");let d=n.featureSet.features;const E=M.toJSON();if(!F){let B=!1;for(const b of n.layerDefinition.fields)if("oid"===b.type||"esriFieldTypeOID"===b.type){F=b.name,B=!0;break}if(!1===B){let b="FID",R=!0,k=0;for(;R;){let X=!0;for(const re of n.layerDefinition.fields)if(re.name===b){X=!1;break}!0===X?R=!1:(k++,b="FID"+k.toString())}n.layerDefinition.fields.push({type:"esriFieldTypeOID",name:b,alias:b});const z=[];for(let X=0;X<d.length;X++)z.push({geometry:n.featureSet.features[X].geometry,attributes:n.featureSet.features[X].attributes?this._cloneAttr(n.featureSet.features[X].attributes):{}}),z[X].attributes[b]=X;d=z,F=b}}const g=[];for(const B of n.layerDefinition.fields)g.push(B instanceof p.A?B:p.A.fromJSON(B));let l=m;switch(l||(l=""),l){case"esriGeometryPoint":l="point";break;case"esriGeometryPolyline":l="polyline";break;case"esriGeometryPolygon":l="polygon";break;case"esriGeometryEnvelope":l="extent";break;case"esriGeometryMultipoint":l="multipoint";break;case"":case"esriGeometryNull":l="esriGeometryNull"}if("esriGeometryNull"!==l)for(const B of d)B.geometry&&!(B.geometry instanceof D.A)&&(B.geometry.type=l,void 0===B.geometry.spatialReference&&(B.geometry.spatialReference=E));else for(const B of d)B.geometry&&(B.geometry=null);const c={outFields:["*"],source:d,fields:g,hasZ:!0===n?.layerDefinition?.hasZ||!0===n?.featureSet?.hasZ,hasM:!0===n?.layerDefinition?.hasM||!0===n?.featureSet?.hasM,types:w,typeIdField:P,objectIdField:F,spatialReference:M},C="esriGeometryNull"===l||null===l;C||(c.geometryType=l);const j=new I.default(c);return n?.layerDefinition?.subtypeField&&n?.layerDefinition?.subtypes&&j.read({subtypes:n.layerDefinition.subtypes,subtypeField:n.layerDefinition.subtypeField}),new a({layer:j,spatialReference:M,isTable:C})}queryAttachments(){return(0,h.A)(function*(){return[]})()}getFeatureByObjectId(n){var M=this;return(0,h.A)(function*(){const F=M._createQuery();F.where=M.objectIdField+"="+n.toString();const P=yield M._layer.queryFeatures(F);return 1===P.features.length?P.features[0]:null})()}getOwningSystemUrl(){return(0,h.A)(function*(){return""})()}getIdentityUser(){return(0,h.A)(function*(){return""})()}get preferredTimeZone(){return"preferredTimeZone"in this._layer?this._layer.preferredTimeZone:null}get dateFieldsTimeZone(){return"dateFieldsTimeZone"in this._layer?this._layer.dateFieldsTimeZone:null}get datesInUnknownTimezone(){return"datesInUnknownTimezone"in this._layer&&this._layer.datesInUnknownTimezone}get editFieldsInfo(){return"editFieldsInfo"in this._layer?this._layer.editFieldsInfo:null}get timeInfo(){return this._layer?.timeInfo}getFeatureSetInfo(){var n=this;return(0,h.A)(function*(){const M=n._layer.title&&n._layer.parent;return n.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:M?n._layer.id??null:null,webMapLayerTitle:M?n._layer.title??null:null,className:null,objectClassId:null}})()}}},58314:(ie,H,o)=>{function h($,S){return $===S?0:null===$?-1:null===S?1:$<S?-1:1}o.d(H,{A:()=>G});class G{constructor(S){const U=S.split(",");this._fields=[],this._directions=[];for(let N=0;N<U.length;N++){const K=U[N].match(/\S+/g);this._fields.push(K[0]),2===K.length?"asc"===K[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let S="";for(let U=0;U<this._fields.length;U++)0!==U&&(S+=","),S+=this._fields[U],S+=1===this._directions[U]?" ASC":" DESC";return S}order(S){S.sort((U,N)=>{for(let K=0;K<this._fields.length;K++){const O=this.featureValue(U.feature,this._fields[K],K),D=this.featureValue(N.feature,this._fields[K],K);let I=0;if(I=1===this._directions[K]?h(O,D):-1*h(O,D),0!==I)return I}return 0})}scanForField(S){for(let U=0;U<this._fields.length;U++)if(this._fields[U].toLowerCase().trim()===S.toLowerCase().trim())return!0;return!1}replaceFields(S){let U="";for(let N=0;N<this._fields.length;N++){0!==N&&(U+=",");let K=this._fields[N];for(const O of S)if(K.toLowerCase()===O.field.toLowerCase()){K=O.newfield;break}U+=K,U+=1===this._directions[N]?" ASC":" DESC"}return new G(U)}featureValue(S,U,N){const K=S.attributes[U];if(void 0!==K)return K;for(const O in S.attributes)if(U.toLowerCase()===O.toLowerCase())return this._fields[N]=O,S.attributes[O];return null}}},33087:(ie,H,o)=>{o.d(H,{q:()=>G});var h=o(60611);class G{constructor(S,U){this._storage=new h.F,this.id="",this.name="",this.size=0,this._storage.maxSize=S,this._storage.register(this),U&&this._storage.registerRemoveFunc("",U)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(S,U,N=1){this._storage.put(this,S,U,N,1)}pop(S){return this._storage.pop(this,S)}get(S){return this._storage.get(this,S)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(S){this._storage.maxSize=S}resetHitRate(){}}},60611:(ie,H,o)=>{o.d(H,{F:()=>N,Ti:()=>G});var h=o(12438);const G=-3,$=G-1;var S,D;(D=S||(S={}))[D.ALL=0]="ALL",D[D.SOME=1]="SOME";class N{get size(){return this._size}constructor(I=10485760){this._maxSize=I,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new h.A,this._users=new h.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(I){this._users.push(I)}deregister(I){this._users.removeUnordered(I)}registerRemoveFunc(I,f){this._removeFuncs.push([I,f])}deregisterRemoveFunc(I){this._removeFuncs.filterInPlace(f=>f[0]!==I)}get maxSize(){return this._maxSize}set maxSize(I){this._maxSize=Math.max(I,-1),this._checkSize()}getSize(I,f){return this._db.get(I.id+f)?.size??0}put(I,f,p,a,A){const n=this._db.get(f=I.id+f);if(n&&(this._size-=n.size,I.size-=n.size,this._db.delete(f),n.entry!==p&&this._notifyRemove(f,n.entry,n.size,S.ALL)),a>this._maxSize)return void this._notifyRemove(f,p,a,S.ALL);if(void 0===p)return void console.warn("Refusing to cache undefined entry ");if(!a||a<0)return console.warn(`Refusing to cache entry with size ${a} for key ${f}`),void this._notifyRemove(f,p,0,S.ALL);const M=1+Math.max(A,$)-G;this._db.set(f,new O(p,a,M)),this._size+=a,I.size+=a,this._checkSize()}updateSize(I,f,p,a){const A=this._db.get(f=I.id+f);if(A&&A.entry===p){for(this._size-=A.size,I.size-=A.size;a>this._maxSize;){const n=this._notifyRemove(f,p,a,S.SOME);if(!(null!=n&&n>0))return void this._db.delete(f);a=n}A.size=a,this._size+=a,I.size+=a,this._checkSize()}}pop(I,f){const p=this._db.get(f=I.id+f);if(p)return this._size-=p.size,I.size-=p.size,this._db.delete(f),++this._hit,p.entry;++this._miss}get(I,f){const p=this._db.get(f=I.id+f);if(void 0!==p)return this._db.delete(f),p.lives=p.lifetime,this._db.set(f,p),++this._hit,p.entry;++this._miss}peek(I,f){const p=this._db.get(I.id+f);return p?++this._hit:++this._miss,p?.entry}get performanceInfo(){const I={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},f={},p=new Array;this._db.forEach((n,M)=>{const F=n.lifetime;p[F]=(p[F]||0)+n.size,this._users.forAll(P=>{const{id:w,name:m}=P;M.startsWith(w)&&(f[m]=(f[m]||0)+n.size)})});const a={};this._users.forAll(n=>{const M=n.name;"hitRate"in n&&"number"==typeof n.hitRate&&!isNaN(n.hitRate)&&n.hitRate>0?(f[M]=f[M]||0,a[M]=Math.round(100*n.hitRate)+"%"):a[M]="0%"});const A=Object.keys(f);A.sort((n,M)=>f[M]-f[n]),A.forEach(n=>I[n]=Math.round(f[n]/2**20)+"MB / "+a[n]);for(let n=p.length-1;n>=0;--n){const M=p[n];M&&(I["Priority "+(n+G-1)]=Math.round(M/this._size*100)+"%")}return I}resetStats(){this._hit=this._miss=0,this._users.forAll(I=>I.resetHitRate())}clear(I){const f=I.id;this._db.forEach((p,a)=>{a.startsWith(f)&&(this._size-=p.size,this._db.delete(a),this._notifyRemove(a,p.entry,p.size,S.ALL))}),I.size=0}clearAll(){this._db.forEach((I,f)=>this._notifyRemove(f,I.entry,I.size,S.ALL)),this._users.forAll(I=>I.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(I,f,p,a){let A;return this._removeFuncs.some(n=>{if(I.startsWith(n[0])){const M=n[1](f,a,p);return"number"==typeof M&&(A=M),!0}return!1}),A}_checkSize(){this._users.forAll(I=>this._checkSizeLimits(I)),this._checkSizeLimits()}_checkSizeLimits(I){const f=I??this;if(f.maxSize<0||f.size<=f.maxSize)return;const p=I?.id;let a=!0;for(;a;){a=!1;for(const[A,n]of this._db)if(0===n.lifetime&&(!p||A.startsWith(p))){if(this._purgeItem(A,n,I),f.size<=.9*f.maxSize)return;a||=this._db.has(A)}}for(const[A,n]of this._db)if((!p||A.startsWith(p))&&(this._purgeItem(A,n,I),f.size<=.9*f.maxSize))return}_purgeItem(I,f,p=this._users.find(a=>I.startsWith(a.id))){if(this._db.delete(I),f.lives<=1){this._size-=f.size,p&&(p.size-=f.size);const a=this._notifyRemove(I,f.entry,f.size,S.SOME);null!=a&&a>0&&(this._size+=a,p&&(p.size+=a),f.lives=f.lifetime,f.size=a,this._db.set(I,f))}else--f.lives,this._db.set(I,f)}}class O{constructor(I,f,p){this.entry=I,this.size=f,this.lifetime=p,this.lives=p}}},94376:(ie,H,o)=>{o.d(H,{p:()=>O});var h=o(8189),G=o(85211),N=(o(3248),o(35150),o(40707),o(76576));const O=D=>{let I=class extends D{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function K(D){return"portalItem"in D}(this)?this.portalItem?.apiKey:null}set apiKey(f){null!=f?this._override("apiKey",f):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,h._)([(0,G.MZ)({type:String})],I.prototype,"apiKey",null),I=(0,h._)([(0,N.$)("esri.layers.mixins.APIKeyMixin")],I),I}},43124:(ie,H,o)=>{o.d(H,{Rr:()=>D,fY:()=>p,ne:()=>f});var h=o(8189),G=o(89221),$=o(85211),K=(o(3248),o(35150),o(40707),o(76576)),O=o(15848);function D(a,A,n){if(!a)return null;const M=a.find(P=>!!P.field);if(!M)return null;const F=new O.A;return F.read(M,n),[F]}const f={type:[O.A],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:D},write:{writer:function I(a,A,n,M){const F=a.find(P=>!!P.field);F&&(0,G.sM)(n,[F.toJSON()],A)}}}},p=a=>{let A=class extends a{constructor(){super(...arguments),this.orderBy=null}};return(0,h._)([(0,$.MZ)(f)],A.prototype,"orderBy",void 0),A=(0,h._)([(0,K.$)("esri.layers.mixins.OrderedLayer")],A),A}},47063:(ie,H,o)=>{o.d(H,{A:()=>A});var h=o(8189),G=o(90660),$=o(71065),S=o(85211),O=(o(3248),o(35150),o(40707),o(17221)),D=o(76576),I=o(50305),f=o(39664),p=o(69741);let a=class extends(G.A.ClonableMixin($.A)){constructor(n){super(n),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(n){const M={};for(const F of Object.keys(n))M[F]=(0,f.rS)(n[F]);return M}writeDomains(n,M){const F={};for(const P of Object.keys(n))n[P]&&(F[P]=n[P]?.toJSON());M.domains=F}};(0,h._)([(0,S.MZ)({json:{write:!0}})],a.prototype,"id",void 0),(0,h._)([(0,S.MZ)({json:{write:!0}})],a.prototype,"name",void 0),(0,h._)([(0,S.MZ)({json:{write:!0}})],a.prototype,"domains",void 0),(0,h._)([(0,O.w)("domains")],a.prototype,"readDomains",null),(0,h._)([(0,I.K)("domains")],a.prototype,"writeDomains",null),(0,h._)([(0,S.MZ)({type:[p.A],json:{write:!0}})],a.prototype,"templates",void 0),a=(0,h._)([(0,D.$)("esri.layers.support.FeatureType")],a);const A=a},64584:(ie,H,o)=>{o.d(H,{A:()=>f});var D,h=o(8189),G=o(31178),$=o(71065),S=o(85211),O=(o(3248),o(35150),o(40707),o(76576));let I=D=class extends $.A{constructor(p){super(p),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new G.A}clone(){return new D({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,h._)([(0,S.MZ)({type:String,json:{write:{isRequired:!0}}})],I.prototype,"floorField",void 0),(0,h._)([(0,S.MZ)({json:{read:!1,write:!1}})],I.prototype,"viewAllMode",void 0),(0,h._)([(0,S.MZ)({json:{read:!1,write:!1}})],I.prototype,"viewAllLevelIds",void 0),I=D=(0,h._)([(0,O.$)("esri.layers.support.LayerFloorInfo")],I);const f=I},15848:(ie,H,o)=>{o.d(H,{A:()=>p});var D,h=o(8189),G=o(49976),$=o(71065),S=o(85211),O=(o(3248),o(35150),o(40707),o(76576));const I=new G.J({asc:"ascending",desc:"descending"});let f=D=class extends $.A{constructor(a){super(a),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new D({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,h._)([(0,S.MZ)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,h._)([(0,S.MZ)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],f.prototype,"valueExpression",void 0),(0,h._)([(0,S.MZ)({type:I.apiValues,json:{type:I.jsonValues,read:I.read,write:I.write}})],f.prototype,"order",void 0),f=D=(0,h._)([(0,O.$)("esri.layers.support.OrderByInfo")],f);const p=f},36267:(ie,H,o)=>{o.d(H,{A:()=>a});var h=o(8189),G=o(90660),$=o(49976),S=o(71065),U=o(85211),D=(o(3248),o(35150),o(40707),o(76576));const I=new $.J({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),f=new $.J({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let p=class extends(G.A.ClonableMixin(S.A)){constructor(A){super(A),this.cardinality=null,this.catalogId=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,h._)([(0,U.MZ)({json:{read:I.read,write:I.write}})],p.prototype,"cardinality",void 0),(0,h._)([(0,U.MZ)({json:{name:"catalogID"}})],p.prototype,"catalogId",void 0),(0,h._)([(0,U.MZ)({json:{read:!0,write:!0}})],p.prototype,"composite",void 0),(0,h._)([(0,U.MZ)({json:{read:!0,write:!0}})],p.prototype,"id",void 0),(0,h._)([(0,U.MZ)({json:{read:!0,write:!0}})],p.prototype,"keyField",void 0),(0,h._)([(0,U.MZ)({json:{read:!0,write:!0}})],p.prototype,"keyFieldInRelationshipTable",void 0),(0,h._)([(0,U.MZ)({json:{read:!0,write:!0}})],p.prototype,"name",void 0),(0,h._)([(0,U.MZ)({json:{read:!0,write:!0}})],p.prototype,"relatedTableId",void 0),(0,h._)([(0,U.MZ)({json:{read:!0,write:!0}})],p.prototype,"relationshipTableId",void 0),(0,h._)([(0,U.MZ)({json:{read:f.read,write:f.write}})],p.prototype,"role",void 0),p=(0,h._)([(0,D.$)("esri.layers.support.Relationship")],p);const a=p},85791:(ie,H,o)=>{o.d(H,{A:()=>M});var h=o(10467),G=o(8189),$=o(98877),S=o(89447),U=o(31178),N=o(85211),I=(o(3248),o(35150),o(40707),o(76576)),f=o(86300),p=o(48218);let n=class extends $.A{constructor(F){super(F),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,S.UT)(()=>(0,p.lw)()):null}get featureUtilsPromise(){return this._get("featureUtilsPromise")??o.e(3958).then(o.bind(o,93958)).then(F=>this._featureUtils=F)}get calculatedExpressions(){const F=new U.A;if(!this.expressionsUsedInTitle.length)return F;if(!this._arcadeTask?.value){for(const P of this.expressionsUsedInTitle??[])F.push({name:P.name,invalid:!0});return F}for(const P of this.expressionsUsedInTitle)try{const w=this._arcadeTask.value.arcade.parseScript(P.expression,["$layer","$map","$datastore"]);if(w.isAsync){F.push({name:P.name,invalid:!0});break}F.push({name:P.name,syntax:w,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(w,{vars:{$feature:"any"}})})}catch{F.push({name:P.name,invalid:!0});break}return F}get expressionsUsedInTitle(){let F=this.effectivePopupTemplate?.title??"";return"string"!=typeof F?[]:(F=F.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter(P=>F.includes(`{expression/${P.name.toLowerCase()}}`))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some(F=>!0===F.invalid)}get requiredFields(){const F=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const w of this.calculatedExpressions?.toArray()??[])try{const m=this._arcadeTask.value.arcade.extractFieldLiterals(w.syntax);for(const d of m){const E=d.split("."),g=this.fieldsIndex.get(E.at(-1)??"");g&&F.add(g.name)}}catch{}const P=this._extractFieldNames(this.workingTitle);for(const w of P){const m=this.fieldsIndex.get(w);m&&F.add(m.name)}return F}get titleFromDisplayField(){let F="";return this.displayField&&(F=this.fieldsIndex.get(this.displayField)?.name??""),F||(F=this.fieldsIndex.get(this.objectIdField)?.name??""),F?`{${F}}`:""}get workingTitle(){const F=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===F||null==F||this.hasBadExpressions||"string"!=typeof F?this.titleFromDisplayField:F}getTitle(F,P,w){var m=this;return(0,h.A)(function*(){try{const{attributes:d}=P,E=w?.timeZone??"system",[{substituteFieldsInLinksAndAttributes:g}]=yield Promise.all([m.featureUtilsPromise,m._arcadeTask?.promise]);if(w.fetchMissingFields&&(P=yield m._checkAndReQueryGraphic(F,P)),m.workingTitle&&m.fieldInfoMap){const l=m._createFormattedAttributes(F,P,E).global;return g({attributes:d,expressionAttributes:null,fieldInfoMap:m.fieldInfoMap,globalAttributes:l,layer:F,text:m.workingTitle})}return""}catch{}return""})()}_checkAndReQueryGraphic(F,P){var w=this;return(0,h.A)(function*(){const m=P.getObjectId();if(null==m)return P;if(!(0,f.Kl)(w.requiredFields,P)){const d=F.createQuery();d.where="1=1",d.outFields=[...w.requiredFields],d.objectIds=[m];const E=yield F.queryFeatures(d);if(1===E?.features.length)return E.features[0]}return P})()}_createFieldInfoMap(F){const P=new Map;if(!F)return P;for(const w of F){if(!w.fieldName)continue;const m=this.fieldsIndex.get(w.fieldName),d=m?.name??w.fieldName;w.fieldName=d,P.set(d.toLowerCase(),w)}return P}_createFormattedAttributes(F,P,w="system"){const m=this.effectivePopupTemplate?.fieldInfos??[],d={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const g=this._arcadeTask.value.Feature.createFromGraphicLikeObject(P.geometry,P.attributes,F,null);for(const l of this.calculatedExpressions)try{d[`expression/${l.name}`]=l.func({vars:{$feature:g}})}catch{}}const E={...P.attributes,...d};return{global:this._featureUtils.formatAttributes({fieldInfos:m,attributes:E,graphic:P,timeZone:w,layer:F,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(F){return(0,f.nw)(F).filter(P=>!(0===P.indexOf("relationships/")||0===P.indexOf("expression/")))}};(0,G._)([(0,N.MZ)({readOnly:!0})],n.prototype,"_arcadeTask",null),(0,G._)([(0,N.MZ)()],n.prototype,"_featureUtils",void 0),(0,G._)([(0,N.MZ)({readOnly:!0})],n.prototype,"featureUtilsPromise",null),(0,G._)([(0,N.MZ)({readOnly:!0})],n.prototype,"calculatedExpressions",null),(0,G._)([(0,N.MZ)()],n.prototype,"displayField",void 0),(0,G._)([(0,N.MZ)()],n.prototype,"effectivePopupTemplate",void 0),(0,G._)([(0,N.MZ)()],n.prototype,"expressionsUsedInTitle",null),(0,G._)([(0,N.MZ)()],n.prototype,"fieldsIndex",void 0),(0,G._)([(0,N.MZ)()],n.prototype,"fieldInfoMap",null),(0,G._)([(0,N.MZ)()],n.prototype,"fields",void 0),(0,G._)([(0,N.MZ)()],n.prototype,"objectIdField",void 0),(0,G._)([(0,N.MZ)()],n.prototype,"requiredFields",null),n=(0,G._)([(0,I.$)("esri.layers.support.TitleCreator")],n);const M=n},27960:(ie,H,o)=>{o.d(H,{Ch:()=>U,mW:()=>$,u2:()=>S});var h=o(69287),G=o(63484);function $(a,A){return{...A,filterMode:a.mode}}function S(a,A){return K(a,A).next().value??null}function U(a,A,n){const M=function N(a){if("manual"===I(a))return null;const A=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:n,maxScale:M}of a.filters)A[0]=Math.max(A[0],f(n)),A[1]=Math.min(A[1],p(M));return A}(a);if(M&&((0,h.gg)(A,M[0])||(0,h.ZH)(n,M[1])))return"";const F=Array.from(K(a,A,n)),P=function O(a,A,n){if(0===a.length)return!0;const M=f(a.at(0)?.minScale),F=p(a.at(-1)?.maxScale);if((0,h.ZH)(M,A)||(0,h.gg)(F,n))return!0;for(let P=0;P<a.length-1;P++){const w=a[P];if((0,h.ZH)(f(a[P+1].minScale),p(w.maxScale)))return!0}return!1}(F,A,n)?"1=1":F.map(w=>w.where||"1=1").reduce((w,m)=>(0,G.IW)(w,m),"");return P&&"1=1"!==P?P:""}function*K(a,A,n){if("manual"===I(a)){const M=a.filters.find(F=>F.id===a.activeFilterId);M&&(yield M)}else{"object"==typeof A&&(A=A.scale);for(const M of a.filters)D(M.minScale,M.maxScale,A,n)&&(yield M)}}function D(a,A,n,M){return a=f(a),n=f(n),A=p(A),!(!(0,h.Sp)(n,a)&&(M??n)>a||(0,h.Hx)(A,n)||void 0!==M&&(0,h.Sp)(M,a))}function I(a){return"mode"in a?a.mode:a.filterMode}function f(a){return a||Number.POSITIVE_INFINITY}function p(a){return a||0}},6829:(ie,H,o)=>{o.d(H,{CW:()=>a,Fm:()=>O,Hz:()=>A,JQ:()=>p,JZ:()=>c,ND:()=>M,R_:()=>N,U9:()=>f,fu:()=>G,nr:()=>n,oF:()=>$,rq:()=>D,z$:()=>I});const h=[["binary","application/octet-stream","bin",""]];function G(C,j){return null!=m(j.name,C?.supportedFormats??[])}function $(C,j){if(!C)return!1;const B=D(j,C.supportedFormats??[]);return null!=B&&C.editFormats.includes(B)}function N(C,j){return d(function w(C,j){const B=C.toLowerCase();return F(j).find(b=>E(b)===B)}(C,j))}function K(C,j){return d(m(C,j))}function O(C,j){return E(function P(C,j){return F(j).find(B=>d(B)===C)}(C,j))}function D(C,j){return K(C.name,j)??N(C.type,j)}function I(C,j,B){return N(C,B)??K(j,B)}function f({supportedFormats:C}){return I("model/gltf-binary","glb",C)}function p(C){const j=f(C);return null!=j&&C.editFormats.includes(j)}function a({supportedFormats:C}){return I("model/gltf+json","gltf",C)}function A(C){if(!C)return null;const j=f(C),B=a(C);let b=null;for(const R of C.queryFormats){if(R===j)return R;R===B&&(b=R)}return b}function n({supportedFormats:C}){return I("application/esri3do-SR_world","wld",C)}function M({supportedFormats:C}){return I("application/esri3do-SR_prj","prj",C)}function F(C){return[...h,...C]}function m(C,j){const B=C.toLowerCase();return F(j).find(b=>function g(C){return C?.[2].split(",").map(j=>j.toLowerCase())??[]}(b).some(R=>B.endsWith(R)))}function d(C){return C?.[0]}function E(C){return C?.[1].toLowerCase()}function c(C){return C.tables?.find(j=>"assetMaps"===j.role)}},4858:(ie,H,o)=>{o.d(H,{BI:()=>A,D3:()=>p,XJ:()=>a,lc:()=>f,mX:()=>M,rU:()=>n,tH:()=>E});var h=o(1119);const G="__begin__",$="__end__",S=new RegExp(G,"ig"),U=new RegExp($,"ig"),N=new RegExp("^"+G,"i"),K=new RegExp($+"$","i"),O='"',D=O+" + ",I=" + "+O;function f(g){return g.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function p(g){return g.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function a(g){const l={expression:"",type:"none"};return g.labelExpressionInfo?g.labelExpressionInfo.value?(l.expression=g.labelExpressionInfo.value,l.type="conventional"):g.labelExpressionInfo.expression&&(l.expression=g.labelExpressionInfo.expression,l.type="arcade"):null!=g.labelExpression&&(l.expression=f(g.labelExpression),l.type="conventional"),l}function A(g){const l=a(g);switch(l.type){case"conventional":return M(l.expression);case"arcade":return l.expression}return null}function n(g){const l=a(g);switch(l.type){case"conventional":return function P(g){return g?.match(F)?.[1].trim()||null}(l.expression);case"arcade":return E(l.expression)}return null}function M(g){let l;return g?(l=(0,h.HC)(g,c=>G+'$feature["'+c+'"]'+$),l=N.test(l)?l.replace(N,""):O+l,l=K.test(l)?l.replace(K,""):l+O,l=l.replaceAll(S,D).replaceAll(U,I)):l='""',l}const F=/^\s*\{([^}]+)\}\s*$/i,w=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,m=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,d=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function E(g){if(!g)return null;let l=w.exec(g)||m.exec(g);return l?l[1]||l[3]:(l=d.exec(g),l?l[2]:null)}},90543:(ie,H,o)=>{o.d(H,{S:()=>p,d:()=>g});var h=o(3248),G=o(68438),$=o(6829);function S(l,c,C){return!!N(l,c,C)}function U(l,c,C){return N(l,c,C)}function N(l,c,C){return l&&l.hasOwnProperty(c)?l[c]:C}const K={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function O(l){const c=l?.supportedSpatialAggregationStatistics?.map(C=>C.toLowerCase());return{envelope:!!c?.includes("envelopeaggregate"),centroid:!!c?.includes("centroidaggregate"),convexHull:!!c?.includes("convexhullaggregate")}}function D(l,c){return!!l?.supportedOperationsWithCacheHint?.map(j=>j.toLowerCase())?.includes(c.toLowerCase())}function I(l){const c=l?.supportedStatisticTypes?.map(C=>C.toLowerCase());return{count:!!c?.includes("count"),sum:!!c?.includes("sum"),min:!!c?.includes("min"),max:!!c?.includes("max"),avg:!!c?.includes("avg"),var:!!c?.includes("var"),stddev:!!c?.includes("stddev"),percentileContinuous:!!c?.includes("percentile_continuous"),percentileDiscrete:!!c?.includes("percentile_discrete"),envelope:!!c?.includes("envelopeaggregate"),centroid:!!c?.includes("centroidaggregate"),convexHull:!!c?.includes("convexhullaggregate")}}function f(l){const c=l?.supportedNormalizationTypes?.map(C=>C.toLowerCase());return{field:!!c?.includes("field"),log:!!c?.includes("log"),naturalLog:!!c?.includes("naturallog"),percentOfTotal:!!c?.includes("percentoftotal"),squareRoot:!!c?.includes("squareroot")}}function p(l,c){return{analytics:a(l),attachment:A(l),data:n(l),metadata:M(l),operations:F(l.capabilities,l,c),query:P(l,c),queryAttributeBins:d(l),queryRelated:w(l),queryTopFeatures:m(l),editing:E(l)}}function a(l){return{supportsCacheHint:D(l.advancedQueryCapabilities,"queryAnalytics")}}function A(l){const c=l.attachmentProperties,C={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:D(l.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:S(l.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:S(l,"supportsAttachmentsResizing",!1)};return c&&Array.isArray(c)&&c.forEach(j=>{const B=K[j.name];B&&(C[B]=!!j.isEnabled)}),C}function n(l){return{isVersioned:S(l,"isDataVersioned",!1),isBranchVersioned:S(l,"isDataBranchVersioned",!1),supportsAttachment:S(l,"hasAttachments",!1),supportsM:S(l,"hasM",!1),supportsZ:S(l,"hasZ",!1)}}function M(l){return{supportsAdvancedFieldProperties:S(l,"supportsFieldDescriptionProperty",!1)}}function F(l,c,C){const j=l?l.toLowerCase().split(",").map(Re=>Re.trim()):[],B=C?(0,G.qg)(C):null,b=j.includes(null!=B&&"MapServer"===B.serverType?"data":"query"),R=j.includes("editing")&&!c.datesInUnknownTimezone;let k=R&&j.includes("create"),z=R&&j.includes("delete"),X=R&&j.includes("update");const re=j.includes("changetracking"),ue=c.advancedQueryCapabilities;return R&&!(k||z||X)&&(k=z=X=!0),{supportsCalculate:S(c,"supportsCalculate",!1),supportsTruncate:S(c,"supportsTruncate",!1),supportsValidateSql:S(c,"supportsValidateSql",!1),supportsAdd:k,supportsDelete:z,supportsEditing:R,supportsChangeTracking:re,supportsQuery:b,supportsQueryAnalytics:S(ue,"supportsQueryAnalytic",!1),supportsQueryAttachments:S(ue,"supportsQueryAttachments",!1),supportsQueryBins:S(ue,"supportsQueryBins",!1),supportsQueryTopFeatures:S(ue,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:S(c,"supportsAttachmentsResizing",!1),supportsSync:j.includes("sync"),supportsUpdate:X,supportsExceedsLimitStatistics:S(c,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:S(c,"supportsAsyncConvert3D",!1)}}function P(l,c){const C=l.advancedQueryCapabilities,j=l.ownershipBasedAccessControlForFeatures,B=l.archivingInfo,b=l.currentVersion,R=c?.includes("MapServer"),k=!R||b>=(0,h.A)("mapserver-pbf-version-support"),z=(0,G.Wo)(c),X=new Set((l.supportedQueryFormats??"").split(",").map(re=>re.toLowerCase().trim()));return{maxRecordCount:U(l,"maxRecordCount",void 0),maxRecordCountFactor:U(l,"maxRecordCountFactor",void 0),standardMaxRecordCount:U(l,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:O(C),supportsCacheHint:S(C,"supportsQueryWithCacheHint",!1)||D(C,"query"),supportsCentroid:S(C,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:z,supportsCurrentUser:S(C,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:S(C,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:S(C,"supportsDisjointSpatialRel",!1),supportsDistance:S(C,"supportsQueryWithDistance",!1),supportsDistinct:S(C,"supportsDistinct",l.supportsAdvancedQueries),supportsExtent:S(C,"supportsReturningQueryExtent",!1),supportsFormatPBF:k&&X.has("pbf"),supportsFullTextSearch:S(C,"supportsFullTextSearch",!1),supportsGeometryProperties:S(C,"supportsReturningGeometryProperties",!1),supportsHavingClause:S(C,"supportsHavingClause",!1),supportsHistoricMoment:S(B,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:S(C,"supportsMaxRecordCountFactor",!1),supportsOrderBy:S(C,"supportsOrderBy",l.supportsAdvancedQueries),supportsPagination:S(C,"supportsPagination",!1),supportsPercentileStatistics:S(C,"supportsPercentileStatistics",!1),supportsQuantization:S(l,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:S(l,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:S(j,"allowAnonymousToQuery",!0),supportsQueryByOthers:S(j,"allowOthersToQuery",!0),supportsQueryGeometry:S(l,"supportsReturningQueryGeometry",!1),supportsResultType:S(C,"supportsQueryWithResultType",!1),supportsReturnMesh:!!(0,$.Hz)(l.infoFor3D),supportsSpatialAggregationStatistics:S(C,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:S(C,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:S(l,"useStandardizedQueries",!1),supportsStatistics:S(C,"supportsStatistics",l.supportsStatistics),supportsTopFeaturesQuery:S(C,"supportsTopFeaturesQuery",!1),supportsTrueCurve:S(C,"supportsTrueCurve",!1),tileMaxRecordCount:U(l,"tileMaxRecordCount",void 0)}}function w(l){const c=l.advancedQueryCapabilities,C=S(c,"supportsAdvancedQueryRelated",!1);return{supportsPagination:S(c,"supportsQueryRelatedPagination",!1),supportsCount:C,supportsOrderBy:C,supportsCacheHint:D(c,"queryRelated")}}function m(l){return{supportsCacheHint:D(l.advancedQueryCapabilities,"queryTopFilter")}}function d(l){const c=l?l.queryBinsCapabilities:void 0;return{supportsDate:S(c,"supportsDateBin",!1),supportsFixedInterval:S(c,"supportsFixedIntervalBin",!1),supportsAutoInterval:S(c,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:S(c,"supportsFixedBoundariesBin",!1),supportsStackBy:S(c,"supportsStackBy",!1),supportsSplitBy:S(c,"supportsSplitBy",!1),supportsSnapToData:S(c,"supportsSnapToData",!1),supportsReturnFullIntervalBin:S(c,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:S(c,"supportsFirstDayOfWeek",!1),supportsNormalization:S(c,"supportsNormalization",!1),supportedStatistics:I(c),supportedNormalizationTypes:f(c)}}function E(l){const c=l.ownershipBasedAccessControlForFeatures,C=l?l.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:S(l,"allowGeometryUpdates",!0),supportsGlobalId:S(l,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:S(l,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:S(l,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:S(l,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:S(l,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:S(c,"allowAnonymousToDelete",!0),supportsDeleteByOthers:S(c,"allowOthersToDelete",!0),supportsUpdateByAnonymous:S(c,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:S(c,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:S(C,"supportsAsyncApplyEdits",!1),zDefault:U(l,"zDefault",void 0)}}function g(l){return{operations:{supportsAppend:S(l,"supportsAppend",!1),supportsCoverageQuery:l?.playbackInfo?.klv["0601"]??!1,supportsExportClip:S(l,"supportsExportClip",!1),supportsExportFrameset:S(l,"supportsExportFrameset",!1),supportsMensuration:S(l,"supportsMensuration",!1),supportsUpdate:S(l,"supportsUpdate",!1)}}}},78592:(ie,H,o)=>{o.d(H,{O3:()=>D,PU:()=>K,YW:()=>f,ex:()=>U,hv:()=>I,zp:()=>N});var h=o(69287),G=o(67685),$=o(53781),S=o(89141);const U=2.4;function N(p){return(0,G.PN)(p*U)}function K(p){return(0,G.Lz)(p)/U}function O(p,a,A,n){let{color:M,ratio:F}=a,{color:P,ratio:w}=A;w===F&&(1===w?F-=1e-6:w+=1e-6);const m=(0,h.qE)((n-F)/(w-F),0,1);(0,$.l)(p,M.toArray(),P.toArray(),m)}function D(p){const A=new Uint8ClampedArray(2048);if((p=p.filter(({ratio:w})=>w>=0&&w<=1).sort((w,m)=>w.ratio-m.ratio).map(({color:w,ratio:m})=>({color:w,ratio:Math.max(m,.001)}))).length<1)return A;let n=p[0],M=p[0],F=1;const P=(0,S.vt)();for(let w=0;w<512;w++){const m=(w+.5)/512;for(;m>M.ratio&&F<p.length;)n=M,M=p[F++];O(P,n,M,m),A.set(P,4*w)}return A}function I(p,a,A){const n=Math.sqrt(p**2+a**2)/A;return n>1?0:3/(Math.PI*A**2)*(1-n**2)**2}function f(p){return"function"==typeof p?p:p?a=>+a[p]:()=>1}},98789:(ie,H,o)=>{o.d(H,{q:()=>G});var h=o(23743);function G($,S,U){if(!U?.features||!U.hasZ)return;const N=(0,h.N)(U.geometryType,S,$.outSpatialReference);if(null!=N)for(const K of U.features)N(K.geometry)}},93327:(ie,H,o)=>{o.d(H,{A:()=>w});var M,h=o(8189),G=o(81098),$=o(49976),S=o(71065),U=o(77806),N=o(85211),D=(o(3248),o(35150),o(17221)),I=o(76576),f=o(50305),p=o(32034),a=o(61320),A=o(6434),n=o(29141);const F=new $.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let P=M=class extends S.A{constructor(m){super(m),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(m,d){return this.readFeaturesWithClass(m,d,G.A)}writeGeometryType(m,d,E,g){if(m)return void F.write(m,d,E,g);const{features:l}=this;if(l)for(const c of l)if(null!=c?.geometry)return void F.write(c.geometry.type,d,E,g)}readQueryGeometry(m,d){if(!m)return null;const E=!!m.spatialReference,g=(0,a.rS)(m);return g&&!E&&d.spatialReference&&(g.spatialReference=p.A.fromJSON(d.spatialReference)),g}writeSpatialReference(m,d){if(m)return void(d.spatialReference=m.toJSON());const{features:E}=this;if(E)for(const g of E)if(g&&null!=g.geometry&&g.geometry.spatialReference)return void(d.spatialReference=g.geometry.spatialReference.toJSON())}clone(){return new M(this.cloneProperties())}cloneProperties(){return(0,U.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(m){const d=this.write();if(d.features&&Array.isArray(m)&&m.length>0)for(let E=0;E<d.features.length;E++){const g=d.features[E];if(g.geometry){const l=m?.[E];g.geometry=l?.toJSON()||g.geometry}}return d}quantize(m){const{scale:[d,E],translate:[g,l]}=m,j=this.features,B=this._getQuantizationFunction(this.geometryType,b=>Math.round((b-g)/d),b=>Math.round((l-b)/E));for(let b=0,R=j.length;b<R;b++)B?.(j[b].geometry)||(j.splice(b,1),b--,R--);return this.transform=m,this}unquantize(){const{geometryType:m,features:d,transform:E}=this;if(!E)return this;const{translate:[g,l],scale:[c,C]}=E;let b=null,R=null;if(this.hasZ&&null!=E?.scale?.[2]){const{translate:[,,z],scale:[,,X]}=E;b=re=>re*X+z}if(this.hasM&&null!=E?.scale?.[3]){const{translate:[,,,z],scale:[,,,X]}=E;R=re=>null==re?re:re*X+z}const k=this._getHydrationFunction(m,z=>z*c+g,z=>l-z*C,b,R);for(const{geometry:z}of d)null!=z&&k&&k(z);return this.transform=null,this}readFeaturesWithClass(m,d,E){const g=p.A.fromJSON(d.spatialReference),l=[];for(let c=0;c<m.length;c++){const C=m[c],j=E.fromJSON(C),B=C.geometry?.spatialReference;null==j.geometry||B||(j.geometry.spatialReference=g);const b=C.aggregateGeometries,R=j.aggregateGeometries;if(b&&null!=R)for(const k in R){const z=R[k],X=b[k],re=X?.spatialReference;null==z||re||(z.spatialReference=g)}l.push(j)}return l}_quantizePoints(m,d,E){let g,l;const c=[];for(let C=0,j=m.length;C<j;C++){const B=m[C];if(C>0){const b=d(B[0]),R=E(B[1]);b===g&&R===l||(c.push([b-g,R-l]),g=b,l=R)}else g=d(B[0]),l=E(B[1]),c.push([g,l])}return c.length>0?c:null}_getQuantizationFunction(m,d,E){return"point"===m?g=>(g.x=d(g.x),g.y=E(g.y),g):"polyline"===m||"polygon"===m?g=>{const l=(0,a.Bi)(g)?g.rings:g.paths,c=[];for(let C=0,j=l.length;C<j;C++){const b=this._quantizePoints(l[C],d,E);b&&c.push(b)}return c.length>0?((0,a.Bi)(g)?g.rings=c:g.paths=c,g):null}:"multipoint"===m?g=>{const l=this._quantizePoints(g.points,d,E);return l&&l.length>0?(g.points=l,g):null}:"extent"===m?g=>g:null}_getHydrationFunction(m,d,E,g,l){return"point"===m?c=>{c.x=d(c.x),c.y=E(c.y),g&&(c.z=g(c.z))}:"polyline"===m||"polygon"===m?c=>{const C=(0,a.Bi)(c)?c.rings:c.paths;let j,B;for(let b=0,R=C.length;b<R;b++){const k=C[b];for(let z=0,X=k.length;z<X;z++){const re=k[z];z>0?(j+=re[0],B+=re[1]):(j=re[0],B=re[1]),re[0]=d(j),re[1]=E(B)}}if(g&&l)for(let b=0,R=C.length;b<R;b++){const k=C[b];for(let z=0,X=k.length;z<X;z++){const re=k[z];re[2]=g(re[2]),re[3]=l(re[3])}}else if(g)for(let b=0,R=C.length;b<R;b++){const k=C[b];for(let z=0,X=k.length;z<X;z++){const re=k[z];re[2]=g(re[2])}}else if(l)for(let b=0,R=C.length;b<R;b++){const k=C[b];for(let z=0,X=k.length;z<X;z++){const re=k[z];re[2]=l(re[2])}}}:"extent"===m?c=>{c.xmin=d(c.xmin),c.ymin=E(c.ymin),c.xmax=d(c.xmax),c.ymax=E(c.ymax),g&&null!=c.zmax&&null!=c.zmin&&(c.zmax=g(c.zmax),c.zmin=g(c.zmin)),l&&null!=c.mmax&&null!=c.mmin&&(c.mmax=l(c.mmax),c.mmin=l(c.mmin))}:"multipoint"===m?c=>{const C=c.points;let j,B;for(let b=0,R=C.length;b<R;b++){const k=C[b];b>0?(j+=k[0],B+=k[1]):(j=k[0],B=k[1]),k[0]=d(j),k[1]=E(B)}if(g&&l)for(let b=0,R=C.length;b<R;b++){const k=C[b];k[2]=g(k[2]),k[3]=l(k[3])}else if(g)for(let b=0,R=C.length;b<R;b++){const k=C[b];k[2]=g(k[2])}else if(l)for(let b=0,R=C.length;b<R;b++){const k=C[b];k[2]=l(k[2])}}:null}};(0,h._)([(0,N.MZ)({type:String,json:{write:!0}})],P.prototype,"displayFieldName",void 0),(0,h._)([(0,N.MZ)({type:Boolean,json:{write:{overridePolicy:m=>({enabled:m})}}})],P.prototype,"exceededTransferLimit",void 0),(0,h._)([(0,N.MZ)({type:[G.A],json:{write:!0}})],P.prototype,"features",void 0),(0,h._)([(0,D.w)("features")],P.prototype,"readFeatures",null),(0,h._)([(0,N.MZ)({type:[n.A],json:{write:!0}})],P.prototype,"fields",void 0),(0,h._)([(0,N.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:F.read}}})],P.prototype,"geometryType",void 0),(0,h._)([(0,f.K)("geometryType")],P.prototype,"writeGeometryType",null),(0,h._)([(0,N.MZ)({type:Boolean,json:{write:{overridePolicy:m=>({enabled:m})}}})],P.prototype,"hasM",void 0),(0,h._)([(0,N.MZ)({type:Boolean,json:{write:{overridePolicy:m=>({enabled:m})}}})],P.prototype,"hasZ",void 0),(0,h._)([(0,N.MZ)({types:A.yR,json:{write:!0}})],P.prototype,"queryGeometry",void 0),(0,h._)([(0,D.w)("queryGeometry")],P.prototype,"readQueryGeometry",null),(0,h._)([(0,N.MZ)({type:p.A,json:{write:!0}})],P.prototype,"spatialReference",void 0),(0,h._)([(0,f.K)("spatialReference")],P.prototype,"writeSpatialReference",null),(0,h._)([(0,N.MZ)({json:{write:!0}})],P.prototype,"transform",void 0),P=M=(0,h._)([(0,I.$)("esri.rest.support.FeatureSet")],P),P.prototype.toJSON.isDefaultToJSON=!0;const w=P},68470:(ie,H,o)=>{o.d(H,{K:()=>p,Q:()=>D});var h=o(8189),G=o(49976),$=o(35150),S=o(85211),K=(o(3248),o(40707),o(15463)),O=o(76576);const D=(0,G.O)()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),I="percent-of-total",f="field",p=a=>{let A=class extends a{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let n=this._get("normalizationType");const M=!!this.normalizationField,F=null!=this.normalizationTotal;return M||F?(n=M&&f||F&&I||null,M&&F&&$.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):n!==f&&n!==I||(n=null),n}set normalizationType(n){this._set("normalizationType",n)}};return(0,h._)([(0,S.MZ)({type:String,json:{name:"parameters.normalizationField",write:!0}})],A.prototype,"normalizationField",void 0),(0,h._)([(0,S.MZ)({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],A.prototype,"normalizationMaxValue",void 0),(0,h._)([(0,S.MZ)({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],A.prototype,"normalizationMinValue",void 0),(0,h._)([(0,S.MZ)({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],A.prototype,"normalizationTotal",void 0),(0,h._)([(0,K.e)(D,{name:"parameters.normalizationType"})],A.prototype,"normalizationType",null),A=(0,h._)([(0,O.$)("esri.rest.support.NormalizationBinParametersMixin")],A),A}},32117:(ie,H,o)=>{o.d(H,{$w:()=>F,Bu:()=>R,DW:()=>C,FH:()=>Ue,FM:()=>O,G9:()=>S,GV:()=>w,Go:()=>I,K3:()=>je,Kn:()=>l,MM:()=>a,MO:()=>be,Nl:()=>k,Ny:()=>m,O2:()=>z,UE:()=>X,YC:()=>Ne,YF:()=>ue,ZO:()=>xe,_1:()=>B,_H:()=>E,_W:()=>P,_d:()=>c,bs:()=>Ce,dI:()=>Ke,e6:()=>f,gQ:()=>K,iA:()=>ve,jn:()=>n,lW:()=>p,mA:()=>A,n5:()=>re,pM:()=>j,pV:()=>g,pk:()=>Ge,rB:()=>ne,s4:()=>$,xo:()=>b,yH:()=>d,yX:()=>we,zb:()=>Re,zr:()=>M});var h=o(46988);function $(y,W,Z,V){return function G(y){return"function"==typeof y}(y)?y(W,Z,V):y}function S(y){return[y.r,y.g,y.b,y.a]}const U=" /-,\n";function N(y){let W=y.length;for(;W--;)if(!U.includes(y.charAt(W)))return!1;return!0}function K(y,W){const Z=[];let V=0,te=-1;do{if(te=y.indexOf("[",V),te>=V){if(te>V){const J=y.slice(V,te);Z.push([J,null,N(J)])}if(V=te+1,te=y.indexOf("]",V),te>=V){if(te>V){const J=W[y.slice(V,te)];J&&Z.push([null,J,!1])}V=te+1}}}while(-1!==te);if(V<y.length){const J=y.slice(V);Z.push([J,null,N(J)])}return Z}function O(y,W,Z,V){let te="",J=null;for(const ye of W){const[oe,_e,ce]=ye;if(oe)ce?J=oe:(J&&(te+=J,J=null),te+=oe);else{let me=_e;null!=Z&&(me=be(_e,Z));const de=y.attributes[me];de&&(J&&(te+=J,J=null),te+=de)}}return function D(y,W){switch("string"!=typeof y&&(y=String(y)),W){case"LowerCase":return y.toLowerCase();case"Allcaps":return y.toUpperCase();default:return y}}(te,V)}function I(y,W,Z,V,te,J,ye=!0){const oe=W/te,_e=Z/J,ce=Math.ceil(oe/2),me=Math.ceil(_e/2);for(let de=0;de<J;de++)for(let he=0;he<te;he++){const ge=4*(he+(ye?J-de-1:de)*te);let fe=0,Ie=0,Ee=0,De=0,Te=0,Oe=0,Ae=0;const Me=(de+.5)*_e;for(let Se=Math.floor(de*_e);Se<(de+1)*_e;Se++){const x=Math.abs(Me-(Se+.5))/me,e=(he+.5)*oe,s=x*x;for(let t=Math.floor(he*oe);t<(he+1)*oe;t++){let r=Math.abs(e-(t+.5))/ce;const u=Math.sqrt(s+r*r);u>=-1&&u<=1&&(fe=2*u*u*u-3*u*u+1,fe>0&&(r=4*(t+Se*W),Ae+=fe*y[r+3],Ee+=fe,y[r+3]<255&&(fe=fe*y[r+3]/250),De+=fe*y[r],Te+=fe*y[r+1],Oe+=fe*y[r+2],Ie+=fe))}}V[ge]=De/Ie,V[ge+1]=Te/Ie,V[ge+2]=Oe/Ie,V[ge+3]=Ae/Ee}}function f(y){return y?[y[0],y[1],y[2],y[3]/255]:[0,0,0,0]}function p(y){return y.data?.symbol??null}function a(y){return"CIMVectorMarker"===y.type||"CIMPictureMarker"===y.type||"CIMBarChartMarker"===y.type||"CIMCharacterMarker"===y.type||"CIMPieChartMarker"===y.type||"CIMStackedBarChartMarker"===y.type}function A(y){return"CIMGradientStroke"===y.type||"CIMPictureStroke"===y.type||"CIMSolidStroke"===y.type}function n(y){return null!=y&&("CIMGradientFill"===y.type||"CIMHatchFill"===y.type||"CIMPictureFill"===y.type||"CIMSolidFill"===y.type||"CIMWaterFill"===y.type)}function M(y){return null!=y&&("CIMMarkerPlacementAlongLineRandomSize"===y.type||"CIMMarkerPlacementAlongLineSameSize"===y.type||"CIMMarkerPlacementAlongLineVariableSize"===y.type||"CIMMarkerPlacementAtExtremities"===y.type||"CIMMarkerPlacementAtMeasuredUnits"===y.type||"CIMMarkerPlacementAtRatioPositions"===y.type||"CIMMarkerPlacementOnLine"===y.type||"CIMMarkerPlacementOnVertices"===y.type)}const F=(y,W=0)=>null==y||isNaN(y)?W:y,P=(y,W)=>y??W,w=(y,W)=>y??W,m=y=>y.tintColor?f(y.tintColor):[255,255,255,1],d=y=>{if(!y)return!1;for(const W of y)switch(W.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function E(){return Promise.all([o.e(3930),o.e(2076),o.e(4108)]).then(o.bind(o,27815))}function g(y){if(!y)return"normal";switch(y.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function l(y){if(!y)return"normal";switch(y.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function c(y){let W="normal",Z="normal";if(y){const V=y.toLowerCase();V.includes("italic")?W="italic":V.includes("oblique")&&(W="oblique"),V.includes("bold")?Z="bold":V.includes("light")&&(Z="lighter")}return{style:W,weight:Z}}function C(y){return y.underline?"underline":y.strikethrough?"line-through":"none"}function j(y){if(!y)return null;switch(y.type){case"CIMPolygonSymbol":if(y.symbolLayers)for(const W of y.symbolLayers){const Z=j(W);if(null!=Z)return Z}break;case"CIMTextSymbol":return j(y.symbol);case"CIMSolidFill":return y.color}return null}function B(y){if(y)switch(y.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const W=y.symbolLayers;if(W)for(const Z of W){const V=B(Z);if(null!=V)return V}break}case"CIMTextSymbol":return B(y.symbol);case"CIMSolidStroke":return y.color}}function b(y){if(y)switch(y.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(y.symbolLayers)for(const W of y.symbolLayers){const Z=b(W);if(void 0!==Z)return Z}break;case"CIMTextSymbol":return b(y.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return y.width}}function R(y){switch(y){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function k(y){switch(y){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function z(y){return(y?Object.keys(y):[]).map(W=>({name:W,alias:W,type:"string"==typeof y[W]?"esriFieldTypeString":"esriFieldTypeDouble"}))}const X=y=>y.includes("data:image/svg+xml");function re(y){if(!y)return null;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function ue(y){return y&&y.charAt(0).toLowerCase()+y.slice(1)}function Re(y,W,Z,V,te,J,ye=!0){const{infos:oe}=J;let _e=1,ce=0,me=0,de=0,he=1;for(const{absoluteAnchorPoint:Ie,offsetX:Ee,offsetY:De,rotation:Te,size:Oe,frameHeight:Ae,rotateClockWise:Me,scaleSymbolsProportionally:Se}of oe)he=Ie?1:_e,me=Pe(Ee,De,ce,he,me),de=Le(Ee,De,ce,he,de),Ae&&(Se||ye)&&(_e*=Oe/Ae),ce=Be(Te,Me,ce);const ge=Pe(V,te,ce,he,me),fe=Le(V,te,ce,he,de);return{size:y*_e,rotation:Be(W,Z,ce),offsetX:ge,offsetY:fe}}function xe(y){if(null==y)return!1;if(Array.isArray(y))return y.every(W=>xe(W));switch(typeof y){case"string":return!!y;case"number":return!isNaN(y)}}function ve(y,W){if("color"===W||"outlinecolor"===W||"backgroundcolor"===W||"borderlinecolor"===W||"tintcolor"===W)return[...h.K[W]];const Z=h.D[y];if(!Z)throw new Error(`InternalError: default value for type ${y}.`);return Z[W]}function je(y){return"string"==typeof y?function ke(y){return y.split(" ").map(W=>Number(W))}(y):y}function Ue(y){return y?.dashTemplate&&(y.dashTemplate=je(y.dashTemplate)),y}function Ce(y){if(null==y)return"Normal";switch(y.type){case"CIMTextSymbol":return y.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const W=y.symbolLayers;if(!W)return"Normal";for(const Z of W)if("CIMVectorMarker"===Z.type)return Ce(Z)}break;case"CIMVectorMarker":{const W=y.markerGraphics;if(!W)return"Normal";for(const Z of W)if(Z.symbol)return Ce(Z.symbol)}}return"Normal"}function Ne(y){if(y)switch(y.type){case"CIMTextSymbol":return y.height;case"CIMPointSymbol":{let W=0;if(y.symbolLayers)for(const Z of y.symbolLayers)if(Z)switch(Z.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const V=Z.size??h.D.CIMVectorMarker.size;V>W&&(W=V);break}}return W}case"CIMLineSymbol":case"CIMPolygonSymbol":{let W=0;if(y.symbolLayers)for(const Z of y.symbolLayers)if(Z)switch(Z.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const V=Z.width;null!=V&&V>W&&(W=V);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(Z.markerPlacement&&M(Z.markerPlacement)){const V=Z.size??h.D.CIMVectorMarker.size;V>W&&(W=V)}break;case"CIMPictureFill":{const V=Z.height;null!=V&&V>W&&(W=V)}}return W}}}function be(y,W){if(null!==W){const Z=W.get(y);return Z?Z.name:y}return y}function Ge(y){return y.map(W=>({...W,propertyName:ue(W.propertyName)}))}function ne(y){const W={};for(const Z in y){const V=y[Z];W[ue(Z)]=V}return W}function Le(y,W,Z,V,te){const J=Z*Math.PI/180;if(J){const ye=Math.cos(J);return(Math.sin(J)*y+ye*W)*V+te}return W*V+te}function Pe(y,W,Z,V,te){const J=Z*Math.PI/180;return J?(Math.cos(J)*y-Math.sin(J)*W)*V+te:y*V+te}function Be(y,W,Z){return W?Z-y:Z+y}function Ke(y,W,Z){const V="Color"===Z||"TintColor"===Z||"ToColor"===Z,te="Rotation"===Z||"Angle"===Z||"ToRotation"===Z;let J=W[ue(Z)];if(null!=J&&(V?J=[J[0]/255,J[1]/255,J[2]/255,J[3]/255]:te&&(J*=Math.PI/180)),null==J&&(J=ve(W.type,Z.toLowerCase()),null!=J&&(V?J=[J[0]/255,J[1]/255,J[2]/255,J[3]]:te&&(J*=Math.PI/180))),null!=W.primitiveName){const ye=y[W.primitiveName];if(null!=ye){const oe=ye[Z];null==oe||("string"==typeof oe||"number"==typeof oe||Array.isArray(oe)?(J=oe,null!=J&&(V?J=[J[0]/255,J[1]/255,J[2]/255,J[3]/255]:te&&(J*=Math.PI/180))):(J={valueExpressionInfo:oe,defaultValue:J},null!=J&&(V?J={type:"Process",op:"ArcadeColor",value:J}:te&&(J={type:"Process",op:"Divide",left:J,right:180/Math.PI}))))}}if(null==J)throw new Error(`Failed to derive a value or an expression for "${Z}".`);return J}function we(y,W){return Math.max(Math.min((y??W)/100,1),0)}},91644:(ie,H,o)=>{o.d(H,{A7:()=>O,Cx:()=>D,Hk:()=>I,JJ:()=>A,SF:()=>f,UK:()=>K,jM:()=>p,x3:()=>a}),o(3248);var G=o(88521),$=o(55417),S=o(46602),U=o(47705),N=o(48254);const K=S.A.fromJSON(N.Cb),O=$.A.fromJSON(N.yM),D=G.A.fromJSON(N.WR),I=U.A.fromJSON(N.JZ);function f(n){if(null==n)return null;switch(n.type){case"mesh":return null;case"point":case"multipoint":return K;case"polyline":return O;case"polygon":case"extent":return D}return null}const p=S.A.fromJSON(N.nC),a=$.A.fromJSON(N.HW),A=G.A.fromJSON(N.b6)},48254:(ie,H,o)=>{o.d(H,{Cb:()=>$,HW:()=>O,JR:()=>G,JZ:()=>N,WR:()=>U,b6:()=>D,fT:()=>h,nC:()=>K,yM:()=>S});const h=[252,146,31,255],G=[153,153,153,255],$={type:"esriSMS",style:"esriSMSCircle",size:6,color:h,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},S={type:"esriSLS",style:"esriSLSSolid",width:.75,color:h},U={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},N={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},K={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},O={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},D={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},71655:(ie,H,o)=>{var h,G;o.d(H,{X:()=>h}),(G=h||(h={}))[G.SAVE=0]="SAVE",G[G.SAVE_AS=1]="SAVE_AS"}}]);