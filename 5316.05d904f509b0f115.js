"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[5316],{76582:(H,A,t)=>{t.d(A,{LG:()=>I,mb:()=>T,yr:()=>p});var O=t(10467),m=t(56492),d=t(31610),P=t(12273),a=t(88532),n=t(63888),y=t(28399),C=t(50915),K=t(76169),L=t(4931);function I(c){return c&&"render"in c}function p(c){const r=document.createElement("canvas");return r.width=c.width,r.height=c.height,c.render(r.getContext("2d")),r}class T extends n.q{constructor(r=null,E=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._texture=null,this._width=void 0,this.x=0,this.y=0,this.immutable=E,this.source=r,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(r){this._height=r}get source(){return this._source}set source(r){null==r&&null==this._source||(this._source=r,this.invalidateTexture(),this.requestRender())}get texture(){return this._texture}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(r){this._width=r}beforeRender(r){super.beforeRender(r),this.updateTexture(r)}setSourceAsync(r,E){var e=this;return(0,O.A)(function*(){null!=e._uploadStatus&&e._uploadStatus.controller.abort();const i=new AbortController,o=(0,m.Tw)();return(0,m.NY)(E,()=>i.abort()),(0,m.NY)(i,h=>o.reject(h)),e._uploadStatus={controller:i,resolver:o},e.source=r,o.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}transitionStep(r,E){r>=64&&(this.fadeTransitionEnabled=!1),super.transitionStep(r,E)}setTransform(r){const E=(0,d.D_)(this.transforms.displayViewScreenMat3),[e,i]=r.toScreenNoRotation([0,0],[this.x,this.y]),o=this.resolution/this.pixelRatio/r.resolution,h=o*this.width,M=o*this.height,D=Math.PI*this.rotation/180;(0,d.Tl)(E,E,(0,a.fA)(e,i)),(0,d.Tl)(E,E,(0,a.fA)(h/2,M/2)),(0,d.e$)(E,E,-D),(0,d.Tl)(E,E,(0,a.fA)(-h/2,-M/2)),(0,d.Oe)(E,E,(0,a.fA)(h,M)),(0,d.lw)(this.transforms.displayViewScreenMat3,r.displayViewMat3,E)}setSamplingProfile(r){this._texture&&(r.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(r.samplingMode))}bind(r,E){this._texture&&r.bindTexture(this._texture,E)}updateTexture({context:r,painter:E}){var e=this;return(0,O.A)(function*(){if(!e._textureInvalidated)return;if(e._textureInvalidated=!1,e._texture||(e._texture=e._createTexture(r)),!e.source)return void e._texture.setData(null);e._texture.resize(e._sourceWidth,e._sourceHeight);const i=function f(c){return I(c)?c instanceof y.A?c.getRenderedRasterPixels()?.renderedRasterPixels:p(c):c}(e.source);try{if(null!=e._uploadStatus){const{controller:o,resolver:h}=e._uploadStatus,M={signal:o.signal},{width:D,height:g}=e,u=e._texture;yield E.textureUploadManager.enqueueTextureUpdate({data:i,texture:u,width:D,height:g},M),h.resolve(),e._uploadStatus=null}else e._texture.setData(i);e.ready()}catch(o){(0,m.jH)(o)}})()}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,P.vt)()}}_createTexture(r){const E=this.immutable,e=new L.R;return e.internalFormat=E?C.H0.RGBA8:C.Ab.RGBA,e.wrapMode=C.pF.CLAMP_TO_EDGE,e.isImmutable=E,e.width=this._sourceWidth,e.height=this._sourceHeight,new K.g(r,e)}}},28399:(H,A,t)=>{t.d(A,{A:()=>O});class O{constructor(d,P,a){this.pixelBlock=d,this.extent=P,this.originalPixelBlock=a}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(d){const P=this.pixelBlock;if(null==P)return;const a=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??P});if(null==a.pixelBlock)return;a.pixelBlock.maskIsAlpha&&(a.pixelBlock.premultiplyAlpha=!0);const n=a.pixelBlock.getAsRGBA(),y=d.createImageData(a.pixelBlock.width,a.pixelBlock.height);y.data.set(n),d.putImageData(y,0,0)}getRenderedRasterPixels(){const d=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==d.pixelBlock?null:(d.pixelBlock.maskIsAlpha&&(d.pixelBlock.premultiplyAlpha=!0),{width:d.pixelBlock.width,height:d.pixelBlock.height,renderedRasterPixels:new Uint8Array(d.pixelBlock.getAsRGBA().buffer)})}}},34531:(H,A,t)=>{t.d(A,{C:()=>E});var O=t(47669),m=t(14089),d=t(8137),P=t(8189),a=t(84035),n=t(3902);function C(e){const i=function y(e){const i=new n.nt(.16666666666666666),o=e.multiply(e),h=o.multiply(e),M=i.multiply(h.multiply(-1).add(new n.nt(3).multiply(o)).subtract(new n.nt(3).multiply(e)).add(1)),D=i.multiply(h.multiply(3).subtract(o.multiply(6)).add(4)),g=i.multiply(h.multiply(-3).add(o.multiply(3)).add(e.multiply(3)).add(1)),u=i.multiply(h);return new n.Zb(M,D,g,u)}(e),o=i.x.add(i.y),h=i.z.add(i.w),M=new n.nt(1).subtract(i.y.divide(o)).add(e),D=new n.nt(1).add(i.w.divide(h)).subtract(e);return new n.Zb(M,D,o,h)}class L extends a.ZA{}(0,P._)([(0,a.C5)(0,n.ZY)],L.prototype,"position",void 0);class p extends a.k2{}(0,P._)([(0,a.Pi)(n.z7)],p.prototype,"texture",void 0),(0,P._)([(0,a.Pi)(n.U)],p.prototype,"dvsMat3",void 0),(0,P._)([(0,a.Pi)(n.ZY)],p.prototype,"coordScale",void 0),(0,P._)([(0,a.Pi)(n.nt)],p.prototype,"opacity",void 0);class f extends a.A{constructor(){super(...arguments),this.type="BitmapShader"}vertex(i){const o=this.config.dvsMat3.multiply(new n.eB(i.position.multiply(this.config.coordScale),1));return{glPosition:new n.Zb(o,1),texcoord:i.position}}fragment(i){const o=new a.mm;let h;return h=this.bicubic?function K(e,i,o){const h=new n.ZY(new n.nt(1).divide(o.x),0),M=new n.ZY(0,new n.nt(1).divide(o.y)),D=i.multiply(o).subtract(.5),g=C((0,n.jc)(D).x).xyz,u=C((0,n.jc)(D).y).xyz;let U=i.add(g.x.multiply(h)),x=i.subtract(g.y.multiply(h));const F=U.add(u.x.multiply(M)),z=x.add(u.x.multiply(M));U=U.subtract(u.y.multiply(M)),x=x.subtract(u.y.multiply(M));let W=(0,n.US)(e,x),Q=(0,n.US)(e,U);const w=(0,n.US)(e,z),N=(0,n.US)(e,F);return W=(0,n.jh)(W,w,u.z),Q=(0,n.jh)(Q,N,u.z),W=(0,n.jh)(W,Q,g.z),W}(this.config.texture,i.texcoord,this.config.coordScale):(0,n.US)(this.config.texture,i.texcoord),o.fragColor=new n.Zb(h.rgb.multiply(this.config.opacity),h.a.multiply(this.config.opacity)),o}}(0,P._)([(0,a.Pi)(p)],f.prototype,"config",void 0),(0,P._)([a.E8],f.prototype,"bicubic",void 0),(0,P._)([(0,P.a)(0,(0,a.hF)(L))],f.prototype,"vertex",null),(0,P._)([(0,P.a)(0,(0,a.hF)(class I extends a.HS{}))],f.prototype,"fragment",null);var T=t(50915);const c={nearest:{samplingMode:T.Cj.NEAREST,mips:!1},bilinear:{samplingMode:T.Cj.LINEAR,mips:!1},bicubic:{samplingMode:T.Cj.LINEAR,mips:!1},trilinear:{samplingMode:T.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},r=(e,i,o)=>{if("dynamic"===o.samplingMode){const{state:h}=e,M=i.resolution/i.pixelRatio/h.resolution,D=Math.round(e.pixelRatio)!==e.pixelRatio;return h.rotation||M>1.05||M<.95||D||i.isSourceScaled||i.rotation?c.bilinear:c.nearest}return c[o.samplingMode]};class E extends m.j{constructor(){super(...arguments),this.name="BrushBitmap",this.type=d.N.Bitmap,this.shaders={bitmap:new f}}render(i,o){const{context:h,renderingOptions:M,painter:D}=i;for(const g of o.bitmaps){const u=g.texture;if(!g.source||!g.isReady||null==u)continue;const U=r(i,g,M);i.timeline.begin(this.name),D.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:g.stencilRef,compare:T.MT.EQUAL,op:{fail:T.eA.KEEP,zFail:T.eA.KEEP,zPass:T.eA.KEEP}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"additive"===g.blendFunction?"additive":"composite"}}),g.setSamplingProfile(U);const{coordScale:x,computedOpacity:F,transforms:z}=g;D.submitDrawMesh(h,{shader:this.shaders.bitmap,uniforms:{config:{texture:{texture:u,unit:O.YS},dvsMat3:z.displayViewScreenMat3,coordScale:x,opacity:F}},defines:{bicubic:U===c.bicubic},optionalAttributes:null,useComputeBuffer:!1},D.quadMesh),i.timeline.end(this.name)}}}},39867:(H,A,t)=>{t.r(A),t.d(A,{default:()=>Et});var O=t(10467),m=t(8189),d=t(17715),P=t(35150),a=t(56492),n=t(85211),K=(t(3248),t(40707),t(76576)),L=t(58701),I=t(27641),X=(t(5922),t(3804),t(58272),t(29430),t(23098),t(46988),t(65374),t(86468),t(28067),t(68643),t(21870),t(1749),t(55861),t(93615),t(47669),t(80862),t(69287),t(9015),t(41510),t(91766),t(47763),t(69630),t(71045),t(82854),t(65264),t(70614),t(88918),t(3691),t(25867),t(39516),t(57249),t(2544),t(34572),t(56854),t(47942),t(53737),t(3688),t(68051),t(88532),t(30365),t(91644),t(51298),t(40702),t(42425),t(77273),t(69473),t(11242),t(50915),t(83693),t(77440),t(9599),t(96764),t(88258),t(23070),t(97550),t(55900),t(52321),t(76169),t(54e3),t(20904),t(6115),t(89563),t(45272),t(55912),t(64559),t(8137),t(62416),t(88690),t(63367),t(79061),t(39784),t(68165),t(38730),t(12598),t(68677),t(90731),t(16006),t(13494),t(58096),t(82870),t(88636),t(79184),t(76740),t(7610),t(99046),t(2296),t(3991),t(19922),t(26248),t(26689),t(37121),t(61299),t(32034),t(8052),t(41396),t(24493),t(20047),t(67399),t(57141)),k=(t(89447),t(31178),t(76410),t(90949),t(92405),t(12225),t(20914),t(47258),t(77469),t(62931)),q=(t(18800),t(56985),t(48875),t(82663),t(87477),t(33658),t(70744),t(9661),t(2947),t(96604)),tt=t(88219),_t=t(9468),S=t(86131),et=t(54290),Z=t(74847),st=t(15215),it=t(77031),lt=t(41474),nt=t(96081),Y=t(96006),rt=t(23868),at=t(56253),ot=t(34150);const ht=[0,0];let G=class extends((0,nt.A)((0,q.Y)((0,tt.e)(lt.A)))){constructor(){super(...arguments),this._fetchQueue=null,this._highlightGraphics=new I.Y,this._highlightView=null,this._popupHighlightHelper=null,this._tileStrategy=null,this.layer=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(_){this._fetchQueue.pause(),this._fetchQueue.state=_.state,this._tileStrategy.update(_),this._fetchQueue.resume(),this._highlightView?.processUpdate(_)}attach(){const _="tileServers"in this.layer?this.layer.tileServers:null,l=this.tilemapCache;if(this._tileInfoView=new et.A(this.layer.tileInfo,this.layer.fullExtent,l?.effectiveMinLOD,l?.effectiveMaxLOD),this._fetchQueue=new st.A({tileInfoView:this._tileInfoView,concurrency:_&&10*_.length||10,process:(s,v)=>this.fetchTile(s,v),scheduler:this.scheduler,priority:ot.W6.MAPVIEW_FETCH_QUEUE}),this._tileStrategy=new it.A({cachePolicy:"keep",resampling:this.resampling,acquireTile:s=>this.acquireTile(s),releaseTile:s=>this.releaseTile(s),tileInfoView:this._tileInfoView}),(0,Y.ox)(this,this.layer)){const s=this._highlightView=new X.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _t.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new Y.Uh({createFetchPopupFeaturesQueryGeometry:(v,R)=>(0,rt.V)(v,R,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(v,R)=>{s.graphicUpdateHandler({graphic:v,property:R})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate(),this.addAttachHandles(this._updatingHandles.add(()=>this.resampling,()=>{this.doRefresh()})),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._popupHighlightHelper?.destroy(),this._highlightView?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}fetchPopupFeaturesAtLocation(_,l){var s=this;return(0,O.A)(function*(){return s._popupHighlightHelper?s._popupHighlightHelper.fetchPopupFeaturesAtLocation(_,l):[]})()}highlight(_,l){const s=(0,k.Oq)(_);if(0===s.length)return(0,d.hA)();const v=l?.name??at.Tv;return this._addHighlightGraphics(s,v),(0,d.hA)(()=>!this.destroyed&&this._removeHighlightGraphics(s,v))}_processHighlight(){const _=this._getHighlights();this._highlightView?.setHighlight(_)}_addHighlightGraphics(_,l){this._highlightGraphics.addMany(_),this._addHighlights(_.map(s=>s.uid),l)}_removeHighlightGraphics(_,l){this._highlightGraphics.removeMany(_),this._removeHighlights(_.map(s=>s.uid),l)}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(_){return(0,L.aI)(this.layer.tileInfo?.spatialReference,_)}doRefresh(){var _=this;return(0,O.A)(function*(){if(_.attached){if(_.suspended)return _._tileStrategy.clear(),void _.requestUpdate();_._fetchQueue.reset(),_._tileStrategy.refresh(l=>_._updatingHandles.addPromise(_._enqueueTileFetch(l)))}})()}acquireTile(_){const l=this._bitmapView.createTile(_),s=l.bitmap;return[s.x,s.y]=this._tileInfoView.getTileCoords(ht,l.key),s.resolution=this._tileInfoView.getTileResolution(l.key),[s.width,s.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(l)),this._bitmapView.addChild(l),this.requestUpdate(),l}releaseTile(_){this._fetchQueue.abort(_.key.id),this._bitmapView.removeChild(_),_.once("detach",()=>_.destroy()),this.requestUpdate()}fetchTile(_,l={}){var s=this;return(0,O.A)(function*(){return s.tilemapCache?s._fetchTileWithTilemapCache(_,l):s._fetchTileWithoutTilemapCache(_,l)})()}_fetchTileWithoutTilemapCache(_,l={}){var s=this;return(0,O.A)(function*(){const{signal:v,resamplingLevel:R=0}=l;try{return yield s._fetchImage(_,v)}catch(V){if((0,a.zf)(V))throw V;if(!s.resampling)return(0,S.G)(s._tileInfoView.tileInfo.size);if(R<3){const B=s._tileInfoView.getTileParentId(_.id);if(B){const j=new Z.A(B),b=yield s._fetchTileWithoutTilemapCache(j,{...l,resamplingLevel:R+1});return(0,S.t)(s._tileInfoView,b,j,_)}}return(0,S.G)(s._tileInfoView.tileInfo.size)}})()}_fetchTileWithTilemapCache(_,l={}){var s=this;return(0,O.A)(function*(){const v=s.tilemapCache,{signal:R,resamplingLevel:V=0}=l,B=new Z.A(0,0,0,0);let j,b=null;try{if(b=yield v.fetchAvailabilityUpsample(_.level,_.row,_.col,B,{signal:R}),!s.resampling&&B.level!==_.level)return yield(0,a.NO)(l),(0,S.G)(s._tileInfoView.tileInfo.size);j=yield s._fetchImage(B,R)}catch($){if((0,a.zf)($))throw $;if(s.resampling&&"unknown"===b&&V<3){const J=s._tileInfoView.getTileParentId(_.id);if(J){B.set(J);try{j=yield s._fetchTileWithTilemapCache(B,{...l,resamplingLevel:V+1})}catch{}}}}return j?s.resampling?(0,S.t)(s._tileInfoView,j,B,_):j:(0,S.G)(s._tileInfoView.tileInfo.size)})()}_enqueueTileFetch(_){var l=this;return(0,O.A)(function*(){if(!l._fetchQueue.has(_.key.id)){try{const s=yield l._fetchQueue.push(_.key);_.bitmap.source=s,_.bitmap.width=l._tileInfoView.tileInfo.size[0],_.bitmap.height=l._tileInfoView.tileInfo.size[1],_.once("attach",()=>l.requestUpdate())}catch(s){(0,a.zf)(s)||P.A.getLogger(l).error(s)}l.requestUpdate()}})()}_fetchImage(_,l){var s=this;return(0,O.A)(function*(){return s.layer.fetchImageBitmapTile(_.level,_.row,_.col,{signal:l})})()}};(0,m._)([(0,n.MZ)()],G.prototype,"resampling",null),(0,m._)([(0,n.MZ)()],G.prototype,"tilemapCache",null),G=(0,m._)([(0,K.$)("esri.views.2d.layers.TileLayerView2D")],G);const Et=G},96081:(H,A,t)=>{t.d(A,{A:()=>K});var O=t(8189),m=t(35150),d=t(56492),P=t(48900),C=(t(3248),t(40707),t(5922),t(76576));const K=L=>{let I=class extends L{initialize(){this.addHandles((0,P.on)(()=>this.layer,"refresh",p=>{this.doRefresh(p.dataChanged).catch(f=>{(0,d.zf)(f)||m.A.getLogger(this).error(f)})}),"RefreshableLayerView")}};return I=(0,O._)([(0,C.$)("esri.views.layers.RefreshableLayerView")],I),I}}}]);