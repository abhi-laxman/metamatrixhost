"use strict";(self.webpackChunkAngularClient=self.webpackChunkAngularClient||[]).push([[7451],{39693:(H,C,s)=>{s.d(C,{P:()=>c,L:()=>d});var f=s(8189),P=s(98877),B=s(29529),I=s(77806),E=s(26514);class A{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(E.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new A,r=this._originStores[E.Gr.DEFAULTS];r&&r.forEach((n,u)=>{t.set(u,(0,I.o8)(n),E.Gr.DEFAULTS)});for(let n=E.Gr.SERVICE;n<E.AU;n++){const u=this._originStores[n];u&&u.forEach((g,p)=>{e&&e.has(p)||t.set(p,(0,I.o8)(g),n)})}return t}get(e,t){const r=void 0===t?this._values:this._originStores[t];return r?r.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,r=E.Gr.USER){let n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const u=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,r),u!==t}return!1}delete(e,t=E.Gr.USER){const r=this._originStores[t];if(!r)return;const n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let u=t-1;u>=0;u--){const g=this._originStores[u];if(g&&g.has(e)){this._values.set(e,g.get(e)),this._propertyOriginMap.set(e,u);break}}}return n}has(e,t){const r=void 0===t?this._values:this._originStores[t];return!!r&&r.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const r=this._originStores[t],n=r?.get(e),u=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,t),u!==n}originOf(e){return this._propertyOriginMap.get(e)||E.Gr.DEFAULTS}forEach(e){this._values.forEach(e)}}var R=s(34813),v=s(74220),U=s(76576);const O=h=>{let e=class extends h{constructor(...t){super(...t);const r=(0,v.oY)(this),n=r.store,u=new A;r.store=u,(0,B.k)(r,n,u)}read(t,r){(0,R.L)(this,t,r)}getAtOrigin(t,r){const n=m(this),u=(0,E.aB)(r);if("string"==typeof t)return n.get(t,u);const g={};return t.forEach(p=>{g[p]=n.get(p,u)}),g}originOf(t){return(0,E.OL)(this.originIdOf(t))}originIdOf(t){return m(this).originOf(t)}revert(t,r){const n=m(this),u=(0,E.aB)(r),g=(0,v.oY)(this);let p;p="string"==typeof t?"*"===t?n.keys(u):[t]:t,p.forEach(l=>{g.invalidate(l),n.revert(l,u),g.commit(l)})}};return e=(0,f._)([(0,U.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function m(h){return(0,v.oY)(h).store}let y=class extends(O(P.A)){};y=(0,f._)([(0,U.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],y);var T=s(92073),j=s(56558);const K=h=>{let e=class extends h{constructor(...t){super(...t)}clear(t,r="user"){return _(this).delete(t,(0,E.aB)(r))}write(t,r){return(0,j.M)(this,t=t||{},r),t}setAtOrigin(t,r,n){(0,v.oY)(this).setAtOrigin(t,r,(0,E.aB)(n))}removeOrigin(t){const r=_(this),n=(0,E.aB)(t),u=r.keys(n);for(const g of u)r.originOf(g)===n&&r.set(g,r.get(g,n),E.Gr.USER)}updateOrigin(t,r){const n=_(this),u=(0,E.aB)(r),g=(0,T.Jt)(this,t);for(let p=u+1;p<E.AU;++p)n.delete(t,p);n.set(t,g,u)}toJSON(t){return this.write({},t)}};return e=(0,f._)([(0,U.$)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function _(h){return(0,v.oY)(h).store}const c=h=>{let e=class extends(K(O(h))){constructor(...t){super(...t)}};return e=(0,f._)([(0,U.$)("esri.core.MultiOriginJSONSupport")],e),e};let d=class extends(c(P.A)){};d=(0,f._)([(0,U.$)("esri.core.MultiOriginJSONSupport")],d)},85551:(H,C,s)=>{s.d(C,{A:()=>n});var f=s(10467),P=s(8189),B=s(23098),I=s(77469),E=s(89563),A=s(89447),R=s(5922),v=s(35150),U=s(11432),O=s(56492),m=s(45272),y=s(85211),K=(s(3248),s(40707),s(17221)),_=s(76576),c=s(50305),d=s(58443),h=s(73874),e=s(46577),t=s(52606),r=s(69927);const n=g=>{let p=class extends g{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,U.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(l){l!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",l))}readPortalItem(l,o,i){if(o.itemId)return new e.default({id:o.itemId,portal:i?.portal})}writePortalItem(l,o){l?.id&&(o.itemId=l.id)}loadFromPortal(l,o){var i=this;return(0,f.A)(function*(){if(i.portalItem?.id)try{const{load:a}=yield Promise.all([s.e(2076),s.e(6180)]).then(s.bind(s,56180));return(0,O.Te)(o),yield a({instance:i,supportedTypes:l.supportedTypes,validateItem:l.validateItem,supportsData:l.supportsData,layerModuleTypeMap:l.layerModuleTypeMap,populateGroupLayer:l.populateGroupLayer},o)}catch(a){throw(0,O.zf)(a)||v.A.getLogger(i).warn(`Failed to load layer (${i.title}, ${i.id}) portal item (${i.portalItem.id})\n  ${a}`),a}})()}finishLoadEditablePortalLayer(l){var o=this;return(0,f.A)(function*(){o._set("userHasEditingPrivileges",yield o._fetchUserHasEditingPrivileges(l).catch(i=>((0,O.QP)(i),!0)))})()}setUserPrivileges(l,o){var i=this;return(0,f.A)(function*(){if(!B.A.userPrivilegesApplied)return i.finishLoadEditablePortalLayer(o);if(i.url)try{const{features:{edit:a,fullEdit:S},content:{updateItem:M}}=yield i._fetchUserPrivileges(l,o);i._set("userHasEditingPrivileges",a),i._set("userHasFullEditingPrivileges",S),i._set("userHasUpdateItemPrivileges",M)}catch(a){(0,O.QP)(a)}})()}_fetchUserPrivileges(l,o){var i=this;return(0,f.A)(function*(){let a=i.portalItem;if(!l||!a||!a.loaded||a.sourceUrl)return i._fetchFallbackUserPrivileges(o);const S=!I.id?.findCredential(i.url),M=l===a.id;if(M&&a.portal.user)return i._getUserPrivileges(a,S);let D,G;if(M)D=a.portal.url;else try{D=yield(0,d.wI)(i.url,o)}catch(L){(0,O.QP)(L)}if(!D||!(0,m.b8)(D,a.portal.url))return i._fetchFallbackUserPrivileges(o);try{const L=null!=o?o.signal:null;G=yield I.id?.getCredential(`${D}/sharing`,{prompt:!1,signal:L})}catch(L){(0,O.QP)(L)}if(!G)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(M?yield a.reload():(a=new e.default({id:l,portal:{url:D}}),yield a.load(o)),a.portal.user)return i._getUserPrivileges(a,S)}catch(L){(0,O.QP)(L)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_getUserPrivileges(l,o){const i=(0,r.It)(l);return o&&(i.features.edit=!0),i}_fetchFallbackUserPrivileges(l){var o=this;return(0,f.A)(function*(){let i=!0;try{i=yield o._fetchUserHasEditingPrivileges(l)}catch(a){(0,O.QP)(a)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(l){var o=this;return(0,f.A)(function*(){const i=o.url?I.id?.findCredential(o.url):null;if(!i)return!0;const a=u.credential===i?u.user:yield o._fetchEditingUser(l);return u.credential=i,u.user=a,null==a?.privileges||a.privileges.includes("features:user:edit")})()}_fetchEditingUser(l){var o=this;return(0,f.A)(function*(){const i=o.portalItem?.portal?.user;if(i)return i;const a=I.id?.findServerInfo(o.url??"");if(!a?.owningSystemUrl)return null;const S=`${a.owningSystemUrl}/sharing/rest`,M=h.A.getDefault();if(M&&M.loaded&&(0,m.S8)(M.restUrl)===(0,m.S8)(S))return M.user;const D=`${S}/community/self`,G=null!=l?l.signal:null,W=yield(0,A.Ke)((0,E.A)(D,{authMode:"no-prompt",query:{f:"json"},signal:G}));return W.ok?t.A.fromJSON(W.value.data):null})()}read(l,o){o&&(o.layer=this),super.read(l,o)}write(l,o){const i=o?.portal,a=this.portalItem?.id&&(this.portalItem.portal||h.A.getDefault());return i&&a&&!(0,m.ut)(a.restUrl,i.restUrl)?(o.messages&&o.messages.push(new R.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(l,{...o,layer:this})}};return(0,P._)([(0,y.MZ)({type:e.default})],p.prototype,"portalItem",null),(0,P._)([(0,K.w)("web-document","portalItem",["itemId"])],p.prototype,"readPortalItem",null),(0,P._)([(0,c.K)("web-document","portalItem",{itemId:{type:String}})],p.prototype,"writePortalItem",null),(0,P._)([(0,y.MZ)({clonable:!1})],p.prototype,"resourceReferences",void 0),(0,P._)([(0,y.MZ)({type:Boolean,readOnly:!0})],p.prototype,"userHasEditingPrivileges",void 0),(0,P._)([(0,y.MZ)({type:Boolean,readOnly:!0})],p.prototype,"userHasFullEditingPrivileges",void 0),(0,P._)([(0,y.MZ)({type:Boolean,readOnly:!0})],p.prototype,"userHasUpdateItemPrivileges",void 0),p=(0,P._)([(0,_.$)("esri.layers.mixins.PortalLayer")],p),p},u={credential:null,user:null}},69927:(H,C,s)=>{s.d(C,{It:()=>K,LG:()=>R,OM:()=>O,Sm:()=>m,Y:()=>v,bK:()=>U,mm:()=>j,sQ:()=>y});var f=s(10467),P=s(13970),B=s(32034),I=s(55039);function A(){return(A=(0,f.A)(function*(_){const c=_.spatialReference;if(c.isWGS84)return _.clone();if(c.isWebMercator)return(0,I.ci)(_);const d=B.A.WGS84;return yield(0,P.initializeProjection)(c,d),(0,P.project)(_,d)})).apply(this,arguments)}function R(_,c){if(!v(_,c)){const d=_.typeKeywords;d?d.push(c):_.typeKeywords=[c]}}function v(_,c){return!!_.typeKeywords?.includes(c)}function U(_){return v(_,j.HOSTED_SERVICE)}function O(_,c){const d=_.typeKeywords;if(d){const h=d.indexOf(c);h>-1&&d.splice(h,1)}}function m(_,c,d){d?R(_,c):O(_,c)}function y(_){return T.apply(this,arguments)}function T(){return T=(0,f.A)(function*(_){const c=_.clone().normalize();let d;if(c.length>1)for(const h of c)d?h.width>d.width&&(d=h):d=h;else d=c[0];return function E(_){return A.apply(this,arguments)}(d)}),T.apply(this,arguments)}const j={DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function K(_){const{portal:c,isOrgItem:d,itemControl:h}=_,e=c.user?.privileges;let t=!e||e.includes("features:user:edit"),r=!!d&&!!e?.includes("features:user:fullEdit");const n="update"===h||"admin"===h;return n?r=t=!0:r&&(t=!0),{features:{edit:t,fullEdit:r},content:{updateItem:n}}}}}]);